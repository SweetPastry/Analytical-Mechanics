"use strict";var LOe=Object.create;var yR=Object.defineProperty;var soe=Object.getOwnPropertyDescriptor;var OOe=Object.getOwnPropertyNames;var MOe=Object.getPrototypeOf,FOe=Object.prototype.hasOwnProperty;var A=(t,e)=>()=>(t&&(e=t(t=0)),e);var O=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),_n=(t,e)=>{for(var r in e)yR(t,r,{get:e[r],enumerable:!0})},aoe=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of OOe(e))!FOe.call(t,o)&&o!==r&&yR(t,o,{get:()=>e[o],enumerable:!(n=soe(e,o))||n.enumerable});return t};var H=(t,e,r)=>(r=t!=null?LOe(MOe(t)):{},aoe(e||!t||!t.__esModule?yR(r,"default",{value:t,enumerable:!0}):r,t)),eo=t=>aoe(yR({},"__esModule",{value:!0}),t),w=(t,e,r,n)=>{for(var o=n>1?void 0:n?soe(e,r):e,s=t.length-1,a;s>=0;s--)(a=t[s])&&(o=(n?a(e,r,o):a(o))||o);return n&&o&&yR(e,r,o),o},b=(t,e)=>(r,n)=>e(r,n,t);var Gt=O((bmt,doe)=>{"use strict";var Vq=Object.defineProperty,UOe=Object.getOwnPropertyDescriptor,BOe=Object.getOwnPropertyNames,qOe=Object.prototype.hasOwnProperty,jOe=(t,e)=>{for(var r in e)Vq(t,r,{get:e[r],enumerable:!0})},HOe=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of BOe(e))!qOe.call(t,o)&&o!==r&&Vq(t,o,{get:()=>e[o],enumerable:!(n=UOe(e,o))||n.enumerable});return t},VOe=t=>HOe(Vq({},"__esModule",{value:!0}),t),uoe={};jOe(uoe,{config:()=>KOe,t:()=>loe});doe.exports=VOe(uoe);var GOe=require("fs"),zOe=require("fs/promises");async function $Oe(t){if(t.protocol==="file:")return await(0,zOe.readFile)(t,"utf8");if(t.protocol==="http:"||t.protocol==="https:"){let e=await fetch(t.toString(),{headers:{"Accept-Encoding":"gzip, deflate",Accept:"application/json"},redirect:"follow"});if(!e.ok){let n=`Unexpected ${e.status} response while trying to read ${t}`;try{n+=`: ${await e.text()}`}catch{}throw new Error(n)}return await e.text()}throw new Error("Unsupported protocol")}function WOe(t){return(0,GOe.readFileSync)(t,"utf8")}var _R;function KOe(t){if("contents"in t){typeof t.contents=="string"?_R=JSON.parse(t.contents):_R=t.contents;return}if("fsPath"in t){let e=WOe(t.fsPath),r=JSON.parse(e);_R=coe(r)?r.contents.bundle:r;return}if(t.uri){let e=t.uri;return typeof t.uri=="string"&&(e=new URL(t.uri)),new Promise((r,n)=>{let o=$Oe(e).then(s=>{try{let a=JSON.parse(s);_R=coe(a)?a.contents.bundle:a}catch(a){n(a)}}).catch(s=>{n(s)});r(o)})}}function loe(...t){let e=t[0],r,n,o;if(typeof e=="string")r=e,n=e,t.splice(0,1),o=!t||typeof t[0]!="object"?t:t[0];else if(e instanceof Array){let a=t.slice(1);if(e.length!==a.length+1)throw new Error("expected a string as the first argument to l10n.t");let c=e[0];for(let u=1;u<e.length;u++)c+=`{${u-1}}`+e[u];return loe(c,...a)}else n=e.message,r=n,e.comment&&e.comment.length>0&&(r+=`/${Array.isArray(e.comment)?e.comment.join(""):e.comment}`),o=e.args??{};let s=_R?.[r];return s?typeof s=="string"?VN(s,o):s.comment?VN(s.message,o):VN(n,o):VN(n,o)}var YOe=/{([^}]+)}/g;function VN(t,e){return Object.keys(e).length===0?t:t.replace(YOe,(r,n)=>e[n]??r)}function coe(t){return typeof t?.contents?.bundle=="object"&&typeof t?.version=="string"}});var aS=O(Ad=>{"use strict";Object.defineProperty(Ad,"__esModule",{value:!0});Ad.BaseTokensPerName=Ad.BaseTokensPerMessage=Ad.BaseTokensPerCompletion=Ad.ChatRole=void 0;var hse;(function(t){t.System="system",t.User="user",t.Assistant="assistant",t.Function="function",t.Tool="tool"})(hse||(Ad.ChatRole=hse={}));Ad.BaseTokensPerCompletion=3;Ad.BaseTokensPerMessage=3;Ad.BaseTokensPerName=1});var Tj=O(wL=>{"use strict";Object.defineProperty(wL,"__esModule",{value:!0});wL.forEachNode=void 0;function gse(t,e){if(e(t),t.type===1)for(let r of t.children)gse(r,e)}wL.forEachNode=gse});var bse=O(()=>{"use strict";function m5e(t,e,...r){return{ctor:t,props:e,children:r.flat()}}function vse(){throw new Error("This should not be invoked!")}vse.isFragment=!0;globalThis.vscpp=m5e;globalThis.vscppf=vse});var wj=O(RL=>{"use strict";Object.defineProperty(RL,"__esModule",{value:!0});RL.PromptElement=void 0;bse();var Ej=class{get priority(){return this.props.priority??Number.MAX_SAFE_INTEGER}get insertLineBreakBefore(){return!0}constructor(e){this.props=e}};RL.PromptElement=Ej});var Nj=O(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.ToolResult=Ei.PrioritizedList=Ei.TextChunk=Ei.ToolMessage=Ei.FunctionMessage=Ei.AssistantMessage=Ei.UserMessage=Ei.SystemMessage=Ei.BaseChatMessage=Ei.isChatMessagePromptElement=void 0;var yse=nt(),_se=Tj(),qR=aS(),AL=wj();function h5e(t){return t instanceof kL||t instanceof BR||t instanceof PL}Ei.isChatMessagePromptElement=h5e;var Yh=class extends AL.PromptElement{render(){return vscpp(vscppf,null,this.props.children)}};Ei.BaseChatMessage=Yh;var kL=class extends Yh{constructor(e){e.role=qR.ChatRole.System,super(e)}};Ei.SystemMessage=kL;var BR=class extends Yh{constructor(e){e.role=qR.ChatRole.User,super(e)}};Ei.UserMessage=BR;var PL=class extends Yh{constructor(e){e.role=qR.ChatRole.Assistant,super(e)}};Ei.AssistantMessage=PL;var g5e=/\s+/g,Rj=class extends Yh{constructor(e){e.role=qR.ChatRole.Function,super(e)}};Ei.FunctionMessage=Rj;var kj=class extends Yh{constructor(e){e.role=qR.ChatRole.Tool,super(e)}};Ei.ToolMessage=kj;var Pj=class extends AL.PromptElement{async prepare(e,r,n){let o=this.props.breakOnWhitespace?g5e:this.props.breakOn;if(!o)return vscpp(vscppf,null,this.props.children);let s="",a=[];for(let u of this.props.children||[])if(u&&typeof u=="object"){if(typeof u.ctor!="string")throw new Error("TextChunk children must be text literals or intrinsic attributes.");u.ctor==="br"?s+=`
`:a.push(u)}else u!=null&&(s+=u);let c=await v5e(e,o,s,n);return vscpp(vscppf,null,a,c)}render(e){return e}};Ei.TextChunk=Pj;async function v5e(t,e,r,n){if(e instanceof RegExp){if(!e.global)throw new Error(`\`breakOn\` expression must have the global flag set (got ${e})`);e.lastIndex=0}let o="",s=-1;for(;s<r.length;){let a;typeof e=="string"?a=r.indexOf(e,s===-1?0:s+e.length):a=e.exec(r)?.index??-1,a===-1&&(a=r.length);let c=o+r.slice(Math.max(0,s),a);if(await t.countTokens(c,n)>t.tokenBudget)return o;o=c,s=a}return o}var Aj=class extends AL.PromptElement{render(){let e=this.props.children;if(e)return vscpp(vscppf,null,e.map((r,n)=>(r.props??(r.props={}),r.props.priority=this.props.descending?this.props.priority-n:this.props.priority-e.length+n,r)))}};Ei.PrioritizedList=Aj;var Dj=class extends AL.PromptElement{render(){return this.props.data.hasOwnProperty(yse.contentType)?vscpp("elementJSON",{data:this.rebasePriority(this.props.data[yse.contentType])}):vscpp(BR,{priority:this.priority},this.props.data.toString())}rebasePriority(e){if(this.priority===void 0)return e;let r=structuredClone(e),n=1;return _se.forEachNode(r.node,o=>{o.priority===Number.MAX_SAFE_INTEGER&&(o.priority=void 0),o.priority!==void 0&&(n=Math.max(n,o.priority))}),_se.forEachNode(r.node,o=>{let s=(o.priority??n+1)/(n+2);o.priority=this.priority+s}),r}};Ei.ToolResult=Dj});var Sse=O(Qh=>{"use strict";Object.defineProperty(Qh,"__esModule",{value:!0});Qh.getConfiguredDefaultLocale=Qh.localize2=Qh.localize=void 0;function xse(t,e){let r;return e.length===0?r=t:r=t.replace(/\{(\d+)\}/g,function(n,o){let s=o[0];return typeof e[s]<"u"?e[s]:n}),r}function b5e(t,e,...r){return xse(e,r)}Qh.localize=b5e;function y5e(t,e,...r){let n=xse(e,r);return{original:n,value:n}}Qh.localize2=y5e;function _5e(t){}Qh.getConfiguredDefaultLocale=_5e});var Fj=O(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});Ue.isBigSurOrNewer=Ue.isAndroid=Ue.isEdge=Ue.isSafari=Ue.isFirefox=Ue.isChrome=Ue.isLittleEndian=Ue.OS=Ue.setTimeout0=Ue.setTimeout0IsFaster=Ue.translationsConfigFile=Ue.platformLocale=Ue.locale=Ue.Language=Ue.language=Ue.userAgent=Ue.platform=Ue.isCI=Ue.isMobile=Ue.isIOS=Ue.webWorkerOrigin=Ue.isWebWorker=Ue.isWeb=Ue.isElectron=Ue.isNative=Ue.isLinuxSnap=Ue.isLinux=Ue.isMacintosh=Ue.isWindows=Ue.PlatformToString=Ue.LANGUAGE_DEFAULT=void 0;var Ise=Sse();Ue.LANGUAGE_DEFAULT="en";var VR=!1,GR=!1,HR=!1,wse=!1,Rse=!1,Oj=!1,kse=!1,Mj=!1,Pse=!1,Ase=!1,jR,DL=Ue.LANGUAGE_DEFAULT,Lj=Ue.LANGUAGE_DEFAULT,Dse,Mf,Ff=globalThis,kc;typeof Ff.vscode<"u"&&typeof Ff.vscode.process<"u"?kc=Ff.vscode.process:typeof process<"u"&&(kc=process);var Nse=typeof kc?.versions?.electron=="string",x5e=Nse&&kc?.type==="renderer";if(typeof kc=="object"){VR=kc.platform==="win32",GR=kc.platform==="darwin",HR=kc.platform==="linux",wse=HR&&!!kc.env.SNAP&&!!kc.env.SNAP_REVISION,kse=Nse,Pse=!!kc.env.CI||!!kc.env.BUILD_ARTIFACTSTAGINGDIRECTORY,jR=Ue.LANGUAGE_DEFAULT,DL=Ue.LANGUAGE_DEFAULT;let t=kc.env.VSCODE_NLS_CONFIG;if(t)try{let e=JSON.parse(t),r=e.availableLanguages["*"];jR=e.locale,Lj=e.osLocale,DL=r||Ue.LANGUAGE_DEFAULT,Dse=e._translationsConfigFile}catch{}Rse=!0}else typeof navigator=="object"&&!x5e?(Mf=navigator.userAgent,VR=Mf.indexOf("Windows")>=0,GR=Mf.indexOf("Macintosh")>=0,Mj=(Mf.indexOf("Macintosh")>=0||Mf.indexOf("iPad")>=0||Mf.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,HR=Mf.indexOf("Linux")>=0,Ase=Mf?.indexOf("Mobi")>=0,Oj=!0,jR=Ise.getConfiguredDefaultLocale(Ise.localize({key:"ensureLoaderPluginIsLoaded",comment:["{Locked}"]},"_"))||Ue.LANGUAGE_DEFAULT,DL=jR,Lj=navigator.language):console.error("Unable to resolve platform.");function S5e(t){switch(t){case 0:return"Web";case 1:return"Mac";case 2:return"Linux";case 3:return"Windows"}}Ue.PlatformToString=S5e;var NL=0;GR?NL=1:VR?NL=3:HR&&(NL=2);Ue.isWindows=VR;Ue.isMacintosh=GR;Ue.isLinux=HR;Ue.isLinuxSnap=wse;Ue.isNative=Rse;Ue.isElectron=kse;Ue.isWeb=Oj;Ue.isWebWorker=Oj&&typeof Ff.importScripts=="function";Ue.webWorkerOrigin=Ue.isWebWorker?Ff.origin:void 0;Ue.isIOS=Mj;Ue.isMobile=Ase;Ue.isCI=Pse;Ue.platform=NL;Ue.userAgent=Mf;Ue.language=DL;var Cse;(function(t){function e(){return Ue.language}t.value=e;function r(){return Ue.language.length===2?Ue.language==="en":Ue.language.length>=3?Ue.language[0]==="e"&&Ue.language[1]==="n"&&Ue.language[2]==="-":!1}t.isDefaultVariant=r;function n(){return Ue.language==="en"}t.isDefault=n})(Cse||(Ue.Language=Cse={}));Ue.locale=jR;Ue.platformLocale=Lj;Ue.translationsConfigFile=Dse;Ue.setTimeout0IsFaster=typeof Ff.postMessage=="function"&&!Ff.importScripts;Ue.setTimeout0=(()=>{if(Ue.setTimeout0IsFaster){let t=[];Ff.addEventListener("message",r=>{if(r.data&&r.data.vscodeScheduleAsyncWork)for(let n=0,o=t.length;n<o;n++){let s=t[n];if(s.id===r.data.vscodeScheduleAsyncWork){t.splice(n,1),s.callback();return}}});let e=0;return r=>{let n=++e;t.push({id:n,callback:r}),Ff.postMessage({vscodeScheduleAsyncWork:n},"*")}}return t=>setTimeout(t)})();Ue.OS=GR||Mj?2:VR?1:3;var Tse=!0,Ese=!1;function I5e(){if(!Ese){Ese=!0;let t=new Uint8Array(2);t[0]=1,t[1]=2,Tse=new Uint16Array(t.buffer)[0]===513}return Tse}Ue.isLittleEndian=I5e;Ue.isChrome=!!(Ue.userAgent&&Ue.userAgent.indexOf("Chrome")>=0);Ue.isFirefox=!!(Ue.userAgent&&Ue.userAgent.indexOf("Firefox")>=0);Ue.isSafari=!!(!Ue.isChrome&&Ue.userAgent&&Ue.userAgent.indexOf("Safari")>=0);Ue.isEdge=!!(Ue.userAgent&&Ue.userAgent.indexOf("Edg/")>=0);Ue.isAndroid=!!(Ue.userAgent&&Ue.userAgent.indexOf("Android")>=0);function C5e(t){return parseFloat(t)>=20}Ue.isBigSurOrNewer=C5e});var Ose=O(Dd=>{"use strict";Object.defineProperty(Dd,"__esModule",{value:!0});Dd.arch=Dd.platform=Dd.env=Dd.cwd=void 0;var Lse=Fj(),Wb,Uj=globalThis.vscode;if(typeof Uj<"u"&&typeof Uj.process<"u"){let t=Uj.process;Wb={get platform(){return t.platform},get arch(){return t.arch},get env(){return t.env},cwd(){return t.cwd()}}}else typeof process<"u"?Wb={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:Wb={get platform(){return Lse.isWindows?"win32":Lse.isMacintosh?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};Dd.cwd=Wb.cwd;Dd.env=Wb.env;Dd.platform=Wb.platform;Dd.arch=Wb.arch});var Fse=O(at=>{"use strict";Object.defineProperty(at,"__esModule",{value:!0});at.delimiter=at.sep=at.toNamespacedPath=at.parse=at.format=at.extname=at.basename=at.dirname=at.relative=at.resolve=at.join=at.isAbsolute=at.normalize=at.posix=at.win32=void 0;var cS=Ose(),T5e=65,E5e=97,w5e=90,R5e=122,Zh=46,jo=47,za=92,Xh=58,k5e=63,LL=class extends Error{constructor(e,r,n){let o;typeof r=="string"&&r.indexOf("not ")===0?(o="must not be",r=r.replace(/^not /,"")):o="must be";let s=e.indexOf(".")!==-1?"property":"argument",a=`The "${e}" ${s} ${o} of type ${r}`;a+=`. Received type ${typeof n}`,super(a),this.code="ERR_INVALID_ARG_TYPE"}};function P5e(t,e){if(t===null||typeof t!="object")throw new LL(e,"Object",t)}function wi(t,e){if(typeof t!="string")throw new LL(e,"string",t)}var $a=cS.platform==="win32";function or(t){return t===jo||t===za}function Bj(t){return t===jo}function Jh(t){return t>=T5e&&t<=w5e||t>=E5e&&t<=R5e}function OL(t,e,r,n){let o="",s=0,a=-1,c=0,u=0;for(let l=0;l<=t.length;++l){if(l<t.length)u=t.charCodeAt(l);else{if(n(u))break;u=jo}if(n(u)){if(!(a===l-1||c===1))if(c===2){if(o.length<2||s!==2||o.charCodeAt(o.length-1)!==Zh||o.charCodeAt(o.length-2)!==Zh){if(o.length>2){let d=o.lastIndexOf(r);d===-1?(o="",s=0):(o=o.slice(0,d),s=o.length-1-o.lastIndexOf(r)),a=l,c=0;continue}else if(o.length!==0){o="",s=0,a=l,c=0;continue}}e&&(o+=o.length>0?`${r}..`:"..",s=2)}else o.length>0?o+=`${r}${t.slice(a+1,l)}`:o=t.slice(a+1,l),s=l-a-1;a=l,c=0}else u===Zh&&c!==-1?++c:c=-1}return o}function Mse(t,e){P5e(e,"pathObject");let r=e.dir||e.root,n=e.base||`${e.name||""}${e.ext||""}`;return r?r===e.root?`${r}${n}`:`${r}${t}${n}`:n}at.win32={resolve(...t){let e="",r="",n=!1;for(let o=t.length-1;o>=-1;o--){let s;if(o>=0){if(s=t[o],wi(s,"path"),s.length===0)continue}else e.length===0?s=cS.cwd():(s=cS.env[`=${e}`]||cS.cwd(),(s===void 0||s.slice(0,2).toLowerCase()!==e.toLowerCase()&&s.charCodeAt(2)===za)&&(s=`${e}\\`));let a=s.length,c=0,u="",l=!1,d=s.charCodeAt(0);if(a===1)or(d)&&(c=1,l=!0);else if(or(d))if(l=!0,or(s.charCodeAt(1))){let p=2,f=p;for(;p<a&&!or(s.charCodeAt(p));)p++;if(p<a&&p!==f){let m=s.slice(f,p);for(f=p;p<a&&or(s.charCodeAt(p));)p++;if(p<a&&p!==f){for(f=p;p<a&&!or(s.charCodeAt(p));)p++;(p===a||p!==f)&&(u=`\\\\${m}\\${s.slice(f,p)}`,c=p)}}}else c=1;else Jh(d)&&s.charCodeAt(1)===Xh&&(u=s.slice(0,2),c=2,a>2&&or(s.charCodeAt(2))&&(l=!0,c=3));if(u.length>0)if(e.length>0){if(u.toLowerCase()!==e.toLowerCase())continue}else e=u;if(n){if(e.length>0)break}else if(r=`${s.slice(c)}\\${r}`,n=l,l&&e.length>0)break}return r=OL(r,!n,"\\",or),n?`${e}\\${r}`:`${e}${r}`||"."},normalize(t){wi(t,"path");let e=t.length;if(e===0)return".";let r=0,n,o=!1,s=t.charCodeAt(0);if(e===1)return Bj(s)?"\\":t;if(or(s))if(o=!0,or(t.charCodeAt(1))){let c=2,u=c;for(;c<e&&!or(t.charCodeAt(c));)c++;if(c<e&&c!==u){let l=t.slice(u,c);for(u=c;c<e&&or(t.charCodeAt(c));)c++;if(c<e&&c!==u){for(u=c;c<e&&!or(t.charCodeAt(c));)c++;if(c===e)return`\\\\${l}\\${t.slice(u)}\\`;c!==u&&(n=`\\\\${l}\\${t.slice(u,c)}`,r=c)}}}else r=1;else Jh(s)&&t.charCodeAt(1)===Xh&&(n=t.slice(0,2),r=2,e>2&&or(t.charCodeAt(2))&&(o=!0,r=3));let a=r<e?OL(t.slice(r),!o,"\\",or):"";return a.length===0&&!o&&(a="."),a.length>0&&or(t.charCodeAt(e-1))&&(a+="\\"),n===void 0?o?`\\${a}`:a:o?`${n}\\${a}`:`${n}${a}`},isAbsolute(t){wi(t,"path");let e=t.length;if(e===0)return!1;let r=t.charCodeAt(0);return or(r)||e>2&&Jh(r)&&t.charCodeAt(1)===Xh&&or(t.charCodeAt(2))},join(...t){if(t.length===0)return".";let e,r;for(let s=0;s<t.length;++s){let a=t[s];wi(a,"path"),a.length>0&&(e===void 0?e=r=a:e+=`\\${a}`)}if(e===void 0)return".";let n=!0,o=0;if(typeof r=="string"&&or(r.charCodeAt(0))){++o;let s=r.length;s>1&&or(r.charCodeAt(1))&&(++o,s>2&&(or(r.charCodeAt(2))?++o:n=!1))}if(n){for(;o<e.length&&or(e.charCodeAt(o));)o++;o>=2&&(e=`\\${e.slice(o)}`)}return at.win32.normalize(e)},relative(t,e){if(wi(t,"from"),wi(e,"to"),t===e)return"";let r=at.win32.resolve(t),n=at.win32.resolve(e);if(r===n||(t=r.toLowerCase(),e=n.toLowerCase(),t===e))return"";let o=0;for(;o<t.length&&t.charCodeAt(o)===za;)o++;let s=t.length;for(;s-1>o&&t.charCodeAt(s-1)===za;)s--;let a=s-o,c=0;for(;c<e.length&&e.charCodeAt(c)===za;)c++;let u=e.length;for(;u-1>c&&e.charCodeAt(u-1)===za;)u--;let l=u-c,d=a<l?a:l,p=-1,f=0;for(;f<d;f++){let h=t.charCodeAt(o+f);if(h!==e.charCodeAt(c+f))break;h===za&&(p=f)}if(f!==d){if(p===-1)return n}else{if(l>d){if(e.charCodeAt(c+f)===za)return n.slice(c+f+1);if(f===2)return n.slice(c+f)}a>d&&(t.charCodeAt(o+f)===za?p=f:f===2&&(p=3)),p===-1&&(p=0)}let m="";for(f=o+p+1;f<=s;++f)(f===s||t.charCodeAt(f)===za)&&(m+=m.length===0?"..":"\\..");return c+=p,m.length>0?`${m}${n.slice(c,u)}`:(n.charCodeAt(c)===za&&++c,n.slice(c,u))},toNamespacedPath(t){if(typeof t!="string"||t.length===0)return t;let e=at.win32.resolve(t);if(e.length<=2)return t;if(e.charCodeAt(0)===za){if(e.charCodeAt(1)===za){let r=e.charCodeAt(2);if(r!==k5e&&r!==Zh)return`\\\\?\\UNC\\${e.slice(2)}`}}else if(Jh(e.charCodeAt(0))&&e.charCodeAt(1)===Xh&&e.charCodeAt(2)===za)return`\\\\?\\${e}`;return t},dirname(t){wi(t,"path");let e=t.length;if(e===0)return".";let r=-1,n=0,o=t.charCodeAt(0);if(e===1)return or(o)?t:".";if(or(o)){if(r=n=1,or(t.charCodeAt(1))){let c=2,u=c;for(;c<e&&!or(t.charCodeAt(c));)c++;if(c<e&&c!==u){for(u=c;c<e&&or(t.charCodeAt(c));)c++;if(c<e&&c!==u){for(u=c;c<e&&!or(t.charCodeAt(c));)c++;if(c===e)return t;c!==u&&(r=n=c+1)}}}}else Jh(o)&&t.charCodeAt(1)===Xh&&(r=e>2&&or(t.charCodeAt(2))?3:2,n=r);let s=-1,a=!0;for(let c=e-1;c>=n;--c)if(or(t.charCodeAt(c))){if(!a){s=c;break}}else a=!1;if(s===-1){if(r===-1)return".";s=r}return t.slice(0,s)},basename(t,e){e!==void 0&&wi(e,"ext"),wi(t,"path");let r=0,n=-1,o=!0,s;if(t.length>=2&&Jh(t.charCodeAt(0))&&t.charCodeAt(1)===Xh&&(r=2),e!==void 0&&e.length>0&&e.length<=t.length){if(e===t)return"";let a=e.length-1,c=-1;for(s=t.length-1;s>=r;--s){let u=t.charCodeAt(s);if(or(u)){if(!o){r=s+1;break}}else c===-1&&(o=!1,c=s+1),a>=0&&(u===e.charCodeAt(a)?--a===-1&&(n=s):(a=-1,n=c))}return r===n?n=c:n===-1&&(n=t.length),t.slice(r,n)}for(s=t.length-1;s>=r;--s)if(or(t.charCodeAt(s))){if(!o){r=s+1;break}}else n===-1&&(o=!1,n=s+1);return n===-1?"":t.slice(r,n)},extname(t){wi(t,"path");let e=0,r=-1,n=0,o=-1,s=!0,a=0;t.length>=2&&t.charCodeAt(1)===Xh&&Jh(t.charCodeAt(0))&&(e=n=2);for(let c=t.length-1;c>=e;--c){let u=t.charCodeAt(c);if(or(u)){if(!s){n=c+1;break}continue}o===-1&&(s=!1,o=c+1),u===Zh?r===-1?r=c:a!==1&&(a=1):r!==-1&&(a=-1)}return r===-1||o===-1||a===0||a===1&&r===o-1&&r===n+1?"":t.slice(r,o)},format:Mse.bind(null,"\\"),parse(t){wi(t,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;let r=t.length,n=0,o=t.charCodeAt(0);if(r===1)return or(o)?(e.root=e.dir=t,e):(e.base=e.name=t,e);if(or(o)){if(n=1,or(t.charCodeAt(1))){let p=2,f=p;for(;p<r&&!or(t.charCodeAt(p));)p++;if(p<r&&p!==f){for(f=p;p<r&&or(t.charCodeAt(p));)p++;if(p<r&&p!==f){for(f=p;p<r&&!or(t.charCodeAt(p));)p++;p===r?n=p:p!==f&&(n=p+1)}}}}else if(Jh(o)&&t.charCodeAt(1)===Xh){if(r<=2)return e.root=e.dir=t,e;if(n=2,or(t.charCodeAt(2))){if(r===3)return e.root=e.dir=t,e;n=3}}n>0&&(e.root=t.slice(0,n));let s=-1,a=n,c=-1,u=!0,l=t.length-1,d=0;for(;l>=n;--l){if(o=t.charCodeAt(l),or(o)){if(!u){a=l+1;break}continue}c===-1&&(u=!1,c=l+1),o===Zh?s===-1?s=l:d!==1&&(d=1):s!==-1&&(d=-1)}return c!==-1&&(s===-1||d===0||d===1&&s===c-1&&s===a+1?e.base=e.name=t.slice(a,c):(e.name=t.slice(a,s),e.base=t.slice(a,c),e.ext=t.slice(s,c))),a>0&&a!==n?e.dir=t.slice(0,a-1):e.dir=e.root,e},sep:"\\",delimiter:";",win32:null,posix:null};var A5e=(()=>{if($a){let t=/\\/g;return()=>{let e=cS.cwd().replace(t,"/");return e.slice(e.indexOf("/"))}}return()=>cS.cwd()})();at.posix={resolve(...t){let e="",r=!1;for(let n=t.length-1;n>=-1&&!r;n--){let o=n>=0?t[n]:A5e();wi(o,"path"),o.length!==0&&(e=`${o}/${e}`,r=o.charCodeAt(0)===jo)}return e=OL(e,!r,"/",Bj),r?`/${e}`:e.length>0?e:"."},normalize(t){if(wi(t,"path"),t.length===0)return".";let e=t.charCodeAt(0)===jo,r=t.charCodeAt(t.length-1)===jo;return t=OL(t,!e,"/",Bj),t.length===0?e?"/":r?"./":".":(r&&(t+="/"),e?`/${t}`:t)},isAbsolute(t){return wi(t,"path"),t.length>0&&t.charCodeAt(0)===jo},join(...t){if(t.length===0)return".";let e;for(let r=0;r<t.length;++r){let n=t[r];wi(n,"path"),n.length>0&&(e===void 0?e=n:e+=`/${n}`)}return e===void 0?".":at.posix.normalize(e)},relative(t,e){if(wi(t,"from"),wi(e,"to"),t===e||(t=at.posix.resolve(t),e=at.posix.resolve(e),t===e))return"";let r=1,n=t.length,o=n-r,s=1,a=e.length-s,c=o<a?o:a,u=-1,l=0;for(;l<c;l++){let p=t.charCodeAt(r+l);if(p!==e.charCodeAt(s+l))break;p===jo&&(u=l)}if(l===c)if(a>c){if(e.charCodeAt(s+l)===jo)return e.slice(s+l+1);if(l===0)return e.slice(s+l)}else o>c&&(t.charCodeAt(r+l)===jo?u=l:l===0&&(u=0));let d="";for(l=r+u+1;l<=n;++l)(l===n||t.charCodeAt(l)===jo)&&(d+=d.length===0?"..":"/..");return`${d}${e.slice(s+u)}`},toNamespacedPath(t){return t},dirname(t){if(wi(t,"path"),t.length===0)return".";let e=t.charCodeAt(0)===jo,r=-1,n=!0;for(let o=t.length-1;o>=1;--o)if(t.charCodeAt(o)===jo){if(!n){r=o;break}}else n=!1;return r===-1?e?"/":".":e&&r===1?"//":t.slice(0,r)},basename(t,e){e!==void 0&&wi(e,"ext"),wi(t,"path");let r=0,n=-1,o=!0,s;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e===t)return"";let a=e.length-1,c=-1;for(s=t.length-1;s>=0;--s){let u=t.charCodeAt(s);if(u===jo){if(!o){r=s+1;break}}else c===-1&&(o=!1,c=s+1),a>=0&&(u===e.charCodeAt(a)?--a===-1&&(n=s):(a=-1,n=c))}return r===n?n=c:n===-1&&(n=t.length),t.slice(r,n)}for(s=t.length-1;s>=0;--s)if(t.charCodeAt(s)===jo){if(!o){r=s+1;break}}else n===-1&&(o=!1,n=s+1);return n===-1?"":t.slice(r,n)},extname(t){wi(t,"path");let e=-1,r=0,n=-1,o=!0,s=0;for(let a=t.length-1;a>=0;--a){let c=t.charCodeAt(a);if(c===jo){if(!o){r=a+1;break}continue}n===-1&&(o=!1,n=a+1),c===Zh?e===-1?e=a:s!==1&&(s=1):e!==-1&&(s=-1)}return e===-1||n===-1||s===0||s===1&&e===n-1&&e===r+1?"":t.slice(e,n)},format:Mse.bind(null,"/"),parse(t){wi(t,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;let r=t.charCodeAt(0)===jo,n;r?(e.root="/",n=1):n=0;let o=-1,s=0,a=-1,c=!0,u=t.length-1,l=0;for(;u>=n;--u){let d=t.charCodeAt(u);if(d===jo){if(!c){s=u+1;break}continue}a===-1&&(c=!1,a=u+1),d===Zh?o===-1?o=u:l!==1&&(l=1):o!==-1&&(l=-1)}if(a!==-1){let d=s===0&&r?1:s;o===-1||l===0||l===1&&o===a-1&&o===s+1?e.base=e.name=t.slice(d,a):(e.name=t.slice(d,o),e.base=t.slice(d,a),e.ext=t.slice(o,a))}return s>0?e.dir=t.slice(0,s-1):r&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};at.posix.win32=at.win32.win32=at.win32;at.posix.posix=at.win32.posix=at.posix;at.normalize=$a?at.win32.normalize:at.posix.normalize;at.isAbsolute=$a?at.win32.isAbsolute:at.posix.isAbsolute;at.join=$a?at.win32.join:at.posix.join;at.resolve=$a?at.win32.resolve:at.posix.resolve;at.relative=$a?at.win32.relative:at.posix.relative;at.dirname=$a?at.win32.dirname:at.posix.dirname;at.basename=$a?at.win32.basename:at.posix.basename;at.extname=$a?at.win32.extname:at.posix.extname;at.format=$a?at.win32.format:at.posix.format;at.parse=$a?at.win32.parse:at.posix.parse;at.toNamespacedPath=$a?at.win32.toNamespacedPath:at.posix.toNamespacedPath;at.sep=$a?at.win32.sep:at.posix.sep;at.delimiter=$a?at.win32.delimiter:at.posix.delimiter});var Gse=O(tg=>{"use strict";Object.defineProperty(tg,"__esModule",{value:!0});tg.uriToFsPath=tg.isUriComponents=tg.URI=void 0;var Use=Fse(),FL=Fj(),D5e=/^\w[\w\d+.-]*$/,N5e=/^\//,L5e=/^\/\//;function O5e(t,e){if(!t.scheme&&e)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${t.authority}", path: "${t.path}", query: "${t.query}", fragment: "${t.fragment}"}`);if(t.scheme&&!D5e.test(t.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(t.path){if(t.authority){if(!N5e.test(t.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(L5e.test(t.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}function M5e(t,e){return!t&&!e?"file":t}function F5e(t,e){switch(t){case"https":case"http":case"file":e?e[0]!==wl&&(e=wl+e):e=wl;break}return e}var En="",wl="/",U5e=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,UL=class t{static isUri(e){return e instanceof t?!0:e?typeof e.authority=="string"&&typeof e.fragment=="string"&&typeof e.path=="string"&&typeof e.query=="string"&&typeof e.scheme=="string"&&typeof e.fsPath=="string"&&typeof e.with=="function"&&typeof e.toString=="function":!1}constructor(e,r,n,o,s,a=!1){typeof e=="object"?(this.scheme=e.scheme||En,this.authority=e.authority||En,this.path=e.path||En,this.query=e.query||En,this.fragment=e.fragment||En):(this.scheme=M5e(e,a),this.authority=r||En,this.path=F5e(this.scheme,n||En),this.query=o||En,this.fragment=s||En,O5e(this,a))}get fsPath(){return BL(this,!1)}with(e){if(!e)return this;let{scheme:r,authority:n,path:o,query:s,fragment:a}=e;return r===void 0?r=this.scheme:r===null&&(r=En),n===void 0?n=this.authority:n===null&&(n=En),o===void 0?o=this.path:o===null&&(o=En),s===void 0?s=this.query:s===null&&(s=En),a===void 0?a=this.fragment:a===null&&(a=En),r===this.scheme&&n===this.authority&&o===this.path&&s===this.query&&a===this.fragment?this:new eg(r,n,o,s,a)}static parse(e,r=!1){let n=U5e.exec(e);return n?new eg(n[2]||En,ML(n[4]||En),ML(n[5]||En),ML(n[7]||En),ML(n[9]||En),r):new eg(En,En,En,En,En)}static file(e){let r=En;if(FL.isWindows&&(e=e.replace(/\\/g,wl)),e[0]===wl&&e[1]===wl){let n=e.indexOf(wl,2);n===-1?(r=e.substring(2),e=wl):(r=e.substring(2,n),e=e.substring(n)||wl)}return new eg("file",r,e,En,En)}static from(e,r){return new eg(e.scheme,e.authority,e.path,e.query,e.fragment,r)}static joinPath(e,...r){if(!e.path)throw new Error("[UriError]: cannot call joinPath on URI without path");let n;return FL.isWindows&&e.scheme==="file"?n=t.file(Use.win32.join(BL(e,!0),...r)).path:n=Use.posix.join(e.path,...r),e.with({path:n})}toString(e=!1){return qj(this,e)}toJSON(){return this}static revive(e){if(e){if(e instanceof t)return e;{let r=new eg(e);return r._formatted=e.external??null,r._fsPath=e._sep===jse?e.fsPath??null:null,r}}else return e}};tg.URI=UL;function B5e(t){return!t||typeof t!="object"?!1:typeof t.scheme=="string"&&(typeof t.authority=="string"||typeof t.authority>"u")&&(typeof t.path=="string"||typeof t.path>"u")&&(typeof t.query=="string"||typeof t.query>"u")&&(typeof t.fragment=="string"||typeof t.fragment>"u")}tg.isUriComponents=B5e;var jse=FL.isWindows?1:void 0,eg=class extends UL{constructor(){super(...arguments),this._formatted=null,this._fsPath=null}get fsPath(){return this._fsPath||(this._fsPath=BL(this,!1)),this._fsPath}toString(e=!1){return e?qj(this,!0):(this._formatted||(this._formatted=qj(this,!1)),this._formatted)}toJSON(){let e={$mid:1};return this._fsPath&&(e.fsPath=this._fsPath,e._sep=jse),this._formatted&&(e.external=this._formatted),this.path&&(e.path=this.path),this.scheme&&(e.scheme=this.scheme),this.authority&&(e.authority=this.authority),this.query&&(e.query=this.query),this.fragment&&(e.fragment=this.fragment),e}},Hse={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function Bse(t,e,r){let n,o=-1;for(let s=0;s<t.length;s++){let a=t.charCodeAt(s);if(a>=97&&a<=122||a>=65&&a<=90||a>=48&&a<=57||a===45||a===46||a===95||a===126||e&&a===47||r&&a===91||r&&a===93||r&&a===58)o!==-1&&(n+=encodeURIComponent(t.substring(o,s)),o=-1),n!==void 0&&(n+=t.charAt(s));else{n===void 0&&(n=t.substr(0,s));let c=Hse[a];c!==void 0?(o!==-1&&(n+=encodeURIComponent(t.substring(o,s)),o=-1),n+=c):o===-1&&(o=s)}}return o!==-1&&(n+=encodeURIComponent(t.substring(o))),n!==void 0?n:t}function q5e(t){let e;for(let r=0;r<t.length;r++){let n=t.charCodeAt(r);n===35||n===63?(e===void 0&&(e=t.substr(0,r)),e+=Hse[n]):e!==void 0&&(e+=t[r])}return e!==void 0?e:t}function BL(t,e){let r;return t.authority&&t.path.length>1&&t.scheme==="file"?r=`//${t.authority}${t.path}`:t.path.charCodeAt(0)===47&&(t.path.charCodeAt(1)>=65&&t.path.charCodeAt(1)<=90||t.path.charCodeAt(1)>=97&&t.path.charCodeAt(1)<=122)&&t.path.charCodeAt(2)===58?e?r=t.path.substr(1):r=t.path[1].toLowerCase()+t.path.substr(2):r=t.path,FL.isWindows&&(r=r.replace(/\//g,"\\")),r}tg.uriToFsPath=BL;function qj(t,e){let r=e?q5e:Bse,n="",{scheme:o,authority:s,path:a,query:c,fragment:u}=t;if(o&&(n+=o,n+=":"),(s||o==="file")&&(n+=wl,n+=wl),s){let l=s.indexOf("@");if(l!==-1){let d=s.substr(0,l);s=s.substr(l+1),l=d.lastIndexOf(":"),l===-1?n+=r(d,!1,!1):(n+=r(d.substr(0,l),!1,!1),n+=":",n+=r(d.substr(l+1),!1,!0)),n+="@"}s=s.toLowerCase(),l=s.lastIndexOf(":"),l===-1?n+=r(s,!1,!0):(n+=r(s.substr(0,l),!1,!0),n+=s.substr(l))}if(a){if(a.length>=3&&a.charCodeAt(0)===47&&a.charCodeAt(2)===58){let l=a.charCodeAt(1);l>=65&&l<=90&&(a=`/${String.fromCharCode(l+32)}:${a.substr(3)}`)}else if(a.length>=2&&a.charCodeAt(1)===58){let l=a.charCodeAt(0);l>=65&&l<=90&&(a=`${String.fromCharCode(l+32)}:${a.substr(2)}`)}n+=r(a,!0,!1)}return c&&(n+="?",n+=r(c,!1,!1)),u&&(n+="#",n+=e?u:Bse(u,!1,!1)),n}function Vse(t){try{return decodeURIComponent(t)}catch{return t.length>3?t.substr(0,3)+Vse(t.substr(3)):t}}var qse=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function ML(t){return t.match(qse)?t.replace(qse,e=>Vse(e)):t}});var Vj=O(rg=>{"use strict";Object.defineProperty(rg,"__esModule",{value:!0});rg.PromptReference=rg.ChatResponseReferencePartStatusKind=rg.PromptMetadata=void 0;var zR=Gse(),jj=class{toString(){return Object.getPrototypeOf(this).constructor.name}};rg.PromptMetadata=jj;var zse;(function(t){t[t.Complete=1]="Complete",t[t.Partial=2]="Partial",t[t.Omitted=3]="Omitted"})(zse||(rg.ChatResponseReferencePartStatusKind=zse={}));var Hj=class t{static fromJSON(e){let r=n=>"scheme"in n?zR.URI.from(n):{uri:zR.URI.from(n.uri),range:n.range};return new t("variableName"in e.anchor?{variableName:e.anchor.variableName,value:e.anchor.value&&r(e.anchor.value)}:r(e.anchor),e.iconPath&&("scheme"in e.iconPath?zR.URI.from(e.iconPath):"light"in e.iconPath?{light:zR.URI.from(e.iconPath.light),dark:zR.URI.from(e.iconPath.dark)}:e.iconPath),e.options)}constructor(e,r,n){this.anchor=e,this.iconPath=r,this.options=n}toJSON(){return{anchor:this.anchor,iconPath:this.iconPath,options:this.options}}};rg.PromptReference=Hj});var $se=O(qL=>{"use strict";Object.defineProperty(qL,"__esModule",{value:!0});qL.coalesce=void 0;function j5e(t){return t.filter(e=>!!e)}qL.coalesce=j5e});var Qj=O(lS=>{"use strict";Object.defineProperty(lS,"__esModule",{value:!0});lS.PromptRenderer=lS.MetadataMap=void 0;var jL=aS(),ng=Nj(),Kse=Vj(),$R=$se(),Wse;(function(t){t.empty={get:()=>{}}})(Wse||(lS.MetadataMap=Wse={}));var Gj=class{constructor(e,r,n,o){this._endpoint=e,this._ctor=r,this._props=n,this._tokenizer=o,this._meta=new Map,this._usedContext=[],this._ignoredFiles=[],this._root=new Yj(null,0),this._references=[]}getAllMeta(){let e=this._meta;return{get(r){return e.get(r)}}}getIgnoredFiles(){return Array.from(new Set(this._ignoredFiles))}getMeta(e){return this._meta.get(e)}getUsedContext(){return this._usedContext}createElement(e){return new e.ctor(e.props)}async _processPromptPieces(e,r,n,o){let s=new Map;for(let[u,l]of r.entries()){if(Array.isArray(l.children)&&(l.props=l.props??{},l.props.children=l.children),!l.ctor)throw new Error("Invalid ChatMessage child! Child must be a TSX component that extends PromptElement.");let d=this.createElement(l);l.node.setObj(d);let p=l.props.flexGrow??1/0,f=s.get(p);f||(f=[],s.set(p,f)),f.push({element:l,promptElementInstance:d})}let a=[...s.entries()].sort(([u],[l])=>l-u).map(([u,l])=>l),c=(u,l)=>{let d=l?1:-1;for(let p=u+1;p<a.length;p++)for(let{element:f}of a[p])f.props.flexReserve&&e.consume(d*f.props.flexReserve)};for(let[u,l]of a.entries()){c(u,!0);let d=0;for(let{element:m}of l)d+=(m.props.flex||m.props.flexBasis)??1;let p=l.map(m=>{let h=(m.element.props.flexBasis??1)/d;return{tokenBudget:Math.floor(e.remainingTokenBudget*h),endpoint:e.endpoint,countTokens:(g,v)=>this._tokenizer.tokenLength(g,v)}});c(u,!1),await Promise.all(l.map(async({element:m,promptElementInstance:h},g)=>{let v=await h.prepare?.(p[g],n,o);m.node.setState(v)}));let f=await Promise.all(l.map(async({element:m,promptElementInstance:h},g)=>{let v=p[g];return await h.render(m.node.getState(),v)}));for(let[m,{element:h,promptElementInstance:g}]of l.entries()){let v=p[m],y=f[m];if(!y)continue;let _=Yse(y),x=new WR(v.tokenBudget,this._endpoint),{tokensConsumed:S}=await H5e(this._tokenizer,h,g,_);x.consume(S),await this._handlePromptChildren(h,_,x,n,o),e.consume(x.consumed)}}}async _prioritize(e,r,n){let o=[],s=[],a=0;for(;a<e.length;){if(!e[a].isImplicitLinebreak){let l=e[a-1]?.isImplicitLinebreak?{index:a,precedingLinebreak:a-1}:{index:a};o.push(l),s[a]=null}a+=1}o.sort((l,d)=>r(e[l.index],e[d.index]));let c=this._endpoint.modelMaxPromptTokens,u=[];for(;o.length>0;){let l=o.shift(),d=l.index,p=e[d],f=await n(p),m;if(l.precedingLinebreak&&(m=e[l.precedingLinebreak],f+=await n(m)),f>c){u.push(p);break}s[d]=p,l.precedingLinebreak&&m&&(s[l.precedingLinebreak]=m),c-=f}for(let l of o){let d=l.index,p=e[d];u.push(p)}return{result:(0,$R.coalesce)(s),tokenCount:this._endpoint.modelMaxPromptTokens-c,omittedChunks:u}}async renderElementJSON(e){return await this._processPromptPieces(new WR(this._endpoint.modelMaxPromptTokens,this._endpoint),[{node:this._root,ctor:this._ctor,props:this._props,children:[]}],void 0,e),{node:this._root.toJSON()}}async render(e,r){await this._processPromptPieces(new WR(this._endpoint.modelMaxPromptTokens,this._endpoint),[{node:this._root,ctor:this._ctor,props:this._props,children:[]}],e,r);let{result:n,resultChunks:o}=this._root.materialize(),s=new Set,{result:a,omittedChunks:c}=await this._prioritize(o,(v,y)=>uS.cmp(v,y),async v=>{let y=await this._tokenizer.tokenLength(v.text);return s.has(v.message)||(s.add(v.message),y=await this._tokenizer.countMessageTokens(v.toChatMessage())),y}),u=new Map;for(let v of(0,$R.coalesce)(a)){let y=u.get(v.message)??[];y[v.childIndex]=v,u.set(v.message,y)}let l=[];for(let v of n){let y=u.get(v);if(y){v.chunks=(0,$R.coalesce)(y);for(let _ of y)_&&_.references.length>0&&v.references.push(..._.references);l.push(v)}}let{result:d,tokenCount:p}=await this._prioritize(l,(v,y)=>HL.cmp(v,y),async v=>this._tokenizer.countMessageTokens(v.toChatMessage())),f=d.map(v=>v?.toChatMessage()),{references:m,names:h}=d.reduce((v,y)=>([...this._references,...y.references].forEach(_=>{let x="variableName"in _.anchor;x&&!v.names.has(_.anchor.variableName)?(v.references.push(_),v.names.add(_.anchor.variableName)):x||v.references.push(_)}),v),{references:[],names:new Set}),{references:g}=c.reduce((v,y)=>(y.references.forEach(_=>{let x="variableName"in _.anchor;x&&!h.has(_.anchor.variableName)?(v.references.push(_),h.add(_.anchor.variableName)):x||v.references.push(_)}),v),{references:[]});return{messages:f,hasIgnoredFiles:this._ignoredFiles.length>0,tokenCount:p,references:(0,$R.coalesce)(m),omittedReferences:(0,$R.coalesce)(g)}}_handlePromptChildren(e,r,n,o,s){if(e.ctor===ng.TextChunk){this._handleExtrinsicTextChunkChildren(e.node.parent,e.node,e.props,r);return}let a=[];for(let c of r){if(c.kind==="literal"){e.node.appendStringChild(c.value,e.props.priority??Number.MAX_SAFE_INTEGER);continue}if(c.kind==="intrinsic"){this._handleIntrinsic(e.node,c.name,{priority:e.props.priority??Number.MAX_SAFE_INTEGER,...c.props},zj(c.children));continue}let u=e.node.createChild();a.push({node:u,ctor:c.ctor,props:{priority:e.props.priority,...c.props},children:c.children})}return this._processPromptPieces(n,a,o,s)}_handleIntrinsic(e,r,n,o,s){switch(r){case"meta":return this._handleIntrinsicMeta(e,n,o);case"br":return this._handleIntrinsicLineBreak(e,n,o,n.priority,s);case"usedContext":return this._handleIntrinsicUsedContext(e,n,o);case"references":return this._handleIntrinsicReferences(e,n,o);case"ignoredFiles":return this._handleIntrinsicIgnoredFiles(e,n,o);case"elementJSON":return this._handleIntrinsicElementJSON(e,n.data)}throw new Error(`Unknown intrinsic element ${r}!`)}_handleIntrinsicMeta(e,r,n){if(n.length>0)throw new Error("<meta /> must not have children!");let o=Object.getPrototypeOf(r.value).constructor;if(this._meta.has(o))throw new Error(`Duplicate metadata ${o.name}!`);this._meta.set(o,r.value)}_handleIntrinsicLineBreak(e,r,n,o,s){if(n.length>0)throw new Error("<br /> must not have children!");e.appendLineBreak(!0,o??Number.MAX_SAFE_INTEGER,s)}_handleIntrinsicElementJSON(e,r){e.appendPieceJSON(r.node)}_handleIntrinsicUsedContext(e,r,n){if(n.length>0)throw new Error("<usedContext /> must not have children!");this._usedContext.push(...r.value)}_handleIntrinsicReferences(e,r,n){if(n.length>0)throw new Error("<reference /> must not have children!");e.addReferences(r.value),this._references.push(...r.value)}_handleIntrinsicIgnoredFiles(e,r,n){if(n.length>0)throw new Error("<ignoredFiles /> must not have children!");this._ignoredFiles.push(...r.value)}_handleExtrinsicTextChunkChildren(e,r,n,o){let s=[],a=[];for(let c of o){if(c.kind==="extrinsic")throw new Error("TextChunk cannot have extrinsic children!");c.kind==="literal"&&s.push(c.value),c.kind==="intrinsic"&&(c.name==="br"?s.push(`
`):c.name==="references"?a.push(...c.props.value):this._handleIntrinsic(e,c.name,c.props,zj(c.children),r.childIndex))}e.appendLineBreak(!1,void 0,r.childIndex),e.appendStringChild(s.join(""),n?.priority??Number.MAX_SAFE_INTEGER,a,r.childIndex)}};lS.PromptRenderer=Gj;async function H5e(t,e,r,n){let o=0;if((0,ng.isChatMessagePromptElement)(r)){o+=await t.countMessageTokens({role:e.props.role,content:"",...e.props.name?{name:e.props.name}:void 0});for(let s of n)s.kind==="literal"&&(o+=await t.tokenLength(s.value))}return{tokensConsumed:o}}function Yse(t){return typeof t>"u"||typeof t=="boolean"?[]:typeof t=="string"||typeof t=="number"?[new Kj(String(t))]:V5e(t)?[...zj(t.children)]:typeof t.ctor=="string"?[new $j(t.ctor,t.props,t.children)]:[new Wj(t.ctor,t.props,t.children)]}function zj(t){return(t??[]).reduce((e,r)=>(e.push(...Yse(r)),e),[])}var $j=class{constructor(e,r,n){this.name=e,this.props=r,this.children=n,this.kind="intrinsic"}},Wj=class{constructor(e,r,n){this.ctor=e,this.props=r,this.children=n,this.kind="extrinsic"}},Kj=class{constructor(e,r){this.value=e,this.priority=r,this.kind="literal"}},WR=class{constructor(e,r){this.tokenBudget=e,this.endpoint=r,this._consumed=0}get consumed(){return this._consumed>this.tokenBudget?this.tokenBudget:this._consumed}get remainingTokenBudget(){return Math.max(0,this.tokenBudget-this._consumed)}consume(e){this._consumed+=e}},Yj=class t{static fromJSON(e,r){let n=new t(null,e);switch(n._references=r.references?.map(o=>Kse.PromptReference.fromJSON(o))??[],n._children=r.children.map((o,s)=>{switch(o.type){case 1:return t.fromJSON(s,o);case 2:return VL.fromJSON(n,s,o);case 3:return KR.fromJSON(n,s,o);default:}}).filter(G5e),r.ctor){case 1:n._obj=new ng.BaseChatMessage(r.props);break;case 2:break;default:r.ctor}return n}constructor(e=null,r){this.parent=e,this.childIndex=r,this.kind=1,this._obj=null,this._state=void 0,this._children=[],this._references=[]}setObj(e){this._obj=e}setState(e){this._state=e}getState(){return this._state}createChild(){let e=new t(this,this._children.length);return this._children.push(e),e}appendPieceJSON(e){let r=t.fromJSON(this._children.length,e);return this._children.push(r),r}appendStringChild(e,r,n,o=this._children.length){this._children.push(new VL(this,o,e,r,n))}appendLineBreak(e=!0,r,n=this._children.length){this._children.push(new KR(this,n,e,r))}materialize(){let e=[],r=[];return this._materialize(e,r),{result:e,resultChunks:r}}toJSON(){let e={type:1,ctor:2,children:this._children.slice().sort((r,n)=>r.childIndex-n.childIndex).map(r=>r.toJSON()),priority:this._obj?.props.priority,references:this._references?.map(r=>r.toJSON())};return this._obj instanceof ng.BaseChatMessage&&(e.ctor=1,e.props={role:this._obj.props.role,name:this._obj.props.name,priority:this._obj.props.priority,toolCalls:this._obj.props.toolCalls,toolCallId:this._obj.props.toolCallId}),e}_materialize(e,r){if(this._children.sort((n,o)=>n.childIndex-o.childIndex),this._obj instanceof ng.BaseChatMessage){if(!this._obj.props.role)throw new Error("Invalid ChatMessage!");let n=[];for(let c of this._children)c.collectLeafs(n);let o=[],s=new HL(this._obj.props.role,this._obj.props.name,this._obj instanceof ng.AssistantMessage?this._obj.props.toolCalls:void 0,this._obj instanceof ng.ToolMessage?this._obj.props.toolCallId:void 0,this._obj.props.priority,this.childIndex,o),a=r.length;n.forEach((c,u)=>{c.kind===2?o.push(new uS(s,c.text,c.priority,a++,!1,c.references??this._references)):c.isExplicit?o.push(new uS(s,`
`,c.priority,a++)):(o.length>0&&o[o.length-1].text!==`
`||o[u-1]&&o[u-1].text!==`
`)&&o.push(new uS(s,`
`,c.priority,a++,!0))}),r.push(...o),e.push(s)}else for(let n of this._children){if(n.kind===2)throw new Error(`Cannot have a text node outside a ChatMessage. Text: "${n.text}"`);if(n.kind===3)throw new Error("Cannot have a line break node outside a ChatMessage!");n._materialize(e,r)}}collectLeafs(e){if(this._obj instanceof ng.BaseChatMessage)throw new Error("Cannot have a ChatMessage nested inside a ChatMessage!");this._obj?.insertLineBreakBefore&&e.push(new KR(this,0,!1));for(let r of this._children)r.collectLeafs(e)}addReferences(e){this._references.push(...e)}},uS=class{constructor(e,r,n,o,s=!1,a=[]){this.message=e,this.text=r,this.priority=n,this.childIndex=o,this.isImplicitLinebreak=s,this.references=a}static cmp(e,r){return e.priority!==void 0&&r.priority!==void 0&&e.priority===r.priority?e.message===r.message?e.childIndex-r.childIndex:r.childIndex-e.childIndex:e.priority!==void 0&&r.priority!==void 0&&e.priority!==r.priority?r.priority-e.priority:e.childIndex-r.childIndex}toChatMessage(){let e=this.message.toChatMessage();return e.content=this.text,e}},HL=class{constructor(e,r,n,o,s,a,c,u=[]){this.role=e,this.name=r,this.toolCalls=n,this.toolCallId=o,this.priority=s,this.childIndex=a,this._chunks=c,this.references=u}set chunks(e){this._chunks=e}get text(){return this._chunks.reduce((e,r,n)=>((n!==this._chunks.length-1||!r.isImplicitLinebreak)&&(e+=r.text),e),"")}toChatMessage(){return this.role===jL.ChatRole.System?{role:this.role,content:this.text,...this.name?{name:this.name}:{}}:this.role===jL.ChatRole.Assistant?{role:this.role,content:this.text,...this.toolCalls?{tool_calls:this.toolCalls}:{},...this.name?{name:this.name}:{}}:this.role===jL.ChatRole.User?{role:this.role,content:this.text,...this.name?{name:this.name}:{}}:this.role===jL.ChatRole.Tool?{role:this.role,content:this.text,tool_call_id:this.toolCallId}:{role:this.role,content:this.text,name:this.name}}static cmp(e,r){return e.priority!==r.priority?(r.priority||0)-(e.priority||0):r.childIndex-e.childIndex}},VL=class t{static fromJSON(e,r,n){return new t(e,r,n.text,n.priority,n.references?.map(o=>Kse.PromptReference.fromJSON(o)))}constructor(e,r,n,o,s){this.parent=e,this.childIndex=r,this.text=n,this.priority=o,this.references=s,this.kind=2}collectLeafs(e){e.push(this)}toJSON(){return{type:2,priority:this.priority,text:this.text,references:this.references?.map(e=>e.toJSON())}}},KR=class t{static fromJSON(e,r,n){return new t(e,r,n.isExplicit,n.priority)}constructor(e,r,n,o){this.parent=e,this.childIndex=r,this.isExplicit=n,this.priority=o,this.kind=3}collectLeafs(e){e.push(this)}toJSON(){return{type:3,isExplicit:this.isExplicit,priority:this.priority}}};function V5e(t){return(typeof t.ctor=="function"&&t.ctor.isFragment)??!1}function G5e(t){return t!==void 0}});var Qse=O(GL=>{"use strict";Object.defineProperty(GL,"__esModule",{value:!0});GL.AnyTokenizer=void 0;var YR=aS(),Xj=class{constructor(e){this.countTokens=e}async tokenLength(e,r){return this.countTokens(e,r)}async countMessageTokens(e){return this.countTokens({role:this.toChatRole(e.role),content:e.content,content2:[e.content],name:"name"in e?e.name:void 0})}toChatRole(e){switch(e){case YR.ChatRole.User:return 1;case YR.ChatRole.Assistant:return 2;case YR.ChatRole.System:return 1;case YR.ChatRole.Function:return 1;case YR.ChatRole.Tool:return 1}}};GL.AnyTokenizer=Xj});var Jse=O(Xse=>{"use strict";Object.defineProperty(Xse,"__esModule",{value:!0})});var eae=O(Zse=>{"use strict";Object.defineProperty(Zse,"__esModule",{value:!0})});var nt=O(dr=>{"use strict";var z5e=dr&&dr.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(e,r);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,o)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Jj=dr&&dr.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&z5e(e,t,r)};Object.defineProperty(dr,"__esModule",{value:!0});dr.toVsCodeChatMessages=dr.renderElementJSON=dr.contentType=dr.renderPrompt=dr.PromptRenderer=dr.MetadataMap=dr.PromptElement=dr.UserMessage=dr.TextChunk=dr.SystemMessage=dr.PrioritizedList=dr.FunctionMessage=dr.AssistantMessage=dr.ChatRole=dr.JSONTree=void 0;var zL=aS(),tae=Qj(),$5e=Qse();dr.JSONTree=Tj();var W5e=aS();Object.defineProperty(dr,"ChatRole",{enumerable:!0,get:function(){return W5e.ChatRole}});Jj(Vj(),dr);Jj(Jse(),dr);Jj(eae(),dr);var dS=Nj();Object.defineProperty(dr,"AssistantMessage",{enumerable:!0,get:function(){return dS.AssistantMessage}});Object.defineProperty(dr,"FunctionMessage",{enumerable:!0,get:function(){return dS.FunctionMessage}});Object.defineProperty(dr,"PrioritizedList",{enumerable:!0,get:function(){return dS.PrioritizedList}});Object.defineProperty(dr,"SystemMessage",{enumerable:!0,get:function(){return dS.SystemMessage}});Object.defineProperty(dr,"TextChunk",{enumerable:!0,get:function(){return dS.TextChunk}});Object.defineProperty(dr,"UserMessage",{enumerable:!0,get:function(){return dS.UserMessage}});var K5e=wj();Object.defineProperty(dr,"PromptElement",{enumerable:!0,get:function(){return K5e.PromptElement}});var rae=Qj();Object.defineProperty(dr,"MetadataMap",{enumerable:!0,get:function(){return rae.MetadataMap}});Object.defineProperty(dr,"PromptRenderer",{enumerable:!0,get:function(){return rae.PromptRenderer}});async function Y5e(t,e,r,n,o,s,a="vscode"){let c="countTokens"in n?new $5e.AnyTokenizer((h,g)=>n.countTokens(h,g)):n,u=new tae.PromptRenderer(r,t,e,c),{messages:l,tokenCount:d,references:p}=await u.render(o,s),f=u.getAllMeta(),m=u.getUsedContext();return a==="vscode"&&(l=nae(l)),{messages:l,tokenCount:d,metadatas:f,usedContext:m,references:p}}dr.renderPrompt=Y5e;dr.contentType="application/vnd.codechat.prompt+json.1";function Q5e(t,e,r,n){return new tae.PromptRenderer({modelMaxPromptTokens:r?.tokenBudget??Number.MAX_SAFE_INTEGER},t,e,{countMessageTokens(s){throw new Error("Tools may only return text, not messages.")},tokenLength(s,a){return Promise.resolve(r?.countTokens(s,a)??Promise.resolve(1))}}).renderElementJSON(n)}dr.renderElementJSON=Q5e;function nae(t){let e=require("vscode");return t.map(r=>{switch(r.role){case zL.ChatRole.Assistant:let n=e.LanguageModelChatMessage.Assistant(r.content,r.name);return r.tool_calls&&(n.content2=[r.content],n.content2.push(...r.tool_calls.map(o=>new e.LanguageModelChatResponseToolCallPart(o.function.name,o.function.arguments,o.id)))),n;case zL.ChatRole.User:return e.LanguageModelChatMessage.User(r.content,r.name);case zL.ChatRole.Function:{let o=e.LanguageModelChatMessage.User("");return o.content2=[new e.LanguageModelChatMessageFunctionResultPart(r.name,r.content)],o}case zL.ChatRole.Tool:{let o=e.LanguageModelChatMessage.User(r.content);return o.content2=[new e.LanguageModelChatMessageFunctionResultPart(r.tool_call_id,r.content)],o}default:throw new Error(`Converting chat message with role ${r.role} to VS Code chat message is not supported.`)}})}dr.toVsCodeChatMessages=nae});var iae=O(Ld=>{"use strict";Object.defineProperty(Ld,"__esModule",{value:!0});Ld.bytePairEncode=Ld.BinaryMap=Ld.binaryMapKey=void 0;var X5e=(t,e,r)=>{let n=r-e,o=16777215>>>Math.max(0,(3-n)*8),s=(t[e+0]|t[e+1]<<8|t[e+2]<<16)&o,a=16777215>>>Math.min(31,Math.max(0,(6-n)*8)),c=(t[e+3]|t[e+4]<<8|t[e+5]<<16)&a;return s+16777216*c};Ld.binaryMapKey=X5e;var Zj=class t{constructor(){this.nested=new Map,this.final=new Map}get(e,r=0,n=e.length){let o=n<6+r,s=(0,Ld.binaryMapKey)(e,r,n);return o?this.final.get(s):this.nested.get(s)?.get(e,6+r,n)}set(e,r){let n=(0,Ld.binaryMapKey)(e,0,e.length);if(e.length<6){this.final.set(n,r);return}let s=this.nested.get(n);if(s instanceof t)s.set(e.subarray(6),r);else{let a=new t;a.set(e.subarray(6),r),this.nested.set(n,a)}}};Ld.BinaryMap=Zj;var Nd=new Int32Array(128),fa=new Int32Array(128);function J5e(t,e,r){if(r===1)return[e.get(t)];let n=2147483647,o=-1;for(;Nd.length<r*2;)fa=new Int32Array(fa.length*2),Nd=new Int32Array(Nd.length*2);for(let u=0;u<r-1;u++){let l=e.get(t,u,u+2)??2147483647;l<n&&(n=l,o=u),fa[u]=u,Nd[u]=l}fa[r-1]=r-1,Nd[r-1]=2147483647,fa[r]=r,Nd[r]=2147483647;let s=r+1;function a(u,l=0){if(u+l+2<s){let d=e.get(t,fa[u],fa[u+l+2]);if(d!==void 0)return d}return 2147483647}for(;n!==2147483647;){Nd[fa[o]]=a(o,1),o>0&&(Nd[fa[o-1]]=a(o-1,1));for(let u=o+1;u<s-1;u++)fa[u]=fa[u+1];s--,o=-1,n=2147483647;for(let u=0;u<s-1;u++){let l=Nd[fa[u]];Nd[fa[u]]<n&&(n=l,o=u)}}let c=[];for(let u=0;u<s-1;u++)c.push(e.get(t,fa[u],fa[u+1]));return c}Ld.bytePairEncode=J5e});var oae=O($L=>{"use strict";Object.defineProperty($L,"__esModule",{value:!0});$L.makeTextEncoder=void 0;var eH=class{constructor(){this.length=0,this.encoder=new TextEncoder}encode(e){let r=this.encoder.encode(e);return this.length=r.length,r}},tH=class{constructor(){this.buffer=Buffer.alloc(256),this.length=0}encode(e){for(;;){if(this.length=this.buffer.write(e,"utf8"),this.length<this.buffer.length-4)return this.buffer;this.buffer=Buffer.alloc(this.length*2),this.length=this.buffer.write(e)}}},Z5e=()=>typeof Buffer<"u"?new tH:new eH;$L.makeTextEncoder=Z5e});var sae=O(WL=>{"use strict";Object.defineProperty(WL,"__esModule",{value:!0});WL.LRUCache=void 0;var rH=class{constructor(e){this.size=e,this.nodes=new Map}get(e){let r=this.nodes.get(e);if(r)return this.moveToHead(r),r.value}set(e,r){let n=this.nodes.get(e);if(n)n.value=r,this.moveToHead(n);else{let o=new nH(e,r);this.nodes.set(e,o),this.addNode(o),this.nodes.size>this.size&&(this.nodes.delete(this.tail.key),this.removeNode(this.tail))}}moveToHead(e){this.removeNode(e),this.addNode(e)}addNode(e){this.head&&(this.head.prev=e,e.next=this.head),this.tail||(this.tail=e),this.head=e}removeNode(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev}};WL.LRUCache=rH;var nH=class{constructor(e,r){this.key=e,this.value=r}}});var oH=O(YL=>{"use strict";Object.defineProperty(YL,"__esModule",{value:!0});YL.TikTokenizer=void 0;var eMe=require("fs"),tMe=require("util"),KL=iae(),rMe=oae(),nMe=sae();function iMe(t){let e=new Map;try{let n=eMe.readFileSync(t,"utf-8");return r(n),e}catch(n){throw new Error(`Failed to load from BPE encoder file stream: ${n}`)}function r(n){for(let o of n.split(/[\r\n]+/)){if(o.trim()==="")continue;let s=o.split(" ");if(s.length!==2)throw new Error("Invalid format in the BPE encoder file stream");let a=new Uint8Array(Buffer.from(s[0],"base64")),c=parseInt(s[1]);if(!isNaN(c))e.set(a,c);else throw new Error(`Can't parse ${s[1]} to integer`)}}}function oMe(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var iH=class{constructor(e,r,n,o=8192){this.textEncoder=(0,rMe.makeTextEncoder)(),this.textDecoder=new tMe.TextDecoder("utf-8"),this.cache=new nMe.LRUCache(o);let s=typeof e=="string"?iMe(e):e;this.init(s,r,n)}init(e,r,n){this.encoder=new KL.BinaryMap;for(let[o,s]of e)this.encoder.set(o,s);this.regex=new RegExp(n,"gu"),this.specialTokensRegex=new RegExp(Array.from(r.keys()).map(o=>oMe(o)).join("|")),this.specialTokensEncoder=r,this.decoder=new Map;for(let[o,s]of e)this.decoder.set(s,o);if(e.size!==this.decoder.size)throw new Error("Encoder and decoder sizes do not match");this.specialTokensDecoder=new Map;for(let[o,s]of r)this.specialTokensDecoder.set(s,o)}findNextSpecialToken(e,r,n){let o=r,s=null;if(n&&this.specialTokensRegex)for(;s=e.slice(o).match(this.specialTokensRegex),!(!s||n&&n.includes(s[0]));)o+=s.index+1;let a=s?o+s.index:e.length;return[s,a]}encode(e,r){let n=[],o=0;for(;;){let s,a;if([s,a]=this.findNextSpecialToken(e,o,r),a>o&&this.encodeByIndex(e,n,o,a),s){if(o=o+this.encodeSpecialToken(n,s),o>=e.length)break}else break}return n}encodeSpecialToken(e,r){let n=this.specialTokensEncoder?.get(r[0]);return e.push(n),r.index+r[0].length}encodeByIndex(e,r,n,o){let s,a=e.substring(n,o);for(this.regex.lastIndex=0;s=this.regex.exec(a);){let c=this.cache.get(s[0]);if(c)for(let u of c)r.push(u);else{let u=this.textEncoder.encode(s[0]),l=this.encoder.get(u,0,this.textEncoder.length);if(l!==void 0)r.push(l),this.cache.set(s[0],[l]);else{let d=(0,KL.bytePairEncode)(u,this.encoder,this.textEncoder.length);for(let p of d)r.push(p);this.cache.set(s[0],d)}}}}encodeTrimSuffixByIndex(e,r,n,o,s,a,c){let u,l=e.substring(n,o);for(this.regex.lastIndex=0;u=this.regex.exec(l);){let d=u[0],p=this.cache.get(d);if(p)if(a+p.length<=s)a+=p.length,c+=d.length,r.push(...p);else{let f=s-a;a+=f,c+=d.length,r.push(...p.slice(0,f));break}else{let f=this.textEncoder.encode(d),m=this.encoder.get(f,0,f.length);if(m!==void 0)if(this.cache.set(d,[m]),a+1<=s)a++,c+=d.length,r.push(m);else break;else{let h=(0,KL.bytePairEncode)(f,this.encoder,this.textEncoder.length);if(this.cache.set(d,h),a+h.length<=s){a+=h.length,c+=d.length;for(let g of h)r.push(g)}else{let g=s-a;a+=g,c+=d.length;for(let v=0;v<g;v++)r.push(h[v]);break}}}if(a>=s)break}return{tokenCount:a,encodeLength:c}}encodeTrimSuffix(e,r,n){let o=[],s=0,a=0,c=0;for(;;){let l,d;if([l,d]=this.findNextSpecialToken(e,s,n),d>s){let{tokenCount:p,encodeLength:f}=this.encodeTrimSuffixByIndex(e,o,s,d,r,a,c);if(a=p,c=f,a>=r)break}if(l!==null){if(a++,a<=r&&(s=s+this.encodeSpecialToken(o,l),c+=l[0].length,s>=e.length)||a>=r)break}else break}let u=c===e.length?e:e.slice(0,c);return{tokenIds:o,text:u}}encodeTrimPrefix(e,r,n){let o=[],s=0,a=0,c=0,u=new Map;for(u.set(a,c);;){let f,m;if([f,m]=this.findNextSpecialToken(e,s,n),m>s){let h,g=e.substring(s,m);for(this.regex.lastIndex=0;h=this.regex.exec(g);){let v=h[0],y=this.cache.get(v);if(y)a+=y.length,c+=v.length,o.push(...y),u.set(a,c);else{let _=this.textEncoder.encode(v),x=this.encoder.get(_);if(x!==void 0)this.cache.set(v,[x]),a++,c+=v.length,o.push(x),u.set(a,c);else{let S=(0,KL.bytePairEncode)(_,this.encoder,this.textEncoder.length);this.cache.set(v,S),a+=S.length,c+=v.length;for(let I of S)o.push(I);u.set(a,c)}}}}if(f!==null){if(s=s+this.encodeSpecialToken(o,f),a++,c+=f[0].length,u.set(a,c),s>=e.length)break}else break}if(a<=r)return{tokenIds:o,text:e};let l=a-r,d=0,p=0;for(let[f,m]of u)if(f>=l){d=f,p=m;break}if(d>r){let f=this.encode(e,n),m=f.slice(f.length-r);return{tokenIds:m,text:this.decode(m)}}return{tokenIds:o.slice(d),text:e.slice(p)}}decode(e){let r=[];for(let n of e){let o=[],s=this.decoder?.get(n);if(s!==void 0)o=Array.from(s);else{let a=this.specialTokensDecoder?.get(n);if(a!==void 0){let c=this.textEncoder.encode(a);o=Array.from(c.subarray(0,this.textEncoder.length))}}r.push(...o)}return this.textDecoder.decode(new Uint8Array(r))}};YL.TikTokenizer=iH});var gae=O(to=>{"use strict";Object.defineProperty(to,"__esModule",{value:!0});to.createTokenizer=to.createByEncoderName=to.createByModelName=to.getRegexByModel=to.getRegexByEncoder=to.getSpecialTokensByModel=to.getSpecialTokensByEncoder=to.MODEL_TO_ENCODING=void 0;var XL=require("fs"),sH=require("path"),sMe=oH(),aMe=new Map([["gpt-4o-","o200k_base"],["gpt-4-","cl100k_base"],["gpt-3.5-turbo-","cl100k_base"],["gpt-35-turbo-","cl100k_base"]]);to.MODEL_TO_ENCODING=new Map([["gpt-4o","o200k_base"],["gpt-4","cl100k_base"],["gpt-3.5-turbo","cl100k_base"],["text-davinci-003","p50k_base"],["text-davinci-002","p50k_base"],["text-davinci-001","r50k_base"],["text-curie-001","r50k_base"],["text-babbage-001","r50k_base"],["text-ada-001","r50k_base"],["davinci","r50k_base"],["curie","r50k_base"],["babbage","r50k_base"],["ada","r50k_base"],["code-davinci-002","p50k_base"],["code-davinci-001","p50k_base"],["code-cushman-002","p50k_base"],["code-cushman-001","p50k_base"],["davinci-codex","p50k_base"],["cushman-codex","p50k_base"],["text-davinci-edit-001","p50k_edit"],["code-davinci-edit-001","p50k_edit"],["text-embedding-ada-002","cl100k_base"],["text-similarity-davinci-001","r50k_base"],["text-similarity-curie-001","r50k_base"],["text-similarity-babbage-001","r50k_base"],["text-similarity-ada-001","r50k_base"],["text-search-davinci-doc-001","r50k_base"],["text-search-curie-doc-001","r50k_base"],["text-search-babbage-doc-001","r50k_base"],["text-search-ada-doc-001","r50k_base"],["code-search-babbage-code-001","r50k_base"],["code-search-ada-code-001","r50k_base"],["gpt2","gpt2"]]);var QL="<|endoftext|>",aae="<|fim_prefix|>",cae="<|fim_middle|>",uae="<|fim_suffix|>",lae="<|endofprompt|>",QR="'s|'t|'re|'ve|'m|'ll|'d| ?\\p{L}+| ?\\p{N}+| ?[^\\s\\p{L}\\p{N}]+|\\s+(?!\\S)|\\s+",dae="(?:'s|'S|'t|'T|'re|'RE|'Re|'eR|'ve|'VE|'vE|'Ve|'m|'M|'ll|'lL|'Ll|'LL|'d|'D)|[^\\r\\n\\p{L}\\p{N}]?\\p{L}+|\\p{N}{1,3}| ?[^\\s\\p{L}\\p{N}]+[\\r\\n]*|\\s*[\\r\\n]+|\\s+(?!\\S)|\\s+",cMe=[`[^\r
\\p{L}\\p{N}]?[\\p{Lu}\\p{Lt}\\p{Lm}\\p{Lo}\\p{M}]*[\\p{Ll}\\p{Lm}\\p{Lo}\\p{M}]+(?:'s|'S|'t|'T|'re|'RE|'Re|'eR|'ve|'VE|'vE|'Ve|'m|'M|'ll|'lL|'Ll|'LL|'d|'D)?`,`[^\r
\\p{L}\\p{N}]?[\\p{Lu}\\p{Lt}\\p{Lm}\\p{Lo}\\p{M}]+[\\p{Ll}\\p{Lm}\\p{Lo}\\p{M}]*(?:'s|'S|'t|'T|'re|'RE|'Re|'eR|'ve|'VE|'vE|'Ve|'m|'M|'ll|'lL|'Ll|'LL|'d|'D)?`,"\\p{N}{1,3}"," ?[^\\s\\p{L}\\p{N}]+[\\r\\n/]*","\\s*[\\r\\n]+","\\s+(?!\\S)","\\s+"],pae=cMe.join("|");function aH(t){let e="";if(to.MODEL_TO_ENCODING.has(t))e=to.MODEL_TO_ENCODING.get(t);else for(let[r,n]of aMe)if(t.startsWith(r)){e=n;break}return e}async function uMe(t,e){let r=await fetch(t);if(!r.ok)throw new Error(`Failed to fetch file from ${t}. Status code: ${r.status}`);let n=await r.text();XL.writeFileSync(e,n)}function cH(t){let e=new Map([[QL,50256]]);switch(t){case"o200k_base":e=new Map([[QL,199999],[lae,200018]]);break;case"cl100k_base":e=new Map([[QL,100257],[aae,100258],[cae,100259],[uae,100260],[lae,100276]]);break;case"p50k_edit":e=new Map([[QL,50256],[aae,50281],[cae,50282],[uae,50283]]);break;default:break}return e}to.getSpecialTokensByEncoder=cH;function lMe(t){let e=aH(t);return cH(e)}to.getSpecialTokensByModel=lMe;function fae(t){switch(t){case"o200k_base":return pae;case"cl100k_base":return dae;default:break}return QR}to.getRegexByEncoder=fae;function dMe(t){let e=aH(t);return fae(e)}to.getRegexByModel=dMe;async function pMe(t,e=null){return mae(aH(t),e)}to.createByModelName=pMe;async function mae(t,e=null){let r,n,o=cH(t);switch(t){case"o200k_base":r=pae,n="https://openaipublic.blob.core.windows.net/encodings/o200k_base.tiktoken";break;case"cl100k_base":r=dae,n="https://openaipublic.blob.core.windows.net/encodings/cl100k_base.tiktoken";break;case"p50k_base":r=QR,n="https://openaipublic.blob.core.windows.net/encodings/p50k_base.tiktoken";break;case"p50k_edit":r=QR,n="https://openaipublic.blob.core.windows.net/encodings/p50k_base.tiktoken";break;case"r50k_base":r=QR,n="https://openaipublic.blob.core.windows.net/encodings/r50k_base.tiktoken";break;case"gpt2":r=QR,n="https://raw.githubusercontent.com/microsoft/Tokenizer/main/model/gpt2.tiktoken";break;default:throw new Error(`Doesn't support this encoder [${t}]`)}e!==null&&(o=new Map([...o,...e]));let s=sH.basename(n),a=sH.resolve(__dirname,"..","model");XL.existsSync(a)||XL.mkdirSync(a,{recursive:!0});let c=sH.resolve(a,s);return XL.existsSync(c)||(console.log(`Downloading file from ${n}`),await uMe(n,c),console.log(`Saved file to ${c}`)),hae(c,o,r)}to.createByEncoderName=mae;function hae(t,e,r,n=8192){return new sMe.TikTokenizer(t,e,r,n)}to.createTokenizer=hae});var vae=O(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.createTokenizer=ro.createByEncoderName=ro.createByModelName=ro.getSpecialTokensByModel=ro.getSpecialTokensByEncoder=ro.getRegexByModel=ro.getRegexByEncoder=ro.MODEL_TO_ENCODING=ro.TikTokenizer=void 0;var fMe=oH();Object.defineProperty(ro,"TikTokenizer",{enumerable:!0,get:function(){return fMe.TikTokenizer}});var ig=gae();Object.defineProperty(ro,"MODEL_TO_ENCODING",{enumerable:!0,get:function(){return ig.MODEL_TO_ENCODING}});Object.defineProperty(ro,"getRegexByEncoder",{enumerable:!0,get:function(){return ig.getRegexByEncoder}});Object.defineProperty(ro,"getRegexByModel",{enumerable:!0,get:function(){return ig.getRegexByModel}});Object.defineProperty(ro,"getSpecialTokensByEncoder",{enumerable:!0,get:function(){return ig.getSpecialTokensByEncoder}});Object.defineProperty(ro,"getSpecialTokensByModel",{enumerable:!0,get:function(){return ig.getSpecialTokensByModel}});Object.defineProperty(ro,"createByModelName",{enumerable:!0,get:function(){return ig.createByModelName}});Object.defineProperty(ro,"createByEncoderName",{enumerable:!0,get:function(){return ig.createByEncoderName}});Object.defineProperty(ro,"createTokenizer",{enumerable:!0,get:function(){return ig.createTokenizer}})});var cce=O((Kyt,ace)=>{function Zae(t){return Array.isArray(t)?t:[t]}var nce="",ece=" ",_H="\\",yMe=/^\s+$/,_Me=/(?:[^\\]|^)\\$/,xMe=/^\\!/,SMe=/^\\#/,IMe=/\r?\n/g,CMe=/^\.*\/|^\.+$/,xH="/",ice="node-ignore";typeof Symbol<"u"&&(ice=Symbol.for("node-ignore"));var tce=ice,TMe=(t,e,r)=>Object.defineProperty(t,e,{value:r}),EMe=/([0-z])-([0-z])/g,oce=()=>!1,wMe=t=>t.replace(EMe,(e,r,n)=>r.charCodeAt(0)<=n.charCodeAt(0)?e:nce),RMe=t=>{let{length:e}=t;return t.slice(0,e-e%2)},kMe=[[/\\?\s+$/,t=>t.indexOf("\\")===0?ece:nce],[/\\\s/g,()=>ece],[/[\\$.|*+(){^]/g,t=>`\\${t}`],[/(?!\\)\?/g,()=>"[^/]"],[/^\//,()=>"^"],[/\//g,()=>"\\/"],[/^\^*\\\*\\\*\\\//,()=>"^(?:.*\\/)?"],[/^(?=[^^])/,function(){return/\/(?!$)/.test(this)?"^":"(?:^|\\/)"}],[/\\\/\\\*\\\*(?=\\\/|$)/g,(t,e,r)=>e+6<r.length?"(?:\\/[^\\/]+)*":"\\/.+"],[/(^|[^\\]+)(\\\*)+(?=.+)/g,(t,e,r)=>{let n=r.replace(/\\\*/g,"[^\\/]*");return e+n}],[/\\\\\\(?=[$.|*+(){^])/g,()=>_H],[/\\\\/g,()=>_H],[/(\\)?\[([^\]/]*?)(\\*)($|\])/g,(t,e,r,n,o)=>e===_H?`\\[${r}${RMe(n)}${o}`:o==="]"&&n.length%2===0?`[${wMe(r)}${n}]`:"[]"],[/(?:[^*])$/,t=>/\/$/.test(t)?`${t}$`:`${t}(?=$|\\/$)`],[/(\^|\\\/)?\\\*$/,(t,e)=>`${e?`${e}[^/]+`:"[^/]*"}(?=$|\\/$)`]],rce=Object.create(null),PMe=(t,e)=>{let r=rce[t];return r||(r=kMe.reduce((n,o)=>n.replace(o[0],o[1].bind(t)),t),rce[t]=r),e?new RegExp(r,"i"):new RegExp(r)},CH=t=>typeof t=="string",AMe=t=>t&&CH(t)&&!yMe.test(t)&&!_Me.test(t)&&t.indexOf("#")!==0,DMe=t=>t.split(IMe),SH=class{constructor(e,r,n,o){this.origin=e,this.pattern=r,this.negative=n,this.regex=o}},NMe=(t,e)=>{let r=t,n=!1;t.indexOf("!")===0&&(n=!0,t=t.substr(1)),t=t.replace(xMe,"!").replace(SMe,"#");let o=PMe(t,e);return new SH(r,t,n,o)},LMe=(t,e)=>{throw new e(t)},Vf=(t,e,r)=>CH(t)?t?Vf.isNotRelative(t)?r(`path should be a \`path.relative()\`d string, but got "${e}"`,RangeError):!0:r("path must not be empty",TypeError):r(`path must be a string, but got \`${e}\``,TypeError),sce=t=>CMe.test(t);Vf.isNotRelative=sce;Vf.convert=t=>t;var IH=class{constructor({ignorecase:e=!0,ignoreCase:r=e,allowRelativePaths:n=!1}={}){TMe(this,tce,!0),this._rules=[],this._ignoreCase=r,this._allowRelativePaths=n,this._initCache()}_initCache(){this._ignoreCache=Object.create(null),this._testCache=Object.create(null)}_addPattern(e){if(e&&e[tce]){this._rules=this._rules.concat(e._rules),this._added=!0;return}if(AMe(e)){let r=NMe(e,this._ignoreCase);this._added=!0,this._rules.push(r)}}add(e){return this._added=!1,Zae(CH(e)?DMe(e):e).forEach(this._addPattern,this),this._added&&this._initCache(),this}addPattern(e){return this.add(e)}_testOne(e,r){let n=!1,o=!1;return this._rules.forEach(s=>{let{negative:a}=s;if(o===a&&n!==o||a&&!n&&!o&&!r)return;s.regex.test(e)&&(n=!a,o=a)}),{ignored:n,unignored:o}}_test(e,r,n,o){let s=e&&Vf.convert(e);return Vf(s,e,this._allowRelativePaths?oce:LMe),this._t(s,r,n,o)}_t(e,r,n,o){if(e in r)return r[e];if(o||(o=e.split(xH)),o.pop(),!o.length)return r[e]=this._testOne(e,n);let s=this._t(o.join(xH)+xH,r,n,o);return r[e]=s.ignored?s:this._testOne(e,n)}ignores(e){return this._test(e,this._ignoreCache,!1).ignored}createFilter(){return e=>!this.ignores(e)}filter(e){return Zae(e).filter(this.createFilter())}test(e){return this._test(e,this._testCache,!0)}},b4=t=>new IH(t),OMe=t=>Vf(t&&Vf.convert(t),t,oce);b4.isPathValid=OMe;b4.default=b4;ace.exports=b4;if(typeof process<"u"&&(process.env&&process.env.IGNORE_TEST_WIN32||process.platform==="win32")){let t=r=>/^\\\\\?\\/.test(r)||/["<>|\u0000-\u001F]+/u.test(r)?r:r.replace(/\\/g,"/");Vf.convert=t;let e=/^[a-z]:\//i;Vf.isNotRelative=r=>e.test(r)||sce(r)}});var hce=O((Zyt,mce)=>{"use strict";mce.exports=pce;function pce(t,e,r){t instanceof RegExp&&(t=dce(t,r)),e instanceof RegExp&&(e=dce(e,r));var n=fce(t,e,r);return n&&{start:n[0],end:n[1],pre:r.slice(0,n[0]),body:r.slice(n[0]+t.length,n[1]),post:r.slice(n[1]+e.length)}}function dce(t,e){var r=e.match(t);return r?r[0]:null}pce.range=fce;function fce(t,e,r){var n,o,s,a,c,u=r.indexOf(t),l=r.indexOf(e,u+1),d=u;if(u>=0&&l>0){if(t===e)return[u,l];for(n=[],s=r.length;d>=0&&!c;)d==u?(n.push(d),u=r.indexOf(t,d+1)):n.length==1?c=[n.pop(),l]:(o=n.pop(),o<s&&(s=o,a=l),l=r.indexOf(e,d+1)),d=u<l&&u>=0?u:l;n.length&&(c=[s,a])}return c}});var Ice=O((e_t,Sce)=>{var gce=hce();Sce.exports=UMe;var vce="\0SLASH"+Math.random()+"\0",bce="\0OPEN"+Math.random()+"\0",EH="\0CLOSE"+Math.random()+"\0",yce="\0COMMA"+Math.random()+"\0",_ce="\0PERIOD"+Math.random()+"\0";function TH(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function MMe(t){return t.split("\\\\").join(vce).split("\\{").join(bce).split("\\}").join(EH).split("\\,").join(yce).split("\\.").join(_ce)}function FMe(t){return t.split(vce).join("\\").split(bce).join("{").split(EH).join("}").split(yce).join(",").split(_ce).join(".")}function xce(t){if(!t)return[""];var e=[],r=gce("{","}",t);if(!r)return t.split(",");var n=r.pre,o=r.body,s=r.post,a=n.split(",");a[a.length-1]+="{"+o+"}";var c=xce(s);return s.length&&(a[a.length-1]+=c.shift(),a.push.apply(a,c)),e.push.apply(e,a),e}function UMe(t){return t?(t.substr(0,2)==="{}"&&(t="\\{\\}"+t.substr(2)),lk(MMe(t),!0).map(FMe)):[]}function BMe(t){return"{"+t+"}"}function qMe(t){return/^-?0\d/.test(t)}function jMe(t,e){return t<=e}function HMe(t,e){return t>=e}function lk(t,e){var r=[],n=gce("{","}",t);if(!n)return[t];var o=n.pre,s=n.post.length?lk(n.post,!1):[""];if(/\$$/.test(n.pre))for(var a=0;a<s.length;a++){var c=o+"{"+n.body+"}"+s[a];r.push(c)}else{var u=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),l=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),d=u||l,p=n.body.indexOf(",")>=0;if(!d&&!p)return n.post.match(/,.*\}/)?(t=n.pre+"{"+n.body+EH+n.post,lk(t)):[t];var f;if(d)f=n.body.split(/\.\./);else if(f=xce(n.body),f.length===1&&(f=lk(f[0],!1).map(BMe),f.length===1))return s.map(function(M){return n.pre+f[0]+M});var m;if(d){var h=TH(f[0]),g=TH(f[1]),v=Math.max(f[0].length,f[1].length),y=f.length==3?Math.abs(TH(f[2])):1,_=jMe,x=g<h;x&&(y*=-1,_=HMe);var S=f.some(qMe);m=[];for(var I=h;_(I,g);I+=y){var E;if(l)E=String.fromCharCode(I),E==="\\"&&(E="");else if(E=String(I),S){var R=v-E.length;if(R>0){var B=new Array(R+1).join("0");I<0?E="-"+B+E.slice(1):E=B+E}}m.push(E)}}else{m=[];for(var V=0;V<f.length;V++)m.push.apply(m,lk(f[V],!1))}for(var V=0;V<m.length;V++)for(var a=0;a<s.length;a++){var c=o+m[V]+s[a];(!e||d||c)&&r.push(c)}}return r}});var Hk=O((kAt,qle)=>{"use strict";var Qd="\\\\/",Mle=`[^${Qd}]`,Xf="\\.",v9e="\\+",b9e="\\?",MO="\\/",y9e="(?=.)",Fle="[^/]",cG=`(?:${MO}|$)`,Ule=`(?:^|${MO})`,uG=`${Xf}{1,2}${cG}`,_9e=`(?!${Xf})`,x9e=`(?!${Ule}${uG})`,S9e=`(?!${Xf}{0,1}${cG})`,I9e=`(?!${uG})`,C9e=`[^.${MO}]`,T9e=`${Fle}*?`,E9e="/",Ble={DOT_LITERAL:Xf,PLUS_LITERAL:v9e,QMARK_LITERAL:b9e,SLASH_LITERAL:MO,ONE_CHAR:y9e,QMARK:Fle,END_ANCHOR:cG,DOTS_SLASH:uG,NO_DOT:_9e,NO_DOTS:x9e,NO_DOT_SLASH:S9e,NO_DOTS_SLASH:I9e,QMARK_NO_DOT:C9e,STAR:T9e,START_ANCHOR:Ule,SEP:E9e},w9e={...Ble,SLASH_LITERAL:`[${Qd}]`,QMARK:Mle,STAR:`${Mle}*?`,DOTS_SLASH:`${Xf}{1,2}(?:[${Qd}]|$)`,NO_DOT:`(?!${Xf})`,NO_DOTS:`(?!(?:^|[${Qd}])${Xf}{1,2}(?:[${Qd}]|$))`,NO_DOT_SLASH:`(?!${Xf}{0,1}(?:[${Qd}]|$))`,NO_DOTS_SLASH:`(?!${Xf}{1,2}(?:[${Qd}]|$))`,QMARK_NO_DOT:`[^.${Qd}]`,START_ANCHOR:`(?:^|[${Qd}])`,END_ANCHOR:`(?:[${Qd}]|$)`,SEP:"\\"},R9e={alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"};qle.exports={MAX_LENGTH:1024*64,POSIX_REGEX_SOURCE:R9e,REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,extglobChars(t){return{"!":{type:"negate",open:"(?:(?!(?:",close:`))${t.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}},globChars(t){return t===!0?w9e:Ble}}});var FO=O(Xa=>{"use strict";var{REGEX_BACKSLASH:k9e,REGEX_REMOVE_BACKSLASH:P9e,REGEX_SPECIAL_CHARS:A9e,REGEX_SPECIAL_CHARS_GLOBAL:D9e}=Hk();Xa.isObject=t=>t!==null&&typeof t=="object"&&!Array.isArray(t);Xa.hasRegexChars=t=>A9e.test(t);Xa.isRegexChar=t=>t.length===1&&Xa.hasRegexChars(t);Xa.escapeRegex=t=>t.replace(D9e,"\\$1");Xa.toPosixSlashes=t=>t.replace(k9e,"/");Xa.removeBackslashes=t=>t.replace(P9e,e=>e==="\\"?"":e);Xa.supportsLookbehinds=()=>{if(typeof process<"u"){let t=process.version.slice(1).split(".").map(Number);if(t.length===3&&t[0]>=9||t[0]===8&&t[1]>=10)return!0}return!1};Xa.escapeLast=(t,e,r)=>{let n=t.lastIndexOf(e,r);return n===-1?t:t[n-1]==="\\"?Xa.escapeLast(t,e,n-1):`${t.slice(0,n)}\\${t.slice(n)}`};Xa.removePrefix=(t,e={})=>{let r=t;return r.startsWith("./")&&(r=r.slice(2),e.prefix="./"),r};Xa.wrapOutput=(t,e={},r={})=>{let n=r.contains?"":"^",o=r.contains?"":"$",s=`${n}(?:${t})${o}`;return e.negated===!0&&(s=`(?:^(?!${s}).*$)`),s};Xa.basename=(t,{windows:e}={})=>{let r=t.split(e?/[\\/]/:"/"),n=r[r.length-1];return n===""?r[r.length-2]:n}});var Kle=O((AAt,Wle)=>{"use strict";var jle=FO(),{CHAR_ASTERISK:lG,CHAR_AT:N9e,CHAR_BACKWARD_SLASH:Vk,CHAR_COMMA:L9e,CHAR_DOT:dG,CHAR_EXCLAMATION_MARK:pG,CHAR_FORWARD_SLASH:$le,CHAR_LEFT_CURLY_BRACE:fG,CHAR_LEFT_PARENTHESES:mG,CHAR_LEFT_SQUARE_BRACKET:O9e,CHAR_PLUS:M9e,CHAR_QUESTION_MARK:Hle,CHAR_RIGHT_CURLY_BRACE:F9e,CHAR_RIGHT_PARENTHESES:Vle,CHAR_RIGHT_SQUARE_BRACKET:U9e}=Hk(),Gle=t=>t===$le||t===Vk,zle=t=>{t.isPrefix!==!0&&(t.depth=t.isGlobstar?1/0:1)},B9e=(t,e)=>{let r=e||{},n=t.length-1,o=r.parts===!0||r.scanToEnd===!0,s=[],a=[],c=[],u=t,l=-1,d=0,p=0,f=!1,m=!1,h=!1,g=!1,v=!1,y=!1,_=!1,x=!1,S=!1,I=!1,E=0,R,B,V={value:"",depth:0,isGlob:!1},M=()=>l>=n,le=()=>u.charCodeAt(l+1),ne=()=>(R=B,u.charCodeAt(++l));for(;l<n;){B=ne();let F;if(B===Vk){_=V.backslashes=!0,B=ne(),B===fG&&(y=!0);continue}if(y===!0||B===fG){for(E++;M()!==!0&&(B=ne());){if(B===Vk){_=V.backslashes=!0,ne();continue}if(B===fG){E++;continue}if(y!==!0&&B===dG&&(B=ne())===dG){if(f=V.isBrace=!0,h=V.isGlob=!0,I=!0,o===!0)continue;break}if(y!==!0&&B===L9e){if(f=V.isBrace=!0,h=V.isGlob=!0,I=!0,o===!0)continue;break}if(B===F9e&&(E--,E===0)){y=!1,f=V.isBrace=!0,I=!0;break}}if(o===!0)continue;break}if(B===$le){if(s.push(l),a.push(V),V={value:"",depth:0,isGlob:!1},I===!0)continue;if(R===dG&&l===d+1){d+=2;continue}p=l+1;continue}if(r.noext!==!0&&(B===M9e||B===N9e||B===lG||B===Hle||B===pG)===!0&&le()===mG){if(h=V.isGlob=!0,g=V.isExtglob=!0,I=!0,B===pG&&l===d&&(S=!0),o===!0){for(;M()!==!0&&(B=ne());){if(B===Vk){_=V.backslashes=!0,B=ne();continue}if(B===Vle){h=V.isGlob=!0,I=!0;break}}continue}break}if(B===lG){if(R===lG&&(v=V.isGlobstar=!0),h=V.isGlob=!0,I=!0,o===!0)continue;break}if(B===Hle){if(h=V.isGlob=!0,I=!0,o===!0)continue;break}if(B===O9e){for(;M()!==!0&&(F=ne());){if(F===Vk){_=V.backslashes=!0,ne();continue}if(F===U9e){m=V.isBracket=!0,h=V.isGlob=!0,I=!0;break}}if(o===!0)continue;break}if(r.nonegate!==!0&&B===pG&&l===d){x=V.negated=!0,d++;continue}if(r.noparen!==!0&&B===mG){if(h=V.isGlob=!0,o===!0){for(;M()!==!0&&(B=ne());){if(B===mG){_=V.backslashes=!0,B=ne();continue}if(B===Vle){I=!0;break}}continue}break}if(h===!0){if(I=!0,o===!0)continue;break}}r.noext===!0&&(g=!1,h=!1);let q=u,P="",k="";d>0&&(P=u.slice(0,d),u=u.slice(d),p-=d),q&&h===!0&&p>0?(q=u.slice(0,p),k=u.slice(p)):h===!0?(q="",k=u):q=u,q&&q!==""&&q!=="/"&&q!==u&&Gle(q.charCodeAt(q.length-1))&&(q=q.slice(0,-1)),r.unescape===!0&&(k&&(k=jle.removeBackslashes(k)),q&&_===!0&&(q=jle.removeBackslashes(q)));let U={prefix:P,input:t,start:d,base:q,glob:k,isBrace:f,isBracket:m,isGlob:h,isExtglob:g,isGlobstar:v,negated:x,negatedExtglob:S};if(r.tokens===!0&&(U.maxDepth=0,Gle(B)||a.push(V),U.tokens=a),r.parts===!0||r.tokens===!0){let F;for(let $=0;$<s.length;$++){let ce=F?F+1:d,Y=s[$],j=t.slice(ce,Y);r.tokens&&($===0&&d!==0?(a[$].isPrefix=!0,a[$].value=P):a[$].value=j,zle(a[$]),U.maxDepth+=a[$].depth),($!==0||j!=="")&&c.push(j),F=Y}if(F&&F+1<t.length){let $=t.slice(F+1);c.push($),r.tokens&&(a[a.length-1].value=$,zle(a[a.length-1]),U.maxDepth+=a[a.length-1].depth)}U.slashes=s,U.parts=c}return U};Wle.exports=B9e});var Xle=O((DAt,Qle)=>{"use strict";var UO=Hk(),Ul=FO(),{MAX_LENGTH:BO,POSIX_REGEX_SOURCE:q9e,REGEX_NON_SPECIAL_CHARS:j9e,REGEX_SPECIAL_CHARS_BACKREF:H9e,REPLACEMENTS:Yle}=UO,V9e=(t,e)=>{if(typeof e.expandRange=="function")return e.expandRange(...t,e);t.sort();let r=`[${t.join("-")}]`;try{new RegExp(r)}catch{return t.map(o=>Ul.escapeRegex(o)).join("..")}return r},l1=(t,e)=>`Missing ${t}: "${e}" - use "\\\\${e}" to match literal characters`,hG=(t,e)=>{if(typeof t!="string")throw new TypeError("Expected a string");t=Yle[t]||t;let r={...e},n=typeof r.maxLength=="number"?Math.min(BO,r.maxLength):BO,o=t.length;if(o>n)throw new SyntaxError(`Input length: ${o}, exceeds maximum allowed length: ${n}`);let s={type:"bos",value:"",output:r.prepend||""},a=[s],c=r.capture?"":"?:",u=UO.globChars(r.windows),l=UO.extglobChars(u),{DOT_LITERAL:d,PLUS_LITERAL:p,SLASH_LITERAL:f,ONE_CHAR:m,DOTS_SLASH:h,NO_DOT:g,NO_DOT_SLASH:v,NO_DOTS_SLASH:y,QMARK:_,QMARK_NO_DOT:x,STAR:S,START_ANCHOR:I}=u,E=ye=>`(${c}(?:(?!${I}${ye.dot?h:d}).)*?)`,R=r.dot?"":g,B=r.dot?_:x,V=r.bash===!0?E(r):S;r.capture&&(V=`(${V})`),typeof r.noext=="boolean"&&(r.noextglob=r.noext);let M={input:t,index:-1,start:0,dot:r.dot===!0,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:a};t=Ul.removePrefix(t,M),o=t.length;let le=[],ne=[],q=[],P=s,k,U=()=>M.index===o-1,F=M.peek=(ye=1)=>t[M.index+ye],$=M.advance=()=>t[++M.index]||"",ce=()=>t.slice(M.index+1),Y=(ye="",lt=0)=>{M.consumed+=ye,M.index+=lt},j=ye=>{M.output+=ye.output!=null?ye.output:ye.value,Y(ye.value)},xe=()=>{let ye=1;for(;F()==="!"&&(F(2)!=="("||F(3)==="?");)$(),M.start++,ye++;return ye%2===0?!1:(M.negated=!0,M.start++,!0)},ee=ye=>{M[ye]++,q.push(ye)},vt=ye=>{M[ye]--,q.pop()},We=ye=>{if(P.type==="globstar"){let lt=M.braces>0&&(ye.type==="comma"||ye.type==="brace"),G=ye.extglob===!0||le.length&&(ye.type==="pipe"||ye.type==="paren");ye.type!=="slash"&&ye.type!=="paren"&&!lt&&!G&&(M.output=M.output.slice(0,-P.output.length),P.type="star",P.value="*",P.output=V,M.output+=P.output)}if(le.length&&ye.type!=="paren"&&(le[le.length-1].inner+=ye.value),(ye.value||ye.output)&&j(ye),P&&P.type==="text"&&ye.type==="text"){P.value+=ye.value,P.output=(P.output||"")+ye.value;return}ye.prev=P,a.push(ye),P=ye},Lt=(ye,lt)=>{let G={...l[lt],conditions:1,inner:""};G.prev=P,G.parens=M.parens,G.output=M.output;let pe=(r.capture?"(":"")+G.open;ee("parens"),We({type:ye,value:lt,output:M.output?"":m}),We({type:"paren",extglob:!0,value:$(),output:pe}),le.push(G)},br=ye=>{let lt=ye.close+(r.capture?")":""),G;if(ye.type==="negate"){let pe=V;if(ye.inner&&ye.inner.length>1&&ye.inner.includes("/")&&(pe=E(r)),(pe!==V||U()||/^\)+$/.test(ce()))&&(lt=ye.close=`)$))${pe}`),ye.inner.includes("*")&&(G=ce())&&/^\.[^\\/.]+$/.test(G)){let me=hG(G,{...e,fastpaths:!1}).output;lt=ye.close=`)${me})${pe})`}ye.prev.type==="bos"&&(M.negatedExtglob=!0)}We({type:"paren",extglob:!0,value:k,output:lt}),vt("parens")};if(r.fastpaths!==!1&&!/(^[*!]|[/()[\]{}"])/.test(t)){let ye=!1,lt=t.replace(H9e,(G,pe,me,Pe,Ie,bt)=>Pe==="\\"?(ye=!0,G):Pe==="?"?pe?pe+Pe+(Ie?_.repeat(Ie.length):""):bt===0?B+(Ie?_.repeat(Ie.length):""):_.repeat(me.length):Pe==="."?d.repeat(me.length):Pe==="*"?pe?pe+Pe+(Ie?V:""):V:pe?G:`\\${G}`);return ye===!0&&(r.unescape===!0?lt=lt.replace(/\\/g,""):lt=lt.replace(/\\+/g,G=>G.length%2===0?"\\\\":G?"\\":"")),lt===t&&r.contains===!0?(M.output=t,M):(M.output=Ul.wrapOutput(lt,M,e),M)}for(;!U();){if(k=$(),k==="\0")continue;if(k==="\\"){let G=F();if(G==="/"&&r.bash!==!0||G==="."||G===";")continue;if(!G){k+="\\",We({type:"text",value:k});continue}let pe=/^\\+/.exec(ce()),me=0;if(pe&&pe[0].length>2&&(me=pe[0].length,M.index+=me,me%2!==0&&(k+="\\")),r.unescape===!0?k=$():k+=$(),M.brackets===0){We({type:"text",value:k});continue}}if(M.brackets>0&&(k!=="]"||P.value==="["||P.value==="[^")){if(r.posix!==!1&&k===":"){let G=P.value.slice(1);if(G.includes("[")&&(P.posix=!0,G.includes(":"))){let pe=P.value.lastIndexOf("["),me=P.value.slice(0,pe),Pe=P.value.slice(pe+2),Ie=q9e[Pe];if(Ie){P.value=me+Ie,M.backtrack=!0,$(),!s.output&&a.indexOf(P)===1&&(s.output=m);continue}}}(k==="["&&F()!==":"||k==="-"&&F()==="]")&&(k=`\\${k}`),k==="]"&&(P.value==="["||P.value==="[^")&&(k=`\\${k}`),r.posix===!0&&k==="!"&&P.value==="["&&(k="^"),P.value+=k,j({value:k});continue}if(M.quotes===1&&k!=='"'){k=Ul.escapeRegex(k),P.value+=k,j({value:k});continue}if(k==='"'){M.quotes=M.quotes===1?0:1,r.keepQuotes===!0&&We({type:"text",value:k});continue}if(k==="("){ee("parens"),We({type:"paren",value:k});continue}if(k===")"){if(M.parens===0&&r.strictBrackets===!0)throw new SyntaxError(l1("opening","("));let G=le[le.length-1];if(G&&M.parens===G.parens+1){br(le.pop());continue}We({type:"paren",value:k,output:M.parens?")":"\\)"}),vt("parens");continue}if(k==="["){if(r.nobracket===!0||!ce().includes("]")){if(r.nobracket!==!0&&r.strictBrackets===!0)throw new SyntaxError(l1("closing","]"));k=`\\${k}`}else ee("brackets");We({type:"bracket",value:k});continue}if(k==="]"){if(r.nobracket===!0||P&&P.type==="bracket"&&P.value.length===1){We({type:"text",value:k,output:`\\${k}`});continue}if(M.brackets===0){if(r.strictBrackets===!0)throw new SyntaxError(l1("opening","["));We({type:"text",value:k,output:`\\${k}`});continue}vt("brackets");let G=P.value.slice(1);if(P.posix!==!0&&G[0]==="^"&&!G.includes("/")&&(k=`/${k}`),P.value+=k,j({value:k}),r.literalBrackets===!1||Ul.hasRegexChars(G))continue;let pe=Ul.escapeRegex(P.value);if(M.output=M.output.slice(0,-P.value.length),r.literalBrackets===!0){M.output+=pe,P.value=pe;continue}P.value=`(${c}${pe}|${P.value})`,M.output+=P.value;continue}if(k==="{"&&r.nobrace!==!0){ee("braces");let G={type:"brace",value:k,output:"(",outputIndex:M.output.length,tokensIndex:M.tokens.length};ne.push(G),We(G);continue}if(k==="}"){let G=ne[ne.length-1];if(r.nobrace===!0||!G){We({type:"text",value:k,output:k});continue}let pe=")";if(G.dots===!0){let me=a.slice(),Pe=[];for(let Ie=me.length-1;Ie>=0&&(a.pop(),me[Ie].type!=="brace");Ie--)me[Ie].type!=="dots"&&Pe.unshift(me[Ie].value);pe=V9e(Pe,r),M.backtrack=!0}if(G.comma!==!0&&G.dots!==!0){let me=M.output.slice(0,G.outputIndex),Pe=M.tokens.slice(G.tokensIndex);G.value=G.output="\\{",k=pe="\\}",M.output=me;for(let Ie of Pe)M.output+=Ie.output||Ie.value}We({type:"brace",value:k,output:pe}),vt("braces"),ne.pop();continue}if(k==="|"){le.length>0&&le[le.length-1].conditions++,We({type:"text",value:k});continue}if(k===","){let G=k,pe=ne[ne.length-1];pe&&q[q.length-1]==="braces"&&(pe.comma=!0,G="|"),We({type:"comma",value:k,output:G});continue}if(k==="/"){if(P.type==="dot"&&M.index===M.start+1){M.start=M.index+1,M.consumed="",M.output="",a.pop(),P=s;continue}We({type:"slash",value:k,output:f});continue}if(k==="."){if(M.braces>0&&P.type==="dot"){P.value==="."&&(P.output=d);let G=ne[ne.length-1];P.type="dots",P.output+=k,P.value+=k,G.dots=!0;continue}if(M.braces+M.parens===0&&P.type!=="bos"&&P.type!=="slash"){We({type:"text",value:k,output:d});continue}We({type:"dot",value:k,output:d});continue}if(k==="?"){if(!(P&&P.value==="(")&&r.noextglob!==!0&&F()==="("&&F(2)!=="?"){Lt("qmark",k);continue}if(P&&P.type==="paren"){let pe=F(),me=k;if(pe==="<"&&!Ul.supportsLookbehinds())throw new Error("Node.js v10 or higher is required for regex lookbehinds");(P.value==="("&&!/[!=<:]/.test(pe)||pe==="<"&&!/<([!=]|\w+>)/.test(ce()))&&(me=`\\${k}`),We({type:"text",value:k,output:me});continue}if(r.dot!==!0&&(P.type==="slash"||P.type==="bos")){We({type:"qmark",value:k,output:x});continue}We({type:"qmark",value:k,output:_});continue}if(k==="!"){if(r.noextglob!==!0&&F()==="("&&(F(2)!=="?"||!/[!=<:]/.test(F(3)))){Lt("negate",k);continue}if(r.nonegate!==!0&&M.index===0){xe();continue}}if(k==="+"){if(r.noextglob!==!0&&F()==="("&&F(2)!=="?"){Lt("plus",k);continue}if(P&&P.value==="("||r.regex===!1){We({type:"plus",value:k,output:p});continue}if(P&&(P.type==="bracket"||P.type==="paren"||P.type==="brace")||M.parens>0){We({type:"plus",value:k});continue}We({type:"plus",value:p});continue}if(k==="@"){if(r.noextglob!==!0&&F()==="("&&F(2)!=="?"){We({type:"at",extglob:!0,value:k,output:""});continue}We({type:"text",value:k});continue}if(k!=="*"){(k==="$"||k==="^")&&(k=`\\${k}`);let G=j9e.exec(ce());G&&(k+=G[0],M.index+=G[0].length),We({type:"text",value:k});continue}if(P&&(P.type==="globstar"||P.star===!0)){P.type="star",P.star=!0,P.value+=k,P.output=V,M.backtrack=!0,M.globstar=!0,Y(k);continue}let ye=ce();if(r.noextglob!==!0&&/^\([^?]/.test(ye)){Lt("star",k);continue}if(P.type==="star"){if(r.noglobstar===!0){Y(k);continue}let G=P.prev,pe=G.prev,me=G.type==="slash"||G.type==="bos",Pe=pe&&(pe.type==="star"||pe.type==="globstar");if(r.bash===!0&&(!me||ye[0]&&ye[0]!=="/")){We({type:"star",value:k,output:""});continue}let Ie=M.braces>0&&(G.type==="comma"||G.type==="brace"),bt=le.length&&(G.type==="pipe"||G.type==="paren");if(!me&&G.type!=="paren"&&!Ie&&!bt){We({type:"star",value:k,output:""});continue}for(;ye.slice(0,3)==="/**";){let Dt=t[M.index+4];if(Dt&&Dt!=="/")break;ye=ye.slice(3),Y("/**",3)}if(G.type==="bos"&&U()){P.type="globstar",P.value+=k,P.output=E(r),M.output=P.output,M.globstar=!0,Y(k);continue}if(G.type==="slash"&&G.prev.type!=="bos"&&!Pe&&U()){M.output=M.output.slice(0,-(G.output+P.output).length),G.output=`(?:${G.output}`,P.type="globstar",P.output=E(r)+(r.strictSlashes?")":"|$)"),P.value+=k,M.globstar=!0,M.output+=G.output+P.output,Y(k);continue}if(G.type==="slash"&&G.prev.type!=="bos"&&ye[0]==="/"){let Dt=ye[1]!==void 0?"|$":"";M.output=M.output.slice(0,-(G.output+P.output).length),G.output=`(?:${G.output}`,P.type="globstar",P.output=`${E(r)}${f}|${f}${Dt})`,P.value+=k,M.output+=G.output+P.output,M.globstar=!0,Y(k+$()),We({type:"slash",value:"/",output:""});continue}if(G.type==="bos"&&ye[0]==="/"){P.type="globstar",P.value+=k,P.output=`(?:^|${f}|${E(r)}${f})`,M.output=P.output,M.globstar=!0,Y(k+$()),We({type:"slash",value:"/",output:""});continue}M.output=M.output.slice(0,-P.output.length),P.type="globstar",P.output=E(r),P.value+=k,M.output+=P.output,M.globstar=!0,Y(k);continue}let lt={type:"star",value:k,output:V};if(r.bash===!0){lt.output=".*?",(P.type==="bos"||P.type==="slash")&&(lt.output=R+lt.output),We(lt);continue}if(P&&(P.type==="bracket"||P.type==="paren")&&r.regex===!0){lt.output=k,We(lt);continue}(M.index===M.start||P.type==="slash"||P.type==="dot")&&(P.type==="dot"?(M.output+=v,P.output+=v):r.dot===!0?(M.output+=y,P.output+=y):(M.output+=R,P.output+=R),F()!=="*"&&(M.output+=m,P.output+=m)),We(lt)}for(;M.brackets>0;){if(r.strictBrackets===!0)throw new SyntaxError(l1("closing","]"));M.output=Ul.escapeLast(M.output,"["),vt("brackets")}for(;M.parens>0;){if(r.strictBrackets===!0)throw new SyntaxError(l1("closing",")"));M.output=Ul.escapeLast(M.output,"("),vt("parens")}for(;M.braces>0;){if(r.strictBrackets===!0)throw new SyntaxError(l1("closing","}"));M.output=Ul.escapeLast(M.output,"{"),vt("braces")}if(r.strictSlashes!==!0&&(P.type==="star"||P.type==="bracket")&&We({type:"maybe_slash",value:"",output:`${f}?`}),M.backtrack===!0){M.output="";for(let ye of M.tokens)M.output+=ye.output!=null?ye.output:ye.value,ye.suffix&&(M.output+=ye.suffix)}return M};hG.fastpaths=(t,e)=>{let r={...e},n=typeof r.maxLength=="number"?Math.min(BO,r.maxLength):BO,o=t.length;if(o>n)throw new SyntaxError(`Input length: ${o}, exceeds maximum allowed length: ${n}`);t=Yle[t]||t;let{DOT_LITERAL:s,SLASH_LITERAL:a,ONE_CHAR:c,DOTS_SLASH:u,NO_DOT:l,NO_DOTS:d,NO_DOTS_SLASH:p,STAR:f,START_ANCHOR:m}=UO.globChars(r.windows),h=r.dot?d:l,g=r.dot?p:l,v=r.capture?"":"?:",y={negated:!1,prefix:""},_=r.bash===!0?".*?":f;r.capture&&(_=`(${_})`);let x=R=>R.noglobstar===!0?_:`(${v}(?:(?!${m}${R.dot?u:s}).)*?)`,S=R=>{switch(R){case"*":return`${h}${c}${_}`;case".*":return`${s}${c}${_}`;case"*.*":return`${h}${_}${s}${c}${_}`;case"*/*":return`${h}${_}${a}${c}${g}${_}`;case"**":return h+x(r);case"**/*":return`(?:${h}${x(r)}${a})?${g}${c}${_}`;case"**/*.*":return`(?:${h}${x(r)}${a})?${g}${_}${s}${c}${_}`;case"**/.*":return`(?:${h}${x(r)}${a})?${s}${c}${_}`;default:{let B=/^(.*?)\.(\w+)$/.exec(R);if(!B)return;let V=S(B[1]);return V?V+s+B[2]:void 0}}},I=Ul.removePrefix(t,y),E=S(I);return E&&r.strictSlashes!==!0&&(E+=`${a}?`),E};Qle.exports=hG});var ede=O((NAt,Zle)=>{"use strict";var G9e=Kle(),gG=Xle(),Jle=FO(),z9e=Hk(),$9e=t=>t&&typeof t=="object"&&!Array.isArray(t),Gi=(t,e,r=!1)=>{if(Array.isArray(t)){let d=t.map(f=>Gi(f,e,r));return f=>{for(let m of d){let h=m(f);if(h)return h}return!1}}let n=$9e(t)&&t.tokens&&t.input;if(t===""||typeof t!="string"&&!n)throw new TypeError("Expected pattern to be a non-empty string");let o=e||{},s=o.windows,a=n?Gi.compileRe(t,e):Gi.makeRe(t,e,!1,!0),c=a.state;delete a.state;let u=()=>!1;if(o.ignore){let d={...e,ignore:null,onMatch:null,onResult:null};u=Gi(o.ignore,d,r)}let l=(d,p=!1)=>{let{isMatch:f,match:m,output:h}=Gi.test(d,a,e,{glob:t,posix:s}),g={glob:t,state:c,regex:a,posix:s,input:d,output:h,match:m,isMatch:f};return typeof o.onResult=="function"&&o.onResult(g),f===!1?(g.isMatch=!1,p?g:!1):u(d)?(typeof o.onIgnore=="function"&&o.onIgnore(g),g.isMatch=!1,p?g:!1):(typeof o.onMatch=="function"&&o.onMatch(g),p?g:!0)};return r&&(l.state=c),l};Gi.test=(t,e,r,{glob:n,posix:o}={})=>{if(typeof t!="string")throw new TypeError("Expected input to be a string");if(t==="")return{isMatch:!1,output:""};let s=r||{},a=s.format||(o?Jle.toPosixSlashes:null),c=t===n,u=c&&a?a(t):t;return c===!1&&(u=a?a(t):t,c=u===n),(c===!1||s.capture===!0)&&(s.matchBase===!0||s.basename===!0?c=Gi.matchBase(t,e,r,o):c=e.exec(u)),{isMatch:!!c,match:c,output:u}};Gi.matchBase=(t,e,r)=>(e instanceof RegExp?e:Gi.makeRe(e,r)).test(Jle.basename(t));Gi.isMatch=(t,e,r)=>Gi(e,r)(t);Gi.parse=(t,e)=>Array.isArray(t)?t.map(r=>Gi.parse(r,e)):gG(t,{...e,fastpaths:!1});Gi.scan=(t,e)=>G9e(t,e);Gi.compileRe=(t,e,r=!1,n=!1)=>{if(r===!0)return t.output;let o=e||{},s=o.contains?"":"^",a=o.contains?"":"$",c=`${s}(?:${t.output})${a}`;t&&t.negated===!0&&(c=`^(?!${c}).*$`);let u=Gi.toRegex(c,e);return n===!0&&(u.state=t),u};Gi.makeRe=(t,e={},r=!1,n=!1)=>{if(!t||typeof t!="string")throw new TypeError("Expected a non-empty string");let o={negated:!1,fastpaths:!0};return e.fastpaths!==!1&&(t[0]==="."||t[0]==="*")&&(o.output=gG.fastpaths(t,e)),o.output||(o=gG(t,e)),Gi.compileRe(o,e,r,n)};Gi.toRegex=(t,e)=>{try{let r=e||{};return new RegExp(t,r.flags||(r.nocase?"i":""))}catch(r){if(e&&e.debug===!0)throw r;return/$^/}};Gi.constants=z9e;Zle.exports=Gi});var tde=O((LAt,Xd)=>{"use strict";var W9e=require("os"),Jf=ede(),K9e=W9e.platform()==="win32";function Y9e(t,e,r=!1){return e&&(e.windows===null||e.windows===void 0)&&(e={...e,windows:K9e}),Jf(t,e,r)}Xd.exports=Y9e;Xd.exports.test=Jf.test;Xd.exports.matchBase=Jf.matchBase;Xd.exports.isMatch=Jf.isMatch;Xd.exports.parse=Jf.parse;Xd.exports.scan=Jf.scan;Xd.exports.compileRe=Jf.compileRe;Xd.exports.toRegex=Jf.toRegex;Xd.exports.makeRe=Jf.makeRe});var sde=O(Lg=>{"use strict";var Q9e=Lg&&Lg.__awaiter||function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})};Object.defineProperty(Lg,"__esModule",{value:!0});Lg.isBinaryFileSync=Lg.isBinaryFile=void 0;var Ng=require("fs"),_G=require("util"),X9e=_G.promisify(Ng.stat),J9e=_G.promisify(Ng.open),Z9e=_G.promisify(Ng.close),Gk=512,yG=class{constructor(e,r){this.fileBuffer=e,this.size=r,this.offset=0,this.error=!1}hasError(){return this.error}nextByte(){return this.offset===this.size||this.hasError()?(this.error=!0,255):this.fileBuffer[this.offset++]}next(e){let r=new Array;for(let n=0;n<e;n++)r[n]=this.nextByte();return r}};function bG(t){let e=0,r=0;for(;!t.hasError();){let n=t.nextByte();if(r=r|(n&127)<<7*e,!(n&128))break;e++}return r}function e7e(t){switch(bG(t)&7){case 0:return bG(t),!0;case 1:return t.next(8),!0;case 2:let n=bG(t);return t.next(n),!0;case 5:return t.next(4),!0}return!1}function t7e(t,e){let r=new yG(t,e),n=0;for(;;){if(!e7e(r)&&!r.hasError())return!1;if(r.hasError())break;n++}return n>0}function r7e(t,e){return Q9e(this,void 0,void 0,function*(){if(ide(t)){let r=yield X9e(t);ode(r);let n=yield J9e(t,"r"),o=Buffer.alloc(Gk);return new Promise((s,a)=>{Ng.read(n,o,0,Gk,0,(c,u,l)=>{Z9e(n),c?a(c):s(HO(o,u))})})}else return e===void 0&&(e=t.length),HO(t,e)})}Lg.isBinaryFile=r7e;function n7e(t,e){if(ide(t)){let r=Ng.statSync(t);ode(r);let n=Ng.openSync(t,"r"),o=Buffer.alloc(Gk),s=Ng.readSync(n,o,0,Gk,0);return Ng.closeSync(n),HO(o,s)}else return e===void 0&&(e=t.length),HO(t,e)}Lg.isBinaryFileSync=n7e;function HO(t,e){if(e===0)return!1;let r=0,n=Math.min(e,Gk);if(e>=3&&t[0]===239&&t[1]===187&&t[2]===191||e>=4&&t[0]===0&&t[1]===0&&t[2]===254&&t[3]===255||e>=4&&t[0]===255&&t[1]===254&&t[2]===0&&t[3]===0||e>=4&&t[0]===132&&t[1]===49&&t[2]===149&&t[3]===51)return!1;if(n>=5&&t.slice(0,5).toString()==="%PDF-")return!0;if(e>=2&&t[0]===254&&t[1]===255||e>=2&&t[0]===255&&t[1]===254)return!1;for(let o=0;o<n;o++){if(t[o]===0)return!0;if((t[o]<7||t[o]>14)&&(t[o]<32||t[o]>127)){if(t[o]>193&&t[o]<224&&o+1<n){if(o++,t[o]>127&&t[o]<192)continue}else if(t[o]>223&&t[o]<240&&o+2<n&&(o++,t[o]>127&&t[o]<192&&t[o+1]>127&&t[o+1]<192)){o++;continue}if(r++,o>=32&&r*100/n>10)return!0}}return!!(r*100/n>10||r>1&&t7e(t,n))}function ide(t){return typeof t=="string"}function ode(t){if(!t.isFile())throw new Error("Path provided was not a file!")}});var Xfe=O((Bfr,Qfe)=>{var pC=1e3,fC=pC*60,mC=fC*60,Py=mC*24,fqe=Py*7,mqe=Py*365.25;Qfe.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return hqe(t);if(r==="number"&&isFinite(t))return e.long?vqe(t):gqe(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function hqe(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*mqe;case"weeks":case"week":case"w":return r*fqe;case"days":case"day":case"d":return r*Py;case"hours":case"hour":case"hrs":case"hr":case"h":return r*mC;case"minutes":case"minute":case"mins":case"min":case"m":return r*fC;case"seconds":case"second":case"secs":case"sec":case"s":return r*pC;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function gqe(t){var e=Math.abs(t);return e>=Py?Math.round(t/Py)+"d":e>=mC?Math.round(t/mC)+"h":e>=fC?Math.round(t/fC)+"m":e>=pC?Math.round(t/pC)+"s":t+"ms"}function vqe(t){var e=Math.abs(t);return e>=Py?z5(t,e,Py,"day"):e>=mC?z5(t,e,mC,"hour"):e>=fC?z5(t,e,fC,"minute"):e>=pC?z5(t,e,pC,"second"):t+" ms"}function z5(t,e,r,n){var o=e>=r*1.5;return Math.round(t/r)+" "+n+(o?"s":"")}});var w$=O((qfr,Jfe)=>{function bqe(t){r.debug=r,r.default=r,r.coerce=u,r.disable=s,r.enable=o,r.enabled=a,r.humanize=Xfe(),r.destroy=l,Object.keys(t).forEach(d=>{r[d]=t[d]}),r.names=[],r.skips=[],r.formatters={};function e(d){let p=0;for(let f=0;f<d.length;f++)p=(p<<5)-p+d.charCodeAt(f),p|=0;return r.colors[Math.abs(p)%r.colors.length]}r.selectColor=e;function r(d){let p,f=null,m,h;function g(...v){if(!g.enabled)return;let y=g,_=Number(new Date),x=_-(p||_);y.diff=x,y.prev=p,y.curr=_,p=_,v[0]=r.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let S=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(E,R)=>{if(E==="%%")return"%";S++;let B=r.formatters[R];if(typeof B=="function"){let V=v[S];E=B.call(y,V),v.splice(S,1),S--}return E}),r.formatArgs.call(y,v),(y.log||r.log).apply(y,v)}return g.namespace=d,g.useColors=r.useColors(),g.color=r.selectColor(d),g.extend=n,g.destroy=r.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(m!==r.namespaces&&(m=r.namespaces,h=r.enabled(d)),h),set:v=>{f=v}}),typeof r.init=="function"&&r.init(g),g}function n(d,p){let f=r(this.namespace+(typeof p>"u"?":":p)+d);return f.log=this.log,f}function o(d){r.save(d),r.namespaces=d,r.names=[],r.skips=[];let p,f=(typeof d=="string"?d:"").split(/[\s,]+/),m=f.length;for(p=0;p<m;p++)f[p]&&(d=f[p].replace(/\*/g,".*?"),d[0]==="-"?r.skips.push(new RegExp("^"+d.slice(1)+"$")):r.names.push(new RegExp("^"+d+"$")))}function s(){let d=[...r.names.map(c),...r.skips.map(c).map(p=>"-"+p)].join(",");return r.enable(""),d}function a(d){if(d[d.length-1]==="*")return!0;let p,f;for(p=0,f=r.skips.length;p<f;p++)if(r.skips[p].test(d))return!1;for(p=0,f=r.names.length;p<f;p++)if(r.names[p].test(d))return!0;return!1}function c(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}function u(d){return d instanceof Error?d.stack||d.message:d}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}Jfe.exports=bqe});var Zfe=O((qc,$5)=>{qc.formatArgs=_qe;qc.save=xqe;qc.load=Sqe;qc.useColors=yqe;qc.storage=Iqe();qc.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();qc.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function yqe(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function _qe(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+$5.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,n=0;t[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(r++,o==="%c"&&(n=r))}),t.splice(n,0,e)}qc.log=console.debug||console.log||(()=>{});function xqe(t){try{t?qc.storage.setItem("debug",t):qc.storage.removeItem("debug")}catch{}}function Sqe(){let t;try{t=qc.storage.getItem("debug")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}function Iqe(){try{return localStorage}catch{}}$5.exports=w$()(qc);var{formatters:Cqe}=$5.exports;Cqe.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var tme=O((jfr,eme)=>{"use strict";eme.exports=(t,e=process.argv)=>{let r=t.startsWith("-")?"":t.length===1?"-":"--",n=e.indexOf(r+t),o=e.indexOf("--");return n!==-1&&(o===-1||n<o)}});var ime=O((Hfr,nme)=>{"use strict";var Tqe=require("os"),rme=require("tty"),Nu=tme(),{env:Xo}=process,Rv;Nu("no-color")||Nu("no-colors")||Nu("color=false")||Nu("color=never")?Rv=0:(Nu("color")||Nu("colors")||Nu("color=true")||Nu("color=always"))&&(Rv=1);"FORCE_COLOR"in Xo&&(Xo.FORCE_COLOR==="true"?Rv=1:Xo.FORCE_COLOR==="false"?Rv=0:Rv=Xo.FORCE_COLOR.length===0?1:Math.min(parseInt(Xo.FORCE_COLOR,10),3));function R$(t){return t===0?!1:{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}function k$(t,e){if(Rv===0)return 0;if(Nu("color=16m")||Nu("color=full")||Nu("color=truecolor"))return 3;if(Nu("color=256"))return 2;if(t&&!e&&Rv===void 0)return 0;let r=Rv||0;if(Xo.TERM==="dumb")return r;if(process.platform==="win32"){let n=Tqe.release().split(".");return Number(n[0])>=10&&Number(n[2])>=10586?Number(n[2])>=14931?3:2:1}if("CI"in Xo)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(n=>n in Xo)||Xo.CI_NAME==="codeship"?1:r;if("TEAMCITY_VERSION"in Xo)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Xo.TEAMCITY_VERSION)?1:0;if(Xo.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Xo){let n=parseInt((Xo.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Xo.TERM_PROGRAM){case"iTerm.app":return n>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Xo.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Xo.TERM)||"COLORTERM"in Xo?1:r}function Eqe(t){let e=k$(t,t&&t.isTTY);return R$(e)}nme.exports={supportsColor:Eqe,stdout:R$(k$(!0,rme.isatty(1))),stderr:R$(k$(!0,rme.isatty(2)))}});var sme=O((bs,K5)=>{var wqe=require("tty"),W5=require("util");bs.init=Lqe;bs.log=Aqe;bs.formatArgs=kqe;bs.save=Dqe;bs.load=Nqe;bs.useColors=Rqe;bs.destroy=W5.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");bs.colors=[6,2,3,4,5,1];try{let t=ime();t&&(t.stderr||t).level>=2&&(bs.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}bs.inspectOpts=Object.keys(process.env).filter(t=>/^debug_/i.test(t)).reduce((t,e)=>{let r=e.substring(6).toLowerCase().replace(/_([a-z])/g,(o,s)=>s.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),t[r]=n,t},{});function Rqe(){return"colors"in bs.inspectOpts?!!bs.inspectOpts.colors:wqe.isatty(process.stderr.fd)}function kqe(t){let{namespace:e,useColors:r}=this;if(r){let n=this.color,o="\x1B[3"+(n<8?n:"8;5;"+n),s=`  ${o};1m${e} \x1B[0m`;t[0]=s+t[0].split(`
`).join(`
`+s),t.push(o+"m+"+K5.exports.humanize(this.diff)+"\x1B[0m")}else t[0]=Pqe()+e+" "+t[0]}function Pqe(){return bs.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Aqe(...t){return process.stderr.write(W5.format(...t)+`
`)}function Dqe(t){t?process.env.DEBUG=t:delete process.env.DEBUG}function Nqe(){return process.env.DEBUG}function Lqe(t){t.inspectOpts={};let e=Object.keys(bs.inspectOpts);for(let r=0;r<e.length;r++)t.inspectOpts[e[r]]=bs.inspectOpts[e[r]]}K5.exports=w$()(bs);var{formatters:ome}=K5.exports;ome.o=function(t){return this.inspectOpts.colors=this.useColors,W5.inspect(t,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};ome.O=function(t){return this.inspectOpts.colors=this.useColors,W5.inspect(t,this.inspectOpts)}});var $l=O((Vfr,P$)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?P$.exports=Zfe():P$.exports=sme()});var M$=O(($fr,lme)=>{var ZP=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Oqe=typeof AbortController=="function",Y5=Oqe?AbortController:class{constructor(){this.signal=new ame}abort(){this.signal.dispatchEvent("abort")}},Mqe=typeof AbortSignal=="function",Fqe=typeof Y5.AbortSignal=="function",ame=Mqe?AbortSignal:Fqe?Y5.AbortController:class{constructor(){this.aborted=!1,this._listeners=[]}dispatchEvent(e){if(e==="abort"){this.aborted=!0;let r={type:e,target:this};this.onabort(r),this._listeners.forEach(n=>n(r),this)}}onabort(){}addEventListener(e,r){e==="abort"&&this._listeners.push(r)}removeEventListener(e,r){e==="abort"&&(this._listeners=this._listeners.filter(n=>n!==r))}},L$=new Set,A$=(t,e)=>{let r=`LRU_CACHE_OPTION_${t}`;Q5(r)&&O$(r,`${t} option`,`options.${e}`,gC)},D$=(t,e)=>{let r=`LRU_CACHE_METHOD_${t}`;if(Q5(r)){let{prototype:n}=gC,{get:o}=Object.getOwnPropertyDescriptor(n,t);O$(r,`${t} method`,`cache.${e}()`,o)}},Uqe=(t,e)=>{let r=`LRU_CACHE_PROPERTY_${t}`;if(Q5(r)){let{prototype:n}=gC,{get:o}=Object.getOwnPropertyDescriptor(n,t);O$(r,`${t} property`,`cache.${e}`,o)}},cme=(...t)=>{typeof process=="object"&&process&&typeof process.emitWarning=="function"?process.emitWarning(...t):console.error(...t)},Q5=t=>!L$.has(t),O$=(t,e,r,n)=>{L$.add(t);let o=`The ${e} is deprecated. Please use ${r} instead.`;cme(o,"DeprecationWarning",t,n)},Ay=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),ume=t=>Ay(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?hC:null:null,hC=class extends Array{constructor(e){super(e),this.fill(0)}},N$=class{constructor(e){if(e===0)return[];let r=ume(e);this.heap=new r(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}},gC=class t{constructor(e={}){let{max:r=0,ttl:n,ttlResolution:o=1,ttlAutopurge:s,updateAgeOnGet:a,updateAgeOnHas:c,allowStale:u,dispose:l,disposeAfter:d,noDisposeOnSet:p,noUpdateTTL:f,maxSize:m=0,sizeCalculation:h,fetchMethod:g,fetchContext:v,noDeleteOnFetchRejection:y,noDeleteOnStaleGet:_}=e,{length:x,maxAge:S,stale:I}=e instanceof t?{}:e;if(r!==0&&!Ay(r))throw new TypeError("max option must be a nonnegative integer");let E=r?ume(r):Array;if(!E)throw new Error("invalid max value: "+r);if(this.max=r,this.maxSize=m,this.sizeCalculation=h||x,this.sizeCalculation){if(!this.maxSize)throw new TypeError("cannot set sizeCalculation without setting maxSize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(this.fetchMethod=g||null,this.fetchMethod&&typeof this.fetchMethod!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.fetchContext=v,!this.fetchMethod&&v!==void 0)throw new TypeError("cannot set fetchContext without fetchMethod");if(this.keyMap=new Map,this.keyList=new Array(r).fill(null),this.valList=new Array(r).fill(null),this.next=new E(r),this.prev=new E(r),this.head=0,this.tail=0,this.free=new N$(r),this.initialFill=1,this.size=0,typeof l=="function"&&(this.dispose=l),typeof d=="function"?(this.disposeAfter=d,this.disposed=[]):(this.disposeAfter=null,this.disposed=null),this.noDisposeOnSet=!!p,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!y,this.maxSize!==0){if(!Ay(this.maxSize))throw new TypeError("maxSize must be a positive integer if specified");this.initializeSizeTracking()}if(this.allowStale=!!u||!!I,this.noDeleteOnStaleGet=!!_,this.updateAgeOnGet=!!a,this.updateAgeOnHas=!!c,this.ttlResolution=Ay(o)||o===0?o:1,this.ttlAutopurge=!!s,this.ttl=n||S||0,this.ttl){if(!Ay(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.initializeTTLTracking()}if(this.max===0&&this.ttl===0&&this.maxSize===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.max&&!this.maxSize){let R="LRU_CACHE_UNBOUNDED";Q5(R)&&(L$.add(R),cme("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",R,t))}I&&A$("stale","allowStale"),S&&A$("maxAge","ttl"),x&&A$("length","sizeCalculation")}getRemainingTTL(e){return this.has(e,{updateAgeOnHas:!1})?1/0:0}initializeTTLTracking(){this.ttls=new hC(this.max),this.starts=new hC(this.max),this.setItemTTL=(n,o,s=ZP.now())=>{if(this.starts[n]=o!==0?s:0,this.ttls[n]=o,o!==0&&this.ttlAutopurge){let a=setTimeout(()=>{this.isStale(n)&&this.delete(this.keyList[n])},o+1);a.unref&&a.unref()}},this.updateItemAge=n=>{this.starts[n]=this.ttls[n]!==0?ZP.now():0};let e=0,r=()=>{let n=ZP.now();if(this.ttlResolution>0){e=n;let o=setTimeout(()=>e=0,this.ttlResolution);o.unref&&o.unref()}return n};this.getRemainingTTL=n=>{let o=this.keyMap.get(n);return o===void 0?0:this.ttls[o]===0||this.starts[o]===0?1/0:this.starts[o]+this.ttls[o]-(e||r())},this.isStale=n=>this.ttls[n]!==0&&this.starts[n]!==0&&(e||r())-this.starts[n]>this.ttls[n]}updateItemAge(e){}setItemTTL(e,r,n){}isStale(e){return!1}initializeSizeTracking(){this.calculatedSize=0,this.sizes=new hC(this.max),this.removeItemSize=e=>{this.calculatedSize-=this.sizes[e],this.sizes[e]=0},this.requireSize=(e,r,n,o)=>{if(!Ay(n))if(o){if(typeof o!="function")throw new TypeError("sizeCalculation must be a function");if(n=o(r,e),!Ay(n))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer)");return n},this.addItemSize=(e,r)=>{this.sizes[e]=r;let n=this.maxSize-this.sizes[e];for(;this.calculatedSize>n;)this.evict(!0);this.calculatedSize+=this.sizes[e]}}removeItemSize(e){}addItemSize(e,r){}requireSize(e,r,n,o){if(n||o)throw new TypeError("cannot set size without setting maxSize on cache")}*indexes({allowStale:e=this.allowStale}={}){if(this.size)for(let r=this.tail;!(!this.isValidIndex(r)||((e||!this.isStale(r))&&(yield r),r===this.head));)r=this.prev[r]}*rindexes({allowStale:e=this.allowStale}={}){if(this.size)for(let r=this.head;!(!this.isValidIndex(r)||((e||!this.isStale(r))&&(yield r),r===this.tail));)r=this.next[r]}isValidIndex(e){return this.keyMap.get(this.keyList[e])===e}*entries(){for(let e of this.indexes())yield[this.keyList[e],this.valList[e]]}*rentries(){for(let e of this.rindexes())yield[this.keyList[e],this.valList[e]]}*keys(){for(let e of this.indexes())yield this.keyList[e]}*rkeys(){for(let e of this.rindexes())yield this.keyList[e]}*values(){for(let e of this.indexes())yield this.valList[e]}*rvalues(){for(let e of this.rindexes())yield this.valList[e]}[Symbol.iterator](){return this.entries()}find(e,r={}){for(let n of this.indexes())if(e(this.valList[n],this.keyList[n],this))return this.get(this.keyList[n],r)}forEach(e,r=this){for(let n of this.indexes())e.call(r,this.valList[n],this.keyList[n],this)}rforEach(e,r=this){for(let n of this.rindexes())e.call(r,this.valList[n],this.keyList[n],this)}get prune(){return D$("prune","purgeStale"),this.purgeStale}purgeStale(){let e=!1;for(let r of this.rindexes({allowStale:!0}))this.isStale(r)&&(this.delete(this.keyList[r]),e=!0);return e}dump(){let e=[];for(let r of this.indexes({allowStale:!0})){let n=this.keyList[r],o=this.valList[r],a={value:this.isBackgroundFetch(o)?o.__staleWhileFetching:o};if(this.ttls){a.ttl=this.ttls[r];let c=ZP.now()-this.starts[r];a.start=Math.floor(Date.now()-c)}this.sizes&&(a.size=this.sizes[r]),e.unshift([n,a])}return e}load(e){this.clear();for(let[r,n]of e){if(n.start){let o=Date.now()-n.start;n.start=ZP.now()-o}this.set(r,n.value,n)}}dispose(e,r,n){}set(e,r,{ttl:n=this.ttl,start:o,noDisposeOnSet:s=this.noDisposeOnSet,size:a=0,sizeCalculation:c=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL}={}){if(a=this.requireSize(e,r,a,c),this.maxSize&&a>this.maxSize)return this;let l=this.size===0?void 0:this.keyMap.get(e);if(l===void 0)l=this.newIndex(),this.keyList[l]=e,this.valList[l]=r,this.keyMap.set(e,l),this.next[this.tail]=l,this.prev[l]=this.tail,this.tail=l,this.size++,this.addItemSize(l,a),u=!1;else{let d=this.valList[l];r!==d&&(this.isBackgroundFetch(d)?d.__abortController.abort():s||(this.dispose(d,e,"set"),this.disposeAfter&&this.disposed.push([d,e,"set"])),this.removeItemSize(l),this.valList[l]=r,this.addItemSize(l,a)),this.moveToTail(l)}if(n!==0&&this.ttl===0&&!this.ttls&&this.initializeTTLTracking(),u||this.setItemTTL(l,n,o),this.disposeAfter)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return this}newIndex(){return this.size===0?this.tail:this.size===this.max&&this.max!==0?this.evict(!1):this.free.length!==0?this.free.pop():this.initialFill++}pop(){if(this.size){let e=this.valList[this.head];return this.evict(!0),e}}evict(e){let r=this.head,n=this.keyList[r],o=this.valList[r];return this.isBackgroundFetch(o)?o.__abortController.abort():(this.dispose(o,n,"evict"),this.disposeAfter&&this.disposed.push([o,n,"evict"])),this.removeItemSize(r),e&&(this.keyList[r]=null,this.valList[r]=null,this.free.push(r)),this.head=this.next[r],this.keyMap.delete(n),this.size--,r}has(e,{updateAgeOnHas:r=this.updateAgeOnHas}={}){let n=this.keyMap.get(e);return n!==void 0&&!this.isStale(n)?(r&&this.updateItemAge(n),!0):!1}peek(e,{allowStale:r=this.allowStale}={}){let n=this.keyMap.get(e);if(n!==void 0&&(r||!this.isStale(n))){let o=this.valList[n];return this.isBackgroundFetch(o)?o.__staleWhileFetching:o}}backgroundFetch(e,r,n,o){let s=r===void 0?void 0:this.valList[r];if(this.isBackgroundFetch(s))return s;let a=new Y5,c={signal:a.signal,options:n,context:o},u=f=>(a.signal.aborted||this.set(e,f,c.options),f),l=f=>{if(this.valList[r]===p&&(!n.noDeleteOnFetchRejection||p.__staleWhileFetching===void 0?this.delete(e):this.valList[r]=p.__staleWhileFetching),p.__returned===p)throw f},d=f=>f(this.fetchMethod(e,s,c)),p=new Promise(d).then(u,l);return p.__abortController=a,p.__staleWhileFetching=s,p.__returned=null,r===void 0?(this.set(e,p,c.options),r=this.keyMap.get(e)):this.valList[r]=p,p}isBackgroundFetch(e){return e&&typeof e=="object"&&typeof e.then=="function"&&Object.prototype.hasOwnProperty.call(e,"__staleWhileFetching")&&Object.prototype.hasOwnProperty.call(e,"__returned")&&(e.__returned===e||e.__returned===null)}async fetch(e,{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,ttl:s=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:c=0,sizeCalculation:u=this.sizeCalculation,noUpdateTTL:l=this.noUpdateTTL,noDeleteOnFetchRejection:d=this.noDeleteOnFetchRejection,fetchContext:p=this.fetchContext,forceRefresh:f=!1}={}){if(!this.fetchMethod)return this.get(e,{allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:o});let m={allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:o,ttl:s,noDisposeOnSet:a,size:c,sizeCalculation:u,noUpdateTTL:l,noDeleteOnFetchRejection:d},h=this.keyMap.get(e);if(h===void 0){let g=this.backgroundFetch(e,h,m,p);return g.__returned=g}else{let g=this.valList[h];if(this.isBackgroundFetch(g))return r&&g.__staleWhileFetching!==void 0?g.__staleWhileFetching:g.__returned=g;if(!f&&!this.isStale(h))return this.moveToTail(h),n&&this.updateItemAge(h),g;let v=this.backgroundFetch(e,h,m,p);return r&&v.__staleWhileFetching!==void 0?v.__staleWhileFetching:v.__returned=v}}get(e,{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet}={}){let s=this.keyMap.get(e);if(s!==void 0){let a=this.valList[s],c=this.isBackgroundFetch(a);return this.isStale(s)?c?r?a.__staleWhileFetching:void 0:(o||this.delete(e),r?a:void 0):c?void 0:(this.moveToTail(s),n&&this.updateItemAge(s),a)}}connect(e,r){this.prev[r]=e,this.next[e]=r}moveToTail(e){e!==this.tail&&(e===this.head?this.head=this.next[e]:this.connect(this.prev[e],this.next[e]),this.connect(this.tail,e),this.tail=e)}get del(){return D$("del","delete"),this.delete}delete(e){let r=!1;if(this.size!==0){let n=this.keyMap.get(e);if(n!==void 0)if(r=!0,this.size===1)this.clear();else{this.removeItemSize(n);let o=this.valList[n];this.isBackgroundFetch(o)?o.__abortController.abort():(this.dispose(o,e,"delete"),this.disposeAfter&&this.disposed.push([o,e,"delete"])),this.keyMap.delete(e),this.keyList[n]=null,this.valList[n]=null,n===this.tail?this.tail=this.prev[n]:n===this.head?this.head=this.next[n]:(this.next[this.prev[n]]=this.next[n],this.prev[this.next[n]]=this.prev[n]),this.size--,this.free.push(n)}}if(this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return r}clear(){for(let e of this.rindexes({allowStale:!0})){let r=this.valList[e];if(this.isBackgroundFetch(r))r.__abortController.abort();else{let n=this.keyList[e];this.dispose(r,n,"delete"),this.disposeAfter&&this.disposed.push([r,n,"delete"])}}if(this.keyMap.clear(),this.valList.fill(null),this.keyList.fill(null),this.ttls&&(this.ttls.fill(0),this.starts.fill(0)),this.sizes&&this.sizes.fill(0),this.head=0,this.tail=0,this.initialFill=1,this.free.length=0,this.calculatedSize=0,this.size=0,this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift())}get reset(){return D$("reset","clear"),this.clear}get length(){return Uqe("length","size"),this.size}static get AbortController(){return Y5}static get AbortSignal(){return ame}};lme.exports=gC});var B$=O((Wfr,dme)=>{"use strict";var e2=class extends Error{constructor(e,r,n){super(e),this.type=r,this._name=n}get name(){return this._name}get[Symbol.toStringTag](){return this._name}},F$=class extends e2{constructor(e,r,n){super(e,r,"FetchError"),n&&(this.code=n.code,this.errno=n.errno,this.erroredSysCall=n.syscall)}},U$=class extends e2{constructor(e,r="aborted"){super(e,r,"AbortError")}};dme.exports={FetchBaseError:e2,FetchError:F$,AbortError:U$}});var gm=O((Kfr,fme)=>{"use strict";var{constants:{MAX_LENGTH:Bqe}}=require("buffer"),{pipeline:X5,PassThrough:qqe}=require("stream"),{promisify:jqe}=require("util"),{createGunzip:Hqe,createInflate:Vqe,createBrotliDecompress:Gqe,constants:{Z_SYNC_FLUSH:pme}}=require("zlib"),zqe=$l()("helix-fetch:utils"),$qe=jqe(X5),Wqe=(t,e)=>t===204||t===304||+e["content-length"]==0?!1:/^\s*(?:(x-)?deflate|(x-)?gzip|br)\s*$/.test(e["content-encoding"]),Kqe=(t,e,r,n)=>{if(!Wqe(t,e))return r;let o=s=>{s&&(zqe(`encountered error while decoding stream: ${s}`),n(s))};switch(e["content-encoding"].trim()){case"gzip":case"x-gzip":return X5(r,Hqe({flush:pme,finishFlush:pme}),o);case"deflate":case"x-deflate":return X5(r,Vqe(),o);case"br":return X5(r,Gqe(),o);default:return r}},Yqe=t=>{if(!t||typeof t!="object"||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},J5=(t,e)=>{if(Buffer.isBuffer(t))return t.length;switch(typeof t){case"string":return t.length*2;case"boolean":return 4;case"number":return 8;case"symbol":return Symbol.keyFor(t)?Symbol.keyFor(t).length*2:(t.toString().length-8)*2;case"object":return Array.isArray(t)?Qqe(t,e):Xqe(t,e);default:return 0}},Qqe=(t,e)=>(e.add(t),t.map(r=>e.has(r)?0:J5(r,e)).reduce((r,n)=>r+n,0)),Xqe=(t,e)=>{if(t==null)return 0;e.add(t);let r=0,n=[];for(let o in t)n.push(o);return n.push(...Object.getOwnPropertySymbols(t)),n.forEach(o=>{if(r+=J5(o,e),typeof t[o]=="object"&&t[o]!==null){if(e.has(t[o]))return;e.add(t[o])}r+=J5(t[o],e)}),r},Jqe=t=>J5(t,new WeakSet),Zqe=async t=>{let e=new qqe,r=0,n=[];return e.on("data",o=>{if(r+o.length>Bqe)throw new Error("Buffer.constants.MAX_SIZE exceeded");n.push(o),r+=o.length}),await $qe(t,e),Buffer.concat(n,r)};fme.exports={decodeStream:Kqe,isPlainObject:Yqe,sizeof:Jqe,streamToBuffer:Zqe}});var eM=O((Yfr,vme)=>{"use strict";var{PassThrough:mme,Readable:vm}=require("stream"),{types:{isAnyArrayBuffer:gme}}=require("util"),{FetchError:eje,FetchBaseError:tje}=B$(),{streamToBuffer:rje}=gm(),nje=Buffer.alloc(0),Lu=Symbol("Body internals"),ije=t=>t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength),hme=async t=>{if(t[Lu].disturbed)throw new TypeError("Already read");if(t[Lu].error)throw new TypeError(`Stream had error: ${t[Lu].error.message}`);t[Lu].disturbed=!0;let{stream:e}=t[Lu];return e===null?nje:rje(e)},Z5=class{constructor(e){let r;e==null?r=null:e instanceof URLSearchParams?r=vm.from(e.toString()):e instanceof vm?r=e:Buffer.isBuffer(e)?r=vm.from(e):gme(e)?r=vm.from(Buffer.from(e)):typeof e=="string"||e instanceof String?r=vm.from(e):r=vm.from(String(e)),this[Lu]={stream:r,disturbed:!1,error:null},e instanceof vm&&r.on("error",n=>{let o=n instanceof tje?n:new eje(`Invalid response body while trying to fetch ${this.url}: ${n.message}`,"system",n);this[Lu].error=o})}get body(){return this[Lu].stream}get bodyUsed(){return this[Lu].disturbed}async buffer(){return hme(this)}async arrayBuffer(){return ije(await this.buffer())}async text(){return(await hme(this)).toString()}async json(){return JSON.parse(await this.text())}};Object.defineProperties(Z5.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}});var oje=t=>{if(t[Lu].disturbed)throw new TypeError("Cannot clone: already read");let{stream:e}=t[Lu],r=e;if(e instanceof vm){r=new mme;let n=new mme;e.pipe(r),e.pipe(n),t[Lu].stream=n}return r},sje=t=>t===null?null:typeof t=="string"?"text/plain; charset=utf-8":t instanceof URLSearchParams?"application/x-www-form-urlencoded; charset=utf-8":Buffer.isBuffer(t)||gme(t)||t instanceof vm?null:"text/plain; charset=utf-8";vme.exports={Body:Z5,cloneStream:oje,guessContentType:sje}});var vC=O((Qfr,xme)=>{"use strict";var{validateHeaderName:bme,validateHeaderValue:yme}=require("http"),{isPlainObject:aje}=gm(),bm=Symbol("Headers internals"),t2=t=>{let e=typeof t!="string"?String(t):t;if(typeof bme=="function")bme(e);else if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(e)){let r=new TypeError(`Header name must be a valid HTTP token [${e}]`);throw Object.defineProperty(r,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),r}return e.toLowerCase()},_me=(t,e)=>{let r=typeof t!="string"?String(t):t;if(typeof yme=="function")yme(e,r);else if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(r)){let n=new TypeError(`Invalid character in header content ["${e}"]`);throw Object.defineProperty(n,"code",{value:"ERR_INVALID_CHAR"}),n}return r},tM=class t{constructor(e={}){if(this[bm]={map:new Map},e instanceof t)e.forEach((r,n)=>{this.append(n,r)});else if(Array.isArray(e))e.forEach(([r,n])=>{this.append(r,n)});else if(aje(e))for(let[r,n]of Object.entries(e))this.append(r,n)}set(e,r){this[bm].map.set(t2(e),_me(r,e))}has(e){return this[bm].map.has(t2(e))}get(e){let r=this[bm].map.get(t2(e));return r===void 0?null:r}append(e,r){let n=t2(e),o=_me(r,e),s=this[bm].map.get(n);this[bm].map.set(n,s?`${s}, ${o}`:o)}delete(e){this[bm].map.delete(t2(e))}forEach(e,r){for(let n of this.keys())e.call(r,this.get(n),n)}keys(){return Array.from(this[bm].map.keys()).sort()}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return this.constructor.name}plain(){return Object.fromEntries(this[bm].map)}};Object.defineProperties(tM.prototype,["append","delete","entries","forEach","get","has","keys","set","values"].reduce((t,e)=>(t[e]={enumerable:!0},t),{}));xme.exports={Headers:tM}});var q$=O((Xfr,Sme)=>{"use strict";var{EventEmitter:cje}=require("events"),Wl=Symbol("AbortSignal internals"),bC=class{constructor(){this[Wl]={eventEmitter:new cje,onabort:null,aborted:!1}}get aborted(){return this[Wl].aborted}get onabort(){return this[Wl].onabort}set onabort(e){this[Wl].onabort=e}get[Symbol.toStringTag](){return this.constructor.name}removeEventListener(e,r){this[Wl].eventEmitter.removeListener(e,r)}addEventListener(e,r){this[Wl].eventEmitter.on(e,r)}dispatchEvent(e){let r={type:e,target:this},n=`on${e}`;typeof this[Wl][n]=="function"&&this[n](r),this[Wl].eventEmitter.emit(e,r)}fire(){this[Wl].aborted=!0,this.dispatchEvent("abort")}};Object.defineProperties(bC.prototype,{addEventListener:{enumerable:!0},removeEventListener:{enumerable:!0},dispatchEvent:{enumerable:!0},aborted:{enumerable:!0},onabort:{enumerable:!0}});var nM=class extends bC{constructor(e){if(!Number.isInteger(e))throw new TypeError(`Expected an integer, got ${typeof e}`);super(),this[Wl].timerId=setTimeout(()=>{this.fire()},e)}clear(){clearTimeout(this[Wl].timerId)}};Object.defineProperties(nM.prototype,{clear:{enumerable:!0}});var rM=Symbol("AbortController internals"),iM=class{constructor(){this[rM]={signal:new bC}}get signal(){return this[rM].signal}get[Symbol.toStringTag](){return this.constructor.name}abort(){this[rM].signal.aborted||this[rM].signal.fire()}};Object.defineProperties(iM.prototype,{signal:{enumerable:!0},abort:{enumerable:!0}});Sme.exports={AbortController:iM,AbortSignal:bC,TimeoutSignal:nM}});var r2=O((Jfr,Tme)=>{"use strict";var{randomBytes:uje}=require("crypto"),{Readable:lje}=require("stream"),H$=t=>typeof t=="object"&&["arrayBuffer","stream","text","slice","constructor"].map(e=>typeof t[e]).filter(e=>e!=="function").length===0&&typeof t.type=="string"&&typeof t.size=="number"&&/^(Blob|File)$/.test(t[Symbol.toStringTag]),dje=t=>t!=null&&typeof t=="object"&&["append","delete","get","getAll","has","set","keys","values","entries","constructor"].map(e=>typeof t[e]).filter(e=>e!=="function").length===0&&t[Symbol.toStringTag]==="FormData",Ime=t=>`--${t}--\r
\r
`,Cme=(t,e,r)=>{let n="";return n+=`--${t}\r
`,n+=`Content-Disposition: form-data; name="${e}"`,H$(r)&&(n+=`; filename="${r.name}"\r
`,n+=`Content-Type: ${r.type||"application/octet-stream"}`),`${n}\r
\r
`};async function*pje(t,e){for(let[r,n]of t)yield Cme(e,r,n),H$(n)?yield*n.stream():yield n,yield`\r
`;yield Ime(e)}var fje=(t,e)=>{let r=0;for(let[n,o]of t)r+=Buffer.byteLength(Cme(e,n,o)),r+=H$(o)?o.size:Buffer.byteLength(String(o)),r+=Buffer.byteLength(`\r
`);return r+=Buffer.byteLength(Ime(e)),r},j$=class{constructor(e){this.fd=e,this.boundary=uje(8).toString("hex")}length(){return typeof this._length>"u"&&(this._length=fje(this.fd,this.boundary)),this._length}contentType(){return`multipart/form-data; boundary=${this.boundary}`}stream(){return lje.from(pje(this.fd,this.boundary))}};Tme.exports={isFormData:dje,FormDataSerializer:j$}});var wme=O((Zfr,Eme)=>{"use strict";var{AbortSignal:mje}=q$(),{Body:hje,cloneStream:gje,guessContentType:vje}=eM(),{Headers:bje}=vC(),{isPlainObject:yje}=gm(),{isFormData:_je,FormDataSerializer:xje}=r2(),Sje=20,kv=Symbol("Request internals"),oM=class t extends hje{constructor(e,r={}){let n=e instanceof t?e:null,o=n?new URL(n.url):new URL(e),s=r.method||n&&n.method||"GET";if(s=s.toUpperCase(),(r.body!=null||n&&n.body!==null)&&["GET","HEAD"].includes(s))throw new TypeError("Request with GET/HEAD method cannot have body");let a=r.body||(n&&n.body?gje(n):null),c=new bje(r.headers||n&&n.headers||{});if(_je(a)&&!c.has("content-type")){let p=new xje(a);a=p.stream(),c.set("content-type",p.contentType()),!c.has("transfer-encoding")&&!c.has("content-length")&&c.set("content-length",p.length())}if(!c.has("content-type"))if(yje(a))a=JSON.stringify(a),c.set("content-type","application/json");else{let p=vje(a);p&&c.set("content-type",p)}super(a);let u=n?n.signal:null;if("signal"in r&&(u=r.signal),u&&!(u instanceof mje))throw new TypeError("signal needs to be an instance of AbortSignal");let l=r.redirect||n&&n.redirect||"follow";if(!["follow","error","manual"].includes(l))throw new TypeError(`'${l}' is not a valid redirect option`);let d=r.cache||n&&n.cache||"default";if(!["default","no-store","reload","no-cache","force-cache","only-if-cached"].includes(d))throw new TypeError(`'${d}' is not a valid cache option`);this[kv]={init:{...r},method:s,redirect:l,cache:d,headers:c,parsedURL:o,signal:u},r.follow===void 0?!n||n.follow===void 0?this.follow=Sje:this.follow=n.follow:this.follow=r.follow,this.counter=r.counter||n&&n.counter||0,r.compress===void 0?!n||n.compress===void 0?this.compress=!0:this.compress=n.compress:this.compress=r.compress,r.decode===void 0?!n||n.decode===void 0?this.decode=!0:this.decode=n.decode:this.decode=r.decode}get method(){return this[kv].method}get url(){return this[kv].parsedURL.toString()}get headers(){return this[kv].headers}get redirect(){return this[kv].redirect}get cache(){return this[kv].cache}get signal(){return this[kv].signal}clone(){return new t(this)}get init(){return this[kv].init}get[Symbol.toStringTag](){return this.constructor.name}};Object.defineProperties(oM.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},cache:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}});Eme.exports={Request:oM}});var V$=O((emr,Rme)=>{"use strict";var{Body:Ije,cloneStream:Cje,guessContentType:Tje}=eM(),{Headers:Eje}=vC(),{isPlainObject:wje}=gm(),{isFormData:Rje,FormDataSerializer:kje}=r2(),Kl=Symbol("Response internals"),sM=class t extends Ije{constructor(e=null,r={}){let n=new Eje(r.headers),o=e;if(Rje(o)&&!n.has("content-type")){let s=new kje(o);o=s.stream(),n.set("content-type",s.contentType()),!n.has("transfer-encoding")&&!n.has("content-length")&&n.set("content-length",s.length())}if(o!==null&&!n.has("content-type"))if(wje(o))o=JSON.stringify(o),n.set("content-type","application/json");else{let s=Tje(o);s&&n.set("content-type",s)}super(o),this[Kl]={url:r.url,status:r.status||200,statusText:r.statusText||"",headers:n,httpVersion:r.httpVersion,decoded:r.decoded,counter:r.counter}}get url(){return this[Kl].url||""}get status(){return this[Kl].status}get statusText(){return this[Kl].statusText}get ok(){return this[Kl].status>=200&&this[Kl].status<300}get redirected(){return this[Kl].counter>0}get headers(){return this[Kl].headers}get httpVersion(){return this[Kl].httpVersion}get decoded(){return this[Kl].decoded}static redirect(e,r=302){if(![301,302,303,307,308].includes(r))throw new RangeError("Invalid status code");return new t(null,{headers:{location:new URL(e).toString()},status:r})}clone(){if(this.bodyUsed)throw new TypeError("Cannot clone: already read");return new t(Cje(this),{...this[Kl]})}get[Symbol.toStringTag](){return this.constructor.name}};Object.defineProperties(sM.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});Rme.exports={Response:sM}});var Pme=O((rmr,kme)=>{"use strict";var Pje=new Set([200,203,204,206,300,301,308,404,405,410,414,501]),Aje=new Set([200,203,204,300,301,302,303,307,308,404,405,410,414,501]),Dje=new Set([500,502,503,504]),Nje={date:!0,connection:!0,"keep-alive":!0,"proxy-authenticate":!0,"proxy-authorization":!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0},Lje={"content-length":!0,"content-encoding":!0,"transfer-encoding":!0,"content-range":!0};function Dy(t){let e=parseInt(t,10);return isFinite(e)?e:0}function Oje(t){return t?Dje.has(t.status):!0}function G$(t){let e={};if(!t)return e;let r=t.trim().split(/,/);for(let n of r){let[o,s]=n.split(/=/,2);e[o.trim()]=s===void 0?!0:s.trim().replace(/^"|"$/g,"")}return e}function Mje(t){let e=[];for(let r in t){let n=t[r];e.push(n===!0?r:r+"="+n)}if(e.length)return e.join(", ")}kme.exports=class{constructor(e,r,{shared:n,cacheHeuristic:o,immutableMinTimeToLive:s,ignoreCargoCult:a,_fromObject:c}={}){if(c){this._fromObject(c);return}if(!r||!r.headers)throw Error("Response headers missing");this._assertRequestHasHeaders(e),this._responseTime=this.now(),this._isShared=n!==!1,this._cacheHeuristic=o!==void 0?o:.1,this._immutableMinTtl=s!==void 0?s:24*3600*1e3,this._status="status"in r?r.status:200,this._resHeaders=r.headers,this._rescc=G$(r.headers["cache-control"]),this._method="method"in e?e.method:"GET",this._url=e.url,this._host=e.headers.host,this._noAuthorization=!e.headers.authorization,this._reqHeaders=r.headers.vary?e.headers:null,this._reqcc=G$(e.headers["cache-control"]),a&&"pre-check"in this._rescc&&"post-check"in this._rescc&&(delete this._rescc["pre-check"],delete this._rescc["post-check"],delete this._rescc["no-cache"],delete this._rescc["no-store"],delete this._rescc["must-revalidate"],this._resHeaders=Object.assign({},this._resHeaders,{"cache-control":Mje(this._rescc)}),delete this._resHeaders.expires,delete this._resHeaders.pragma),r.headers["cache-control"]==null&&/no-cache/.test(r.headers.pragma)&&(this._rescc["no-cache"]=!0)}now(){return Date.now()}storable(){return!!(!this._reqcc["no-store"]&&(this._method==="GET"||this._method==="HEAD"||this._method==="POST"&&this._hasExplicitExpiration())&&Aje.has(this._status)&&!this._rescc["no-store"]&&(!this._isShared||!this._rescc.private)&&(!this._isShared||this._noAuthorization||this._allowsStoringAuthenticated())&&(this._resHeaders.expires||this._rescc["max-age"]||this._isShared&&this._rescc["s-maxage"]||this._rescc.public||Pje.has(this._status)))}_hasExplicitExpiration(){return this._isShared&&this._rescc["s-maxage"]||this._rescc["max-age"]||this._resHeaders.expires}_assertRequestHasHeaders(e){if(!e||!e.headers)throw Error("Request headers missing")}satisfiesWithoutRevalidation(e){this._assertRequestHasHeaders(e);let r=G$(e.headers["cache-control"]);return r["no-cache"]||/no-cache/.test(e.headers.pragma)||r["max-age"]&&this.age()>r["max-age"]||r["min-fresh"]&&this.timeToLive()<1e3*r["min-fresh"]||this.stale()&&!(r["max-stale"]&&!this._rescc["must-revalidate"]&&(r["max-stale"]===!0||r["max-stale"]>this.age()-this.maxAge()))?!1:this._requestMatches(e,!1)}_requestMatches(e,r){return(!this._url||this._url===e.url)&&this._host===e.headers.host&&(!e.method||this._method===e.method||r&&e.method==="HEAD")&&this._varyMatches(e)}_allowsStoringAuthenticated(){return this._rescc["must-revalidate"]||this._rescc.public||this._rescc["s-maxage"]}_varyMatches(e){if(!this._resHeaders.vary)return!0;if(this._resHeaders.vary==="*")return!1;let r=this._resHeaders.vary.trim().toLowerCase().split(/\s*,\s*/);for(let n of r)if(e.headers[n]!==this._reqHeaders[n])return!1;return!0}_copyWithoutHopByHopHeaders(e){let r={};for(let n in e)Nje[n]||(r[n]=e[n]);if(e.connection){let n=e.connection.trim().split(/\s*,\s*/);for(let o of n)delete r[o]}if(r.warning){let n=r.warning.split(/,/).filter(o=>!/^\s*1[0-9][0-9]/.test(o));n.length?r.warning=n.join(",").trim():delete r.warning}return r}responseHeaders(){let e=this._copyWithoutHopByHopHeaders(this._resHeaders),r=this.age();return r>3600*24&&!this._hasExplicitExpiration()&&this.maxAge()>3600*24&&(e.warning=(e.warning?`${e.warning}, `:"")+'113 - "rfc7234 5.5.4"'),e.age=`${Math.round(r)}`,e.date=new Date(this.now()).toUTCString(),e}date(){let e=Date.parse(this._resHeaders.date);return isFinite(e)?e:this._responseTime}age(){let e=this._ageValue(),r=(this.now()-this._responseTime)/1e3;return e+r}_ageValue(){return Dy(this._resHeaders.age)}maxAge(){if(!this.storable()||this._rescc["no-cache"]||this._isShared&&this._resHeaders["set-cookie"]&&!this._rescc.public&&!this._rescc.immutable||this._resHeaders.vary==="*")return 0;if(this._isShared){if(this._rescc["proxy-revalidate"])return 0;if(this._rescc["s-maxage"])return Dy(this._rescc["s-maxage"])}if(this._rescc["max-age"])return Dy(this._rescc["max-age"]);let e=this._rescc.immutable?this._immutableMinTtl:0,r=this.date();if(this._resHeaders.expires){let n=Date.parse(this._resHeaders.expires);return Number.isNaN(n)||n<r?0:Math.max(e,(n-r)/1e3)}if(this._resHeaders["last-modified"]){let n=Date.parse(this._resHeaders["last-modified"]);if(isFinite(n)&&r>n)return Math.max(e,(r-n)/1e3*this._cacheHeuristic)}return e}timeToLive(){let e=this.maxAge()-this.age(),r=e+Dy(this._rescc["stale-if-error"]),n=e+Dy(this._rescc["stale-while-revalidate"]);return Math.max(0,e,r,n)*1e3}stale(){return this.maxAge()<=this.age()}_useStaleIfError(){return this.maxAge()+Dy(this._rescc["stale-if-error"])>this.age()}useStaleWhileRevalidate(){return this.maxAge()+Dy(this._rescc["stale-while-revalidate"])>this.age()}static fromObject(e){return new this(void 0,void 0,{_fromObject:e})}_fromObject(e){if(this._responseTime)throw Error("Reinitialized");if(!e||e.v!==1)throw Error("Invalid serialization");this._responseTime=e.t,this._isShared=e.sh,this._cacheHeuristic=e.ch,this._immutableMinTtl=e.imm!==void 0?e.imm:24*3600*1e3,this._status=e.st,this._resHeaders=e.resh,this._rescc=e.rescc,this._method=e.m,this._url=e.u,this._host=e.h,this._noAuthorization=e.a,this._reqHeaders=e.reqh,this._reqcc=e.reqcc}toObject(){return{v:1,t:this._responseTime,sh:this._isShared,ch:this._cacheHeuristic,imm:this._immutableMinTtl,st:this._status,resh:this._resHeaders,rescc:this._rescc,m:this._method,u:this._url,h:this._host,a:this._noAuthorization,reqh:this._reqHeaders,reqcc:this._reqcc}}revalidationHeaders(e){this._assertRequestHasHeaders(e);let r=this._copyWithoutHopByHopHeaders(e.headers);if(delete r["if-range"],!this._requestMatches(e,!0)||!this.storable())return delete r["if-none-match"],delete r["if-modified-since"],r;if(this._resHeaders.etag&&(r["if-none-match"]=r["if-none-match"]?`${r["if-none-match"]}, ${this._resHeaders.etag}`:this._resHeaders.etag),r["accept-ranges"]||r["if-match"]||r["if-unmodified-since"]||this._method&&this._method!="GET"){if(delete r["if-modified-since"],r["if-none-match"]){let o=r["if-none-match"].split(/,/).filter(s=>!/^\s*W\//.test(s));o.length?r["if-none-match"]=o.join(",").trim():delete r["if-none-match"]}}else this._resHeaders["last-modified"]&&!r["if-modified-since"]&&(r["if-modified-since"]=this._resHeaders["last-modified"]);return r}revalidatedPolicy(e,r){if(this._assertRequestHasHeaders(e),this._useStaleIfError()&&Oje(r))return{modified:!1,matches:!1,policy:this};if(!r||!r.headers)throw Error("Response headers missing");let n=!1;if(r.status!==void 0&&r.status!=304?n=!1:r.headers.etag&&!/^\s*W\//.test(r.headers.etag)?n=this._resHeaders.etag&&this._resHeaders.etag.replace(/^\s*W\//,"")===r.headers.etag:this._resHeaders.etag&&r.headers.etag?n=this._resHeaders.etag.replace(/^\s*W\//,"")===r.headers.etag.replace(/^\s*W\//,""):this._resHeaders["last-modified"]?n=this._resHeaders["last-modified"]===r.headers["last-modified"]:!this._resHeaders.etag&&!this._resHeaders["last-modified"]&&!r.headers.etag&&!r.headers["last-modified"]&&(n=!0),!n)return{policy:new this.constructor(e,r),modified:r.status!=304,matches:!1};let o={};for(let a in this._resHeaders)o[a]=a in r.headers&&!Lje[a]?r.headers[a]:this._resHeaders[a];let s=Object.assign({},r,{status:this._status,method:this._method,headers:o});return{policy:new this.constructor(e,s,{shared:this._isShared,cacheHeuristic:this._cacheHeuristic,immutableMinTimeToLive:this._immutableMinTtl}),modified:!1,matches:!0}}}});var Lme=O((nmr,Nme)=>{"use strict";var Fje=Pme(),{Headers:Uje}=vC(),Ame=t=>({url:t.url,method:t.method,headers:t.headers.plain()}),Dme=t=>({status:t.status,headers:t.headers.plain()}),z$=class{constructor(e,r,n){this.policy=new Fje(Ame(e),Dme(r),n)}storable(){return this.policy.storable()}satisfiesWithoutRevalidation(e){return this.policy.satisfiesWithoutRevalidation(Ame(e))}responseHeaders(e){return new Uje(this.policy.responseHeaders(Dme(e)))}timeToLive(){return this.policy.timeToLive()}};Nme.exports=z$});var Fme=O((imr,Mme)=>{"use strict";var{Readable:Bje}=require("stream"),{Headers:Ome}=vC(),{Response:qje}=V$(),Pv=Symbol("CacheableResponse internals"),jje=t=>t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength),$$=class t extends qje{constructor(e,r){super(e,r);let n=new Ome(r.headers);this[Pv]={headers:n,bufferedBody:e}}get headers(){return this[Pv].headers}set headers(e){if(e instanceof Ome)this[Pv].headers=e;else throw new TypeError("instance of Headers expected")}get body(){return Bje.from(this[Pv].bufferedBody)}get bodyUsed(){return!1}async buffer(){return this[Pv].bufferedBody}async arrayBuffer(){return jje(this[Pv].bufferedBody)}async text(){return this[Pv].bufferedBody.toString()}async json(){return JSON.parse(await this.text())}clone(){let{url:e,status:r,statusText:n,headers:o,httpVersion:s,decoded:a,counter:c}=this;return new t(this[Pv].bufferedBody,{url:e,status:r,statusText:n,headers:o,httpVersion:s,decoded:a,counter:c})}get[Symbol.toStringTag](){return this.constructor.name}},Hje=async t=>{let e=await t.buffer(),{url:r,status:n,statusText:o,headers:s,httpVersion:a,decoded:c,counter:u}=t;return new $$(e,{url:r,status:n,statusText:o,headers:s,httpVersion:a,decoded:c,counter:u})};Mme.exports={cacheableResponse:Hje}});var aM=O((omr,Ume)=>{"use strict";var W$=class extends Error{get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};Ume.exports={RequestAbortedError:W$}});var Vme=O((smr,Hme)=>{"use strict";var qme=require("http"),jme=require("https"),{Readable:Vje}=require("stream"),ym=$l()("helix-fetch:h1"),{RequestAbortedError:Bme}=aM(),{decodeStream:Gje}=gm(),zje=(t,e)=>{let{h1:r,options:{h1:n,rejectUnauthorized:o}}=t;return e==="https:"?r.httpsAgent?r.httpsAgent:n||typeof o=="boolean"?(r.httpsAgent=new jme.Agent(typeof o=="boolean"?{...n||{},rejectUnauthorized:o}:n),r.httpsAgent):void 0:r.httpAgent?r.httpAgent:n?(r.httpAgent=new qme.Agent(n),r.httpAgent):void 0},$je=t=>{t.h1={}},Wje=async({h1:t})=>{t.httpAgent&&(ym("resetContext: destroying httpAgent"),t.httpAgent.destroy(),delete t.httpAgent),t.httpsAgent&&(ym("resetContext: destroying httpsAgent"),t.httpsAgent.destroy(),delete t.httpsAgent)},Kje=(t,e,r)=>{let{statusCode:n,statusMessage:o,httpVersion:s,httpVersionMajor:a,httpVersionMinor:c,headers:u}=t,l=e?Gje(n,u,t,r):t;return{statusCode:n,statusText:o,httpVersion:s,httpVersionMajor:a,httpVersionMinor:c,headers:u,readable:l,decoded:!!(e&&l!==t)}},Yje=async(t,e,r)=>{let{request:n}=e.protocol==="https:"?jme:qme,o=zje(t,e.protocol),s={...r,agent:o},{socket:a,body:c}=s;return a&&(delete s.socket,a.assigned||(a.assigned=!0,o?s.agent=new Proxy(o,{get:(u,l)=>l==="createConnection"&&!a.inUse?(d,p)=>{ym(`agent reusing socket #${a.id} (${a.servername})`),a.inUse=!0,p(null,a)}:u[l]}):s.createConnection=(u,l)=>{ym(`reusing socket #${a.id} (${a.servername})`),a.inUse=!0,l(null,a)})),new Promise((u,l)=>{ym(`${s.method} ${e.href}`);let d,{signal:p}=s,f=()=>{p.removeEventListener("abort",f),a&&!a.inUse&&(ym(`discarding redundant socket used for ALPN: #${a.id} ${a.servername}`),a.destroy()),l(new Bme),d&&d.abort()};if(p){if(p.aborted){l(new Bme);return}p.addEventListener("abort",f)}d=n(e,s),d.once("response",m=>{p&&p.removeEventListener("abort",f),a&&!a.inUse&&(ym(`discarding redundant socket used for ALPN: #${a.id} ${a.servername}`),a.destroy()),u(Kje(m,s.decode,l))}),d.once("error",m=>{p&&p.removeEventListener("abort",f),a&&!a.inUse&&(ym(`discarding redundant socket used for ALPN: #${a.id} ${a.servername}`),a.destroy()),d.aborted||(ym(`${s.method} ${e.href} failed with: ${m.message}`),d.abort(),l(m))}),c instanceof Vje?c.pipe(d):(c&&d.write(c),d.end())})};Hme.exports={request:Yje,setupContext:$je,resetContext:Wje}});var Wme=O((amr,$me)=>{"use strict";var{connect:Qje,constants:Xje}=require("http2"),{Readable:Jje}=require("stream"),Gn=$l()("helix-fetch:h2"),{RequestAbortedError:Gme}=aM(),{decodeStream:Zje}=gm(),{NGHTTP2_CANCEL:n2}=Xje,eHe=5*60*1e3,tHe=5e3,rHe=t=>{t.h2={sessionCache:{}}},nHe=async({h2:t})=>Promise.all(Object.values(t.sessionCache).map(e=>new Promise(r=>{e.on("close",r),Gn(`resetContext: destroying session (socket #${e.socket&&e.socket.id}, ${e.socket&&e.socket.servername})`),e.destroy()}))),zme=(t,e,r,n=()=>{})=>{let o={...t},s=o[":status"];delete o[":status"];let a=r?Zje(s,t,e,n):e;return{statusCode:s,statusText:"",httpVersion:"2.0",httpVersionMajor:2,httpVersionMinor:0,headers:o,readable:a,decoded:!!(r&&a!==e)}},iHe=(t,e,r,n,o,s)=>{let{options:{h2:{pushPromiseHandler:a,pushHandler:c,pushedStreamIdleTimeout:u=tHe}}}=t,l=o[":path"],d=`${e}${l}`;Gn(`received PUSH_PROMISE: ${d}, stream #${n.id}, headers: ${JSON.stringify(o)}, flags: ${s}`),a&&a(d,o,()=>{n.close(n2)}),n.on("push",(p,f)=>{Gn(`received push headers for ${e}${l}, stream #${n.id}, headers: ${JSON.stringify(p)}, flags: ${f}`),n.setTimeout(u,()=>{Gn(`closing pushed stream #${n.id} after ${u} ms of inactivity`),n.close(n2)}),c&&c(d,o,zme(p,n,r))}),n.on("aborted",()=>{Gn(`pushed stream #${n.id} aborted`)}),n.on("error",p=>{Gn(`pushed stream #${n.id} encountered error: ${p}`)}),n.on("frameError",(p,f,m)=>{Gn(`pushed stream #${n.id} encountered frameError: type: ${p}, code: ${f}, id: ${m}`)})},oHe=async(t,e,r)=>{let{origin:n,pathname:o,search:s,hash:a}=e,c=`${o}${s}${a}`,{options:{h2:u={}},h2:{sessionCache:l}}=t,{idleSessionTimeout:d=eHe,pushPromiseHandler:p,pushHandler:f}=u,m={...r},{method:h,headers:g,socket:v,body:y,decode:_}=m;return v&&delete m.socket,g.host&&(g[":authority"]=g.host,delete g.host),new Promise((x,S)=>{let I=l[n];if(!I||I.closed||I.destroyed){let M=!(t.options.rejectUnauthorized===!1||u.rejectUnauthorized===!1),le={...u,rejectUnauthorized:M};v&&!v.inUse&&(le.createConnection=()=>(Gn(`reusing socket #${v.id} (${v.servername})`),v.inUse=!0,v)),I=Qje(n,{...le,settings:{enablePush:!!(p||f)}}),I.setMaxListeners(1e3),I.setTimeout(d,()=>{Gn(`closing session ${n} after ${d} ms of inactivity`),I.close()}),I.once("connect",()=>{Gn(`session ${n} established`),Gn(`caching session ${n}`),l[n]=I}),I.on("localSettings",q=>{Gn(`session ${n} localSettings: ${JSON.stringify(q)}`)}),I.on("remoteSettings",q=>{Gn(`session ${n} remoteSettings: ${JSON.stringify(q)}`)}),I.once("close",()=>{Gn(`session ${n} closed`),l[n]===I&&(Gn(`discarding cached session ${n}`),delete l[n])}),I.once("error",q=>{Gn(`session ${n} encountered error: ${q}`),l[n]===I&&(Gn(`discarding cached session ${n}`),delete l[n])}),I.on("frameError",(q,P,k)=>{Gn(`session ${n} encountered frameError: type: ${q}, code: ${P}, id: ${k}`)}),I.once("goaway",(q,P,k)=>{Gn(`session ${n} received GOAWAY frame: errorCode: ${q}, lastStreamID: ${P}, opaqueData: ${k?k.toString():void 0}`)}),I.on("stream",(q,P,k)=>{iHe(t,n,_,q,P,k)})}else v&&v.id!==I.socket.id&&!v.inUse&&(Gn(`discarding redundant socket used for ALPN: #${v.id} ${v.servername}`),v.destroy());Gn(`${h} ${e.host}${c}`);let E,{signal:R}=m,B=()=>{R.removeEventListener("abort",B),S(new Gme),E&&E.close(n2)};if(R){if(R.aborted){S(new Gme);return}R.addEventListener("abort",B)}let V=M=>{Gn(`session ${n} encountered error during ${m.method} ${e.href}: ${M}`),S(M)};I.once("error",V),E=I.request({":method":h,":path":c,...g}),E.once("response",M=>{I.off("error",V),R&&R.removeEventListener("abort",B),x(zme(M,E,m.decode,S))}),E.once("error",M=>{I.off("error",V),R&&R.removeEventListener("abort",B),E.rstCode!==n2&&(Gn(`${m.method} ${e.href} failed with: ${M.message}`),E.close(n2),S(M))}),E.once("frameError",(M,le,ne)=>{I.off("error",V),Gn(`encountered frameError during ${m.method} ${e.href}: type: ${M}, code: ${le}, id: ${ne}`)}),E.on("push",(M,le)=>{Gn(`received 'push' event: headers: ${JSON.stringify(M)}, flags: ${le}`)}),y instanceof Jje?y.pipe(E):(y&&E.write(y),E.end())})};$me.exports={request:oHe,setupContext:rHe,resetContext:nHe}});var Yme=O((cmr,Kme)=>{"use strict";var{EventEmitter:sHe}=require("events"),aHe=()=>{let t={},e=new sHe;return e.setMaxListeners(0),{acquire:r=>new Promise(n=>{if(!t[r]){t[r]=!0,n();return}let o=s=>{t[r]||(t[r]=!0,e.removeListener(r,o),n(s))};e.on(r,o)}),release:(r,n)=>{Reflect.deleteProperty(t,r),setImmediate(()=>e.emit(r,n))}}};Kme.exports=aHe});var Qme=O((umr,cHe)=>{cHe.exports={name:"@adobe/helix-fetch",version:"3.1.1",description:"Light-weight Fetch implementation transparently supporting both HTTP/1(.1) and HTTP/2",main:"src/index.js",scripts:{test:"nyc mocha",lint:"./node_modules/.bin/eslint .","semantic-release":"semantic-release"},mocha:{timeout:"5000",recursive:"true",reporter:"mocha-multi-reporters","reporter-options":"configFile=.mocha-multi.json"},engines:{node:">=12.0"},types:"src/index.d.ts",exports:{import:"./src/index.mjs",require:"./src/index.js"},repository:{type:"git",url:"https://github.com/adobe/helix-fetch"},author:"",license:"Apache-2.0",bugs:{url:"https://github.com/adobe/helix-fetch/issues"},homepage:"https://github.com/adobe/helix-fetch#readme",keywords:["fetch","whatwg","Fetch API","http","https","http2","h2","promise","async","request","RFC 7234","7234","caching","cache"],dependencies:{debug:"4.3.4","http-cache-semantics":"^4.1.1","lru-cache":"7.13.1"},devDependencies:{"@adobe/eslint-config-helix":"1.3.2","@semantic-release/changelog":"6.0.1","@semantic-release/git":"10.0.1",chai:"4.3.6","chai-as-promised":"7.1.1","chai-bytes":"0.1.2","chai-iterator":"3.0.2",eslint:"8.21.0","eslint-plugin-header":"3.1.1","eslint-plugin-import":"2.26.0","formdata-node":"4.3.3","lint-staged":"13.0.3",mocha:"10.0.0","mocha-multi-reporters":"1.5.1",nock:"13.2.9",nyc:"15.1.0","parse-cache-control":"1.0.1",pem:"1.14.6",proxy:"^1.0.2","semantic-release":"19.0.3",sinon:"14.0.0","stream-buffers":"3.0.2",tunnel:"^0.0.6"},"lint-staged":{"*.js":"eslint"},config:{commitizen:{path:"node_modules/cz-conventional-changelog"},ghooks:{"pre-commit":"npx lint-staged"}}}});var the=O((lmr,ehe)=>{"use strict";var{Readable:uHe}=require("stream"),lHe=require("tls"),{types:{isAnyArrayBuffer:dHe}}=require("util"),pHe=M$(),K$=$l()("helix-fetch:core"),{RequestAbortedError:cM}=aM(),Y$=Vme(),uM=Wme(),fHe=Yme(),{isPlainObject:mHe}=gm(),{isFormData:hHe,FormDataSerializer:gHe}=r2(),{version:vHe}=Qme(),Q$="h2",X$="h2c",J$="http/1.0",Ny="http/1.1",bHe=100,yHe=60*60*1e3,_He=[Q$,Ny,J$],xHe=`helix-fetch/${vHe}`,SHe={method:"GET",compress:!0,decode:!0},Xme=0,Jme=fHe(),Zme=(t,e)=>new Promise((r,n)=>{let{signal:o}=e,s,a=()=>{o.removeEventListener("abort",a);let l=new cM;n(l),s&&s.destroy(l)};if(o){if(o.aborted){n(new cM);return}o.addEventListener("abort",a)}let c=+t.port||443,u=l=>{o&&o.removeEventListener("abort",a),l instanceof cM||(K$(`connecting to ${t.hostname}:${c} failed with: ${l.message}`),n(l))};s=lHe.connect(c,t.hostname,e),s.once("secureConnect",()=>{o&&o.removeEventListener("abort",a),s.off("error",u),Xme+=1,s.id=Xme,s.secureConnecting=!1,K$(`established TLS connection: #${s.id} (${s.servername})`),r(s)}),s.once("error",u)}),IHe=async(t,e)=>{let r=await Jme.acquire(t.origin);try{return r||(r=await Zme(t,e)),r}finally{Jme.release(t.origin,r)}},CHe=async(t,e,r)=>{let n=`${e.protocol}//${e.host}`,o=t.alpnCache.get(n);if(o)return{protocol:o};switch(e.protocol){case"http:":return o=Ny,t.alpnCache.set(n,o),{protocol:o};case"http2:":return o=X$,t.alpnCache.set(n,o),{protocol:o};case"https:":break;default:throw new TypeError(`unsupported protocol: ${e.protocol}`)}let{options:{rejectUnauthorized:s,h1:a={},h2:c={}}}=t,u=!(s===!1||a.rejectUnauthorized===!1||c.rejectUnauthorized===!1),l={servername:e.hostname,ALPNProtocols:t.alpnProtocols,signal:r,rejectUnauthorized:u};t.options.ca&&(l.ca=t.options.ca);let d=await IHe(e,l);return o=d.alpnProtocol,o||(o=Ny),t.alpnCache.set(n,o),{protocol:o,socket:d}},THe=t=>{let e={};return Object.keys(t).forEach(r=>{e[r.toLowerCase()]=t[r]}),e},EHe=async(t,e,r,n)=>{let o=e.protocol==="https:",s;e.port?s=e.port:o?s=443:s=80;let a={...r,host:e.host,hostname:e.hostname,port:s},c=await t(a);if(o){let l={...a,ALPNProtocols:n};l.socket=c,l.servername=a.host;let d=await Zme(e,l);return{protocol:d.alpnProtocol||Ny,socket:d}}return{protocol:c.alpnProtocol||Ny,socket:c}},wHe=async(t,e,r)=>{let n=new URL(e),o={...SHe,...r||{}};typeof o.method=="string"&&(o.method=o.method.toUpperCase()),o.headers=THe(o.headers||{}),o.headers.host===void 0&&(o.headers.host=n.host),t.userAgent&&o.headers["user-agent"]===void 0&&(o.headers["user-agent"]=t.userAgent);let s;if(o.body instanceof URLSearchParams)s="application/x-www-form-urlencoded; charset=utf-8",o.body=o.body.toString();else if(hHe(o.body)){let l=new gHe(o.body);s=l.contentType(),o.body=l.stream(),o.headers["transfer-encoding"]===void 0&&o.headers["content-length"]===void 0&&(o.headers["content-length"]=String(l.length()))}else typeof o.body=="string"||o.body instanceof String?s="text/plain; charset=utf-8":mHe(o.body)?(o.body=JSON.stringify(o.body),s="application/json"):dHe(o.body)&&(o.body=Buffer.from(o.body));o.headers["content-type"]===void 0&&s!==void 0&&(o.headers["content-type"]=s),o.body!=null&&(o.body instanceof uHe||(!(typeof o.body=="string"||o.body instanceof String)&&!Buffer.isBuffer(o.body)&&(o.body=String(o.body)),o.headers["transfer-encoding"]===void 0&&o.headers["content-length"]===void 0&&(o.headers["content-length"]=String(Buffer.isBuffer(o.body)?o.body.length:Buffer.byteLength(o.body,"utf-8"))))),o.headers.accept===void 0&&(o.headers.accept="*/*"),o.body==null&&["POST","PUT"].includes(o.method)&&(o.headers["content-length"]="0"),o.compress&&o.headers["accept-encoding"]===void 0&&(o.headers["accept-encoding"]="gzip,deflate,br");let{signal:a}=o,{protocol:c,socket:u=null}=t.socketFactory?await EHe(t.socketFactory,n,o,t.alpnProtocols):await CHe(t,n,a);switch(K$(`${n.host} -> ${c}`),c){case Q$:try{return await uM.request(t,n,u?{...o,socket:u}:o)}catch(l){let{code:d,message:p}=l;throw d==="ERR_HTTP2_ERROR"&&p==="Protocol error"&&t.alpnCache.delete(`${n.protocol}//${n.host}`),l}case X$:return uM.request(t,new URL(`http://${n.host}${n.pathname}${n.hash}${n.search}`),u?{...o,socket:u}:o);case J$:case Ny:return Y$.request(t,n,u?{...o,socket:u}:o);default:throw new TypeError(`unsupported protocol: ${c}`)}},RHe=async t=>(t.alpnCache.clear(),Promise.all([Y$.resetContext(t),uM.resetContext(t)])),kHe=t=>{let{options:{alpnProtocols:e=_He,alpnCacheTTL:r=yHe,alpnCacheSize:n=bHe,userAgent:o=xHe,socketFactory:s}}=t;t.alpnProtocols=e,t.alpnCache=new pHe({max:n,ttl:r}),t.userAgent=o,t.socketFactory=s,Y$.setupContext(t),uM.setupContext(t)};ehe.exports={request:wHe,setupContext:kHe,resetContext:RHe,RequestAbortedError:cM,ALPN_HTTP2:Q$,ALPN_HTTP2C:X$,ALPN_HTTP1_1:Ny,ALPN_HTTP1_0:J$}});var nhe=O((dmr,rhe)=>{"use strict";var PHe=$l()("helix-fetch:core"),{request:AHe,setupContext:DHe,resetContext:NHe,RequestAbortedError:LHe,ALPN_HTTP2:OHe,ALPN_HTTP2C:MHe,ALPN_HTTP1_1:FHe,ALPN_HTTP1_0:UHe}=the(),Z$=class t{constructor(e){this.options={...e||{}},DHe(this)}api(){return{request:async(e,r)=>this.request(e,r),context:(e={})=>new t(e).api(),setCA:e=>this.setCA(e),reset:async()=>this.reset(),RequestAbortedError:LHe,ALPN_HTTP2:OHe,ALPN_HTTP2C:MHe,ALPN_HTTP1_1:FHe,ALPN_HTTP1_0:UHe}}async request(e,r){return AHe(this,e,r)}setCA(e){this.options.ca=e}async reset(){return PHe("resetting context"),NHe(this)}};rhe.exports=new Z$().api()});var che=O((pmr,ahe)=>{"use strict";var{EventEmitter:BHe}=require("events"),{Readable:i2}=require("stream"),eW=$l()("helix-fetch"),qHe=M$(),{Body:jHe}=eM(),{Headers:iW}=vC(),{Request:Ly}=wme(),{Response:rW}=V$(),{FetchBaseError:HHe,FetchError:o2,AbortError:lM}=B$(),{AbortController:VHe,AbortSignal:GHe,TimeoutSignal:zHe}=q$(),$He=Lme(),{cacheableResponse:WHe}=Fme(),{sizeof:KHe}=gm(),{isFormData:YHe}=r2(),{context:QHe,RequestAbortedError:XHe}=nhe(),ihe=["GET","HEAD"],JHe=500,ZHe=100*1024*1024,tW="push",ohe=async(t,e,r)=>{let{request:n}=t.context,o=e instanceof Ly&&typeof r>"u"?e:new Ly(e,r),{method:s,body:a,signal:c,compress:u,decode:l,follow:d,redirect:p,init:{body:f}}=o,m;if(c&&c.aborted){let I=new lM("The operation was aborted.");throw o.init.body instanceof i2&&o.init.body.destroy(I),I}try{m=await n(o.url,{...r,method:s,headers:o.headers.plain(),body:f&&!(f instanceof i2)&&!YHe(f)?f:a,compress:u,decode:l,follow:d,redirect:p,signal:c})}catch(I){throw f instanceof i2&&f.destroy(I),I instanceof TypeError?I:I instanceof XHe?new lM("The operation was aborted."):new o2(I.message,"system",I)}let h=()=>{c.removeEventListener("abort",h);let I=new lM("The operation was aborted.");o.init.body instanceof i2&&o.init.body.destroy(I),m.readable.emit("error",I)};c&&c.addEventListener("abort",h);let{statusCode:g,statusText:v,httpVersion:y,headers:_,readable:x,decoded:S}=m;if([301,302,303,307,308].includes(g)){let{location:I}=_,E=I==null?null:new URL(I,o.url);switch(o.redirect){case"manual":break;case"error":throw c&&c.removeEventListener("abort",h),new o2(`uri requested responds with a redirect, redirect mode is set to 'error': ${o.url}`,"no-redirect");case"follow":{if(E===null)break;if(o.counter>=o.follow)throw c&&c.removeEventListener("abort",h),new o2(`maximum redirect reached at: ${o.url}`,"max-redirect");let R={headers:new iW(o.headers),follow:o.follow,compress:o.compress,decode:o.decode,counter:o.counter+1,method:o.method,body:o.body,signal:o.signal};if(g!==303&&o.body&&o.init.body instanceof i2)throw c&&c.removeEventListener("abort",h),new o2("Cannot follow redirect with body being a readable stream","unsupported-redirect");return(g===303||(g===301||g===302)&&o.method==="POST")&&(R.method="GET",R.body=void 0,R.headers.delete("content-length")),c&&c.removeEventListener("abort",h),ohe(t,new Ly(E,R))}default:}}return c&&(x.once("end",()=>{c.removeEventListener("abort",h)}),x.once("error",()=>{c.removeEventListener("abort",h)})),new rW(x,{url:o.url,status:g,statusText:v,headers:_,httpVersion:y,decoded:S,counter:o.counter})},she=async(t,e,r)=>{if(t.options.maxCacheSize===0||!ihe.includes(e.method))return r;let n=new $He(e,r,{shared:!1});if(n.storable()){let o=await WHe(r);return t.cache.set(e.url,{policy:n,response:o},n.timeToLive()),o}else return r},eVe=async(t,e,r)=>{let n=new Ly(e,r);if(t.options.maxCacheSize!==0&&ihe.includes(n.method)&&!["no-store","reload"].includes(n.cache)){let{policy:a,response:c}=t.cache.get(n.url)||{};if(a&&a.satisfiesWithoutRevalidation(n)){c.headers=new iW(a.responseHeaders(c));let u=c.clone();return u.fromCache=!0,u}}let s=await ohe(t,n);return n.cache!=="no-store"?she(t,n,s):s},tVe=(t,e={})=>{let r=new URL(t);if(typeof e!="object"||Array.isArray(e))throw new TypeError("qs: object expected");return Object.entries(e).forEach(([n,o])=>{Array.isArray(o)?o.forEach(s=>r.searchParams.append(n,s)):r.searchParams.append(n,o)}),r.href},rVe=t=>new zHe(t),nW=class t{constructor(e){this.options={...e};let{maxCacheSize:r}=this.options,n=typeof r=="number"&&r>=0?r:ZHe,o=JHe;n===0&&(n=1,o=1);let s=({response:c},u)=>KHe(c);this.cache=new qHe({max:o,maxSize:n,sizeCalculation:s}),this.eventEmitter=new BHe,this.options.h2=this.options.h2||{},typeof this.options.h2.enablePush>"u"&&(this.options.h2.enablePush=!0);let{enablePush:a}=this.options.h2;a&&(this.options.h2.pushPromiseHandler=(c,u,l)=>{let d={...u};Object.keys(d).filter(p=>p.startsWith(":")).forEach(p=>delete d[p]),this.pushPromiseHandler(c,d,l)},this.options.h2.pushHandler=(c,u,l)=>{let d={...u};Object.keys(d).filter(y=>y.startsWith(":")).forEach(y=>delete d[y]);let{statusCode:p,statusText:f,httpVersion:m,headers:h,readable:g,decoded:v}=l;this.pushHandler(c,d,new rW(g,{url:c,status:p,statusText:f,headers:h,httpVersion:m,decoded:v}))}),this.context=QHe(this.options)}api(){return{fetch:async(e,r)=>this.fetch(e,r),Body:jHe,Headers:iW,Request:Ly,Response:rW,AbortController:VHe,AbortSignal:GHe,FetchBaseError:HHe,FetchError:o2,AbortError:lM,context:(e={})=>new t(e).api(),setCA:e=>this.setCA(e),noCache:(e={})=>new t({...e,maxCacheSize:0}).api(),h1:(e={})=>new t({...e,alpnProtocols:[this.context.ALPN_HTTP1_1]}).api(),keepAlive:(e={})=>new t({...e,alpnProtocols:[this.context.ALPN_HTTP1_1],h1:{keepAlive:!0}}).api(),h1NoCache:(e={})=>new t({...e,maxCacheSize:0,alpnProtocols:[this.context.ALPN_HTTP1_1]}).api(),keepAliveNoCache:(e={})=>new t({...e,maxCacheSize:0,alpnProtocols:[this.context.ALPN_HTTP1_1],h1:{keepAlive:!0}}).api(),reset:async()=>this.context.reset(),onPush:e=>this.onPush(e),offPush:e=>this.offPush(e),createUrl:tVe,timeoutSignal:rVe,clearCache:()=>this.clearCache(),cacheStats:()=>this.cacheStats(),ALPN_HTTP2:this.context.ALPN_HTTP2,ALPN_HTTP2C:this.context.ALPN_HTTP2C,ALPN_HTTP1_1:this.context.ALPN_HTTP1_1,ALPN_HTTP1_0:this.context.ALPN_HTTP1_0}}async fetch(e,r){return eVe(this,e,r)}setCA(e){this.options.ca=e,this.context.setCA(e)}onPush(e){return this.eventEmitter.on(tW,e)}offPush(e){return this.eventEmitter.off(tW,e)}clearCache(){this.cache.clear()}cacheStats(){return{size:this.cache.calculatedSize,count:this.cache.size}}pushPromiseHandler(e,r,n){eW(`received server push promise: ${e}, headers: ${JSON.stringify(r)}`);let o=new Ly(e,{headers:r}),{policy:s}=this.cache.get(e)||{};s&&s.satisfiesWithoutRevalidation(o)&&(eW(`already cached, reject push promise: ${e}, headers: ${JSON.stringify(r)}`),n())}async pushHandler(e,r,n){eW(`caching resource pushed by server: ${e}, reqHeaders: ${JSON.stringify(r)}, status: ${n.status}, respHeaders: ${JSON.stringify(n.headers)}`);let o=await she(this,new Ly(e,{headers:r}),n);this.eventEmitter.emit(tW,e,o)}};ahe.exports=new nW().api()});var lhe=O((fmr,uhe)=>{"use strict";uhe.exports=che()});var cr=O((qmr,fhe)=>{fhe.exports={options:{usePureJavaScript:!1}}});var ghe=O((jmr,hhe)=>{var aW={};hhe.exports=aW;var mhe={};aW.encode=function(t,e,r){if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');if(r!==void 0&&typeof r!="number")throw new TypeError('"maxline" must be a number.');var n="";if(!(t instanceof Uint8Array))n=iVe(t,e);else{var o=0,s=e.length,a=e.charAt(0),c=[0];for(o=0;o<t.length;++o){for(var u=0,l=t[o];u<c.length;++u)l+=c[u]<<8,c[u]=l%s,l=l/s|0;for(;l>0;)c.push(l%s),l=l/s|0}for(o=0;t[o]===0&&o<t.length-1;++o)n+=a;for(o=c.length-1;o>=0;--o)n+=e[c[o]]}if(r){var d=new RegExp(".{1,"+r+"}","g");n=n.match(d).join(`\r
`)}return n};aW.decode=function(t,e){if(typeof t!="string")throw new TypeError('"input" must be a string.');if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');var r=mhe[e];if(!r){r=mhe[e]=[];for(var n=0;n<e.length;++n)r[e.charCodeAt(n)]=n}t=t.replace(/\s/g,"");for(var o=e.length,s=e.charAt(0),a=[0],n=0;n<t.length;n++){var c=r[t.charCodeAt(n)];if(c===void 0)return;for(var u=0,l=c;u<a.length;++u)l+=a[u]*o,a[u]=l&255,l>>=8;for(;l>0;)a.push(l&255),l>>=8}for(var d=0;t[d]===s&&d<t.length-1;++d)a.push(0);return typeof Buffer<"u"?Buffer.from(a.reverse()):new Uint8Array(a.reverse())};function iVe(t,e){var r=0,n=e.length,o=e.charAt(0),s=[0];for(r=0;r<t.length();++r){for(var a=0,c=t.at(r);a<s.length;++a)c+=s[a]<<8,s[a]=c%n,c=c/n|0;for(;c>0;)s.push(c%n),c=c/n|0}var u="";for(r=0;t.at(r)===0&&r<t.length()-1;++r)u+=o;for(r=s.length-1;r>=0;--r)u+=e[s[r]];return u}});var $r=O((Hmr,_he)=>{var vhe=cr(),bhe=ghe(),Z=_he.exports=vhe.util=vhe.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){Z.nextTick=process.nextTick,typeof setImmediate=="function"?Z.setImmediate=setImmediate:Z.setImmediate=Z.nextTick;return}if(typeof setImmediate=="function"){Z.setImmediate=function(){return setImmediate.apply(void 0,arguments)},Z.nextTick=function(c){return setImmediate(c)};return}if(Z.setImmediate=function(c){setTimeout(c,0)},typeof window<"u"&&typeof window.postMessage=="function"){let c=function(u){if(u.source===window&&u.data===t){u.stopPropagation();var l=e.slice();e.length=0,l.forEach(function(d){d()})}};var a=c,t="forge.setImmediate",e=[];Z.setImmediate=function(u){e.push(u),e.length===1&&window.postMessage(t,"*")},window.addEventListener("message",c,!0)}if(typeof MutationObserver<"u"){var r=Date.now(),n=!0,o=document.createElement("div"),e=[];new MutationObserver(function(){var u=e.slice();e.length=0,u.forEach(function(l){l()})}).observe(o,{attributes:!0});var s=Z.setImmediate;Z.setImmediate=function(u){Date.now()-r>15?(r=Date.now(),s(u)):(e.push(u),e.length===1&&o.setAttribute("a",n=!n))}}Z.nextTick=Z.setImmediate})();Z.isNodejs=typeof process<"u"&&process.versions&&process.versions.node;Z.globalScope=function(){return Z.isNodejs?global:typeof self>"u"?window:self}();Z.isArray=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};Z.isArrayBuffer=function(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer};Z.isArrayBufferView=function(t){return t&&Z.isArrayBuffer(t.buffer)&&t.byteLength!==void 0};function s2(t){if(!(t===8||t===16||t===24||t===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+t)}Z.ByteBuffer=cW;function cW(t){if(this.data="",this.read=0,typeof t=="string")this.data=t;else if(Z.isArrayBuffer(t)||Z.isArrayBufferView(t))if(typeof Buffer<"u"&&t instanceof Buffer)this.data=t.toString("binary");else{var e=new Uint8Array(t);try{this.data=String.fromCharCode.apply(null,e)}catch{for(var r=0;r<e.length;++r)this.putByte(e[r])}}else(t instanceof cW||typeof t=="object"&&typeof t.data=="string"&&typeof t.read=="number")&&(this.data=t.data,this.read=t.read);this._constructedStringLength=0}Z.ByteStringBuffer=cW;var oVe=4096;Z.ByteStringBuffer.prototype._optimizeConstructedString=function(t){this._constructedStringLength+=t,this._constructedStringLength>oVe&&(this.data.substr(0,1),this._constructedStringLength=0)};Z.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};Z.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};Z.ByteStringBuffer.prototype.putByte=function(t){return this.putBytes(String.fromCharCode(t))};Z.ByteStringBuffer.prototype.fillWithByte=function(t,e){t=String.fromCharCode(t);for(var r=this.data;e>0;)e&1&&(r+=t),e>>>=1,e>0&&(t+=t);return this.data=r,this._optimizeConstructedString(e),this};Z.ByteStringBuffer.prototype.putBytes=function(t){return this.data+=t,this._optimizeConstructedString(t.length),this};Z.ByteStringBuffer.prototype.putString=function(t){return this.putBytes(Z.encodeUtf8(t))};Z.ByteStringBuffer.prototype.putInt16=function(t){return this.putBytes(String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};Z.ByteStringBuffer.prototype.putInt24=function(t){return this.putBytes(String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};Z.ByteStringBuffer.prototype.putInt32=function(t){return this.putBytes(String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};Z.ByteStringBuffer.prototype.putInt16Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255))};Z.ByteStringBuffer.prototype.putInt24Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255))};Z.ByteStringBuffer.prototype.putInt32Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>24&255))};Z.ByteStringBuffer.prototype.putInt=function(t,e){s2(e);var r="";do e-=8,r+=String.fromCharCode(t>>e&255);while(e>0);return this.putBytes(r)};Z.ByteStringBuffer.prototype.putSignedInt=function(t,e){return t<0&&(t+=2<<e-1),this.putInt(t,e)};Z.ByteStringBuffer.prototype.putBuffer=function(t){return this.putBytes(t.getBytes())};Z.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};Z.ByteStringBuffer.prototype.getInt16=function(){var t=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,t};Z.ByteStringBuffer.prototype.getInt24=function(){var t=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,t};Z.ByteStringBuffer.prototype.getInt32=function(){var t=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,t};Z.ByteStringBuffer.prototype.getInt16Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,t};Z.ByteStringBuffer.prototype.getInt24Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,t};Z.ByteStringBuffer.prototype.getInt32Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,t};Z.ByteStringBuffer.prototype.getInt=function(t){s2(t);var e=0;do e=(e<<8)+this.data.charCodeAt(this.read++),t-=8;while(t>0);return e};Z.ByteStringBuffer.prototype.getSignedInt=function(t){var e=this.getInt(t),r=2<<t-2;return e>=r&&(e-=r<<1),e};Z.ByteStringBuffer.prototype.getBytes=function(t){var e;return t?(t=Math.min(this.length(),t),e=this.data.slice(this.read,this.read+t),this.read+=t):t===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};Z.ByteStringBuffer.prototype.bytes=function(t){return typeof t>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+t)};Z.ByteStringBuffer.prototype.at=function(t){return this.data.charCodeAt(this.read+t)};Z.ByteStringBuffer.prototype.setAt=function(t,e){return this.data=this.data.substr(0,this.read+t)+String.fromCharCode(e)+this.data.substr(this.read+t+1),this};Z.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};Z.ByteStringBuffer.prototype.copy=function(){var t=Z.createBuffer(this.data);return t.read=this.read,t};Z.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};Z.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};Z.ByteStringBuffer.prototype.truncate=function(t){var e=Math.max(0,this.length()-t);return this.data=this.data.substr(this.read,e),this.read=0,this};Z.ByteStringBuffer.prototype.toHex=function(){for(var t="",e=this.read;e<this.data.length;++e){var r=this.data.charCodeAt(e);r<16&&(t+="0"),t+=r.toString(16)}return t};Z.ByteStringBuffer.prototype.toString=function(){return Z.decodeUtf8(this.bytes())};function sVe(t,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var r=Z.isArrayBuffer(t),n=Z.isArrayBufferView(t);if(r||n){r?this.data=new DataView(t):this.data=new DataView(t.buffer,t.byteOffset,t.byteLength),this.write="writeOffset"in e?e.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,t!=null&&this.putBytes(t),"writeOffset"in e&&(this.write=e.writeOffset)}Z.DataBuffer=sVe;Z.DataBuffer.prototype.length=function(){return this.write-this.read};Z.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};Z.DataBuffer.prototype.accommodate=function(t,e){if(this.length()>=t)return this;e=Math.max(e||this.growSize,t);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+e);return n.set(r),this.data=new DataView(n.buffer),this};Z.DataBuffer.prototype.putByte=function(t){return this.accommodate(1),this.data.setUint8(this.write++,t),this};Z.DataBuffer.prototype.fillWithByte=function(t,e){this.accommodate(e);for(var r=0;r<e;++r)this.data.setUint8(t);return this};Z.DataBuffer.prototype.putBytes=function(t,e){if(Z.isArrayBufferView(t)){var r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=r.byteLength-r.byteOffset;this.accommodate(n);var o=new Uint8Array(this.data.buffer,this.write);return o.set(r),this.write+=n,this}if(Z.isArrayBuffer(t)){var r=new Uint8Array(t);this.accommodate(r.byteLength);var o=new Uint8Array(this.data.buffer);return o.set(r,this.write),this.write+=r.byteLength,this}if(t instanceof Z.DataBuffer||typeof t=="object"&&typeof t.read=="number"&&typeof t.write=="number"&&Z.isArrayBufferView(t.data)){var r=new Uint8Array(t.data.byteLength,t.read,t.length());this.accommodate(r.byteLength);var o=new Uint8Array(t.data.byteLength,this.write);return o.set(r),this.write+=r.byteLength,this}if(t instanceof Z.ByteStringBuffer&&(t=t.data,e="binary"),e=e||"binary",typeof t=="string"){var s;if(e==="hex")return this.accommodate(Math.ceil(t.length/2)),s=new Uint8Array(this.data.buffer,this.write),this.write+=Z.binary.hex.decode(t,s,this.write),this;if(e==="base64")return this.accommodate(Math.ceil(t.length/4)*3),s=new Uint8Array(this.data.buffer,this.write),this.write+=Z.binary.base64.decode(t,s,this.write),this;if(e==="utf8"&&(t=Z.encodeUtf8(t),e="binary"),e==="binary"||e==="raw")return this.accommodate(t.length),s=new Uint8Array(this.data.buffer,this.write),this.write+=Z.binary.raw.decode(s),this;if(e==="utf16")return this.accommodate(t.length*2),s=new Uint16Array(this.data.buffer,this.write),this.write+=Z.text.utf16.encode(s),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+t)};Z.DataBuffer.prototype.putBuffer=function(t){return this.putBytes(t),t.clear(),this};Z.DataBuffer.prototype.putString=function(t){return this.putBytes(t,"utf16")};Z.DataBuffer.prototype.putInt16=function(t){return this.accommodate(2),this.data.setInt16(this.write,t),this.write+=2,this};Z.DataBuffer.prototype.putInt24=function(t){return this.accommodate(3),this.data.setInt16(this.write,t>>8&65535),this.data.setInt8(this.write,t>>16&255),this.write+=3,this};Z.DataBuffer.prototype.putInt32=function(t){return this.accommodate(4),this.data.setInt32(this.write,t),this.write+=4,this};Z.DataBuffer.prototype.putInt16Le=function(t){return this.accommodate(2),this.data.setInt16(this.write,t,!0),this.write+=2,this};Z.DataBuffer.prototype.putInt24Le=function(t){return this.accommodate(3),this.data.setInt8(this.write,t>>16&255),this.data.setInt16(this.write,t>>8&65535,!0),this.write+=3,this};Z.DataBuffer.prototype.putInt32Le=function(t){return this.accommodate(4),this.data.setInt32(this.write,t,!0),this.write+=4,this};Z.DataBuffer.prototype.putInt=function(t,e){s2(e),this.accommodate(e/8);do e-=8,this.data.setInt8(this.write++,t>>e&255);while(e>0);return this};Z.DataBuffer.prototype.putSignedInt=function(t,e){return s2(e),this.accommodate(e/8),t<0&&(t+=2<<e-1),this.putInt(t,e)};Z.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};Z.DataBuffer.prototype.getInt16=function(){var t=this.data.getInt16(this.read);return this.read+=2,t};Z.DataBuffer.prototype.getInt24=function(){var t=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,t};Z.DataBuffer.prototype.getInt32=function(){var t=this.data.getInt32(this.read);return this.read+=4,t};Z.DataBuffer.prototype.getInt16Le=function(){var t=this.data.getInt16(this.read,!0);return this.read+=2,t};Z.DataBuffer.prototype.getInt24Le=function(){var t=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,t};Z.DataBuffer.prototype.getInt32Le=function(){var t=this.data.getInt32(this.read,!0);return this.read+=4,t};Z.DataBuffer.prototype.getInt=function(t){s2(t);var e=0;do e=(e<<8)+this.data.getInt8(this.read++),t-=8;while(t>0);return e};Z.DataBuffer.prototype.getSignedInt=function(t){var e=this.getInt(t),r=2<<t-2;return e>=r&&(e-=r<<1),e};Z.DataBuffer.prototype.getBytes=function(t){var e;return t?(t=Math.min(this.length(),t),e=this.data.slice(this.read,this.read+t),this.read+=t):t===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};Z.DataBuffer.prototype.bytes=function(t){return typeof t>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+t)};Z.DataBuffer.prototype.at=function(t){return this.data.getUint8(this.read+t)};Z.DataBuffer.prototype.setAt=function(t,e){return this.data.setUint8(t,e),this};Z.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};Z.DataBuffer.prototype.copy=function(){return new Z.DataBuffer(this)};Z.DataBuffer.prototype.compact=function(){if(this.read>0){var t=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(t.byteLength);e.set(t),this.data=new DataView(e),this.write-=this.read,this.read=0}return this};Z.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};Z.DataBuffer.prototype.truncate=function(t){return this.write=Math.max(0,this.length()-t),this.read=Math.min(this.read,this.write),this};Z.DataBuffer.prototype.toHex=function(){for(var t="",e=this.read;e<this.data.byteLength;++e){var r=this.data.getUint8(e);r<16&&(t+="0"),t+=r.toString(16)}return t};Z.DataBuffer.prototype.toString=function(t){var e=new Uint8Array(this.data,this.read,this.length());if(t=t||"utf8",t==="binary"||t==="raw")return Z.binary.raw.encode(e);if(t==="hex")return Z.binary.hex.encode(e);if(t==="base64")return Z.binary.base64.encode(e);if(t==="utf8")return Z.text.utf8.decode(e);if(t==="utf16")return Z.text.utf16.decode(e);throw new Error("Invalid encoding: "+t)};Z.createBuffer=function(t,e){return e=e||"raw",t!==void 0&&e==="utf8"&&(t=Z.encodeUtf8(t)),new Z.ByteBuffer(t)};Z.fillString=function(t,e){for(var r="";e>0;)e&1&&(r+=t),e>>>=1,e>0&&(t+=t);return r};Z.xorBytes=function(t,e,r){for(var n="",o="",s="",a=0,c=0;r>0;--r,++a)o=t.charCodeAt(a)^e.charCodeAt(a),c>=10&&(n+=s,s="",c=0),s+=String.fromCharCode(o),++c;return n+=s,n};Z.hexToBytes=function(t){var e="",r=0;for(t.length&!0&&(r=1,e+=String.fromCharCode(parseInt(t[0],16)));r<t.length;r+=2)e+=String.fromCharCode(parseInt(t.substr(r,2),16));return e};Z.bytesToHex=function(t){return Z.createBuffer(t).toHex()};Z.int32ToBytes=function(t){return String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255)};var Av="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Dv=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],yhe="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";Z.encode64=function(t,e){for(var r="",n="",o,s,a,c=0;c<t.length;)o=t.charCodeAt(c++),s=t.charCodeAt(c++),a=t.charCodeAt(c++),r+=Av.charAt(o>>2),r+=Av.charAt((o&3)<<4|s>>4),isNaN(s)?r+="==":(r+=Av.charAt((s&15)<<2|a>>6),r+=isNaN(a)?"=":Av.charAt(a&63)),e&&r.length>e&&(n+=r.substr(0,e)+`\r
`,r=r.substr(e));return n+=r,n};Z.decode64=function(t){t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var e="",r,n,o,s,a=0;a<t.length;)r=Dv[t.charCodeAt(a++)-43],n=Dv[t.charCodeAt(a++)-43],o=Dv[t.charCodeAt(a++)-43],s=Dv[t.charCodeAt(a++)-43],e+=String.fromCharCode(r<<2|n>>4),o!==64&&(e+=String.fromCharCode((n&15)<<4|o>>2),s!==64&&(e+=String.fromCharCode((o&3)<<6|s)));return e};Z.encodeUtf8=function(t){return unescape(encodeURIComponent(t))};Z.decodeUtf8=function(t){return decodeURIComponent(escape(t))};Z.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:bhe.encode,decode:bhe.decode}};Z.binary.raw.encode=function(t){return String.fromCharCode.apply(null,t)};Z.binary.raw.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(t.length)),r=r||0;for(var o=r,s=0;s<t.length;++s)n[o++]=t.charCodeAt(s);return e?o-r:n};Z.binary.hex.encode=Z.bytesToHex;Z.binary.hex.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(Math.ceil(t.length/2))),r=r||0;var o=0,s=r;for(t.length&1&&(o=1,n[s++]=parseInt(t[0],16));o<t.length;o+=2)n[s++]=parseInt(t.substr(o,2),16);return e?s-r:n};Z.binary.base64.encode=function(t,e){for(var r="",n="",o,s,a,c=0;c<t.byteLength;)o=t[c++],s=t[c++],a=t[c++],r+=Av.charAt(o>>2),r+=Av.charAt((o&3)<<4|s>>4),isNaN(s)?r+="==":(r+=Av.charAt((s&15)<<2|a>>6),r+=isNaN(a)?"=":Av.charAt(a&63)),e&&r.length>e&&(n+=r.substr(0,e)+`\r
`,r=r.substr(e));return n+=r,n};Z.binary.base64.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(Math.ceil(t.length/4)*3)),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),r=r||0;for(var o,s,a,c,u=0,l=r;u<t.length;)o=Dv[t.charCodeAt(u++)-43],s=Dv[t.charCodeAt(u++)-43],a=Dv[t.charCodeAt(u++)-43],c=Dv[t.charCodeAt(u++)-43],n[l++]=o<<2|s>>4,a!==64&&(n[l++]=(s&15)<<4|a>>2,c!==64&&(n[l++]=(a&3)<<6|c));return e?l-r:n.subarray(0,l)};Z.binary.base58.encode=function(t,e){return Z.binary.baseN.encode(t,yhe,e)};Z.binary.base58.decode=function(t,e){return Z.binary.baseN.decode(t,yhe,e)};Z.text={utf8:{},utf16:{}};Z.text.utf8.encode=function(t,e,r){t=Z.encodeUtf8(t);var n=e;n||(n=new Uint8Array(t.length)),r=r||0;for(var o=r,s=0;s<t.length;++s)n[o++]=t.charCodeAt(s);return e?o-r:n};Z.text.utf8.decode=function(t){return Z.decodeUtf8(String.fromCharCode.apply(null,t))};Z.text.utf16.encode=function(t,e,r){var n=e;n||(n=new Uint8Array(t.length*2));var o=new Uint16Array(n.buffer);r=r||0;for(var s=r,a=r,c=0;c<t.length;++c)o[a++]=t.charCodeAt(c),s+=2;return e?s-r:n};Z.text.utf16.decode=function(t){return String.fromCharCode.apply(null,new Uint16Array(t.buffer))};Z.deflate=function(t,e,r){if(e=Z.decode64(t.deflate(Z.encode64(e)).rval),r){var n=2,o=e.charCodeAt(1);o&32&&(n=6),e=e.substring(n,e.length-4)}return e};Z.inflate=function(t,e,r){var n=t.inflate(Z.encode64(e)).rval;return n===null?null:Z.decode64(n)};var uW=function(t,e,r){if(!t)throw new Error("WebStorage not available.");var n;if(r===null?n=t.removeItem(e):(r=Z.encode64(JSON.stringify(r)),n=t.setItem(e,r)),typeof n<"u"&&n.rval!==!0){var o=new Error(n.error.message);throw o.id=n.error.id,o.name=n.error.name,o}},lW=function(t,e){if(!t)throw new Error("WebStorage not available.");var r=t.getItem(e);if(t.init)if(r.rval===null){if(r.error){var n=new Error(r.error.message);throw n.id=r.error.id,n.name=r.error.name,n}r=null}else r=r.rval;return r!==null&&(r=JSON.parse(Z.decode64(r))),r},aVe=function(t,e,r,n){var o=lW(t,e);o===null&&(o={}),o[r]=n,uW(t,e,o)},cVe=function(t,e,r){var n=lW(t,e);return n!==null&&(n=r in n?n[r]:null),n},uVe=function(t,e,r){var n=lW(t,e);if(n!==null&&r in n){delete n[r];var o=!0;for(var s in n){o=!1;break}o&&(n=null),uW(t,e,n)}},lVe=function(t,e){uW(t,e,null)},pM=function(t,e,r){var n=null;typeof r>"u"&&(r=["web","flash"]);var o,s=!1,a=null;for(var c in r){o=r[c];try{if(o==="flash"||o==="both"){if(e[0]===null)throw new Error("Flash local storage not available.");n=t.apply(this,e),s=o==="flash"}(o==="web"||o==="both")&&(e[0]=localStorage,n=t.apply(this,e),s=!0)}catch(u){a=u}if(s)break}if(!s)throw a;return n};Z.setItem=function(t,e,r,n,o){pM(aVe,arguments,o)};Z.getItem=function(t,e,r,n){return pM(cVe,arguments,n)};Z.removeItem=function(t,e,r,n){pM(uVe,arguments,n)};Z.clearItems=function(t,e,r){pM(lVe,arguments,r)};Z.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0};Z.format=function(t){for(var e=/%./g,r,n,o=0,s=[],a=0;r=e.exec(t);){n=t.substring(a,e.lastIndex-2),n.length>0&&s.push(n),a=e.lastIndex;var c=r[0][1];switch(c){case"s":case"o":o<arguments.length?s.push(arguments[o+++1]):s.push("<?>");break;case"%":s.push("%");break;default:s.push("<%"+c+"?>")}}return s.push(t.substring(a)),s.join("")};Z.formatNumber=function(t,e,r,n){var o=t,s=isNaN(e=Math.abs(e))?2:e,a=r===void 0?",":r,c=n===void 0?".":n,u=o<0?"-":"",l=parseInt(o=Math.abs(+o||0).toFixed(s),10)+"",d=l.length>3?l.length%3:0;return u+(d?l.substr(0,d)+c:"")+l.substr(d).replace(/(\d{3})(?=\d)/g,"$1"+c)+(s?a+Math.abs(o-l).toFixed(s).slice(2):"")};Z.formatSize=function(t){return t>=1073741824?t=Z.formatNumber(t/1073741824,2,".","")+" GiB":t>=1048576?t=Z.formatNumber(t/1048576,2,".","")+" MiB":t>=1024?t=Z.formatNumber(t/1024,0)+" KiB":t=Z.formatNumber(t,0)+" bytes",t};Z.bytesFromIP=function(t){return t.indexOf(".")!==-1?Z.bytesFromIPv4(t):t.indexOf(":")!==-1?Z.bytesFromIPv6(t):null};Z.bytesFromIPv4=function(t){if(t=t.split("."),t.length!==4)return null;for(var e=Z.createBuffer(),r=0;r<t.length;++r){var n=parseInt(t[r],10);if(isNaN(n))return null;e.putByte(n)}return e.getBytes()};Z.bytesFromIPv6=function(t){var e=0;t=t.split(":").filter(function(a){return a.length===0&&++e,!0});for(var r=(8-t.length+e)*2,n=Z.createBuffer(),o=0;o<8;++o){if(!t[o]||t[o].length===0){n.fillWithByte(0,r),r=0;continue}var s=Z.hexToBytes(t[o]);s.length<2&&n.putByte(0),n.putBytes(s)}return n.getBytes()};Z.bytesToIP=function(t){return t.length===4?Z.bytesToIPv4(t):t.length===16?Z.bytesToIPv6(t):null};Z.bytesToIPv4=function(t){if(t.length!==4)return null;for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e.join(".")};Z.bytesToIPv6=function(t){if(t.length!==16)return null;for(var e=[],r=[],n=0,o=0;o<t.length;o+=2){for(var s=Z.bytesToHex(t[o]+t[o+1]);s[0]==="0"&&s!=="0";)s=s.substr(1);if(s==="0"){var a=r[r.length-1],c=e.length;!a||c!==a.end+1?r.push({start:c,end:c}):(a.end=c,a.end-a.start>r[n].end-r[n].start&&(n=r.length-1))}e.push(s)}if(r.length>0){var u=r[n];u.end-u.start>0&&(e.splice(u.start,u.end-u.start+1,""),u.start===0&&e.unshift(""),u.end===7&&e.push(""))}return e.join(":")};Z.estimateCores=function(t,e){if(typeof t=="function"&&(e=t,t={}),t=t||{},"cores"in Z&&!t.update)return e(null,Z.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return Z.cores=navigator.hardwareConcurrency,e(null,Z.cores);if(typeof Worker>"u")return Z.cores=1,e(null,Z.cores);if(typeof Blob>"u")return Z.cores=2,e(null,Z.cores);var r=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(a){for(var c=Date.now(),u=c+4;Date.now()<u;);self.postMessage({st:c,et:u})})}.toString(),")()"],{type:"application/javascript"}));n([],5,16);function n(a,c,u){if(c===0){var l=Math.floor(a.reduce(function(d,p){return d+p},0)/a.length);return Z.cores=Math.max(1,l),URL.revokeObjectURL(r),e(null,Z.cores)}o(u,function(d,p){a.push(s(u,p)),n(a,c-1,u)})}function o(a,c){for(var u=[],l=[],d=0;d<a;++d){var p=new Worker(r);p.addEventListener("message",function(f){if(l.push(f.data),l.length===a){for(var m=0;m<a;++m)u[m].terminate();c(null,l)}}),u.push(p)}for(var d=0;d<a;++d)u[d].postMessage(d)}function s(a,c){for(var u=[],l=0;l<a;++l)for(var d=c[l],p=u[l]=[],f=0;f<a;++f)if(l!==f){var m=c[f];(d.st>m.st&&d.st<m.et||m.st>d.st&&m.st<d.et)&&p.push(f)}return u.reduce(function(h,g){return Math.max(h,g.length)},0)}}});var fM=O((Vmr,xhe)=>{var Jo=cr();$r();xhe.exports=Jo.cipher=Jo.cipher||{};Jo.cipher.algorithms=Jo.cipher.algorithms||{};Jo.cipher.createCipher=function(t,e){var r=t;if(typeof r=="string"&&(r=Jo.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new Jo.cipher.BlockCipher({algorithm:r,key:e,decrypt:!1})};Jo.cipher.createDecipher=function(t,e){var r=t;if(typeof r=="string"&&(r=Jo.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new Jo.cipher.BlockCipher({algorithm:r,key:e,decrypt:!0})};Jo.cipher.registerAlgorithm=function(t,e){t=t.toUpperCase(),Jo.cipher.algorithms[t]=e};Jo.cipher.getAlgorithm=function(t){return t=t.toUpperCase(),t in Jo.cipher.algorithms?Jo.cipher.algorithms[t]:null};var dW=Jo.cipher.BlockCipher=function(t){this.algorithm=t.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=t.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=t.decrypt,this.algorithm.initialize(t)};dW.prototype.start=function(t){t=t||{};var e={};for(var r in t)e[r]=t[r];e.decrypt=this._decrypt,this._finish=!1,this._input=Jo.util.createBuffer(),this.output=t.output||Jo.util.createBuffer(),this.mode.start(e)};dW.prototype.update=function(t){for(t&&this._input.putBuffer(t);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};dW.prototype.finish=function(t){t&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(r){return t(this.blockSize,r,!1)},this.mode.unpad=function(r){return t(this.blockSize,r,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,e))}});var fW=O((Gmr,She)=>{var Zo=cr();$r();Zo.cipher=Zo.cipher||{};var Sr=She.exports=Zo.cipher.modes=Zo.cipher.modes||{};Sr.ecb=function(t){t=t||{},this.name="ECB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};Sr.ecb.prototype.start=function(t){};Sr.ecb.prototype.encrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};Sr.ecb.prototype.decrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};Sr.ecb.prototype.pad=function(t,e){var r=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(r,r),!0};Sr.ecb.prototype.unpad=function(t,e){if(e.overflow>0)return!1;var r=t.length(),n=t.at(r-1);return n>this.blockSize<<2?!1:(t.truncate(n),!0)};Sr.cbc=function(t){t=t||{},this.name="CBC",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};Sr.cbc.prototype.start=function(t){if(t.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in t)this._iv=mM(t.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")};Sr.cbc.prototype.encrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n]);this._prev=this._outBlock};Sr.cbc.prototype.decrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)};Sr.cbc.prototype.pad=function(t,e){var r=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(r,r),!0};Sr.cbc.prototype.unpad=function(t,e){if(e.overflow>0)return!1;var r=t.length(),n=t.at(r-1);return n>this.blockSize<<2?!1:(t.truncate(n),!0)};Sr.cfb=function(t){t=t||{},this.name="CFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=Zo.util.createBuffer(),this._partialBytes=0};Sr.cfb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=mM(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Sr.cfb.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var o=0;o<this._ints;++o)this._inBlock[o]=t.getInt32()^this._outBlock[o],e.putInt32(this._inBlock[o]);return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var o=0;o<this._ints;++o)this._partialBlock[o]=t.getInt32()^this._outBlock[o],this._partialOutput.putInt32(this._partialBlock[o]);if(s>0)t.read-=this.blockSize;else for(var o=0;o<this._ints;++o)this._inBlock[o]=this._partialBlock[o];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};Sr.cfb.prototype.decrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var o=0;o<this._ints;++o)this._inBlock[o]=t.getInt32(),e.putInt32(this._inBlock[o]^this._outBlock[o]);return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var o=0;o<this._ints;++o)this._partialBlock[o]=t.getInt32(),this._partialOutput.putInt32(this._partialBlock[o]^this._outBlock[o]);if(s>0)t.read-=this.blockSize;else for(var o=0;o<this._ints;++o)this._inBlock[o]=this._partialBlock[o];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};Sr.ofb=function(t){t=t||{},this.name="OFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Zo.util.createBuffer(),this._partialBytes=0};Sr.ofb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=mM(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Sr.ofb.prototype.encrypt=function(t,e,r){var n=t.length();if(t.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var o=0;o<this._ints;++o)e.putInt32(t.getInt32()^this._outBlock[o]),this._inBlock[o]=this._outBlock[o];return}var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var o=0;o<this._ints;++o)this._partialOutput.putInt32(t.getInt32()^this._outBlock[o]);if(s>0)t.read-=this.blockSize;else for(var o=0;o<this._ints;++o)this._inBlock[o]=this._outBlock[o];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};Sr.ofb.prototype.decrypt=Sr.ofb.prototype.encrypt;Sr.ctr=function(t){t=t||{},this.name="CTR",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Zo.util.createBuffer(),this._partialBytes=0};Sr.ctr.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=mM(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};Sr.ctr.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize)for(var o=0;o<this._ints;++o)e.putInt32(t.getInt32()^this._outBlock[o]);else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var o=0;o<this._ints;++o)this._partialOutput.putInt32(t.getInt32()^this._outBlock[o]);if(s>0&&(t.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}hM(this._inBlock)};Sr.ctr.prototype.decrypt=Sr.ctr.prototype.encrypt;Sr.gcm=function(t){t=t||{},this.name="GCM",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=Zo.util.createBuffer(),this._partialBytes=0,this._R=3774873600};Sr.gcm.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");var e=Zo.util.createBuffer(t.iv);this._cipherLength=0;var r;if("additionalData"in t?r=Zo.util.createBuffer(t.additionalData):r=Zo.util.createBuffer(),"tagLength"in t?this._tagLength=t.tagLength:this._tagLength=128,this._tag=null,t.decrypt&&(this._tag=Zo.util.createBuffer(t.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var n=e.length();if(n===12)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(pW(n*8)))}this._inBlock=this._j0.slice(0),hM(this._inBlock),this._partialBytes=0,r=Zo.util.createBuffer(r),this._aDataLength=pW(r.length()*8);var o=r.length()%this.blockSize;for(o&&r.fillWithByte(0,this.blockSize-o),this._s=[0,0,0,0];r.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[r.getInt32(),r.getInt32(),r.getInt32(),r.getInt32()])};Sr.gcm.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var o=0;o<this._ints;++o)e.putInt32(this._outBlock[o]^=t.getInt32());this._cipherLength+=this.blockSize}else{var s=(this.blockSize-n)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var o=0;o<this._ints;++o)this._partialOutput.putInt32(t.getInt32()^this._outBlock[o]);if(s<=0||r){if(r){var a=n%this.blockSize;this._cipherLength+=a,this._partialOutput.truncate(this.blockSize-a)}else this._cipherLength+=this.blockSize;for(var o=0;o<this._ints;++o)this._outBlock[o]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!r)return t.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),hM(this._inBlock)};Sr.gcm.prototype.decrypt=function(t,e,r){var n=t.length();if(n<this.blockSize&&!(r&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),hM(this._inBlock),this._hashBlock[0]=t.getInt32(),this._hashBlock[1]=t.getInt32(),this._hashBlock[2]=t.getInt32(),this._hashBlock[3]=t.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var o=0;o<this._ints;++o)e.putInt32(this._outBlock[o]^this._hashBlock[o]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize};Sr.gcm.prototype.afterFinish=function(t,e){var r=!0;e.decrypt&&e.overflow&&t.truncate(this.blockSize-e.overflow),this.tag=Zo.util.createBuffer();var n=this._aDataLength.concat(pW(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,n);var o=[];this.cipher.encrypt(this._j0,o);for(var s=0;s<this._ints;++s)this.tag.putInt32(this._s[s]^o[s]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(r=!1),r};Sr.gcm.prototype.multiply=function(t,e){for(var r=[0,0,0,0],n=e.slice(0),o=0;o<128;++o){var s=t[o/32|0]&1<<31-o%32;s&&(r[0]^=n[0],r[1]^=n[1],r[2]^=n[2],r[3]^=n[3]),this.pow(n,n)}return r};Sr.gcm.prototype.pow=function(t,e){for(var r=t[3]&1,n=3;n>0;--n)e[n]=t[n]>>>1|(t[n-1]&1)<<31;e[0]=t[0]>>>1,r&&(e[0]^=this._R)};Sr.gcm.prototype.tableMultiply=function(t){for(var e=[0,0,0,0],r=0;r<32;++r){var n=r/8|0,o=t[n]>>>(7-r%8)*4&15,s=this._m[r][o];e[0]^=s[0],e[1]^=s[1],e[2]^=s[2],e[3]^=s[3]}return e};Sr.gcm.prototype.ghash=function(t,e,r){return e[0]^=r[0],e[1]^=r[1],e[2]^=r[2],e[3]^=r[3],this.tableMultiply(e)};Sr.gcm.prototype.generateHashTable=function(t,e){for(var r=8/e,n=4*r,o=16*r,s=new Array(o),a=0;a<o;++a){var c=[0,0,0,0],u=a/n|0,l=(n-1-a%n)*e;c[u]=1<<e-1<<l,s[a]=this.generateSubHashTable(this.multiply(c,t),e)}return s};Sr.gcm.prototype.generateSubHashTable=function(t,e){var r=1<<e,n=r>>>1,o=new Array(r);o[n]=t.slice(0);for(var s=n>>>1;s>0;)this.pow(o[2*s],o[s]=[]),s>>=1;for(s=2;s<n;){for(var a=1;a<s;++a){var c=o[s],u=o[a];o[s+a]=[c[0]^u[0],c[1]^u[1],c[2]^u[2],c[3]^u[3]]}s*=2}for(o[0]=[0,0,0,0],s=n+1;s<r;++s){var l=o[s^n];o[s]=[t[0]^l[0],t[1]^l[1],t[2]^l[2],t[3]^l[3]]}return o};function mM(t,e){if(typeof t=="string"&&(t=Zo.util.createBuffer(t)),Zo.util.isArray(t)&&t.length>4){var r=t;t=Zo.util.createBuffer();for(var n=0;n<r.length;++n)t.putByte(r[n])}if(t.length()<e)throw new Error("Invalid IV length; got "+t.length()+" bytes and expected "+e+" bytes.");if(!Zo.util.isArray(t)){for(var o=[],s=e/4,n=0;n<s;++n)o.push(t.getInt32());t=o}return t}function hM(t){t[t.length-1]=t[t.length-1]+1&4294967295}function pW(t){return[t/4294967296|0,t&4294967295]}});var Nv=O((zmr,Ehe)=>{var Nn=cr();fM();fW();$r();Ehe.exports=Nn.aes=Nn.aes||{};Nn.aes.startEncrypting=function(t,e,r,n){var o=gM({key:t,output:r,decrypt:!1,mode:n});return o.start(e),o};Nn.aes.createEncryptionCipher=function(t,e){return gM({key:t,output:null,decrypt:!1,mode:e})};Nn.aes.startDecrypting=function(t,e,r,n){var o=gM({key:t,output:r,decrypt:!0,mode:n});return o.start(e),o};Nn.aes.createDecryptionCipher=function(t,e){return gM({key:t,output:null,decrypt:!0,mode:e})};Nn.aes.Algorithm=function(t,e){gW||Che();var r=this;r.name=t,r.mode=new e({blockSize:16,cipher:{encrypt:function(n,o){return hW(r._w,n,o,!1)},decrypt:function(n,o){return hW(r._w,n,o,!0)}}}),r._init=!1};Nn.aes.Algorithm.prototype.initialize=function(t){if(!this._init){var e=t.key,r;if(typeof e=="string"&&(e.length===16||e.length===24||e.length===32))e=Nn.util.createBuffer(e);else if(Nn.util.isArray(e)&&(e.length===16||e.length===24||e.length===32)){r=e,e=Nn.util.createBuffer();for(var n=0;n<r.length;++n)e.putByte(r[n])}if(!Nn.util.isArray(e)){r=e,e=[];var o=r.length();if(o===16||o===24||o===32){o=o>>>2;for(var n=0;n<o;++n)e.push(r.getInt32())}}if(!Nn.util.isArray(e)||!(e.length===4||e.length===6||e.length===8))throw new Error("Invalid key parameter.");var s=this.mode.name,a=["CFB","OFB","CTR","GCM"].indexOf(s)!==-1;this._w=The(e,t.decrypt&&!a),this._init=!0}};Nn.aes._expandKey=function(t,e){return gW||Che(),The(t,e)};Nn.aes._updateBlock=hW;xC("AES-ECB",Nn.cipher.modes.ecb);xC("AES-CBC",Nn.cipher.modes.cbc);xC("AES-CFB",Nn.cipher.modes.cfb);xC("AES-OFB",Nn.cipher.modes.ofb);xC("AES-CTR",Nn.cipher.modes.ctr);xC("AES-GCM",Nn.cipher.modes.gcm);function xC(t,e){var r=function(){return new Nn.aes.Algorithm(t,e)};Nn.cipher.registerAlgorithm(t,r)}var gW=!1,_C=4,_a,mW,Ihe,Oy,Yl;function Che(){gW=!0,Ihe=[0,1,2,4,8,16,32,64,128,27,54];for(var t=new Array(256),e=0;e<128;++e)t[e]=e<<1,t[e+128]=e+128<<1^283;_a=new Array(256),mW=new Array(256),Oy=new Array(4),Yl=new Array(4);for(var e=0;e<4;++e)Oy[e]=new Array(256),Yl[e]=new Array(256);for(var r=0,n=0,o,s,a,c,u,l,d,e=0;e<256;++e){c=n^n<<1^n<<2^n<<3^n<<4,c=c>>8^c&255^99,_a[r]=c,mW[c]=r,u=t[c],o=t[r],s=t[o],a=t[s],l=u<<24^c<<16^c<<8^(c^u),d=(o^s^a)<<24^(r^a)<<16^(r^s^a)<<8^(r^o^a);for(var p=0;p<4;++p)Oy[p][r]=l,Yl[p][c]=d,l=l<<24|l>>>8,d=d<<24|d>>>8;r===0?r=n=1:(r=o^t[t[t[o^a]]],n^=t[t[n]])}}function The(t,e){for(var r=t.slice(0),n,o=1,s=r.length,a=s+6+1,c=_C*a,u=s;u<c;++u)n=r[u-1],u%s===0?(n=_a[n>>>16&255]<<24^_a[n>>>8&255]<<16^_a[n&255]<<8^_a[n>>>24]^Ihe[o]<<24,o++):s>6&&u%s===4&&(n=_a[n>>>24]<<24^_a[n>>>16&255]<<16^_a[n>>>8&255]<<8^_a[n&255]),r[u]=r[u-s]^n;if(e){var l,d=Yl[0],p=Yl[1],f=Yl[2],m=Yl[3],h=r.slice(0);c=r.length;for(var u=0,g=c-_C;u<c;u+=_C,g-=_C)if(u===0||u===c-_C)h[u]=r[g],h[u+1]=r[g+3],h[u+2]=r[g+2],h[u+3]=r[g+1];else for(var v=0;v<_C;++v)l=r[g+v],h[u+(3&-v)]=d[_a[l>>>24]]^p[_a[l>>>16&255]]^f[_a[l>>>8&255]]^m[_a[l&255]];r=h}return r}function hW(t,e,r,n){var o=t.length/4-1,s,a,c,u,l;n?(s=Yl[0],a=Yl[1],c=Yl[2],u=Yl[3],l=mW):(s=Oy[0],a=Oy[1],c=Oy[2],u=Oy[3],l=_a);var d,p,f,m,h,g,v;d=e[0]^t[0],p=e[n?3:1]^t[1],f=e[2]^t[2],m=e[n?1:3]^t[3];for(var y=3,_=1;_<o;++_)h=s[d>>>24]^a[p>>>16&255]^c[f>>>8&255]^u[m&255]^t[++y],g=s[p>>>24]^a[f>>>16&255]^c[m>>>8&255]^u[d&255]^t[++y],v=s[f>>>24]^a[m>>>16&255]^c[d>>>8&255]^u[p&255]^t[++y],m=s[m>>>24]^a[d>>>16&255]^c[p>>>8&255]^u[f&255]^t[++y],d=h,p=g,f=v;r[0]=l[d>>>24]<<24^l[p>>>16&255]<<16^l[f>>>8&255]<<8^l[m&255]^t[++y],r[n?3:1]=l[p>>>24]<<24^l[f>>>16&255]<<16^l[m>>>8&255]<<8^l[d&255]^t[++y],r[2]=l[f>>>24]<<24^l[m>>>16&255]<<16^l[d>>>8&255]<<8^l[p&255]^t[++y],r[n?1:3]=l[m>>>24]<<24^l[d>>>16&255]<<16^l[p>>>8&255]<<8^l[f&255]^t[++y]}function gM(t){t=t||{};var e=(t.mode||"CBC").toUpperCase(),r="AES-"+e,n;t.decrypt?n=Nn.cipher.createDecipher(r,t.key):n=Nn.cipher.createCipher(r,t.key);var o=n.start;return n.start=function(s,a){var c=null;a instanceof Nn.util.ByteBuffer&&(c=a,a={}),a=a||{},a.output=c,a.iv=s,o.call(n,a)},n}});var Lv=O(($mr,whe)=>{var a2=cr();a2.pki=a2.pki||{};var vW=whe.exports=a2.pki.oids=a2.oids=a2.oids||{};function Le(t,e){vW[t]=e,vW[e]=t}function mn(t,e){vW[t]=e}Le("1.2.840.113549.1.1.1","rsaEncryption");Le("1.2.840.113549.1.1.4","md5WithRSAEncryption");Le("1.2.840.113549.1.1.5","sha1WithRSAEncryption");Le("1.2.840.113549.1.1.7","RSAES-OAEP");Le("1.2.840.113549.1.1.8","mgf1");Le("1.2.840.113549.1.1.9","pSpecified");Le("1.2.840.113549.1.1.10","RSASSA-PSS");Le("1.2.840.113549.1.1.11","sha256WithRSAEncryption");Le("1.2.840.113549.1.1.12","sha384WithRSAEncryption");Le("1.2.840.113549.1.1.13","sha512WithRSAEncryption");Le("1.3.101.112","EdDSA25519");Le("1.2.840.10040.4.3","dsa-with-sha1");Le("1.3.14.3.2.7","desCBC");Le("1.3.14.3.2.26","sha1");Le("1.3.14.3.2.29","sha1WithRSASignature");Le("2.16.840.1.101.3.4.2.1","sha256");Le("2.16.840.1.101.3.4.2.2","sha384");Le("2.16.840.1.101.3.4.2.3","sha512");Le("2.16.840.1.101.3.4.2.4","sha224");Le("2.16.840.1.101.3.4.2.5","sha512-224");Le("2.16.840.1.101.3.4.2.6","sha512-256");Le("1.2.840.113549.2.2","md2");Le("1.2.840.113549.2.5","md5");Le("1.2.840.113549.1.7.1","data");Le("1.2.840.113549.1.7.2","signedData");Le("1.2.840.113549.1.7.3","envelopedData");Le("1.2.840.113549.1.7.4","signedAndEnvelopedData");Le("1.2.840.113549.1.7.5","digestedData");Le("1.2.840.113549.1.7.6","encryptedData");Le("1.2.840.113549.1.9.1","emailAddress");Le("1.2.840.113549.1.9.2","unstructuredName");Le("1.2.840.113549.1.9.3","contentType");Le("1.2.840.113549.1.9.4","messageDigest");Le("1.2.840.113549.1.9.5","signingTime");Le("1.2.840.113549.1.9.6","counterSignature");Le("1.2.840.113549.1.9.7","challengePassword");Le("1.2.840.113549.1.9.8","unstructuredAddress");Le("1.2.840.113549.1.9.14","extensionRequest");Le("1.2.840.113549.1.9.20","friendlyName");Le("1.2.840.113549.1.9.21","localKeyId");Le("1.2.840.113549.1.9.22.1","x509Certificate");Le("1.2.840.113549.1.12.10.1.1","keyBag");Le("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");Le("1.2.840.113549.1.12.10.1.3","certBag");Le("1.2.840.113549.1.12.10.1.4","crlBag");Le("1.2.840.113549.1.12.10.1.5","secretBag");Le("1.2.840.113549.1.12.10.1.6","safeContentsBag");Le("1.2.840.113549.1.5.13","pkcs5PBES2");Le("1.2.840.113549.1.5.12","pkcs5PBKDF2");Le("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");Le("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");Le("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");Le("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");Le("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");Le("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");Le("1.2.840.113549.2.7","hmacWithSHA1");Le("1.2.840.113549.2.8","hmacWithSHA224");Le("1.2.840.113549.2.9","hmacWithSHA256");Le("1.2.840.113549.2.10","hmacWithSHA384");Le("1.2.840.113549.2.11","hmacWithSHA512");Le("1.2.840.113549.3.7","des-EDE3-CBC");Le("2.16.840.1.101.3.4.1.2","aes128-CBC");Le("2.16.840.1.101.3.4.1.22","aes192-CBC");Le("2.16.840.1.101.3.4.1.42","aes256-CBC");Le("2.5.4.3","commonName");Le("2.5.4.4","surname");Le("2.5.4.5","serialNumber");Le("2.5.4.6","countryName");Le("2.5.4.7","localityName");Le("2.5.4.8","stateOrProvinceName");Le("2.5.4.9","streetAddress");Le("2.5.4.10","organizationName");Le("2.5.4.11","organizationalUnitName");Le("2.5.4.12","title");Le("2.5.4.13","description");Le("2.5.4.15","businessCategory");Le("2.5.4.17","postalCode");Le("2.5.4.42","givenName");Le("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");Le("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");Le("2.16.840.1.113730.1.1","nsCertType");Le("2.16.840.1.113730.1.13","nsComment");mn("2.5.29.1","authorityKeyIdentifier");mn("2.5.29.2","keyAttributes");mn("2.5.29.3","certificatePolicies");mn("2.5.29.4","keyUsageRestriction");mn("2.5.29.5","policyMapping");mn("2.5.29.6","subtreesConstraint");mn("2.5.29.7","subjectAltName");mn("2.5.29.8","issuerAltName");mn("2.5.29.9","subjectDirectoryAttributes");mn("2.5.29.10","basicConstraints");mn("2.5.29.11","nameConstraints");mn("2.5.29.12","policyConstraints");mn("2.5.29.13","basicConstraints");Le("2.5.29.14","subjectKeyIdentifier");Le("2.5.29.15","keyUsage");mn("2.5.29.16","privateKeyUsagePeriod");Le("2.5.29.17","subjectAltName");Le("2.5.29.18","issuerAltName");Le("2.5.29.19","basicConstraints");mn("2.5.29.20","cRLNumber");mn("2.5.29.21","cRLReason");mn("2.5.29.22","expirationDate");mn("2.5.29.23","instructionCode");mn("2.5.29.24","invalidityDate");mn("2.5.29.25","cRLDistributionPoints");mn("2.5.29.26","issuingDistributionPoint");mn("2.5.29.27","deltaCRLIndicator");mn("2.5.29.28","issuingDistributionPoint");mn("2.5.29.29","certificateIssuer");mn("2.5.29.30","nameConstraints");Le("2.5.29.31","cRLDistributionPoints");Le("2.5.29.32","certificatePolicies");mn("2.5.29.33","policyMappings");mn("2.5.29.34","policyConstraints");Le("2.5.29.35","authorityKeyIdentifier");mn("2.5.29.36","policyConstraints");Le("2.5.29.37","extKeyUsage");mn("2.5.29.46","freshestCRL");mn("2.5.29.54","inhibitAnyPolicy");Le("1.3.6.1.4.1.11129.2.4.2","timestampList");Le("1.3.6.1.5.5.7.1.1","authorityInfoAccess");Le("1.3.6.1.5.5.7.3.1","serverAuth");Le("1.3.6.1.5.5.7.3.2","clientAuth");Le("1.3.6.1.5.5.7.3.3","codeSigning");Le("1.3.6.1.5.5.7.3.4","emailProtection");Le("1.3.6.1.5.5.7.3.8","timeStamping")});var Ql=O((Wmr,khe)=>{var zn=cr();$r();Lv();var rt=khe.exports=zn.asn1=zn.asn1||{};rt.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};rt.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};rt.create=function(t,e,r,n,o){if(zn.util.isArray(n)){for(var s=[],a=0;a<n.length;++a)n[a]!==void 0&&s.push(n[a]);n=s}var c={tagClass:t,type:e,constructed:r,composed:r||zn.util.isArray(n),value:n};return o&&"bitStringContents"in o&&(c.bitStringContents=o.bitStringContents,c.original=rt.copy(c)),c};rt.copy=function(t,e){var r;if(zn.util.isArray(t)){r=[];for(var n=0;n<t.length;++n)r.push(rt.copy(t[n],e));return r}return typeof t=="string"?t:(r={tagClass:t.tagClass,type:t.type,constructed:t.constructed,composed:t.composed,value:rt.copy(t.value,e)},e&&!e.excludeBitStringContents&&(r.bitStringContents=t.bitStringContents),r)};rt.equals=function(t,e,r){if(zn.util.isArray(t)){if(!zn.util.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!rt.equals(t[n],e[n]))return!1;return!0}if(typeof t!=typeof e)return!1;if(typeof t=="string")return t===e;var o=t.tagClass===e.tagClass&&t.type===e.type&&t.constructed===e.constructed&&t.composed===e.composed&&rt.equals(t.value,e.value);return r&&r.includeBitStringContents&&(o=o&&t.bitStringContents===e.bitStringContents),o};rt.getBerValueLength=function(t){var e=t.getByte();if(e!==128){var r,n=e&128;return n?r=t.getInt((e&127)<<3):r=e,r}};function c2(t,e,r){if(r>e){var n=new Error("Too few bytes to parse DER.");throw n.available=t.length(),n.remaining=e,n.requested=r,n}}var dVe=function(t,e){var r=t.getByte();if(e--,r!==128){var n,o=r&128;if(!o)n=r;else{var s=r&127;c2(t,e,s),n=t.getInt(s<<3)}if(n<0)throw new Error("Negative length: "+n);return n}};rt.fromDer=function(t,e){e===void 0&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof e=="boolean"&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),typeof t=="string"&&(t=zn.util.createBuffer(t));var r=t.length(),n=vM(t,t.length(),0,e);if(e.parseAllBytes&&t.length()!==0){var o=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw o.byteCount=r,o.remaining=t.length(),o}return n};function vM(t,e,r,n){var o;c2(t,e,2);var s=t.getByte();e--;var a=s&192,c=s&31;o=t.length();var u=dVe(t,e);if(e-=o-t.length(),u!==void 0&&u>e){if(n.strict){var l=new Error("Too few bytes to read ASN.1 value.");throw l.available=t.length(),l.remaining=e,l.requested=u,l}u=e}var d,p,f=(s&32)===32;if(f)if(d=[],u===void 0)for(;;){if(c2(t,e,2),t.bytes(2)==="\0\0"){t.getBytes(2),e-=2;break}o=t.length(),d.push(vM(t,e,r+1,n)),e-=o-t.length()}else for(;u>0;)o=t.length(),d.push(vM(t,u,r+1,n)),e-=o-t.length(),u-=o-t.length();if(d===void 0&&a===rt.Class.UNIVERSAL&&c===rt.Type.BITSTRING&&(p=t.bytes(u)),d===void 0&&n.decodeBitStrings&&a===rt.Class.UNIVERSAL&&c===rt.Type.BITSTRING&&u>1){var m=t.read,h=e,g=0;if(c===rt.Type.BITSTRING&&(c2(t,e,1),g=t.getByte(),e--),g===0)try{o=t.length();var v={strict:!0,decodeBitStrings:!0},y=vM(t,e,r+1,v),_=o-t.length();e-=_,c==rt.Type.BITSTRING&&_++;var x=y.tagClass;_===u&&(x===rt.Class.UNIVERSAL||x===rt.Class.CONTEXT_SPECIFIC)&&(d=[y])}catch{}d===void 0&&(t.read=m,e=h)}if(d===void 0){if(u===void 0){if(n.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");u=e}if(c===rt.Type.BMPSTRING)for(d="";u>0;u-=2)c2(t,e,2),d+=String.fromCharCode(t.getInt16()),e-=2;else d=t.getBytes(u),e-=u}var S=p===void 0?null:{bitStringContents:p};return rt.create(a,c,f,d,S)}rt.toDer=function(t){var e=zn.util.createBuffer(),r=t.tagClass|t.type,n=zn.util.createBuffer(),o=!1;if("bitStringContents"in t&&(o=!0,t.original&&(o=rt.equals(t,t.original))),o)n.putBytes(t.bitStringContents);else if(t.composed){t.constructed?r|=32:n.putByte(0);for(var s=0;s<t.value.length;++s)t.value[s]!==void 0&&n.putBuffer(rt.toDer(t.value[s]))}else if(t.type===rt.Type.BMPSTRING)for(var s=0;s<t.value.length;++s)n.putInt16(t.value.charCodeAt(s));else t.type===rt.Type.INTEGER&&t.value.length>1&&(t.value.charCodeAt(0)===0&&!(t.value.charCodeAt(1)&128)||t.value.charCodeAt(0)===255&&(t.value.charCodeAt(1)&128)===128)?n.putBytes(t.value.substr(1)):n.putBytes(t.value);if(e.putByte(r),n.length()<=127)e.putByte(n.length()&127);else{var a=n.length(),c="";do c+=String.fromCharCode(a&255),a=a>>>8;while(a>0);e.putByte(c.length|128);for(var s=c.length-1;s>=0;--s)e.putByte(c.charCodeAt(s))}return e.putBuffer(n),e};rt.oidToDer=function(t){var e=t.split("."),r=zn.util.createBuffer();r.putByte(40*parseInt(e[0],10)+parseInt(e[1],10));for(var n,o,s,a,c=2;c<e.length;++c){n=!0,o=[],s=parseInt(e[c],10);do a=s&127,s=s>>>7,n||(a|=128),o.push(a),n=!1;while(s>0);for(var u=o.length-1;u>=0;--u)r.putByte(o[u])}return r};rt.derToOid=function(t){var e;typeof t=="string"&&(t=zn.util.createBuffer(t));var r=t.getByte();e=Math.floor(r/40)+"."+r%40;for(var n=0;t.length()>0;)r=t.getByte(),n=n<<7,r&128?n+=r&127:(e+="."+(n+r),n=0);return e};rt.utcTimeToDate=function(t){var e=new Date,r=parseInt(t.substr(0,2),10);r=r>=50?1900+r:2e3+r;var n=parseInt(t.substr(2,2),10)-1,o=parseInt(t.substr(4,2),10),s=parseInt(t.substr(6,2),10),a=parseInt(t.substr(8,2),10),c=0;if(t.length>11){var u=t.charAt(10),l=10;u!=="+"&&u!=="-"&&(c=parseInt(t.substr(10,2),10),l+=2)}if(e.setUTCFullYear(r,n,o),e.setUTCHours(s,a,c,0),l&&(u=t.charAt(l),u==="+"||u==="-")){var d=parseInt(t.substr(l+1,2),10),p=parseInt(t.substr(l+4,2),10),f=d*60+p;f*=6e4,u==="+"?e.setTime(+e-f):e.setTime(+e+f)}return e};rt.generalizedTimeToDate=function(t){var e=new Date,r=parseInt(t.substr(0,4),10),n=parseInt(t.substr(4,2),10)-1,o=parseInt(t.substr(6,2),10),s=parseInt(t.substr(8,2),10),a=parseInt(t.substr(10,2),10),c=parseInt(t.substr(12,2),10),u=0,l=0,d=!1;t.charAt(t.length-1)==="Z"&&(d=!0);var p=t.length-5,f=t.charAt(p);if(f==="+"||f==="-"){var m=parseInt(t.substr(p+1,2),10),h=parseInt(t.substr(p+4,2),10);l=m*60+h,l*=6e4,f==="+"&&(l*=-1),d=!0}return t.charAt(14)==="."&&(u=parseFloat(t.substr(14),10)*1e3),d?(e.setUTCFullYear(r,n,o),e.setUTCHours(s,a,c,u),e.setTime(+e+l)):(e.setFullYear(r,n,o),e.setHours(s,a,c,u)),e};rt.dateToUtcTime=function(t){if(typeof t=="string")return t;var e="",r=[];r.push((""+t.getUTCFullYear()).substr(2)),r.push(""+(t.getUTCMonth()+1)),r.push(""+t.getUTCDate()),r.push(""+t.getUTCHours()),r.push(""+t.getUTCMinutes()),r.push(""+t.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(e+="0"),e+=r[n];return e+="Z",e};rt.dateToGeneralizedTime=function(t){if(typeof t=="string")return t;var e="",r=[];r.push(""+t.getUTCFullYear()),r.push(""+(t.getUTCMonth()+1)),r.push(""+t.getUTCDate()),r.push(""+t.getUTCHours()),r.push(""+t.getUTCMinutes()),r.push(""+t.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(e+="0"),e+=r[n];return e+="Z",e};rt.integerToDer=function(t){var e=zn.util.createBuffer();if(t>=-128&&t<128)return e.putSignedInt(t,8);if(t>=-32768&&t<32768)return e.putSignedInt(t,16);if(t>=-8388608&&t<8388608)return e.putSignedInt(t,24);if(t>=-2147483648&&t<2147483648)return e.putSignedInt(t,32);var r=new Error("Integer too large; max is 32-bits.");throw r.integer=t,r};rt.derToInteger=function(t){typeof t=="string"&&(t=zn.util.createBuffer(t));var e=t.length()*8;if(e>32)throw new Error("Integer too large; max is 32-bits.");return t.getSignedInt(e)};rt.validate=function(t,e,r,n){var o=!1;if((t.tagClass===e.tagClass||typeof e.tagClass>"u")&&(t.type===e.type||typeof e.type>"u"))if(t.constructed===e.constructed||typeof e.constructed>"u"){if(o=!0,e.value&&zn.util.isArray(e.value))for(var s=0,a=0;o&&a<e.value.length;++a)o=e.value[a].optional||!1,t.value[s]&&(o=rt.validate(t.value[s],e.value[a],r,n),o?++s:e.value[a].optional&&(o=!0)),!o&&n&&n.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+t.value.length+'"');if(o&&r&&(e.capture&&(r[e.capture]=t.value),e.captureAsn1&&(r[e.captureAsn1]=t),e.captureBitStringContents&&"bitStringContents"in t&&(r[e.captureBitStringContents]=t.bitStringContents),e.captureBitStringValue&&"bitStringContents"in t)){var c;if(t.bitStringContents.length<2)r[e.captureBitStringValue]="";else{var u=t.bitStringContents.charCodeAt(0);if(u!==0)throw new Error("captureBitStringValue only supported for zero unused bits");r[e.captureBitStringValue]=t.bitStringContents.slice(1)}}}else n&&n.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+t.constructed+'"');else n&&(t.tagClass!==e.tagClass&&n.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+t.tagClass+'"'),t.type!==e.type&&n.push("["+e.name+'] Expected type "'+e.type+'", got "'+t.type+'"'));return o};var Rhe=/[^\\u0000-\\u00ff]/;rt.prettyPrint=function(t,e,r){var n="";e=e||0,r=r||2,e>0&&(n+=`
`);for(var o="",s=0;s<e*r;++s)o+=" ";switch(n+=o+"Tag: ",t.tagClass){case rt.Class.UNIVERSAL:n+="Universal:";break;case rt.Class.APPLICATION:n+="Application:";break;case rt.Class.CONTEXT_SPECIFIC:n+="Context-Specific:";break;case rt.Class.PRIVATE:n+="Private:";break}if(t.tagClass===rt.Class.UNIVERSAL)switch(n+=t.type,t.type){case rt.Type.NONE:n+=" (None)";break;case rt.Type.BOOLEAN:n+=" (Boolean)";break;case rt.Type.INTEGER:n+=" (Integer)";break;case rt.Type.BITSTRING:n+=" (Bit string)";break;case rt.Type.OCTETSTRING:n+=" (Octet string)";break;case rt.Type.NULL:n+=" (Null)";break;case rt.Type.OID:n+=" (Object Identifier)";break;case rt.Type.ODESC:n+=" (Object Descriptor)";break;case rt.Type.EXTERNAL:n+=" (External or Instance of)";break;case rt.Type.REAL:n+=" (Real)";break;case rt.Type.ENUMERATED:n+=" (Enumerated)";break;case rt.Type.EMBEDDED:n+=" (Embedded PDV)";break;case rt.Type.UTF8:n+=" (UTF8)";break;case rt.Type.ROID:n+=" (Relative Object Identifier)";break;case rt.Type.SEQUENCE:n+=" (Sequence)";break;case rt.Type.SET:n+=" (Set)";break;case rt.Type.PRINTABLESTRING:n+=" (Printable String)";break;case rt.Type.IA5String:n+=" (IA5String (ASCII))";break;case rt.Type.UTCTIME:n+=" (UTC time)";break;case rt.Type.GENERALIZEDTIME:n+=" (Generalized time)";break;case rt.Type.BMPSTRING:n+=" (BMP String)";break}else n+=t.type;if(n+=`
`,n+=o+"Constructed: "+t.constructed+`
`,t.composed){for(var a=0,c="",s=0;s<t.value.length;++s)t.value[s]!==void 0&&(a+=1,c+=rt.prettyPrint(t.value[s],e+1,r),s+1<t.value.length&&(c+=","));n+=o+"Sub values: "+a+c}else{if(n+=o+"Value: ",t.type===rt.Type.OID){var u=rt.derToOid(t.value);n+=u,zn.pki&&zn.pki.oids&&u in zn.pki.oids&&(n+=" ("+zn.pki.oids[u]+") ")}if(t.type===rt.Type.INTEGER)try{n+=rt.derToInteger(t.value)}catch{n+="0x"+zn.util.bytesToHex(t.value)}else if(t.type===rt.Type.BITSTRING){if(t.value.length>1?n+="0x"+zn.util.bytesToHex(t.value.slice(1)):n+="(none)",t.value.length>0){var l=t.value.charCodeAt(0);l==1?n+=" (1 unused bit shown)":l>1&&(n+=" ("+l+" unused bits shown)")}}else if(t.type===rt.Type.OCTETSTRING)Rhe.test(t.value)||(n+="("+t.value+") "),n+="0x"+zn.util.bytesToHex(t.value);else if(t.type===rt.Type.UTF8)try{n+=zn.util.decodeUtf8(t.value)}catch(d){if(d.message==="URI malformed")n+="0x"+zn.util.bytesToHex(t.value)+" (malformed UTF8)";else throw d}else t.type===rt.Type.PRINTABLESTRING||t.type===rt.Type.IA5String?n+=t.value:Rhe.test(t.value)?n+="0x"+zn.util.bytesToHex(t.value):t.value.length===0?n+="[null]":n+=t.value}return n}});var dp=O((Kmr,Phe)=>{var bM=cr();Phe.exports=bM.md=bM.md||{};bM.md.algorithms=bM.md.algorithms||{}});var SC=O((Ymr,Ahe)=>{var _m=cr();dp();$r();var pVe=Ahe.exports=_m.hmac=_m.hmac||{};pVe.create=function(){var t=null,e=null,r=null,n=null,o={};return o.start=function(s,a){if(s!==null)if(typeof s=="string")if(s=s.toLowerCase(),s in _m.md.algorithms)e=_m.md.algorithms[s].create();else throw new Error('Unknown hash algorithm "'+s+'"');else e=s;if(a===null)a=t;else{if(typeof a=="string")a=_m.util.createBuffer(a);else if(_m.util.isArray(a)){var c=a;a=_m.util.createBuffer();for(var u=0;u<c.length;++u)a.putByte(c[u])}var l=a.length();l>e.blockLength&&(e.start(),e.update(a.bytes()),a=e.digest()),r=_m.util.createBuffer(),n=_m.util.createBuffer(),l=a.length();for(var u=0;u<l;++u){var c=a.at(u);r.putByte(54^c),n.putByte(92^c)}if(l<e.blockLength)for(var c=e.blockLength-l,u=0;u<c;++u)r.putByte(54),n.putByte(92);t=a,r=r.bytes(),n=n.bytes()}e.start(),e.update(r)},o.update=function(s){e.update(s)},o.getMac=function(){var s=e.digest().bytes();return e.start(),e.update(n),e.update(s),e.digest()},o.digest=o.getMac,o}});var _M=O((Qmr,Ohe)=>{var pp=cr();dp();$r();var Nhe=Ohe.exports=pp.md5=pp.md5||{};pp.md.md5=pp.md.algorithms.md5=Nhe;Nhe.create=function(){Lhe||fVe();var t=null,e=pp.util.createBuffer(),r=new Array(16),n={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var o=n.messageLengthSize/4,s=0;s<o;++s)n.fullMessageLength.push(0);return e=pp.util.createBuffer(),t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},n},n.start(),n.update=function(o,s){s==="utf8"&&(o=pp.util.encodeUtf8(o));var a=o.length;n.messageLength+=a,a=[a/4294967296>>>0,a>>>0];for(var c=n.fullMessageLength.length-1;c>=0;--c)n.fullMessageLength[c]+=a[1],a[1]=a[0]+(n.fullMessageLength[c]/4294967296>>>0),n.fullMessageLength[c]=n.fullMessageLength[c]>>>0,a[0]=a[1]/4294967296>>>0;return e.putBytes(o),Dhe(t,r,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var o=pp.util.createBuffer();o.putBytes(e.bytes());var s=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,a=s&n.blockLength-1;o.putBytes(bW.substr(0,n.blockLength-a));for(var c,u=0,l=n.fullMessageLength.length-1;l>=0;--l)c=n.fullMessageLength[l]*8+u,u=c/4294967296>>>0,o.putInt32Le(c>>>0);var d={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3};Dhe(d,r,o);var p=pp.util.createBuffer();return p.putInt32Le(d.h0),p.putInt32Le(d.h1),p.putInt32Le(d.h2),p.putInt32Le(d.h3),p},n};var bW=null,yM=null,u2=null,IC=null,Lhe=!1;function fVe(){bW="\x80",bW+=pp.util.fillString("\0",64),yM=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],u2=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],IC=new Array(64);for(var t=0;t<64;++t)IC[t]=Math.floor(Math.abs(Math.sin(t+1))*4294967296);Lhe=!0}function Dhe(t,e,r){for(var n,o,s,a,c,u,l,d,p=r.length();p>=64;){for(o=t.h0,s=t.h1,a=t.h2,c=t.h3,d=0;d<16;++d)e[d]=r.getInt32Le(),u=c^s&(a^c),n=o+u+IC[d]+e[d],l=u2[d],o=c,c=a,a=s,s+=n<<l|n>>>32-l;for(;d<32;++d)u=a^c&(s^a),n=o+u+IC[d]+e[yM[d]],l=u2[d],o=c,c=a,a=s,s+=n<<l|n>>>32-l;for(;d<48;++d)u=s^a^c,n=o+u+IC[d]+e[yM[d]],l=u2[d],o=c,c=a,a=s,s+=n<<l|n>>>32-l;for(;d<64;++d)u=a^(s|~c),n=o+u+IC[d]+e[yM[d]],l=u2[d],o=c,c=a,a=s,s+=n<<l|n>>>32-l;t.h0=t.h0+o|0,t.h1=t.h1+s|0,t.h2=t.h2+a|0,t.h3=t.h3+c|0,p-=64}}});var My=O((Xmr,Fhe)=>{var SM=cr();$r();var Mhe=Fhe.exports=SM.pem=SM.pem||{};Mhe.encode=function(t,e){e=e||{};var r="-----BEGIN "+t.type+`-----\r
`,n;if(t.procType&&(n={name:"Proc-Type",values:[String(t.procType.version),t.procType.type]},r+=xM(n)),t.contentDomain&&(n={name:"Content-Domain",values:[t.contentDomain]},r+=xM(n)),t.dekInfo&&(n={name:"DEK-Info",values:[t.dekInfo.algorithm]},t.dekInfo.parameters&&n.values.push(t.dekInfo.parameters),r+=xM(n)),t.headers)for(var o=0;o<t.headers.length;++o)r+=xM(t.headers[o]);return t.procType&&(r+=`\r
`),r+=SM.util.encode64(t.body,e.maxline||64)+`\r
`,r+="-----END "+t.type+`-----\r
`,r};Mhe.decode=function(t){for(var e=[],r=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,n=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,o=/\r?\n/,s;s=r.exec(t),!!s;){var a=s[1];a==="NEW CERTIFICATE REQUEST"&&(a="CERTIFICATE REQUEST");var c={type:a,procType:null,contentDomain:null,dekInfo:null,headers:[],body:SM.util.decode64(s[3])};if(e.push(c),!!s[2]){for(var u=s[2].split(o),l=0;s&&l<u.length;){for(var d=u[l].replace(/\s+$/,""),p=l+1;p<u.length;++p){var f=u[p];if(!/\s/.test(f[0]))break;d+=f,l=p}if(s=d.match(n),s){for(var m={name:s[1],values:[]},h=s[2].split(","),g=0;g<h.length;++g)m.values.push(mVe(h[g]));if(c.procType)if(!c.contentDomain&&m.name==="Content-Domain")c.contentDomain=h[0]||"";else if(!c.dekInfo&&m.name==="DEK-Info"){if(m.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');c.dekInfo={algorithm:h[0],parameters:h[1]||null}}else c.headers.push(m);else{if(m.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(m.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');c.procType={version:h[0],type:h[1]}}}++l}if(c.procType==="ENCRYPTED"&&!c.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(e.length===0)throw new Error("Invalid PEM formatted message.");return e};function xM(t){for(var e=t.name+": ",r=[],n=function(u,l){return" "+l},o=0;o<t.values.length;++o)r.push(t.values[o].replace(/^(\S+\r\n)/,n));e+=r.join(",")+`\r
`;for(var s=0,a=-1,o=0;o<e.length;++o,++s)if(s>65&&a!==-1){var c=e[a];c===","?(++a,e=e.substr(0,a)+`\r
 `+e.substr(a)):e=e.substr(0,a)+`\r
`+c+e.substr(a+1),s=o-a-1,a=-1,++o}else(e[o]===" "||e[o]==="	"||e[o]===",")&&(a=o);return e}function mVe(t){return t.replace(/^\s+/,"")}});var l2=O((Jmr,Bhe)=>{var ei=cr();fM();fW();$r();Bhe.exports=ei.des=ei.des||{};ei.des.startEncrypting=function(t,e,r,n){var o=IM({key:t,output:r,decrypt:!1,mode:n||(e===null?"ECB":"CBC")});return o.start(e),o};ei.des.createEncryptionCipher=function(t,e){return IM({key:t,output:null,decrypt:!1,mode:e})};ei.des.startDecrypting=function(t,e,r,n){var o=IM({key:t,output:r,decrypt:!0,mode:n||(e===null?"ECB":"CBC")});return o.start(e),o};ei.des.createDecryptionCipher=function(t,e){return IM({key:t,output:null,decrypt:!0,mode:e})};ei.des.Algorithm=function(t,e){var r=this;r.name=t,r.mode=new e({blockSize:8,cipher:{encrypt:function(n,o){return Uhe(r._keys,n,o,!1)},decrypt:function(n,o){return Uhe(r._keys,n,o,!0)}}}),r._init=!1};ei.des.Algorithm.prototype.initialize=function(t){if(!this._init){var e=ei.util.createBuffer(t.key);if(this.name.indexOf("3DES")===0&&e.length()!==24)throw new Error("Invalid Triple-DES key size: "+e.length()*8);this._keys=IVe(e),this._init=!0}};fp("DES-ECB",ei.cipher.modes.ecb);fp("DES-CBC",ei.cipher.modes.cbc);fp("DES-CFB",ei.cipher.modes.cfb);fp("DES-OFB",ei.cipher.modes.ofb);fp("DES-CTR",ei.cipher.modes.ctr);fp("3DES-ECB",ei.cipher.modes.ecb);fp("3DES-CBC",ei.cipher.modes.cbc);fp("3DES-CFB",ei.cipher.modes.cfb);fp("3DES-OFB",ei.cipher.modes.ofb);fp("3DES-CTR",ei.cipher.modes.ctr);function fp(t,e){var r=function(){return new ei.des.Algorithm(t,e)};ei.cipher.registerAlgorithm(t,r)}var hVe=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],gVe=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],vVe=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],bVe=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],yVe=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],_Ve=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],xVe=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],SVe=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function IVe(t){for(var e=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],r=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],n=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],o=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],a=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],c=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],u=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],l=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],d=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],p=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],f=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],m=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],h=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],g=t.length()>8?3:1,v=[],y=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],_=0,x,S=0;S<g;S++){var I=t.getInt32(),E=t.getInt32();x=(I>>>4^E)&252645135,E^=x,I^=x<<4,x=(E>>>-16^I)&65535,I^=x,E^=x<<-16,x=(I>>>2^E)&858993459,E^=x,I^=x<<2,x=(E>>>-16^I)&65535,I^=x,E^=x<<-16,x=(I>>>1^E)&1431655765,E^=x,I^=x<<1,x=(E>>>8^I)&16711935,I^=x,E^=x<<8,x=(I>>>1^E)&1431655765,E^=x,I^=x<<1,x=I<<8|E>>>20&240,I=E<<24|E<<8&16711680|E>>>8&65280|E>>>24&240,E=x;for(var R=0;R<y.length;++R){y[R]?(I=I<<2|I>>>26,E=E<<2|E>>>26):(I=I<<1|I>>>27,E=E<<1|E>>>27),I&=-15,E&=-15;var B=e[I>>>28]|r[I>>>24&15]|n[I>>>20&15]|o[I>>>16&15]|s[I>>>12&15]|a[I>>>8&15]|c[I>>>4&15],V=u[E>>>28]|l[E>>>24&15]|d[E>>>20&15]|p[E>>>16&15]|f[E>>>12&15]|m[E>>>8&15]|h[E>>>4&15];x=(V>>>16^B)&65535,v[_++]=B^x,v[_++]=V^x<<16}}return v}function Uhe(t,e,r,n){var o=t.length===32?3:9,s;o===3?s=n?[30,-2,-2]:[0,32,2]:s=n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var a,c=e[0],u=e[1];a=(c>>>4^u)&252645135,u^=a,c^=a<<4,a=(c>>>16^u)&65535,u^=a,c^=a<<16,a=(u>>>2^c)&858993459,c^=a,u^=a<<2,a=(u>>>8^c)&16711935,c^=a,u^=a<<8,a=(c>>>1^u)&1431655765,u^=a,c^=a<<1,c=c<<1|c>>>31,u=u<<1|u>>>31;for(var l=0;l<o;l+=3){for(var d=s[l+1],p=s[l+2],f=s[l];f!=d;f+=p){var m=u^t[f],h=(u>>>4|u<<28)^t[f+1];a=c,c=u,u=a^(gVe[m>>>24&63]|bVe[m>>>16&63]|_Ve[m>>>8&63]|SVe[m&63]|hVe[h>>>24&63]|vVe[h>>>16&63]|yVe[h>>>8&63]|xVe[h&63])}a=c,c=u,u=a}c=c>>>1|c<<31,u=u>>>1|u<<31,a=(c>>>1^u)&1431655765,u^=a,c^=a<<1,a=(u>>>8^c)&16711935,c^=a,u^=a<<8,a=(u>>>2^c)&858993459,c^=a,u^=a<<2,a=(c>>>16^u)&65535,u^=a,c^=a<<16,a=(c>>>4^u)&252645135,u^=a,c^=a<<4,r[0]=c,r[1]=u}function IM(t){t=t||{};var e=(t.mode||"CBC").toUpperCase(),r="DES-"+e,n;t.decrypt?n=ei.cipher.createDecipher(r,t.key):n=ei.cipher.createCipher(r,t.key);var o=n.start;return n.start=function(s,a){var c=null;a instanceof ei.util.ByteBuffer&&(c=a,a={}),a=a||{},a.output=c,a.iv=s,o.call(n,a)},n}});var CM=O((Zmr,qhe)=>{var xa=cr();SC();dp();$r();var CVe=xa.pkcs5=xa.pkcs5||{},xm;xa.util.isNodejs&&!xa.options.usePureJavaScript&&(xm=require("crypto"));qhe.exports=xa.pbkdf2=CVe.pbkdf2=function(t,e,r,n,o,s){if(typeof o=="function"&&(s=o,o=null),xa.util.isNodejs&&!xa.options.usePureJavaScript&&xm.pbkdf2&&(o===null||typeof o!="object")&&(xm.pbkdf2Sync.length>4||!o||o==="sha1"))return typeof o!="string"&&(o="sha1"),t=Buffer.from(t,"binary"),e=Buffer.from(e,"binary"),s?xm.pbkdf2Sync.length===4?xm.pbkdf2(t,e,r,n,function(x,S){if(x)return s(x);s(null,S.toString("binary"))}):xm.pbkdf2(t,e,r,n,o,function(x,S){if(x)return s(x);s(null,S.toString("binary"))}):xm.pbkdf2Sync.length===4?xm.pbkdf2Sync(t,e,r,n).toString("binary"):xm.pbkdf2Sync(t,e,r,n,o).toString("binary");if((typeof o>"u"||o===null)&&(o="sha1"),typeof o=="string"){if(!(o in xa.md.algorithms))throw new Error("Unknown hash algorithm: "+o);o=xa.md[o].create()}var a=o.digestLength;if(n>4294967295*a){var c=new Error("Derived key is too long.");if(s)return s(c);throw c}var u=Math.ceil(n/a),l=n-(u-1)*a,d=xa.hmac.create();d.start(o,t);var p="",f,m,h;if(!s){for(var g=1;g<=u;++g){d.start(null,null),d.update(e),d.update(xa.util.int32ToBytes(g)),f=h=d.digest().getBytes();for(var v=2;v<=r;++v)d.start(null,null),d.update(h),m=d.digest().getBytes(),f=xa.util.xorBytes(f,m,a),h=m;p+=g<u?f:f.substr(0,l)}return p}var g=1,v;function y(){if(g>u)return s(null,p);d.start(null,null),d.update(e),d.update(xa.util.int32ToBytes(g)),f=h=d.digest().getBytes(),v=2,_()}function _(){if(v<=r)return d.start(null,null),d.update(h),m=d.digest().getBytes(),f=xa.util.xorBytes(f,m,a),h=m,++v,xa.util.setImmediate(_);p+=g<u?f:f.substr(0,l),++g,y()}y()}});var _W=O((ehr,zhe)=>{var mp=cr();dp();$r();var Hhe=zhe.exports=mp.sha256=mp.sha256||{};mp.md.sha256=mp.md.algorithms.sha256=Hhe;Hhe.create=function(){Vhe||TVe();var t=null,e=mp.util.createBuffer(),r=new Array(64),n={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var o=n.messageLengthSize/4,s=0;s<o;++s)n.fullMessageLength.push(0);return e=mp.util.createBuffer(),t={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},n},n.start(),n.update=function(o,s){s==="utf8"&&(o=mp.util.encodeUtf8(o));var a=o.length;n.messageLength+=a,a=[a/4294967296>>>0,a>>>0];for(var c=n.fullMessageLength.length-1;c>=0;--c)n.fullMessageLength[c]+=a[1],a[1]=a[0]+(n.fullMessageLength[c]/4294967296>>>0),n.fullMessageLength[c]=n.fullMessageLength[c]>>>0,a[0]=a[1]/4294967296>>>0;return e.putBytes(o),jhe(t,r,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var o=mp.util.createBuffer();o.putBytes(e.bytes());var s=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,a=s&n.blockLength-1;o.putBytes(yW.substr(0,n.blockLength-a));for(var c,u,l=n.fullMessageLength[0]*8,d=0;d<n.fullMessageLength.length-1;++d)c=n.fullMessageLength[d+1]*8,u=c/4294967296>>>0,l+=u,o.putInt32(l>>>0),l=c>>>0;o.putInt32(l);var p={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4,h5:t.h5,h6:t.h6,h7:t.h7};jhe(p,r,o);var f=mp.util.createBuffer();return f.putInt32(p.h0),f.putInt32(p.h1),f.putInt32(p.h2),f.putInt32(p.h3),f.putInt32(p.h4),f.putInt32(p.h5),f.putInt32(p.h6),f.putInt32(p.h7),f},n};var yW=null,Vhe=!1,Ghe=null;function TVe(){yW="\x80",yW+=mp.util.fillString("\0",64),Ghe=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],Vhe=!0}function jhe(t,e,r){for(var n,o,s,a,c,u,l,d,p,f,m,h,g,v,y,_=r.length();_>=64;){for(l=0;l<16;++l)e[l]=r.getInt32();for(;l<64;++l)n=e[l-2],n=(n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,o=e[l-15],o=(o>>>7|o<<25)^(o>>>18|o<<14)^o>>>3,e[l]=n+e[l-7]+o+e[l-16]|0;for(d=t.h0,p=t.h1,f=t.h2,m=t.h3,h=t.h4,g=t.h5,v=t.h6,y=t.h7,l=0;l<64;++l)a=(h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7),c=v^h&(g^v),s=(d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),u=d&p|f&(d^p),n=y+a+c+Ghe[l]+e[l],o=s+u,y=v,v=g,g=h,h=m+n>>>0,m=f,f=p,p=d,d=n+o>>>0;t.h0=t.h0+d|0,t.h1=t.h1+p|0,t.h2=t.h2+f|0,t.h3=t.h3+m|0,t.h4=t.h4+h|0,t.h5=t.h5+g|0,t.h6=t.h6+v|0,t.h7=t.h7+y|0,_-=64}}});var xW=O((thr,$he)=>{var hp=cr();$r();var TM=null;hp.util.isNodejs&&!hp.options.usePureJavaScript&&!process.versions["node-webkit"]&&(TM=require("crypto"));var EVe=$he.exports=hp.prng=hp.prng||{};EVe.create=function(t){for(var e={plugin:t,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},r=t.md,n=new Array(32),o=0;o<32;++o)n[o]=r.create();e.pools=n,e.pool=0,e.generate=function(l,d){if(!d)return e.generateSync(l);var p=e.plugin.cipher,f=e.plugin.increment,m=e.plugin.formatKey,h=e.plugin.formatSeed,g=hp.util.createBuffer();e.key=null,v();function v(y){if(y)return d(y);if(g.length()>=l)return d(null,g.getBytes(l));if(e.generated>1048575&&(e.key=null),e.key===null)return hp.util.nextTick(function(){s(v)});var _=p(e.key,e.seed);e.generated+=_.length,g.putBytes(_),e.key=m(p(e.key,f(e.seed))),e.seed=h(p(e.key,e.seed)),hp.util.setImmediate(v)}},e.generateSync=function(l){var d=e.plugin.cipher,p=e.plugin.increment,f=e.plugin.formatKey,m=e.plugin.formatSeed;e.key=null;for(var h=hp.util.createBuffer();h.length()<l;){e.generated>1048575&&(e.key=null),e.key===null&&a();var g=d(e.key,e.seed);e.generated+=g.length,h.putBytes(g),e.key=f(d(e.key,p(e.seed))),e.seed=m(d(e.key,e.seed))}return h.getBytes(l)};function s(l){if(e.pools[0].messageLength>=32)return c(),l();var d=32-e.pools[0].messageLength<<5;e.seedFile(d,function(p,f){if(p)return l(p);e.collect(f),c(),l()})}function a(){if(e.pools[0].messageLength>=32)return c();var l=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(l)),c()}function c(){e.reseeds=e.reseeds===4294967295?0:e.reseeds+1;var l=e.plugin.md.create();l.update(e.keyBytes);for(var d=1,p=0;p<32;++p)e.reseeds%d===0&&(l.update(e.pools[p].digest().getBytes()),e.pools[p].start()),d=d<<1;e.keyBytes=l.digest().getBytes(),l.start(),l.update(e.keyBytes);var f=l.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(f),e.generated=0}function u(l){var d=null,p=hp.util.globalScope,f=p.crypto||p.msCrypto;f&&f.getRandomValues&&(d=function(I){return f.getRandomValues(I)});var m=hp.util.createBuffer();if(d)for(;m.length()<l;){var h=Math.max(1,Math.min(l-m.length(),65536)/4),g=new Uint32Array(Math.floor(h));try{d(g);for(var v=0;v<g.length;++v)m.putInt32(g[v])}catch(I){if(!(typeof QuotaExceededError<"u"&&I instanceof QuotaExceededError))throw I}}if(m.length()<l)for(var y,_,x,S=Math.floor(Math.random()*65536);m.length()<l;){_=16807*(S&65535),y=16807*(S>>16),_+=(y&32767)<<16,_+=y>>15,_=(_&2147483647)+(_>>31),S=_&4294967295;for(var v=0;v<3;++v)x=S>>>(v<<3),x^=Math.floor(Math.random()*256),m.putByte(x&255)}return m.getBytes(l)}return TM?(e.seedFile=function(l,d){TM.randomBytes(l,function(p,f){if(p)return d(p);d(null,f.toString())})},e.seedFileSync=function(l){return TM.randomBytes(l).toString()}):(e.seedFile=function(l,d){try{d(null,u(l))}catch(p){d(p)}},e.seedFileSync=u),e.collect=function(l){for(var d=l.length,p=0;p<d;++p)e.pools[e.pool].update(l.substr(p,1)),e.pool=e.pool===31?0:e.pool+1},e.collectInt=function(l,d){for(var p="",f=0;f<d;f+=8)p+=String.fromCharCode(l>>f&255);e.collect(p)},e.registerWorker=function(l){if(l===self)e.seedFile=function(p,f){function m(h){var g=h.data;g.forge&&g.forge.prng&&(self.removeEventListener("message",m),f(g.forge.prng.err,g.forge.prng.bytes))}self.addEventListener("message",m),self.postMessage({forge:{prng:{needed:p}}})};else{var d=function(p){var f=p.data;f.forge&&f.forge.prng&&e.seedFile(f.forge.prng.needed,function(m,h){l.postMessage({forge:{prng:{err:m,bytes:h}}})})};l.addEventListener("message",d)}},e}});var Ou=O((rhr,SW)=>{var es=cr();Nv();_W();xW();$r();(function(){if(es.random&&es.random.getBytes){SW.exports=es.random;return}(function(t){var e={},r=new Array(4),n=es.util.createBuffer();e.formatKey=function(p){var f=es.util.createBuffer(p);return p=new Array(4),p[0]=f.getInt32(),p[1]=f.getInt32(),p[2]=f.getInt32(),p[3]=f.getInt32(),es.aes._expandKey(p,!1)},e.formatSeed=function(p){var f=es.util.createBuffer(p);return p=new Array(4),p[0]=f.getInt32(),p[1]=f.getInt32(),p[2]=f.getInt32(),p[3]=f.getInt32(),p},e.cipher=function(p,f){return es.aes._updateBlock(p,f,r,!1),n.putInt32(r[0]),n.putInt32(r[1]),n.putInt32(r[2]),n.putInt32(r[3]),n.getBytes()},e.increment=function(p){return++p[3],p},e.md=es.md.sha256;function o(){var p=es.prng.create(e);return p.getBytes=function(f,m){return p.generate(f,m)},p.getBytesSync=function(f){return p.generate(f)},p}var s=o(),a=null,c=es.util.globalScope,u=c.crypto||c.msCrypto;if(u&&u.getRandomValues&&(a=function(p){return u.getRandomValues(p)}),es.options.usePureJavaScript||!es.util.isNodejs&&!a){if(typeof window>"u"||window.document,s.collectInt(+new Date,32),typeof navigator<"u"){var l="";for(var d in navigator)try{typeof navigator[d]=="string"&&(l+=navigator[d])}catch{}s.collect(l),l=null}t&&(t().mousemove(function(p){s.collectInt(p.clientX,16),s.collectInt(p.clientY,16)}),t().keypress(function(p){s.collectInt(p.charCode,8)}))}if(!es.random)es.random=s;else for(var d in s)es.random[d]=s[d];es.random.createInstance=o,SW.exports=es.random})(typeof jQuery<"u"?jQuery:null)})()});var CW=O((nhr,Yhe)=>{var Za=cr();$r();var IW=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],Whe=[1,2,3,5],wVe=function(t,e){return t<<e&65535|(t&65535)>>16-e},RVe=function(t,e){return(t&65535)>>e|t<<16-e&65535};Yhe.exports=Za.rc2=Za.rc2||{};Za.rc2.expandKey=function(t,e){typeof t=="string"&&(t=Za.util.createBuffer(t)),e=e||128;var r=t,n=t.length(),o=e,s=Math.ceil(o/8),a=255>>(o&7),c;for(c=n;c<128;c++)r.putByte(IW[r.at(c-1)+r.at(c-n)&255]);for(r.setAt(128-s,IW[r.at(128-s)&a]),c=127-s;c>=0;c--)r.setAt(c,IW[r.at(c+1)^r.at(c+s)]);return r};var Khe=function(t,e,r){var n=!1,o=null,s=null,a=null,c,u,l,d,p=[];for(t=Za.rc2.expandKey(t,e),l=0;l<64;l++)p.push(t.getInt16Le());r?(c=function(h){for(l=0;l<4;l++)h[l]+=p[d]+(h[(l+3)%4]&h[(l+2)%4])+(~h[(l+3)%4]&h[(l+1)%4]),h[l]=wVe(h[l],Whe[l]),d++},u=function(h){for(l=0;l<4;l++)h[l]+=p[h[(l+3)%4]&63]}):(c=function(h){for(l=3;l>=0;l--)h[l]=RVe(h[l],Whe[l]),h[l]-=p[d]+(h[(l+3)%4]&h[(l+2)%4])+(~h[(l+3)%4]&h[(l+1)%4]),d--},u=function(h){for(l=3;l>=0;l--)h[l]-=p[h[(l+3)%4]&63]});var f=function(h){var g=[];for(l=0;l<4;l++){var v=o.getInt16Le();a!==null&&(r?v^=a.getInt16Le():a.putInt16Le(v)),g.push(v&65535)}d=r?0:63;for(var y=0;y<h.length;y++)for(var _=0;_<h[y][0];_++)h[y][1](g);for(l=0;l<4;l++)a!==null&&(r?a.putInt16Le(g[l]):g[l]^=a.getInt16Le()),s.putInt16Le(g[l])},m=null;return m={start:function(h,g){h&&typeof h=="string"&&(h=Za.util.createBuffer(h)),n=!1,o=Za.util.createBuffer(),s=g||new Za.util.createBuffer,a=h,m.output=s},update:function(h){for(n||o.putBuffer(h);o.length()>=8;)f([[5,c],[1,u],[6,c],[1,u],[5,c]])},finish:function(h){var g=!0;if(r)if(h)g=h(8,o,!r);else{var v=o.length()===8?8:8-o.length();o.fillWithByte(v,v)}if(g&&(n=!0,m.update()),!r&&(g=o.length()===0,g))if(h)g=h(8,s,!r);else{var y=s.length(),_=s.at(y-1);_>y?g=!1:s.truncate(_)}return g}},m};Za.rc2.startEncrypting=function(t,e,r){var n=Za.rc2.createEncryptionCipher(t,128);return n.start(e,r),n};Za.rc2.createEncryptionCipher=function(t,e){return Khe(t,e,!0)};Za.rc2.startDecrypting=function(t,e,r){var n=Za.rc2.createDecryptionCipher(t,128);return n.start(e,r),n};Za.rc2.createDecryptionCipher=function(t,e){return Khe(t,e,!1)}});var p2=O((ihr,nge)=>{var TW=cr();nge.exports=TW.jsbn=TW.jsbn||{};var Sm,kVe=0xdeadbeefcafe,Qhe=(kVe&16777215)==15715070;function Ce(t,e,r){this.data=[],t!=null&&(typeof t=="number"?this.fromNumber(t,e,r):e==null&&typeof t!="string"?this.fromString(t,256):this.fromString(t,e))}TW.jsbn.BigInteger=Ce;function Wr(){return new Ce(null)}function PVe(t,e,r,n,o,s){for(;--s>=0;){var a=e*this.data[t++]+r.data[n]+o;o=Math.floor(a/67108864),r.data[n++]=a&67108863}return o}function AVe(t,e,r,n,o,s){for(var a=e&32767,c=e>>15;--s>=0;){var u=this.data[t]&32767,l=this.data[t++]>>15,d=c*u+l*a;u=a*u+((d&32767)<<15)+r.data[n]+(o&1073741823),o=(u>>>30)+(d>>>15)+c*l+(o>>>30),r.data[n++]=u&1073741823}return o}function Xhe(t,e,r,n,o,s){for(var a=e&16383,c=e>>14;--s>=0;){var u=this.data[t]&16383,l=this.data[t++]>>14,d=c*u+l*a;u=a*u+((d&16383)<<14)+r.data[n]+o,o=(u>>28)+(d>>14)+c*l,r.data[n++]=u&268435455}return o}typeof navigator>"u"?(Ce.prototype.am=Xhe,Sm=28):Qhe&&navigator.appName=="Microsoft Internet Explorer"?(Ce.prototype.am=AVe,Sm=30):Qhe&&navigator.appName!="Netscape"?(Ce.prototype.am=PVe,Sm=26):(Ce.prototype.am=Xhe,Sm=28);Ce.prototype.DB=Sm;Ce.prototype.DM=(1<<Sm)-1;Ce.prototype.DV=1<<Sm;var EW=52;Ce.prototype.FV=Math.pow(2,EW);Ce.prototype.F1=EW-Sm;Ce.prototype.F2=2*Sm-EW;var DVe="0123456789abcdefghijklmnopqrstuvwxyz",EM=new Array,CC,Mu;CC=48;for(Mu=0;Mu<=9;++Mu)EM[CC++]=Mu;CC=97;for(Mu=10;Mu<36;++Mu)EM[CC++]=Mu;CC=65;for(Mu=10;Mu<36;++Mu)EM[CC++]=Mu;function Jhe(t){return DVe.charAt(t)}function Zhe(t,e){var r=EM[t.charCodeAt(e)];return r??-1}function NVe(t){for(var e=this.t-1;e>=0;--e)t.data[e]=this.data[e];t.t=this.t,t.s=this.s}function LVe(t){this.t=1,this.s=t<0?-1:0,t>0?this.data[0]=t:t<-1?this.data[0]=t+this.DV:this.t=0}function Ov(t){var e=Wr();return e.fromInt(t),e}function OVe(t,e){var r;if(e==16)r=4;else if(e==8)r=3;else if(e==256)r=8;else if(e==2)r=1;else if(e==32)r=5;else if(e==4)r=2;else{this.fromRadix(t,e);return}this.t=0,this.s=0;for(var n=t.length,o=!1,s=0;--n>=0;){var a=r==8?t[n]&255:Zhe(t,n);if(a<0){t.charAt(n)=="-"&&(o=!0);continue}o=!1,s==0?this.data[this.t++]=a:s+r>this.DB?(this.data[this.t-1]|=(a&(1<<this.DB-s)-1)<<s,this.data[this.t++]=a>>this.DB-s):this.data[this.t-1]|=a<<s,s+=r,s>=this.DB&&(s-=this.DB)}r==8&&t[0]&128&&(this.s=-1,s>0&&(this.data[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),o&&Ce.ZERO.subTo(this,this)}function MVe(){for(var t=this.s&this.DM;this.t>0&&this.data[this.t-1]==t;)--this.t}function FVe(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(t==16)e=4;else if(t==8)e=3;else if(t==2)e=1;else if(t==32)e=5;else if(t==4)e=2;else return this.toRadix(t);var r=(1<<e)-1,n,o=!1,s="",a=this.t,c=this.DB-a*this.DB%e;if(a-- >0)for(c<this.DB&&(n=this.data[a]>>c)>0&&(o=!0,s=Jhe(n));a>=0;)c<e?(n=(this.data[a]&(1<<c)-1)<<e-c,n|=this.data[--a]>>(c+=this.DB-e)):(n=this.data[a]>>(c-=e)&r,c<=0&&(c+=this.DB,--a)),n>0&&(o=!0),o&&(s+=Jhe(n));return o?s:"0"}function UVe(){var t=Wr();return Ce.ZERO.subTo(this,t),t}function BVe(){return this.s<0?this.negate():this}function qVe(t){var e=this.s-t.s;if(e!=0)return e;var r=this.t;if(e=r-t.t,e!=0)return this.s<0?-e:e;for(;--r>=0;)if((e=this.data[r]-t.data[r])!=0)return e;return 0}function wM(t){var e=1,r;return(r=t>>>16)!=0&&(t=r,e+=16),(r=t>>8)!=0&&(t=r,e+=8),(r=t>>4)!=0&&(t=r,e+=4),(r=t>>2)!=0&&(t=r,e+=2),(r=t>>1)!=0&&(t=r,e+=1),e}function jVe(){return this.t<=0?0:this.DB*(this.t-1)+wM(this.data[this.t-1]^this.s&this.DM)}function HVe(t,e){var r;for(r=this.t-1;r>=0;--r)e.data[r+t]=this.data[r];for(r=t-1;r>=0;--r)e.data[r]=0;e.t=this.t+t,e.s=this.s}function VVe(t,e){for(var r=t;r<this.t;++r)e.data[r-t]=this.data[r];e.t=Math.max(this.t-t,0),e.s=this.s}function GVe(t,e){var r=t%this.DB,n=this.DB-r,o=(1<<n)-1,s=Math.floor(t/this.DB),a=this.s<<r&this.DM,c;for(c=this.t-1;c>=0;--c)e.data[c+s+1]=this.data[c]>>n|a,a=(this.data[c]&o)<<r;for(c=s-1;c>=0;--c)e.data[c]=0;e.data[s]=a,e.t=this.t+s+1,e.s=this.s,e.clamp()}function zVe(t,e){e.s=this.s;var r=Math.floor(t/this.DB);if(r>=this.t){e.t=0;return}var n=t%this.DB,o=this.DB-n,s=(1<<n)-1;e.data[0]=this.data[r]>>n;for(var a=r+1;a<this.t;++a)e.data[a-r-1]|=(this.data[a]&s)<<o,e.data[a-r]=this.data[a]>>n;n>0&&(e.data[this.t-r-1]|=(this.s&s)<<o),e.t=this.t-r,e.clamp()}function $Ve(t,e){for(var r=0,n=0,o=Math.min(t.t,this.t);r<o;)n+=this.data[r]-t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n-=t.s;r<this.t;)n+=this.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<t.t;)n-=t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n-=t.s}e.s=n<0?-1:0,n<-1?e.data[r++]=this.DV+n:n>0&&(e.data[r++]=n),e.t=r,e.clamp()}function WVe(t,e){var r=this.abs(),n=t.abs(),o=r.t;for(e.t=o+n.t;--o>=0;)e.data[o]=0;for(o=0;o<n.t;++o)e.data[o+r.t]=r.am(0,n.data[o],e,o,0,r.t);e.s=0,e.clamp(),this.s!=t.s&&Ce.ZERO.subTo(e,e)}function KVe(t){for(var e=this.abs(),r=t.t=2*e.t;--r>=0;)t.data[r]=0;for(r=0;r<e.t-1;++r){var n=e.am(r,e.data[r],t,2*r,0,1);(t.data[r+e.t]+=e.am(r+1,2*e.data[r],t,2*r+1,n,e.t-r-1))>=e.DV&&(t.data[r+e.t]-=e.DV,t.data[r+e.t+1]=1)}t.t>0&&(t.data[t.t-1]+=e.am(r,e.data[r],t,2*r,0,1)),t.s=0,t.clamp()}function YVe(t,e,r){var n=t.abs();if(!(n.t<=0)){var o=this.abs();if(o.t<n.t){e?.fromInt(0),r!=null&&this.copyTo(r);return}r==null&&(r=Wr());var s=Wr(),a=this.s,c=t.s,u=this.DB-wM(n.data[n.t-1]);u>0?(n.lShiftTo(u,s),o.lShiftTo(u,r)):(n.copyTo(s),o.copyTo(r));var l=s.t,d=s.data[l-1];if(d!=0){var p=d*(1<<this.F1)+(l>1?s.data[l-2]>>this.F2:0),f=this.FV/p,m=(1<<this.F1)/p,h=1<<this.F2,g=r.t,v=g-l,y=e??Wr();for(s.dlShiftTo(v,y),r.compareTo(y)>=0&&(r.data[r.t++]=1,r.subTo(y,r)),Ce.ONE.dlShiftTo(l,y),y.subTo(s,s);s.t<l;)s.data[s.t++]=0;for(;--v>=0;){var _=r.data[--g]==d?this.DM:Math.floor(r.data[g]*f+(r.data[g-1]+h)*m);if((r.data[g]+=s.am(0,_,r,v,0,l))<_)for(s.dlShiftTo(v,y),r.subTo(y,r);r.data[g]<--_;)r.subTo(y,r)}e!=null&&(r.drShiftTo(l,e),a!=c&&Ce.ZERO.subTo(e,e)),r.t=l,r.clamp(),u>0&&r.rShiftTo(u,r),a<0&&Ce.ZERO.subTo(r,r)}}}function QVe(t){var e=Wr();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(Ce.ZERO)>0&&t.subTo(e,e),e}function Fy(t){this.m=t}function XVe(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function JVe(t){return t}function ZVe(t){t.divRemTo(this.m,null,t)}function eGe(t,e,r){t.multiplyTo(e,r),this.reduce(r)}function tGe(t,e){t.squareTo(e),this.reduce(e)}Fy.prototype.convert=XVe;Fy.prototype.revert=JVe;Fy.prototype.reduce=ZVe;Fy.prototype.mulTo=eGe;Fy.prototype.sqrTo=tGe;function rGe(){if(this.t<1)return 0;var t=this.data[0];if(!(t&1))return 0;var e=t&3;return e=e*(2-(t&15)*e)&15,e=e*(2-(t&255)*e)&255,e=e*(2-((t&65535)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function Uy(t){this.m=t,this.mp=t.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function nGe(t){var e=Wr();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(Ce.ZERO)>0&&this.m.subTo(e,e),e}function iGe(t){var e=Wr();return t.copyTo(e),this.reduce(e),e}function oGe(t){for(;t.t<=this.mt2;)t.data[t.t++]=0;for(var e=0;e<this.m.t;++e){var r=t.data[e]&32767,n=r*this.mpl+((r*this.mph+(t.data[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(r=e+this.m.t,t.data[r]+=this.m.am(0,n,t,e,0,this.m.t);t.data[r]>=t.DV;)t.data[r]-=t.DV,t.data[++r]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function sGe(t,e){t.squareTo(e),this.reduce(e)}function aGe(t,e,r){t.multiplyTo(e,r),this.reduce(r)}Uy.prototype.convert=nGe;Uy.prototype.revert=iGe;Uy.prototype.reduce=oGe;Uy.prototype.mulTo=aGe;Uy.prototype.sqrTo=sGe;function cGe(){return(this.t>0?this.data[0]&1:this.s)==0}function uGe(t,e){if(t>4294967295||t<1)return Ce.ONE;var r=Wr(),n=Wr(),o=e.convert(this),s=wM(t)-1;for(o.copyTo(r);--s>=0;)if(e.sqrTo(r,n),(t&1<<s)>0)e.mulTo(n,o,r);else{var a=r;r=n,n=a}return e.revert(r)}function lGe(t,e){var r;return t<256||e.isEven()?r=new Fy(e):r=new Uy(e),this.exp(t,r)}Ce.prototype.copyTo=NVe;Ce.prototype.fromInt=LVe;Ce.prototype.fromString=OVe;Ce.prototype.clamp=MVe;Ce.prototype.dlShiftTo=HVe;Ce.prototype.drShiftTo=VVe;Ce.prototype.lShiftTo=GVe;Ce.prototype.rShiftTo=zVe;Ce.prototype.subTo=$Ve;Ce.prototype.multiplyTo=WVe;Ce.prototype.squareTo=KVe;Ce.prototype.divRemTo=YVe;Ce.prototype.invDigit=rGe;Ce.prototype.isEven=cGe;Ce.prototype.exp=uGe;Ce.prototype.toString=FVe;Ce.prototype.negate=UVe;Ce.prototype.abs=BVe;Ce.prototype.compareTo=qVe;Ce.prototype.bitLength=jVe;Ce.prototype.mod=QVe;Ce.prototype.modPowInt=lGe;Ce.ZERO=Ov(0);Ce.ONE=Ov(1);function dGe(){var t=Wr();return this.copyTo(t),t}function pGe(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function fGe(){return this.t==0?this.s:this.data[0]<<24>>24}function mGe(){return this.t==0?this.s:this.data[0]<<16>>16}function hGe(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function gGe(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function vGe(t){if(t==null&&(t=10),this.signum()==0||t<2||t>36)return"0";var e=this.chunkSize(t),r=Math.pow(t,e),n=Ov(r),o=Wr(),s=Wr(),a="";for(this.divRemTo(n,o,s);o.signum()>0;)a=(r+s.intValue()).toString(t).substr(1)+a,o.divRemTo(n,o,s);return s.intValue().toString(t)+a}function bGe(t,e){this.fromInt(0),e==null&&(e=10);for(var r=this.chunkSize(e),n=Math.pow(e,r),o=!1,s=0,a=0,c=0;c<t.length;++c){var u=Zhe(t,c);if(u<0){t.charAt(c)=="-"&&this.signum()==0&&(o=!0);continue}a=e*a+u,++s>=r&&(this.dMultiply(n),this.dAddOffset(a,0),s=0,a=0)}s>0&&(this.dMultiply(Math.pow(e,s)),this.dAddOffset(a,0)),o&&Ce.ZERO.subTo(this,this)}function yGe(t,e,r){if(typeof e=="number")if(t<2)this.fromInt(1);else for(this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(Ce.ONE.shiftLeft(t-1),wW,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(Ce.ONE.shiftLeft(t-1),this);else{var n=new Array,o=t&7;n.length=(t>>3)+1,e.nextBytes(n),o>0?n[0]&=(1<<o)-1:n[0]=0,this.fromString(n,256)}}function _Ge(){var t=this.t,e=new Array;e[0]=this.s;var r=this.DB-t*this.DB%8,n,o=0;if(t-- >0)for(r<this.DB&&(n=this.data[t]>>r)!=(this.s&this.DM)>>r&&(e[o++]=n|this.s<<this.DB-r);t>=0;)r<8?(n=(this.data[t]&(1<<r)-1)<<8-r,n|=this.data[--t]>>(r+=this.DB-8)):(n=this.data[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),n&128&&(n|=-256),o==0&&(this.s&128)!=(n&128)&&++o,(o>0||n!=this.s)&&(e[o++]=n);return e}function xGe(t){return this.compareTo(t)==0}function SGe(t){return this.compareTo(t)<0?this:t}function IGe(t){return this.compareTo(t)>0?this:t}function CGe(t,e,r){var n,o,s=Math.min(t.t,this.t);for(n=0;n<s;++n)r.data[n]=e(this.data[n],t.data[n]);if(t.t<this.t){for(o=t.s&this.DM,n=s;n<this.t;++n)r.data[n]=e(this.data[n],o);r.t=this.t}else{for(o=this.s&this.DM,n=s;n<t.t;++n)r.data[n]=e(o,t.data[n]);r.t=t.t}r.s=e(this.s,t.s),r.clamp()}function TGe(t,e){return t&e}function EGe(t){var e=Wr();return this.bitwiseTo(t,TGe,e),e}function wW(t,e){return t|e}function wGe(t){var e=Wr();return this.bitwiseTo(t,wW,e),e}function ege(t,e){return t^e}function RGe(t){var e=Wr();return this.bitwiseTo(t,ege,e),e}function tge(t,e){return t&~e}function kGe(t){var e=Wr();return this.bitwiseTo(t,tge,e),e}function PGe(){for(var t=Wr(),e=0;e<this.t;++e)t.data[e]=this.DM&~this.data[e];return t.t=this.t,t.s=~this.s,t}function AGe(t){var e=Wr();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function DGe(t){var e=Wr();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function NGe(t){if(t==0)return-1;var e=0;return t&65535||(t>>=16,e+=16),t&255||(t>>=8,e+=8),t&15||(t>>=4,e+=4),t&3||(t>>=2,e+=2),t&1||++e,e}function LGe(){for(var t=0;t<this.t;++t)if(this.data[t]!=0)return t*this.DB+NGe(this.data[t]);return this.s<0?this.t*this.DB:-1}function OGe(t){for(var e=0;t!=0;)t&=t-1,++e;return e}function MGe(){for(var t=0,e=this.s&this.DM,r=0;r<this.t;++r)t+=OGe(this.data[r]^e);return t}function FGe(t){var e=Math.floor(t/this.DB);return e>=this.t?this.s!=0:(this.data[e]&1<<t%this.DB)!=0}function UGe(t,e){var r=Ce.ONE.shiftLeft(t);return this.bitwiseTo(r,e,r),r}function BGe(t){return this.changeBit(t,wW)}function qGe(t){return this.changeBit(t,tge)}function jGe(t){return this.changeBit(t,ege)}function HGe(t,e){for(var r=0,n=0,o=Math.min(t.t,this.t);r<o;)n+=this.data[r]+t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n+=t.s;r<this.t;)n+=this.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<t.t;)n+=t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=t.s}e.s=n<0?-1:0,n>0?e.data[r++]=n:n<-1&&(e.data[r++]=this.DV+n),e.t=r,e.clamp()}function VGe(t){var e=Wr();return this.addTo(t,e),e}function GGe(t){var e=Wr();return this.subTo(t,e),e}function zGe(t){var e=Wr();return this.multiplyTo(t,e),e}function $Ge(t){var e=Wr();return this.divRemTo(t,e,null),e}function WGe(t){var e=Wr();return this.divRemTo(t,null,e),e}function KGe(t){var e=Wr(),r=Wr();return this.divRemTo(t,e,r),new Array(e,r)}function YGe(t){this.data[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function QGe(t,e){if(t!=0){for(;this.t<=e;)this.data[this.t++]=0;for(this.data[e]+=t;this.data[e]>=this.DV;)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function d2(){}function rge(t){return t}function XGe(t,e,r){t.multiplyTo(e,r)}function JGe(t,e){t.squareTo(e)}d2.prototype.convert=rge;d2.prototype.revert=rge;d2.prototype.mulTo=XGe;d2.prototype.sqrTo=JGe;function ZGe(t){return this.exp(t,new d2)}function eze(t,e,r){var n=Math.min(this.t+t.t,e);for(r.s=0,r.t=n;n>0;)r.data[--n]=0;var o;for(o=r.t-this.t;n<o;++n)r.data[n+this.t]=this.am(0,t.data[n],r,n,0,this.t);for(o=Math.min(t.t,e);n<o;++n)this.am(0,t.data[n],r,n,0,e-n);r.clamp()}function tze(t,e,r){--e;var n=r.t=this.t+t.t-e;for(r.s=0;--n>=0;)r.data[n]=0;for(n=Math.max(e-this.t,0);n<t.t;++n)r.data[this.t+n-e]=this.am(e-n,t.data[n],r,0,0,this.t+n-e);r.clamp(),r.drShiftTo(1,r)}function TC(t){this.r2=Wr(),this.q3=Wr(),Ce.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function rze(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=Wr();return t.copyTo(e),this.reduce(e),e}function nze(t){return t}function ize(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function oze(t,e){t.squareTo(e),this.reduce(e)}function sze(t,e,r){t.multiplyTo(e,r),this.reduce(r)}TC.prototype.convert=rze;TC.prototype.revert=nze;TC.prototype.reduce=ize;TC.prototype.mulTo=sze;TC.prototype.sqrTo=oze;function aze(t,e){var r=t.bitLength(),n,o=Ov(1),s;if(r<=0)return o;r<18?n=1:r<48?n=3:r<144?n=4:r<768?n=5:n=6,r<8?s=new Fy(e):e.isEven()?s=new TC(e):s=new Uy(e);var a=new Array,c=3,u=n-1,l=(1<<n)-1;if(a[1]=s.convert(this),n>1){var d=Wr();for(s.sqrTo(a[1],d);c<=l;)a[c]=Wr(),s.mulTo(d,a[c-2],a[c]),c+=2}var p=t.t-1,f,m=!0,h=Wr(),g;for(r=wM(t.data[p])-1;p>=0;){for(r>=u?f=t.data[p]>>r-u&l:(f=(t.data[p]&(1<<r+1)-1)<<u-r,p>0&&(f|=t.data[p-1]>>this.DB+r-u)),c=n;!(f&1);)f>>=1,--c;if((r-=c)<0&&(r+=this.DB,--p),m)a[f].copyTo(o),m=!1;else{for(;c>1;)s.sqrTo(o,h),s.sqrTo(h,o),c-=2;c>0?s.sqrTo(o,h):(g=o,o=h,h=g),s.mulTo(h,a[f],o)}for(;p>=0&&!(t.data[p]&1<<r);)s.sqrTo(o,h),g=o,o=h,h=g,--r<0&&(r=this.DB-1,--p)}return s.revert(o)}function cze(t){var e=this.s<0?this.negate():this.clone(),r=t.s<0?t.negate():t.clone();if(e.compareTo(r)<0){var n=e;e=r,r=n}var o=e.getLowestSetBit(),s=r.getLowestSetBit();if(s<0)return e;for(o<s&&(s=o),s>0&&(e.rShiftTo(s,e),r.rShiftTo(s,r));e.signum()>0;)(o=e.getLowestSetBit())>0&&e.rShiftTo(o,e),(o=r.getLowestSetBit())>0&&r.rShiftTo(o,r),e.compareTo(r)>=0?(e.subTo(r,e),e.rShiftTo(1,e)):(r.subTo(e,r),r.rShiftTo(1,r));return s>0&&r.lShiftTo(s,r),r}function uze(t){if(t<=0)return 0;var e=this.DV%t,r=this.s<0?t-1:0;if(this.t>0)if(e==0)r=this.data[0]%t;else for(var n=this.t-1;n>=0;--n)r=(e*r+this.data[n])%t;return r}function lze(t){var e=t.isEven();if(this.isEven()&&e||t.signum()==0)return Ce.ZERO;for(var r=t.clone(),n=this.clone(),o=Ov(1),s=Ov(0),a=Ov(0),c=Ov(1);r.signum()!=0;){for(;r.isEven();)r.rShiftTo(1,r),e?((!o.isEven()||!s.isEven())&&(o.addTo(this,o),s.subTo(t,s)),o.rShiftTo(1,o)):s.isEven()||s.subTo(t,s),s.rShiftTo(1,s);for(;n.isEven();)n.rShiftTo(1,n),e?((!a.isEven()||!c.isEven())&&(a.addTo(this,a),c.subTo(t,c)),a.rShiftTo(1,a)):c.isEven()||c.subTo(t,c),c.rShiftTo(1,c);r.compareTo(n)>=0?(r.subTo(n,r),e&&o.subTo(a,o),s.subTo(c,s)):(n.subTo(r,n),e&&a.subTo(o,a),c.subTo(s,c))}if(n.compareTo(Ce.ONE)!=0)return Ce.ZERO;if(c.compareTo(t)>=0)return c.subtract(t);if(c.signum()<0)c.addTo(t,c);else return c;return c.signum()<0?c.add(t):c}var Xl=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],dze=(1<<26)/Xl[Xl.length-1];function pze(t){var e,r=this.abs();if(r.t==1&&r.data[0]<=Xl[Xl.length-1]){for(e=0;e<Xl.length;++e)if(r.data[0]==Xl[e])return!0;return!1}if(r.isEven())return!1;for(e=1;e<Xl.length;){for(var n=Xl[e],o=e+1;o<Xl.length&&n<dze;)n*=Xl[o++];for(n=r.modInt(n);e<o;)if(n%Xl[e++]==0)return!1}return r.millerRabin(t)}function fze(t){var e=this.subtract(Ce.ONE),r=e.getLowestSetBit();if(r<=0)return!1;for(var n=e.shiftRight(r),o=mze(),s,a=0;a<t;++a){do s=new Ce(this.bitLength(),o);while(s.compareTo(Ce.ONE)<=0||s.compareTo(e)>=0);var c=s.modPow(n,this);if(c.compareTo(Ce.ONE)!=0&&c.compareTo(e)!=0){for(var u=1;u++<r&&c.compareTo(e)!=0;)if(c=c.modPowInt(2,this),c.compareTo(Ce.ONE)==0)return!1;if(c.compareTo(e)!=0)return!1}}return!0}function mze(){return{nextBytes:function(t){for(var e=0;e<t.length;++e)t[e]=Math.floor(Math.random()*256)}}}Ce.prototype.chunkSize=hGe;Ce.prototype.toRadix=vGe;Ce.prototype.fromRadix=bGe;Ce.prototype.fromNumber=yGe;Ce.prototype.bitwiseTo=CGe;Ce.prototype.changeBit=UGe;Ce.prototype.addTo=HGe;Ce.prototype.dMultiply=YGe;Ce.prototype.dAddOffset=QGe;Ce.prototype.multiplyLowerTo=eze;Ce.prototype.multiplyUpperTo=tze;Ce.prototype.modInt=uze;Ce.prototype.millerRabin=fze;Ce.prototype.clone=dGe;Ce.prototype.intValue=pGe;Ce.prototype.byteValue=fGe;Ce.prototype.shortValue=mGe;Ce.prototype.signum=gGe;Ce.prototype.toByteArray=_Ge;Ce.prototype.equals=xGe;Ce.prototype.min=SGe;Ce.prototype.max=IGe;Ce.prototype.and=EGe;Ce.prototype.or=wGe;Ce.prototype.xor=RGe;Ce.prototype.andNot=kGe;Ce.prototype.not=PGe;Ce.prototype.shiftLeft=AGe;Ce.prototype.shiftRight=DGe;Ce.prototype.getLowestSetBit=LGe;Ce.prototype.bitCount=MGe;Ce.prototype.testBit=FGe;Ce.prototype.setBit=BGe;Ce.prototype.clearBit=qGe;Ce.prototype.flipBit=jGe;Ce.prototype.add=VGe;Ce.prototype.subtract=GGe;Ce.prototype.multiply=zGe;Ce.prototype.divide=$Ge;Ce.prototype.remainder=WGe;Ce.prototype.divideAndRemainder=KGe;Ce.prototype.modPow=aze;Ce.prototype.modInverse=lze;Ce.prototype.pow=ZGe;Ce.prototype.gcd=cze;Ce.prototype.isProbablePrime=pze});var EC=O((ohr,age)=>{var gp=cr();dp();$r();var oge=age.exports=gp.sha1=gp.sha1||{};gp.md.sha1=gp.md.algorithms.sha1=oge;oge.create=function(){sge||hze();var t=null,e=gp.util.createBuffer(),r=new Array(80),n={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var o=n.messageLengthSize/4,s=0;s<o;++s)n.fullMessageLength.push(0);return e=gp.util.createBuffer(),t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},n},n.start(),n.update=function(o,s){s==="utf8"&&(o=gp.util.encodeUtf8(o));var a=o.length;n.messageLength+=a,a=[a/4294967296>>>0,a>>>0];for(var c=n.fullMessageLength.length-1;c>=0;--c)n.fullMessageLength[c]+=a[1],a[1]=a[0]+(n.fullMessageLength[c]/4294967296>>>0),n.fullMessageLength[c]=n.fullMessageLength[c]>>>0,a[0]=a[1]/4294967296>>>0;return e.putBytes(o),ige(t,r,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var o=gp.util.createBuffer();o.putBytes(e.bytes());var s=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,a=s&n.blockLength-1;o.putBytes(RW.substr(0,n.blockLength-a));for(var c,u,l=n.fullMessageLength[0]*8,d=0;d<n.fullMessageLength.length-1;++d)c=n.fullMessageLength[d+1]*8,u=c/4294967296>>>0,l+=u,o.putInt32(l>>>0),l=c>>>0;o.putInt32(l);var p={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4};ige(p,r,o);var f=gp.util.createBuffer();return f.putInt32(p.h0),f.putInt32(p.h1),f.putInt32(p.h2),f.putInt32(p.h3),f.putInt32(p.h4),f},n};var RW=null,sge=!1;function hze(){RW="\x80",RW+=gp.util.fillString("\0",64),sge=!0}function ige(t,e,r){for(var n,o,s,a,c,u,l,d,p=r.length();p>=64;){for(o=t.h0,s=t.h1,a=t.h2,c=t.h3,u=t.h4,d=0;d<16;++d)n=r.getInt32(),e[d]=n,l=c^s&(a^c),n=(o<<5|o>>>27)+l+u+1518500249+n,u=c,c=a,a=(s<<30|s>>>2)>>>0,s=o,o=n;for(;d<20;++d)n=e[d-3]^e[d-8]^e[d-14]^e[d-16],n=n<<1|n>>>31,e[d]=n,l=c^s&(a^c),n=(o<<5|o>>>27)+l+u+1518500249+n,u=c,c=a,a=(s<<30|s>>>2)>>>0,s=o,o=n;for(;d<32;++d)n=e[d-3]^e[d-8]^e[d-14]^e[d-16],n=n<<1|n>>>31,e[d]=n,l=s^a^c,n=(o<<5|o>>>27)+l+u+1859775393+n,u=c,c=a,a=(s<<30|s>>>2)>>>0,s=o,o=n;for(;d<40;++d)n=e[d-6]^e[d-16]^e[d-28]^e[d-32],n=n<<2|n>>>30,e[d]=n,l=s^a^c,n=(o<<5|o>>>27)+l+u+1859775393+n,u=c,c=a,a=(s<<30|s>>>2)>>>0,s=o,o=n;for(;d<60;++d)n=e[d-6]^e[d-16]^e[d-28]^e[d-32],n=n<<2|n>>>30,e[d]=n,l=s&a|c&(s^a),n=(o<<5|o>>>27)+l+u+2400959708+n,u=c,c=a,a=(s<<30|s>>>2)>>>0,s=o,o=n;for(;d<80;++d)n=e[d-6]^e[d-16]^e[d-28]^e[d-32],n=n<<2|n>>>30,e[d]=n,l=s^a^c,n=(o<<5|o>>>27)+l+u+3395469782+n,u=c,c=a,a=(s<<30|s>>>2)>>>0,s=o,o=n;t.h0=t.h0+o|0,t.h1=t.h1+s|0,t.h2=t.h2+a|0,t.h3=t.h3+c|0,t.h4=t.h4+u|0,p-=64}}});var kW=O((shr,uge)=>{var vp=cr();$r();Ou();EC();var cge=uge.exports=vp.pkcs1=vp.pkcs1||{};cge.encode_rsa_oaep=function(t,e,r){var n,o,s,a;typeof r=="string"?(n=r,o=arguments[3]||void 0,s=arguments[4]||void 0):r&&(n=r.label||void 0,o=r.seed||void 0,s=r.md||void 0,r.mgf1&&r.mgf1.md&&(a=r.mgf1.md)),s?s.start():s=vp.md.sha1.create(),a||(a=s);var c=Math.ceil(t.n.bitLength()/8),u=c-2*s.digestLength-2;if(e.length>u){var l=new Error("RSAES-OAEP input message length is too long.");throw l.length=e.length,l.maxLength=u,l}n||(n=""),s.update(n,"raw");for(var d=s.digest(),p="",f=u-e.length,m=0;m<f;m++)p+="\0";var h=d.getBytes()+p+""+e;if(!o)o=vp.random.getBytes(s.digestLength);else if(o.length!==s.digestLength){var l=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw l.seedLength=o.length,l.digestLength=s.digestLength,l}var g=RM(o,c-s.digestLength-1,a),v=vp.util.xorBytes(h,g,h.length),y=RM(v,s.digestLength,a),_=vp.util.xorBytes(o,y,o.length);return"\0"+_+v};cge.decode_rsa_oaep=function(t,e,r){var n,o,s;typeof r=="string"?(n=r,o=arguments[3]||void 0):r&&(n=r.label||void 0,o=r.md||void 0,r.mgf1&&r.mgf1.md&&(s=r.mgf1.md));var a=Math.ceil(t.n.bitLength()/8);if(e.length!==a){var v=new Error("RSAES-OAEP encoded message length is invalid.");throw v.length=e.length,v.expectedLength=a,v}if(o===void 0?o=vp.md.sha1.create():o.start(),s||(s=o),a<2*o.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");n||(n=""),o.update(n,"raw");for(var c=o.digest().getBytes(),u=e.charAt(0),l=e.substring(1,o.digestLength+1),d=e.substring(1+o.digestLength),p=RM(d,o.digestLength,s),f=vp.util.xorBytes(l,p,l.length),m=RM(f,a-o.digestLength-1,s),h=vp.util.xorBytes(d,m,d.length),g=h.substring(0,o.digestLength),v=u!=="\0",y=0;y<o.digestLength;++y)v|=c.charAt(y)!==g.charAt(y);for(var _=1,x=o.digestLength,S=o.digestLength;S<h.length;S++){var I=h.charCodeAt(S),E=I&1^1,R=_?65534:0;v|=I&R,_=_&E,x+=_}if(v||h.charCodeAt(x)!==1)throw new Error("Invalid RSAES-OAEP padding.");return h.substring(x+1)};function RM(t,e,r){r||(r=vp.md.sha1.create());for(var n="",o=Math.ceil(e/r.digestLength),s=0;s<o;++s){var a=String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255);r.start(),r.update(t+a),n+=r.digest().getBytes()}return n.substring(0,e)}});var AW=O((ahr,PW)=>{var Mv=cr();$r();p2();Ou();(function(){if(Mv.prime){PW.exports=Mv.prime;return}var t=PW.exports=Mv.prime=Mv.prime||{},e=Mv.jsbn.BigInteger,r=[6,4,2,4,2,4,6,2],n=new e(null);n.fromInt(30);var o=function(p,f){return p|f};t.generateProbablePrime=function(p,f,m){typeof f=="function"&&(m=f,f={}),f=f||{};var h=f.algorithm||"PRIMEINC";typeof h=="string"&&(h={name:h}),h.options=h.options||{};var g=f.prng||Mv.random,v={nextBytes:function(y){for(var _=g.getBytesSync(y.length),x=0;x<y.length;++x)y[x]=_.charCodeAt(x)}};if(h.name==="PRIMEINC")return s(p,v,h.options,m);throw new Error("Invalid prime generation algorithm: "+h.name)};function s(p,f,m,h){return"workers"in m?u(p,f,m,h):a(p,f,m,h)}function a(p,f,m,h){var g=l(p,f),v=0,y=d(g.bitLength());"millerRabinTests"in m&&(y=m.millerRabinTests);var _=10;"maxBlockTime"in m&&(_=m.maxBlockTime),c(g,p,f,v,y,_,h)}function c(p,f,m,h,g,v,y){var _=+new Date;do{if(p.bitLength()>f&&(p=l(f,m)),p.isProbablePrime(g))return y(null,p);p.dAddOffset(r[h++%8],0)}while(v<0||+new Date-_<v);Mv.util.setImmediate(function(){c(p,f,m,h,g,v,y)})}function u(p,f,m,h){if(typeof Worker>"u")return a(p,f,m,h);var g=l(p,f),v=m.workers,y=m.workLoad||100,_=y*30/8,x=m.workerScript||"forge/prime.worker.js";if(v===-1)return Mv.util.estimateCores(function(I,E){I&&(E=2),v=E-1,S()});S();function S(){v=Math.max(1,v);for(var I=[],E=0;E<v;++E)I[E]=new Worker(x);for(var R=v,E=0;E<v;++E)I[E].addEventListener("message",V);var B=!1;function V(M){if(!B){--R;var le=M.data;if(le.found){for(var ne=0;ne<I.length;++ne)I[ne].terminate();return B=!0,h(null,new e(le.prime,16))}g.bitLength()>p&&(g=l(p,f));var q=g.toString(16);M.target.postMessage({hex:q,workLoad:y}),g.dAddOffset(_,0)}}}}function l(p,f){var m=new e(p,f),h=p-1;return m.testBit(h)||m.bitwiseTo(e.ONE.shiftLeft(h),o,m),m.dAddOffset(31-m.mod(n).byteValue(),0),m}function d(p){return p<=100?27:p<=150?18:p<=200?15:p<=250?12:p<=300?9:p<=350?8:p<=400?7:p<=500?6:p<=600?5:p<=800?4:p<=1250?3:2}})()});var f2=O((chr,gge)=>{var kt=cr();Ql();p2();Lv();kW();AW();Ou();$r();typeof qr>"u"&&(qr=kt.jsbn.BigInteger);var qr,DW=kt.util.isNodejs?require("crypto"):null,se=kt.asn1,Fu=kt.util;kt.pki=kt.pki||{};gge.exports=kt.pki.rsa=kt.rsa=kt.rsa||{};var Jt=kt.pki,gze=[6,4,2,4,2,4,6,2],vze={name:"PrivateKeyInfo",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:se.Class.UNIVERSAL,type:se.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:se.Class.UNIVERSAL,type:se.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},bze={name:"RSAPrivateKey",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},yze={name:"RSAPublicKey",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:se.Class.UNIVERSAL,type:se.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},_ze=kt.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:se.Class.UNIVERSAL,type:se.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:se.Class.UNIVERSAL,type:se.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},xze={name:"DigestInfo",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:se.Class.UNIVERSAL,type:se.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:se.Class.UNIVERSAL,type:se.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:se.Class.UNIVERSAL,type:se.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:se.Class.UNIVERSAL,type:se.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},Sze=function(t){var e;if(t.algorithm in Jt.oids)e=Jt.oids[t.algorithm];else{var r=new Error("Unknown message digest algorithm.");throw r.algorithm=t.algorithm,r}var n=se.oidToDer(e).getBytes(),o=se.create(se.Class.UNIVERSAL,se.Type.SEQUENCE,!0,[]),s=se.create(se.Class.UNIVERSAL,se.Type.SEQUENCE,!0,[]);s.value.push(se.create(se.Class.UNIVERSAL,se.Type.OID,!1,n)),s.value.push(se.create(se.Class.UNIVERSAL,se.Type.NULL,!1,""));var a=se.create(se.Class.UNIVERSAL,se.Type.OCTETSTRING,!1,t.digest().getBytes());return o.value.push(s),o.value.push(a),se.toDer(o).getBytes()},mge=function(t,e,r){if(r)return t.modPow(e.e,e.n);if(!e.p||!e.q)return t.modPow(e.d,e.n);e.dP||(e.dP=e.d.mod(e.p.subtract(qr.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(qr.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));var n;do n=new qr(kt.util.bytesToHex(kt.random.getBytes(e.n.bitLength()/8)),16);while(n.compareTo(e.n)>=0||!n.gcd(e.n).equals(qr.ONE));t=t.multiply(n.modPow(e.e,e.n)).mod(e.n);for(var o=t.mod(e.p).modPow(e.dP,e.p),s=t.mod(e.q).modPow(e.dQ,e.q);o.compareTo(s)<0;)o=o.add(e.p);var a=o.subtract(s).multiply(e.qInv).mod(e.p).multiply(e.q).add(s);return a=a.multiply(n.modInverse(e.n)).mod(e.n),a};Jt.rsa.encrypt=function(t,e,r){var n=r,o,s=Math.ceil(e.n.bitLength()/8);r!==!1&&r!==!0?(n=r===2,o=hge(t,e,r)):(o=kt.util.createBuffer(),o.putBytes(t));for(var a=new qr(o.toHex(),16),c=mge(a,e,n),u=c.toString(16),l=kt.util.createBuffer(),d=s-Math.ceil(u.length/2);d>0;)l.putByte(0),--d;return l.putBytes(kt.util.hexToBytes(u)),l.getBytes()};Jt.rsa.decrypt=function(t,e,r,n){var o=Math.ceil(e.n.bitLength()/8);if(t.length!==o){var s=new Error("Encrypted message length is invalid.");throw s.length=t.length,s.expected=o,s}var a=new qr(kt.util.createBuffer(t).toHex(),16);if(a.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var c=mge(a,e,r),u=c.toString(16),l=kt.util.createBuffer(),d=o-Math.ceil(u.length/2);d>0;)l.putByte(0),--d;return l.putBytes(kt.util.hexToBytes(u)),n!==!1?kM(l.getBytes(),e,r):l.getBytes()};Jt.rsa.createKeyPairGenerationState=function(t,e,r){typeof t=="string"&&(t=parseInt(t,10)),t=t||2048,r=r||{};var n=r.prng||kt.random,o={nextBytes:function(c){for(var u=n.getBytesSync(c.length),l=0;l<c.length;++l)c[l]=u.charCodeAt(l)}},s=r.algorithm||"PRIMEINC",a;if(s==="PRIMEINC")a={algorithm:s,state:0,bits:t,rng:o,eInt:e||65537,e:new qr(null),p:null,q:null,qBits:t>>1,pBits:t-(t>>1),pqState:0,num:null,keys:null},a.e.fromInt(a.eInt);else throw new Error("Invalid key generation algorithm: "+s);return a};Jt.rsa.stepKeyPairGenerationState=function(t,e){"algorithm"in t||(t.algorithm="PRIMEINC");var r=new qr(null);r.fromInt(30);for(var n=0,o=function(p,f){return p|f},s=+new Date,a,c=0;t.keys===null&&(e<=0||c<e);){if(t.state===0){var u=t.p===null?t.pBits:t.qBits,l=u-1;t.pqState===0?(t.num=new qr(u,t.rng),t.num.testBit(l)||t.num.bitwiseTo(qr.ONE.shiftLeft(l),o,t.num),t.num.dAddOffset(31-t.num.mod(r).byteValue(),0),n=0,++t.pqState):t.pqState===1?t.num.bitLength()>u?t.pqState=0:t.num.isProbablePrime(Cze(t.num.bitLength()))?++t.pqState:t.num.dAddOffset(gze[n++%8],0):t.pqState===2?t.pqState=t.num.subtract(qr.ONE).gcd(t.e).compareTo(qr.ONE)===0?3:0:t.pqState===3&&(t.pqState=0,t.p===null?t.p=t.num:t.q=t.num,t.p!==null&&t.q!==null&&++t.state,t.num=null)}else if(t.state===1)t.p.compareTo(t.q)<0&&(t.num=t.p,t.p=t.q,t.q=t.num),++t.state;else if(t.state===2)t.p1=t.p.subtract(qr.ONE),t.q1=t.q.subtract(qr.ONE),t.phi=t.p1.multiply(t.q1),++t.state;else if(t.state===3)t.phi.gcd(t.e).compareTo(qr.ONE)===0?++t.state:(t.p=null,t.q=null,t.state=0);else if(t.state===4)t.n=t.p.multiply(t.q),t.n.bitLength()===t.bits?++t.state:(t.q=null,t.state=0);else if(t.state===5){var d=t.e.modInverse(t.phi);t.keys={privateKey:Jt.rsa.setPrivateKey(t.n,t.e,d,t.p,t.q,d.mod(t.p1),d.mod(t.q1),t.q.modInverse(t.p)),publicKey:Jt.rsa.setPublicKey(t.n,t.e)}}a=+new Date,c+=a-s,s=a}return t.keys!==null};Jt.rsa.generateKeyPair=function(t,e,r,n){if(arguments.length===1?typeof t=="object"?(r=t,t=void 0):typeof t=="function"&&(n=t,t=void 0):arguments.length===2?typeof t=="number"?typeof e=="function"?(n=e,e=void 0):typeof e!="number"&&(r=e,e=void 0):(r=t,n=e,t=void 0,e=void 0):arguments.length===3&&(typeof e=="number"?typeof r=="function"&&(n=r,r=void 0):(n=r,r=e,e=void 0)),r=r||{},t===void 0&&(t=r.bits||2048),e===void 0&&(e=r.e||65537),!kt.options.usePureJavaScript&&!r.prng&&t>=256&&t<=16384&&(e===65537||e===3)){if(n){if(lge("generateKeyPair"))return DW.generateKeyPair("rsa",{modulusLength:t,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(c,u,l){if(c)return n(c);n(null,{privateKey:Jt.privateKeyFromPem(l),publicKey:Jt.publicKeyFromPem(u)})});if(dge("generateKey")&&dge("exportKey"))return Fu.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:fge(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(c){return Fu.globalScope.crypto.subtle.exportKey("pkcs8",c.privateKey)}).then(void 0,function(c){n(c)}).then(function(c){if(c){var u=Jt.privateKeyFromAsn1(se.fromDer(kt.util.createBuffer(c)));n(null,{privateKey:u,publicKey:Jt.setRsaPublicKey(u.n,u.e)})}});if(pge("generateKey")&&pge("exportKey")){var o=Fu.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:fge(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);o.oncomplete=function(c){var u=c.target.result,l=Fu.globalScope.msCrypto.subtle.exportKey("pkcs8",u.privateKey);l.oncomplete=function(d){var p=d.target.result,f=Jt.privateKeyFromAsn1(se.fromDer(kt.util.createBuffer(p)));n(null,{privateKey:f,publicKey:Jt.setRsaPublicKey(f.n,f.e)})},l.onerror=function(d){n(d)}},o.onerror=function(c){n(c)};return}}else if(lge("generateKeyPairSync")){var s=DW.generateKeyPairSync("rsa",{modulusLength:t,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:Jt.privateKeyFromPem(s.privateKey),publicKey:Jt.publicKeyFromPem(s.publicKey)}}}var a=Jt.rsa.createKeyPairGenerationState(t,e,r);if(!n)return Jt.rsa.stepKeyPairGenerationState(a,0),a.keys;Ize(a,r,n)};Jt.setRsaPublicKey=Jt.rsa.setPublicKey=function(t,e){var r={n:t,e};return r.encrypt=function(n,o,s){if(typeof o=="string"?o=o.toUpperCase():o===void 0&&(o="RSAES-PKCS1-V1_5"),o==="RSAES-PKCS1-V1_5")o={encode:function(c,u,l){return hge(c,u,2).getBytes()}};else if(o==="RSA-OAEP"||o==="RSAES-OAEP")o={encode:function(c,u){return kt.pkcs1.encode_rsa_oaep(u,c,s)}};else if(["RAW","NONE","NULL",null].indexOf(o)!==-1)o={encode:function(c){return c}};else if(typeof o=="string")throw new Error('Unsupported encryption scheme: "'+o+'".');var a=o.encode(n,r,!0);return Jt.rsa.encrypt(a,r,!0)},r.verify=function(n,o,s,a){typeof s=="string"?s=s.toUpperCase():s===void 0&&(s="RSASSA-PKCS1-V1_5"),a===void 0&&(a={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in a||(a._parseAllDigestBytes=!0),s==="RSASSA-PKCS1-V1_5"?s={verify:function(u,l){l=kM(l,r,!0);var d=se.fromDer(l,{parseAllBytes:a._parseAllDigestBytes}),p={},f=[];if(!se.validate(d,xze,p,f)){var m=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw m.errors=f,m}var h=se.derToOid(p.algorithmIdentifier);if(!(h===kt.oids.md2||h===kt.oids.md5||h===kt.oids.sha1||h===kt.oids.sha224||h===kt.oids.sha256||h===kt.oids.sha384||h===kt.oids.sha512||h===kt.oids["sha512-224"]||h===kt.oids["sha512-256"])){var m=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw m.oid=h,m}if((h===kt.oids.md2||h===kt.oids.md5)&&!("parameters"in p))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return u===p.digest}}:(s==="NONE"||s==="NULL"||s===null)&&(s={verify:function(u,l){return l=kM(l,r,!0),u===l}});var c=Jt.rsa.decrypt(o,r,!0,!1);return s.verify(n,c,r.n.bitLength())},r};Jt.setRsaPrivateKey=Jt.rsa.setPrivateKey=function(t,e,r,n,o,s,a,c){var u={n:t,e,d:r,p:n,q:o,dP:s,dQ:a,qInv:c};return u.decrypt=function(l,d,p){typeof d=="string"?d=d.toUpperCase():d===void 0&&(d="RSAES-PKCS1-V1_5");var f=Jt.rsa.decrypt(l,u,!1,!1);if(d==="RSAES-PKCS1-V1_5")d={decode:kM};else if(d==="RSA-OAEP"||d==="RSAES-OAEP")d={decode:function(m,h){return kt.pkcs1.decode_rsa_oaep(h,m,p)}};else if(["RAW","NONE","NULL",null].indexOf(d)!==-1)d={decode:function(m){return m}};else throw new Error('Unsupported encryption scheme: "'+d+'".');return d.decode(f,u,!1)},u.sign=function(l,d){var p=!1;typeof d=="string"&&(d=d.toUpperCase()),d===void 0||d==="RSASSA-PKCS1-V1_5"?(d={encode:Sze},p=1):(d==="NONE"||d==="NULL"||d===null)&&(d={encode:function(){return l}},p=1);var f=d.encode(l,u.n.bitLength());return Jt.rsa.encrypt(f,u,p)},u};Jt.wrapRsaPrivateKey=function(t){return se.create(se.Class.UNIVERSAL,se.Type.SEQUENCE,!0,[se.create(se.Class.UNIVERSAL,se.Type.INTEGER,!1,se.integerToDer(0).getBytes()),se.create(se.Class.UNIVERSAL,se.Type.SEQUENCE,!0,[se.create(se.Class.UNIVERSAL,se.Type.OID,!1,se.oidToDer(Jt.oids.rsaEncryption).getBytes()),se.create(se.Class.UNIVERSAL,se.Type.NULL,!1,"")]),se.create(se.Class.UNIVERSAL,se.Type.OCTETSTRING,!1,se.toDer(t).getBytes())])};Jt.privateKeyFromAsn1=function(t){var e={},r=[];if(se.validate(t,vze,e,r)&&(t=se.fromDer(kt.util.createBuffer(e.privateKey))),e={},r=[],!se.validate(t,bze,e,r)){var n=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw n.errors=r,n}var o,s,a,c,u,l,d,p;return o=kt.util.createBuffer(e.privateKeyModulus).toHex(),s=kt.util.createBuffer(e.privateKeyPublicExponent).toHex(),a=kt.util.createBuffer(e.privateKeyPrivateExponent).toHex(),c=kt.util.createBuffer(e.privateKeyPrime1).toHex(),u=kt.util.createBuffer(e.privateKeyPrime2).toHex(),l=kt.util.createBuffer(e.privateKeyExponent1).toHex(),d=kt.util.createBuffer(e.privateKeyExponent2).toHex(),p=kt.util.createBuffer(e.privateKeyCoefficient).toHex(),Jt.setRsaPrivateKey(new qr(o,16),new qr(s,16),new qr(a,16),new qr(c,16),new qr(u,16),new qr(l,16),new qr(d,16),new qr(p,16))};Jt.privateKeyToAsn1=Jt.privateKeyToRSAPrivateKey=function(t){return se.create(se.Class.UNIVERSAL,se.Type.SEQUENCE,!0,[se.create(se.Class.UNIVERSAL,se.Type.INTEGER,!1,se.integerToDer(0).getBytes()),se.create(se.Class.UNIVERSAL,se.Type.INTEGER,!1,bp(t.n)),se.create(se.Class.UNIVERSAL,se.Type.INTEGER,!1,bp(t.e)),se.create(se.Class.UNIVERSAL,se.Type.INTEGER,!1,bp(t.d)),se.create(se.Class.UNIVERSAL,se.Type.INTEGER,!1,bp(t.p)),se.create(se.Class.UNIVERSAL,se.Type.INTEGER,!1,bp(t.q)),se.create(se.Class.UNIVERSAL,se.Type.INTEGER,!1,bp(t.dP)),se.create(se.Class.UNIVERSAL,se.Type.INTEGER,!1,bp(t.dQ)),se.create(se.Class.UNIVERSAL,se.Type.INTEGER,!1,bp(t.qInv))])};Jt.publicKeyFromAsn1=function(t){var e={},r=[];if(se.validate(t,_ze,e,r)){var n=se.derToOid(e.publicKeyOid);if(n!==Jt.oids.rsaEncryption){var o=new Error("Cannot read public key. Unknown OID.");throw o.oid=n,o}t=e.rsaPublicKey}if(r=[],!se.validate(t,yze,e,r)){var o=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw o.errors=r,o}var s=kt.util.createBuffer(e.publicKeyModulus).toHex(),a=kt.util.createBuffer(e.publicKeyExponent).toHex();return Jt.setRsaPublicKey(new qr(s,16),new qr(a,16))};Jt.publicKeyToAsn1=Jt.publicKeyToSubjectPublicKeyInfo=function(t){return se.create(se.Class.UNIVERSAL,se.Type.SEQUENCE,!0,[se.create(se.Class.UNIVERSAL,se.Type.SEQUENCE,!0,[se.create(se.Class.UNIVERSAL,se.Type.OID,!1,se.oidToDer(Jt.oids.rsaEncryption).getBytes()),se.create(se.Class.UNIVERSAL,se.Type.NULL,!1,"")]),se.create(se.Class.UNIVERSAL,se.Type.BITSTRING,!1,[Jt.publicKeyToRSAPublicKey(t)])])};Jt.publicKeyToRSAPublicKey=function(t){return se.create(se.Class.UNIVERSAL,se.Type.SEQUENCE,!0,[se.create(se.Class.UNIVERSAL,se.Type.INTEGER,!1,bp(t.n)),se.create(se.Class.UNIVERSAL,se.Type.INTEGER,!1,bp(t.e))])};function hge(t,e,r){var n=kt.util.createBuffer(),o=Math.ceil(e.n.bitLength()/8);if(t.length>o-11){var s=new Error("Message is too long for PKCS#1 v1.5 padding.");throw s.length=t.length,s.max=o-11,s}n.putByte(0),n.putByte(r);var a=o-3-t.length,c;if(r===0||r===1){c=r===0?0:255;for(var u=0;u<a;++u)n.putByte(c)}else for(;a>0;){for(var l=0,d=kt.random.getBytes(a),u=0;u<a;++u)c=d.charCodeAt(u),c===0?++l:n.putByte(c);a=l}return n.putByte(0),n.putBytes(t),n}function kM(t,e,r,n){var o=Math.ceil(e.n.bitLength()/8),s=kt.util.createBuffer(t),a=s.getByte(),c=s.getByte();if(a!==0||r&&c!==0&&c!==1||!r&&c!=2||r&&c===0&&typeof n>"u")throw new Error("Encryption block is invalid.");var u=0;if(c===0){u=o-3-n;for(var l=0;l<u;++l)if(s.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(c===1)for(u=0;s.length()>1;){if(s.getByte()!==255){--s.read;break}++u}else if(c===2)for(u=0;s.length()>1;){if(s.getByte()===0){--s.read;break}++u}var d=s.getByte();if(d!==0||u!==o-3-s.length())throw new Error("Encryption block is invalid.");return s.getBytes()}function Ize(t,e,r){typeof e=="function"&&(r=e,e={}),e=e||{};var n={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(n.prng=e.prng),o();function o(){s(t.pBits,function(c,u){if(c)return r(c);if(t.p=u,t.q!==null)return a(c,t.q);s(t.qBits,a)})}function s(c,u){kt.prime.generateProbablePrime(c,n,u)}function a(c,u){if(c)return r(c);if(t.q=u,t.p.compareTo(t.q)<0){var l=t.p;t.p=t.q,t.q=l}if(t.p.subtract(qr.ONE).gcd(t.e).compareTo(qr.ONE)!==0){t.p=null,o();return}if(t.q.subtract(qr.ONE).gcd(t.e).compareTo(qr.ONE)!==0){t.q=null,s(t.qBits,a);return}if(t.p1=t.p.subtract(qr.ONE),t.q1=t.q.subtract(qr.ONE),t.phi=t.p1.multiply(t.q1),t.phi.gcd(t.e).compareTo(qr.ONE)!==0){t.p=t.q=null,o();return}if(t.n=t.p.multiply(t.q),t.n.bitLength()!==t.bits){t.q=null,s(t.qBits,a);return}var d=t.e.modInverse(t.phi);t.keys={privateKey:Jt.rsa.setPrivateKey(t.n,t.e,d,t.p,t.q,d.mod(t.p1),d.mod(t.q1),t.q.modInverse(t.p)),publicKey:Jt.rsa.setPublicKey(t.n,t.e)},r(null,t.keys)}}function bp(t){var e=t.toString(16);e[0]>="8"&&(e="00"+e);var r=kt.util.hexToBytes(e);return r.length>1&&(r.charCodeAt(0)===0&&!(r.charCodeAt(1)&128)||r.charCodeAt(0)===255&&(r.charCodeAt(1)&128)===128)?r.substr(1):r}function Cze(t){return t<=100?27:t<=150?18:t<=200?15:t<=250?12:t<=300?9:t<=350?8:t<=400?7:t<=500?6:t<=600?5:t<=800?4:t<=1250?3:2}function lge(t){return kt.util.isNodejs&&typeof DW[t]=="function"}function dge(t){return typeof Fu.globalScope<"u"&&typeof Fu.globalScope.crypto=="object"&&typeof Fu.globalScope.crypto.subtle=="object"&&typeof Fu.globalScope.crypto.subtle[t]=="function"}function pge(t){return typeof Fu.globalScope<"u"&&typeof Fu.globalScope.msCrypto=="object"&&typeof Fu.globalScope.msCrypto.subtle=="object"&&typeof Fu.globalScope.msCrypto.subtle[t]=="function"}function fge(t){for(var e=kt.util.hexToBytes(t.toString(16)),r=new Uint8Array(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}});var NW=O((uhr,xge)=>{var ut=cr();Nv();Ql();l2();dp();Lv();CM();My();Ou();CW();f2();$r();typeof vge>"u"&&(vge=ut.jsbn.BigInteger);var vge,ge=ut.asn1,sr=ut.pki=ut.pki||{};xge.exports=sr.pbe=ut.pbe=ut.pbe||{};var By=sr.oids,Tze={name:"EncryptedPrivateKeyInfo",tagClass:ge.Class.UNIVERSAL,type:ge.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:ge.Class.UNIVERSAL,type:ge.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:ge.Class.UNIVERSAL,type:ge.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:ge.Class.UNIVERSAL,type:ge.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:ge.Class.UNIVERSAL,type:ge.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},Eze={name:"PBES2Algorithms",tagClass:ge.Class.UNIVERSAL,type:ge.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:ge.Class.UNIVERSAL,type:ge.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:ge.Class.UNIVERSAL,type:ge.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:ge.Class.UNIVERSAL,type:ge.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:ge.Class.UNIVERSAL,type:ge.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:ge.Class.UNIVERSAL,type:ge.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:ge.Class.UNIVERSAL,type:ge.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:ge.Class.UNIVERSAL,type:ge.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:ge.Class.UNIVERSAL,type:ge.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:ge.Class.UNIVERSAL,type:ge.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:ge.Class.UNIVERSAL,type:ge.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:ge.Class.UNIVERSAL,type:ge.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},wze={name:"pkcs-12PbeParams",tagClass:ge.Class.UNIVERSAL,type:ge.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:ge.Class.UNIVERSAL,type:ge.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:ge.Class.UNIVERSAL,type:ge.Type.INTEGER,constructed:!1,capture:"iterations"}]};sr.encryptPrivateKeyInfo=function(t,e,r){r=r||{},r.saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||"aes128",r.prfAlgorithm=r.prfAlgorithm||"sha1";var n=ut.random.getBytesSync(r.saltSize),o=r.count,s=ge.integerToDer(o),a,c,u;if(r.algorithm.indexOf("aes")===0||r.algorithm==="des"){var l,d,p;switch(r.algorithm){case"aes128":a=16,l=16,d=By["aes128-CBC"],p=ut.aes.createEncryptionCipher;break;case"aes192":a=24,l=16,d=By["aes192-CBC"],p=ut.aes.createEncryptionCipher;break;case"aes256":a=32,l=16,d=By["aes256-CBC"],p=ut.aes.createEncryptionCipher;break;case"des":a=8,l=8,d=By.desCBC,p=ut.des.createEncryptionCipher;break;default:var f=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw f.algorithm=r.algorithm,f}var m="hmacWith"+r.prfAlgorithm.toUpperCase(),h=_ge(m),g=ut.pkcs5.pbkdf2(e,n,o,a,h),v=ut.random.getBytesSync(l),y=p(g);y.start(v),y.update(ge.toDer(t)),y.finish(),u=y.output.getBytes();var _=Rze(n,s,a,m);c=ge.create(ge.Class.UNIVERSAL,ge.Type.SEQUENCE,!0,[ge.create(ge.Class.UNIVERSAL,ge.Type.OID,!1,ge.oidToDer(By.pkcs5PBES2).getBytes()),ge.create(ge.Class.UNIVERSAL,ge.Type.SEQUENCE,!0,[ge.create(ge.Class.UNIVERSAL,ge.Type.SEQUENCE,!0,[ge.create(ge.Class.UNIVERSAL,ge.Type.OID,!1,ge.oidToDer(By.pkcs5PBKDF2).getBytes()),_]),ge.create(ge.Class.UNIVERSAL,ge.Type.SEQUENCE,!0,[ge.create(ge.Class.UNIVERSAL,ge.Type.OID,!1,ge.oidToDer(d).getBytes()),ge.create(ge.Class.UNIVERSAL,ge.Type.OCTETSTRING,!1,v)])])])}else if(r.algorithm==="3des"){a=24;var x=new ut.util.ByteBuffer(n),g=sr.pbe.generatePkcs12Key(e,x,1,o,a),v=sr.pbe.generatePkcs12Key(e,x,2,o,a),y=ut.des.createEncryptionCipher(g);y.start(v),y.update(ge.toDer(t)),y.finish(),u=y.output.getBytes(),c=ge.create(ge.Class.UNIVERSAL,ge.Type.SEQUENCE,!0,[ge.create(ge.Class.UNIVERSAL,ge.Type.OID,!1,ge.oidToDer(By["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),ge.create(ge.Class.UNIVERSAL,ge.Type.SEQUENCE,!0,[ge.create(ge.Class.UNIVERSAL,ge.Type.OCTETSTRING,!1,n),ge.create(ge.Class.UNIVERSAL,ge.Type.INTEGER,!1,s.getBytes())])])}else{var f=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw f.algorithm=r.algorithm,f}var S=ge.create(ge.Class.UNIVERSAL,ge.Type.SEQUENCE,!0,[c,ge.create(ge.Class.UNIVERSAL,ge.Type.OCTETSTRING,!1,u)]);return S};sr.decryptPrivateKeyInfo=function(t,e){var r=null,n={},o=[];if(!ge.validate(t,Tze,n,o)){var s=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=o,s}var a=ge.derToOid(n.encryptionOid),c=sr.pbe.getCipher(a,n.encryptionParams,e),u=ut.util.createBuffer(n.encryptedData);return c.update(u),c.finish()&&(r=ge.fromDer(c.output)),r};sr.encryptedPrivateKeyToPem=function(t,e){var r={type:"ENCRYPTED PRIVATE KEY",body:ge.toDer(t).getBytes()};return ut.pem.encode(r,{maxline:e})};sr.encryptedPrivateKeyFromPem=function(t){var e=ut.pem.decode(t)[0];if(e.type!=="ENCRYPTED PRIVATE KEY"){var r=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw r.headerType=e.type,r}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return ge.fromDer(e.body)};sr.encryptRsaPrivateKey=function(t,e,r){if(r=r||{},!r.legacy){var n=sr.wrapRsaPrivateKey(sr.privateKeyToAsn1(t));return n=sr.encryptPrivateKeyInfo(n,e,r),sr.encryptedPrivateKeyToPem(n)}var o,s,a,c;switch(r.algorithm){case"aes128":o="AES-128-CBC",a=16,s=ut.random.getBytesSync(16),c=ut.aes.createEncryptionCipher;break;case"aes192":o="AES-192-CBC",a=24,s=ut.random.getBytesSync(16),c=ut.aes.createEncryptionCipher;break;case"aes256":o="AES-256-CBC",a=32,s=ut.random.getBytesSync(16),c=ut.aes.createEncryptionCipher;break;case"3des":o="DES-EDE3-CBC",a=24,s=ut.random.getBytesSync(8),c=ut.des.createEncryptionCipher;break;case"des":o="DES-CBC",a=8,s=ut.random.getBytesSync(8),c=ut.des.createEncryptionCipher;break;default:var u=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+r.algorithm+'".');throw u.algorithm=r.algorithm,u}var l=ut.pbe.opensslDeriveBytes(e,s.substr(0,8),a),d=c(l);d.start(s),d.update(ge.toDer(sr.privateKeyToAsn1(t))),d.finish();var p={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:o,parameters:ut.util.bytesToHex(s).toUpperCase()},body:d.output.getBytes()};return ut.pem.encode(p)};sr.decryptRsaPrivateKey=function(t,e){var r=null,n=ut.pem.decode(t)[0];if(n.type!=="ENCRYPTED PRIVATE KEY"&&n.type!=="PRIVATE KEY"&&n.type!=="RSA PRIVATE KEY"){var o=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw o.headerType=o,o}if(n.procType&&n.procType.type==="ENCRYPTED"){var s,a;switch(n.dekInfo.algorithm){case"DES-CBC":s=8,a=ut.des.createDecryptionCipher;break;case"DES-EDE3-CBC":s=24,a=ut.des.createDecryptionCipher;break;case"AES-128-CBC":s=16,a=ut.aes.createDecryptionCipher;break;case"AES-192-CBC":s=24,a=ut.aes.createDecryptionCipher;break;case"AES-256-CBC":s=32,a=ut.aes.createDecryptionCipher;break;case"RC2-40-CBC":s=5,a=function(p){return ut.rc2.createDecryptionCipher(p,40)};break;case"RC2-64-CBC":s=8,a=function(p){return ut.rc2.createDecryptionCipher(p,64)};break;case"RC2-128-CBC":s=16,a=function(p){return ut.rc2.createDecryptionCipher(p,128)};break;default:var o=new Error('Could not decrypt private key; unsupported encryption algorithm "'+n.dekInfo.algorithm+'".');throw o.algorithm=n.dekInfo.algorithm,o}var c=ut.util.hexToBytes(n.dekInfo.parameters),u=ut.pbe.opensslDeriveBytes(e,c.substr(0,8),s),l=a(u);if(l.start(c),l.update(ut.util.createBuffer(n.body)),l.finish())r=l.output.getBytes();else return r}else r=n.body;return n.type==="ENCRYPTED PRIVATE KEY"?r=sr.decryptPrivateKeyInfo(ge.fromDer(r),e):r=ge.fromDer(r),r!==null&&(r=sr.privateKeyFromAsn1(r)),r};sr.pbe.generatePkcs12Key=function(t,e,r,n,o,s){var a,c;if(typeof s>"u"||s===null){if(!("sha1"in ut.md))throw new Error('"sha1" hash algorithm unavailable.');s=ut.md.sha1.create()}var u=s.digestLength,l=s.blockLength,d=new ut.util.ByteBuffer,p=new ut.util.ByteBuffer;if(t!=null){for(c=0;c<t.length;c++)p.putInt16(t.charCodeAt(c));p.putInt16(0)}var f=p.length(),m=e.length(),h=new ut.util.ByteBuffer;h.fillWithByte(r,l);var g=l*Math.ceil(m/l),v=new ut.util.ByteBuffer;for(c=0;c<g;c++)v.putByte(e.at(c%m));var y=l*Math.ceil(f/l),_=new ut.util.ByteBuffer;for(c=0;c<y;c++)_.putByte(p.at(c%f));var x=v;x.putBuffer(_);for(var S=Math.ceil(o/u),I=1;I<=S;I++){var E=new ut.util.ByteBuffer;E.putBytes(h.bytes()),E.putBytes(x.bytes());for(var R=0;R<n;R++)s.start(),s.update(E.getBytes()),E=s.digest();var B=new ut.util.ByteBuffer;for(c=0;c<l;c++)B.putByte(E.at(c%u));var V=Math.ceil(m/l)+Math.ceil(f/l),M=new ut.util.ByteBuffer;for(a=0;a<V;a++){var le=new ut.util.ByteBuffer(x.getBytes(l)),ne=511;for(c=B.length()-1;c>=0;c--)ne=ne>>8,ne+=B.at(c)+le.at(c),le.setAt(c,ne&255);M.putBuffer(le)}x=M,d.putBuffer(E)}return d.truncate(d.length()-o),d};sr.pbe.getCipher=function(t,e,r){switch(t){case sr.oids.pkcs5PBES2:return sr.pbe.getCipherForPBES2(t,e,r);case sr.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case sr.oids["pbewithSHAAnd40BitRC2-CBC"]:return sr.pbe.getCipherForPKCS12PBE(t,e,r);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=t,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}};sr.pbe.getCipherForPBES2=function(t,e,r){var n={},o=[];if(!ge.validate(e,Eze,n,o)){var s=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=o,s}if(t=ge.derToOid(n.kdfOid),t!==sr.oids.pkcs5PBKDF2){var s=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw s.oid=t,s.supportedOids=["pkcs5PBKDF2"],s}if(t=ge.derToOid(n.encOid),t!==sr.oids["aes128-CBC"]&&t!==sr.oids["aes192-CBC"]&&t!==sr.oids["aes256-CBC"]&&t!==sr.oids["des-EDE3-CBC"]&&t!==sr.oids.desCBC){var s=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw s.oid=t,s.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],s}var a=n.kdfSalt,c=ut.util.createBuffer(n.kdfIterationCount);c=c.getInt(c.length()<<3);var u,l;switch(sr.oids[t]){case"aes128-CBC":u=16,l=ut.aes.createDecryptionCipher;break;case"aes192-CBC":u=24,l=ut.aes.createDecryptionCipher;break;case"aes256-CBC":u=32,l=ut.aes.createDecryptionCipher;break;case"des-EDE3-CBC":u=24,l=ut.des.createDecryptionCipher;break;case"desCBC":u=8,l=ut.des.createDecryptionCipher;break}var d=yge(n.prfOid),p=ut.pkcs5.pbkdf2(r,a,c,u,d),f=n.encIv,m=l(p);return m.start(f),m};sr.pbe.getCipherForPKCS12PBE=function(t,e,r){var n={},o=[];if(!ge.validate(e,wze,n,o)){var s=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=o,s}var a=ut.util.createBuffer(n.salt),c=ut.util.createBuffer(n.iterations);c=c.getInt(c.length()<<3);var u,l,d;switch(t){case sr.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:u=24,l=8,d=ut.des.startDecrypting;break;case sr.oids["pbewithSHAAnd40BitRC2-CBC"]:u=5,l=8,d=function(g,v){var y=ut.rc2.createDecryptionCipher(g,40);return y.start(v,null),y};break;default:var s=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw s.oid=t,s}var p=yge(n.prfOid),f=sr.pbe.generatePkcs12Key(r,a,1,c,u,p);p.start();var m=sr.pbe.generatePkcs12Key(r,a,2,c,l,p);return d(f,m)};sr.pbe.opensslDeriveBytes=function(t,e,r,n){if(typeof n>"u"||n===null){if(!("md5"in ut.md))throw new Error('"md5" hash algorithm unavailable.');n=ut.md.md5.create()}e===null&&(e="");for(var o=[bge(n,t+e)],s=16,a=1;s<r;++a,s+=16)o.push(bge(n,o[a-1]+t+e));return o.join("").substr(0,r)};function bge(t,e){return t.start().update(e).digest().getBytes()}function yge(t){var e;if(!t)e="hmacWithSHA1";else if(e=sr.oids[ge.derToOid(t)],!e){var r=new Error("Unsupported PRF OID.");throw r.oid=t,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}return _ge(e)}function _ge(t){var e=ut.md;switch(t){case"hmacWithSHA224":e=ut.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":t=t.substr(8).toLowerCase();break;default:var r=new Error("Unsupported PRF algorithm.");throw r.algorithm=t,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}if(!e||!(t in e))throw new Error("Unknown hash algorithm: "+t);return e[t].create()}function Rze(t,e,r,n){var o=ge.create(ge.Class.UNIVERSAL,ge.Type.SEQUENCE,!0,[ge.create(ge.Class.UNIVERSAL,ge.Type.OCTETSTRING,!1,t),ge.create(ge.Class.UNIVERSAL,ge.Type.INTEGER,!1,e.getBytes())]);return n!=="hmacWithSHA1"&&o.value.push(ge.create(ge.Class.UNIVERSAL,ge.Type.INTEGER,!1,ut.util.hexToBytes(r.toString(16))),ge.create(ge.Class.UNIVERSAL,ge.Type.SEQUENCE,!0,[ge.create(ge.Class.UNIVERSAL,ge.Type.OID,!1,ge.oidToDer(sr.oids[n]).getBytes()),ge.create(ge.Class.UNIVERSAL,ge.Type.NULL,!1,"")])),o}});var LW=O((lhr,Cge)=>{var wC=cr();Ql();$r();var it=wC.asn1,RC=Cge.exports=wC.pkcs7asn1=wC.pkcs7asn1||{};wC.pkcs7=wC.pkcs7||{};wC.pkcs7.asn1=RC;var Sge={name:"ContentInfo",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:it.Class.UNIVERSAL,type:it.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:it.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};RC.contentInfoValidator=Sge;var Ige={name:"EncryptedContentInfo",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:it.Class.UNIVERSAL,type:it.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:it.Class.UNIVERSAL,type:it.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:it.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:it.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};RC.envelopedDataValidator={name:"EnvelopedData",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:it.Class.UNIVERSAL,type:it.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:it.Class.UNIVERSAL,type:it.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(Ige)};RC.encryptedDataValidator={name:"EncryptedData",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:it.Class.UNIVERSAL,type:it.Type.INTEGER,constructed:!1,capture:"version"}].concat(Ige)};var kze={name:"SignerInfo",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:it.Class.UNIVERSAL,type:it.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:it.Class.UNIVERSAL,type:it.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:it.Class.UNIVERSAL,type:it.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:it.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:it.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:it.Class.UNIVERSAL,type:it.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:it.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};RC.signedDataValidator={name:"SignedData",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:it.Class.UNIVERSAL,type:it.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:it.Class.UNIVERSAL,type:it.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},Sge,{name:"SignedData.Certificates",tagClass:it.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:it.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:it.Class.UNIVERSAL,type:it.Type.SET,capture:"signerInfos",optional:!0,value:[kze]}]};RC.recipientInfoValidator={name:"RecipientInfo",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:it.Class.UNIVERSAL,type:it.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:it.Class.UNIVERSAL,type:it.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:it.Class.UNIVERSAL,type:it.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:it.Class.UNIVERSAL,type:it.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:it.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:it.Class.UNIVERSAL,type:it.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}});var OW=O((dhr,Tge)=>{var qy=cr();$r();qy.mgf=qy.mgf||{};var Pze=Tge.exports=qy.mgf.mgf1=qy.mgf1=qy.mgf1||{};Pze.create=function(t){var e={generate:function(r,n){for(var o=new qy.util.ByteBuffer,s=Math.ceil(n/t.digestLength),a=0;a<s;a++){var c=new qy.util.ByteBuffer;c.putInt32(a),t.start(),t.update(r+c.getBytes()),o.putBuffer(t.digest())}return o.truncate(o.length()-n),o.getBytes()}};return e}});var wge=O((phr,Ege)=>{var PM=cr();OW();Ege.exports=PM.mgf=PM.mgf||{};PM.mgf.mgf1=PM.mgf1});var AM=O((fhr,Rge)=>{var jy=cr();Ou();$r();var Aze=Rge.exports=jy.pss=jy.pss||{};Aze.create=function(t){arguments.length===3&&(t={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var e=t.md,r=t.mgf,n=e.digestLength,o=t.salt||null;typeof o=="string"&&(o=jy.util.createBuffer(o));var s;if("saltLength"in t)s=t.saltLength;else if(o!==null)s=o.length();else throw new Error("Salt length not specified or specific salt not given.");if(o!==null&&o.length()!==s)throw new Error("Given salt length does not match length of given salt.");var a=t.prng||jy.random,c={};return c.encode=function(u,l){var d,p=l-1,f=Math.ceil(p/8),m=u.digest().getBytes();if(f<n+s+2)throw new Error("Message is too long to encrypt.");var h;o===null?h=a.getBytesSync(s):h=o.bytes();var g=new jy.util.ByteBuffer;g.fillWithByte(0,8),g.putBytes(m),g.putBytes(h),e.start(),e.update(g.getBytes());var v=e.digest().getBytes(),y=new jy.util.ByteBuffer;y.fillWithByte(0,f-s-n-2),y.putByte(1),y.putBytes(h);var _=y.getBytes(),x=f-n-1,S=r.generate(v,x),I="";for(d=0;d<x;d++)I+=String.fromCharCode(_.charCodeAt(d)^S.charCodeAt(d));var E=65280>>8*f-p&255;return I=String.fromCharCode(I.charCodeAt(0)&~E)+I.substr(1),I+v+"\xBC"},c.verify=function(u,l,d){var p,f=d-1,m=Math.ceil(f/8);if(l=l.substr(-m),m<n+s+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(l.charCodeAt(m-1)!==188)throw new Error("Encoded message does not end in 0xBC.");var h=m-n-1,g=l.substr(0,h),v=l.substr(h,n),y=65280>>8*m-f&255;if(g.charCodeAt(0)&y)throw new Error("Bits beyond keysize not zero as expected.");var _=r.generate(v,h),x="";for(p=0;p<h;p++)x+=String.fromCharCode(g.charCodeAt(p)^_.charCodeAt(p));x=String.fromCharCode(x.charCodeAt(0)&~y)+x.substr(1);var S=m-n-s-2;for(p=0;p<S;p++)if(x.charCodeAt(p)!==0)throw new Error("Leftmost octets not zero as expected");if(x.charCodeAt(S)!==1)throw new Error("Inconsistent PSS signature, 0x01 marker not found");var I=x.substr(-s),E=new jy.util.ByteBuffer;E.fillWithByte(0,8),E.putBytes(u),E.putBytes(I),e.start(),e.update(E.getBytes());var R=e.digest().getBytes();return v===R},c}});var LM=O((mhr,Nge)=>{var Pt=cr();Nv();Ql();l2();dp();wge();Lv();My();AM();f2();$r();var D=Pt.asn1,Ge=Nge.exports=Pt.pki=Pt.pki||{},jr=Ge.oids,Di={};Di.CN=jr.commonName;Di.commonName="CN";Di.C=jr.countryName;Di.countryName="C";Di.L=jr.localityName;Di.localityName="L";Di.ST=jr.stateOrProvinceName;Di.stateOrProvinceName="ST";Di.O=jr.organizationName;Di.organizationName="O";Di.OU=jr.organizationalUnitName;Di.organizationalUnitName="OU";Di.E=jr.emailAddress;Di.emailAddress="E";var Pge=Pt.pki.rsa.publicKeyValidator,Dze={name:"Certificate",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:D.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:D.Class.UNIVERSAL,type:D.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:D.Class.UNIVERSAL,type:D.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:D.Class.UNIVERSAL,type:D.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:D.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:D.Class.UNIVERSAL,type:D.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:D.Class.UNIVERSAL,type:D.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:D.Class.UNIVERSAL,type:D.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:D.Class.UNIVERSAL,type:D.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},Pge,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:D.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:D.Class.UNIVERSAL,type:D.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:D.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:D.Class.UNIVERSAL,type:D.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:D.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:D.Class.UNIVERSAL,type:D.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:D.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:D.Class.UNIVERSAL,type:D.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},Nze={name:"rsapss",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:D.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:D.Class.UNIVERSAL,type:D.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:D.Class.UNIVERSAL,type:D.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:D.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:D.Class.UNIVERSAL,type:D.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:D.Class.UNIVERSAL,type:D.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:D.Class.UNIVERSAL,type:D.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:D.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:D.Class.UNIVERSAL,type:D.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:D.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:D.Class.UNIVERSAL,type:D.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},Lze={name:"CertificationRequestInfo",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:D.Class.UNIVERSAL,type:D.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},Pge,{name:"CertificationRequestInfo.attributes",tagClass:D.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:D.Class.UNIVERSAL,type:D.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:D.Class.UNIVERSAL,type:D.Type.SET,constructed:!0}]}]}]},Oze={name:"CertificationRequest",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[Lze,{name:"CertificationRequest.signatureAlgorithm",tagClass:D.Class.UNIVERSAL,type:D.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:D.Class.UNIVERSAL,type:D.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:D.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:D.Class.UNIVERSAL,type:D.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};Ge.RDNAttributesAsArray=function(t,e){for(var r=[],n,o,s,a=0;a<t.value.length;++a){n=t.value[a];for(var c=0;c<n.value.length;++c)s={},o=n.value[c],s.type=D.derToOid(o.value[0].value),s.value=o.value[1].value,s.valueTagClass=o.value[1].type,s.type in jr&&(s.name=jr[s.type],s.name in Di&&(s.shortName=Di[s.name])),e&&(e.update(s.type),e.update(s.value)),r.push(s)}return r};Ge.CRIAttributesAsArray=function(t){for(var e=[],r=0;r<t.length;++r)for(var n=t[r],o=D.derToOid(n.value[0].value),s=n.value[1].value,a=0;a<s.length;++a){var c={};if(c.type=o,c.value=s[a].value,c.valueTagClass=s[a].type,c.type in jr&&(c.name=jr[c.type],c.name in Di&&(c.shortName=Di[c.name])),c.type===jr.extensionRequest){c.extensions=[];for(var u=0;u<c.value.length;++u)c.extensions.push(Ge.certificateExtensionFromAsn1(c.value[u]))}e.push(c)}return e};function Fv(t,e){typeof e=="string"&&(e={shortName:e});for(var r=null,n,o=0;r===null&&o<t.attributes.length;++o)n=t.attributes[o],(e.type&&e.type===n.type||e.name&&e.name===n.name||e.shortName&&e.shortName===n.shortName)&&(r=n);return r}var DM=function(t,e,r){var n={};if(t!==jr["RSASSA-PSS"])return n;r&&(n={hash:{algorithmOid:jr.sha1},mgf:{algorithmOid:jr.mgf1,hash:{algorithmOid:jr.sha1}},saltLength:20});var o={},s=[];if(!D.validate(e,Nze,o,s)){var a=new Error("Cannot read RSASSA-PSS parameter block.");throw a.errors=s,a}return o.hashOid!==void 0&&(n.hash=n.hash||{},n.hash.algorithmOid=D.derToOid(o.hashOid)),o.maskGenOid!==void 0&&(n.mgf=n.mgf||{},n.mgf.algorithmOid=D.derToOid(o.maskGenOid),n.mgf.hash=n.mgf.hash||{},n.mgf.hash.algorithmOid=D.derToOid(o.maskGenHashOid)),o.saltLength!==void 0&&(n.saltLength=o.saltLength.charCodeAt(0)),n},NM=function(t){switch(jr[t.signatureOid]){case"sha1WithRSAEncryption":case"sha1WithRSASignature":return Pt.md.sha1.create();case"md5WithRSAEncryption":return Pt.md.md5.create();case"sha256WithRSAEncryption":return Pt.md.sha256.create();case"sha384WithRSAEncryption":return Pt.md.sha384.create();case"sha512WithRSAEncryption":return Pt.md.sha512.create();case"RSASSA-PSS":return Pt.md.sha256.create();default:var e=new Error("Could not compute "+t.type+" digest. Unknown signature OID.");throw e.signatureOid=t.signatureOid,e}},Age=function(t){var e=t.certificate,r;switch(e.signatureOid){case jr.sha1WithRSAEncryption:case jr.sha1WithRSASignature:break;case jr["RSASSA-PSS"]:var n,o;if(n=jr[e.signatureParameters.mgf.hash.algorithmOid],n===void 0||Pt.md[n]===void 0){var s=new Error("Unsupported MGF hash function.");throw s.oid=e.signatureParameters.mgf.hash.algorithmOid,s.name=n,s}if(o=jr[e.signatureParameters.mgf.algorithmOid],o===void 0||Pt.mgf[o]===void 0){var s=new Error("Unsupported MGF function.");throw s.oid=e.signatureParameters.mgf.algorithmOid,s.name=o,s}if(o=Pt.mgf[o].create(Pt.md[n].create()),n=jr[e.signatureParameters.hash.algorithmOid],n===void 0||Pt.md[n]===void 0){var s=new Error("Unsupported RSASSA-PSS hash function.");throw s.oid=e.signatureParameters.hash.algorithmOid,s.name=n,s}r=Pt.pss.create(Pt.md[n].create(),o,e.signatureParameters.saltLength);break}return e.publicKey.verify(t.md.digest().getBytes(),t.signature,r)};Ge.certificateFromPem=function(t,e,r){var n=Pt.pem.decode(t)[0];if(n.type!=="CERTIFICATE"&&n.type!=="X509 CERTIFICATE"&&n.type!=="TRUSTED CERTIFICATE"){var o=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw o.headerType=n.type,o}if(n.procType&&n.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var s=D.fromDer(n.body,r);return Ge.certificateFromAsn1(s,e)};Ge.certificateToPem=function(t,e){var r={type:"CERTIFICATE",body:D.toDer(Ge.certificateToAsn1(t)).getBytes()};return Pt.pem.encode(r,{maxline:e})};Ge.publicKeyFromPem=function(t){var e=Pt.pem.decode(t)[0];if(e.type!=="PUBLIC KEY"&&e.type!=="RSA PUBLIC KEY"){var r=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw r.headerType=e.type,r}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert public key from PEM; PEM is encrypted.");var n=D.fromDer(e.body);return Ge.publicKeyFromAsn1(n)};Ge.publicKeyToPem=function(t,e){var r={type:"PUBLIC KEY",body:D.toDer(Ge.publicKeyToAsn1(t)).getBytes()};return Pt.pem.encode(r,{maxline:e})};Ge.publicKeyToRSAPublicKeyPem=function(t,e){var r={type:"RSA PUBLIC KEY",body:D.toDer(Ge.publicKeyToRSAPublicKey(t)).getBytes()};return Pt.pem.encode(r,{maxline:e})};Ge.getPublicKeyFingerprint=function(t,e){e=e||{};var r=e.md||Pt.md.sha1.create(),n=e.type||"RSAPublicKey",o;switch(n){case"RSAPublicKey":o=D.toDer(Ge.publicKeyToRSAPublicKey(t)).getBytes();break;case"SubjectPublicKeyInfo":o=D.toDer(Ge.publicKeyToAsn1(t)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+e.type+'".')}r.start(),r.update(o);var s=r.digest();if(e.encoding==="hex"){var a=s.toHex();return e.delimiter?a.match(/.{2}/g).join(e.delimiter):a}else{if(e.encoding==="binary")return s.getBytes();if(e.encoding)throw new Error('Unknown encoding "'+e.encoding+'".')}return s};Ge.certificationRequestFromPem=function(t,e,r){var n=Pt.pem.decode(t)[0];if(n.type!=="CERTIFICATE REQUEST"){var o=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw o.headerType=n.type,o}if(n.procType&&n.procType.type==="ENCRYPTED")throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var s=D.fromDer(n.body,r);return Ge.certificationRequestFromAsn1(s,e)};Ge.certificationRequestToPem=function(t,e){var r={type:"CERTIFICATE REQUEST",body:D.toDer(Ge.certificationRequestToAsn1(t)).getBytes()};return Pt.pem.encode(r,{maxline:e})};Ge.createCertificate=function(){var t={};return t.version=2,t.serialNumber="00",t.signatureOid=null,t.signature=null,t.siginfo={},t.siginfo.algorithmOid=null,t.validity={},t.validity.notBefore=new Date,t.validity.notAfter=new Date,t.issuer={},t.issuer.getField=function(e){return Fv(t.issuer,e)},t.issuer.addField=function(e){Uu([e]),t.issuer.attributes.push(e)},t.issuer.attributes=[],t.issuer.hash=null,t.subject={},t.subject.getField=function(e){return Fv(t.subject,e)},t.subject.addField=function(e){Uu([e]),t.subject.attributes.push(e)},t.subject.attributes=[],t.subject.hash=null,t.extensions=[],t.publicKey=null,t.md=null,t.setSubject=function(e,r){Uu(e),t.subject.attributes=e,delete t.subject.uniqueId,r&&(t.subject.uniqueId=r),t.subject.hash=null},t.setIssuer=function(e,r){Uu(e),t.issuer.attributes=e,delete t.issuer.uniqueId,r&&(t.issuer.uniqueId=r),t.issuer.hash=null},t.setExtensions=function(e){for(var r=0;r<e.length;++r)Dge(e[r],{cert:t});t.extensions=e},t.getExtension=function(e){typeof e=="string"&&(e={name:e});for(var r=null,n,o=0;r===null&&o<t.extensions.length;++o)n=t.extensions[o],(e.id&&n.id===e.id||e.name&&n.name===e.name)&&(r=n);return r},t.sign=function(e,r){t.md=r||Pt.md.sha1.create();var n=jr[t.md.algorithm+"WithRSAEncryption"];if(!n){var o=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw o.algorithm=t.md.algorithm,o}t.signatureOid=t.siginfo.algorithmOid=n,t.tbsCertificate=Ge.getTBSCertificate(t);var s=D.toDer(t.tbsCertificate);t.md.update(s.getBytes()),t.signature=e.sign(t.md)},t.verify=function(e){var r=!1;if(!t.issued(e)){var n=e.issuer,o=t.subject,s=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw s.expectedIssuer=o.attributes,s.actualIssuer=n.attributes,s}var a=e.md;if(a===null){a=NM({signatureOid:e.signatureOid,type:"certificate"});var c=e.tbsCertificate||Ge.getTBSCertificate(e),u=D.toDer(c);a.update(u.getBytes())}return a!==null&&(r=Age({certificate:t,md:a,signature:e.signature})),r},t.isIssuer=function(e){var r=!1,n=t.issuer,o=e.subject;if(n.hash&&o.hash)r=n.hash===o.hash;else if(n.attributes.length===o.attributes.length){r=!0;for(var s,a,c=0;r&&c<n.attributes.length;++c)s=n.attributes[c],a=o.attributes[c],(s.type!==a.type||s.value!==a.value)&&(r=!1)}return r},t.issued=function(e){return e.isIssuer(t)},t.generateSubjectKeyIdentifier=function(){return Ge.getPublicKeyFingerprint(t.publicKey,{type:"RSAPublicKey"})},t.verifySubjectKeyIdentifier=function(){for(var e=jr.subjectKeyIdentifier,r=0;r<t.extensions.length;++r){var n=t.extensions[r];if(n.id===e){var o=t.generateSubjectKeyIdentifier().getBytes();return Pt.util.hexToBytes(n.subjectKeyIdentifier)===o}}return!1},t};Ge.certificateFromAsn1=function(t,e){var r={},n=[];if(!D.validate(t,Dze,r,n)){var o=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw o.errors=n,o}var s=D.derToOid(r.publicKeyOid);if(s!==Ge.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var a=Ge.createCertificate();a.version=r.certVersion?r.certVersion.charCodeAt(0):0;var c=Pt.util.createBuffer(r.certSerialNumber);a.serialNumber=c.toHex(),a.signatureOid=Pt.asn1.derToOid(r.certSignatureOid),a.signatureParameters=DM(a.signatureOid,r.certSignatureParams,!0),a.siginfo.algorithmOid=Pt.asn1.derToOid(r.certinfoSignatureOid),a.siginfo.parameters=DM(a.siginfo.algorithmOid,r.certinfoSignatureParams,!1),a.signature=r.certSignature;var u=[];if(r.certValidity1UTCTime!==void 0&&u.push(D.utcTimeToDate(r.certValidity1UTCTime)),r.certValidity2GeneralizedTime!==void 0&&u.push(D.generalizedTimeToDate(r.certValidity2GeneralizedTime)),r.certValidity3UTCTime!==void 0&&u.push(D.utcTimeToDate(r.certValidity3UTCTime)),r.certValidity4GeneralizedTime!==void 0&&u.push(D.generalizedTimeToDate(r.certValidity4GeneralizedTime)),u.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(u.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(a.validity.notBefore=u[0],a.validity.notAfter=u[1],a.tbsCertificate=r.tbsCertificate,e){a.md=NM({signatureOid:a.signatureOid,type:"certificate"});var l=D.toDer(a.tbsCertificate);a.md.update(l.getBytes())}var d=Pt.md.sha1.create(),p=D.toDer(r.certIssuer);d.update(p.getBytes()),a.issuer.getField=function(h){return Fv(a.issuer,h)},a.issuer.addField=function(h){Uu([h]),a.issuer.attributes.push(h)},a.issuer.attributes=Ge.RDNAttributesAsArray(r.certIssuer),r.certIssuerUniqueId&&(a.issuer.uniqueId=r.certIssuerUniqueId),a.issuer.hash=d.digest().toHex();var f=Pt.md.sha1.create(),m=D.toDer(r.certSubject);return f.update(m.getBytes()),a.subject.getField=function(h){return Fv(a.subject,h)},a.subject.addField=function(h){Uu([h]),a.subject.attributes.push(h)},a.subject.attributes=Ge.RDNAttributesAsArray(r.certSubject),r.certSubjectUniqueId&&(a.subject.uniqueId=r.certSubjectUniqueId),a.subject.hash=f.digest().toHex(),r.certExtensions?a.extensions=Ge.certificateExtensionsFromAsn1(r.certExtensions):a.extensions=[],a.publicKey=Ge.publicKeyFromAsn1(r.subjectPublicKeyInfo),a};Ge.certificateExtensionsFromAsn1=function(t){for(var e=[],r=0;r<t.value.length;++r)for(var n=t.value[r],o=0;o<n.value.length;++o)e.push(Ge.certificateExtensionFromAsn1(n.value[o]));return e};Ge.certificateExtensionFromAsn1=function(t){var e={};if(e.id=D.derToOid(t.value[0].value),e.critical=!1,t.value[1].type===D.Type.BOOLEAN?(e.critical=t.value[1].value.charCodeAt(0)!==0,e.value=t.value[2].value):e.value=t.value[1].value,e.id in jr){if(e.name=jr[e.id],e.name==="keyUsage"){var r=D.fromDer(e.value),n=0,o=0;r.value.length>1&&(n=r.value.charCodeAt(1),o=r.value.length>2?r.value.charCodeAt(2):0),e.digitalSignature=(n&128)===128,e.nonRepudiation=(n&64)===64,e.keyEncipherment=(n&32)===32,e.dataEncipherment=(n&16)===16,e.keyAgreement=(n&8)===8,e.keyCertSign=(n&4)===4,e.cRLSign=(n&2)===2,e.encipherOnly=(n&1)===1,e.decipherOnly=(o&128)===128}else if(e.name==="basicConstraints"){var r=D.fromDer(e.value);r.value.length>0&&r.value[0].type===D.Type.BOOLEAN?e.cA=r.value[0].value.charCodeAt(0)!==0:e.cA=!1;var s=null;r.value.length>0&&r.value[0].type===D.Type.INTEGER?s=r.value[0].value:r.value.length>1&&(s=r.value[1].value),s!==null&&(e.pathLenConstraint=D.derToInteger(s))}else if(e.name==="extKeyUsage")for(var r=D.fromDer(e.value),a=0;a<r.value.length;++a){var c=D.derToOid(r.value[a].value);c in jr?e[jr[c]]=!0:e[c]=!0}else if(e.name==="nsCertType"){var r=D.fromDer(e.value),n=0;r.value.length>1&&(n=r.value.charCodeAt(1)),e.client=(n&128)===128,e.server=(n&64)===64,e.email=(n&32)===32,e.objsign=(n&16)===16,e.reserved=(n&8)===8,e.sslCA=(n&4)===4,e.emailCA=(n&2)===2,e.objCA=(n&1)===1}else if(e.name==="subjectAltName"||e.name==="issuerAltName"){e.altNames=[];for(var u,r=D.fromDer(e.value),l=0;l<r.value.length;++l){u=r.value[l];var d={type:u.type,value:u.value};switch(e.altNames.push(d),u.type){case 1:case 2:case 6:break;case 7:d.ip=Pt.util.bytesToIP(u.value);break;case 8:d.oid=D.derToOid(u.value);break;default:}}}else if(e.name==="subjectKeyIdentifier"){var r=D.fromDer(e.value);e.subjectKeyIdentifier=Pt.util.bytesToHex(r.value)}}return e};Ge.certificationRequestFromAsn1=function(t,e){var r={},n=[];if(!D.validate(t,Oze,r,n)){var o=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw o.errors=n,o}var s=D.derToOid(r.publicKeyOid);if(s!==Ge.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var a=Ge.createCertificationRequest();if(a.version=r.csrVersion?r.csrVersion.charCodeAt(0):0,a.signatureOid=Pt.asn1.derToOid(r.csrSignatureOid),a.signatureParameters=DM(a.signatureOid,r.csrSignatureParams,!0),a.siginfo.algorithmOid=Pt.asn1.derToOid(r.csrSignatureOid),a.siginfo.parameters=DM(a.siginfo.algorithmOid,r.csrSignatureParams,!1),a.signature=r.csrSignature,a.certificationRequestInfo=r.certificationRequestInfo,e){a.md=NM({signatureOid:a.signatureOid,type:"certification request"});var c=D.toDer(a.certificationRequestInfo);a.md.update(c.getBytes())}var u=Pt.md.sha1.create();return a.subject.getField=function(l){return Fv(a.subject,l)},a.subject.addField=function(l){Uu([l]),a.subject.attributes.push(l)},a.subject.attributes=Ge.RDNAttributesAsArray(r.certificationRequestInfoSubject,u),a.subject.hash=u.digest().toHex(),a.publicKey=Ge.publicKeyFromAsn1(r.subjectPublicKeyInfo),a.getAttribute=function(l){return Fv(a,l)},a.addAttribute=function(l){Uu([l]),a.attributes.push(l)},a.attributes=Ge.CRIAttributesAsArray(r.certificationRequestInfoAttributes||[]),a};Ge.createCertificationRequest=function(){var t={};return t.version=0,t.signatureOid=null,t.signature=null,t.siginfo={},t.siginfo.algorithmOid=null,t.subject={},t.subject.getField=function(e){return Fv(t.subject,e)},t.subject.addField=function(e){Uu([e]),t.subject.attributes.push(e)},t.subject.attributes=[],t.subject.hash=null,t.publicKey=null,t.attributes=[],t.getAttribute=function(e){return Fv(t,e)},t.addAttribute=function(e){Uu([e]),t.attributes.push(e)},t.md=null,t.setSubject=function(e){Uu(e),t.subject.attributes=e,t.subject.hash=null},t.setAttributes=function(e){Uu(e),t.attributes=e},t.sign=function(e,r){t.md=r||Pt.md.sha1.create();var n=jr[t.md.algorithm+"WithRSAEncryption"];if(!n){var o=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw o.algorithm=t.md.algorithm,o}t.signatureOid=t.siginfo.algorithmOid=n,t.certificationRequestInfo=Ge.getCertificationRequestInfo(t);var s=D.toDer(t.certificationRequestInfo);t.md.update(s.getBytes()),t.signature=e.sign(t.md)},t.verify=function(){var e=!1,r=t.md;if(r===null){r=NM({signatureOid:t.signatureOid,type:"certification request"});var n=t.certificationRequestInfo||Ge.getCertificationRequestInfo(t),o=D.toDer(n);r.update(o.getBytes())}return r!==null&&(e=Age({certificate:t,md:r,signature:t.signature})),e},t};function kC(t){for(var e=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[]),r,n,o=t.attributes,s=0;s<o.length;++s){r=o[s];var a=r.value,c=D.Type.PRINTABLESTRING;"valueTagClass"in r&&(c=r.valueTagClass,c===D.Type.UTF8&&(a=Pt.util.encodeUtf8(a))),n=D.create(D.Class.UNIVERSAL,D.Type.SET,!0,[D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(r.type).getBytes()),D.create(D.Class.UNIVERSAL,c,!1,a)])]),e.value.push(n)}return e}function Uu(t){for(var e,r=0;r<t.length;++r){if(e=t[r],typeof e.name>"u"&&(e.type&&e.type in Ge.oids?e.name=Ge.oids[e.type]:e.shortName&&e.shortName in Di&&(e.name=Ge.oids[Di[e.shortName]])),typeof e.type>"u")if(e.name&&e.name in Ge.oids)e.type=Ge.oids[e.name];else{var n=new Error("Attribute type not specified.");throw n.attribute=e,n}if(typeof e.shortName>"u"&&e.name&&e.name in Di&&(e.shortName=Di[e.name]),e.type===jr.extensionRequest&&(e.valueConstructed=!0,e.valueTagClass=D.Type.SEQUENCE,!e.value&&e.extensions)){e.value=[];for(var o=0;o<e.extensions.length;++o)e.value.push(Ge.certificateExtensionToAsn1(Dge(e.extensions[o])))}if(typeof e.value>"u"){var n=new Error("Attribute value not specified.");throw n.attribute=e,n}}}function Dge(t,e){if(e=e||{},typeof t.name>"u"&&t.id&&t.id in Ge.oids&&(t.name=Ge.oids[t.id]),typeof t.id>"u")if(t.name&&t.name in Ge.oids)t.id=Ge.oids[t.name];else{var r=new Error("Extension ID not specified.");throw r.extension=t,r}if(typeof t.value<"u")return t;if(t.name==="keyUsage"){var n=0,o=0,s=0;t.digitalSignature&&(o|=128,n=7),t.nonRepudiation&&(o|=64,n=6),t.keyEncipherment&&(o|=32,n=5),t.dataEncipherment&&(o|=16,n=4),t.keyAgreement&&(o|=8,n=3),t.keyCertSign&&(o|=4,n=2),t.cRLSign&&(o|=2,n=1),t.encipherOnly&&(o|=1,n=0),t.decipherOnly&&(s|=128,n=7);var a=String.fromCharCode(n);s!==0?a+=String.fromCharCode(o)+String.fromCharCode(s):o!==0&&(a+=String.fromCharCode(o)),t.value=D.create(D.Class.UNIVERSAL,D.Type.BITSTRING,!1,a)}else if(t.name==="basicConstraints")t.value=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[]),t.cA&&t.value.value.push(D.create(D.Class.UNIVERSAL,D.Type.BOOLEAN,!1,"\xFF")),"pathLenConstraint"in t&&t.value.value.push(D.create(D.Class.UNIVERSAL,D.Type.INTEGER,!1,D.integerToDer(t.pathLenConstraint).getBytes()));else if(t.name==="extKeyUsage"){t.value=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[]);var c=t.value.value;for(var u in t)t[u]===!0&&(u in jr?c.push(D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(jr[u]).getBytes())):u.indexOf(".")!==-1&&c.push(D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(u).getBytes())))}else if(t.name==="nsCertType"){var n=0,o=0;t.client&&(o|=128,n=7),t.server&&(o|=64,n=6),t.email&&(o|=32,n=5),t.objsign&&(o|=16,n=4),t.reserved&&(o|=8,n=3),t.sslCA&&(o|=4,n=2),t.emailCA&&(o|=2,n=1),t.objCA&&(o|=1,n=0);var a=String.fromCharCode(n);o!==0&&(a+=String.fromCharCode(o)),t.value=D.create(D.Class.UNIVERSAL,D.Type.BITSTRING,!1,a)}else if(t.name==="subjectAltName"||t.name==="issuerAltName"){t.value=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[]);for(var l,d=0;d<t.altNames.length;++d){l=t.altNames[d];var a=l.value;if(l.type===7&&l.ip){if(a=Pt.util.bytesFromIP(l.ip),a===null){var r=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw r.extension=t,r}}else l.type===8&&(l.oid?a=D.oidToDer(D.oidToDer(l.oid)):a=D.oidToDer(a));t.value.value.push(D.create(D.Class.CONTEXT_SPECIFIC,l.type,!1,a))}}else if(t.name==="nsComment"&&e.cert){if(!/^[\x00-\x7F]*$/.test(t.comment)||t.comment.length<1||t.comment.length>128)throw new Error('Invalid "nsComment" content.');t.value=D.create(D.Class.UNIVERSAL,D.Type.IA5STRING,!1,t.comment)}else if(t.name==="subjectKeyIdentifier"&&e.cert){var p=e.cert.generateSubjectKeyIdentifier();t.subjectKeyIdentifier=p.toHex(),t.value=D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,p.getBytes())}else if(t.name==="authorityKeyIdentifier"&&e.cert){t.value=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[]);var c=t.value.value;if(t.keyIdentifier){var f=t.keyIdentifier===!0?e.cert.generateSubjectKeyIdentifier().getBytes():t.keyIdentifier;c.push(D.create(D.Class.CONTEXT_SPECIFIC,0,!1,f))}if(t.authorityCertIssuer){var m=[D.create(D.Class.CONTEXT_SPECIFIC,4,!0,[kC(t.authorityCertIssuer===!0?e.cert.issuer:t.authorityCertIssuer)])];c.push(D.create(D.Class.CONTEXT_SPECIFIC,1,!0,m))}if(t.serialNumber){var h=Pt.util.hexToBytes(t.serialNumber===!0?e.cert.serialNumber:t.serialNumber);c.push(D.create(D.Class.CONTEXT_SPECIFIC,2,!1,h))}}else if(t.name==="cRLDistributionPoints"){t.value=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[]);for(var c=t.value.value,g=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[]),v=D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[]),l,d=0;d<t.altNames.length;++d){l=t.altNames[d];var a=l.value;if(l.type===7&&l.ip){if(a=Pt.util.bytesFromIP(l.ip),a===null){var r=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw r.extension=t,r}}else l.type===8&&(l.oid?a=D.oidToDer(D.oidToDer(l.oid)):a=D.oidToDer(a));v.value.push(D.create(D.Class.CONTEXT_SPECIFIC,l.type,!1,a))}g.value.push(D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[v])),c.push(g)}if(typeof t.value>"u"){var r=new Error("Extension value not specified.");throw r.extension=t,r}return t}function MW(t,e){switch(t){case jr["RSASSA-PSS"]:var r=[];return e.hash.algorithmOid!==void 0&&r.push(D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(e.hash.algorithmOid).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.NULL,!1,"")])])),e.mgf.algorithmOid!==void 0&&r.push(D.create(D.Class.CONTEXT_SPECIFIC,1,!0,[D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(e.mgf.algorithmOid).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(e.mgf.hash.algorithmOid).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.NULL,!1,"")])])])),e.saltLength!==void 0&&r.push(D.create(D.Class.CONTEXT_SPECIFIC,2,!0,[D.create(D.Class.UNIVERSAL,D.Type.INTEGER,!1,D.integerToDer(e.saltLength).getBytes())])),D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,r);default:return D.create(D.Class.UNIVERSAL,D.Type.NULL,!1,"")}}function Mze(t){var e=D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[]);if(t.attributes.length===0)return e;for(var r=t.attributes,n=0;n<r.length;++n){var o=r[n],s=o.value,a=D.Type.UTF8;"valueTagClass"in o&&(a=o.valueTagClass),a===D.Type.UTF8&&(s=Pt.util.encodeUtf8(s));var c=!1;"valueConstructed"in o&&(c=o.valueConstructed);var u=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(o.type).getBytes()),D.create(D.Class.UNIVERSAL,D.Type.SET,!0,[D.create(D.Class.UNIVERSAL,a,c,s)])]);e.value.push(u)}return e}var Fze=new Date("1950-01-01T00:00:00Z"),Uze=new Date("2050-01-01T00:00:00Z");function kge(t){return t>=Fze&&t<Uze?D.create(D.Class.UNIVERSAL,D.Type.UTCTIME,!1,D.dateToUtcTime(t)):D.create(D.Class.UNIVERSAL,D.Type.GENERALIZEDTIME,!1,D.dateToGeneralizedTime(t))}Ge.getTBSCertificate=function(t){var e=kge(t.validity.notBefore),r=kge(t.validity.notAfter),n=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.CONTEXT_SPECIFIC,0,!0,[D.create(D.Class.UNIVERSAL,D.Type.INTEGER,!1,D.integerToDer(t.version).getBytes())]),D.create(D.Class.UNIVERSAL,D.Type.INTEGER,!1,Pt.util.hexToBytes(t.serialNumber)),D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(t.siginfo.algorithmOid).getBytes()),MW(t.siginfo.algorithmOid,t.siginfo.parameters)]),kC(t.issuer),D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[e,r]),kC(t.subject),Ge.publicKeyToAsn1(t.publicKey)]);return t.issuer.uniqueId&&n.value.push(D.create(D.Class.CONTEXT_SPECIFIC,1,!0,[D.create(D.Class.UNIVERSAL,D.Type.BITSTRING,!1,"\0"+t.issuer.uniqueId)])),t.subject.uniqueId&&n.value.push(D.create(D.Class.CONTEXT_SPECIFIC,2,!0,[D.create(D.Class.UNIVERSAL,D.Type.BITSTRING,!1,"\0"+t.subject.uniqueId)])),t.extensions.length>0&&n.value.push(Ge.certificateExtensionsToAsn1(t.extensions)),n};Ge.getCertificationRequestInfo=function(t){var e=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.INTEGER,!1,D.integerToDer(t.version).getBytes()),kC(t.subject),Ge.publicKeyToAsn1(t.publicKey),Mze(t)]);return e};Ge.distinguishedNameToAsn1=function(t){return kC(t)};Ge.certificateToAsn1=function(t){var e=t.tbsCertificate||Ge.getTBSCertificate(t);return D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[e,D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(t.signatureOid).getBytes()),MW(t.signatureOid,t.signatureParameters)]),D.create(D.Class.UNIVERSAL,D.Type.BITSTRING,!1,"\0"+t.signature)])};Ge.certificateExtensionsToAsn1=function(t){var e=D.create(D.Class.CONTEXT_SPECIFIC,3,!0,[]),r=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[]);e.value.push(r);for(var n=0;n<t.length;++n)r.value.push(Ge.certificateExtensionToAsn1(t[n]));return e};Ge.certificateExtensionToAsn1=function(t){var e=D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[]);e.value.push(D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(t.id).getBytes())),t.critical&&e.value.push(D.create(D.Class.UNIVERSAL,D.Type.BOOLEAN,!1,"\xFF"));var r=t.value;return typeof t.value!="string"&&(r=D.toDer(r).getBytes()),e.value.push(D.create(D.Class.UNIVERSAL,D.Type.OCTETSTRING,!1,r)),e};Ge.certificationRequestToAsn1=function(t){var e=t.certificationRequestInfo||Ge.getCertificationRequestInfo(t);return D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[e,D.create(D.Class.UNIVERSAL,D.Type.SEQUENCE,!0,[D.create(D.Class.UNIVERSAL,D.Type.OID,!1,D.oidToDer(t.signatureOid).getBytes()),MW(t.signatureOid,t.signatureParameters)]),D.create(D.Class.UNIVERSAL,D.Type.BITSTRING,!1,"\0"+t.signature)])};Ge.createCaStore=function(t){var e={certs:{}};e.getIssuer=function(a){var c=r(a.issuer);return c},e.addCertificate=function(a){if(typeof a=="string"&&(a=Pt.pki.certificateFromPem(a)),n(a.subject),!e.hasCertificate(a))if(a.subject.hash in e.certs){var c=e.certs[a.subject.hash];Pt.util.isArray(c)||(c=[c]),c.push(a),e.certs[a.subject.hash]=c}else e.certs[a.subject.hash]=a},e.hasCertificate=function(a){typeof a=="string"&&(a=Pt.pki.certificateFromPem(a));var c=r(a.subject);if(!c)return!1;Pt.util.isArray(c)||(c=[c]);for(var u=D.toDer(Ge.certificateToAsn1(a)).getBytes(),l=0;l<c.length;++l){var d=D.toDer(Ge.certificateToAsn1(c[l])).getBytes();if(u===d)return!0}return!1},e.listAllCertificates=function(){var a=[];for(var c in e.certs)if(e.certs.hasOwnProperty(c)){var u=e.certs[c];if(!Pt.util.isArray(u))a.push(u);else for(var l=0;l<u.length;++l)a.push(u[l])}return a},e.removeCertificate=function(a){var c;if(typeof a=="string"&&(a=Pt.pki.certificateFromPem(a)),n(a.subject),!e.hasCertificate(a))return null;var u=r(a.subject);if(!Pt.util.isArray(u))return c=e.certs[a.subject.hash],delete e.certs[a.subject.hash],c;for(var l=D.toDer(Ge.certificateToAsn1(a)).getBytes(),d=0;d<u.length;++d){var p=D.toDer(Ge.certificateToAsn1(u[d])).getBytes();l===p&&(c=u[d],u.splice(d,1))}return u.length===0&&delete e.certs[a.subject.hash],c};function r(a){return n(a),e.certs[a.hash]||null}function n(a){if(!a.hash){var c=Pt.md.sha1.create();a.attributes=Ge.RDNAttributesAsArray(kC(a),c),a.hash=c.digest().toHex()}}if(t)for(var o=0;o<t.length;++o){var s=t[o];e.addCertificate(s)}return e};Ge.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"};Ge.verifyCertificateChain=function(t,e,r){typeof r=="function"&&(r={verify:r}),r=r||{},e=e.slice(0);var n=e.slice(0),o=r.validityCheckDate;typeof o>"u"&&(o=new Date);var s=!0,a=null,c=0;do{var u=e.shift(),l=null,d=!1;if(o&&(o<u.validity.notBefore||o>u.validity.notAfter)&&(a={message:"Certificate is not valid yet or has expired.",error:Ge.certificateError.certificate_expired,notBefore:u.validity.notBefore,notAfter:u.validity.notAfter,now:o}),a===null){if(l=e[0]||t.getIssuer(u),l===null&&u.isIssuer(u)&&(d=!0,l=u),l){var p=l;Pt.util.isArray(p)||(p=[p]);for(var f=!1;!f&&p.length>0;){l=p.shift();try{f=l.verify(u)}catch{}}f||(a={message:"Certificate signature is invalid.",error:Ge.certificateError.bad_certificate})}a===null&&(!l||d)&&!t.hasCertificate(u)&&(a={message:"Certificate is not trusted.",error:Ge.certificateError.unknown_ca})}if(a===null&&l&&!u.isIssuer(l)&&(a={message:"Certificate issuer is invalid.",error:Ge.certificateError.bad_certificate}),a===null)for(var m={keyUsage:!0,basicConstraints:!0},h=0;a===null&&h<u.extensions.length;++h){var g=u.extensions[h];g.critical&&!(g.name in m)&&(a={message:"Certificate has an unsupported critical extension.",error:Ge.certificateError.unsupported_certificate})}if(a===null&&(!s||e.length===0&&(!l||d))){var v=u.getExtension("basicConstraints"),y=u.getExtension("keyUsage");if(y!==null&&(!y.keyCertSign||v===null)&&(a={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:Ge.certificateError.bad_certificate}),a===null&&v!==null&&!v.cA&&(a={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:Ge.certificateError.bad_certificate}),a===null&&y!==null&&"pathLenConstraint"in v){var _=c-1;_>v.pathLenConstraint&&(a={message:"Certificate basicConstraints pathLenConstraint violated.",error:Ge.certificateError.bad_certificate})}}var x=a===null?!0:a.error,S=r.verify?r.verify(x,c,n):x;if(S===!0)a=null;else throw x===!0&&(a={message:"The application rejected the certificate.",error:Ge.certificateError.bad_certificate}),(S||S===0)&&(typeof S=="object"&&!Pt.util.isArray(S)?(S.message&&(a.message=S.message),S.error&&(a.error=S.error)):typeof S=="string"&&(a.error=S)),a;s=!1,++c}while(e.length>0);return!0}});var UW=O((hhr,Oge)=>{var Ln=cr();Ql();SC();Lv();LW();NW();Ou();f2();EC();$r();LM();var z=Ln.asn1,Ir=Ln.pki,h2=Oge.exports=Ln.pkcs12=Ln.pkcs12||{},Lge={name:"ContentInfo",tagClass:z.Class.UNIVERSAL,type:z.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:z.Class.UNIVERSAL,type:z.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:z.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},Bze={name:"PFX",tagClass:z.Class.UNIVERSAL,type:z.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:z.Class.UNIVERSAL,type:z.Type.INTEGER,constructed:!1,capture:"version"},Lge,{name:"PFX.macData",tagClass:z.Class.UNIVERSAL,type:z.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:z.Class.UNIVERSAL,type:z.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:z.Class.UNIVERSAL,type:z.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:z.Class.UNIVERSAL,type:z.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:z.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:z.Class.UNIVERSAL,type:z.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:z.Class.UNIVERSAL,type:z.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:z.Class.UNIVERSAL,type:z.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},qze={name:"SafeBag",tagClass:z.Class.UNIVERSAL,type:z.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:z.Class.UNIVERSAL,type:z.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:z.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:z.Class.UNIVERSAL,type:z.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},jze={name:"Attribute",tagClass:z.Class.UNIVERSAL,type:z.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:z.Class.UNIVERSAL,type:z.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:z.Class.UNIVERSAL,type:z.Type.SET,constructed:!0,capture:"values"}]},Hze={name:"CertBag",tagClass:z.Class.UNIVERSAL,type:z.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:z.Class.UNIVERSAL,type:z.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:z.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:z.Class.UNIVERSAL,type:z.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};function m2(t,e,r,n){for(var o=[],s=0;s<t.length;s++)for(var a=0;a<t[s].safeBags.length;a++){var c=t[s].safeBags[a];if(!(n!==void 0&&c.type!==n)){if(e===null){o.push(c);continue}c.attributes[e]!==void 0&&c.attributes[e].indexOf(r)>=0&&o.push(c)}}return o}h2.pkcs12FromAsn1=function(t,e,r){typeof e=="string"?(r=e,e=!0):e===void 0&&(e=!0);var n={},o=[];if(!z.validate(t,Bze,n,o)){var s=new Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.");throw s.errors=s,s}var a={version:n.version.charCodeAt(0),safeContents:[],getBags:function(v){var y={},_;return"localKeyId"in v?_=v.localKeyId:"localKeyIdHex"in v&&(_=Ln.util.hexToBytes(v.localKeyIdHex)),_===void 0&&!("friendlyName"in v)&&"bagType"in v&&(y[v.bagType]=m2(a.safeContents,null,null,v.bagType)),_!==void 0&&(y.localKeyId=m2(a.safeContents,"localKeyId",_,v.bagType)),"friendlyName"in v&&(y.friendlyName=m2(a.safeContents,"friendlyName",v.friendlyName,v.bagType)),y},getBagsByFriendlyName:function(v,y){return m2(a.safeContents,"friendlyName",v,y)},getBagsByLocalKeyId:function(v,y){return m2(a.safeContents,"localKeyId",v,y)}};if(n.version.charCodeAt(0)!==3){var s=new Error("PKCS#12 PFX of version other than 3 not supported.");throw s.version=n.version.charCodeAt(0),s}if(z.derToOid(n.contentType)!==Ir.oids.data){var s=new Error("Only PKCS#12 PFX in password integrity mode supported.");throw s.oid=z.derToOid(n.contentType),s}var c=n.content.value[0];if(c.tagClass!==z.Class.UNIVERSAL||c.type!==z.Type.OCTETSTRING)throw new Error("PKCS#12 authSafe content data is not an OCTET STRING.");if(c=FW(c),n.mac){var u=null,l=0,d=z.derToOid(n.macAlgorithm);switch(d){case Ir.oids.sha1:u=Ln.md.sha1.create(),l=20;break;case Ir.oids.sha256:u=Ln.md.sha256.create(),l=32;break;case Ir.oids.sha384:u=Ln.md.sha384.create(),l=48;break;case Ir.oids.sha512:u=Ln.md.sha512.create(),l=64;break;case Ir.oids.md5:u=Ln.md.md5.create(),l=16;break}if(u===null)throw new Error("PKCS#12 uses unsupported MAC algorithm: "+d);var p=new Ln.util.ByteBuffer(n.macSalt),f="macIterations"in n?parseInt(Ln.util.bytesToHex(n.macIterations),16):1,m=h2.generateKey(r,p,3,f,l,u),h=Ln.hmac.create();h.start(u,m),h.update(c.value);var g=h.getMac();if(g.getBytes()!==n.macDigest)throw new Error("PKCS#12 MAC could not be verified. Invalid password?")}return Vze(a,c.value,e,r),a};function FW(t){if(t.composed||t.constructed){for(var e=Ln.util.createBuffer(),r=0;r<t.value.length;++r)e.putBytes(t.value[r].value);t.composed=t.constructed=!1,t.value=e.getBytes()}return t}function Vze(t,e,r,n){if(e=z.fromDer(e,r),e.tagClass!==z.Class.UNIVERSAL||e.type!==z.Type.SEQUENCE||e.constructed!==!0)throw new Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(var o=0;o<e.value.length;o++){var s=e.value[o],a={},c=[];if(!z.validate(s,Lge,a,c)){var u=new Error("Cannot read ContentInfo.");throw u.errors=c,u}var l={encrypted:!1},d=null,p=a.content.value[0];switch(z.derToOid(a.contentType)){case Ir.oids.data:if(p.tagClass!==z.Class.UNIVERSAL||p.type!==z.Type.OCTETSTRING)throw new Error("PKCS#12 SafeContents Data is not an OCTET STRING.");d=FW(p).value;break;case Ir.oids.encryptedData:d=Gze(p,n),l.encrypted=!0;break;default:var u=new Error("Unsupported PKCS#12 contentType.");throw u.contentType=z.derToOid(a.contentType),u}l.safeBags=zze(d,r,n),t.safeContents.push(l)}}function Gze(t,e){var r={},n=[];if(!z.validate(t,Ln.pkcs7.asn1.encryptedDataValidator,r,n)){var o=new Error("Cannot read EncryptedContentInfo.");throw o.errors=n,o}var s=z.derToOid(r.contentType);if(s!==Ir.oids.data){var o=new Error("PKCS#12 EncryptedContentInfo ContentType is not Data.");throw o.oid=s,o}s=z.derToOid(r.encAlgorithm);var a=Ir.pbe.getCipher(s,r.encParameter,e),c=FW(r.encryptedContentAsn1),u=Ln.util.createBuffer(c.value);if(a.update(u),!a.finish())throw new Error("Failed to decrypt PKCS#12 SafeContents.");return a.output.getBytes()}function zze(t,e,r){if(!e&&t.length===0)return[];if(t=z.fromDer(t,e),t.tagClass!==z.Class.UNIVERSAL||t.type!==z.Type.SEQUENCE||t.constructed!==!0)throw new Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");for(var n=[],o=0;o<t.value.length;o++){var s=t.value[o],a={},c=[];if(!z.validate(s,qze,a,c)){var u=new Error("Cannot read SafeBag.");throw u.errors=c,u}var l={type:z.derToOid(a.bagId),attributes:$ze(a.bagAttributes)};n.push(l);var d,p,f=a.bagValue.value[0];switch(l.type){case Ir.oids.pkcs8ShroudedKeyBag:if(f=Ir.decryptPrivateKeyInfo(f,r),f===null)throw new Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?");case Ir.oids.keyBag:try{l.key=Ir.privateKeyFromAsn1(f)}catch{l.key=null,l.asn1=f}continue;case Ir.oids.certBag:d=Hze,p=function(){if(z.derToOid(a.certId)!==Ir.oids.x509Certificate){var h=new Error("Unsupported certificate type, only X.509 supported.");throw h.oid=z.derToOid(a.certId),h}var g=z.fromDer(a.cert,e);try{l.cert=Ir.certificateFromAsn1(g,!0)}catch{l.cert=null,l.asn1=g}};break;default:var u=new Error("Unsupported PKCS#12 SafeBag type.");throw u.oid=l.type,u}if(d!==void 0&&!z.validate(f,d,a,c)){var u=new Error("Cannot read PKCS#12 "+d.name);throw u.errors=c,u}p()}return n}function $ze(t){var e={};if(t!==void 0)for(var r=0;r<t.length;++r){var n={},o=[];if(!z.validate(t[r],jze,n,o)){var s=new Error("Cannot read PKCS#12 BagAttribute.");throw s.errors=o,s}var a=z.derToOid(n.oid);if(Ir.oids[a]!==void 0){e[Ir.oids[a]]=[];for(var c=0;c<n.values.length;++c)e[Ir.oids[a]].push(n.values[c].value)}}return e}h2.toPkcs12Asn1=function(t,e,r,n){n=n||{},n.saltSize=n.saltSize||8,n.count=n.count||2048,n.algorithm=n.algorithm||n.encAlgorithm||"aes128","useMac"in n||(n.useMac=!0),"localKeyId"in n||(n.localKeyId=null),"generateLocalKeyId"in n||(n.generateLocalKeyId=!0);var o=n.localKeyId,s;if(o!==null)o=Ln.util.hexToBytes(o);else if(n.generateLocalKeyId)if(e){var a=Ln.util.isArray(e)?e[0]:e;typeof a=="string"&&(a=Ir.certificateFromPem(a));var c=Ln.md.sha1.create();c.update(z.toDer(Ir.certificateToAsn1(a)).getBytes()),o=c.digest().getBytes()}else o=Ln.random.getBytes(20);var u=[];o!==null&&u.push(z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[z.create(z.Class.UNIVERSAL,z.Type.OID,!1,z.oidToDer(Ir.oids.localKeyId).getBytes()),z.create(z.Class.UNIVERSAL,z.Type.SET,!0,[z.create(z.Class.UNIVERSAL,z.Type.OCTETSTRING,!1,o)])])),"friendlyName"in n&&u.push(z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[z.create(z.Class.UNIVERSAL,z.Type.OID,!1,z.oidToDer(Ir.oids.friendlyName).getBytes()),z.create(z.Class.UNIVERSAL,z.Type.SET,!0,[z.create(z.Class.UNIVERSAL,z.Type.BMPSTRING,!1,n.friendlyName)])])),u.length>0&&(s=z.create(z.Class.UNIVERSAL,z.Type.SET,!0,u));var l=[],d=[];e!==null&&(Ln.util.isArray(e)?d=e:d=[e]);for(var p=[],f=0;f<d.length;++f){e=d[f],typeof e=="string"&&(e=Ir.certificateFromPem(e));var m=f===0?s:void 0,h=Ir.certificateToAsn1(e),g=z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[z.create(z.Class.UNIVERSAL,z.Type.OID,!1,z.oidToDer(Ir.oids.certBag).getBytes()),z.create(z.Class.CONTEXT_SPECIFIC,0,!0,[z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[z.create(z.Class.UNIVERSAL,z.Type.OID,!1,z.oidToDer(Ir.oids.x509Certificate).getBytes()),z.create(z.Class.CONTEXT_SPECIFIC,0,!0,[z.create(z.Class.UNIVERSAL,z.Type.OCTETSTRING,!1,z.toDer(h).getBytes())])])]),m]);p.push(g)}if(p.length>0){var v=z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,p),y=z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[z.create(z.Class.UNIVERSAL,z.Type.OID,!1,z.oidToDer(Ir.oids.data).getBytes()),z.create(z.Class.CONTEXT_SPECIFIC,0,!0,[z.create(z.Class.UNIVERSAL,z.Type.OCTETSTRING,!1,z.toDer(v).getBytes())])]);l.push(y)}var _=null;if(t!==null){var x=Ir.wrapRsaPrivateKey(Ir.privateKeyToAsn1(t));r===null?_=z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[z.create(z.Class.UNIVERSAL,z.Type.OID,!1,z.oidToDer(Ir.oids.keyBag).getBytes()),z.create(z.Class.CONTEXT_SPECIFIC,0,!0,[x]),s]):_=z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[z.create(z.Class.UNIVERSAL,z.Type.OID,!1,z.oidToDer(Ir.oids.pkcs8ShroudedKeyBag).getBytes()),z.create(z.Class.CONTEXT_SPECIFIC,0,!0,[Ir.encryptPrivateKeyInfo(x,r,n)]),s]);var S=z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[_]),I=z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[z.create(z.Class.UNIVERSAL,z.Type.OID,!1,z.oidToDer(Ir.oids.data).getBytes()),z.create(z.Class.CONTEXT_SPECIFIC,0,!0,[z.create(z.Class.UNIVERSAL,z.Type.OCTETSTRING,!1,z.toDer(S).getBytes())])]);l.push(I)}var E=z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,l),R;if(n.useMac){var c=Ln.md.sha1.create(),B=new Ln.util.ByteBuffer(Ln.random.getBytes(n.saltSize)),V=n.count,t=h2.generateKey(r,B,3,V,20),M=Ln.hmac.create();M.start(c,t),M.update(z.toDer(E).getBytes());var le=M.getMac();R=z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[z.create(z.Class.UNIVERSAL,z.Type.OID,!1,z.oidToDer(Ir.oids.sha1).getBytes()),z.create(z.Class.UNIVERSAL,z.Type.NULL,!1,"")]),z.create(z.Class.UNIVERSAL,z.Type.OCTETSTRING,!1,le.getBytes())]),z.create(z.Class.UNIVERSAL,z.Type.OCTETSTRING,!1,B.getBytes()),z.create(z.Class.UNIVERSAL,z.Type.INTEGER,!1,z.integerToDer(V).getBytes())])}return z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[z.create(z.Class.UNIVERSAL,z.Type.INTEGER,!1,z.integerToDer(3).getBytes()),z.create(z.Class.UNIVERSAL,z.Type.SEQUENCE,!0,[z.create(z.Class.UNIVERSAL,z.Type.OID,!1,z.oidToDer(Ir.oids.data).getBytes()),z.create(z.Class.CONTEXT_SPECIFIC,0,!0,[z.create(z.Class.UNIVERSAL,z.Type.OCTETSTRING,!1,z.toDer(E).getBytes())])]),R])};h2.generateKey=Ln.pbe.generatePkcs12Key});var qW=O((ghr,Mge)=>{var Uv=cr();Ql();Lv();NW();My();CM();UW();AM();f2();$r();LM();var BW=Uv.asn1,PC=Mge.exports=Uv.pki=Uv.pki||{};PC.pemToDer=function(t){var e=Uv.pem.decode(t)[0];if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert PEM to DER; PEM is encrypted.");return Uv.util.createBuffer(e.body)};PC.privateKeyFromPem=function(t){var e=Uv.pem.decode(t)[0];if(e.type!=="PRIVATE KEY"&&e.type!=="RSA PRIVATE KEY"){var r=new Error('Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY".');throw r.headerType=e.type,r}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert private key from PEM; PEM is encrypted.");var n=BW.fromDer(e.body);return PC.privateKeyFromAsn1(n)};PC.privateKeyToPem=function(t,e){var r={type:"RSA PRIVATE KEY",body:BW.toDer(PC.privateKeyToAsn1(t)).getBytes()};return Uv.pem.encode(r,{maxline:e})};PC.privateKeyInfoToPem=function(t,e){var r={type:"PRIVATE KEY",body:BW.toDer(t).getBytes()};return Uv.pem.encode(r,{maxline:e})}});var $W=O((vhr,Gge)=>{var Te=cr();Ql();SC();_M();My();qW();Ou();EC();$r();var UM=function(t,e,r,n){var o=Te.util.createBuffer(),s=t.length>>1,a=s+(t.length&1),c=t.substr(0,a),u=t.substr(s,a),l=Te.util.createBuffer(),d=Te.hmac.create();r=e+r;var p=Math.ceil(n/16),f=Math.ceil(n/20);d.start("MD5",c);var m=Te.util.createBuffer();l.putBytes(r);for(var h=0;h<p;++h)d.start(null,null),d.update(l.getBytes()),l.putBuffer(d.digest()),d.start(null,null),d.update(l.bytes()+r),m.putBuffer(d.digest());d.start("SHA1",u);var g=Te.util.createBuffer();l.clear(),l.putBytes(r);for(var h=0;h<f;++h)d.start(null,null),d.update(l.getBytes()),l.putBuffer(d.digest()),d.start(null,null),d.update(l.bytes()+r),g.putBuffer(d.digest());return o.putBytes(Te.util.xorBytes(m.getBytes(),g.getBytes(),n)),o},Wze=function(t,e,r){var n=Te.hmac.create();n.start("SHA1",t);var o=Te.util.createBuffer();return o.putInt32(e[0]),o.putInt32(e[1]),o.putByte(r.type),o.putByte(r.version.major),o.putByte(r.version.minor),o.putInt16(r.length),o.putBytes(r.fragment.bytes()),n.update(o.getBytes()),n.digest().getBytes()},Kze=function(t,e,r){var n=!1;try{var o=t.deflate(e.fragment.getBytes());e.fragment=Te.util.createBuffer(o),e.length=o.length,n=!0}catch{}return n},Yze=function(t,e,r){var n=!1;try{var o=t.inflate(e.fragment.getBytes());e.fragment=Te.util.createBuffer(o),e.length=o.length,n=!0}catch{}return n},jc=function(t,e){var r=0;switch(e){case 1:r=t.getByte();break;case 2:r=t.getInt16();break;case 3:r=t.getInt24();break;case 4:r=t.getInt32();break}return Te.util.createBuffer(t.getBytes(r))},Bu=function(t,e,r){t.putInt(r.length(),e<<3),t.putBuffer(r)},L={};L.Versions={TLS_1_0:{major:3,minor:1},TLS_1_1:{major:3,minor:2},TLS_1_2:{major:3,minor:3}};L.SupportedVersions=[L.Versions.TLS_1_1,L.Versions.TLS_1_0];L.Version=L.SupportedVersions[0];L.MaxFragment=15360;L.ConnectionEnd={server:0,client:1};L.PRFAlgorithm={tls_prf_sha256:0};L.BulkCipherAlgorithm={none:null,rc4:0,des3:1,aes:2};L.CipherType={stream:0,block:1,aead:2};L.MACAlgorithm={none:null,hmac_md5:0,hmac_sha1:1,hmac_sha256:2,hmac_sha384:3,hmac_sha512:4};L.CompressionMethod={none:0,deflate:1};L.ContentType={change_cipher_spec:20,alert:21,handshake:22,application_data:23,heartbeat:24};L.HandshakeType={hello_request:0,client_hello:1,server_hello:2,certificate:11,server_key_exchange:12,certificate_request:13,server_hello_done:14,certificate_verify:15,client_key_exchange:16,finished:20};L.Alert={};L.Alert.Level={warning:1,fatal:2};L.Alert.Description={close_notify:0,unexpected_message:10,bad_record_mac:20,decryption_failed:21,record_overflow:22,decompression_failure:30,handshake_failure:40,bad_certificate:42,unsupported_certificate:43,certificate_revoked:44,certificate_expired:45,certificate_unknown:46,illegal_parameter:47,unknown_ca:48,access_denied:49,decode_error:50,decrypt_error:51,export_restriction:60,protocol_version:70,insufficient_security:71,internal_error:80,user_canceled:90,no_renegotiation:100};L.HeartbeatMessageType={heartbeat_request:1,heartbeat_response:2};L.CipherSuites={};L.getCipherSuite=function(t){var e=null;for(var r in L.CipherSuites){var n=L.CipherSuites[r];if(n.id[0]===t.charCodeAt(0)&&n.id[1]===t.charCodeAt(1)){e=n;break}}return e};L.handleUnexpected=function(t,e){var r=!t.open&&t.entity===L.ConnectionEnd.client;r||t.error(t,{message:"Unexpected message. Received TLS record out of order.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.unexpected_message}})};L.handleHelloRequest=function(t,e,r){!t.handshaking&&t.handshakes>0&&(L.queue(t,L.createAlert(t,{level:L.Alert.Level.warning,description:L.Alert.Description.no_renegotiation})),L.flush(t)),t.process()};L.parseHelloMessage=function(t,e,r){var n=null,o=t.entity===L.ConnectionEnd.client;if(r<38)t.error(t,{message:o?"Invalid ServerHello message. Message too short.":"Invalid ClientHello message. Message too short.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.illegal_parameter}});else{var s=e.fragment,a=s.length();if(n={version:{major:s.getByte(),minor:s.getByte()},random:Te.util.createBuffer(s.getBytes(32)),session_id:jc(s,1),extensions:[]},o?(n.cipher_suite=s.getBytes(2),n.compression_method=s.getByte()):(n.cipher_suites=jc(s,2),n.compression_methods=jc(s,1)),a=r-(a-s.length()),a>0){for(var c=jc(s,2);c.length()>0;)n.extensions.push({type:[c.getByte(),c.getByte()],data:jc(c,2)});if(!o)for(var u=0;u<n.extensions.length;++u){var l=n.extensions[u];if(l.type[0]===0&&l.type[1]===0)for(var d=jc(l.data,2);d.length()>0;){var p=d.getByte();if(p!==0)break;t.session.extensions.server_name.serverNameList.push(jc(d,2).getBytes())}}}if(t.session.version&&(n.version.major!==t.session.version.major||n.version.minor!==t.session.version.minor))return t.error(t,{message:"TLS version change is disallowed during renegotiation.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.protocol_version}});if(o)t.session.cipherSuite=L.getCipherSuite(n.cipher_suite);else for(var f=Te.util.createBuffer(n.cipher_suites.bytes());f.length()>0&&(t.session.cipherSuite=L.getCipherSuite(f.getBytes(2)),t.session.cipherSuite===null););if(t.session.cipherSuite===null)return t.error(t,{message:"No cipher suites in common.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.handshake_failure},cipherSuite:Te.util.bytesToHex(n.cipher_suite)});o?t.session.compressionMethod=n.compression_method:t.session.compressionMethod=L.CompressionMethod.none}return n};L.createSecurityParameters=function(t,e){var r=t.entity===L.ConnectionEnd.client,n=e.random.bytes(),o=r?t.session.sp.client_random:n,s=r?n:L.createRandom().getBytes();t.session.sp={entity:t.entity,prf_algorithm:L.PRFAlgorithm.tls_prf_sha256,bulk_cipher_algorithm:null,cipher_type:null,enc_key_length:null,block_length:null,fixed_iv_length:null,record_iv_length:null,mac_algorithm:null,mac_length:null,mac_key_length:null,compression_algorithm:t.session.compressionMethod,pre_master_secret:null,master_secret:null,client_random:o,server_random:s}};L.handleServerHello=function(t,e,r){var n=L.parseHelloMessage(t,e,r);if(!t.fail){if(n.version.minor<=t.version.minor)t.version.minor=n.version.minor;else return t.error(t,{message:"Incompatible TLS version.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.protocol_version}});t.session.version=t.version;var o=n.session_id.bytes();o.length>0&&o===t.session.id?(t.expect=Bge,t.session.resuming=!0,t.session.sp.server_random=n.random.bytes()):(t.expect=Xze,t.session.resuming=!1,L.createSecurityParameters(t,n)),t.session.id=o,t.process()}};L.handleClientHello=function(t,e,r){var n=L.parseHelloMessage(t,e,r);if(!t.fail){var o=n.session_id.bytes(),s=null;if(t.sessionCache&&(s=t.sessionCache.getSession(o),s===null?o="":(s.version.major!==n.version.major||s.version.minor>n.version.minor)&&(s=null,o="")),o.length===0&&(o=Te.random.getBytes(32)),t.session.id=o,t.session.clientHelloVersion=n.version,t.session.sp={},s)t.version=t.session.version=s.version,t.session.sp=s.sp;else{for(var a,c=1;c<L.SupportedVersions.length&&(a=L.SupportedVersions[c],!(a.minor<=n.version.minor));++c);t.version={major:a.major,minor:a.minor},t.session.version=t.version}s!==null?(t.expect=GW,t.session.resuming=!0,t.session.sp.client_random=n.random.bytes()):(t.expect=t.verifyClient!==!1?i$e:VW,t.session.resuming=!1,L.createSecurityParameters(t,n)),t.open=!0,L.queue(t,L.createRecord(t,{type:L.ContentType.handshake,data:L.createServerHello(t)})),t.session.resuming?(L.queue(t,L.createRecord(t,{type:L.ContentType.change_cipher_spec,data:L.createChangeCipherSpec()})),t.state.pending=L.createConnectionState(t),t.state.current.write=t.state.pending.write,L.queue(t,L.createRecord(t,{type:L.ContentType.handshake,data:L.createFinished(t)}))):(L.queue(t,L.createRecord(t,{type:L.ContentType.handshake,data:L.createCertificate(t)})),t.fail||(L.queue(t,L.createRecord(t,{type:L.ContentType.handshake,data:L.createServerKeyExchange(t)})),t.verifyClient!==!1&&L.queue(t,L.createRecord(t,{type:L.ContentType.handshake,data:L.createCertificateRequest(t)})),L.queue(t,L.createRecord(t,{type:L.ContentType.handshake,data:L.createServerHelloDone(t)})))),L.flush(t),t.process()}};L.handleCertificate=function(t,e,r){if(r<3)return t.error(t,{message:"Invalid Certificate message. Message too short.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.illegal_parameter}});var n=e.fragment,o={certificate_list:jc(n,3)},s,a,c=[];try{for(;o.certificate_list.length()>0;)s=jc(o.certificate_list,3),a=Te.asn1.fromDer(s),s=Te.pki.certificateFromAsn1(a,!0),c.push(s)}catch(l){return t.error(t,{message:"Could not parse certificate list.",cause:l,send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.bad_certificate}})}var u=t.entity===L.ConnectionEnd.client;(u||t.verifyClient===!0)&&c.length===0?t.error(t,{message:u?"No server certificate provided.":"No client certificate provided.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.illegal_parameter}}):c.length===0?t.expect=u?Fge:VW:(u?t.session.serverCertificate=c[0]:t.session.clientCertificate=c[0],L.verifyCertificateChain(t,c)&&(t.expect=u?Fge:VW)),t.process()};L.handleServerKeyExchange=function(t,e,r){if(r>0)return t.error(t,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.unsupported_certificate}});t.expect=Jze,t.process()};L.handleClientKeyExchange=function(t,e,r){if(r<48)return t.error(t,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.unsupported_certificate}});var n=e.fragment,o={enc_pre_master_secret:jc(n,2).getBytes()},s=null;if(t.getPrivateKey)try{s=t.getPrivateKey(t,t.session.serverCertificate),s=Te.pki.privateKeyFromPem(s)}catch(u){t.error(t,{message:"Could not get private key.",cause:u,send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.internal_error}})}if(s===null)return t.error(t,{message:"No private key set.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.internal_error}});try{var a=t.session.sp;a.pre_master_secret=s.decrypt(o.enc_pre_master_secret);var c=t.session.clientHelloVersion;if(c.major!==a.pre_master_secret.charCodeAt(0)||c.minor!==a.pre_master_secret.charCodeAt(1))throw new Error("TLS version rollback attack detected.")}catch{a.pre_master_secret=Te.random.getBytes(48)}t.expect=GW,t.session.clientCertificate!==null&&(t.expect=o$e),t.process()};L.handleCertificateRequest=function(t,e,r){if(r<3)return t.error(t,{message:"Invalid CertificateRequest. Message too short.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.illegal_parameter}});var n=e.fragment,o={certificate_types:jc(n,1),certificate_authorities:jc(n,2)};t.session.certificateRequest=o,t.expect=Zze,t.process()};L.handleCertificateVerify=function(t,e,r){if(r<2)return t.error(t,{message:"Invalid CertificateVerify. Message too short.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.illegal_parameter}});var n=e.fragment;n.read-=4;var o=n.bytes();n.read+=4;var s={signature:jc(n,2).getBytes()},a=Te.util.createBuffer();a.putBuffer(t.session.md5.digest()),a.putBuffer(t.session.sha1.digest()),a=a.getBytes();try{var c=t.session.clientCertificate;if(!c.publicKey.verify(a,s.signature,"NONE"))throw new Error("CertificateVerify signature does not match.");t.session.md5.update(o),t.session.sha1.update(o)}catch{return t.error(t,{message:"Bad signature in CertificateVerify.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.handshake_failure}})}t.expect=GW,t.process()};L.handleServerHelloDone=function(t,e,r){if(r>0)return t.error(t,{message:"Invalid ServerHelloDone message. Invalid length.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.record_overflow}});if(t.serverCertificate===null){var n={message:"No server certificate provided. Not enough security.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.insufficient_security}},o=0,s=t.verify(t,n.alert.description,o,[]);if(s!==!0)return(s||s===0)&&(typeof s=="object"&&!Te.util.isArray(s)?(s.message&&(n.message=s.message),s.alert&&(n.alert.description=s.alert)):typeof s=="number"&&(n.alert.description=s)),t.error(t,n)}t.session.certificateRequest!==null&&(e=L.createRecord(t,{type:L.ContentType.handshake,data:L.createCertificate(t)}),L.queue(t,e)),e=L.createRecord(t,{type:L.ContentType.handshake,data:L.createClientKeyExchange(t)}),L.queue(t,e),t.expect=r$e;var a=function(c,u){c.session.certificateRequest!==null&&c.session.clientCertificate!==null&&L.queue(c,L.createRecord(c,{type:L.ContentType.handshake,data:L.createCertificateVerify(c,u)})),L.queue(c,L.createRecord(c,{type:L.ContentType.change_cipher_spec,data:L.createChangeCipherSpec()})),c.state.pending=L.createConnectionState(c),c.state.current.write=c.state.pending.write,L.queue(c,L.createRecord(c,{type:L.ContentType.handshake,data:L.createFinished(c)})),c.expect=Bge,L.flush(c),c.process()};if(t.session.certificateRequest===null||t.session.clientCertificate===null)return a(t,null);L.getClientSignature(t,a)};L.handleChangeCipherSpec=function(t,e){if(e.fragment.getByte()!==1)return t.error(t,{message:"Invalid ChangeCipherSpec message received.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.illegal_parameter}});var r=t.entity===L.ConnectionEnd.client;(t.session.resuming&&r||!t.session.resuming&&!r)&&(t.state.pending=L.createConnectionState(t)),t.state.current.read=t.state.pending.read,(!t.session.resuming&&r||t.session.resuming&&!r)&&(t.state.pending=null),t.expect=r?e$e:s$e,t.process()};L.handleFinished=function(t,e,r){var n=e.fragment;n.read-=4;var o=n.bytes();n.read+=4;var s=e.fragment.getBytes();n=Te.util.createBuffer(),n.putBuffer(t.session.md5.digest()),n.putBuffer(t.session.sha1.digest());var a=t.entity===L.ConnectionEnd.client,c=a?"server finished":"client finished",u=t.session.sp,l=12,d=UM;if(n=d(u.master_secret,c,n.getBytes(),l),n.getBytes()!==s)return t.error(t,{message:"Invalid verify_data in Finished message.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.decrypt_error}});t.session.md5.update(o),t.session.sha1.update(o),(t.session.resuming&&a||!t.session.resuming&&!a)&&(L.queue(t,L.createRecord(t,{type:L.ContentType.change_cipher_spec,data:L.createChangeCipherSpec()})),t.state.current.write=t.state.pending.write,t.state.pending=null,L.queue(t,L.createRecord(t,{type:L.ContentType.handshake,data:L.createFinished(t)}))),t.expect=a?t$e:a$e,t.handshaking=!1,++t.handshakes,t.peerCertificate=a?t.session.serverCertificate:t.session.clientCertificate,L.flush(t),t.isConnected=!0,t.connected(t),t.process()};L.handleAlert=function(t,e){var r=e.fragment,n={level:r.getByte(),description:r.getByte()},o;switch(n.description){case L.Alert.Description.close_notify:o="Connection closed.";break;case L.Alert.Description.unexpected_message:o="Unexpected message.";break;case L.Alert.Description.bad_record_mac:o="Bad record MAC.";break;case L.Alert.Description.decryption_failed:o="Decryption failed.";break;case L.Alert.Description.record_overflow:o="Record overflow.";break;case L.Alert.Description.decompression_failure:o="Decompression failed.";break;case L.Alert.Description.handshake_failure:o="Handshake failure.";break;case L.Alert.Description.bad_certificate:o="Bad certificate.";break;case L.Alert.Description.unsupported_certificate:o="Unsupported certificate.";break;case L.Alert.Description.certificate_revoked:o="Certificate revoked.";break;case L.Alert.Description.certificate_expired:o="Certificate expired.";break;case L.Alert.Description.certificate_unknown:o="Certificate unknown.";break;case L.Alert.Description.illegal_parameter:o="Illegal parameter.";break;case L.Alert.Description.unknown_ca:o="Unknown certificate authority.";break;case L.Alert.Description.access_denied:o="Access denied.";break;case L.Alert.Description.decode_error:o="Decode error.";break;case L.Alert.Description.decrypt_error:o="Decrypt error.";break;case L.Alert.Description.export_restriction:o="Export restriction.";break;case L.Alert.Description.protocol_version:o="Unsupported protocol version.";break;case L.Alert.Description.insufficient_security:o="Insufficient security.";break;case L.Alert.Description.internal_error:o="Internal error.";break;case L.Alert.Description.user_canceled:o="User canceled.";break;case L.Alert.Description.no_renegotiation:o="Renegotiation not supported.";break;default:o="Unknown error.";break}if(n.description===L.Alert.Description.close_notify)return t.close();t.error(t,{message:o,send:!1,origin:t.entity===L.ConnectionEnd.client?"server":"client",alert:n}),t.process()};L.handleHandshake=function(t,e){var r=e.fragment,n=r.getByte(),o=r.getInt24();if(o>r.length())return t.fragmented=e,e.fragment=Te.util.createBuffer(),r.read-=4,t.process();t.fragmented=null,r.read-=4;var s=r.bytes(o+4);r.read+=4,n in FM[t.entity][t.expect]?(t.entity===L.ConnectionEnd.server&&!t.open&&!t.fail&&(t.handshaking=!0,t.session={version:null,extensions:{server_name:{serverNameList:[]}},cipherSuite:null,compressionMethod:null,serverCertificate:null,clientCertificate:null,md5:Te.md.md5.create(),sha1:Te.md.sha1.create()}),n!==L.HandshakeType.hello_request&&n!==L.HandshakeType.certificate_verify&&n!==L.HandshakeType.finished&&(t.session.md5.update(s),t.session.sha1.update(s)),FM[t.entity][t.expect][n](t,e,o)):L.handleUnexpected(t,e)};L.handleApplicationData=function(t,e){t.data.putBuffer(e.fragment),t.dataReady(t),t.process()};L.handleHeartbeat=function(t,e){var r=e.fragment,n=r.getByte(),o=r.getInt16(),s=r.getBytes(o);if(n===L.HeartbeatMessageType.heartbeat_request){if(t.handshaking||o>s.length)return t.process();L.queue(t,L.createRecord(t,{type:L.ContentType.heartbeat,data:L.createHeartbeat(L.HeartbeatMessageType.heartbeat_response,s)})),L.flush(t)}else if(n===L.HeartbeatMessageType.heartbeat_response){if(s!==t.expectedHeartbeatPayload)return t.process();t.heartbeatReceived&&t.heartbeatReceived(t,Te.util.createBuffer(s))}t.process()};var Qze=0,Xze=1,Fge=2,Jze=3,Zze=4,Bge=5,e$e=6,t$e=7,r$e=8,n$e=0,i$e=1,VW=2,o$e=3,GW=4,s$e=5,a$e=6,N=L.handleUnexpected,qge=L.handleChangeCipherSpec,ys=L.handleAlert,Sa=L.handleHandshake,jge=L.handleApplicationData,_s=L.handleHeartbeat,zW=[];zW[L.ConnectionEnd.client]=[[N,ys,Sa,N,_s],[N,ys,Sa,N,_s],[N,ys,Sa,N,_s],[N,ys,Sa,N,_s],[N,ys,Sa,N,_s],[qge,ys,N,N,_s],[N,ys,Sa,N,_s],[N,ys,Sa,jge,_s],[N,ys,Sa,N,_s]];zW[L.ConnectionEnd.server]=[[N,ys,Sa,N,_s],[N,ys,Sa,N,_s],[N,ys,Sa,N,_s],[N,ys,Sa,N,_s],[qge,ys,N,N,_s],[N,ys,Sa,N,_s],[N,ys,Sa,jge,_s],[N,ys,Sa,N,_s]];var Bv=L.handleHelloRequest,c$e=L.handleServerHello,Hge=L.handleCertificate,Uge=L.handleServerKeyExchange,jW=L.handleCertificateRequest,OM=L.handleServerHelloDone,Vge=L.handleFinished,FM=[];FM[L.ConnectionEnd.client]=[[N,N,c$e,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N],[Bv,N,N,N,N,N,N,N,N,N,N,Hge,Uge,jW,OM,N,N,N,N,N,N],[Bv,N,N,N,N,N,N,N,N,N,N,N,Uge,jW,OM,N,N,N,N,N,N],[Bv,N,N,N,N,N,N,N,N,N,N,N,N,jW,OM,N,N,N,N,N,N],[Bv,N,N,N,N,N,N,N,N,N,N,N,N,N,OM,N,N,N,N,N,N],[Bv,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N],[Bv,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,Vge],[Bv,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N],[Bv,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N]];var u$e=L.handleClientHello,l$e=L.handleClientKeyExchange,d$e=L.handleCertificateVerify;FM[L.ConnectionEnd.server]=[[N,u$e,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N],[N,N,N,N,N,N,N,N,N,N,N,Hge,N,N,N,N,N,N,N,N,N],[N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,l$e,N,N,N,N],[N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,d$e,N,N,N,N,N],[N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N],[N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,Vge],[N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N],[N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N,N]];L.generateKeys=function(t,e){var r=UM,n=e.client_random+e.server_random;t.session.resuming||(e.master_secret=r(e.pre_master_secret,"master secret",n,48).bytes(),e.pre_master_secret=null),n=e.server_random+e.client_random;var o=2*e.mac_key_length+2*e.enc_key_length,s=t.version.major===L.Versions.TLS_1_0.major&&t.version.minor===L.Versions.TLS_1_0.minor;s&&(o+=2*e.fixed_iv_length);var a=r(e.master_secret,"key expansion",n,o),c={client_write_MAC_key:a.getBytes(e.mac_key_length),server_write_MAC_key:a.getBytes(e.mac_key_length),client_write_key:a.getBytes(e.enc_key_length),server_write_key:a.getBytes(e.enc_key_length)};return s&&(c.client_write_IV=a.getBytes(e.fixed_iv_length),c.server_write_IV=a.getBytes(e.fixed_iv_length)),c};L.createConnectionState=function(t){var e=t.entity===L.ConnectionEnd.client,r=function(){var s={sequenceNumber:[0,0],macKey:null,macLength:0,macFunction:null,cipherState:null,cipherFunction:function(a){return!0},compressionState:null,compressFunction:function(a){return!0},updateSequenceNumber:function(){s.sequenceNumber[1]===4294967295?(s.sequenceNumber[1]=0,++s.sequenceNumber[0]):++s.sequenceNumber[1]}};return s},n={read:r(),write:r()};if(n.read.update=function(s,a){return n.read.cipherFunction(a,n.read)?n.read.compressFunction(s,a,n.read)||s.error(s,{message:"Could not decompress record.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.decompression_failure}}):s.error(s,{message:"Could not decrypt record or bad MAC.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.bad_record_mac}}),!s.fail},n.write.update=function(s,a){return n.write.compressFunction(s,a,n.write)?n.write.cipherFunction(a,n.write)||s.error(s,{message:"Could not encrypt record.",send:!1,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.internal_error}}):s.error(s,{message:"Could not compress record.",send:!1,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.internal_error}}),!s.fail},t.session){var o=t.session.sp;switch(t.session.cipherSuite.initSecurityParameters(o),o.keys=L.generateKeys(t,o),n.read.macKey=e?o.keys.server_write_MAC_key:o.keys.client_write_MAC_key,n.write.macKey=e?o.keys.client_write_MAC_key:o.keys.server_write_MAC_key,t.session.cipherSuite.initConnectionState(n,t,o),o.compression_algorithm){case L.CompressionMethod.none:break;case L.CompressionMethod.deflate:n.read.compressFunction=Yze,n.write.compressFunction=Kze;break;default:throw new Error("Unsupported compression algorithm.")}}return n};L.createRandom=function(){var t=new Date,e=+t+t.getTimezoneOffset()*6e4,r=Te.util.createBuffer();return r.putInt32(e),r.putBytes(Te.random.getBytes(28)),r};L.createRecord=function(t,e){if(!e.data)return null;var r={type:e.type,version:{major:t.version.major,minor:t.version.minor},length:e.data.length(),fragment:e.data};return r};L.createAlert=function(t,e){var r=Te.util.createBuffer();return r.putByte(e.level),r.putByte(e.description),L.createRecord(t,{type:L.ContentType.alert,data:r})};L.createClientHello=function(t){t.session.clientHelloVersion={major:t.version.major,minor:t.version.minor};for(var e=Te.util.createBuffer(),r=0;r<t.cipherSuites.length;++r){var n=t.cipherSuites[r];e.putByte(n.id[0]),e.putByte(n.id[1])}var o=e.length(),s=Te.util.createBuffer();s.putByte(L.CompressionMethod.none);var a=s.length(),c=Te.util.createBuffer();if(t.virtualHost){var u=Te.util.createBuffer();u.putByte(0),u.putByte(0);var l=Te.util.createBuffer();l.putByte(0),Bu(l,2,Te.util.createBuffer(t.virtualHost));var d=Te.util.createBuffer();Bu(d,2,l),Bu(u,2,d),c.putBuffer(u)}var p=c.length();p>0&&(p+=2);var f=t.session.id,m=f.length+1+2+4+28+2+o+1+a+p,h=Te.util.createBuffer();return h.putByte(L.HandshakeType.client_hello),h.putInt24(m),h.putByte(t.version.major),h.putByte(t.version.minor),h.putBytes(t.session.sp.client_random),Bu(h,1,Te.util.createBuffer(f)),Bu(h,2,e),Bu(h,1,s),p>0&&Bu(h,2,c),h};L.createServerHello=function(t){var e=t.session.id,r=e.length+1+2+4+28+2+1,n=Te.util.createBuffer();return n.putByte(L.HandshakeType.server_hello),n.putInt24(r),n.putByte(t.version.major),n.putByte(t.version.minor),n.putBytes(t.session.sp.server_random),Bu(n,1,Te.util.createBuffer(e)),n.putByte(t.session.cipherSuite.id[0]),n.putByte(t.session.cipherSuite.id[1]),n.putByte(t.session.compressionMethod),n};L.createCertificate=function(t){var e=t.entity===L.ConnectionEnd.client,r=null;if(t.getCertificate){var n;e?n=t.session.certificateRequest:n=t.session.extensions.server_name.serverNameList,r=t.getCertificate(t,n)}var o=Te.util.createBuffer();if(r!==null)try{Te.util.isArray(r)||(r=[r]);for(var s=null,a=0;a<r.length;++a){var c=Te.pem.decode(r[a])[0];if(c.type!=="CERTIFICATE"&&c.type!=="X509 CERTIFICATE"&&c.type!=="TRUSTED CERTIFICATE"){var u=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw u.headerType=c.type,u}if(c.procType&&c.procType.type==="ENCRYPTED")throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var l=Te.util.createBuffer(c.body);s===null&&(s=Te.asn1.fromDer(l.bytes(),!1));var d=Te.util.createBuffer();Bu(d,3,l),o.putBuffer(d)}r=Te.pki.certificateFromAsn1(s),e?t.session.clientCertificate=r:t.session.serverCertificate=r}catch(m){return t.error(t,{message:"Could not send certificate list.",cause:m,send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.bad_certificate}})}var p=3+o.length(),f=Te.util.createBuffer();return f.putByte(L.HandshakeType.certificate),f.putInt24(p),Bu(f,3,o),f};L.createClientKeyExchange=function(t){var e=Te.util.createBuffer();e.putByte(t.session.clientHelloVersion.major),e.putByte(t.session.clientHelloVersion.minor),e.putBytes(Te.random.getBytes(46));var r=t.session.sp;r.pre_master_secret=e.getBytes();var n=t.session.serverCertificate.publicKey;e=n.encrypt(r.pre_master_secret);var o=e.length+2,s=Te.util.createBuffer();return s.putByte(L.HandshakeType.client_key_exchange),s.putInt24(o),s.putInt16(e.length),s.putBytes(e),s};L.createServerKeyExchange=function(t){var e=0,r=Te.util.createBuffer();return e>0&&(r.putByte(L.HandshakeType.server_key_exchange),r.putInt24(e)),r};L.getClientSignature=function(t,e){var r=Te.util.createBuffer();r.putBuffer(t.session.md5.digest()),r.putBuffer(t.session.sha1.digest()),r=r.getBytes(),t.getSignature=t.getSignature||function(n,o,s){var a=null;if(n.getPrivateKey)try{a=n.getPrivateKey(n,n.session.clientCertificate),a=Te.pki.privateKeyFromPem(a)}catch(c){n.error(n,{message:"Could not get private key.",cause:c,send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.internal_error}})}a===null?n.error(n,{message:"No private key set.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.internal_error}}):o=a.sign(o,null),s(n,o)},t.getSignature(t,r,e)};L.createCertificateVerify=function(t,e){var r=e.length+2,n=Te.util.createBuffer();return n.putByte(L.HandshakeType.certificate_verify),n.putInt24(r),n.putInt16(e.length),n.putBytes(e),n};L.createCertificateRequest=function(t){var e=Te.util.createBuffer();e.putByte(1);var r=Te.util.createBuffer();for(var n in t.caStore.certs){var o=t.caStore.certs[n],s=Te.pki.distinguishedNameToAsn1(o.subject),a=Te.asn1.toDer(s);r.putInt16(a.length()),r.putBuffer(a)}var c=1+e.length()+2+r.length(),u=Te.util.createBuffer();return u.putByte(L.HandshakeType.certificate_request),u.putInt24(c),Bu(u,1,e),Bu(u,2,r),u};L.createServerHelloDone=function(t){var e=Te.util.createBuffer();return e.putByte(L.HandshakeType.server_hello_done),e.putInt24(0),e};L.createChangeCipherSpec=function(){var t=Te.util.createBuffer();return t.putByte(1),t};L.createFinished=function(t){var e=Te.util.createBuffer();e.putBuffer(t.session.md5.digest()),e.putBuffer(t.session.sha1.digest());var r=t.entity===L.ConnectionEnd.client,n=t.session.sp,o=12,s=UM,a=r?"client finished":"server finished";e=s(n.master_secret,a,e.getBytes(),o);var c=Te.util.createBuffer();return c.putByte(L.HandshakeType.finished),c.putInt24(e.length()),c.putBuffer(e),c};L.createHeartbeat=function(t,e,r){typeof r>"u"&&(r=e.length);var n=Te.util.createBuffer();n.putByte(t),n.putInt16(r),n.putBytes(e);var o=n.length(),s=Math.max(16,o-r-3);return n.putBytes(Te.random.getBytes(s)),n};L.queue=function(t,e){if(e&&!(e.fragment.length()===0&&(e.type===L.ContentType.handshake||e.type===L.ContentType.alert||e.type===L.ContentType.change_cipher_spec))){if(e.type===L.ContentType.handshake){var r=e.fragment.bytes();t.session.md5.update(r),t.session.sha1.update(r),r=null}var n;if(e.fragment.length()<=L.MaxFragment)n=[e];else{n=[];for(var o=e.fragment.bytes();o.length>L.MaxFragment;)n.push(L.createRecord(t,{type:e.type,data:Te.util.createBuffer(o.slice(0,L.MaxFragment))})),o=o.slice(L.MaxFragment);o.length>0&&n.push(L.createRecord(t,{type:e.type,data:Te.util.createBuffer(o)}))}for(var s=0;s<n.length&&!t.fail;++s){var a=n[s],c=t.state.current.write;c.update(t,a)&&t.records.push(a)}}};L.flush=function(t){for(var e=0;e<t.records.length;++e){var r=t.records[e];t.tlsData.putByte(r.type),t.tlsData.putByte(r.version.major),t.tlsData.putByte(r.version.minor),t.tlsData.putInt16(r.fragment.length()),t.tlsData.putBuffer(t.records[e].fragment)}return t.records=[],t.tlsDataReady(t)};var HW=function(t){switch(t){case!0:return!0;case Te.pki.certificateError.bad_certificate:return L.Alert.Description.bad_certificate;case Te.pki.certificateError.unsupported_certificate:return L.Alert.Description.unsupported_certificate;case Te.pki.certificateError.certificate_revoked:return L.Alert.Description.certificate_revoked;case Te.pki.certificateError.certificate_expired:return L.Alert.Description.certificate_expired;case Te.pki.certificateError.certificate_unknown:return L.Alert.Description.certificate_unknown;case Te.pki.certificateError.unknown_ca:return L.Alert.Description.unknown_ca;default:return L.Alert.Description.bad_certificate}},p$e=function(t){switch(t){case!0:return!0;case L.Alert.Description.bad_certificate:return Te.pki.certificateError.bad_certificate;case L.Alert.Description.unsupported_certificate:return Te.pki.certificateError.unsupported_certificate;case L.Alert.Description.certificate_revoked:return Te.pki.certificateError.certificate_revoked;case L.Alert.Description.certificate_expired:return Te.pki.certificateError.certificate_expired;case L.Alert.Description.certificate_unknown:return Te.pki.certificateError.certificate_unknown;case L.Alert.Description.unknown_ca:return Te.pki.certificateError.unknown_ca;default:return Te.pki.certificateError.bad_certificate}};L.verifyCertificateChain=function(t,e){try{var r={};for(var n in t.verifyOptions)r[n]=t.verifyOptions[n];r.verify=function(s,a,c){var u=HW(s),l=t.verify(t,s,a,c);if(l!==!0){if(typeof l=="object"&&!Te.util.isArray(l)){var d=new Error("The application rejected the certificate.");throw d.send=!0,d.alert={level:L.Alert.Level.fatal,description:L.Alert.Description.bad_certificate},l.message&&(d.message=l.message),l.alert&&(d.alert.description=l.alert),d}l!==s&&(l=p$e(l))}return l},Te.pki.verifyCertificateChain(t.caStore,e,r)}catch(s){var o=s;(typeof o!="object"||Te.util.isArray(o))&&(o={send:!0,alert:{level:L.Alert.Level.fatal,description:HW(s)}}),"send"in o||(o.send=!0),"alert"in o||(o.alert={level:L.Alert.Level.fatal,description:HW(o.error)}),t.error(t,o)}return!t.fail};L.createSessionCache=function(t,e){var r=null;if(t&&t.getSession&&t.setSession&&t.order)r=t;else{r={},r.cache=t||{},r.capacity=Math.max(e||100,1),r.order=[];for(var n in t)r.order.length<=e?r.order.push(n):delete t[n];r.getSession=function(o){var s=null,a=null;if(o?a=Te.util.bytesToHex(o):r.order.length>0&&(a=r.order[0]),a!==null&&a in r.cache){s=r.cache[a],delete r.cache[a];for(var c in r.order)if(r.order[c]===a){r.order.splice(c,1);break}}return s},r.setSession=function(o,s){if(r.order.length===r.capacity){var a=r.order.shift();delete r.cache[a]}var a=Te.util.bytesToHex(o);r.order.push(a),r.cache[a]=s}}return r};L.createConnection=function(t){var e=null;t.caStore?Te.util.isArray(t.caStore)?e=Te.pki.createCaStore(t.caStore):e=t.caStore:e=Te.pki.createCaStore();var r=t.cipherSuites||null;if(r===null){r=[];for(var n in L.CipherSuites)r.push(L.CipherSuites[n])}var o=t.server?L.ConnectionEnd.server:L.ConnectionEnd.client,s=t.sessionCache?L.createSessionCache(t.sessionCache):null,a={version:{major:L.Version.major,minor:L.Version.minor},entity:o,sessionId:t.sessionId,caStore:e,sessionCache:s,cipherSuites:r,connected:t.connected,virtualHost:t.virtualHost||null,verifyClient:t.verifyClient||!1,verify:t.verify||function(d,p,f,m){return p},verifyOptions:t.verifyOptions||{},getCertificate:t.getCertificate||null,getPrivateKey:t.getPrivateKey||null,getSignature:t.getSignature||null,input:Te.util.createBuffer(),tlsData:Te.util.createBuffer(),data:Te.util.createBuffer(),tlsDataReady:t.tlsDataReady,dataReady:t.dataReady,heartbeatReceived:t.heartbeatReceived,closed:t.closed,error:function(d,p){p.origin=p.origin||(d.entity===L.ConnectionEnd.client?"client":"server"),p.send&&(L.queue(d,L.createAlert(d,p.alert)),L.flush(d));var f=p.fatal!==!1;f&&(d.fail=!0),t.error(d,p),f&&d.close(!1)},deflate:t.deflate||null,inflate:t.inflate||null};a.reset=function(d){a.version={major:L.Version.major,minor:L.Version.minor},a.record=null,a.session=null,a.peerCertificate=null,a.state={pending:null,current:null},a.expect=a.entity===L.ConnectionEnd.client?Qze:n$e,a.fragmented=null,a.records=[],a.open=!1,a.handshakes=0,a.handshaking=!1,a.isConnected=!1,a.fail=!(d||typeof d>"u"),a.input.clear(),a.tlsData.clear(),a.data.clear(),a.state.current=L.createConnectionState(a)},a.reset();var c=function(d,p){var f=p.type-L.ContentType.change_cipher_spec,m=zW[d.entity][d.expect];f in m?m[f](d,p):L.handleUnexpected(d,p)},u=function(d){var p=0,f=d.input,m=f.length();if(m<5)p=5-m;else{d.record={type:f.getByte(),version:{major:f.getByte(),minor:f.getByte()},length:f.getInt16(),fragment:Te.util.createBuffer(),ready:!1};var h=d.record.version.major===d.version.major;h&&d.session&&d.session.version&&(h=d.record.version.minor===d.version.minor),h||d.error(d,{message:"Incompatible TLS version.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.protocol_version}})}return p},l=function(d){var p=0,f=d.input,m=f.length();if(m<d.record.length)p=d.record.length-m;else{d.record.fragment.putBytes(f.getBytes(d.record.length)),f.compact();var h=d.state.current.read;h.update(d,d.record)&&(d.fragmented!==null&&(d.fragmented.type===d.record.type?(d.fragmented.fragment.putBuffer(d.record.fragment),d.record=d.fragmented):d.error(d,{message:"Invalid fragmented record.",send:!0,alert:{level:L.Alert.Level.fatal,description:L.Alert.Description.unexpected_message}})),d.record.ready=!0)}return p};return a.handshake=function(d){if(a.entity!==L.ConnectionEnd.client)a.error(a,{message:"Cannot initiate handshake as a server.",fatal:!1});else if(a.handshaking)a.error(a,{message:"Handshake already in progress.",fatal:!1});else{a.fail&&!a.open&&a.handshakes===0&&(a.fail=!1),a.handshaking=!0,d=d||"";var p=null;d.length>0&&(a.sessionCache&&(p=a.sessionCache.getSession(d)),p===null&&(d="")),d.length===0&&a.sessionCache&&(p=a.sessionCache.getSession(),p!==null&&(d=p.id)),a.session={id:d,version:null,cipherSuite:null,compressionMethod:null,serverCertificate:null,certificateRequest:null,clientCertificate:null,sp:{},md5:Te.md.md5.create(),sha1:Te.md.sha1.create()},p&&(a.version=p.version,a.session.sp=p.sp),a.session.sp.client_random=L.createRandom().getBytes(),a.open=!0,L.queue(a,L.createRecord(a,{type:L.ContentType.handshake,data:L.createClientHello(a)})),L.flush(a)}},a.process=function(d){var p=0;return d&&a.input.putBytes(d),a.fail||(a.record!==null&&a.record.ready&&a.record.fragment.isEmpty()&&(a.record=null),a.record===null&&(p=u(a)),!a.fail&&a.record!==null&&!a.record.ready&&(p=l(a)),!a.fail&&a.record!==null&&a.record.ready&&c(a,a.record)),p},a.prepare=function(d){return L.queue(a,L.createRecord(a,{type:L.ContentType.application_data,data:Te.util.createBuffer(d)})),L.flush(a)},a.prepareHeartbeatRequest=function(d,p){return d instanceof Te.util.ByteBuffer&&(d=d.bytes()),typeof p>"u"&&(p=d.length),a.expectedHeartbeatPayload=d,L.queue(a,L.createRecord(a,{type:L.ContentType.heartbeat,data:L.createHeartbeat(L.HeartbeatMessageType.heartbeat_request,d,p)})),L.flush(a)},a.close=function(d){if(!a.fail&&a.sessionCache&&a.session){var p={id:a.session.id,version:a.session.version,sp:a.session.sp};p.sp.keys=null,a.sessionCache.setSession(p.id,p)}a.open&&(a.open=!1,a.input.clear(),(a.isConnected||a.handshaking)&&(a.isConnected=a.handshaking=!1,L.queue(a,L.createAlert(a,{level:L.Alert.Level.warning,description:L.Alert.Description.close_notify})),L.flush(a)),a.closed(a)),a.reset(d)},a};Gge.exports=Te.tls=Te.tls||{};for(MM in L)typeof L[MM]!="function"&&(Te.tls[MM]=L[MM]);var MM;Te.tls.prf_tls1=UM;Te.tls.hmac_sha1=Wze;Te.tls.createSessionCache=L.createSessionCache;Te.tls.createConnection=L.createConnection});var Wge=O((bhr,$ge)=>{var qv=cr();Nv();$W();var qu=$ge.exports=qv.tls;qu.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(t){t.bulk_cipher_algorithm=qu.BulkCipherAlgorithm.aes,t.cipher_type=qu.CipherType.block,t.enc_key_length=16,t.block_length=16,t.fixed_iv_length=16,t.record_iv_length=16,t.mac_algorithm=qu.MACAlgorithm.hmac_sha1,t.mac_length=20,t.mac_key_length=20},initConnectionState:zge};qu.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",initSecurityParameters:function(t){t.bulk_cipher_algorithm=qu.BulkCipherAlgorithm.aes,t.cipher_type=qu.CipherType.block,t.enc_key_length=32,t.block_length=16,t.fixed_iv_length=16,t.record_iv_length=16,t.mac_algorithm=qu.MACAlgorithm.hmac_sha1,t.mac_length=20,t.mac_key_length=20},initConnectionState:zge};function zge(t,e,r){var n=e.entity===qv.tls.ConnectionEnd.client;t.read.cipherState={init:!1,cipher:qv.cipher.createDecipher("AES-CBC",n?r.keys.server_write_key:r.keys.client_write_key),iv:n?r.keys.server_write_IV:r.keys.client_write_IV},t.write.cipherState={init:!1,cipher:qv.cipher.createCipher("AES-CBC",n?r.keys.client_write_key:r.keys.server_write_key),iv:n?r.keys.client_write_IV:r.keys.server_write_IV},t.read.cipherFunction=g$e,t.write.cipherFunction=f$e,t.read.macLength=t.write.macLength=r.mac_length,t.read.macFunction=t.write.macFunction=qu.hmac_sha1}function f$e(t,e){var r=!1,n=e.macFunction(e.macKey,e.sequenceNumber,t);t.fragment.putBytes(n),e.updateSequenceNumber();var o;t.version.minor===qu.Versions.TLS_1_0.minor?o=e.cipherState.init?null:e.cipherState.iv:o=qv.random.getBytesSync(16),e.cipherState.init=!0;var s=e.cipherState.cipher;return s.start({iv:o}),t.version.minor>=qu.Versions.TLS_1_1.minor&&s.output.putBytes(o),s.update(t.fragment),s.finish(m$e)&&(t.fragment=s.output,t.length=t.fragment.length(),r=!0),r}function m$e(t,e,r){if(!r){var n=t-e.length()%t;e.fillWithByte(n-1,n)}return!0}function h$e(t,e,r){var n=!0;if(r){for(var o=e.length(),s=e.last(),a=o-1-s;a<o-1;++a)n=n&&e.at(a)==s;n&&e.truncate(s+1)}return n}function g$e(t,e){var r=!1,n;t.version.minor===qu.Versions.TLS_1_0.minor?n=e.cipherState.init?null:e.cipherState.iv:n=t.fragment.getBytes(16),e.cipherState.init=!0;var o=e.cipherState.cipher;o.start({iv:n}),o.update(t.fragment),r=o.finish(h$e);var s=e.macLength,a=qv.random.getBytesSync(s),c=o.output.length();c>=s?(t.fragment=o.output.getBytes(c-s),a=o.output.getBytes(s)):t.fragment=o.output.getBytes(),t.fragment=qv.util.createBuffer(t.fragment),t.length=t.fragment.length();var u=e.macFunction(e.macKey,e.sequenceNumber,t);return e.updateSequenceNumber(),r=v$e(e.macKey,a,u)&&r,r}function v$e(t,e,r){var n=qv.hmac.create();return n.start("SHA1",t),n.update(e),e=n.digest().getBytes(),n.start(null,null),n.update(r),r=n.digest().getBytes(),e===r}});var YW=O((yhr,Xge)=>{var $n=cr();dp();$r();var g2=Xge.exports=$n.sha512=$n.sha512||{};$n.md.sha512=$n.md.algorithms.sha512=g2;var Yge=$n.sha384=$n.sha512.sha384=$n.sha512.sha384||{};Yge.create=function(){return g2.create("SHA-384")};$n.md.sha384=$n.md.algorithms.sha384=Yge;$n.sha512.sha256=$n.sha512.sha256||{create:function(){return g2.create("SHA-512/256")}};$n.md["sha512/256"]=$n.md.algorithms["sha512/256"]=$n.sha512.sha256;$n.sha512.sha224=$n.sha512.sha224||{create:function(){return g2.create("SHA-512/224")}};$n.md["sha512/224"]=$n.md.algorithms["sha512/224"]=$n.sha512.sha224;g2.create=function(t){if(Qge||b$e(),typeof t>"u"&&(t="SHA-512"),!(t in Hy))throw new Error("Invalid SHA-512 algorithm: "+t);for(var e=Hy[t],r=null,n=$n.util.createBuffer(),o=new Array(80),s=0;s<80;++s)o[s]=new Array(2);var a=64;switch(t){case"SHA-384":a=48;break;case"SHA-512/256":a=32;break;case"SHA-512/224":a=28;break}var c={algorithm:t.replace("-","").toLowerCase(),blockLength:128,digestLength:a,messageLength:0,fullMessageLength:null,messageLengthSize:16};return c.start=function(){c.messageLength=0,c.fullMessageLength=c.messageLength128=[];for(var u=c.messageLengthSize/4,l=0;l<u;++l)c.fullMessageLength.push(0);n=$n.util.createBuffer(),r=new Array(e.length);for(var l=0;l<e.length;++l)r[l]=e[l].slice(0);return c},c.start(),c.update=function(u,l){l==="utf8"&&(u=$n.util.encodeUtf8(u));var d=u.length;c.messageLength+=d,d=[d/4294967296>>>0,d>>>0];for(var p=c.fullMessageLength.length-1;p>=0;--p)c.fullMessageLength[p]+=d[1],d[1]=d[0]+(c.fullMessageLength[p]/4294967296>>>0),c.fullMessageLength[p]=c.fullMessageLength[p]>>>0,d[0]=d[1]/4294967296>>>0;return n.putBytes(u),Kge(r,o,n),(n.read>2048||n.length()===0)&&n.compact(),c},c.digest=function(){var u=$n.util.createBuffer();u.putBytes(n.bytes());var l=c.fullMessageLength[c.fullMessageLength.length-1]+c.messageLengthSize,d=l&c.blockLength-1;u.putBytes(WW.substr(0,c.blockLength-d));for(var p,f,m=c.fullMessageLength[0]*8,h=0;h<c.fullMessageLength.length-1;++h)p=c.fullMessageLength[h+1]*8,f=p/4294967296>>>0,m+=f,u.putInt32(m>>>0),m=p>>>0;u.putInt32(m);for(var g=new Array(r.length),h=0;h<r.length;++h)g[h]=r[h].slice(0);Kge(g,o,u);var v=$n.util.createBuffer(),y;t==="SHA-512"?y=g.length:t==="SHA-384"?y=g.length-2:y=g.length-4;for(var h=0;h<y;++h)v.putInt32(g[h][0]),(h!==y-1||t!=="SHA-512/224")&&v.putInt32(g[h][1]);return v},c};var WW=null,Qge=!1,KW=null,Hy=null;function b$e(){WW="\x80",WW+=$n.util.fillString("\0",128),KW=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],Hy={},Hy["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],Hy["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],Hy["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],Hy["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],Qge=!0}function Kge(t,e,r){for(var n,o,s,a,c,u,l,d,p,f,m,h,g,v,y,_,x,S,I,E,R,B,V,M,le,ne,q,P,k,U,F,$,ce,Y,j,xe=r.length();xe>=128;){for(k=0;k<16;++k)e[k][0]=r.getInt32()>>>0,e[k][1]=r.getInt32()>>>0;for(;k<80;++k)$=e[k-2],U=$[0],F=$[1],n=((U>>>19|F<<13)^(F>>>29|U<<3)^U>>>6)>>>0,o=((U<<13|F>>>19)^(F<<3|U>>>29)^(U<<26|F>>>6))>>>0,Y=e[k-15],U=Y[0],F=Y[1],s=((U>>>1|F<<31)^(U>>>8|F<<24)^U>>>7)>>>0,a=((U<<31|F>>>1)^(U<<24|F>>>8)^(U<<25|F>>>7))>>>0,ce=e[k-7],j=e[k-16],F=o+ce[1]+a+j[1],e[k][0]=n+ce[0]+s+j[0]+(F/4294967296>>>0)>>>0,e[k][1]=F>>>0;for(g=t[0][0],v=t[0][1],y=t[1][0],_=t[1][1],x=t[2][0],S=t[2][1],I=t[3][0],E=t[3][1],R=t[4][0],B=t[4][1],V=t[5][0],M=t[5][1],le=t[6][0],ne=t[6][1],q=t[7][0],P=t[7][1],k=0;k<80;++k)l=((R>>>14|B<<18)^(R>>>18|B<<14)^(B>>>9|R<<23))>>>0,d=((R<<18|B>>>14)^(R<<14|B>>>18)^(B<<23|R>>>9))>>>0,p=(le^R&(V^le))>>>0,f=(ne^B&(M^ne))>>>0,c=((g>>>28|v<<4)^(v>>>2|g<<30)^(v>>>7|g<<25))>>>0,u=((g<<4|v>>>28)^(v<<30|g>>>2)^(v<<25|g>>>7))>>>0,m=(g&y|x&(g^y))>>>0,h=(v&_|S&(v^_))>>>0,F=P+d+f+KW[k][1]+e[k][1],n=q+l+p+KW[k][0]+e[k][0]+(F/4294967296>>>0)>>>0,o=F>>>0,F=u+h,s=c+m+(F/4294967296>>>0)>>>0,a=F>>>0,q=le,P=ne,le=V,ne=M,V=R,M=B,F=E+o,R=I+n+(F/4294967296>>>0)>>>0,B=F>>>0,I=x,E=S,x=y,S=_,y=g,_=v,F=o+a,g=n+s+(F/4294967296>>>0)>>>0,v=F>>>0;F=t[0][1]+v,t[0][0]=t[0][0]+g+(F/4294967296>>>0)>>>0,t[0][1]=F>>>0,F=t[1][1]+_,t[1][0]=t[1][0]+y+(F/4294967296>>>0)>>>0,t[1][1]=F>>>0,F=t[2][1]+S,t[2][0]=t[2][0]+x+(F/4294967296>>>0)>>>0,t[2][1]=F>>>0,F=t[3][1]+E,t[3][0]=t[3][0]+I+(F/4294967296>>>0)>>>0,t[3][1]=F>>>0,F=t[4][1]+B,t[4][0]=t[4][0]+R+(F/4294967296>>>0)>>>0,t[4][1]=F>>>0,F=t[5][1]+M,t[5][0]=t[5][0]+V+(F/4294967296>>>0)>>>0,t[5][1]=F>>>0,F=t[6][1]+ne,t[6][0]=t[6][0]+le+(F/4294967296>>>0)>>>0,t[6][1]=F>>>0,F=t[7][1]+P,t[7][0]=t[7][0]+q+(F/4294967296>>>0)>>>0,t[7][1]=F>>>0,xe-=128}}});var Jge=O(QW=>{var y$e=cr();Ql();var ts=y$e.asn1;QW.privateKeyValidator={name:"PrivateKeyInfo",tagClass:ts.Class.UNIVERSAL,type:ts.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:ts.Class.UNIVERSAL,type:ts.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:ts.Class.UNIVERSAL,type:ts.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:ts.Class.UNIVERSAL,type:ts.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:ts.Class.UNIVERSAL,type:ts.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]};QW.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:ts.Class.UNIVERSAL,type:ts.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:ts.Class.UNIVERSAL,type:ts.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:ts.Class.UNIVERSAL,type:ts.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{tagClass:ts.Class.UNIVERSAL,type:ts.Type.BITSTRING,constructed:!1,composed:!0,captureBitStringValue:"ed25519PublicKey"}]}});var dve=O((xhr,lve)=>{var xs=cr();p2();Ou();YW();$r();var ive=Jge(),_$e=ive.publicKeyValidator,x$e=ive.privateKeyValidator;typeof Zge>"u"&&(Zge=xs.jsbn.BigInteger);var Zge,ZW=xs.util.ByteBuffer,ec=typeof Buffer>"u"?Uint8Array:Buffer;xs.pki=xs.pki||{};lve.exports=xs.pki.ed25519=xs.ed25519=xs.ed25519||{};var Cr=xs.ed25519;Cr.constants={};Cr.constants.PUBLIC_KEY_BYTE_LENGTH=32;Cr.constants.PRIVATE_KEY_BYTE_LENGTH=64;Cr.constants.SEED_BYTE_LENGTH=32;Cr.constants.SIGN_BYTE_LENGTH=64;Cr.constants.HASH_BYTE_LENGTH=64;Cr.generateKeyPair=function(t){t=t||{};var e=t.seed;if(e===void 0)e=xs.random.getBytesSync(Cr.constants.SEED_BYTE_LENGTH);else if(typeof e=="string"){if(e.length!==Cr.constants.SEED_BYTE_LENGTH)throw new TypeError('"seed" must be '+Cr.constants.SEED_BYTE_LENGTH+" bytes in length.")}else if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, Uint8Array, or a binary string.');e=Im({message:e,encoding:"binary"});for(var r=new ec(Cr.constants.PUBLIC_KEY_BYTE_LENGTH),n=new ec(Cr.constants.PRIVATE_KEY_BYTE_LENGTH),o=0;o<32;++o)n[o]=e[o];return T$e(r,n),{publicKey:r,privateKey:n}};Cr.privateKeyFromAsn1=function(t){var e={},r=[],n=xs.asn1.validate(t,x$e,e,r);if(!n){var o=new Error("Invalid Key.");throw o.errors=r,o}var s=xs.asn1.derToOid(e.privateKeyOid),a=xs.oids.EdDSA25519;if(s!==a)throw new Error('Invalid OID "'+s+'"; OID must be "'+a+'".');var c=e.privateKey,u=Im({message:xs.asn1.fromDer(c).value,encoding:"binary"});return{privateKeyBytes:u}};Cr.publicKeyFromAsn1=function(t){var e={},r=[],n=xs.asn1.validate(t,_$e,e,r);if(!n){var o=new Error("Invalid Key.");throw o.errors=r,o}var s=xs.asn1.derToOid(e.publicKeyOid),a=xs.oids.EdDSA25519;if(s!==a)throw new Error('Invalid OID "'+s+'"; OID must be "'+a+'".');var c=e.ed25519PublicKey;if(c.length!==Cr.constants.PUBLIC_KEY_BYTE_LENGTH)throw new Error("Key length is invalid.");return Im({message:c,encoding:"binary"})};Cr.publicKeyFromPrivateKey=function(t){t=t||{};var e=Im({message:t.privateKey,encoding:"binary"});if(e.length!==Cr.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+Cr.constants.PRIVATE_KEY_BYTE_LENGTH);for(var r=new ec(Cr.constants.PUBLIC_KEY_BYTE_LENGTH),n=0;n<r.length;++n)r[n]=e[32+n];return r};Cr.sign=function(t){t=t||{};var e=Im(t),r=Im({message:t.privateKey,encoding:"binary"});if(r.length===Cr.constants.SEED_BYTE_LENGTH){var n=Cr.generateKeyPair({seed:r});r=n.privateKey}else if(r.length!==Cr.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+Cr.constants.SEED_BYTE_LENGTH+" or "+Cr.constants.PRIVATE_KEY_BYTE_LENGTH);var o=new ec(Cr.constants.SIGN_BYTE_LENGTH+e.length);E$e(o,e,e.length,r);for(var s=new ec(Cr.constants.SIGN_BYTE_LENGTH),a=0;a<s.length;++a)s[a]=o[a];return s};Cr.verify=function(t){t=t||{};var e=Im(t);if(t.signature===void 0)throw new TypeError('"options.signature" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a binary string.');var r=Im({message:t.signature,encoding:"binary"});if(r.length!==Cr.constants.SIGN_BYTE_LENGTH)throw new TypeError('"options.signature" must have a byte length of '+Cr.constants.SIGN_BYTE_LENGTH);var n=Im({message:t.publicKey,encoding:"binary"});if(n.length!==Cr.constants.PUBLIC_KEY_BYTE_LENGTH)throw new TypeError('"options.publicKey" must have a byte length of '+Cr.constants.PUBLIC_KEY_BYTE_LENGTH);var o=new ec(Cr.constants.SIGN_BYTE_LENGTH+e.length),s=new ec(Cr.constants.SIGN_BYTE_LENGTH+e.length),a;for(a=0;a<Cr.constants.SIGN_BYTE_LENGTH;++a)o[a]=r[a];for(a=0;a<e.length;++a)o[a+Cr.constants.SIGN_BYTE_LENGTH]=e[a];return w$e(s,o,o.length,n)>=0};function Im(t){var e=t.message;if(e instanceof Uint8Array||e instanceof ec)return e;var r=t.encoding;if(e===void 0)if(t.md)e=t.md.digest().getBytes(),r="binary";else throw new TypeError('"options.message" or "options.md" not specified.');if(typeof e=="string"&&!r)throw new TypeError('"options.encoding" must be "binary" or "utf8".');if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.from(e,r);e=new ZW(e,r)}else if(!(e instanceof ZW))throw new TypeError('"options.message" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a string with "options.encoding" specifying its encoding.');for(var n=new ec(e.length()),o=0;o<n.length;++o)n[o]=e.at(o);return n}var eK=Mt(),BM=Mt([1]),S$e=Mt([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),I$e=Mt([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),eve=Mt([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),tve=Mt([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),XW=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]),C$e=Mt([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function v2(t,e){var r=xs.md.sha512.create(),n=new ZW(t);r.update(n.getBytes(e),"binary");var o=r.digest().getBytes();if(typeof Buffer<"u")return Buffer.from(o,"binary");for(var s=new ec(Cr.constants.HASH_BYTE_LENGTH),a=0;a<64;++a)s[a]=o.charCodeAt(a);return s}function T$e(t,e){var r=[Mt(),Mt(),Mt(),Mt()],n,o=v2(e,32);for(o[0]&=248,o[31]&=127,o[31]|=64,iK(r,o),nK(t,r),n=0;n<32;++n)e[n+32]=t[n];return 0}function E$e(t,e,r,n){var o,s,a=new Float64Array(64),c=[Mt(),Mt(),Mt(),Mt()],u=v2(n,32);u[0]&=248,u[31]&=127,u[31]|=64;var l=r+64;for(o=0;o<r;++o)t[64+o]=e[o];for(o=0;o<32;++o)t[32+o]=u[32+o];var d=v2(t.subarray(32),r+32);for(tK(d),iK(c,d),nK(t,c),o=32;o<64;++o)t[o]=n[o];var p=v2(t,r+64);for(tK(p),o=32;o<64;++o)a[o]=0;for(o=0;o<32;++o)a[o]=d[o];for(o=0;o<32;++o)for(s=0;s<32;s++)a[o+s]+=p[o]*u[s];return ove(t.subarray(32),a),l}function w$e(t,e,r,n){var o,s,a=new ec(32),c=[Mt(),Mt(),Mt(),Mt()],u=[Mt(),Mt(),Mt(),Mt()];if(s=-1,r<64||R$e(u,n))return-1;for(o=0;o<r;++o)t[o]=e[o];for(o=0;o<32;++o)t[o+32]=n[o];var l=v2(t,r);if(tK(l),cve(c,u,l),iK(u,e.subarray(32)),rK(c,u),nK(a,c),r-=64,sve(e,0,a,0)){for(o=0;o<r;++o)t[o]=0;return-1}for(o=0;o<r;++o)t[o]=e[o+64];return s=r,s}function ove(t,e){var r,n,o,s;for(n=63;n>=32;--n){for(r=0,o=n-32,s=n-12;o<s;++o)e[o]+=r-16*e[n]*XW[o-(n-32)],r=e[o]+128>>8,e[o]-=r*256;e[o]+=r,e[n]=0}for(r=0,o=0;o<32;++o)e[o]+=r-(e[31]>>4)*XW[o],r=e[o]>>8,e[o]&=255;for(o=0;o<32;++o)e[o]-=r*XW[o];for(n=0;n<32;++n)e[n+1]+=e[n]>>8,t[n]=e[n]&255}function tK(t){for(var e=new Float64Array(64),r=0;r<64;++r)e[r]=t[r],t[r]=0;ove(t,e)}function rK(t,e){var r=Mt(),n=Mt(),o=Mt(),s=Mt(),a=Mt(),c=Mt(),u=Mt(),l=Mt(),d=Mt();DC(r,t[1],t[0]),DC(d,e[1],e[0]),wn(r,r,d),AC(n,t[0],t[1]),AC(d,e[0],e[1]),wn(n,n,d),wn(o,t[3],e[3]),wn(o,o,I$e),wn(s,t[2],e[2]),AC(s,s,s),DC(a,n,r),DC(c,s,o),AC(u,s,o),AC(l,n,r),wn(t[0],a,c),wn(t[1],l,u),wn(t[2],u,c),wn(t[3],a,l)}function rve(t,e,r){for(var n=0;n<4;++n)uve(t[n],e[n],r)}function nK(t,e){var r=Mt(),n=Mt(),o=Mt();D$e(o,e[2]),wn(r,e[0],o),wn(n,e[1],o),qM(t,n),t[31]^=ave(r)<<7}function qM(t,e){var r,n,o,s=Mt(),a=Mt();for(r=0;r<16;++r)a[r]=e[r];for(JW(a),JW(a),JW(a),n=0;n<2;++n){for(s[0]=a[0]-65517,r=1;r<15;++r)s[r]=a[r]-65535-(s[r-1]>>16&1),s[r-1]&=65535;s[15]=a[15]-32767-(s[14]>>16&1),o=s[15]>>16&1,s[14]&=65535,uve(a,s,1-o)}for(r=0;r<16;r++)t[2*r]=a[r]&255,t[2*r+1]=a[r]>>8}function R$e(t,e){var r=Mt(),n=Mt(),o=Mt(),s=Mt(),a=Mt(),c=Mt(),u=Mt();return jv(t[2],BM),k$e(t[1],e),Vy(o,t[1]),wn(s,o,S$e),DC(o,o,t[2]),AC(s,t[2],s),Vy(a,s),Vy(c,a),wn(u,c,a),wn(r,u,o),wn(r,r,s),P$e(r,r),wn(r,r,o),wn(r,r,s),wn(r,r,s),wn(t[0],r,s),Vy(n,t[0]),wn(n,n,s),nve(n,o)&&wn(t[0],t[0],C$e),Vy(n,t[0]),wn(n,n,s),nve(n,o)?-1:(ave(t[0])===e[31]>>7&&DC(t[0],eK,t[0]),wn(t[3],t[0],t[1]),0)}function k$e(t,e){var r;for(r=0;r<16;++r)t[r]=e[2*r]+(e[2*r+1]<<8);t[15]&=32767}function P$e(t,e){var r=Mt(),n;for(n=0;n<16;++n)r[n]=e[n];for(n=250;n>=0;--n)Vy(r,r),n!==1&&wn(r,r,e);for(n=0;n<16;++n)t[n]=r[n]}function nve(t,e){var r=new ec(32),n=new ec(32);return qM(r,t),qM(n,e),sve(r,0,n,0)}function sve(t,e,r,n){return A$e(t,e,r,n,32)}function A$e(t,e,r,n,o){var s,a=0;for(s=0;s<o;++s)a|=t[e+s]^r[n+s];return(1&a-1>>>8)-1}function ave(t){var e=new ec(32);return qM(e,t),e[0]&1}function cve(t,e,r){var n,o;for(jv(t[0],eK),jv(t[1],BM),jv(t[2],BM),jv(t[3],eK),o=255;o>=0;--o)n=r[o/8|0]>>(o&7)&1,rve(t,e,n),rK(e,t),rK(t,t),rve(t,e,n)}function iK(t,e){var r=[Mt(),Mt(),Mt(),Mt()];jv(r[0],eve),jv(r[1],tve),jv(r[2],BM),wn(r[3],eve,tve),cve(t,r,e)}function jv(t,e){var r;for(r=0;r<16;r++)t[r]=e[r]|0}function D$e(t,e){var r=Mt(),n;for(n=0;n<16;++n)r[n]=e[n];for(n=253;n>=0;--n)Vy(r,r),n!==2&&n!==4&&wn(r,r,e);for(n=0;n<16;++n)t[n]=r[n]}function JW(t){var e,r,n=1;for(e=0;e<16;++e)r=t[e]+n+65535,n=Math.floor(r/65536),t[e]=r-n*65536;t[0]+=n-1+37*(n-1)}function uve(t,e,r){for(var n,o=~(r-1),s=0;s<16;++s)n=o&(t[s]^e[s]),t[s]^=n,e[s]^=n}function Mt(t){var e,r=new Float64Array(16);if(t)for(e=0;e<t.length;++e)r[e]=t[e];return r}function AC(t,e,r){for(var n=0;n<16;++n)t[n]=e[n]+r[n]}function DC(t,e,r){for(var n=0;n<16;++n)t[n]=e[n]-r[n]}function Vy(t,e){wn(t,e,e)}function wn(t,e,r){var n,o,s=0,a=0,c=0,u=0,l=0,d=0,p=0,f=0,m=0,h=0,g=0,v=0,y=0,_=0,x=0,S=0,I=0,E=0,R=0,B=0,V=0,M=0,le=0,ne=0,q=0,P=0,k=0,U=0,F=0,$=0,ce=0,Y=r[0],j=r[1],xe=r[2],ee=r[3],vt=r[4],We=r[5],Lt=r[6],br=r[7],ye=r[8],lt=r[9],G=r[10],pe=r[11],me=r[12],Pe=r[13],Ie=r[14],bt=r[15];n=e[0],s+=n*Y,a+=n*j,c+=n*xe,u+=n*ee,l+=n*vt,d+=n*We,p+=n*Lt,f+=n*br,m+=n*ye,h+=n*lt,g+=n*G,v+=n*pe,y+=n*me,_+=n*Pe,x+=n*Ie,S+=n*bt,n=e[1],a+=n*Y,c+=n*j,u+=n*xe,l+=n*ee,d+=n*vt,p+=n*We,f+=n*Lt,m+=n*br,h+=n*ye,g+=n*lt,v+=n*G,y+=n*pe,_+=n*me,x+=n*Pe,S+=n*Ie,I+=n*bt,n=e[2],c+=n*Y,u+=n*j,l+=n*xe,d+=n*ee,p+=n*vt,f+=n*We,m+=n*Lt,h+=n*br,g+=n*ye,v+=n*lt,y+=n*G,_+=n*pe,x+=n*me,S+=n*Pe,I+=n*Ie,E+=n*bt,n=e[3],u+=n*Y,l+=n*j,d+=n*xe,p+=n*ee,f+=n*vt,m+=n*We,h+=n*Lt,g+=n*br,v+=n*ye,y+=n*lt,_+=n*G,x+=n*pe,S+=n*me,I+=n*Pe,E+=n*Ie,R+=n*bt,n=e[4],l+=n*Y,d+=n*j,p+=n*xe,f+=n*ee,m+=n*vt,h+=n*We,g+=n*Lt,v+=n*br,y+=n*ye,_+=n*lt,x+=n*G,S+=n*pe,I+=n*me,E+=n*Pe,R+=n*Ie,B+=n*bt,n=e[5],d+=n*Y,p+=n*j,f+=n*xe,m+=n*ee,h+=n*vt,g+=n*We,v+=n*Lt,y+=n*br,_+=n*ye,x+=n*lt,S+=n*G,I+=n*pe,E+=n*me,R+=n*Pe,B+=n*Ie,V+=n*bt,n=e[6],p+=n*Y,f+=n*j,m+=n*xe,h+=n*ee,g+=n*vt,v+=n*We,y+=n*Lt,_+=n*br,x+=n*ye,S+=n*lt,I+=n*G,E+=n*pe,R+=n*me,B+=n*Pe,V+=n*Ie,M+=n*bt,n=e[7],f+=n*Y,m+=n*j,h+=n*xe,g+=n*ee,v+=n*vt,y+=n*We,_+=n*Lt,x+=n*br,S+=n*ye,I+=n*lt,E+=n*G,R+=n*pe,B+=n*me,V+=n*Pe,M+=n*Ie,le+=n*bt,n=e[8],m+=n*Y,h+=n*j,g+=n*xe,v+=n*ee,y+=n*vt,_+=n*We,x+=n*Lt,S+=n*br,I+=n*ye,E+=n*lt,R+=n*G,B+=n*pe,V+=n*me,M+=n*Pe,le+=n*Ie,ne+=n*bt,n=e[9],h+=n*Y,g+=n*j,v+=n*xe,y+=n*ee,_+=n*vt,x+=n*We,S+=n*Lt,I+=n*br,E+=n*ye,R+=n*lt,B+=n*G,V+=n*pe,M+=n*me,le+=n*Pe,ne+=n*Ie,q+=n*bt,n=e[10],g+=n*Y,v+=n*j,y+=n*xe,_+=n*ee,x+=n*vt,S+=n*We,I+=n*Lt,E+=n*br,R+=n*ye,B+=n*lt,V+=n*G,M+=n*pe,le+=n*me,ne+=n*Pe,q+=n*Ie,P+=n*bt,n=e[11],v+=n*Y,y+=n*j,_+=n*xe,x+=n*ee,S+=n*vt,I+=n*We,E+=n*Lt,R+=n*br,B+=n*ye,V+=n*lt,M+=n*G,le+=n*pe,ne+=n*me,q+=n*Pe,P+=n*Ie,k+=n*bt,n=e[12],y+=n*Y,_+=n*j,x+=n*xe,S+=n*ee,I+=n*vt,E+=n*We,R+=n*Lt,B+=n*br,V+=n*ye,M+=n*lt,le+=n*G,ne+=n*pe,q+=n*me,P+=n*Pe,k+=n*Ie,U+=n*bt,n=e[13],_+=n*Y,x+=n*j,S+=n*xe,I+=n*ee,E+=n*vt,R+=n*We,B+=n*Lt,V+=n*br,M+=n*ye,le+=n*lt,ne+=n*G,q+=n*pe,P+=n*me,k+=n*Pe,U+=n*Ie,F+=n*bt,n=e[14],x+=n*Y,S+=n*j,I+=n*xe,E+=n*ee,R+=n*vt,B+=n*We,V+=n*Lt,M+=n*br,le+=n*ye,ne+=n*lt,q+=n*G,P+=n*pe,k+=n*me,U+=n*Pe,F+=n*Ie,$+=n*bt,n=e[15],S+=n*Y,I+=n*j,E+=n*xe,R+=n*ee,B+=n*vt,V+=n*We,M+=n*Lt,le+=n*br,ne+=n*ye,q+=n*lt,P+=n*G,k+=n*pe,U+=n*me,F+=n*Pe,$+=n*Ie,ce+=n*bt,s+=38*I,a+=38*E,c+=38*R,u+=38*B,l+=38*V,d+=38*M,p+=38*le,f+=38*ne,m+=38*q,h+=38*P,g+=38*k,v+=38*U,y+=38*F,_+=38*$,x+=38*ce,o=1,n=s+o+65535,o=Math.floor(n/65536),s=n-o*65536,n=a+o+65535,o=Math.floor(n/65536),a=n-o*65536,n=c+o+65535,o=Math.floor(n/65536),c=n-o*65536,n=u+o+65535,o=Math.floor(n/65536),u=n-o*65536,n=l+o+65535,o=Math.floor(n/65536),l=n-o*65536,n=d+o+65535,o=Math.floor(n/65536),d=n-o*65536,n=p+o+65535,o=Math.floor(n/65536),p=n-o*65536,n=f+o+65535,o=Math.floor(n/65536),f=n-o*65536,n=m+o+65535,o=Math.floor(n/65536),m=n-o*65536,n=h+o+65535,o=Math.floor(n/65536),h=n-o*65536,n=g+o+65535,o=Math.floor(n/65536),g=n-o*65536,n=v+o+65535,o=Math.floor(n/65536),v=n-o*65536,n=y+o+65535,o=Math.floor(n/65536),y=n-o*65536,n=_+o+65535,o=Math.floor(n/65536),_=n-o*65536,n=x+o+65535,o=Math.floor(n/65536),x=n-o*65536,n=S+o+65535,o=Math.floor(n/65536),S=n-o*65536,s+=o-1+37*(o-1),o=1,n=s+o+65535,o=Math.floor(n/65536),s=n-o*65536,n=a+o+65535,o=Math.floor(n/65536),a=n-o*65536,n=c+o+65535,o=Math.floor(n/65536),c=n-o*65536,n=u+o+65535,o=Math.floor(n/65536),u=n-o*65536,n=l+o+65535,o=Math.floor(n/65536),l=n-o*65536,n=d+o+65535,o=Math.floor(n/65536),d=n-o*65536,n=p+o+65535,o=Math.floor(n/65536),p=n-o*65536,n=f+o+65535,o=Math.floor(n/65536),f=n-o*65536,n=m+o+65535,o=Math.floor(n/65536),m=n-o*65536,n=h+o+65535,o=Math.floor(n/65536),h=n-o*65536,n=g+o+65535,o=Math.floor(n/65536),g=n-o*65536,n=v+o+65535,o=Math.floor(n/65536),v=n-o*65536,n=y+o+65535,o=Math.floor(n/65536),y=n-o*65536,n=_+o+65535,o=Math.floor(n/65536),_=n-o*65536,n=x+o+65535,o=Math.floor(n/65536),x=n-o*65536,n=S+o+65535,o=Math.floor(n/65536),S=n-o*65536,s+=o-1+37*(o-1),t[0]=s,t[1]=a,t[2]=c,t[3]=u,t[4]=l,t[5]=d,t[6]=p,t[7]=f,t[8]=m,t[9]=h,t[10]=g,t[11]=v,t[12]=y,t[13]=_,t[14]=x,t[15]=S}});var hve=O((Shr,mve)=>{var Hc=cr();$r();Ou();p2();mve.exports=Hc.kem=Hc.kem||{};var pve=Hc.jsbn.BigInteger;Hc.kem.rsa={};Hc.kem.rsa.create=function(t,e){e=e||{};var r=e.prng||Hc.random,n={};return n.encrypt=function(o,s){var a=Math.ceil(o.n.bitLength()/8),c;do c=new pve(Hc.util.bytesToHex(r.getBytesSync(a)),16).mod(o.n);while(c.compareTo(pve.ONE)<=0);c=Hc.util.hexToBytes(c.toString(16));var u=a-c.length;u>0&&(c=Hc.util.fillString("\0",u)+c);var l=o.encrypt(c,"NONE"),d=t.generate(c,s);return{encapsulation:l,key:d}},n.decrypt=function(o,s,a){var c=o.decrypt(s,"NONE");return t.generate(c,a)},n};Hc.kem.kdf1=function(t,e){fve(this,t,0,e||t.digestLength)};Hc.kem.kdf2=function(t,e){fve(this,t,1,e||t.digestLength)};function fve(t,e,r,n){t.generate=function(o,s){for(var a=new Hc.util.ByteBuffer,c=Math.ceil(s/n)+r,u=new Hc.util.ByteBuffer,l=r;l<c;++l){u.putInt32(l),e.start(),e.update(o+u.getBytes());var d=e.digest();a.putBytes(d.getBytes(n))}return a.truncate(a.length()-s),a.getBytes()}}});var yve=O((Ihr,bve)=>{var kr=cr();$r();bve.exports=kr.log=kr.log||{};kr.log.levels=["none","error","warning","info","debug","verbose","max"];var jM={},aK=[],y2=null;kr.log.LEVEL_LOCKED=2;kr.log.NO_LEVEL_CHECK=4;kr.log.INTERPOLATE=8;for(yp=0;yp<kr.log.levels.length;++yp)oK=kr.log.levels[yp],jM[oK]={index:yp,name:oK.toUpperCase()};var oK,yp;kr.log.logMessage=function(t){for(var e=jM[t.level].index,r=0;r<aK.length;++r){var n=aK[r];if(n.flags&kr.log.NO_LEVEL_CHECK)n.f(t);else{var o=jM[n.level].index;e<=o&&n.f(n,t)}}};kr.log.prepareStandard=function(t){"standard"in t||(t.standard=jM[t.level].name+" ["+t.category+"] "+t.message)};kr.log.prepareFull=function(t){if(!("full"in t)){var e=[t.message];e=e.concat([]),t.full=kr.util.format.apply(this,e)}};kr.log.prepareStandardFull=function(t){"standardFull"in t||(kr.log.prepareStandard(t),t.standardFull=t.standard)};for(sK=["error","warning","info","debug","verbose"],yp=0;yp<sK.length;++yp)(function(e){kr.log[e]=function(r,n){var o=Array.prototype.slice.call(arguments).slice(2),s={timestamp:new Date,level:e,category:r,message:n,arguments:o};kr.log.logMessage(s)}})(sK[yp]);var sK,yp;kr.log.makeLogger=function(t){var e={flags:0,f:t};return kr.log.setLevel(e,"none"),e};kr.log.setLevel=function(t,e){var r=!1;if(t&&!(t.flags&kr.log.LEVEL_LOCKED))for(var n=0;n<kr.log.levels.length;++n){var o=kr.log.levels[n];if(e==o){t.level=e,r=!0;break}}return r};kr.log.lock=function(t,e){typeof e>"u"||e?t.flags|=kr.log.LEVEL_LOCKED:t.flags&=~kr.log.LEVEL_LOCKED};kr.log.addLogger=function(t){aK.push(t)};typeof console<"u"&&"log"in console?(console.error&&console.warn&&console.info&&console.debug?(gve={error:console.error,warning:console.warn,info:console.info,debug:console.debug,verbose:console.debug},_2=function(t,e){kr.log.prepareStandard(e);var r=gve[e.level],n=[e.standard];n=n.concat(e.arguments.slice()),r.apply(console,n)},NC=kr.log.makeLogger(_2)):(_2=function(e,r){kr.log.prepareStandardFull(r),console.log(r.standardFull)},NC=kr.log.makeLogger(_2)),kr.log.setLevel(NC,"debug"),kr.log.addLogger(NC),y2=NC):console={log:function(){}};var NC,gve,_2;y2!==null&&typeof window<"u"&&window.location&&(b2=new URL(window.location.href).searchParams,b2.has("console.level")&&kr.log.setLevel(y2,b2.get("console.level").slice(-1)[0]),b2.has("console.lock")&&(vve=b2.get("console.lock").slice(-1)[0],vve=="true"&&kr.log.lock(y2)));var b2,vve;kr.log.consoleLogger=y2});var xve=O((Chr,_ve)=>{_ve.exports=dp();_M();EC();_W();YW()});var Cve=O((Thr,Ive)=>{var Je=cr();Nv();Ql();l2();Lv();My();LW();Ou();$r();LM();var J=Je.asn1,Ia=Ive.exports=Je.pkcs7=Je.pkcs7||{};Ia.messageFromPem=function(t){var e=Je.pem.decode(t)[0];if(e.type!=="PKCS7"){var r=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw r.headerType=e.type,r}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var n=J.fromDer(e.body);return Ia.messageFromAsn1(n)};Ia.messageToPem=function(t,e){var r={type:"PKCS7",body:J.toDer(t.toAsn1()).getBytes()};return Je.pem.encode(r,{maxline:e})};Ia.messageFromAsn1=function(t){var e={},r=[];if(!J.validate(t,Ia.asn1.contentInfoValidator,e,r)){var n=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw n.errors=r,n}var o=J.derToOid(e.contentType),s;switch(o){case Je.pki.oids.envelopedData:s=Ia.createEnvelopedData();break;case Je.pki.oids.encryptedData:s=Ia.createEncryptedData();break;case Je.pki.oids.signedData:s=Ia.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+o+" is not (yet) supported.")}return s.fromAsn1(e.content.value[0]),s};Ia.createSignedData=function(){var t=null;return t={type:Je.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(n){if(uK(t,n,Ia.asn1.signedDataValidator),t.certificates=[],t.crls=[],t.digestAlgorithmIdentifiers=[],t.contentInfo=null,t.signerInfos=[],t.rawCapture.certificates)for(var o=t.rawCapture.certificates.value,s=0;s<o.length;++s)t.certificates.push(Je.pki.certificateFromAsn1(o[s]))},toAsn1:function(){t.contentInfo||t.sign();for(var n=[],o=0;o<t.certificates.length;++o)n.push(Je.pki.certificateToAsn1(t.certificates[o]));var s=[],a=J.create(J.Class.CONTEXT_SPECIFIC,0,!0,[J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,J.integerToDer(t.version).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.SET,!0,t.digestAlgorithmIdentifiers),t.contentInfo])]);return n.length>0&&a.value[0].value.push(J.create(J.Class.CONTEXT_SPECIFIC,0,!0,n)),s.length>0&&a.value[0].value.push(J.create(J.Class.CONTEXT_SPECIFIC,1,!0,s)),a.value[0].value.push(J.create(J.Class.UNIVERSAL,J.Type.SET,!0,t.signerInfos)),J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.OID,!1,J.oidToDer(t.type).getBytes()),a])},addSigner:function(n){var o=n.issuer,s=n.serialNumber;if(n.certificate){var a=n.certificate;typeof a=="string"&&(a=Je.pki.certificateFromPem(a)),o=a.issuer.attributes,s=a.serialNumber}var c=n.key;if(!c)throw new Error("Could not add PKCS#7 signer; no private key specified.");typeof c=="string"&&(c=Je.pki.privateKeyFromPem(c));var u=n.digestAlgorithm||Je.pki.oids.sha1;switch(u){case Je.pki.oids.sha1:case Je.pki.oids.sha256:case Je.pki.oids.sha384:case Je.pki.oids.sha512:case Je.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+u)}var l=n.authenticatedAttributes||[];if(l.length>0){for(var d=!1,p=!1,f=0;f<l.length;++f){var m=l[f];if(!d&&m.type===Je.pki.oids.contentType){if(d=!0,p)break;continue}if(!p&&m.type===Je.pki.oids.messageDigest){if(p=!0,d)break;continue}}if(!d||!p)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}t.signers.push({key:c,version:1,issuer:o,serialNumber:s,digestAlgorithm:u,signatureAlgorithm:Je.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:l,unauthenticatedAttributes:[]})},sign:function(n){if(n=n||{},(typeof t.content!="object"||t.contentInfo===null)&&(t.contentInfo=J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.OID,!1,J.oidToDer(Je.pki.oids.data).getBytes())]),"content"in t)){var o;t.content instanceof Je.util.ByteBuffer?o=t.content.bytes():typeof t.content=="string"&&(o=Je.util.encodeUtf8(t.content)),n.detached?t.detachedContent=J.create(J.Class.UNIVERSAL,J.Type.OCTETSTRING,!1,o):t.contentInfo.value.push(J.create(J.Class.CONTEXT_SPECIFIC,0,!0,[J.create(J.Class.UNIVERSAL,J.Type.OCTETSTRING,!1,o)]))}if(t.signers.length!==0){var s=e();r(s)}},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(n){typeof n=="string"&&(n=Je.pki.certificateFromPem(n)),t.certificates.push(n)},addCertificateRevokationList:function(n){throw new Error("PKCS#7 CRL support not yet implemented.")}},t;function e(){for(var n={},o=0;o<t.signers.length;++o){var s=t.signers[o],a=s.digestAlgorithm;a in n||(n[a]=Je.md[Je.pki.oids[a]].create()),s.authenticatedAttributes.length===0?s.md=n[a]:s.md=Je.md[Je.pki.oids[a]].create()}t.digestAlgorithmIdentifiers=[];for(var a in n)t.digestAlgorithmIdentifiers.push(J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.OID,!1,J.oidToDer(a).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.NULL,!1,"")]));return n}function r(n){var o;if(t.detachedContent?o=t.detachedContent:(o=t.contentInfo.value[1],o=o.value[0]),!o)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var s=J.derToOid(t.contentInfo.value[0].value),a=J.toDer(o);a.getByte(),J.getBerValueLength(a),a=a.getBytes();for(var c in n)n[c].start().update(a);for(var u=new Date,l=0;l<t.signers.length;++l){var d=t.signers[l];if(d.authenticatedAttributes.length===0){if(s!==Je.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{d.authenticatedAttributesAsn1=J.create(J.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var p=J.create(J.Class.UNIVERSAL,J.Type.SET,!0,[]),f=0;f<d.authenticatedAttributes.length;++f){var m=d.authenticatedAttributes[f];m.type===Je.pki.oids.messageDigest?m.value=n[d.digestAlgorithm].digest():m.type===Je.pki.oids.signingTime&&(m.value||(m.value=u)),p.value.push(cK(m)),d.authenticatedAttributesAsn1.value.push(cK(m))}a=J.toDer(p).getBytes(),d.md.start().update(a)}d.signature=d.key.sign(d.md,"RSASSA-PKCS1-V1_5")}t.signerInfos=U$e(t.signers)}};Ia.createEncryptedData=function(){var t=null;return t={type:Je.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:Je.pki.oids["aes256-CBC"]},fromAsn1:function(e){uK(t,e,Ia.asn1.encryptedDataValidator)},decrypt:function(e){e!==void 0&&(t.encryptedContent.key=e),Sve(t)}},t};Ia.createEnvelopedData=function(){var t=null;return t={type:Je.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:Je.pki.oids["aes256-CBC"]},fromAsn1:function(e){var r=uK(t,e,Ia.asn1.envelopedDataValidator);t.recipients=O$e(r.recipientInfos.value)},toAsn1:function(){return J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.OID,!1,J.oidToDer(t.type).getBytes()),J.create(J.Class.CONTEXT_SPECIFIC,0,!0,[J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,J.integerToDer(t.version).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.SET,!0,M$e(t.recipients)),J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,B$e(t.encryptedContent))])])])},findRecipient:function(e){for(var r=e.issuer.attributes,n=0;n<t.recipients.length;++n){var o=t.recipients[n],s=o.issuer;if(o.serialNumber===e.serialNumber&&s.length===r.length){for(var a=!0,c=0;c<r.length;++c)if(s[c].type!==r[c].type||s[c].value!==r[c].value){a=!1;break}if(a)return o}}return null},decrypt:function(e,r){if(t.encryptedContent.key===void 0&&e!==void 0&&r!==void 0)switch(e.encryptedContent.algorithm){case Je.pki.oids.rsaEncryption:case Je.pki.oids.desCBC:var n=r.decrypt(e.encryptedContent.content);t.encryptedContent.key=Je.util.createBuffer(n);break;default:throw new Error("Unsupported asymmetric cipher, OID "+e.encryptedContent.algorithm)}Sve(t)},addRecipient:function(e){t.recipients.push({version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,encryptedContent:{algorithm:Je.pki.oids.rsaEncryption,key:e.publicKey}})},encrypt:function(e,r){if(t.encryptedContent.content===void 0){r=r||t.encryptedContent.algorithm,e=e||t.encryptedContent.key;var n,o,s;switch(r){case Je.pki.oids["aes128-CBC"]:n=16,o=16,s=Je.aes.createEncryptionCipher;break;case Je.pki.oids["aes192-CBC"]:n=24,o=16,s=Je.aes.createEncryptionCipher;break;case Je.pki.oids["aes256-CBC"]:n=32,o=16,s=Je.aes.createEncryptionCipher;break;case Je.pki.oids["des-EDE3-CBC"]:n=24,o=8,s=Je.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+r)}if(e===void 0)e=Je.util.createBuffer(Je.random.getBytes(n));else if(e.length()!=n)throw new Error("Symmetric key has wrong length; got "+e.length()+" bytes, expected "+n+".");t.encryptedContent.algorithm=r,t.encryptedContent.key=e,t.encryptedContent.parameter=Je.util.createBuffer(Je.random.getBytes(o));var a=s(e);if(a.start(t.encryptedContent.parameter.copy()),a.update(t.content),!a.finish())throw new Error("Symmetric encryption failed.");t.encryptedContent.content=a.output}for(var c=0;c<t.recipients.length;++c){var u=t.recipients[c];if(u.encryptedContent.content===void 0)switch(u.encryptedContent.algorithm){case Je.pki.oids.rsaEncryption:u.encryptedContent.content=u.encryptedContent.key.encrypt(t.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+u.encryptedContent.algorithm)}}}},t};function N$e(t){var e={},r=[];if(!J.validate(t,Ia.asn1.recipientInfoValidator,e,r)){var n=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw n.errors=r,n}return{version:e.version.charCodeAt(0),issuer:Je.pki.RDNAttributesAsArray(e.issuer),serialNumber:Je.util.createBuffer(e.serial).toHex(),encryptedContent:{algorithm:J.derToOid(e.encAlgorithm),parameter:e.encParameter?e.encParameter.value:void 0,content:e.encKey}}}function L$e(t){return J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,J.integerToDer(t.version).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[Je.pki.distinguishedNameToAsn1({attributes:t.issuer}),J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,Je.util.hexToBytes(t.serialNumber))]),J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.OID,!1,J.oidToDer(t.encryptedContent.algorithm).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.NULL,!1,"")]),J.create(J.Class.UNIVERSAL,J.Type.OCTETSTRING,!1,t.encryptedContent.content)])}function O$e(t){for(var e=[],r=0;r<t.length;++r)e.push(N$e(t[r]));return e}function M$e(t){for(var e=[],r=0;r<t.length;++r)e.push(L$e(t[r]));return e}function F$e(t){var e=J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,J.integerToDer(t.version).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[Je.pki.distinguishedNameToAsn1({attributes:t.issuer}),J.create(J.Class.UNIVERSAL,J.Type.INTEGER,!1,Je.util.hexToBytes(t.serialNumber))]),J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.OID,!1,J.oidToDer(t.digestAlgorithm).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.NULL,!1,"")])]);if(t.authenticatedAttributesAsn1&&e.value.push(t.authenticatedAttributesAsn1),e.value.push(J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.OID,!1,J.oidToDer(t.signatureAlgorithm).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.NULL,!1,"")])),e.value.push(J.create(J.Class.UNIVERSAL,J.Type.OCTETSTRING,!1,t.signature)),t.unauthenticatedAttributes.length>0){for(var r=J.create(J.Class.CONTEXT_SPECIFIC,1,!0,[]),n=0;n<t.unauthenticatedAttributes.length;++n){var o=t.unauthenticatedAttributes[n];r.values.push(cK(o))}e.value.push(r)}return e}function U$e(t){for(var e=[],r=0;r<t.length;++r)e.push(F$e(t[r]));return e}function cK(t){var e;if(t.type===Je.pki.oids.contentType)e=J.create(J.Class.UNIVERSAL,J.Type.OID,!1,J.oidToDer(t.value).getBytes());else if(t.type===Je.pki.oids.messageDigest)e=J.create(J.Class.UNIVERSAL,J.Type.OCTETSTRING,!1,t.value.bytes());else if(t.type===Je.pki.oids.signingTime){var r=new Date("1950-01-01T00:00:00Z"),n=new Date("2050-01-01T00:00:00Z"),o=t.value;if(typeof o=="string"){var s=Date.parse(o);isNaN(s)?o.length===13?o=J.utcTimeToDate(o):o=J.generalizedTimeToDate(o):o=new Date(s)}o>=r&&o<n?e=J.create(J.Class.UNIVERSAL,J.Type.UTCTIME,!1,J.dateToUtcTime(o)):e=J.create(J.Class.UNIVERSAL,J.Type.GENERALIZEDTIME,!1,J.dateToGeneralizedTime(o))}return J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.OID,!1,J.oidToDer(t.type).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.SET,!0,[e])])}function B$e(t){return[J.create(J.Class.UNIVERSAL,J.Type.OID,!1,J.oidToDer(Je.pki.oids.data).getBytes()),J.create(J.Class.UNIVERSAL,J.Type.SEQUENCE,!0,[J.create(J.Class.UNIVERSAL,J.Type.OID,!1,J.oidToDer(t.algorithm).getBytes()),t.parameter?J.create(J.Class.UNIVERSAL,J.Type.OCTETSTRING,!1,t.parameter.getBytes()):void 0]),J.create(J.Class.CONTEXT_SPECIFIC,0,!0,[J.create(J.Class.UNIVERSAL,J.Type.OCTETSTRING,!1,t.content.getBytes())])]}function uK(t,e,r){var n={},o=[];if(!J.validate(e,r,n,o)){var s=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw s.errors=s,s}var a=J.derToOid(n.contentType);if(a!==Je.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(n.encryptedContent){var c="";if(Je.util.isArray(n.encryptedContent))for(var u=0;u<n.encryptedContent.length;++u){if(n.encryptedContent[u].type!==J.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");c+=n.encryptedContent[u].value}else c=n.encryptedContent;t.encryptedContent={algorithm:J.derToOid(n.encAlgorithm),parameter:Je.util.createBuffer(n.encParameter.value),content:Je.util.createBuffer(c)}}if(n.content){var c="";if(Je.util.isArray(n.content))for(var u=0;u<n.content.length;++u){if(n.content[u].type!==J.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");c+=n.content[u].value}else c=n.content;t.content=Je.util.createBuffer(c)}return t.version=n.version.charCodeAt(0),t.rawCapture=n,n}function Sve(t){if(t.encryptedContent.key===void 0)throw new Error("Symmetric key not available.");if(t.content===void 0){var e;switch(t.encryptedContent.algorithm){case Je.pki.oids["aes128-CBC"]:case Je.pki.oids["aes192-CBC"]:case Je.pki.oids["aes256-CBC"]:e=Je.aes.createDecryptionCipher(t.encryptedContent.key);break;case Je.pki.oids.desCBC:case Je.pki.oids["des-EDE3-CBC"]:e=Je.des.createDecryptionCipher(t.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+t.encryptedContent.algorithm)}if(e.start(t.encryptedContent.parameter),e.update(t.encryptedContent.content),!e.finish())throw new Error("Symmetric decryption failed.");t.content=e.output}}});var Eve=O((Ehr,Tve)=>{var ao=cr();Nv();SC();_M();EC();$r();var VM=Tve.exports=ao.ssh=ao.ssh||{};VM.privateKeyToPutty=function(t,e,r){r=r||"",e=e||"";var n="ssh-rsa",o=e===""?"none":"aes256-cbc",s="PuTTY-User-Key-File-2: "+n+`\r
`;s+="Encryption: "+o+`\r
`,s+="Comment: "+r+`\r
`;var a=ao.util.createBuffer();LC(a,n),_p(a,t.e),_p(a,t.n);var c=ao.util.encode64(a.bytes(),64),u=Math.floor(c.length/66)+1;s+="Public-Lines: "+u+`\r
`,s+=c;var l=ao.util.createBuffer();_p(l,t.d),_p(l,t.p),_p(l,t.q),_p(l,t.qInv);var d;if(!e)d=ao.util.encode64(l.bytes(),64);else{var p=l.length()+16-1;p-=p%16;var f=HM(l.bytes());f.truncate(f.length()-p+l.length()),l.putBuffer(f);var m=ao.util.createBuffer();m.putBuffer(HM("\0\0\0\0",e)),m.putBuffer(HM("\0\0\0",e));var h=ao.aes.createEncryptionCipher(m.truncate(8),"CBC");h.start(ao.util.createBuffer().fillWithByte(0,16)),h.update(l.copy()),h.finish();var g=h.output;g.truncate(16),d=ao.util.encode64(g.bytes(),64)}u=Math.floor(d.length/66)+1,s+=`\r
Private-Lines: `+u+`\r
`,s+=d;var v=HM("putty-private-key-file-mac-key",e),y=ao.util.createBuffer();LC(y,n),LC(y,o),LC(y,r),y.putInt32(a.length()),y.putBuffer(a),y.putInt32(l.length()),y.putBuffer(l);var _=ao.hmac.create();return _.start("sha1",v),_.update(y.bytes()),s+=`\r
Private-MAC: `+_.digest().toHex()+`\r
`,s};VM.publicKeyToOpenSSH=function(t,e){var r="ssh-rsa";e=e||"";var n=ao.util.createBuffer();return LC(n,r),_p(n,t.e),_p(n,t.n),r+" "+ao.util.encode64(n.bytes())+" "+e};VM.privateKeyToOpenSSH=function(t,e){return e?ao.pki.encryptRsaPrivateKey(t,e,{legacy:!0,algorithm:"aes128"}):ao.pki.privateKeyToPem(t)};VM.getPublicKeyFingerprint=function(t,e){e=e||{};var r=e.md||ao.md.md5.create(),n="ssh-rsa",o=ao.util.createBuffer();LC(o,n),_p(o,t.e),_p(o,t.n),r.start(),r.update(o.getBytes());var s=r.digest();if(e.encoding==="hex"){var a=s.toHex();return e.delimiter?a.match(/.{2}/g).join(e.delimiter):a}else{if(e.encoding==="binary")return s.getBytes();if(e.encoding)throw new Error('Unknown encoding "'+e.encoding+'".')}return s};function _p(t,e){var r=e.toString(16);r[0]>="8"&&(r="00"+r);var n=ao.util.hexToBytes(r);t.putInt32(n.length),t.putBytes(n)}function LC(t,e){t.putInt32(e.length),t.putString(e)}function HM(){for(var t=ao.md.sha1.create(),e=arguments.length,r=0;r<e;++r)t.update(arguments[r]);return t.digest()}});var Rve=O((whr,wve)=>{wve.exports=cr();Nv();Wge();Ql();fM();l2();dve();SC();hve();yve();xve();OW();CM();My();kW();UW();Cve();qW();AW();xW();AM();Ou();CW();Eve();$W();$r()});var kve=O((Rhr,q$e)=>{q$e.exports={name:"@roamhq/mac-ca",version:"1.0.7",description:"Get Mac OS Root certificates",main:"index.js",repository:{type:"git",url:"https://github.com/WonderInventions/mac-ca.git"},scripts:{test:'echo "Error: no test specified" && exit 1',lint:"eslint ."},license:"BSD-3-Clause",dependencies:{"node-forge":"^1.3.1"},devDependencies:{eslint:"^8.22.0"}}});var Dve=O((khr,lK)=>{var zM=Rve(),Pve=kve(),GM=lK.exports.validFormats={der:0,pem:1,txt:2,asn1:3};function Ave(t){let e=zM.pki.pemToDer(t),r=zM.asn1,n=r.fromDer(e.data.toString("binary")).value[0].value,o=n[0],s=o.tagClass===r.Class.CONTEXT_SPECIFIC&&o.type===0&&o.constructed,a=n.slice(s);return{serial:a[0],issuer:a[2],valid:a[3],subject:a[4]}}function j$e(t){let e=Ave(t),r=new Date,n=e.subject.value.map(a=>a.value[0].value[1].value).join("/"),o=e.valid.value.map(a=>a.value).join(" - "),s=r.toTimeString().replace(/\s*\(.*\)\s*/,"");return[`Subject	${n}`,`Valid	${o}`,`Saved	${r.toLocaleDateString()} ${s} by ${Pve.name}@${Pve.version}`,String(t)].join(`
`)}lK.exports.transform=function(t){return function(e){try{switch(t){case GM.der:return zM.pki.pemToDer(e);case GM.pem:return e;case GM.txt:return j$e(e);case GM.asn1:return Ave(e);default:return zM.pki.certificateFromPem(e)}}catch{return}}}});var Nve=O((Phr,OC)=>{var dK=require("https"),pK=Dve();if(process.platform!=="darwin")OC.exports.all=()=>[],OC.exports.each=()=>{};else{let c=function(l,d,p){return p.indexOf(l)===d};H$e=c;let t=require("child_process"),e=/(?=-----BEGIN\sCERTIFICATE-----)/g,r="/System/Library/Keychains/SystemRootCertificates.keychain",n=["find-certificate","-a","-p"],o=t.spawnSync("/usr/bin/security",n).stdout.toString().split(e),s=t.spawnSync("/usr/bin/security",n.concat(r)).stdout.toString().split(e);dK.globalAgent.options.ca=dK.globalAgent.options.ca||[];let a=dK.globalAgent.options.ca,u=o.concat(s);u.filter(c).forEach(l=>a.push(l)),OC.exports.der2=pK.validFormats,OC.exports.all=function(l){return u.map(pK.transform(l)).filter(d=>d)},OC.exports.each=function(l,d){return typeof l=="function"&&(d=l,l=void 0),u.map(pK.transform(l)).filter(p=>p).forEach(d)}}var H$e});var $v=O((exports,module)=>{var Module=Module!==void 0?Module:{},TreeSitter=function(){var initPromise,document=typeof window=="object"?{currentScript:window.document.currentScript}:null;class Parser{constructor(){this.initialize()}initialize(){throw new Error("cannot construct a Parser before calling `init()`")}static init(moduleOptions){return initPromise||(Module=Object.assign({},Module,moduleOptions),initPromise=new Promise(resolveInitPromise=>{var moduleOverrides=Object.assign({},Module),arguments_=[],thisProgram="./this.program",quit_=(t,e)=>{throw e},ENVIRONMENT_IS_WEB=typeof window=="object",ENVIRONMENT_IS_WORKER=typeof importScripts=="function",ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",scriptDirectory="",read_,readAsync,readBinary;function locateFile(t){return Module.locateFile?Module.locateFile(t,scriptDirectory):scriptDirectory+t}if(ENVIRONMENT_IS_NODE){var fs=require("fs"),nodePath=require("path");scriptDirectory=ENVIRONMENT_IS_WORKER?nodePath.dirname(scriptDirectory)+"/":__dirname+"/",read_=(t,e)=>(t=isFileURI(t)?new URL(t):nodePath.normalize(t),fs.readFileSync(t,e?void 0:"utf8")),readBinary=t=>{var e=read_(t,!0);return e.buffer||(e=new Uint8Array(e)),e},readAsync=(t,e,r,n=!0)=>{t=isFileURI(t)?new URL(t):nodePath.normalize(t),fs.readFile(t,n?void 0:"utf8",(o,s)=>{o?r(o):e(n?s.buffer:s)})},!Module.thisProgram&&process.argv.length>1&&(thisProgram=process.argv[1].replace(/\\/g,"/")),arguments_=process.argv.slice(2),typeof module<"u"&&(module.exports=Module),quit_=(t,e)=>{throw process.exitCode=t,e}}else(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&(ENVIRONMENT_IS_WORKER?scriptDirectory=self.location.href:document!==void 0&&document.currentScript&&(scriptDirectory=document.currentScript.src),scriptDirectory=scriptDirectory.startsWith("blob:")?"":scriptDirectory.substr(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1),read_=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},ENVIRONMENT_IS_WORKER&&(readBinary=t=>{var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),readAsync=(t,e,r)=>{var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=()=>{n.status==200||n.status==0&&n.response?e(n.response):r()},n.onerror=r,n.send(null)});var out=Module.print||console.log.bind(console),err=Module.printErr||console.error.bind(console);Object.assign(Module,moduleOverrides),moduleOverrides=null,Module.arguments&&(arguments_=Module.arguments),Module.thisProgram&&(thisProgram=Module.thisProgram),Module.quit&&(quit_=Module.quit);var dynamicLibraries=Module.dynamicLibraries||[],wasmBinary,wasmMemory;Module.wasmBinary&&(wasmBinary=Module.wasmBinary),typeof WebAssembly!="object"&&abort("no native wasm support detected");var ABORT=!1,EXITSTATUS,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64;function updateMemoryViews(){var t=wasmMemory.buffer;Module.HEAP8=HEAP8=new Int8Array(t),Module.HEAP16=HEAP16=new Int16Array(t),Module.HEAPU8=HEAPU8=new Uint8Array(t),Module.HEAPU16=HEAPU16=new Uint16Array(t),Module.HEAP32=HEAP32=new Int32Array(t),Module.HEAPU32=HEAPU32=new Uint32Array(t),Module.HEAPF32=HEAPF32=new Float32Array(t),Module.HEAPF64=HEAPF64=new Float64Array(t)}var INITIAL_MEMORY=Module.INITIAL_MEMORY||33554432;wasmMemory=Module.wasmMemory?Module.wasmMemory:new WebAssembly.Memory({initial:INITIAL_MEMORY/65536,maximum:32768}),updateMemoryViews(),INITIAL_MEMORY=wasmMemory.buffer.byteLength;var __ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATPOSTRUN__=[],__RELOC_FUNCS__=[],runtimeInitialized=!1;function preRun(){if(Module.preRun)for(typeof Module.preRun=="function"&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function initRuntime(){runtimeInitialized=!0,callRuntimeCallbacks(__RELOC_FUNCS__),callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function postRun(){if(Module.postRun)for(typeof Module.postRun=="function"&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(t){__ATPRERUN__.unshift(t)}function addOnInit(t){__ATINIT__.unshift(t)}function addOnPostRun(t){__ATPOSTRUN__.unshift(t)}var runDependencies=0,runDependencyWatcher=null,dependenciesFulfilled=null;function getUniqueRunDependency(t){return t}function addRunDependency(t){runDependencies++,Module.monitorRunDependencies?.(runDependencies)}function removeRunDependency(t){if(runDependencies--,Module.monitorRunDependencies?.(runDependencies),runDependencies==0&&(runDependencyWatcher!==null&&(clearInterval(runDependencyWatcher),runDependencyWatcher=null),dependenciesFulfilled)){var e=dependenciesFulfilled;dependenciesFulfilled=null,e()}}function abort(t){throw Module.onAbort?.(t),err(t="Aborted("+t+")"),ABORT=!0,EXITSTATUS=1,t+=". Build with -sASSERTIONS for more info.",new WebAssembly.RuntimeError(t)}var dataURIPrefix="data:application/octet-stream;base64,",isDataURI=t=>t.startsWith(dataURIPrefix),isFileURI=t=>t.startsWith("file://"),wasmBinaryFile;function getBinarySync(t){if(t==wasmBinaryFile&&wasmBinary)return new Uint8Array(wasmBinary);if(readBinary)return readBinary(t);throw"both async and sync fetching of the wasm failed"}function getBinaryPromise(t){if(!wasmBinary&&(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)){if(typeof fetch=="function"&&!isFileURI(t))return fetch(t,{credentials:"same-origin"}).then(e=>{if(!e.ok)throw`failed to load wasm binary file at '${t}'`;return e.arrayBuffer()}).catch(()=>getBinarySync(t));if(readAsync)return new Promise((e,r)=>{readAsync(t,n=>e(new Uint8Array(n)),r)})}return Promise.resolve().then(()=>getBinarySync(t))}function instantiateArrayBuffer(t,e,r){return getBinaryPromise(t).then(n=>WebAssembly.instantiate(n,e)).then(r,n=>{err(`failed to asynchronously prepare wasm: ${n}`),abort(n)})}function instantiateAsync(t,e,r,n){return t||typeof WebAssembly.instantiateStreaming!="function"||isDataURI(e)||isFileURI(e)||ENVIRONMENT_IS_NODE||typeof fetch!="function"?instantiateArrayBuffer(e,r,n):fetch(e,{credentials:"same-origin"}).then(o=>WebAssembly.instantiateStreaming(o,r).then(n,function(s){return err(`wasm streaming compile failed: ${s}`),err("falling back to ArrayBuffer instantiation"),instantiateArrayBuffer(e,r,n)}))}function createWasm(){var t={env:wasmImports,wasi_snapshot_preview1:wasmImports,"GOT.mem":new Proxy(wasmImports,GOTHandler),"GOT.func":new Proxy(wasmImports,GOTHandler)};function e(r,n){wasmExports=r.exports,wasmExports=relocateExports(wasmExports,1024);var o=getDylinkMetadata(n);return o.neededDynlibs&&(dynamicLibraries=o.neededDynlibs.concat(dynamicLibraries)),mergeLibSymbols(wasmExports,"main"),LDSO.init(),loadDylibs(),addOnInit(wasmExports.__wasm_call_ctors),__RELOC_FUNCS__.push(wasmExports.__wasm_apply_data_relocs),removeRunDependency("wasm-instantiate"),wasmExports}if(addRunDependency("wasm-instantiate"),Module.instantiateWasm)try{return Module.instantiateWasm(t,e)}catch(r){return err(`Module.instantiateWasm callback failed with error: ${r}`),!1}return instantiateAsync(wasmBinary,wasmBinaryFile,t,function(r){e(r.instance,r.module)}),{}}wasmBinaryFile="tree-sitter.wasm",isDataURI(wasmBinaryFile)||(wasmBinaryFile=locateFile(wasmBinaryFile));var ASM_CONSTS={};function ExitStatus(t){this.name="ExitStatus",this.message=`Program terminated with exit(${t})`,this.status=t}var GOT={},currentModuleWeakSymbols=new Set([]),GOTHandler={get(t,e){var r=GOT[e];return r||(r=GOT[e]=new WebAssembly.Global({value:"i32",mutable:!0})),currentModuleWeakSymbols.has(e)||(r.required=!0),r}},callRuntimeCallbacks=t=>{for(;t.length>0;)t.shift()(Module)},UTF8Decoder=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,UTF8ArrayToString=(t,e,r)=>{for(var n=e+r,o=e;t[o]&&!(o>=n);)++o;if(o-e>16&&t.buffer&&UTF8Decoder)return UTF8Decoder.decode(t.subarray(e,o));for(var s="";e<o;){var a=t[e++];if(128&a){var c=63&t[e++];if((224&a)!=192){var u=63&t[e++];if((a=(240&a)==224?(15&a)<<12|c<<6|u:(7&a)<<18|c<<12|u<<6|63&t[e++])<65536)s+=String.fromCharCode(a);else{var l=a-65536;s+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else s+=String.fromCharCode((31&a)<<6|c)}else s+=String.fromCharCode(a)}return s},getDylinkMetadata=t=>{var e=0,r=0;function n(){for(var y=0,_=1;;){var x=t[e++];if(y+=(127&x)*_,_*=128,!(128&x))break}return y}function o(){var y=n();return UTF8ArrayToString(t,(e+=y)-y,y)}function s(y,_){if(y)throw new Error(_)}var a="dylink.0";if(t instanceof WebAssembly.Module){var c=WebAssembly.Module.customSections(t,a);c.length===0&&(a="dylink",c=WebAssembly.Module.customSections(t,a)),s(c.length===0,"need dylink section"),r=(t=new Uint8Array(c[0])).length}else{s(new Uint32Array(new Uint8Array(t.subarray(0,24)).buffer)[0]!=1836278016,"need to see wasm magic number"),s(t[8]!==0,"need the dylink section to be first"),e=9;var u=n();r=e+u,a=o()}var l={neededDynlibs:[],tlsExports:new Set,weakImports:new Set};if(a=="dylink"){l.memorySize=n(),l.memoryAlign=n(),l.tableSize=n(),l.tableAlign=n();for(var d=n(),p=0;p<d;++p){var f=o();l.neededDynlibs.push(f)}}else for(s(a!=="dylink.0");e<r;){var m=t[e++],h=n();if(m===1)l.memorySize=n(),l.memoryAlign=n(),l.tableSize=n(),l.tableAlign=n();else if(m===2)for(d=n(),p=0;p<d;++p)f=o(),l.neededDynlibs.push(f);else if(m===3)for(var g=n();g--;){var v=o();256&n()&&l.tlsExports.add(v)}else if(m===4)for(g=n();g--;)o(),v=o(),(3&n())==1&&l.weakImports.add(v);else e+=h}return l};function getValue(t,e="i8"){switch(e.endsWith("*")&&(e="*"),e){case"i1":case"i8":return HEAP8[t];case"i16":return HEAP16[t>>1];case"i32":return HEAP32[t>>2];case"i64":abort("to do getValue(i64) use WASM_BIGINT");case"float":return HEAPF32[t>>2];case"double":return HEAPF64[t>>3];case"*":return HEAPU32[t>>2];default:abort(`invalid type for getValue: ${e}`)}}var newDSO=(t,e,r)=>{var n={refcount:1/0,name:t,exports:r,global:!0};return LDSO.loadedLibsByName[t]=n,e!=null&&(LDSO.loadedLibsByHandle[e]=n),n},LDSO={loadedLibsByName:{},loadedLibsByHandle:{},init(){newDSO("__main__",0,wasmImports)}},___heap_base=78096,zeroMemory=(t,e)=>(HEAPU8.fill(0,t,t+e),t),alignMemory=(t,e)=>Math.ceil(t/e)*e,getMemory=t=>{if(runtimeInitialized)return zeroMemory(_malloc(t),t);var e=___heap_base,r=e+alignMemory(t,16);return ___heap_base=r,GOT.__heap_base.value=r,e},isInternalSym=t=>["__cpp_exception","__c_longjmp","__wasm_apply_data_relocs","__dso_handle","__tls_size","__tls_align","__set_stack_limits","_emscripten_tls_init","__wasm_init_tls","__wasm_call_ctors","__start_em_asm","__stop_em_asm","__start_em_js","__stop_em_js"].includes(t)||t.startsWith("__em_js__"),uleb128Encode=(t,e)=>{t<128?e.push(t):e.push(t%128|128,t>>7)},sigToWasmTypes=t=>{for(var e={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},r={parameters:[],results:t[0]=="v"?[]:[e[t[0]]]},n=1;n<t.length;++n)r.parameters.push(e[t[n]]);return r},generateFuncType=(t,e)=>{var r=t.slice(0,1),n=t.slice(1),o={i:127,p:127,j:126,f:125,d:124,e:111};e.push(96),uleb128Encode(n.length,e);for(var s=0;s<n.length;++s)e.push(o[n[s]]);r=="v"?e.push(0):e.push(1,o[r])},convertJsFunctionToWasm=(t,e)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(sigToWasmTypes(e),t);var r=[1];generateFuncType(e,r);var n=[0,97,115,109,1,0,0,0,1];uleb128Encode(r.length,n),n.push(...r),n.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var o=new WebAssembly.Module(new Uint8Array(n));return new WebAssembly.Instance(o,{e:{f:t}}).exports.f},wasmTableMirror=[],wasmTable=new WebAssembly.Table({initial:27,element:"anyfunc"}),getWasmTableEntry=t=>{var e=wasmTableMirror[t];return e||(t>=wasmTableMirror.length&&(wasmTableMirror.length=t+1),wasmTableMirror[t]=e=wasmTable.get(t)),e},updateTableMap=(t,e)=>{if(functionsInTableMap)for(var r=t;r<t+e;r++){var n=getWasmTableEntry(r);n&&functionsInTableMap.set(n,r)}},functionsInTableMap,getFunctionAddress=t=>(functionsInTableMap||(functionsInTableMap=new WeakMap,updateTableMap(0,wasmTable.length)),functionsInTableMap.get(t)||0),freeTableIndexes=[],getEmptyTableSlot=()=>{if(freeTableIndexes.length)return freeTableIndexes.pop();try{wasmTable.grow(1)}catch(t){throw t instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":t}return wasmTable.length-1},setWasmTableEntry=(t,e)=>{wasmTable.set(t,e),wasmTableMirror[t]=wasmTable.get(t)},addFunction=(t,e)=>{var r=getFunctionAddress(t);if(r)return r;var n=getEmptyTableSlot();try{setWasmTableEntry(n,t)}catch(s){if(!(s instanceof TypeError))throw s;var o=convertJsFunctionToWasm(t,e);setWasmTableEntry(n,o)}return functionsInTableMap.set(t,n),n},updateGOT=(t,e)=>{for(var r in t)if(!isInternalSym(r)){var n=t[r];r.startsWith("orig$")&&(r=r.split("$")[1],e=!0),GOT[r]||=new WebAssembly.Global({value:"i32",mutable:!0}),(e||GOT[r].value==0)&&(typeof n=="function"?GOT[r].value=addFunction(n):typeof n=="number"?GOT[r].value=n:err(`unhandled export type for '${r}': ${typeof n}`))}},relocateExports=(t,e,r)=>{var n={};for(var o in t){var s=t[o];typeof s=="object"&&(s=s.value),typeof s=="number"&&(s+=e),n[o]=s}return updateGOT(n,r),n},isSymbolDefined=t=>{var e=wasmImports[t];return!(!e||e.stub)},dynCallLegacy=(t,e,r)=>(0,Module["dynCall_"+t])(e,...r),dynCall=(t,e,r=[])=>t.includes("j")?dynCallLegacy(t,e,r):getWasmTableEntry(e)(...r),createInvokeFunction=t=>function(){var e=stackSave();try{return dynCall(t,arguments[0],Array.prototype.slice.call(arguments,1))}catch(r){if(stackRestore(e),r!==r+0)throw r;_setThrew(1,0)}},resolveGlobalSymbol=(t,e=!1)=>{var r;return e&&"orig$"+t in wasmImports&&(t="orig$"+t),isSymbolDefined(t)?r=wasmImports[t]:t.startsWith("invoke_")&&(r=wasmImports[t]=createInvokeFunction(t.split("_")[1])),{sym:r,name:t}},UTF8ToString=(t,e)=>t?UTF8ArrayToString(HEAPU8,t,e):"",loadWebAssemblyModule=(binary,flags,libName,localScope,handle)=>{var metadata=getDylinkMetadata(binary);function loadModule(){var firstLoad=!handle||!HEAP8[handle+8];if(firstLoad){var memAlign=Math.pow(2,metadata.memoryAlign),memoryBase=metadata.memorySize?alignMemory(getMemory(metadata.memorySize+memAlign),memAlign):0,tableBase=metadata.tableSize?wasmTable.length:0;handle&&(HEAP8[handle+8]=1,HEAPU32[handle+12>>2]=memoryBase,HEAP32[handle+16>>2]=metadata.memorySize,HEAPU32[handle+20>>2]=tableBase,HEAP32[handle+24>>2]=metadata.tableSize)}else memoryBase=HEAPU32[handle+12>>2],tableBase=HEAPU32[handle+20>>2];var tableGrowthNeeded=tableBase+metadata.tableSize-wasmTable.length,moduleExports;function resolveSymbol(t){var e=resolveGlobalSymbol(t).sym;return!e&&localScope&&(e=localScope[t]),e||(e=moduleExports[t]),e}tableGrowthNeeded>0&&wasmTable.grow(tableGrowthNeeded);var proxyHandler={get(t,e){switch(e){case"__memory_base":return memoryBase;case"__table_base":return tableBase}if(e in wasmImports&&!wasmImports[e].stub)return wasmImports[e];var r;return e in t||(t[e]=(...n)=>(r||=resolveSymbol(e),r(...n))),t[e]}},proxy=new Proxy({},proxyHandler),info={"GOT.mem":new Proxy({},GOTHandler),"GOT.func":new Proxy({},GOTHandler),env:proxy,wasi_snapshot_preview1:proxy};function postInstantiation(module,instance){function addEmAsm(addr,body){for(var args=[],arity=0;arity<16&&body.indexOf("$"+arity)!=-1;arity++)args.push("$"+arity);args=args.join(",");var func=`(${args}) => { ${body} };`;ASM_CONSTS[start]=eval(func)}if(updateTableMap(tableBase,metadata.tableSize),moduleExports=relocateExports(instance.exports,memoryBase),flags.allowUndefined||reportUndefinedSymbols(),"__start_em_asm"in moduleExports)for(var start=moduleExports.__start_em_asm,stop=moduleExports.__stop_em_asm;start<stop;){var jsString=UTF8ToString(start);addEmAsm(start,jsString),start=HEAPU8.indexOf(0,start)+1}function addEmJs(name,cSig,body){var jsArgs=[];if(cSig=cSig.slice(1,-1),cSig!="void")for(var i in cSig=cSig.split(","),cSig){var jsArg=cSig[i].split(" ").pop();jsArgs.push(jsArg.replace("*",""))}var func=`(${jsArgs}) => ${body};`;moduleExports[name]=eval(func)}for(var name in moduleExports)if(name.startsWith("__em_js__")){var start=moduleExports[name],jsString=UTF8ToString(start),parts=jsString.split("<::>");addEmJs(name.replace("__em_js__",""),parts[0],parts[1]),delete moduleExports[name]}var applyRelocs=moduleExports.__wasm_apply_data_relocs;applyRelocs&&(runtimeInitialized?applyRelocs():__RELOC_FUNCS__.push(applyRelocs));var init=moduleExports.__wasm_call_ctors;return init&&(runtimeInitialized?init():__ATINIT__.push(init)),moduleExports}if(flags.loadAsync){if(binary instanceof WebAssembly.Module){var instance=new WebAssembly.Instance(binary,info);return Promise.resolve(postInstantiation(binary,instance))}return WebAssembly.instantiate(binary,info).then(t=>postInstantiation(t.module,t.instance))}var module=binary instanceof WebAssembly.Module?binary:new WebAssembly.Module(binary),instance=new WebAssembly.Instance(module,info);return postInstantiation(module,instance)}return currentModuleWeakSymbols=metadata.weakImports,flags.loadAsync?metadata.neededDynlibs.reduce((t,e)=>t.then(()=>loadDynamicLibrary(e,flags)),Promise.resolve()).then(loadModule):(metadata.neededDynlibs.forEach(t=>loadDynamicLibrary(t,flags,localScope)),loadModule())},mergeLibSymbols=(t,e)=>{for(var[r,n]of Object.entries(t)){let o=a=>{isSymbolDefined(a)||(wasmImports[a]=n)};o(r);let s="__main_argc_argv";r=="main"&&o(s),r==s&&o("main"),r.startsWith("dynCall_")&&!Module.hasOwnProperty(r)&&(Module[r]=n)}},asyncLoad=(t,e,r,n)=>{var o=n?"":`al ${t}`;readAsync(t,s=>{e(new Uint8Array(s)),o&&removeRunDependency(o)},s=>{if(!r)throw`Loading data file "${t}" failed.`;r()}),o&&addRunDependency(o)};function loadDynamicLibrary(t,e={global:!0,nodelete:!0},r,n){var o=LDSO.loadedLibsByName[t];if(o)return e.global?o.global||(o.global=!0,mergeLibSymbols(o.exports,t)):r&&Object.assign(r,o.exports),e.nodelete&&o.refcount!==1/0&&(o.refcount=1/0),o.refcount++,n&&(LDSO.loadedLibsByHandle[n]=o),!e.loadAsync||Promise.resolve(!0);function s(){if(n){var u=HEAPU32[n+28>>2],l=HEAPU32[n+32>>2];if(u&&l){var d=HEAP8.slice(u,u+l);return e.loadAsync?Promise.resolve(d):d}}var p=locateFile(t);if(e.loadAsync)return new Promise(function(f,m){asyncLoad(p,f,m)});if(!readBinary)throw new Error(`${p}: file not found, and synchronous loading of external files is not available`);return readBinary(p)}function a(){return e.loadAsync?s().then(u=>loadWebAssemblyModule(u,e,t,r,n)):loadWebAssemblyModule(s(),e,t,r,n)}function c(u){o.global?mergeLibSymbols(u,t):r&&Object.assign(r,u),o.exports=u}return(o=newDSO(t,n,"loading")).refcount=e.nodelete?1/0:1,o.global=e.global,e.loadAsync?a().then(u=>(c(u),!0)):(c(a()),!0)}var reportUndefinedSymbols=()=>{for(var[t,e]of Object.entries(GOT))if(e.value==0){var r=resolveGlobalSymbol(t,!0).sym;if(!r&&!e.required)continue;if(typeof r=="function")e.value=addFunction(r,r.sig);else{if(typeof r!="number")throw new Error(`bad export type for '${t}': ${typeof r}`);e.value=r}}},loadDylibs=()=>{dynamicLibraries.length?(addRunDependency("loadDylibs"),dynamicLibraries.reduce((t,e)=>t.then(()=>loadDynamicLibrary(e,{loadAsync:!0,global:!0,nodelete:!0,allowUndefined:!0})),Promise.resolve()).then(()=>{reportUndefinedSymbols(),removeRunDependency("loadDylibs")})):reportUndefinedSymbols()},noExitRuntime=Module.noExitRuntime||!0;function setValue(t,e,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":case"i8":HEAP8[t]=e;break;case"i16":HEAP16[t>>1]=e;break;case"i32":HEAP32[t>>2]=e;break;case"i64":abort("to do setValue(i64) use WASM_BIGINT");case"float":HEAPF32[t>>2]=e;break;case"double":HEAPF64[t>>3]=e;break;case"*":HEAPU32[t>>2]=e;break;default:abort(`invalid type for setValue: ${r}`)}}var ___memory_base=new WebAssembly.Global({value:"i32",mutable:!1},1024),___stack_pointer=new WebAssembly.Global({value:"i32",mutable:!0},78096),___table_base=new WebAssembly.Global({value:"i32",mutable:!1},1),nowIsMonotonic=1,__emscripten_get_now_is_monotonic=()=>nowIsMonotonic;__emscripten_get_now_is_monotonic.sig="i";var _abort=()=>{abort("")};_abort.sig="v";var _emscripten_date_now=()=>Date.now(),_emscripten_get_now;_emscripten_date_now.sig="d",_emscripten_get_now=()=>performance.now(),_emscripten_get_now.sig="d";var _emscripten_memcpy_js=(t,e,r)=>HEAPU8.copyWithin(t,e,e+r);_emscripten_memcpy_js.sig="vppp";var getHeapMax=()=>2147483648,growMemory=t=>{var e=(t-wasmMemory.buffer.byteLength+65535)/65536;try{return wasmMemory.grow(e),updateMemoryViews(),1}catch{}},_emscripten_resize_heap=t=>{var e=HEAPU8.length;t>>>=0;var r=getHeapMax();if(t>r)return!1;for(var n,o,s=1;s<=4;s*=2){var a=e*(1+.2/s);a=Math.min(a,t+100663296);var c=Math.min(r,(n=Math.max(t,a))+((o=65536)-n%o)%o);if(growMemory(c))return!0}return!1};_emscripten_resize_heap.sig="ip";var _fd_close=t=>52;_fd_close.sig="ii";var convertI32PairToI53Checked=(t,e)=>e+2097152>>>0<4194305-!!t?(t>>>0)+4294967296*e:NaN;function _fd_seek(t,e,r,n,o){return convertI32PairToI53Checked(e,r),70}_fd_seek.sig="iiiiip";var printCharBuffers=[null,[],[]],printChar=(t,e)=>{var r=printCharBuffers[t];e===0||e===10?((t===1?out:err)(UTF8ArrayToString(r,0)),r.length=0):r.push(e)},SYSCALLS={varargs:void 0,get(){var t=HEAP32[+SYSCALLS.varargs>>2];return SYSCALLS.varargs+=4,t},getp:()=>SYSCALLS.get(),getStr:t=>UTF8ToString(t)},_fd_write=(t,e,r,n)=>{for(var o=0,s=0;s<r;s++){var a=HEAPU32[e>>2],c=HEAPU32[e+4>>2];e+=8;for(var u=0;u<c;u++)printChar(t,HEAPU8[a+u]);o+=c}return HEAPU32[n>>2]=o,0};function _tree_sitter_log_callback(t,e){if(currentLogCallback){let r=UTF8ToString(e);currentLogCallback(r,t!==0)}}function _tree_sitter_parse_callback(t,e,r,n,o){let s=currentParseCallback(e,{row:r,column:n});typeof s=="string"?(setValue(o,s.length,"i32"),stringToUTF16(s,t,10240)):setValue(o,0,"i32")}_fd_write.sig="iippp";var runtimeKeepaliveCounter=0,keepRuntimeAlive=()=>noExitRuntime||runtimeKeepaliveCounter>0,_proc_exit=t=>{EXITSTATUS=t,keepRuntimeAlive()||(Module.onExit?.(t),ABORT=!0),quit_(t,new ExitStatus(t))};_proc_exit.sig="vi";var exitJS=(t,e)=>{EXITSTATUS=t,_proc_exit(t)},handleException=t=>{if(t instanceof ExitStatus||t=="unwind")return EXITSTATUS;quit_(1,t)},lengthBytesUTF8=t=>{for(var e=0,r=0;r<t.length;++r){var n=t.charCodeAt(r);n<=127?e++:n<=2047?e+=2:n>=55296&&n<=57343?(e+=4,++r):e+=3}return e},stringToUTF8Array=(t,e,r,n)=>{if(!(n>0))return 0;for(var o=r,s=r+n-1,a=0;a<t.length;++a){var c=t.charCodeAt(a);if(c>=55296&&c<=57343&&(c=65536+((1023&c)<<10)|1023&t.charCodeAt(++a)),c<=127){if(r>=s)break;e[r++]=c}else if(c<=2047){if(r+1>=s)break;e[r++]=192|c>>6,e[r++]=128|63&c}else if(c<=65535){if(r+2>=s)break;e[r++]=224|c>>12,e[r++]=128|c>>6&63,e[r++]=128|63&c}else{if(r+3>=s)break;e[r++]=240|c>>18,e[r++]=128|c>>12&63,e[r++]=128|c>>6&63,e[r++]=128|63&c}}return e[r]=0,r-o},stringToUTF8=(t,e,r)=>stringToUTF8Array(t,HEAPU8,e,r),stringToUTF8OnStack=t=>{var e=lengthBytesUTF8(t)+1,r=stackAlloc(e);return stringToUTF8(t,r,e),r},stringToUTF16=(t,e,r)=>{if(r??=2147483647,r<2)return 0;for(var n=e,o=(r-=2)<2*t.length?r/2:t.length,s=0;s<o;++s){var a=t.charCodeAt(s);HEAP16[e>>1]=a,e+=2}return HEAP16[e>>1]=0,e-n},AsciiToString=t=>{for(var e="";;){var r=HEAPU8[t++];if(!r)return e;e+=String.fromCharCode(r)}},wasmImports={__heap_base:___heap_base,__indirect_function_table:wasmTable,__memory_base:___memory_base,__stack_pointer:___stack_pointer,__table_base:___table_base,_emscripten_get_now_is_monotonic:__emscripten_get_now_is_monotonic,abort:_abort,emscripten_get_now:_emscripten_get_now,emscripten_memcpy_js:_emscripten_memcpy_js,emscripten_resize_heap:_emscripten_resize_heap,fd_close:_fd_close,fd_seek:_fd_seek,fd_write:_fd_write,memory:wasmMemory,tree_sitter_log_callback:_tree_sitter_log_callback,tree_sitter_parse_callback:_tree_sitter_parse_callback},wasmExports=createWasm(),___wasm_call_ctors=()=>(___wasm_call_ctors=wasmExports.__wasm_call_ctors)(),___wasm_apply_data_relocs=()=>(___wasm_apply_data_relocs=wasmExports.__wasm_apply_data_relocs)(),_malloc=Module._malloc=t=>(_malloc=Module._malloc=wasmExports.malloc)(t),_calloc=Module._calloc=(t,e)=>(_calloc=Module._calloc=wasmExports.calloc)(t,e),_realloc=Module._realloc=(t,e)=>(_realloc=Module._realloc=wasmExports.realloc)(t,e),_free=Module._free=t=>(_free=Module._free=wasmExports.free)(t),_ts_language_symbol_count=Module._ts_language_symbol_count=t=>(_ts_language_symbol_count=Module._ts_language_symbol_count=wasmExports.ts_language_symbol_count)(t),_ts_language_state_count=Module._ts_language_state_count=t=>(_ts_language_state_count=Module._ts_language_state_count=wasmExports.ts_language_state_count)(t),_ts_language_version=Module._ts_language_version=t=>(_ts_language_version=Module._ts_language_version=wasmExports.ts_language_version)(t),_ts_language_field_count=Module._ts_language_field_count=t=>(_ts_language_field_count=Module._ts_language_field_count=wasmExports.ts_language_field_count)(t),_ts_language_next_state=Module._ts_language_next_state=(t,e,r)=>(_ts_language_next_state=Module._ts_language_next_state=wasmExports.ts_language_next_state)(t,e,r),_ts_language_symbol_name=Module._ts_language_symbol_name=(t,e)=>(_ts_language_symbol_name=Module._ts_language_symbol_name=wasmExports.ts_language_symbol_name)(t,e),_ts_language_symbol_for_name=Module._ts_language_symbol_for_name=(t,e,r,n)=>(_ts_language_symbol_for_name=Module._ts_language_symbol_for_name=wasmExports.ts_language_symbol_for_name)(t,e,r,n),_strncmp=Module._strncmp=(t,e,r)=>(_strncmp=Module._strncmp=wasmExports.strncmp)(t,e,r),_ts_language_symbol_type=Module._ts_language_symbol_type=(t,e)=>(_ts_language_symbol_type=Module._ts_language_symbol_type=wasmExports.ts_language_symbol_type)(t,e),_ts_language_field_name_for_id=Module._ts_language_field_name_for_id=(t,e)=>(_ts_language_field_name_for_id=Module._ts_language_field_name_for_id=wasmExports.ts_language_field_name_for_id)(t,e),_ts_lookahead_iterator_new=Module._ts_lookahead_iterator_new=(t,e)=>(_ts_lookahead_iterator_new=Module._ts_lookahead_iterator_new=wasmExports.ts_lookahead_iterator_new)(t,e),_ts_lookahead_iterator_delete=Module._ts_lookahead_iterator_delete=t=>(_ts_lookahead_iterator_delete=Module._ts_lookahead_iterator_delete=wasmExports.ts_lookahead_iterator_delete)(t),_ts_lookahead_iterator_reset_state=Module._ts_lookahead_iterator_reset_state=(t,e)=>(_ts_lookahead_iterator_reset_state=Module._ts_lookahead_iterator_reset_state=wasmExports.ts_lookahead_iterator_reset_state)(t,e),_ts_lookahead_iterator_reset=Module._ts_lookahead_iterator_reset=(t,e,r)=>(_ts_lookahead_iterator_reset=Module._ts_lookahead_iterator_reset=wasmExports.ts_lookahead_iterator_reset)(t,e,r),_ts_lookahead_iterator_next=Module._ts_lookahead_iterator_next=t=>(_ts_lookahead_iterator_next=Module._ts_lookahead_iterator_next=wasmExports.ts_lookahead_iterator_next)(t),_ts_lookahead_iterator_current_symbol=Module._ts_lookahead_iterator_current_symbol=t=>(_ts_lookahead_iterator_current_symbol=Module._ts_lookahead_iterator_current_symbol=wasmExports.ts_lookahead_iterator_current_symbol)(t),_memset=Module._memset=(t,e,r)=>(_memset=Module._memset=wasmExports.memset)(t,e,r),_memcpy=Module._memcpy=(t,e,r)=>(_memcpy=Module._memcpy=wasmExports.memcpy)(t,e,r),_ts_parser_delete=Module._ts_parser_delete=t=>(_ts_parser_delete=Module._ts_parser_delete=wasmExports.ts_parser_delete)(t),_ts_parser_reset=Module._ts_parser_reset=t=>(_ts_parser_reset=Module._ts_parser_reset=wasmExports.ts_parser_reset)(t),_ts_parser_set_language=Module._ts_parser_set_language=(t,e)=>(_ts_parser_set_language=Module._ts_parser_set_language=wasmExports.ts_parser_set_language)(t,e),_ts_parser_timeout_micros=Module._ts_parser_timeout_micros=t=>(_ts_parser_timeout_micros=Module._ts_parser_timeout_micros=wasmExports.ts_parser_timeout_micros)(t),_ts_parser_set_timeout_micros=Module._ts_parser_set_timeout_micros=(t,e,r)=>(_ts_parser_set_timeout_micros=Module._ts_parser_set_timeout_micros=wasmExports.ts_parser_set_timeout_micros)(t,e,r),_ts_parser_set_included_ranges=Module._ts_parser_set_included_ranges=(t,e,r)=>(_ts_parser_set_included_ranges=Module._ts_parser_set_included_ranges=wasmExports.ts_parser_set_included_ranges)(t,e,r),_memmove=Module._memmove=(t,e,r)=>(_memmove=Module._memmove=wasmExports.memmove)(t,e,r),_memcmp=Module._memcmp=(t,e,r)=>(_memcmp=Module._memcmp=wasmExports.memcmp)(t,e,r),_ts_query_new=Module._ts_query_new=(t,e,r,n,o)=>(_ts_query_new=Module._ts_query_new=wasmExports.ts_query_new)(t,e,r,n,o),_ts_query_delete=Module._ts_query_delete=t=>(_ts_query_delete=Module._ts_query_delete=wasmExports.ts_query_delete)(t),_iswspace=Module._iswspace=t=>(_iswspace=Module._iswspace=wasmExports.iswspace)(t),_iswalnum=Module._iswalnum=t=>(_iswalnum=Module._iswalnum=wasmExports.iswalnum)(t),_ts_query_pattern_count=Module._ts_query_pattern_count=t=>(_ts_query_pattern_count=Module._ts_query_pattern_count=wasmExports.ts_query_pattern_count)(t),_ts_query_capture_count=Module._ts_query_capture_count=t=>(_ts_query_capture_count=Module._ts_query_capture_count=wasmExports.ts_query_capture_count)(t),_ts_query_string_count=Module._ts_query_string_count=t=>(_ts_query_string_count=Module._ts_query_string_count=wasmExports.ts_query_string_count)(t),_ts_query_capture_name_for_id=Module._ts_query_capture_name_for_id=(t,e,r)=>(_ts_query_capture_name_for_id=Module._ts_query_capture_name_for_id=wasmExports.ts_query_capture_name_for_id)(t,e,r),_ts_query_string_value_for_id=Module._ts_query_string_value_for_id=(t,e,r)=>(_ts_query_string_value_for_id=Module._ts_query_string_value_for_id=wasmExports.ts_query_string_value_for_id)(t,e,r),_ts_query_predicates_for_pattern=Module._ts_query_predicates_for_pattern=(t,e,r)=>(_ts_query_predicates_for_pattern=Module._ts_query_predicates_for_pattern=wasmExports.ts_query_predicates_for_pattern)(t,e,r),_ts_query_disable_capture=Module._ts_query_disable_capture=(t,e,r)=>(_ts_query_disable_capture=Module._ts_query_disable_capture=wasmExports.ts_query_disable_capture)(t,e,r),_ts_tree_copy=Module._ts_tree_copy=t=>(_ts_tree_copy=Module._ts_tree_copy=wasmExports.ts_tree_copy)(t),_ts_tree_delete=Module._ts_tree_delete=t=>(_ts_tree_delete=Module._ts_tree_delete=wasmExports.ts_tree_delete)(t),_ts_init=Module._ts_init=()=>(_ts_init=Module._ts_init=wasmExports.ts_init)(),_ts_parser_new_wasm=Module._ts_parser_new_wasm=()=>(_ts_parser_new_wasm=Module._ts_parser_new_wasm=wasmExports.ts_parser_new_wasm)(),_ts_parser_enable_logger_wasm=Module._ts_parser_enable_logger_wasm=(t,e)=>(_ts_parser_enable_logger_wasm=Module._ts_parser_enable_logger_wasm=wasmExports.ts_parser_enable_logger_wasm)(t,e),_ts_parser_parse_wasm=Module._ts_parser_parse_wasm=(t,e,r,n,o)=>(_ts_parser_parse_wasm=Module._ts_parser_parse_wasm=wasmExports.ts_parser_parse_wasm)(t,e,r,n,o),_ts_parser_included_ranges_wasm=Module._ts_parser_included_ranges_wasm=t=>(_ts_parser_included_ranges_wasm=Module._ts_parser_included_ranges_wasm=wasmExports.ts_parser_included_ranges_wasm)(t),_ts_language_type_is_named_wasm=Module._ts_language_type_is_named_wasm=(t,e)=>(_ts_language_type_is_named_wasm=Module._ts_language_type_is_named_wasm=wasmExports.ts_language_type_is_named_wasm)(t,e),_ts_language_type_is_visible_wasm=Module._ts_language_type_is_visible_wasm=(t,e)=>(_ts_language_type_is_visible_wasm=Module._ts_language_type_is_visible_wasm=wasmExports.ts_language_type_is_visible_wasm)(t,e),_ts_tree_root_node_wasm=Module._ts_tree_root_node_wasm=t=>(_ts_tree_root_node_wasm=Module._ts_tree_root_node_wasm=wasmExports.ts_tree_root_node_wasm)(t),_ts_tree_root_node_with_offset_wasm=Module._ts_tree_root_node_with_offset_wasm=t=>(_ts_tree_root_node_with_offset_wasm=Module._ts_tree_root_node_with_offset_wasm=wasmExports.ts_tree_root_node_with_offset_wasm)(t),_ts_tree_edit_wasm=Module._ts_tree_edit_wasm=t=>(_ts_tree_edit_wasm=Module._ts_tree_edit_wasm=wasmExports.ts_tree_edit_wasm)(t),_ts_tree_included_ranges_wasm=Module._ts_tree_included_ranges_wasm=t=>(_ts_tree_included_ranges_wasm=Module._ts_tree_included_ranges_wasm=wasmExports.ts_tree_included_ranges_wasm)(t),_ts_tree_get_changed_ranges_wasm=Module._ts_tree_get_changed_ranges_wasm=(t,e)=>(_ts_tree_get_changed_ranges_wasm=Module._ts_tree_get_changed_ranges_wasm=wasmExports.ts_tree_get_changed_ranges_wasm)(t,e),_ts_tree_cursor_new_wasm=Module._ts_tree_cursor_new_wasm=t=>(_ts_tree_cursor_new_wasm=Module._ts_tree_cursor_new_wasm=wasmExports.ts_tree_cursor_new_wasm)(t),_ts_tree_cursor_delete_wasm=Module._ts_tree_cursor_delete_wasm=t=>(_ts_tree_cursor_delete_wasm=Module._ts_tree_cursor_delete_wasm=wasmExports.ts_tree_cursor_delete_wasm)(t),_ts_tree_cursor_reset_wasm=Module._ts_tree_cursor_reset_wasm=t=>(_ts_tree_cursor_reset_wasm=Module._ts_tree_cursor_reset_wasm=wasmExports.ts_tree_cursor_reset_wasm)(t),_ts_tree_cursor_reset_to_wasm=Module._ts_tree_cursor_reset_to_wasm=(t,e)=>(_ts_tree_cursor_reset_to_wasm=Module._ts_tree_cursor_reset_to_wasm=wasmExports.ts_tree_cursor_reset_to_wasm)(t,e),_ts_tree_cursor_goto_first_child_wasm=Module._ts_tree_cursor_goto_first_child_wasm=t=>(_ts_tree_cursor_goto_first_child_wasm=Module._ts_tree_cursor_goto_first_child_wasm=wasmExports.ts_tree_cursor_goto_first_child_wasm)(t),_ts_tree_cursor_goto_last_child_wasm=Module._ts_tree_cursor_goto_last_child_wasm=t=>(_ts_tree_cursor_goto_last_child_wasm=Module._ts_tree_cursor_goto_last_child_wasm=wasmExports.ts_tree_cursor_goto_last_child_wasm)(t),_ts_tree_cursor_goto_first_child_for_index_wasm=Module._ts_tree_cursor_goto_first_child_for_index_wasm=t=>(_ts_tree_cursor_goto_first_child_for_index_wasm=Module._ts_tree_cursor_goto_first_child_for_index_wasm=wasmExports.ts_tree_cursor_goto_first_child_for_index_wasm)(t),_ts_tree_cursor_goto_first_child_for_position_wasm=Module._ts_tree_cursor_goto_first_child_for_position_wasm=t=>(_ts_tree_cursor_goto_first_child_for_position_wasm=Module._ts_tree_cursor_goto_first_child_for_position_wasm=wasmExports.ts_tree_cursor_goto_first_child_for_position_wasm)(t),_ts_tree_cursor_goto_next_sibling_wasm=Module._ts_tree_cursor_goto_next_sibling_wasm=t=>(_ts_tree_cursor_goto_next_sibling_wasm=Module._ts_tree_cursor_goto_next_sibling_wasm=wasmExports.ts_tree_cursor_goto_next_sibling_wasm)(t),_ts_tree_cursor_goto_previous_sibling_wasm=Module._ts_tree_cursor_goto_previous_sibling_wasm=t=>(_ts_tree_cursor_goto_previous_sibling_wasm=Module._ts_tree_cursor_goto_previous_sibling_wasm=wasmExports.ts_tree_cursor_goto_previous_sibling_wasm)(t),_ts_tree_cursor_goto_descendant_wasm=Module._ts_tree_cursor_goto_descendant_wasm=(t,e)=>(_ts_tree_cursor_goto_descendant_wasm=Module._ts_tree_cursor_goto_descendant_wasm=wasmExports.ts_tree_cursor_goto_descendant_wasm)(t,e),_ts_tree_cursor_goto_parent_wasm=Module._ts_tree_cursor_goto_parent_wasm=t=>(_ts_tree_cursor_goto_parent_wasm=Module._ts_tree_cursor_goto_parent_wasm=wasmExports.ts_tree_cursor_goto_parent_wasm)(t),_ts_tree_cursor_current_node_type_id_wasm=Module._ts_tree_cursor_current_node_type_id_wasm=t=>(_ts_tree_cursor_current_node_type_id_wasm=Module._ts_tree_cursor_current_node_type_id_wasm=wasmExports.ts_tree_cursor_current_node_type_id_wasm)(t),_ts_tree_cursor_current_node_state_id_wasm=Module._ts_tree_cursor_current_node_state_id_wasm=t=>(_ts_tree_cursor_current_node_state_id_wasm=Module._ts_tree_cursor_current_node_state_id_wasm=wasmExports.ts_tree_cursor_current_node_state_id_wasm)(t),_ts_tree_cursor_current_node_is_named_wasm=Module._ts_tree_cursor_current_node_is_named_wasm=t=>(_ts_tree_cursor_current_node_is_named_wasm=Module._ts_tree_cursor_current_node_is_named_wasm=wasmExports.ts_tree_cursor_current_node_is_named_wasm)(t),_ts_tree_cursor_current_node_is_missing_wasm=Module._ts_tree_cursor_current_node_is_missing_wasm=t=>(_ts_tree_cursor_current_node_is_missing_wasm=Module._ts_tree_cursor_current_node_is_missing_wasm=wasmExports.ts_tree_cursor_current_node_is_missing_wasm)(t),_ts_tree_cursor_current_node_id_wasm=Module._ts_tree_cursor_current_node_id_wasm=t=>(_ts_tree_cursor_current_node_id_wasm=Module._ts_tree_cursor_current_node_id_wasm=wasmExports.ts_tree_cursor_current_node_id_wasm)(t),_ts_tree_cursor_start_position_wasm=Module._ts_tree_cursor_start_position_wasm=t=>(_ts_tree_cursor_start_position_wasm=Module._ts_tree_cursor_start_position_wasm=wasmExports.ts_tree_cursor_start_position_wasm)(t),_ts_tree_cursor_end_position_wasm=Module._ts_tree_cursor_end_position_wasm=t=>(_ts_tree_cursor_end_position_wasm=Module._ts_tree_cursor_end_position_wasm=wasmExports.ts_tree_cursor_end_position_wasm)(t),_ts_tree_cursor_start_index_wasm=Module._ts_tree_cursor_start_index_wasm=t=>(_ts_tree_cursor_start_index_wasm=Module._ts_tree_cursor_start_index_wasm=wasmExports.ts_tree_cursor_start_index_wasm)(t),_ts_tree_cursor_end_index_wasm=Module._ts_tree_cursor_end_index_wasm=t=>(_ts_tree_cursor_end_index_wasm=Module._ts_tree_cursor_end_index_wasm=wasmExports.ts_tree_cursor_end_index_wasm)(t),_ts_tree_cursor_current_field_id_wasm=Module._ts_tree_cursor_current_field_id_wasm=t=>(_ts_tree_cursor_current_field_id_wasm=Module._ts_tree_cursor_current_field_id_wasm=wasmExports.ts_tree_cursor_current_field_id_wasm)(t),_ts_tree_cursor_current_depth_wasm=Module._ts_tree_cursor_current_depth_wasm=t=>(_ts_tree_cursor_current_depth_wasm=Module._ts_tree_cursor_current_depth_wasm=wasmExports.ts_tree_cursor_current_depth_wasm)(t),_ts_tree_cursor_current_descendant_index_wasm=Module._ts_tree_cursor_current_descendant_index_wasm=t=>(_ts_tree_cursor_current_descendant_index_wasm=Module._ts_tree_cursor_current_descendant_index_wasm=wasmExports.ts_tree_cursor_current_descendant_index_wasm)(t),_ts_tree_cursor_current_node_wasm=Module._ts_tree_cursor_current_node_wasm=t=>(_ts_tree_cursor_current_node_wasm=Module._ts_tree_cursor_current_node_wasm=wasmExports.ts_tree_cursor_current_node_wasm)(t),_ts_node_symbol_wasm=Module._ts_node_symbol_wasm=t=>(_ts_node_symbol_wasm=Module._ts_node_symbol_wasm=wasmExports.ts_node_symbol_wasm)(t),_ts_node_field_name_for_child_wasm=Module._ts_node_field_name_for_child_wasm=(t,e)=>(_ts_node_field_name_for_child_wasm=Module._ts_node_field_name_for_child_wasm=wasmExports.ts_node_field_name_for_child_wasm)(t,e),_ts_node_children_by_field_id_wasm=Module._ts_node_children_by_field_id_wasm=(t,e)=>(_ts_node_children_by_field_id_wasm=Module._ts_node_children_by_field_id_wasm=wasmExports.ts_node_children_by_field_id_wasm)(t,e),_ts_node_first_child_for_byte_wasm=Module._ts_node_first_child_for_byte_wasm=t=>(_ts_node_first_child_for_byte_wasm=Module._ts_node_first_child_for_byte_wasm=wasmExports.ts_node_first_child_for_byte_wasm)(t),_ts_node_first_named_child_for_byte_wasm=Module._ts_node_first_named_child_for_byte_wasm=t=>(_ts_node_first_named_child_for_byte_wasm=Module._ts_node_first_named_child_for_byte_wasm=wasmExports.ts_node_first_named_child_for_byte_wasm)(t),_ts_node_grammar_symbol_wasm=Module._ts_node_grammar_symbol_wasm=t=>(_ts_node_grammar_symbol_wasm=Module._ts_node_grammar_symbol_wasm=wasmExports.ts_node_grammar_symbol_wasm)(t),_ts_node_child_count_wasm=Module._ts_node_child_count_wasm=t=>(_ts_node_child_count_wasm=Module._ts_node_child_count_wasm=wasmExports.ts_node_child_count_wasm)(t),_ts_node_named_child_count_wasm=Module._ts_node_named_child_count_wasm=t=>(_ts_node_named_child_count_wasm=Module._ts_node_named_child_count_wasm=wasmExports.ts_node_named_child_count_wasm)(t),_ts_node_child_wasm=Module._ts_node_child_wasm=(t,e)=>(_ts_node_child_wasm=Module._ts_node_child_wasm=wasmExports.ts_node_child_wasm)(t,e),_ts_node_named_child_wasm=Module._ts_node_named_child_wasm=(t,e)=>(_ts_node_named_child_wasm=Module._ts_node_named_child_wasm=wasmExports.ts_node_named_child_wasm)(t,e),_ts_node_child_by_field_id_wasm=Module._ts_node_child_by_field_id_wasm=(t,e)=>(_ts_node_child_by_field_id_wasm=Module._ts_node_child_by_field_id_wasm=wasmExports.ts_node_child_by_field_id_wasm)(t,e),_ts_node_next_sibling_wasm=Module._ts_node_next_sibling_wasm=t=>(_ts_node_next_sibling_wasm=Module._ts_node_next_sibling_wasm=wasmExports.ts_node_next_sibling_wasm)(t),_ts_node_prev_sibling_wasm=Module._ts_node_prev_sibling_wasm=t=>(_ts_node_prev_sibling_wasm=Module._ts_node_prev_sibling_wasm=wasmExports.ts_node_prev_sibling_wasm)(t),_ts_node_next_named_sibling_wasm=Module._ts_node_next_named_sibling_wasm=t=>(_ts_node_next_named_sibling_wasm=Module._ts_node_next_named_sibling_wasm=wasmExports.ts_node_next_named_sibling_wasm)(t),_ts_node_prev_named_sibling_wasm=Module._ts_node_prev_named_sibling_wasm=t=>(_ts_node_prev_named_sibling_wasm=Module._ts_node_prev_named_sibling_wasm=wasmExports.ts_node_prev_named_sibling_wasm)(t),_ts_node_descendant_count_wasm=Module._ts_node_descendant_count_wasm=t=>(_ts_node_descendant_count_wasm=Module._ts_node_descendant_count_wasm=wasmExports.ts_node_descendant_count_wasm)(t),_ts_node_parent_wasm=Module._ts_node_parent_wasm=t=>(_ts_node_parent_wasm=Module._ts_node_parent_wasm=wasmExports.ts_node_parent_wasm)(t),_ts_node_descendant_for_index_wasm=Module._ts_node_descendant_for_index_wasm=t=>(_ts_node_descendant_for_index_wasm=Module._ts_node_descendant_for_index_wasm=wasmExports.ts_node_descendant_for_index_wasm)(t),_ts_node_named_descendant_for_index_wasm=Module._ts_node_named_descendant_for_index_wasm=t=>(_ts_node_named_descendant_for_index_wasm=Module._ts_node_named_descendant_for_index_wasm=wasmExports.ts_node_named_descendant_for_index_wasm)(t),_ts_node_descendant_for_position_wasm=Module._ts_node_descendant_for_position_wasm=t=>(_ts_node_descendant_for_position_wasm=Module._ts_node_descendant_for_position_wasm=wasmExports.ts_node_descendant_for_position_wasm)(t),_ts_node_named_descendant_for_position_wasm=Module._ts_node_named_descendant_for_position_wasm=t=>(_ts_node_named_descendant_for_position_wasm=Module._ts_node_named_descendant_for_position_wasm=wasmExports.ts_node_named_descendant_for_position_wasm)(t),_ts_node_start_point_wasm=Module._ts_node_start_point_wasm=t=>(_ts_node_start_point_wasm=Module._ts_node_start_point_wasm=wasmExports.ts_node_start_point_wasm)(t),_ts_node_end_point_wasm=Module._ts_node_end_point_wasm=t=>(_ts_node_end_point_wasm=Module._ts_node_end_point_wasm=wasmExports.ts_node_end_point_wasm)(t),_ts_node_start_index_wasm=Module._ts_node_start_index_wasm=t=>(_ts_node_start_index_wasm=Module._ts_node_start_index_wasm=wasmExports.ts_node_start_index_wasm)(t),_ts_node_end_index_wasm=Module._ts_node_end_index_wasm=t=>(_ts_node_end_index_wasm=Module._ts_node_end_index_wasm=wasmExports.ts_node_end_index_wasm)(t),_ts_node_to_string_wasm=Module._ts_node_to_string_wasm=t=>(_ts_node_to_string_wasm=Module._ts_node_to_string_wasm=wasmExports.ts_node_to_string_wasm)(t),_ts_node_children_wasm=Module._ts_node_children_wasm=t=>(_ts_node_children_wasm=Module._ts_node_children_wasm=wasmExports.ts_node_children_wasm)(t),_ts_node_named_children_wasm=Module._ts_node_named_children_wasm=t=>(_ts_node_named_children_wasm=Module._ts_node_named_children_wasm=wasmExports.ts_node_named_children_wasm)(t),_ts_node_descendants_of_type_wasm=Module._ts_node_descendants_of_type_wasm=(t,e,r,n,o,s,a)=>(_ts_node_descendants_of_type_wasm=Module._ts_node_descendants_of_type_wasm=wasmExports.ts_node_descendants_of_type_wasm)(t,e,r,n,o,s,a),_ts_node_is_named_wasm=Module._ts_node_is_named_wasm=t=>(_ts_node_is_named_wasm=Module._ts_node_is_named_wasm=wasmExports.ts_node_is_named_wasm)(t),_ts_node_has_changes_wasm=Module._ts_node_has_changes_wasm=t=>(_ts_node_has_changes_wasm=Module._ts_node_has_changes_wasm=wasmExports.ts_node_has_changes_wasm)(t),_ts_node_has_error_wasm=Module._ts_node_has_error_wasm=t=>(_ts_node_has_error_wasm=Module._ts_node_has_error_wasm=wasmExports.ts_node_has_error_wasm)(t),_ts_node_is_error_wasm=Module._ts_node_is_error_wasm=t=>(_ts_node_is_error_wasm=Module._ts_node_is_error_wasm=wasmExports.ts_node_is_error_wasm)(t),_ts_node_is_missing_wasm=Module._ts_node_is_missing_wasm=t=>(_ts_node_is_missing_wasm=Module._ts_node_is_missing_wasm=wasmExports.ts_node_is_missing_wasm)(t),_ts_node_is_extra_wasm=Module._ts_node_is_extra_wasm=t=>(_ts_node_is_extra_wasm=Module._ts_node_is_extra_wasm=wasmExports.ts_node_is_extra_wasm)(t),_ts_node_parse_state_wasm=Module._ts_node_parse_state_wasm=t=>(_ts_node_parse_state_wasm=Module._ts_node_parse_state_wasm=wasmExports.ts_node_parse_state_wasm)(t),_ts_node_next_parse_state_wasm=Module._ts_node_next_parse_state_wasm=t=>(_ts_node_next_parse_state_wasm=Module._ts_node_next_parse_state_wasm=wasmExports.ts_node_next_parse_state_wasm)(t),_ts_query_matches_wasm=Module._ts_query_matches_wasm=(t,e,r,n,o,s,a,c,u,l)=>(_ts_query_matches_wasm=Module._ts_query_matches_wasm=wasmExports.ts_query_matches_wasm)(t,e,r,n,o,s,a,c,u,l),_ts_query_captures_wasm=Module._ts_query_captures_wasm=(t,e,r,n,o,s,a,c,u,l)=>(_ts_query_captures_wasm=Module._ts_query_captures_wasm=wasmExports.ts_query_captures_wasm)(t,e,r,n,o,s,a,c,u,l),_iswalpha=Module._iswalpha=t=>(_iswalpha=Module._iswalpha=wasmExports.iswalpha)(t),_iswblank=Module._iswblank=t=>(_iswblank=Module._iswblank=wasmExports.iswblank)(t),_iswdigit=Module._iswdigit=t=>(_iswdigit=Module._iswdigit=wasmExports.iswdigit)(t),_iswlower=Module._iswlower=t=>(_iswlower=Module._iswlower=wasmExports.iswlower)(t),_iswupper=Module._iswupper=t=>(_iswupper=Module._iswupper=wasmExports.iswupper)(t),_iswxdigit=Module._iswxdigit=t=>(_iswxdigit=Module._iswxdigit=wasmExports.iswxdigit)(t),_memchr=Module._memchr=(t,e,r)=>(_memchr=Module._memchr=wasmExports.memchr)(t,e,r),_strlen=Module._strlen=t=>(_strlen=Module._strlen=wasmExports.strlen)(t),_strcmp=Module._strcmp=(t,e)=>(_strcmp=Module._strcmp=wasmExports.strcmp)(t,e),_strncat=Module._strncat=(t,e,r)=>(_strncat=Module._strncat=wasmExports.strncat)(t,e,r),_strncpy=Module._strncpy=(t,e,r)=>(_strncpy=Module._strncpy=wasmExports.strncpy)(t,e,r),_towlower=Module._towlower=t=>(_towlower=Module._towlower=wasmExports.towlower)(t),_towupper=Module._towupper=t=>(_towupper=Module._towupper=wasmExports.towupper)(t),_setThrew=(t,e)=>(_setThrew=wasmExports.setThrew)(t,e),stackSave=()=>(stackSave=wasmExports.stackSave)(),stackRestore=t=>(stackRestore=wasmExports.stackRestore)(t),stackAlloc=t=>(stackAlloc=wasmExports.stackAlloc)(t),dynCall_jiji=Module.dynCall_jiji=(t,e,r,n,o)=>(dynCall_jiji=Module.dynCall_jiji=wasmExports.dynCall_jiji)(t,e,r,n,o),_orig$ts_parser_timeout_micros=Module._orig$ts_parser_timeout_micros=t=>(_orig$ts_parser_timeout_micros=Module._orig$ts_parser_timeout_micros=wasmExports.orig$ts_parser_timeout_micros)(t),_orig$ts_parser_set_timeout_micros=Module._orig$ts_parser_set_timeout_micros=(t,e)=>(_orig$ts_parser_set_timeout_micros=Module._orig$ts_parser_set_timeout_micros=wasmExports.orig$ts_parser_set_timeout_micros)(t,e),calledRun;function callMain(t=[]){var e=resolveGlobalSymbol("main").sym;if(e){t.unshift(thisProgram);var r=t.length,n=stackAlloc(4*(r+1)),o=n;t.forEach(a=>{HEAPU32[o>>2]=stringToUTF8OnStack(a),o+=4}),HEAPU32[o>>2]=0;try{var s=e(r,n);return exitJS(s,!0),s}catch(a){return handleException(a)}}}function run(t=arguments_){function e(){calledRun||(calledRun=!0,Module.calledRun=!0,ABORT||(initRuntime(),preMain(),Module.onRuntimeInitialized&&Module.onRuntimeInitialized(),shouldRunNow&&callMain(t),postRun()))}runDependencies>0||(preRun(),runDependencies>0||(Module.setStatus?(Module.setStatus("Running..."),setTimeout(function(){setTimeout(function(){Module.setStatus("")},1),e()},1)):e()))}if(Module.AsciiToString=AsciiToString,Module.stringToUTF16=stringToUTF16,dependenciesFulfilled=function t(){calledRun||run(),calledRun||(dependenciesFulfilled=t)},Module.preInit)for(typeof Module.preInit=="function"&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();var shouldRunNow=!0;Module.noInitialRun&&(shouldRunNow=!1),run();let C=Module,INTERNAL={},SIZE_OF_INT=4,SIZE_OF_CURSOR=4*SIZE_OF_INT,SIZE_OF_NODE=5*SIZE_OF_INT,SIZE_OF_POINT=2*SIZE_OF_INT,SIZE_OF_RANGE=2*SIZE_OF_INT+2*SIZE_OF_POINT,ZERO_POINT={row:0,column:0},QUERY_WORD_REGEX=/[\w-.]*/g,PREDICATE_STEP_TYPE_CAPTURE=1,PREDICATE_STEP_TYPE_STRING=2,LANGUAGE_FUNCTION_REGEX=/^_?tree_sitter_\w+/,VERSION,MIN_COMPATIBLE_VERSION,TRANSFER_BUFFER,currentParseCallback,currentLogCallback;class ParserImpl{static init(){TRANSFER_BUFFER=C._ts_init(),VERSION=getValue(TRANSFER_BUFFER,"i32"),MIN_COMPATIBLE_VERSION=getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32")}initialize(){C._ts_parser_new_wasm(),this[0]=getValue(TRANSFER_BUFFER,"i32"),this[1]=getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32")}delete(){C._ts_parser_delete(this[0]),C._free(this[1]),this[0]=0,this[1]=0}setLanguage(e){let r;if(e){if(e.constructor!==Language)throw new Error("Argument must be a Language");{r=e[0];let n=C._ts_language_version(r);if(n<MIN_COMPATIBLE_VERSION||VERSION<n)throw new Error(`Incompatible language version ${n}. Compatibility range ${MIN_COMPATIBLE_VERSION} through ${VERSION}.`)}}else r=0,e=null;return this.language=e,C._ts_parser_set_language(this[0],r),this}getLanguage(){return this.language}parse(e,r,n){if(typeof e=="string")currentParseCallback=(u,l)=>e.slice(u);else{if(typeof e!="function")throw new Error("Argument must be a string or a function");currentParseCallback=e}this.logCallback?(currentLogCallback=this.logCallback,C._ts_parser_enable_logger_wasm(this[0],1)):(currentLogCallback=null,C._ts_parser_enable_logger_wasm(this[0],0));let o=0,s=0;if(n?.includedRanges){o=n.includedRanges.length,s=C._calloc(o,SIZE_OF_RANGE);let u=s;for(let l=0;l<o;l++)marshalRange(u,n.includedRanges[l]),u+=SIZE_OF_RANGE}let a=C._ts_parser_parse_wasm(this[0],this[1],r?r[0]:0,s,o);if(!a)throw currentParseCallback=null,currentLogCallback=null,new Error("Parsing failed");let c=new Tree(INTERNAL,a,this.language,currentParseCallback);return currentParseCallback=null,currentLogCallback=null,c}reset(){C._ts_parser_reset(this[0])}getIncludedRanges(){C._ts_parser_included_ranges_wasm(this[0]);let e=getValue(TRANSFER_BUFFER,"i32"),r=getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),n=new Array(e);if(e>0){let o=r;for(let s=0;s<e;s++)n[s]=unmarshalRange(o),o+=SIZE_OF_RANGE;C._free(r)}return n}getTimeoutMicros(){return C._ts_parser_timeout_micros(this[0])}setTimeoutMicros(e){C._ts_parser_set_timeout_micros(this[0],e)}setLogger(e){if(e){if(typeof e!="function")throw new Error("Logger callback must be a function")}else e=null;return this.logCallback=e,this}getLogger(){return this.logCallback}}class Tree{constructor(e,r,n,o){assertInternal(e),this[0]=r,this.language=n,this.textCallback=o}copy(){let e=C._ts_tree_copy(this[0]);return new Tree(INTERNAL,e,this.language,this.textCallback)}delete(){C._ts_tree_delete(this[0]),this[0]=0}edit(e){marshalEdit(e),C._ts_tree_edit_wasm(this[0])}get rootNode(){return C._ts_tree_root_node_wasm(this[0]),unmarshalNode(this)}rootNodeWithOffset(e,r){let n=TRANSFER_BUFFER+SIZE_OF_NODE;return setValue(n,e,"i32"),marshalPoint(n+SIZE_OF_INT,r),C._ts_tree_root_node_with_offset_wasm(this[0]),unmarshalNode(this)}getLanguage(){return this.language}walk(){return this.rootNode.walk()}getChangedRanges(e){if(e.constructor!==Tree)throw new TypeError("Argument must be a Tree");C._ts_tree_get_changed_ranges_wasm(this[0],e[0]);let r=getValue(TRANSFER_BUFFER,"i32"),n=getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),o=new Array(r);if(r>0){let s=n;for(let a=0;a<r;a++)o[a]=unmarshalRange(s),s+=SIZE_OF_RANGE;C._free(n)}return o}getIncludedRanges(){C._ts_tree_included_ranges_wasm(this[0]);let e=getValue(TRANSFER_BUFFER,"i32"),r=getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),n=new Array(e);if(e>0){let o=r;for(let s=0;s<e;s++)n[s]=unmarshalRange(o),o+=SIZE_OF_RANGE;C._free(r)}return n}}class Node{constructor(e,r){assertInternal(e),this.tree=r}get typeId(){return marshalNode(this),C._ts_node_symbol_wasm(this.tree[0])}get grammarId(){return marshalNode(this),C._ts_node_grammar_symbol_wasm(this.tree[0])}get type(){return this.tree.language.types[this.typeId]||"ERROR"}get grammarType(){return this.tree.language.types[this.grammarId]||"ERROR"}get endPosition(){return marshalNode(this),C._ts_node_end_point_wasm(this.tree[0]),unmarshalPoint(TRANSFER_BUFFER)}get endIndex(){return marshalNode(this),C._ts_node_end_index_wasm(this.tree[0])}get text(){return getText(this.tree,this.startIndex,this.endIndex)}get parseState(){return marshalNode(this),C._ts_node_parse_state_wasm(this.tree[0])}get nextParseState(){return marshalNode(this),C._ts_node_next_parse_state_wasm(this.tree[0])}get isNamed(){return marshalNode(this),C._ts_node_is_named_wasm(this.tree[0])===1}get hasError(){return marshalNode(this),C._ts_node_has_error_wasm(this.tree[0])===1}get hasChanges(){return marshalNode(this),C._ts_node_has_changes_wasm(this.tree[0])===1}get isError(){return marshalNode(this),C._ts_node_is_error_wasm(this.tree[0])===1}get isMissing(){return marshalNode(this),C._ts_node_is_missing_wasm(this.tree[0])===1}get isExtra(){return marshalNode(this),C._ts_node_is_extra_wasm(this.tree[0])===1}equals(e){return this.id===e.id}child(e){return marshalNode(this),C._ts_node_child_wasm(this.tree[0],e),unmarshalNode(this.tree)}namedChild(e){return marshalNode(this),C._ts_node_named_child_wasm(this.tree[0],e),unmarshalNode(this.tree)}childForFieldId(e){return marshalNode(this),C._ts_node_child_by_field_id_wasm(this.tree[0],e),unmarshalNode(this.tree)}childForFieldName(e){let r=this.tree.language.fields.indexOf(e);return r!==-1?this.childForFieldId(r):null}fieldNameForChild(e){marshalNode(this);let r=C._ts_node_field_name_for_child_wasm(this.tree[0],e);return r?AsciiToString(r):null}childrenForFieldName(e){let r=this.tree.language.fields.indexOf(e);return r!==-1&&r!==0?this.childrenForFieldId(r):[]}childrenForFieldId(e){marshalNode(this),C._ts_node_children_by_field_id_wasm(this.tree[0],e);let r=getValue(TRANSFER_BUFFER,"i32"),n=getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),o=new Array(r);if(r>0){let s=n;for(let a=0;a<r;a++)o[a]=unmarshalNode(this.tree,s),s+=SIZE_OF_NODE;C._free(n)}return o}firstChildForIndex(e){return marshalNode(this),setValue(TRANSFER_BUFFER+SIZE_OF_NODE,e,"i32"),C._ts_node_first_child_for_byte_wasm(this.tree[0]),unmarshalNode(this.tree)}firstNamedChildForIndex(e){return marshalNode(this),setValue(TRANSFER_BUFFER+SIZE_OF_NODE,e,"i32"),C._ts_node_first_named_child_for_byte_wasm(this.tree[0]),unmarshalNode(this.tree)}get childCount(){return marshalNode(this),C._ts_node_child_count_wasm(this.tree[0])}get namedChildCount(){return marshalNode(this),C._ts_node_named_child_count_wasm(this.tree[0])}get firstChild(){return this.child(0)}get firstNamedChild(){return this.namedChild(0)}get lastChild(){return this.child(this.childCount-1)}get lastNamedChild(){return this.namedChild(this.namedChildCount-1)}get children(){if(!this._children){marshalNode(this),C._ts_node_children_wasm(this.tree[0]);let e=getValue(TRANSFER_BUFFER,"i32"),r=getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32");if(this._children=new Array(e),e>0){let n=r;for(let o=0;o<e;o++)this._children[o]=unmarshalNode(this.tree,n),n+=SIZE_OF_NODE;C._free(r)}}return this._children}get namedChildren(){if(!this._namedChildren){marshalNode(this),C._ts_node_named_children_wasm(this.tree[0]);let e=getValue(TRANSFER_BUFFER,"i32"),r=getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32");if(this._namedChildren=new Array(e),e>0){let n=r;for(let o=0;o<e;o++)this._namedChildren[o]=unmarshalNode(this.tree,n),n+=SIZE_OF_NODE;C._free(r)}}return this._namedChildren}descendantsOfType(e,r,n){Array.isArray(e)||(e=[e]),r||(r=ZERO_POINT),n||(n=ZERO_POINT);let o=[],s=this.tree.language.types;for(let d=0,p=s.length;d<p;d++)e.includes(s[d])&&o.push(d);let a=C._malloc(SIZE_OF_INT*o.length);for(let d=0,p=o.length;d<p;d++)setValue(a+d*SIZE_OF_INT,o[d],"i32");marshalNode(this),C._ts_node_descendants_of_type_wasm(this.tree[0],a,o.length,r.row,r.column,n.row,n.column);let c=getValue(TRANSFER_BUFFER,"i32"),u=getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),l=new Array(c);if(c>0){let d=u;for(let p=0;p<c;p++)l[p]=unmarshalNode(this.tree,d),d+=SIZE_OF_NODE}return C._free(u),C._free(a),l}get nextSibling(){return marshalNode(this),C._ts_node_next_sibling_wasm(this.tree[0]),unmarshalNode(this.tree)}get previousSibling(){return marshalNode(this),C._ts_node_prev_sibling_wasm(this.tree[0]),unmarshalNode(this.tree)}get nextNamedSibling(){return marshalNode(this),C._ts_node_next_named_sibling_wasm(this.tree[0]),unmarshalNode(this.tree)}get previousNamedSibling(){return marshalNode(this),C._ts_node_prev_named_sibling_wasm(this.tree[0]),unmarshalNode(this.tree)}get descendantCount(){return marshalNode(this),C._ts_node_descendant_count_wasm(this.tree[0])}get parent(){return marshalNode(this),C._ts_node_parent_wasm(this.tree[0]),unmarshalNode(this.tree)}descendantForIndex(e,r=e){if(typeof e!="number"||typeof r!="number")throw new Error("Arguments must be numbers");marshalNode(this);let n=TRANSFER_BUFFER+SIZE_OF_NODE;return setValue(n,e,"i32"),setValue(n+SIZE_OF_INT,r,"i32"),C._ts_node_descendant_for_index_wasm(this.tree[0]),unmarshalNode(this.tree)}namedDescendantForIndex(e,r=e){if(typeof e!="number"||typeof r!="number")throw new Error("Arguments must be numbers");marshalNode(this);let n=TRANSFER_BUFFER+SIZE_OF_NODE;return setValue(n,e,"i32"),setValue(n+SIZE_OF_INT,r,"i32"),C._ts_node_named_descendant_for_index_wasm(this.tree[0]),unmarshalNode(this.tree)}descendantForPosition(e,r=e){if(!isPoint(e)||!isPoint(r))throw new Error("Arguments must be {row, column} objects");marshalNode(this);let n=TRANSFER_BUFFER+SIZE_OF_NODE;return marshalPoint(n,e),marshalPoint(n+SIZE_OF_POINT,r),C._ts_node_descendant_for_position_wasm(this.tree[0]),unmarshalNode(this.tree)}namedDescendantForPosition(e,r=e){if(!isPoint(e)||!isPoint(r))throw new Error("Arguments must be {row, column} objects");marshalNode(this);let n=TRANSFER_BUFFER+SIZE_OF_NODE;return marshalPoint(n,e),marshalPoint(n+SIZE_OF_POINT,r),C._ts_node_named_descendant_for_position_wasm(this.tree[0]),unmarshalNode(this.tree)}walk(){return marshalNode(this),C._ts_tree_cursor_new_wasm(this.tree[0]),new TreeCursor(INTERNAL,this.tree)}toString(){marshalNode(this);let e=C._ts_node_to_string_wasm(this.tree[0]),r=AsciiToString(e);return C._free(e),r}}class TreeCursor{constructor(e,r){assertInternal(e),this.tree=r,unmarshalTreeCursor(this)}delete(){marshalTreeCursor(this),C._ts_tree_cursor_delete_wasm(this.tree[0]),this[0]=this[1]=this[2]=0}reset(e){marshalNode(e),marshalTreeCursor(this,TRANSFER_BUFFER+SIZE_OF_NODE),C._ts_tree_cursor_reset_wasm(this.tree[0]),unmarshalTreeCursor(this)}resetTo(e){marshalTreeCursor(this,TRANSFER_BUFFER),marshalTreeCursor(e,TRANSFER_BUFFER+SIZE_OF_CURSOR),C._ts_tree_cursor_reset_to_wasm(this.tree[0],e.tree[0]),unmarshalTreeCursor(this)}get nodeType(){return this.tree.language.types[this.nodeTypeId]||"ERROR"}get nodeTypeId(){return marshalTreeCursor(this),C._ts_tree_cursor_current_node_type_id_wasm(this.tree[0])}get nodeStateId(){return marshalTreeCursor(this),C._ts_tree_cursor_current_node_state_id_wasm(this.tree[0])}get nodeId(){return marshalTreeCursor(this),C._ts_tree_cursor_current_node_id_wasm(this.tree[0])}get nodeIsNamed(){return marshalTreeCursor(this),C._ts_tree_cursor_current_node_is_named_wasm(this.tree[0])===1}get nodeIsMissing(){return marshalTreeCursor(this),C._ts_tree_cursor_current_node_is_missing_wasm(this.tree[0])===1}get nodeText(){marshalTreeCursor(this);let e=C._ts_tree_cursor_start_index_wasm(this.tree[0]),r=C._ts_tree_cursor_end_index_wasm(this.tree[0]);return getText(this.tree,e,r)}get startPosition(){return marshalTreeCursor(this),C._ts_tree_cursor_start_position_wasm(this.tree[0]),unmarshalPoint(TRANSFER_BUFFER)}get endPosition(){return marshalTreeCursor(this),C._ts_tree_cursor_end_position_wasm(this.tree[0]),unmarshalPoint(TRANSFER_BUFFER)}get startIndex(){return marshalTreeCursor(this),C._ts_tree_cursor_start_index_wasm(this.tree[0])}get endIndex(){return marshalTreeCursor(this),C._ts_tree_cursor_end_index_wasm(this.tree[0])}get currentNode(){return marshalTreeCursor(this),C._ts_tree_cursor_current_node_wasm(this.tree[0]),unmarshalNode(this.tree)}get currentFieldId(){return marshalTreeCursor(this),C._ts_tree_cursor_current_field_id_wasm(this.tree[0])}get currentFieldName(){return this.tree.language.fields[this.currentFieldId]}get currentDepth(){return marshalTreeCursor(this),C._ts_tree_cursor_current_depth_wasm(this.tree[0])}get currentDescendantIndex(){return marshalTreeCursor(this),C._ts_tree_cursor_current_descendant_index_wasm(this.tree[0])}gotoFirstChild(){marshalTreeCursor(this);let e=C._ts_tree_cursor_goto_first_child_wasm(this.tree[0]);return unmarshalTreeCursor(this),e===1}gotoLastChild(){marshalTreeCursor(this);let e=C._ts_tree_cursor_goto_last_child_wasm(this.tree[0]);return unmarshalTreeCursor(this),e===1}gotoFirstChildForIndex(e){marshalTreeCursor(this),setValue(TRANSFER_BUFFER+SIZE_OF_CURSOR,e,"i32");let r=C._ts_tree_cursor_goto_first_child_for_index_wasm(this.tree[0]);return unmarshalTreeCursor(this),r===1}gotoFirstChildForPosition(e){marshalTreeCursor(this),marshalPoint(TRANSFER_BUFFER+SIZE_OF_CURSOR,e);let r=C._ts_tree_cursor_goto_first_child_for_position_wasm(this.tree[0]);return unmarshalTreeCursor(this),r===1}gotoNextSibling(){marshalTreeCursor(this);let e=C._ts_tree_cursor_goto_next_sibling_wasm(this.tree[0]);return unmarshalTreeCursor(this),e===1}gotoPreviousSibling(){marshalTreeCursor(this);let e=C._ts_tree_cursor_goto_previous_sibling_wasm(this.tree[0]);return unmarshalTreeCursor(this),e===1}gotoDescendant(e){marshalTreeCursor(this),C._ts_tree_cursor_goto_descendant_wasm(this.tree[0],e),unmarshalTreeCursor(this)}gotoParent(){marshalTreeCursor(this);let e=C._ts_tree_cursor_goto_parent_wasm(this.tree[0]);return unmarshalTreeCursor(this),e===1}}class Language{constructor(e,r){assertInternal(e),this[0]=r,this.types=new Array(C._ts_language_symbol_count(this[0]));for(let n=0,o=this.types.length;n<o;n++)C._ts_language_symbol_type(this[0],n)<2&&(this.types[n]=UTF8ToString(C._ts_language_symbol_name(this[0],n)));this.fields=new Array(C._ts_language_field_count(this[0])+1);for(let n=0,o=this.fields.length;n<o;n++){let s=C._ts_language_field_name_for_id(this[0],n);this.fields[n]=s!==0?UTF8ToString(s):null}}get version(){return C._ts_language_version(this[0])}get fieldCount(){return this.fields.length-1}get stateCount(){return C._ts_language_state_count(this[0])}fieldIdForName(e){let r=this.fields.indexOf(e);return r!==-1?r:null}fieldNameForId(e){return this.fields[e]||null}idForNodeType(e,r){let n=lengthBytesUTF8(e),o=C._malloc(n+1);stringToUTF8(e,o,n+1);let s=C._ts_language_symbol_for_name(this[0],o,n,r);return C._free(o),s||null}get nodeTypeCount(){return C._ts_language_symbol_count(this[0])}nodeTypeForId(e){let r=C._ts_language_symbol_name(this[0],e);return r?UTF8ToString(r):null}nodeTypeIsNamed(e){return!!C._ts_language_type_is_named_wasm(this[0],e)}nodeTypeIsVisible(e){return!!C._ts_language_type_is_visible_wasm(this[0],e)}nextState(e,r){return C._ts_language_next_state(this[0],e,r)}lookaheadIterator(e){let r=C._ts_lookahead_iterator_new(this[0],e);return r?new LookaheadIterable(INTERNAL,r,this):null}query(e){let r=lengthBytesUTF8(e),n=C._malloc(r+1);stringToUTF8(e,n,r+1);let o=C._ts_query_new(this[0],n,r,TRANSFER_BUFFER,TRANSFER_BUFFER+SIZE_OF_INT);if(!o){let g=getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),v=getValue(TRANSFER_BUFFER,"i32"),y=UTF8ToString(n,v).length,_=e.substr(y,100).split(`
`)[0],x,S=_.match(QUERY_WORD_REGEX)[0];switch(g){case 2:x=new RangeError(`Bad node name '${S}'`);break;case 3:x=new RangeError(`Bad field name '${S}'`);break;case 4:x=new RangeError(`Bad capture name @${S}`);break;case 5:x=new TypeError(`Bad pattern structure at offset ${y}: '${_}'...`),S="";break;default:x=new SyntaxError(`Bad syntax at offset ${y}: '${_}'...`),S=""}throw x.index=y,x.length=S.length,C._free(n),x}let s=C._ts_query_string_count(o),a=C._ts_query_capture_count(o),c=C._ts_query_pattern_count(o),u=new Array(a),l=new Array(s);for(let g=0;g<a;g++){let v=C._ts_query_capture_name_for_id(o,g,TRANSFER_BUFFER),y=getValue(TRANSFER_BUFFER,"i32");u[g]=UTF8ToString(v,y)}for(let g=0;g<s;g++){let v=C._ts_query_string_value_for_id(o,g,TRANSFER_BUFFER),y=getValue(TRANSFER_BUFFER,"i32");l[g]=UTF8ToString(v,y)}let d=new Array(c),p=new Array(c),f=new Array(c),m=new Array(c),h=new Array(c);for(let g=0;g<c;g++){let v=C._ts_query_predicates_for_pattern(o,g,TRANSFER_BUFFER),y=getValue(TRANSFER_BUFFER,"i32");m[g]=[],h[g]=[];let _=[],x=v;for(let S=0;S<y;S++){let I=getValue(x,"i32");x+=SIZE_OF_INT;let E=getValue(x,"i32");if(x+=SIZE_OF_INT,I===PREDICATE_STEP_TYPE_CAPTURE)_.push({type:"capture",name:u[E]});else if(I===PREDICATE_STEP_TYPE_STRING)_.push({type:"string",value:l[E]});else if(_.length>0){if(_[0].type!=="string")throw new Error("Predicates must begin with a literal value");let R=_[0].value,B,V=!0,M=!0;switch(R){case"any-not-eq?":case"not-eq?":V=!1;case"any-eq?":case"eq?":if(_.length!==3)throw new Error(`Wrong number of arguments to \`#${R}\` predicate. Expected 2, got ${_.length-1}`);if(_[1].type!=="capture")throw new Error(`First argument of \`#${R}\` predicate must be a capture. Got "${_[1].value}"`);if(M=!R.startsWith("any-"),_[2].type==="capture"){let P=_[1].name,k=_[2].name;h[g].push(U=>{let F=[],$=[];for(let Y of U)Y.name===P&&F.push(Y.node),Y.name===k&&$.push(Y.node);let ce=(Y,j,xe)=>xe?Y.text===j.text:Y.text!==j.text;return M?F.every(Y=>$.some(j=>ce(Y,j,V))):F.some(Y=>$.some(j=>ce(Y,j,V)))})}else{B=_[1].name;let P=_[2].value,k=F=>F.text===P,U=F=>F.text!==P;h[g].push(F=>{let $=[];for(let Y of F)Y.name===B&&$.push(Y.node);let ce=V?k:U;return M?$.every(ce):$.some(ce)})}break;case"any-not-match?":case"not-match?":V=!1;case"any-match?":case"match?":if(_.length!==3)throw new Error(`Wrong number of arguments to \`#${R}\` predicate. Expected 2, got ${_.length-1}.`);if(_[1].type!=="capture")throw new Error(`First argument of \`#${R}\` predicate must be a capture. Got "${_[1].value}".`);if(_[2].type!=="string")throw new Error(`Second argument of \`#${R}\` predicate must be a string. Got @${_[2].value}.`);B=_[1].name;let le=new RegExp(_[2].value);M=!R.startsWith("any-"),h[g].push(P=>{let k=[];for(let F of P)F.name===B&&k.push(F.node.text);let U=(F,$)=>$?le.test(F):!le.test(F);return k.length===0?!V:M?k.every(F=>U(F,V)):k.some(F=>U(F,V))});break;case"set!":if(_.length<2||_.length>3)throw new Error(`Wrong number of arguments to \`#set!\` predicate. Expected 1 or 2. Got ${_.length-1}.`);if(_.some(P=>P.type!=="string"))throw new Error('Arguments to `#set!` predicate must be a strings.".');d[g]||(d[g]={}),d[g][_[1].value]=_[2]?_[2].value:null;break;case"is?":case"is-not?":if(_.length<2||_.length>3)throw new Error(`Wrong number of arguments to \`#${R}\` predicate. Expected 1 or 2. Got ${_.length-1}.`);if(_.some(P=>P.type!=="string"))throw new Error(`Arguments to \`#${R}\` predicate must be a strings.".`);let ne=R==="is?"?p:f;ne[g]||(ne[g]={}),ne[g][_[1].value]=_[2]?_[2].value:null;break;case"not-any-of?":V=!1;case"any-of?":if(_.length<2)throw new Error(`Wrong number of arguments to \`#${R}\` predicate. Expected at least 1. Got ${_.length-1}.`);if(_[1].type!=="capture")throw new Error(`First argument of \`#${R}\` predicate must be a capture. Got "${_[1].value}".`);for(let P=2;P<_.length;P++)if(_[P].type!=="string")throw new Error(`Arguments to \`#${R}\` predicate must be a strings.".`);B=_[1].name;let q=_.slice(2).map(P=>P.value);h[g].push(P=>{let k=[];for(let U of P)U.name===B&&k.push(U.node.text);return k.length===0?!V:k.every(U=>q.includes(U))===V});break;default:m[g].push({operator:R,operands:_.slice(1)})}_.length=0}}Object.freeze(d[g]),Object.freeze(p[g]),Object.freeze(f[g])}return C._free(n),new Query(INTERNAL,o,u,h,m,Object.freeze(d),Object.freeze(p),Object.freeze(f))}static load(e){let r;if(e instanceof Uint8Array)r=Promise.resolve(e);else{let n=e;if(typeof process<"u"&&process.versions&&process.versions.node){let o=require("fs");r=Promise.resolve(o.readFileSync(n))}else r=fetch(n).then(o=>o.arrayBuffer().then(s=>{if(o.ok)return new Uint8Array(s);{let a=new TextDecoder("utf-8").decode(s);throw new Error(`Language.load failed with status ${o.status}.

${a}`)}}))}return r.then(n=>loadWebAssemblyModule(n,{loadAsync:!0})).then(n=>{let o=Object.keys(n),s=o.find(c=>LANGUAGE_FUNCTION_REGEX.test(c)&&!c.includes("external_scanner_"));s||console.log(`Couldn't find language function in WASM file. Symbols:
${JSON.stringify(o,null,2)}`);let a=n[s]();return new Language(INTERNAL,a)})}}class LookaheadIterable{constructor(e,r,n){assertInternal(e),this[0]=r,this.language=n}get currentTypeId(){return C._ts_lookahead_iterator_current_symbol(this[0])}get currentType(){return this.language.types[this.currentTypeId]||"ERROR"}delete(){C._ts_lookahead_iterator_delete(this[0]),this[0]=0}resetState(e){return C._ts_lookahead_iterator_reset_state(this[0],e)}reset(e,r){return!!C._ts_lookahead_iterator_reset(this[0],e[0],r)&&(this.language=e,!0)}[Symbol.iterator](){let e=this;return{next:()=>C._ts_lookahead_iterator_next(e[0])?{done:!1,value:e.currentType}:{done:!0,value:""}}}}class Query{constructor(e,r,n,o,s,a,c,u){assertInternal(e),this[0]=r,this.captureNames=n,this.textPredicates=o,this.predicates=s,this.setProperties=a,this.assertedProperties=c,this.refutedProperties=u,this.exceededMatchLimit=!1}delete(){C._ts_query_delete(this[0]),this[0]=0}matches(e,{startPosition:r=ZERO_POINT,endPosition:n=ZERO_POINT,startIndex:o=0,endIndex:s=0,matchLimit:a=4294967295,maxStartDepth:c=4294967295}={}){if(typeof a!="number")throw new Error("Arguments must be numbers");marshalNode(e),C._ts_query_matches_wasm(this[0],e.tree[0],r.row,r.column,n.row,n.column,o,s,a,c);let u=getValue(TRANSFER_BUFFER,"i32"),l=getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),d=getValue(TRANSFER_BUFFER+2*SIZE_OF_INT,"i32"),p=new Array(u);this.exceededMatchLimit=!!d;let f=0,m=l;for(let h=0;h<u;h++){let g=getValue(m,"i32");m+=SIZE_OF_INT;let v=getValue(m,"i32");m+=SIZE_OF_INT;let y=new Array(v);if(m=unmarshalCaptures(this,e.tree,m,y),this.textPredicates[g].every(_=>_(y))){p[f]={pattern:g,captures:y};let _=this.setProperties[g];_&&(p[f].setProperties=_);let x=this.assertedProperties[g];x&&(p[f].assertedProperties=x);let S=this.refutedProperties[g];S&&(p[f].refutedProperties=S),f++}}return p.length=f,C._free(l),p}captures(e,{startPosition:r=ZERO_POINT,endPosition:n=ZERO_POINT,startIndex:o=0,endIndex:s=0,matchLimit:a=4294967295,maxStartDepth:c=4294967295}={}){if(typeof a!="number")throw new Error("Arguments must be numbers");marshalNode(e),C._ts_query_captures_wasm(this[0],e.tree[0],r.row,r.column,n.row,n.column,o,s,a,c);let u=getValue(TRANSFER_BUFFER,"i32"),l=getValue(TRANSFER_BUFFER+SIZE_OF_INT,"i32"),d=getValue(TRANSFER_BUFFER+2*SIZE_OF_INT,"i32"),p=[];this.exceededMatchLimit=!!d;let f=[],m=l;for(let h=0;h<u;h++){let g=getValue(m,"i32");m+=SIZE_OF_INT;let v=getValue(m,"i32");m+=SIZE_OF_INT;let y=getValue(m,"i32");if(m+=SIZE_OF_INT,f.length=v,m=unmarshalCaptures(this,e.tree,m,f),this.textPredicates[g].every(_=>_(f))){let _=f[y],x=this.setProperties[g];x&&(_.setProperties=x);let S=this.assertedProperties[g];S&&(_.assertedProperties=S);let I=this.refutedProperties[g];I&&(_.refutedProperties=I),p.push(_)}}return C._free(l),p}predicatesForPattern(e){return this.predicates[e]}disableCapture(e){let r=lengthBytesUTF8(e),n=C._malloc(r+1);stringToUTF8(e,n,r+1),C._ts_query_disable_capture(this[0],n,r),C._free(n)}didExceedMatchLimit(){return this.exceededMatchLimit}}function getText(t,e,r){let n=r-e,o=t.textCallback(e,null,r);for(e+=o.length;e<r;){let s=t.textCallback(e,null,r);if(!(s&&s.length>0))break;e+=s.length,o+=s}return e>r&&(o=o.slice(0,n)),o}function unmarshalCaptures(t,e,r,n){for(let o=0,s=n.length;o<s;o++){let a=getValue(r,"i32"),c=unmarshalNode(e,r+=SIZE_OF_INT);r+=SIZE_OF_NODE,n[o]={name:t.captureNames[a],node:c}}return r}function assertInternal(t){if(t!==INTERNAL)throw new Error("Illegal constructor")}function isPoint(t){return t&&typeof t.row=="number"&&typeof t.column=="number"}function marshalNode(t){let e=TRANSFER_BUFFER;setValue(e,t.id,"i32"),e+=SIZE_OF_INT,setValue(e,t.startIndex,"i32"),e+=SIZE_OF_INT,setValue(e,t.startPosition.row,"i32"),e+=SIZE_OF_INT,setValue(e,t.startPosition.column,"i32"),e+=SIZE_OF_INT,setValue(e,t[0],"i32")}function unmarshalNode(t,e=TRANSFER_BUFFER){let r=getValue(e,"i32");if(r===0)return null;let n=getValue(e+=SIZE_OF_INT,"i32"),o=getValue(e+=SIZE_OF_INT,"i32"),s=getValue(e+=SIZE_OF_INT,"i32"),a=getValue(e+=SIZE_OF_INT,"i32"),c=new Node(INTERNAL,t);return c.id=r,c.startIndex=n,c.startPosition={row:o,column:s},c[0]=a,c}function marshalTreeCursor(t,e=TRANSFER_BUFFER){setValue(e+0*SIZE_OF_INT,t[0],"i32"),setValue(e+1*SIZE_OF_INT,t[1],"i32"),setValue(e+2*SIZE_OF_INT,t[2],"i32"),setValue(e+3*SIZE_OF_INT,t[3],"i32")}function unmarshalTreeCursor(t){t[0]=getValue(TRANSFER_BUFFER+0*SIZE_OF_INT,"i32"),t[1]=getValue(TRANSFER_BUFFER+1*SIZE_OF_INT,"i32"),t[2]=getValue(TRANSFER_BUFFER+2*SIZE_OF_INT,"i32"),t[3]=getValue(TRANSFER_BUFFER+3*SIZE_OF_INT,"i32")}function marshalPoint(t,e){setValue(t,e.row,"i32"),setValue(t+SIZE_OF_INT,e.column,"i32")}function unmarshalPoint(t){return{row:getValue(t,"i32")>>>0,column:getValue(t+SIZE_OF_INT,"i32")>>>0}}function marshalRange(t,e){marshalPoint(t,e.startPosition),marshalPoint(t+=SIZE_OF_POINT,e.endPosition),setValue(t+=SIZE_OF_POINT,e.startIndex,"i32"),setValue(t+=SIZE_OF_INT,e.endIndex,"i32"),t+=SIZE_OF_INT}function unmarshalRange(t){let e={};return e.startPosition=unmarshalPoint(t),t+=SIZE_OF_POINT,e.endPosition=unmarshalPoint(t),t+=SIZE_OF_POINT,e.startIndex=getValue(t,"i32")>>>0,t+=SIZE_OF_INT,e.endIndex=getValue(t,"i32")>>>0,e}function marshalEdit(t){let e=TRANSFER_BUFFER;marshalPoint(e,t.startPosition),e+=SIZE_OF_POINT,marshalPoint(e,t.oldEndPosition),e+=SIZE_OF_POINT,marshalPoint(e,t.newEndPosition),e+=SIZE_OF_POINT,setValue(e,t.startIndex,"i32"),e+=SIZE_OF_INT,setValue(e,t.oldEndIndex,"i32"),e+=SIZE_OF_INT,setValue(e,t.newEndIndex,"i32"),e+=SIZE_OF_INT}for(let t of Object.getOwnPropertyNames(ParserImpl.prototype))Object.defineProperty(Parser.prototype,t,{value:ParserImpl.prototype[t],enumerable:!1,writable:!1});Parser.Language=Language,Module.onRuntimeInitialized=()=>{ParserImpl.init(),resolveInitPromise()}}))}}return Parser}();typeof exports=="object"&&(module.exports=TreeSitter)});var JK=O(Tr=>{"use strict";var QK=Tr&&Tr.__awaiter||function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},XK=Tr&&Tr.__generator||function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};Object.defineProperty(Tr,"__esModule",{value:!0});Tr.getShallowFileSize=Tr.getShallowDirectorySizeSync=Tr.getShallowDirectorySize=Tr.confirmDirExists=Tr.unlinkAsync=Tr.readdirAsync=Tr.readFileAsync=Tr.writeFileAsync=Tr.appendFileAsync=Tr.accessAsync=Tr.mkdirAsync=Tr.lstatAsync=Tr.statAsync=void 0;var ed=require("fs"),fbe=require("path"),Em=require("util");Tr.statAsync=Em.promisify(ed.stat);Tr.lstatAsync=Em.promisify(ed.lstat);Tr.mkdirAsync=Em.promisify(ed.mkdir);Tr.accessAsync=Em.promisify(ed.access);Tr.appendFileAsync=Em.promisify(ed.appendFile);Tr.writeFileAsync=Em.promisify(ed.writeFile);Tr.readFileAsync=Em.promisify(ed.readFile);Tr.readdirAsync=Em.promisify(ed.readdir);Tr.unlinkAsync=Em.promisify(ed.unlink);var dKe=function(t){return QK(void 0,void 0,void 0,function(){var e,r,n;return XK(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,7]),[4,Tr.lstatAsync(t)];case 1:if(e=o.sent(),!e.isDirectory())throw new Error("Path existed but was not a directory");return[3,7];case 2:if(r=o.sent(),!(r&&r.code==="ENOENT"))return[3,6];o.label=3;case 3:return o.trys.push([3,5,,6]),[4,Tr.mkdirAsync(t)];case 4:return o.sent(),[3,6];case 5:if(n=o.sent(),n&&n.code!=="EEXIST")throw n;return[3,6];case 6:return[3,7];case 7:return[2]}})})};Tr.confirmDirExists=dKe;var pKe=function(t){return QK(void 0,void 0,void 0,function(){var e,r,n,o,s,a;return XK(this,function(c){switch(c.label){case 0:return[4,Tr.readdirAsync(t)];case 1:e=c.sent(),r=0,n=0,o=e,c.label=2;case 2:return n<o.length?(s=o[n],[4,Tr.statAsync(fbe.join(t,s))]):[3,5];case 3:a=c.sent(),a.isFile()&&(r+=a.size),c.label=4;case 4:return n++,[3,2];case 5:return[2,r]}})})};Tr.getShallowDirectorySize=pKe;var fKe=function(t){for(var e=ed.readdirSync(t),r=0,n=0;n<e.length;n++)r+=ed.statSync(fbe.join(t,e[n])).size;return r};Tr.getShallowDirectorySizeSync=fKe;var mKe=function(t){return QK(void 0,void 0,void 0,function(){var e;return XK(this,function(r){switch(r.label){case 0:return[4,Tr.statAsync(t)];case 1:return e=r.sent(),e.isFile()?[2,e.size]:[2]}})})};Tr.getShallowFileSize=mKe});var gbe=O((e_,hbe)=>{"use strict";var ZK=e_&&e_.__awaiter||function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},eY=e_&&e_.__generator||function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},mbe=e_&&e_.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,o++)n[o]=s[a];return n},hKe=require("fs"),gKe=require("os"),Zy=require("path"),Rp=JK(),vKe=function(){function t(){var e=this;this.TAG="Logger",this._cleanupTimeOut=60*30*1e3,this._tempDir="",this._logFileName="",this._fileFullPath="",this._backUpNameFormat="",this._logToFile=!1,this._logToConsole=!0;var r=process.env.APPLICATIONINSIGHTS_LOG_DESTINATION;r=="file+console"&&(this._logToFile=!0),r=="file"&&(this._logToFile=!0,this._logToConsole=!1),this.maxSizeBytes=5e4,this.maxHistory=1,this._logFileName="applicationinsights.log";var n=process.env.APPLICATIONINSIGHTS_LOGDIR;n?Zy.isAbsolute(n)?this._tempDir=n:this._tempDir=Zy.join(process.cwd(),n):this._tempDir=Zy.join(gKe.tmpdir(),"appInsights-node"),this._fileFullPath=Zy.join(this._tempDir,this._logFileName),this._backUpNameFormat="."+this._logFileName,this._logToFile&&(t._fileCleanupTimer||(t._fileCleanupTimer=setInterval(function(){e._fileCleanupTask()},this._cleanupTimeOut),t._fileCleanupTimer.unref()))}return t.prototype.info=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=e?mbe([e],r):r;this._logToFile&&this._storeToDisk(o),this._logToConsole&&console.info.apply(console,o)},t.prototype.warning=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=e?mbe([e],r):r;this._logToFile&&this._storeToDisk(o),this._logToConsole&&console.warn.apply(console,o)},t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype._storeToDisk=function(e){return ZK(this,void 0,void 0,function(){var r,n,o,s,a,c;return eY(this,function(u){switch(u.label){case 0:r=e+`\r
`,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,Rp.confirmDirExists(this._tempDir)];case 2:return u.sent(),[3,4];case 3:return n=u.sent(),console.log(this.TAG,"Failed to create directory for log file: "+(n&&n.message)),[2];case 4:return u.trys.push([4,6,,11]),[4,Rp.accessAsync(this._fileFullPath,hKe.constants.F_OK)];case 5:return u.sent(),[3,11];case 6:o=u.sent(),u.label=7;case 7:return u.trys.push([7,9,,10]),[4,Rp.appendFileAsync(this._fileFullPath,r)];case 8:return u.sent(),[2];case 9:return s=u.sent(),console.log(this.TAG,"Failed to put log into file: "+(o&&o.message)),[2];case 10:return[3,11];case 11:return u.trys.push([11,17,,18]),[4,Rp.getShallowFileSize(this._fileFullPath)];case 12:return a=u.sent(),a>this.maxSizeBytes?[4,this._createBackupFile(r)]:[3,14];case 13:return u.sent(),[3,16];case 14:return[4,Rp.appendFileAsync(this._fileFullPath,r)];case 15:u.sent(),u.label=16;case 16:return[3,18];case 17:return c=u.sent(),console.log(this.TAG,"Failed to create backup file: "+(c&&c.message)),[3,18];case 18:return[2]}})})},t.prototype._createBackupFile=function(e){return ZK(this,void 0,void 0,function(){var r,n,o;return eY(this,function(s){switch(s.label){case 0:return s.trys.push([0,3,4,5]),[4,Rp.readFileAsync(this._fileFullPath)];case 1:return r=s.sent(),n=Zy.join(this._tempDir,new Date().getTime()+"."+this._logFileName),[4,Rp.writeFileAsync(n,r)];case 2:return s.sent(),[3,5];case 3:return o=s.sent(),console.log("Failed to generate backup log file",o),[3,5];case 4:return Rp.writeFileAsync(this._fileFullPath,e),[7];case 5:return[2]}})})},t.prototype._fileCleanupTask=function(){return ZK(this,void 0,void 0,function(){var e,r,n,o,s,a=this;return eY(this,function(c){switch(c.label){case 0:return c.trys.push([0,6,,7]),[4,Rp.readdirAsync(this._tempDir)];case 1:e=c.sent(),e=e.filter(function(u){return Zy.basename(u).indexOf(a._backUpNameFormat)>-1}),e.sort(function(u,l){var d=new Date(parseInt(u.split(a._backUpNameFormat)[0])),p=new Date(parseInt(l.split(a._backUpNameFormat)[0]));if(d<p)return-1;if(d>=p)return 1}),r=e.length,n=0,c.label=2;case 2:return n<r-this.maxHistory?(o=Zy.join(this._tempDir,e[n]),[4,Rp.unlinkAsync(o)]):[3,5];case 3:c.sent(),c.label=4;case 4:return n++,[3,2];case 5:return[3,7];case 6:return s=c.sent(),console.log(this.TAG,"Failed to cleanup log files: "+(s&&s.message)),[3,7];case 7:return[2]}})})},t._fileCleanupTimer=null,t}();hbe.exports=vKe});var Wn=O((MIr,bbe)=>{"use strict";var vbe=gbe(),bKe="APPLICATION_INSIGHTS_ENABLE_DEBUG_LOGS",yKe="APPLICATION_INSIGHTS_DISABLE_WARNING_LOGS",_Ke=function(){function t(){}return t.info=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.enableDebug&&vbe.getInstance().info(this.TAG+e,r)},t.warn=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this.disableWarnings||vbe.getInstance().warning(this.TAG+e,r)},t.enableDebug=!!process.env[bKe],t.disableWarnings=!!process.env[yKe],t.TAG="ApplicationInsights:",t}();bbe.exports=_Ke});var JF=O(XF=>{"use strict";Object.defineProperty(XF,"__esModule",{value:!0});XF.JsonConfig=void 0;var xKe=require("fs"),QF=require("path"),tY=Wn(),SKe="APPLICATIONINSIGHTS_CONFIGURATION_FILE",IKe="APPLICATIONINSIGHTS_CONNECTION_STRING",ybe="APPSETTING_",_be="APPINSIGHTS_INSTRUMENTATIONKEY",xbe="APPINSIGHTS_INSTRUMENTATION_KEY",CKe="APPLICATION_INSIGHTS_DISABLE_EXTENDED_METRIC",TKe="APPLICATION_INSIGHTS_DISABLE_ALL_EXTENDED_METRICS",EKe="http_proxy",wKe="https_proxy",RKe="APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL",kKe="APPLICATION_INSIGHTS_NO_STATSBEAT",PKe="APPLICATION_INSIGHTS_NO_HTTP_AGENT_KEEP_ALIVE",AKe="APPLICATION_INSIGHTS_NO_PATCH_MODULES",DKe="APPLICATIONINSIGHTS_WEB_INSTRUMENTATION_ENABLED",NKe="APPLICATIONINSIGHTS_WEB_INSTRUMENTATION_CONNECTION_STRING",LKe="APPLICATIONINSIGHTS_WEB_INSTRUMENTATION_SOURCE",OKe="APPLICATIONINSIGHTS_WEB_SNIPPET_ENABLED",MKe="APPLICATIONINSIGHTS_WEB_SNIPPET_CONNECTION_STRING",FKe=function(){function t(){this.connectionString=process.env[IKe],this.instrumentationKey=process.env[_be]||process.env[ybe+_be]||process.env[xbe]||process.env[ybe+xbe],!this.connectionString&&this.instrumentationKey&&tY.warn("APPINSIGHTS_INSTRUMENTATIONKEY is in path of deprecation, please use APPLICATIONINSIGHTS_CONNECTION_STRING env variable to setup the SDK."),this.disableAllExtendedMetrics=!!process.env[TKe],this.extendedMetricDisablers=process.env[CKe],this.proxyHttpUrl=process.env[EKe],this.proxyHttpsUrl=process.env[wKe],this.noDiagnosticChannel=!!process.env[RKe],this.disableStatsbeat=!!process.env[kKe],this.noHttpAgentKeepAlive=!!process.env[PKe],this.noPatchModules=process.env[AKe]||"",this.enableWebInstrumentation=!!process.env[DKe]||!!process.env[OKe],this.webInstrumentationSrc=process.env[LKe]||"",this.webInstrumentationConnectionString=process.env[NKe]||process.env[MKe]||"",this.enableAutoWebSnippetInjection=this.enableWebInstrumentation,this.webSnippetConnectionString=this.webInstrumentationConnectionString,this._loadJsonFile()}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype._loadJsonFile=function(){var e="",r="{}";if(r)e=r;else{var n="applicationinsights.json",o=QF.join(__dirname,"../../"),s=QF.join(o,n),a=process.env[SKe];a&&(QF.isAbsolute(a)?s=a:s=QF.join(o,a));try{e=xKe.readFileSync(s,"utf8")}catch(u){tY.warn("Failed to read JSON config file: ",u)}}try{var c=JSON.parse(e);c.disableStatsbeat!=null&&(this.disableStatsbeat=c.disableStatsbeat),c.disableAllExtendedMetrics!=null&&(this.disableAllExtendedMetrics=c.disableStatsbeat),c.noDiagnosticChannel!=null&&(this.noDiagnosticChannel=c.noDiagnosticChannel),c.noHttpAgentKeepAlive!=null&&(this.noHttpAgentKeepAlive=c.noHttpAgentKeepAlive),c.connectionString!=null&&(this.connectionString=c.connectionString),c.extendedMetricDisablers!=null&&(this.extendedMetricDisablers=c.extendedMetricDisablers),c.noDiagnosticChannel!=null&&(this.noDiagnosticChannel=c.noDiagnosticChannel),c.proxyHttpUrl!=null&&(this.proxyHttpUrl=c.proxyHttpUrl),c.proxyHttpsUrl!=null&&(this.proxyHttpsUrl=c.proxyHttpsUrl),c.proxyHttpsUrl!=null&&(this.proxyHttpsUrl=c.proxyHttpsUrl),c.noPatchModules!=null&&(this.noPatchModules=c.noPatchModules),c.enableAutoWebSnippetInjection!=null&&(this.enableWebInstrumentation=c.enableAutoWebSnippetInjection,this.enableAutoWebSnippetInjection=this.enableWebInstrumentation),c.enableWebInstrumentation!=null&&(this.enableWebInstrumentation=c.enableWebInstrumentation,this.enableAutoWebSnippetInjection=this.enableWebInstrumentation),c.webSnippetConnectionString!=null&&(this.webInstrumentationConnectionString=c.webSnippetConnectionString,this.webSnippetConnectionString=this.webInstrumentationConnectionString),c.webInstrumentationConnectionString!=null&&(this.webInstrumentationConnectionString=c.webInstrumentationConnectionString,this.webSnippetConnectionString=this.webInstrumentationConnectionString),c.webInstrumentationConfig!=null&&(this.webInstrumentationConfig=c.webInstrumentationConfig),c.webInstrumentationSrc!=null&&(this.webInstrumentationSrc=c.webInstrumentationSrc),c.enableLoggerErrorToTrace!=null&&(this.enableLoggerErrorToTrace=c.enableLoggerErrorToTrace),this.endpointUrl=c.endpointUrl,this.maxBatchSize=c.maxBatchSize,this.maxBatchIntervalMs=c.maxBatchIntervalMs,this.disableAppInsights=c.disableAppInsights,this.samplingPercentage=c.samplingPercentage,this.correlationIdRetryIntervalMs=c.correlationIdRetryIntervalMs,this.correlationHeaderExcludedDomains=c.correlationHeaderExcludedDomains,this.ignoreLegacyHeaders=c.ignoreLegacyHeaders,this.distributedTracingMode=c.distributedTracingMode,this.enableAutoCollectExternalLoggers=c.enableAutoCollectExternalLoggers,this.enableAutoCollectConsole=c.enableAutoCollectConsole,this.enableLoggerErrorToTrace=c.enableLoggerErrorToTrace,this.enableAutoCollectExceptions=c.enableAutoCollectExceptions,this.enableAutoCollectPerformance=c.enableAutoCollectPerformance,this.enableAutoCollectExtendedMetrics=c.enableAutoCollectExtendedMetrics,this.enableAutoCollectPreAggregatedMetrics=c.enableAutoCollectPreAggregatedMetrics,this.enableAutoCollectHeartbeat=c.enableAutoCollectHeartbeat,this.enableAutoCollectRequests=c.enableAutoCollectRequests,this.enableAutoCollectDependencies=c.enableAutoCollectDependencies,this.enableAutoDependencyCorrelation=c.enableAutoDependencyCorrelation,this.enableAutoCollectIncomingRequestAzureFunctions=c.enableAutoCollectIncomingRequestAzureFunctions,this.enableUseAsyncHooks=c.enableUseAsyncHooks,this.enableUseDiskRetryCaching=c.enableUseDiskRetryCaching,this.enableResendInterval=c.enableResendInterval,this.enableMaxBytesOnDisk=c.enableMaxBytesOnDisk,this.enableInternalDebugLogging=c.enableInternalDebugLogging,this.enableInternalWarningLogging=c.enableInternalWarningLogging,this.enableSendLiveMetrics=c.enableSendLiveMetrics,this.quickPulseHost=c.quickPulseHost}catch(u){tY.warn("Invalid JSON config file: ",u)}},t}();XF.JsonConfig=FKe});var F2=O((UIr,Sbe)=>{var UKe="2.0.0",BKe=Number.MAX_SAFE_INTEGER||9007199254740991,qKe=16,jKe=250,HKe=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Sbe.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:qKe,MAX_SAFE_BUILD_LENGTH:jKe,MAX_SAFE_INTEGER:BKe,RELEASE_TYPES:HKe,SEMVER_SPEC_VERSION:UKe,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var U2=O((BIr,Ibe)=>{var VKe=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};Ibe.exports=VKe});var vT=O((wm,Cbe)=>{var{MAX_SAFE_COMPONENT_LENGTH:rY,MAX_SAFE_BUILD_LENGTH:GKe,MAX_LENGTH:zKe}=F2(),$Ke=U2();wm=Cbe.exports={};var WKe=wm.re=[],KKe=wm.safeRe=[],pt=wm.src=[],ft=wm.t={},YKe=0,nY="[a-zA-Z0-9-]",QKe=[["\\s",1],["\\d",zKe],[nY,GKe]],XKe=t=>{for(let[e,r]of QKe)t=t.split(`${e}*`).join(`${e}{0,${r}}`).split(`${e}+`).join(`${e}{1,${r}}`);return t},Zt=(t,e,r)=>{let n=XKe(e),o=YKe++;$Ke(t,o,e),ft[t]=o,pt[o]=e,WKe[o]=new RegExp(e,r?"g":void 0),KKe[o]=new RegExp(n,r?"g":void 0)};Zt("NUMERICIDENTIFIER","0|[1-9]\\d*");Zt("NUMERICIDENTIFIERLOOSE","\\d+");Zt("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${nY}*`);Zt("MAINVERSION",`(${pt[ft.NUMERICIDENTIFIER]})\\.(${pt[ft.NUMERICIDENTIFIER]})\\.(${pt[ft.NUMERICIDENTIFIER]})`);Zt("MAINVERSIONLOOSE",`(${pt[ft.NUMERICIDENTIFIERLOOSE]})\\.(${pt[ft.NUMERICIDENTIFIERLOOSE]})\\.(${pt[ft.NUMERICIDENTIFIERLOOSE]})`);Zt("PRERELEASEIDENTIFIER",`(?:${pt[ft.NUMERICIDENTIFIER]}|${pt[ft.NONNUMERICIDENTIFIER]})`);Zt("PRERELEASEIDENTIFIERLOOSE",`(?:${pt[ft.NUMERICIDENTIFIERLOOSE]}|${pt[ft.NONNUMERICIDENTIFIER]})`);Zt("PRERELEASE",`(?:-(${pt[ft.PRERELEASEIDENTIFIER]}(?:\\.${pt[ft.PRERELEASEIDENTIFIER]})*))`);Zt("PRERELEASELOOSE",`(?:-?(${pt[ft.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${pt[ft.PRERELEASEIDENTIFIERLOOSE]})*))`);Zt("BUILDIDENTIFIER",`${nY}+`);Zt("BUILD",`(?:\\+(${pt[ft.BUILDIDENTIFIER]}(?:\\.${pt[ft.BUILDIDENTIFIER]})*))`);Zt("FULLPLAIN",`v?${pt[ft.MAINVERSION]}${pt[ft.PRERELEASE]}?${pt[ft.BUILD]}?`);Zt("FULL",`^${pt[ft.FULLPLAIN]}$`);Zt("LOOSEPLAIN",`[v=\\s]*${pt[ft.MAINVERSIONLOOSE]}${pt[ft.PRERELEASELOOSE]}?${pt[ft.BUILD]}?`);Zt("LOOSE",`^${pt[ft.LOOSEPLAIN]}$`);Zt("GTLT","((?:<|>)?=?)");Zt("XRANGEIDENTIFIERLOOSE",`${pt[ft.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);Zt("XRANGEIDENTIFIER",`${pt[ft.NUMERICIDENTIFIER]}|x|X|\\*`);Zt("XRANGEPLAIN",`[v=\\s]*(${pt[ft.XRANGEIDENTIFIER]})(?:\\.(${pt[ft.XRANGEIDENTIFIER]})(?:\\.(${pt[ft.XRANGEIDENTIFIER]})(?:${pt[ft.PRERELEASE]})?${pt[ft.BUILD]}?)?)?`);Zt("XRANGEPLAINLOOSE",`[v=\\s]*(${pt[ft.XRANGEIDENTIFIERLOOSE]})(?:\\.(${pt[ft.XRANGEIDENTIFIERLOOSE]})(?:\\.(${pt[ft.XRANGEIDENTIFIERLOOSE]})(?:${pt[ft.PRERELEASELOOSE]})?${pt[ft.BUILD]}?)?)?`);Zt("XRANGE",`^${pt[ft.GTLT]}\\s*${pt[ft.XRANGEPLAIN]}$`);Zt("XRANGELOOSE",`^${pt[ft.GTLT]}\\s*${pt[ft.XRANGEPLAINLOOSE]}$`);Zt("COERCEPLAIN",`(^|[^\\d])(\\d{1,${rY}})(?:\\.(\\d{1,${rY}}))?(?:\\.(\\d{1,${rY}}))?`);Zt("COERCE",`${pt[ft.COERCEPLAIN]}(?:$|[^\\d])`);Zt("COERCEFULL",pt[ft.COERCEPLAIN]+`(?:${pt[ft.PRERELEASE]})?(?:${pt[ft.BUILD]})?(?:$|[^\\d])`);Zt("COERCERTL",pt[ft.COERCE],!0);Zt("COERCERTLFULL",pt[ft.COERCEFULL],!0);Zt("LONETILDE","(?:~>?)");Zt("TILDETRIM",`(\\s*)${pt[ft.LONETILDE]}\\s+`,!0);wm.tildeTrimReplace="$1~";Zt("TILDE",`^${pt[ft.LONETILDE]}${pt[ft.XRANGEPLAIN]}$`);Zt("TILDELOOSE",`^${pt[ft.LONETILDE]}${pt[ft.XRANGEPLAINLOOSE]}$`);Zt("LONECARET","(?:\\^)");Zt("CARETTRIM",`(\\s*)${pt[ft.LONECARET]}\\s+`,!0);wm.caretTrimReplace="$1^";Zt("CARET",`^${pt[ft.LONECARET]}${pt[ft.XRANGEPLAIN]}$`);Zt("CARETLOOSE",`^${pt[ft.LONECARET]}${pt[ft.XRANGEPLAINLOOSE]}$`);Zt("COMPARATORLOOSE",`^${pt[ft.GTLT]}\\s*(${pt[ft.LOOSEPLAIN]})$|^$`);Zt("COMPARATOR",`^${pt[ft.GTLT]}\\s*(${pt[ft.FULLPLAIN]})$|^$`);Zt("COMPARATORTRIM",`(\\s*)${pt[ft.GTLT]}\\s*(${pt[ft.LOOSEPLAIN]}|${pt[ft.XRANGEPLAIN]})`,!0);wm.comparatorTrimReplace="$1$2$3";Zt("HYPHENRANGE",`^\\s*(${pt[ft.XRANGEPLAIN]})\\s+-\\s+(${pt[ft.XRANGEPLAIN]})\\s*$`);Zt("HYPHENRANGELOOSE",`^\\s*(${pt[ft.XRANGEPLAINLOOSE]})\\s+-\\s+(${pt[ft.XRANGEPLAINLOOSE]})\\s*$`);Zt("STAR","(<|>)?=?\\s*\\*");Zt("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");Zt("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var ZF=O((qIr,Tbe)=>{var JKe=Object.freeze({loose:!0}),ZKe=Object.freeze({}),eYe=t=>t?typeof t!="object"?JKe:t:ZKe;Tbe.exports=eYe});var iY=O((jIr,Rbe)=>{var Ebe=/^[0-9]+$/,wbe=(t,e)=>{let r=Ebe.test(t),n=Ebe.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1},tYe=(t,e)=>wbe(e,t);Rbe.exports={compareIdentifiers:wbe,rcompareIdentifiers:tYe}});var Ks=O((HIr,Dbe)=>{var e6=U2(),{MAX_LENGTH:kbe,MAX_SAFE_INTEGER:t6}=F2(),{safeRe:Pbe,t:Abe}=vT(),rYe=ZF(),{compareIdentifiers:bT}=iY(),oY=class t{constructor(e,r){if(r=rYe(r),e instanceof t){if(e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>kbe)throw new TypeError(`version is longer than ${kbe} characters`);e6("SemVer",e,r),this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease;let n=e.trim().match(r.loose?Pbe[Abe.LOOSE]:Pbe[Abe.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>t6||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t6||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t6||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(o=>{if(/^[0-9]+$/.test(o)){let s=+o;if(s>=0&&s<t6)return s}return o}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(e6("SemVer.compare",this.version,this.options,e),!(e instanceof t)){if(typeof e=="string"&&e===this.version)return 0;e=new t(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof t||(e=new t(e,this.options)),bT(this.major,e.major)||bT(this.minor,e.minor)||bT(this.patch,e.patch)}comparePre(e){if(e instanceof t||(e=new t(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let r=0;do{let n=this.prerelease[r],o=e.prerelease[r];if(e6("prerelease compare",r,n,o),n===void 0&&o===void 0)return 0;if(o===void 0)return 1;if(n===void 0)return-1;if(n===o)continue;return bT(n,o)}while(++r)}compareBuild(e){e instanceof t||(e=new t(e,this.options));let r=0;do{let n=this.build[r],o=e.build[r];if(e6("build compare",r,n,o),n===void 0&&o===void 0)return 0;if(o===void 0)return 1;if(n===void 0)return-1;if(n===o)continue;return bT(n,o)}while(++r)}inc(e,r,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",r,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",r,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",r,n),this.inc("pre",r,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",r,n),this.inc("pre",r,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let o=Number(n)?1:0;if(!r&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[o];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(r===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(o)}}if(r){let s=[r,o];n===!1&&(s=[r]),bT(this.prerelease[0],r)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Dbe.exports=oY});var t_=O((VIr,Lbe)=>{var Nbe=Ks(),nYe=(t,e,r=!1)=>{if(t instanceof Nbe)return t;try{return new Nbe(t,e)}catch(n){if(!r)return null;throw n}};Lbe.exports=nYe});var Mbe=O((GIr,Obe)=>{var iYe=t_(),oYe=(t,e)=>{let r=iYe(t,e);return r?r.version:null};Obe.exports=oYe});var Ube=O((zIr,Fbe)=>{var sYe=t_(),aYe=(t,e)=>{let r=sYe(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null};Fbe.exports=aYe});var jbe=O(($Ir,qbe)=>{var Bbe=Ks(),cYe=(t,e,r,n,o)=>{typeof r=="string"&&(o=n,n=r,r=void 0);try{return new Bbe(t instanceof Bbe?t.version:t,r).inc(e,n,o).version}catch{return null}};qbe.exports=cYe});var Gbe=O((WIr,Vbe)=>{var Hbe=t_(),uYe=(t,e)=>{let r=Hbe(t,null,!0),n=Hbe(e,null,!0),o=r.compare(n);if(o===0)return null;let s=o>0,a=s?r:n,c=s?n:r,u=!!a.prerelease.length;if(!!c.prerelease.length&&!u)return!c.patch&&!c.minor?"major":a.patch?"patch":a.minor?"minor":"major";let d=u?"pre":"";return r.major!==n.major?d+"major":r.minor!==n.minor?d+"minor":r.patch!==n.patch?d+"patch":"prerelease"};Vbe.exports=uYe});var $be=O((KIr,zbe)=>{var lYe=Ks(),dYe=(t,e)=>new lYe(t,e).major;zbe.exports=dYe});var Kbe=O((YIr,Wbe)=>{var pYe=Ks(),fYe=(t,e)=>new pYe(t,e).minor;Wbe.exports=fYe});var Qbe=O((QIr,Ybe)=>{var mYe=Ks(),hYe=(t,e)=>new mYe(t,e).patch;Ybe.exports=hYe});var Jbe=O((XIr,Xbe)=>{var gYe=t_(),vYe=(t,e)=>{let r=gYe(t,e);return r&&r.prerelease.length?r.prerelease:null};Xbe.exports=vYe});var Gu=O((JIr,eye)=>{var Zbe=Ks(),bYe=(t,e,r)=>new Zbe(t,r).compare(new Zbe(e,r));eye.exports=bYe});var rye=O((ZIr,tye)=>{var yYe=Gu(),_Ye=(t,e,r)=>yYe(e,t,r);tye.exports=_Ye});var iye=O((eCr,nye)=>{var xYe=Gu(),SYe=(t,e)=>xYe(t,e,!0);nye.exports=SYe});var r6=O((tCr,sye)=>{var oye=Ks(),IYe=(t,e,r)=>{let n=new oye(t,r),o=new oye(e,r);return n.compare(o)||n.compareBuild(o)};sye.exports=IYe});var cye=O((rCr,aye)=>{var CYe=r6(),TYe=(t,e)=>t.sort((r,n)=>CYe(r,n,e));aye.exports=TYe});var lye=O((nCr,uye)=>{var EYe=r6(),wYe=(t,e)=>t.sort((r,n)=>EYe(n,r,e));uye.exports=wYe});var B2=O((iCr,dye)=>{var RYe=Gu(),kYe=(t,e,r)=>RYe(t,e,r)>0;dye.exports=kYe});var n6=O((oCr,pye)=>{var PYe=Gu(),AYe=(t,e,r)=>PYe(t,e,r)<0;pye.exports=AYe});var sY=O((sCr,fye)=>{var DYe=Gu(),NYe=(t,e,r)=>DYe(t,e,r)===0;fye.exports=NYe});var aY=O((aCr,mye)=>{var LYe=Gu(),OYe=(t,e,r)=>LYe(t,e,r)!==0;mye.exports=OYe});var i6=O((cCr,hye)=>{var MYe=Gu(),FYe=(t,e,r)=>MYe(t,e,r)>=0;hye.exports=FYe});var o6=O((uCr,gye)=>{var UYe=Gu(),BYe=(t,e,r)=>UYe(t,e,r)<=0;gye.exports=BYe});var cY=O((lCr,vye)=>{var qYe=sY(),jYe=aY(),HYe=B2(),VYe=i6(),GYe=n6(),zYe=o6(),$Ye=(t,e,r,n)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return qYe(t,r,n);case"!=":return jYe(t,r,n);case">":return HYe(t,r,n);case">=":return VYe(t,r,n);case"<":return GYe(t,r,n);case"<=":return zYe(t,r,n);default:throw new TypeError(`Invalid operator: ${e}`)}};vye.exports=$Ye});var yye=O((dCr,bye)=>{var WYe=Ks(),KYe=t_(),{safeRe:s6,t:a6}=vT(),YYe=(t,e)=>{if(t instanceof WYe)return t;if(typeof t=="number"&&(t=String(t)),typeof t!="string")return null;e=e||{};let r=null;if(!e.rtl)r=t.match(e.includePrerelease?s6[a6.COERCEFULL]:s6[a6.COERCE]);else{let u=e.includePrerelease?s6[a6.COERCERTLFULL]:s6[a6.COERCERTL],l;for(;(l=u.exec(t))&&(!r||r.index+r[0].length!==t.length);)(!r||l.index+l[0].length!==r.index+r[0].length)&&(r=l),u.lastIndex=l.index+l[1].length+l[2].length;u.lastIndex=-1}if(r===null)return null;let n=r[2],o=r[3]||"0",s=r[4]||"0",a=e.includePrerelease&&r[5]?`-${r[5]}`:"",c=e.includePrerelease&&r[6]?`+${r[6]}`:"";return KYe(`${n}.${o}.${s}${a}${c}`,e)};bye.exports=YYe});var xye=O((pCr,_ye)=>{var uY=class{constructor(){this.max=1e3,this.map=new Map}get(e){let r=this.map.get(e);if(r!==void 0)return this.map.delete(e),this.map.set(e,r),r}delete(e){return this.map.delete(e)}set(e,r){if(!this.delete(e)&&r!==void 0){if(this.map.size>=this.max){let o=this.map.keys().next().value;this.delete(o)}this.map.set(e,r)}return this}};_ye.exports=uY});var zu=O((fCr,Tye)=>{var lY=class t{constructor(e,r){if(r=XYe(r),e instanceof t)return e.loose===!!r.loose&&e.includePrerelease===!!r.includePrerelease?e:new t(e.raw,r);if(e instanceof dY)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=r,this.loose=!!r.loose,this.includePrerelease=!!r.includePrerelease,this.raw=e.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(o=>!Iye(o[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let o of this.set)if(o.length===1&&iQe(o[0])){this.set=[o];break}}}this.format()}format(){return this.range=this.set.map(e=>e.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&rQe)|(this.options.loose&&nQe))+":"+e,o=Sye.get(n);if(o)return o;let s=this.options.loose,a=s?rc[Ta.HYPHENRANGELOOSE]:rc[Ta.HYPHENRANGE];e=e.replace(a,mQe(this.options.includePrerelease)),Kn("hyphen replace",e),e=e.replace(rc[Ta.COMPARATORTRIM],ZYe),Kn("comparator trim",e),e=e.replace(rc[Ta.TILDETRIM],eQe),Kn("tilde trim",e),e=e.replace(rc[Ta.CARETTRIM],tQe),Kn("caret trim",e);let c=e.split(" ").map(p=>oQe(p,this.options)).join(" ").split(/\s+/).map(p=>fQe(p,this.options));s&&(c=c.filter(p=>(Kn("loose invalid filter",p,this.options),!!p.match(rc[Ta.COMPARATORLOOSE])))),Kn("range list",c);let u=new Map,l=c.map(p=>new dY(p,this.options));for(let p of l){if(Iye(p))return[p];u.set(p.value,p)}u.size>1&&u.has("")&&u.delete("");let d=[...u.values()];return Sye.set(n,d),d}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Range is required");return this.set.some(n=>Cye(n,r)&&e.set.some(o=>Cye(o,r)&&n.every(s=>o.every(a=>s.intersects(a,r)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new JYe(e,this.options)}catch{return!1}for(let r=0;r<this.set.length;r++)if(hQe(this.set[r],e,this.options))return!0;return!1}};Tye.exports=lY;var QYe=xye(),Sye=new QYe,XYe=ZF(),dY=q2(),Kn=U2(),JYe=Ks(),{safeRe:rc,t:Ta,comparatorTrimReplace:ZYe,tildeTrimReplace:eQe,caretTrimReplace:tQe}=vT(),{FLAG_INCLUDE_PRERELEASE:rQe,FLAG_LOOSE:nQe}=F2(),Iye=t=>t.value==="<0.0.0-0",iQe=t=>t.value==="",Cye=(t,e)=>{let r=!0,n=t.slice(),o=n.pop();for(;r&&n.length;)r=n.every(s=>o.intersects(s,e)),o=n.pop();return r},oQe=(t,e)=>(Kn("comp",t,e),t=cQe(t,e),Kn("caret",t),t=sQe(t,e),Kn("tildes",t),t=lQe(t,e),Kn("xrange",t),t=pQe(t,e),Kn("stars",t),t),Ea=t=>!t||t.toLowerCase()==="x"||t==="*",sQe=(t,e)=>t.trim().split(/\s+/).map(r=>aQe(r,e)).join(" "),aQe=(t,e)=>{let r=e.loose?rc[Ta.TILDELOOSE]:rc[Ta.TILDE];return t.replace(r,(n,o,s,a,c)=>{Kn("tilde",t,n,o,s,a,c);let u;return Ea(o)?u="":Ea(s)?u=`>=${o}.0.0 <${+o+1}.0.0-0`:Ea(a)?u=`>=${o}.${s}.0 <${o}.${+s+1}.0-0`:c?(Kn("replaceTilde pr",c),u=`>=${o}.${s}.${a}-${c} <${o}.${+s+1}.0-0`):u=`>=${o}.${s}.${a} <${o}.${+s+1}.0-0`,Kn("tilde return",u),u})},cQe=(t,e)=>t.trim().split(/\s+/).map(r=>uQe(r,e)).join(" "),uQe=(t,e)=>{Kn("caret",t,e);let r=e.loose?rc[Ta.CARETLOOSE]:rc[Ta.CARET],n=e.includePrerelease?"-0":"";return t.replace(r,(o,s,a,c,u)=>{Kn("caret",t,o,s,a,c,u);let l;return Ea(s)?l="":Ea(a)?l=`>=${s}.0.0${n} <${+s+1}.0.0-0`:Ea(c)?s==="0"?l=`>=${s}.${a}.0${n} <${s}.${+a+1}.0-0`:l=`>=${s}.${a}.0${n} <${+s+1}.0.0-0`:u?(Kn("replaceCaret pr",u),s==="0"?a==="0"?l=`>=${s}.${a}.${c}-${u} <${s}.${a}.${+c+1}-0`:l=`>=${s}.${a}.${c}-${u} <${s}.${+a+1}.0-0`:l=`>=${s}.${a}.${c}-${u} <${+s+1}.0.0-0`):(Kn("no pr"),s==="0"?a==="0"?l=`>=${s}.${a}.${c}${n} <${s}.${a}.${+c+1}-0`:l=`>=${s}.${a}.${c}${n} <${s}.${+a+1}.0-0`:l=`>=${s}.${a}.${c} <${+s+1}.0.0-0`),Kn("caret return",l),l})},lQe=(t,e)=>(Kn("replaceXRanges",t,e),t.split(/\s+/).map(r=>dQe(r,e)).join(" ")),dQe=(t,e)=>{t=t.trim();let r=e.loose?rc[Ta.XRANGELOOSE]:rc[Ta.XRANGE];return t.replace(r,(n,o,s,a,c,u)=>{Kn("xRange",t,n,o,s,a,c,u);let l=Ea(s),d=l||Ea(a),p=d||Ea(c),f=p;return o==="="&&f&&(o=""),u=e.includePrerelease?"-0":"",l?o===">"||o==="<"?n="<0.0.0-0":n="*":o&&f?(d&&(a=0),c=0,o===">"?(o=">=",d?(s=+s+1,a=0,c=0):(a=+a+1,c=0)):o==="<="&&(o="<",d?s=+s+1:a=+a+1),o==="<"&&(u="-0"),n=`${o+s}.${a}.${c}${u}`):d?n=`>=${s}.0.0${u} <${+s+1}.0.0-0`:p&&(n=`>=${s}.${a}.0${u} <${s}.${+a+1}.0-0`),Kn("xRange return",n),n})},pQe=(t,e)=>(Kn("replaceStars",t,e),t.trim().replace(rc[Ta.STAR],"")),fQe=(t,e)=>(Kn("replaceGTE0",t,e),t.trim().replace(rc[e.includePrerelease?Ta.GTE0PRE:Ta.GTE0],"")),mQe=t=>(e,r,n,o,s,a,c,u,l,d,p,f)=>(Ea(n)?r="":Ea(o)?r=`>=${n}.0.0${t?"-0":""}`:Ea(s)?r=`>=${n}.${o}.0${t?"-0":""}`:a?r=`>=${r}`:r=`>=${r}${t?"-0":""}`,Ea(l)?u="":Ea(d)?u=`<${+l+1}.0.0-0`:Ea(p)?u=`<${l}.${+d+1}.0-0`:f?u=`<=${l}.${d}.${p}-${f}`:t?u=`<${l}.${d}.${+p+1}-0`:u=`<=${u}`,`${r} ${u}`.trim()),hQe=(t,e,r)=>{for(let n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(let n=0;n<t.length;n++)if(Kn(t[n].semver),t[n].semver!==dY.ANY&&t[n].semver.prerelease.length>0){let o=t[n].semver;if(o.major===e.major&&o.minor===e.minor&&o.patch===e.patch)return!0}return!1}return!0}});var q2=O((mCr,Aye)=>{var j2=Symbol("SemVer ANY"),mY=class t{static get ANY(){return j2}constructor(e,r){if(r=Eye(r),e instanceof t){if(e.loose===!!r.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),fY("comparator",e,r),this.options=r,this.loose=!!r.loose,this.parse(e),this.semver===j2?this.value="":this.value=this.operator+this.semver.version,fY("comp",this)}parse(e){let r=this.options.loose?wye[Rye.COMPARATORLOOSE]:wye[Rye.COMPARATOR],n=e.match(r);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new kye(n[2],this.options.loose):this.semver=j2}toString(){return this.value}test(e){if(fY("Comparator.test",e,this.options.loose),this.semver===j2||e===j2)return!0;if(typeof e=="string")try{e=new kye(e,this.options)}catch{return!1}return pY(e,this.operator,this.semver,this.options)}intersects(e,r){if(!(e instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Pye(e.value,r).test(this.value):e.operator===""?e.value===""?!0:new Pye(this.value,r).test(e.semver):(r=Eye(r),r.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!r.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||pY(this.semver,"<",e.semver,r)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||pY(this.semver,">",e.semver,r)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Aye.exports=mY;var Eye=ZF(),{safeRe:wye,t:Rye}=vT(),pY=cY(),fY=U2(),kye=Ks(),Pye=zu()});var H2=O((hCr,Dye)=>{var gQe=zu(),vQe=(t,e,r)=>{try{e=new gQe(e,r)}catch{return!1}return e.test(t)};Dye.exports=vQe});var Lye=O((gCr,Nye)=>{var bQe=zu(),yQe=(t,e)=>new bQe(t,e).set.map(r=>r.map(n=>n.value).join(" ").trim().split(" "));Nye.exports=yQe});var Mye=O((vCr,Oye)=>{var _Qe=Ks(),xQe=zu(),SQe=(t,e,r)=>{let n=null,o=null,s=null;try{s=new xQe(e,r)}catch{return null}return t.forEach(a=>{s.test(a)&&(!n||o.compare(a)===-1)&&(n=a,o=new _Qe(n,r))}),n};Oye.exports=SQe});var Uye=O((bCr,Fye)=>{var IQe=Ks(),CQe=zu(),TQe=(t,e,r)=>{let n=null,o=null,s=null;try{s=new CQe(e,r)}catch{return null}return t.forEach(a=>{s.test(a)&&(!n||o.compare(a)===1)&&(n=a,o=new IQe(n,r))}),n};Fye.exports=TQe});var jye=O((yCr,qye)=>{var hY=Ks(),EQe=zu(),Bye=B2(),wQe=(t,e)=>{t=new EQe(t,e);let r=new hY("0.0.0");if(t.test(r)||(r=new hY("0.0.0-0"),t.test(r)))return r;r=null;for(let n=0;n<t.set.length;++n){let o=t.set[n],s=null;o.forEach(a=>{let c=new hY(a.semver.version);switch(a.operator){case">":c.prerelease.length===0?c.patch++:c.prerelease.push(0),c.raw=c.format();case"":case">=":(!s||Bye(c,s))&&(s=c);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),s&&(!r||Bye(r,s))&&(r=s)}return r&&t.test(r)?r:null};qye.exports=wQe});var Vye=O((_Cr,Hye)=>{var RQe=zu(),kQe=(t,e)=>{try{return new RQe(t,e).range||"*"}catch{return null}};Hye.exports=kQe});var c6=O((xCr,Wye)=>{var PQe=Ks(),$ye=q2(),{ANY:AQe}=$ye,DQe=zu(),NQe=H2(),Gye=B2(),zye=n6(),LQe=o6(),OQe=i6(),MQe=(t,e,r,n)=>{t=new PQe(t,n),e=new DQe(e,n);let o,s,a,c,u;switch(r){case">":o=Gye,s=LQe,a=zye,c=">",u=">=";break;case"<":o=zye,s=OQe,a=Gye,c="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(NQe(t,e,n))return!1;for(let l=0;l<e.set.length;++l){let d=e.set[l],p=null,f=null;if(d.forEach(m=>{m.semver===AQe&&(m=new $ye(">=0.0.0")),p=p||m,f=f||m,o(m.semver,p.semver,n)?p=m:a(m.semver,f.semver,n)&&(f=m)}),p.operator===c||p.operator===u||(!f.operator||f.operator===c)&&s(t,f.semver))return!1;if(f.operator===u&&a(t,f.semver))return!1}return!0};Wye.exports=MQe});var Yye=O((SCr,Kye)=>{var FQe=c6(),UQe=(t,e,r)=>FQe(t,e,">",r);Kye.exports=UQe});var Xye=O((ICr,Qye)=>{var BQe=c6(),qQe=(t,e,r)=>BQe(t,e,"<",r);Qye.exports=qQe});var e_e=O((CCr,Zye)=>{var Jye=zu(),jQe=(t,e,r)=>(t=new Jye(t,r),e=new Jye(e,r),t.intersects(e,r));Zye.exports=jQe});var r_e=O((TCr,t_e)=>{var HQe=H2(),VQe=Gu();t_e.exports=(t,e,r)=>{let n=[],o=null,s=null,a=t.sort((d,p)=>VQe(d,p,r));for(let d of a)HQe(d,e,r)?(s=d,o||(o=d)):(s&&n.push([o,s]),s=null,o=null);o&&n.push([o,null]);let c=[];for(let[d,p]of n)d===p?c.push(d):!p&&d===a[0]?c.push("*"):p?d===a[0]?c.push(`<=${p}`):c.push(`${d} - ${p}`):c.push(`>=${d}`);let u=c.join(" || "),l=typeof e.raw=="string"?e.raw:String(e);return u.length<l.length?u:e}});var c_e=O((ECr,a_e)=>{var n_e=zu(),vY=q2(),{ANY:gY}=vY,V2=H2(),bY=Gu(),GQe=(t,e,r={})=>{if(t===e)return!0;t=new n_e(t,r),e=new n_e(e,r);let n=!1;e:for(let o of t.set){for(let s of e.set){let a=$Qe(o,s,r);if(n=n||a!==null,a)continue e}if(n)return!1}return!0},zQe=[new vY(">=0.0.0-0")],i_e=[new vY(">=0.0.0")],$Qe=(t,e,r)=>{if(t===e)return!0;if(t.length===1&&t[0].semver===gY){if(e.length===1&&e[0].semver===gY)return!0;r.includePrerelease?t=zQe:t=i_e}if(e.length===1&&e[0].semver===gY){if(r.includePrerelease)return!0;e=i_e}let n=new Set,o,s;for(let m of t)m.operator===">"||m.operator===">="?o=o_e(o,m,r):m.operator==="<"||m.operator==="<="?s=s_e(s,m,r):n.add(m.semver);if(n.size>1)return null;let a;if(o&&s){if(a=bY(o.semver,s.semver,r),a>0)return null;if(a===0&&(o.operator!==">="||s.operator!=="<="))return null}for(let m of n){if(o&&!V2(m,String(o),r)||s&&!V2(m,String(s),r))return null;for(let h of e)if(!V2(m,String(h),r))return!1;return!0}let c,u,l,d,p=s&&!r.includePrerelease&&s.semver.prerelease.length?s.semver:!1,f=o&&!r.includePrerelease&&o.semver.prerelease.length?o.semver:!1;p&&p.prerelease.length===1&&s.operator==="<"&&p.prerelease[0]===0&&(p=!1);for(let m of e){if(d=d||m.operator===">"||m.operator===">=",l=l||m.operator==="<"||m.operator==="<=",o){if(f&&m.semver.prerelease&&m.semver.prerelease.length&&m.semver.major===f.major&&m.semver.minor===f.minor&&m.semver.patch===f.patch&&(f=!1),m.operator===">"||m.operator===">="){if(c=o_e(o,m,r),c===m&&c!==o)return!1}else if(o.operator===">="&&!V2(o.semver,String(m),r))return!1}if(s){if(p&&m.semver.prerelease&&m.semver.prerelease.length&&m.semver.major===p.major&&m.semver.minor===p.minor&&m.semver.patch===p.patch&&(p=!1),m.operator==="<"||m.operator==="<="){if(u=s_e(s,m,r),u===m&&u!==s)return!1}else if(s.operator==="<="&&!V2(s.semver,String(m),r))return!1}if(!m.operator&&(s||o)&&a!==0)return!1}return!(o&&l&&!s&&a!==0||s&&d&&!o&&a!==0||f||p)},o_e=(t,e,r)=>{if(!t)return e;let n=bY(t.semver,e.semver,r);return n>0?t:n<0||e.operator===">"&&t.operator===">="?e:t},s_e=(t,e,r)=>{if(!t)return e;let n=bY(t.semver,e.semver,r);return n<0?t:n>0||e.operator==="<"&&t.operator==="<="?e:t};a_e.exports=GQe});var p_e=O((wCr,d_e)=>{var yY=vT(),u_e=F2(),WQe=Ks(),l_e=iY(),KQe=t_(),YQe=Mbe(),QQe=Ube(),XQe=jbe(),JQe=Gbe(),ZQe=$be(),eXe=Kbe(),tXe=Qbe(),rXe=Jbe(),nXe=Gu(),iXe=rye(),oXe=iye(),sXe=r6(),aXe=cye(),cXe=lye(),uXe=B2(),lXe=n6(),dXe=sY(),pXe=aY(),fXe=i6(),mXe=o6(),hXe=cY(),gXe=yye(),vXe=q2(),bXe=zu(),yXe=H2(),_Xe=Lye(),xXe=Mye(),SXe=Uye(),IXe=jye(),CXe=Vye(),TXe=c6(),EXe=Yye(),wXe=Xye(),RXe=e_e(),kXe=r_e(),PXe=c_e();d_e.exports={parse:KQe,valid:YQe,clean:QQe,inc:XQe,diff:JQe,major:ZQe,minor:eXe,patch:tXe,prerelease:rXe,compare:nXe,rcompare:iXe,compareLoose:oXe,compareBuild:sXe,sort:aXe,rsort:cXe,gt:uXe,lt:lXe,eq:dXe,neq:pXe,gte:fXe,lte:mXe,cmp:hXe,coerce:gXe,Comparator:vXe,Range:bXe,satisfies:yXe,toComparators:_Xe,maxSatisfying:xXe,minSatisfying:SXe,minVersion:IXe,validRange:CXe,outside:TXe,gtr:EXe,ltr:wXe,intersects:RXe,simplifyRange:kXe,subset:PXe,SemVer:WQe,re:yY.re,src:yY.src,tokens:yY.t,SEMVER_SPEC_VERSION:u_e.SEMVER_SPEC_VERSION,RELEASE_TYPES:u_e.RELEASE_TYPES,compareIdentifiers:l_e.compareIdentifiers,rcompareIdentifiers:l_e.rcompareIdentifiers}});var _Y=O(u6=>{"use strict";Object.defineProperty(u6,"__esModule",{value:!0});u6.makePatchingRequire=void 0;var AXe=require("path"),DXe=p_e(),f_e=Ni(),h_e=require("module"),NXe=Object.keys(process.binding("natives")),m_e=h_e.prototype.require;function LXe(t){var e={};return function(n){var o=m_e.apply(this,arguments);if(t[n]){var s=h_e._resolveFilename(n,this);if(e.hasOwnProperty(s))return e[s];var a=void 0;if(NXe.indexOf(n)<0)try{a=m_e.call(this,AXe.join(n,"package.json")).version}catch{return o}else a=process.version.substring(1);var c=a.indexOf("-");c>=0&&(a=a.substring(0,c));for(var u=o,l=0,d=t[n];l<d.length;l++){var p=d[l];if(DXe.satisfies(a,p.versionSpecifier)&&(u=p.patch(u,s),f_e.channel)){var f=p.publisherName||n;f_e.channel.addPatchedModule(f,a)}}return e[s]=u}return o}}u6.makePatchingRequire=LXe});var g_e=O((kCr,OXe)=>{OXe.exports={name:"diagnostic-channel",version:"1.1.1",main:"./dist/src/channel.js",types:"./dist/src/channel.d.ts",scripts:{build:"tsc",lint:"eslint ./ --fix",clean:"rimraf ./dist",test:"mocha ./dist/tests/**/*.js",debug:"mocha --inspect-brk ./dist/tests/**/*.js"},homepage:"https://github.com/Microsoft/node-diagnostic-channel",bugs:{url:"https://github.com/Microsoft/node-diagnostic-channel/issues"},repository:{type:"git",url:"https://github.com/Microsoft/node-diagnostic-channel.git"},description:"Provides a context-saving pub/sub channel to connect diagnostic event publishers and subscribers",dependencies:{semver:"^7.5.3"},devDependencies:{"@types/mocha":"^2.2.40","@types/node":"~8.0.0",mocha:"^3.2.0",rimraf:"^2.6.1",sinon:"1.17.6",typescript:"4.1.2"},files:["dist/src/**/*.d.ts","dist/src/**/*.js","LICENSE","README.md","package.json"],license:"MIT"}});var Ni=O($u=>{"use strict";Object.defineProperty($u,"__esModule",{value:!0});$u.channel=$u.ContextPreservingEventEmitter=$u.trueFilter=$u.makePatchingRequire=void 0;var MXe=_Y(),FXe=_Y();Object.defineProperty($u,"makePatchingRequire",{enumerable:!0,get:function(){return FXe.makePatchingRequire}});var UXe=function(t){return!0};$u.trueFilter=UXe;var b_e=function(){function t(){this.version=g_e().version,this.subscribers={},this.contextPreservationFunction=function(e){return e},this.knownPatches={},this.modulesPatched=[],this.currentlyPublishing=!1}return t.prototype.shouldPublish=function(e){var r=this.subscribers[e];return r?r.some(function(n){var o=n.filter;return!o||o(!1)}):!1},t.prototype.publish=function(e,r){if(!this.currentlyPublishing){var n=this.subscribers[e];if(n){var o={timestamp:Date.now(),data:r};this.currentlyPublishing=!0,n.forEach(function(s){var a=s.listener,c=s.filter;try{c&&c(!0)&&a(o)}catch{}}),this.currentlyPublishing=!1}}},t.prototype.subscribe=function(e,r,n,o){n===void 0&&(n=$u.trueFilter),this.subscribers[e]||(this.subscribers[e]=[]),this.subscribers[e].push({listener:r,filter:n,patchCallback:o});var s=this.checkIfModuleIsAlreadyPatched(e);s&&o&&o(s.name,s.version)},t.prototype.unsubscribe=function(e,r,n){n===void 0&&(n=$u.trueFilter);var o=this.subscribers[e];if(o){for(var s=0;s<o.length;++s)if(o[s].listener===r&&o[s].filter===n)return o.splice(s,1),!0}return!1},t.prototype.reset=function(){var e=this;this.subscribers={},this.contextPreservationFunction=function(r){return r},Object.getOwnPropertyNames(this.knownPatches).forEach(function(r){return delete e.knownPatches[r]})},t.prototype.bindToContext=function(e){return this.contextPreservationFunction(e)},t.prototype.addContextPreservation=function(e){var r=this.contextPreservationFunction;this.contextPreservationFunction=function(n){return e(r(n))}},t.prototype.registerMonkeyPatch=function(e,r){this.knownPatches[e]||(this.knownPatches[e]=[]),this.knownPatches[e].push(r)},t.prototype.getPatchesObject=function(){return this.knownPatches},t.prototype.addPatchedModule=function(e,r){for(var n=0,o=this.modulesPatched;n<o.length;n++){var s=o[n];if(s.name===e)return}this.modulesPatched.push({name:e,version:r});var a=this.subscribers[e];a&&a.forEach(function(c){c.patchCallback&&c.patchCallback(e,r)})},t.prototype.checkIfModuleIsAlreadyPatched=function(e){for(var r=0,n=this.modulesPatched;r<n.length;r++){var o=n[r];if(o.name===e)return o}return null},t}();$u.ContextPreservingEventEmitter=b_e;global.diagnosticsSource||(global.diagnosticsSource=new b_e,v_e=require("module"),v_e.prototype.require=MXe.makePatchingRequire(global.diagnosticsSource.getPatchesObject()));var v_e;$u.channel=global.diagnosticsSource});var y_e,__e=A(()=>{y_e=typeof globalThis=="object"?globalThis:global});var x_e=A(()=>{__e()});var S_e=A(()=>{x_e()});var Rm,xY=A(()=>{Rm="1.6.0"});function BXe(t){var e=new Set([t]),r=new Set,n=t.match(I_e);if(!n)return function(){return!1};var o={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(o.prerelease!=null)return function(u){return u===t};function s(c){return r.add(c),!1}function a(c){return e.add(c),!0}return function(u){if(e.has(u))return!0;if(r.has(u))return!1;var l=u.match(I_e);if(!l)return s(u);var d={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return d.prerelease!=null||o.major!==d.major?s(u):o.major===0?o.minor===d.minor&&o.patch<=d.patch?a(u):s(u):o.minor<=d.minor?a(u):s(u)}}var I_e,C_e,T_e=A(()=>{xY();I_e=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;C_e=BXe(Rm)});function kp(t,e,r,n){var o;n===void 0&&(n=!1);var s=z2[G2]=(o=z2[G2])!==null&&o!==void 0?o:{version:Rm};if(!n&&s[t]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return r.error(a.stack||a.message),!1}if(s.version!==Rm){var a=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+t+" does not match previously registered API v"+Rm);return r.error(a.stack||a.message),!1}return s[t]=e,r.debug("@opentelemetry/api: Registered a global for "+t+" v"+Rm+"."),!0}function Vc(t){var e,r,n=(e=z2[G2])===null||e===void 0?void 0:e.version;if(!(!n||!C_e(n)))return(r=z2[G2])===null||r===void 0?void 0:r[t]}function Pp(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+Rm+".");var r=z2[G2];r&&delete r[t]}var qXe,G2,z2,r_=A(()=>{S_e();xY();T_e();qXe=Rm.split(".")[0],G2=Symbol.for("opentelemetry.js.api."+qXe),z2=y_e});function $2(t,e,r){var n=Vc("diag");if(n)return r.unshift(e),n[t].apply(n,HXe([],jXe(r),!1))}var jXe,HXe,E_e,w_e=A(()=>{r_();jXe=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},HXe=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},E_e=function(){function t(e){this._namespace=e.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return $2("debug",this._namespace,e)},t.prototype.error=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return $2("error",this._namespace,e)},t.prototype.info=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return $2("info",this._namespace,e)},t.prototype.warn=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return $2("warn",this._namespace,e)},t.prototype.verbose=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return $2("verbose",this._namespace,e)},t}()});var On,l6=A(()=>{(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(On||(On={}))});function R_e(t,e){t<On.NONE?t=On.NONE:t>On.ALL&&(t=On.ALL),e=e||{};function r(n,o){var s=e[n];return typeof s=="function"&&t>=o?s.bind(e):function(){}}return{error:r("error",On.ERROR),warn:r("warn",On.WARN),info:r("info",On.INFO),debug:r("debug",On.DEBUG),verbose:r("verbose",On.VERBOSE)}}var k_e=A(()=>{l6()});var VXe,GXe,zXe,Ys,n_=A(()=>{w_e();k_e();l6();r_();VXe=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},GXe=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},zXe="diag",Ys=function(){function t(){function e(o){return function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];var c=Vc("diag");if(c)return c[o].apply(c,GXe([],VXe(s),!1))}}var r=this,n=function(o,s){var a,c,u;if(s===void 0&&(s={logLevel:On.INFO}),o===r){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((a=l.stack)!==null&&a!==void 0?a:l.message),!1}typeof s=="number"&&(s={logLevel:s});var d=Vc("diag"),p=R_e((c=s.logLevel)!==null&&c!==void 0?c:On.INFO,o);if(d&&!s.suppressOverrideMessage){var f=(u=new Error().stack)!==null&&u!==void 0?u:"<failed to generate stacktrace>";d.warn("Current logger will be overwritten from "+f),p.warn("Current logger will overwrite one already registered from "+f)}return kp("diag",p,r,!0)};r.setLogger=n,r.disable=function(){Pp(zXe,r)},r.createComponentLogger=function(o){return new E_e(o)},r.verbose=e("verbose"),r.debug=e("debug"),r.info=e("info"),r.warn=e("warn"),r.error=e("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}()});var $Xe,WXe,P_e,A_e=A(()=>{$Xe=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},WXe=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},P_e=function(){function t(e){this._entries=e?new Map(e):new Map}return t.prototype.getEntry=function(e){var r=this._entries.get(e);if(r)return Object.assign({},r)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var r=$Xe(e,2),n=r[0],o=r[1];return[n,o]})},t.prototype.setEntry=function(e,r){var n=new t(this._entries);return n._entries.set(e,r),n},t.prototype.removeEntry=function(e){var r=new t(this._entries);return r._entries.delete(e),r},t.prototype.removeEntries=function(){for(var e,r,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var s=new t(this._entries);try{for(var a=WXe(n),c=a.next();!c.done;c=a.next()){var u=c.value;s._entries.delete(u)}}catch(l){e={error:l}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return s},t.prototype.clear=function(){return new t},t}()});var D_e,N_e=A(()=>{D_e=Symbol("BaggageEntryMetadata")});function L_e(t){return t===void 0&&(t={}),new P_e(new Map(Object.entries(t)))}function d6(t){return typeof t!="string"&&(KXe.error("Cannot create baggage metadata from unknown type: "+typeof t),t=""),{__TYPE__:D_e,toString:function(){return t}}}var KXe,SY=A(()=>{n_();A_e();N_e();KXe=Ys.instance()});function Ap(t){return Symbol.for(t)}var YXe,p6,W2=A(()=>{YXe=function(){function t(e){var r=this;r._currentContext=e?new Map(e):new Map,r.getValue=function(n){return r._currentContext.get(n)},r.setValue=function(n,o){var s=new t(r._currentContext);return s._currentContext.set(n,o),s},r.deleteValue=function(n){var o=new t(r._currentContext);return o._currentContext.delete(n),o}}return t}(),p6=new YXe});var IY,O_e,M_e=A(()=>{IY=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],O_e=function(){function t(){function e(n){return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];if(console){var a=console[n];if(typeof a!="function"&&(a=console.log),typeof a=="function")return a.apply(console,o)}}}for(var r=0;r<IY.length;r++)this[IY[r].n]=e(IY[r].c)}return t}()});function F_e(){return EY}var yT,QXe,CY,XXe,JXe,ZXe,TY,eJe,tJe,rJe,EY,nJe,iJe,oJe,sJe,aJe,cJe,wY=A(()=>{yT=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),QXe=function(){function t(){}return t.prototype.createHistogram=function(e,r){return iJe},t.prototype.createCounter=function(e,r){return nJe},t.prototype.createUpDownCounter=function(e,r){return oJe},t.prototype.createObservableGauge=function(e,r){return aJe},t.prototype.createObservableCounter=function(e,r){return sJe},t.prototype.createObservableUpDownCounter=function(e,r){return cJe},t.prototype.addBatchObservableCallback=function(e,r){},t.prototype.removeBatchObservableCallback=function(e){},t}(),CY=function(){function t(){}return t}(),XXe=function(t){yT(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(r,n){},e}(CY),JXe=function(t){yT(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(r,n){},e}(CY),ZXe=function(t){yT(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(r,n){},e}(CY),TY=function(){function t(){}return t.prototype.addCallback=function(e){},t.prototype.removeCallback=function(e){},t}(),eJe=function(t){yT(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(TY),tJe=function(t){yT(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(TY),rJe=function(t){yT(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(TY),EY=new QXe,nJe=new XXe,iJe=new ZXe,oJe=new JXe,sJe=new eJe,aJe=new tJe,cJe=new rJe});var f6,U_e=A(()=>{(function(t){t[t.INT=0]="INT",t[t.DOUBLE=1]="DOUBLE"})(f6||(f6={}))});var m6,h6,RY=A(()=>{m6={get:function(t,e){if(t!=null)return t[e]},keys:function(t){return t==null?[]:Object.keys(t)}},h6={set:function(t,e,r){t!=null&&(t[e]=r)}}});var uJe,lJe,B_e,q_e=A(()=>{W2();uJe=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},lJe=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},B_e=function(){function t(){}return t.prototype.active=function(){return p6},t.prototype.with=function(e,r,n){for(var o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return r.call.apply(r,lJe([n],uJe(o),!1))},t.prototype.bind=function(e,r){return r},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}()});var dJe,pJe,kY,fJe,Wv,K2=A(()=>{q_e();r_();n_();dJe=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},pJe=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},kY="context",fJe=new B_e,Wv=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(e){return kp(kY,e,Ys.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(e,r,n){for(var o,s=[],a=3;a<arguments.length;a++)s[a-3]=arguments[a];return(o=this._getContextManager()).with.apply(o,pJe([e,r,n],dJe(s),!1))},t.prototype.bind=function(e,r){return this._getContextManager().bind(e,r)},t.prototype._getContextManager=function(){return Vc(kY)||fJe},t.prototype.disable=function(){this._getContextManager().disable(),Pp(kY,Ys.instance())},t}()});var $i,PY=A(()=>{(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})($i||($i={}))});var Y2,Q2,_T,g6=A(()=>{PY();Y2="0000000000000000",Q2="00000000000000000000000000000000",_T={traceId:Q2,spanId:Y2,traceFlags:$i.NONE}});var Kv,v6=A(()=>{g6();Kv=function(){function t(e){e===void 0&&(e=_T),this._spanContext=e}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,r){return this},t.prototype.setAttributes=function(e){return this},t.prototype.addEvent=function(e,r){return this},t.prototype.setStatus=function(e){return this},t.prototype.updateName=function(e){return this},t.prototype.end=function(e){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(e,r){},t}()});function b6(t){return t.getValue(AY)||void 0}function j_e(){return b6(Wv.getInstance().active())}function X2(t,e){return t.setValue(AY,e)}function H_e(t){return t.deleteValue(AY)}function V_e(t,e){return X2(t,new Kv(e))}function y6(t){var e;return(e=b6(t))===null||e===void 0?void 0:e.spanContext()}var AY,DY=A(()=>{W2();v6();K2();AY=Ap("OpenTelemetry Context Key SPAN")});function i_(t){return mJe.test(t)&&t!==Q2}function NY(t){return hJe.test(t)&&t!==Y2}function Wu(t){return i_(t.traceId)&&NY(t.spanId)}function G_e(t){return new Kv(t)}var mJe,hJe,_6=A(()=>{g6();v6();mJe=/^([0-9a-f]{32})$/i,hJe=/^[0-9a-f]{16}$/i});function gJe(t){return typeof t=="object"&&typeof t.spanId=="string"&&typeof t.traceId=="string"&&typeof t.traceFlags=="number"}var LY,x6,OY=A(()=>{K2();DY();v6();_6();LY=Wv.getInstance(),x6=function(){function t(){}return t.prototype.startSpan=function(e,r,n){n===void 0&&(n=LY.active());var o=!!r?.root;if(o)return new Kv;var s=n&&y6(n);return gJe(s)&&Wu(s)?new Kv(s):new Kv},t.prototype.startActiveSpan=function(e,r,n,o){var s,a,c;if(!(arguments.length<2)){arguments.length===2?c=r:arguments.length===3?(s=r,c=n):(s=r,a=n,c=o);var u=a??LY.active(),l=this.startSpan(e,s,u),d=X2(u,l);return LY.with(d,c,void 0,l)}},t}()});var vJe,S6,MY=A(()=>{OY();vJe=new x6,S6=function(){function t(e,r,n,o){this._provider=e,this.name=r,this.version=n,this.options=o}return t.prototype.startSpan=function(e,r,n){return this._getTracer().startSpan(e,r,n)},t.prototype.startActiveSpan=function(e,r,n,o){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):vJe},t}()});var z_e,$_e=A(()=>{OY();z_e=function(){function t(){}return t.prototype.getTracer=function(e,r,n){return new x6},t}()});var bJe,J2,FY=A(()=>{MY();$_e();bJe=new z_e,J2=function(){function t(){}return t.prototype.getTracer=function(e,r,n){var o;return(o=this.getDelegateTracer(e,r,n))!==null&&o!==void 0?o:new S6(this,e,r,n)},t.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:bJe},t.prototype.setDelegate=function(e){this._delegate=e},t.prototype.getDelegateTracer=function(e,r,n){var o;return(o=this._delegate)===null||o===void 0?void 0:o.getTracer(e,r,n)},t}()});var nc,W_e=A(()=>{(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(nc||(nc={}))});var xT,K_e=A(()=>{(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(xT||(xT={}))});var ST,Y_e=A(()=>{(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(ST||(ST={}))});function Q_e(t){return xJe.test(t)}function X_e(t){return SJe.test(t)&&!IJe.test(t)}var UY,yJe,_Je,xJe,SJe,IJe,J_e=A(()=>{UY="[_0-9a-z-*/]",yJe="[a-z]"+UY+"{0,255}",_Je="[a-z0-9]"+UY+"{0,240}@[a-z]"+UY+"{0,13}",xJe=new RegExp("^(?:"+yJe+"|"+_Je+")$"),SJe=/^[ -~]{0,255}[!-~]$/,IJe=/,|=/});var Z_e,CJe,exe,txe,rxe,nxe=A(()=>{J_e();Z_e=32,CJe=512,exe=",",txe="=",rxe=function(){function t(e){this._internalState=new Map,e&&this._parse(e)}return t.prototype.set=function(e,r){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,r),n},t.prototype.unset=function(e){var r=this._clone();return r._internalState.delete(e),r},t.prototype.get=function(e){return this._internalState.get(e)},t.prototype.serialize=function(){var e=this;return this._keys().reduce(function(r,n){return r.push(n+txe+e.get(n)),r},[]).join(exe)},t.prototype._parse=function(e){e.length>CJe||(this._internalState=e.split(exe).reverse().reduce(function(r,n){var o=n.trim(),s=o.indexOf(txe);if(s!==-1){var a=o.slice(0,s),c=o.slice(s+1,n.length);Q_e(a)&&X_e(c)&&r.set(a,c)}return r},new Map),this._internalState.size>Z_e&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,Z_e))))},t.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},t.prototype._clone=function(){var e=new t;return e._internalState=new Map(this._internalState),e},t}()});function ixe(t){return new rxe(t)}var oxe=A(()=>{nxe()});var wa,sxe=A(()=>{K2();wa=Wv.getInstance()});var Tt,axe=A(()=>{n_();Tt=Ys.instance()});var TJe,cxe,uxe=A(()=>{wY();TJe=function(){function t(){}return t.prototype.getMeter=function(e,r,n){return EY},t}(),cxe=new TJe});var BY,lxe,dxe=A(()=>{uxe();r_();n_();BY="metrics",lxe=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalMeterProvider=function(e){return kp(BY,e,Ys.instance())},t.prototype.getMeterProvider=function(){return Vc(BY)||cxe},t.prototype.getMeter=function(e,r,n){return this.getMeterProvider().getMeter(e,r,n)},t.prototype.disable=function(){Pp(BY,Ys.instance())},t}()});var qY,pxe=A(()=>{dxe();qY=lxe.getInstance()});var fxe,mxe=A(()=>{fxe=function(){function t(){}return t.prototype.inject=function(e,r){},t.prototype.extract=function(e,r){return e},t.prototype.fields=function(){return[]},t}()});function HY(t){return t.getValue(jY)||void 0}function hxe(){return HY(Wv.getInstance().active())}function gxe(t,e){return t.setValue(jY,e)}function vxe(t){return t.deleteValue(jY)}var jY,bxe=A(()=>{K2();W2();jY=Ap("OpenTelemetry Baggage Key")});var VY,EJe,yxe,_xe=A(()=>{r_();mxe();RY();bxe();SY();n_();VY="propagation",EJe=new fxe,yxe=function(){function t(){this.createBaggage=L_e,this.getBaggage=HY,this.getActiveBaggage=hxe,this.setBaggage=gxe,this.deleteBaggage=vxe}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(e){return kp(VY,e,Ys.instance())},t.prototype.inject=function(e,r,n){return n===void 0&&(n=h6),this._getGlobalPropagator().inject(e,r,n)},t.prototype.extract=function(e,r,n){return n===void 0&&(n=m6),this._getGlobalPropagator().extract(e,r,n)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){Pp(VY,Ys.instance())},t.prototype._getGlobalPropagator=function(){return Vc(VY)||EJe},t}()});var km,xxe=A(()=>{_xe();km=yxe.getInstance()});var GY,Sxe,Ixe=A(()=>{r_();FY();_6();DY();n_();GY="trace",Sxe=function(){function t(){this._proxyTracerProvider=new J2,this.wrapSpanContext=G_e,this.isSpanContextValid=Wu,this.deleteSpan=H_e,this.getSpan=b6,this.getActiveSpan=j_e,this.getSpanContext=y6,this.setSpan=X2,this.setSpanContext=V_e}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(e){var r=kp(GY,this._proxyTracerProvider,Ys.instance());return r&&this._proxyTracerProvider.setDelegate(e),r},t.prototype.getTracerProvider=function(){return Vc(GY)||this._proxyTracerProvider},t.prototype.getTracer=function(e,r){return this.getTracerProvider().getTracer(e,r)},t.prototype.disable=function(){Pp(GY,Ys.instance()),this._proxyTracerProvider=new J2},t}()});var Ro,Cxe=A(()=>{Ixe();Ro=Sxe.getInstance()});var IT={};_n(IT,{DiagConsoleLogger:()=>O_e,DiagLogLevel:()=>On,INVALID_SPANID:()=>Y2,INVALID_SPAN_CONTEXT:()=>_T,INVALID_TRACEID:()=>Q2,ProxyTracer:()=>S6,ProxyTracerProvider:()=>J2,ROOT_CONTEXT:()=>p6,SamplingDecision:()=>nc,SpanKind:()=>xT,SpanStatusCode:()=>ST,TraceFlags:()=>$i,ValueType:()=>f6,baggageEntryMetadataFromString:()=>d6,context:()=>wa,createContextKey:()=>Ap,createNoopMeter:()=>F_e,createTraceState:()=>ixe,default:()=>wJe,defaultTextMapGetter:()=>m6,defaultTextMapSetter:()=>h6,diag:()=>Tt,isSpanContextValid:()=>Wu,isValidSpanId:()=>NY,isValidTraceId:()=>i_,metrics:()=>qY,propagation:()=>km,trace:()=>Ro});var wJe,Pr=A(()=>{SY();W2();M_e();l6();wY();U_e();RY();MY();FY();W_e();K_e();Y_e();PY();oxe();_6();g6();sxe();axe();pxe();xxe();Cxe();wJe={context:wa,diag:Tt,metrics:qY,propagation:km,trace:Ro}});function Z2(t){return t.setValue(zY,!0)}function RJe(t){return t.deleteValue(zY)}function o_(t){return t.getValue(zY)===!0}var zY,eA=A(()=>{Pr();zY=Ap("OpenTelemetry SDK Context Key SUPPRESS_TRACING")});var Txe,I6,CT,C6,Exe,wxe,Rxe,$Y=A(()=>{Txe="=",I6=";",CT=",",C6="baggage",Exe=180,wxe=4096,Rxe=8192});var YY={};_n(YY,{getKeyPairs:()=>KY,parseKeyPairsIntoRecord:()=>PJe,parsePairKeyValue:()=>T6,serializeKeyPairs:()=>WY});function WY(t){return t.reduce(function(e,r){var n=""+e+(e!==""?CT:"")+r;return n.length>Rxe?e:n},"")}function KY(t){return t.getAllEntries().map(function(e){var r=kJe(e,2),n=r[0],o=r[1],s=encodeURIComponent(n)+"="+encodeURIComponent(o.value);return o.metadata!==void 0&&(s+=I6+o.metadata.toString()),s})}function T6(t){var e=t.split(I6);if(!(e.length<=0)){var r=e.shift();if(r){var n=r.indexOf(Txe);if(!(n<=0)){var o=decodeURIComponent(r.substring(0,n).trim()),s=decodeURIComponent(r.substring(n+1).trim()),a;return e.length>0&&(a=d6(e.join(I6))),{key:o,value:s,metadata:a}}}}}function PJe(t){return typeof t!="string"||t.length===0?{}:t.split(CT).map(function(e){return T6(e)}).filter(function(e){return e!==void 0&&e.value.length>0}).reduce(function(e,r){return e[r.key]=r.value,e},{})}var kJe,QY=A(()=>{Pr();$Y();kJe=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s}});var XY,kxe=A(()=>{Pr();eA();$Y();QY();XY=function(){function t(){}return t.prototype.inject=function(e,r,n){var o=km.getBaggage(e);if(!(!o||o_(e))){var s=KY(o).filter(function(c){return c.length<=wxe}).slice(0,Exe),a=WY(s);a.length>0&&n.set(r,C6,a)}},t.prototype.extract=function(e,r,n){var o=n.get(r,C6),s=Array.isArray(o)?o.join(CT):o;if(!s)return e;var a={};if(s.length===0)return e;var c=s.split(CT);return c.forEach(function(u){var l=T6(u);if(l){var d={value:l.value};l.metadata&&(d.metadata=l.metadata),a[l.key]=d}}),Object.entries(a).length===0?e:km.setBaggage(e,km.createBaggage(a))},t.prototype.fields=function(){return[C6]},t}()});var AJe,Pxe=A(()=>{AJe=function(){function t(e,r){this._monotonicClock=r,this._epochMillis=e.now(),this._performanceMillis=r.now()}return t.prototype.now=function(){var e=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+e},t}()});function s_(t){var e,r,n={};if(typeof t!="object"||t==null)return n;try{for(var o=Axe(Object.entries(t)),s=o.next();!s.done;s=o.next()){var a=DJe(s.value,2),c=a[0],u=a[1];if(!Dxe(c)){Tt.warn("Invalid attribute key: "+c);continue}if(!E6(u)){Tt.warn("Invalid attribute value set for key: "+c);continue}Array.isArray(u)?n[c]=u.slice():n[c]=u}}catch(l){e={error:l}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return n}function Dxe(t){return typeof t=="string"&&t.length>0}function E6(t){return t==null?!0:Array.isArray(t)?NJe(t):Nxe(t)}function NJe(t){var e,r,n;try{for(var o=Axe(t),s=o.next();!s.done;s=o.next()){var a=s.value;if(a!=null){if(!n){if(Nxe(a)){n=typeof a;continue}return!1}if(typeof a!==n)return!1}}}catch(c){e={error:c}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return!0}function Nxe(t){switch(typeof t){case"number":case"boolean":case"string":return!0}return!1}var Axe,DJe,Lxe=A(()=>{Pr();Axe=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},DJe=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s}});function JY(){return function(t){Tt.error(LJe(t))}}function LJe(t){return typeof t=="string"?t:JSON.stringify(OJe(t))}function OJe(t){for(var e={},r=t;r!==null;)Object.getOwnPropertyNames(r).forEach(function(n){if(!e[n]){var o=r[n];o&&(e[n]=String(o))}}),r=Object.getPrototypeOf(r);return e}var ZY=A(()=>{Pr()});function MJe(t){Oxe=t}function ic(t){try{Oxe(t)}catch{}}var Oxe,eQ=A(()=>{ZY();Oxe=JY()});var Gc,tQ=A(()=>{(function(t){t.AlwaysOff="always_off",t.AlwaysOn="always_on",t.ParentBasedAlwaysOff="parentbased_always_off",t.ParentBasedAlwaysOn="parentbased_always_on",t.ParentBasedTraceIdRatio="parentbased_traceidratio",t.TraceIdRatio="traceidratio"})(Gc||(Gc={}))});var Mxe,Fxe=A(()=>{Mxe=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{}});function BJe(t){return UJe.indexOf(t)>-1}function jJe(t){return qJe.indexOf(t)>-1}function VJe(t){return HJe.indexOf(t)>-1}function GJe(t,e,r){if(!(typeof r[t]>"u")){var n=String(r[t]);e[t]=n.toLowerCase()==="true"}}function zJe(t,e,r,n,o){if(n===void 0&&(n=-1/0),o===void 0&&(o=1/0),typeof r[t]<"u"){var s=Number(r[t]);isNaN(s)||(s<n?e[t]=n:s>o?e[t]=o:e[t]=s)}}function $Je(t,e,r,n){n===void 0&&(n=FJe);var o=r[t];typeof o=="string"&&(e[t]=o.split(n).map(function(s){return s.trim()}))}function KJe(t,e,r){var n=r[t];if(typeof n=="string"){var o=WJe[n.toUpperCase()];o!=null&&(e[t]=o)}}function tA(t){var e={};for(var r in w6){var n=r;switch(n){case"OTEL_LOG_LEVEL":KJe(n,e,t);break;default:if(BJe(n))GJe(n,e,t);else if(jJe(n))zJe(n,e,t);else if(VJe(n))$Je(n,e,t);else{var o=t[n];typeof o<"u"&&o!==null&&(e[n]=String(o))}}}return e}function rQ(){return typeof process<"u"&&process&&process.env?tA(process.env):tA(Mxe)}var FJe,UJe,qJe,HJe,TT,ET,Uxe,Bxe,w6,WJe,nQ=A(()=>{Pr();tQ();Fxe();FJe=",",UJe=["OTEL_SDK_DISABLED"];qJe=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];HJe=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];TT=1/0,ET=128,Uxe=128,Bxe=128,w6={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:On.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:TT,OTEL_ATTRIBUTE_COUNT_LIMIT:ET,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:TT,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:ET,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:TT,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:ET,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:Uxe,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:Bxe,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:Gc.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};WJe={ALL:On.ALL,VERBOSE:On.VERBOSE,DEBUG:On.DEBUG,INFO:On.INFO,WARN:On.WARN,ERROR:On.ERROR,NONE:On.NONE}});function ko(){var t=tA(process.env);return Object.assign({HOSTNAME:qxe.hostname()},w6,t)}var qxe,jxe=A(()=>{qxe=H(require("os"));nQ()});var YJe,Hxe=A(()=>{YJe=typeof globalThis=="object"?globalThis:global});function Vxe(t){return t>=48&&t<=57?t-48:t>=97&&t<=102?t-87:t-55}function JJe(t){var e;t.length===16?e=QJe:t.length===32?e=XJe:e=Buffer.alloc(t.length/2);for(var r=0,n=0;n<t.length;n+=2){var o=Vxe(t.charCodeAt(n)),s=Vxe(t.charCodeAt(n+1));e.writeUInt8(o<<4|s,r++)}return e.toString("base64")}var QJe,XJe,Gxe=A(()=>{QJe=Buffer.alloc(8),XJe=Buffer.alloc(16)});function zxe(t){return function(){for(var r=0;r<t/4;r++)R6.writeUInt32BE(Math.random()*Math.pow(2,32)>>>0,r*4);for(var r=0;r<t&&!(R6[r]>0);r++)r===t-1&&(R6[t-1]=1);return R6.toString("hex",0,t)}}var ZJe,$xe,eZe,R6,Wxe=A(()=>{ZJe=8,$xe=16,eZe=function(){function t(){this.generateTraceId=zxe($xe),this.generateSpanId=zxe(ZJe)}return t}(),R6=Buffer.allocUnsafe($xe)});var Kxe,Pm,Yxe=A(()=>{Kxe=require("perf_hooks"),Pm=Kxe.performance});var iQ,k6=A(()=>{iQ="1.17.0"});var Am,tZe,rZe,nZe,iZe,oZe,sZe,aZe,cZe,uZe,lZe,dZe,pZe,fZe,Qxe=A(()=>{Am={AWS_LAMBDA_INVOKED_ARN:"aws.lambda.invoked_arn",DB_SYSTEM:"db.system",DB_CONNECTION_STRING:"db.connection_string",DB_USER:"db.user",DB_JDBC_DRIVER_CLASSNAME:"db.jdbc.driver_classname",DB_NAME:"db.name",DB_STATEMENT:"db.statement",DB_OPERATION:"db.operation",DB_MSSQL_INSTANCE_NAME:"db.mssql.instance_name",DB_CASSANDRA_KEYSPACE:"db.cassandra.keyspace",DB_CASSANDRA_PAGE_SIZE:"db.cassandra.page_size",DB_CASSANDRA_CONSISTENCY_LEVEL:"db.cassandra.consistency_level",DB_CASSANDRA_TABLE:"db.cassandra.table",DB_CASSANDRA_IDEMPOTENCE:"db.cassandra.idempotence",DB_CASSANDRA_SPECULATIVE_EXECUTION_COUNT:"db.cassandra.speculative_execution_count",DB_CASSANDRA_COORDINATOR_ID:"db.cassandra.coordinator.id",DB_CASSANDRA_COORDINATOR_DC:"db.cassandra.coordinator.dc",DB_HBASE_NAMESPACE:"db.hbase.namespace",DB_REDIS_DATABASE_INDEX:"db.redis.database_index",DB_MONGODB_COLLECTION:"db.mongodb.collection",DB_SQL_TABLE:"db.sql.table",EXCEPTION_TYPE:"exception.type",EXCEPTION_MESSAGE:"exception.message",EXCEPTION_STACKTRACE:"exception.stacktrace",EXCEPTION_ESCAPED:"exception.escaped",FAAS_TRIGGER:"faas.trigger",FAAS_EXECUTION:"faas.execution",FAAS_DOCUMENT_COLLECTION:"faas.document.collection",FAAS_DOCUMENT_OPERATION:"faas.document.operation",FAAS_DOCUMENT_TIME:"faas.document.time",FAAS_DOCUMENT_NAME:"faas.document.name",FAAS_TIME:"faas.time",FAAS_CRON:"faas.cron",FAAS_COLDSTART:"faas.coldstart",FAAS_INVOKED_NAME:"faas.invoked_name",FAAS_INVOKED_PROVIDER:"faas.invoked_provider",FAAS_INVOKED_REGION:"faas.invoked_region",NET_TRANSPORT:"net.transport",NET_PEER_IP:"net.peer.ip",NET_PEER_PORT:"net.peer.port",NET_PEER_NAME:"net.peer.name",NET_HOST_IP:"net.host.ip",NET_HOST_PORT:"net.host.port",NET_HOST_NAME:"net.host.name",NET_HOST_CONNECTION_TYPE:"net.host.connection.type",NET_HOST_CONNECTION_SUBTYPE:"net.host.connection.subtype",NET_HOST_CARRIER_NAME:"net.host.carrier.name",NET_HOST_CARRIER_MCC:"net.host.carrier.mcc",NET_HOST_CARRIER_MNC:"net.host.carrier.mnc",NET_HOST_CARRIER_ICC:"net.host.carrier.icc",PEER_SERVICE:"peer.service",ENDUSER_ID:"enduser.id",ENDUSER_ROLE:"enduser.role",ENDUSER_SCOPE:"enduser.scope",THREAD_ID:"thread.id",THREAD_NAME:"thread.name",CODE_FUNCTION:"code.function",CODE_NAMESPACE:"code.namespace",CODE_FILEPATH:"code.filepath",CODE_LINENO:"code.lineno",HTTP_METHOD:"http.method",HTTP_URL:"http.url",HTTP_TARGET:"http.target",HTTP_HOST:"http.host",HTTP_SCHEME:"http.scheme",HTTP_STATUS_CODE:"http.status_code",HTTP_FLAVOR:"http.flavor",HTTP_USER_AGENT:"http.user_agent",HTTP_REQUEST_CONTENT_LENGTH:"http.request_content_length",HTTP_REQUEST_CONTENT_LENGTH_UNCOMPRESSED:"http.request_content_length_uncompressed",HTTP_RESPONSE_CONTENT_LENGTH:"http.response_content_length",HTTP_RESPONSE_CONTENT_LENGTH_UNCOMPRESSED:"http.response_content_length_uncompressed",HTTP_SERVER_NAME:"http.server_name",HTTP_ROUTE:"http.route",HTTP_CLIENT_IP:"http.client_ip",AWS_DYNAMODB_TABLE_NAMES:"aws.dynamodb.table_names",AWS_DYNAMODB_CONSUMED_CAPACITY:"aws.dynamodb.consumed_capacity",AWS_DYNAMODB_ITEM_COLLECTION_METRICS:"aws.dynamodb.item_collection_metrics",AWS_DYNAMODB_PROVISIONED_READ_CAPACITY:"aws.dynamodb.provisioned_read_capacity",AWS_DYNAMODB_PROVISIONED_WRITE_CAPACITY:"aws.dynamodb.provisioned_write_capacity",AWS_DYNAMODB_CONSISTENT_READ:"aws.dynamodb.consistent_read",AWS_DYNAMODB_PROJECTION:"aws.dynamodb.projection",AWS_DYNAMODB_LIMIT:"aws.dynamodb.limit",AWS_DYNAMODB_ATTRIBUTES_TO_GET:"aws.dynamodb.attributes_to_get",AWS_DYNAMODB_INDEX_NAME:"aws.dynamodb.index_name",AWS_DYNAMODB_SELECT:"aws.dynamodb.select",AWS_DYNAMODB_GLOBAL_SECONDARY_INDEXES:"aws.dynamodb.global_secondary_indexes",AWS_DYNAMODB_LOCAL_SECONDARY_INDEXES:"aws.dynamodb.local_secondary_indexes",AWS_DYNAMODB_EXCLUSIVE_START_TABLE:"aws.dynamodb.exclusive_start_table",AWS_DYNAMODB_TABLE_COUNT:"aws.dynamodb.table_count",AWS_DYNAMODB_SCAN_FORWARD:"aws.dynamodb.scan_forward",AWS_DYNAMODB_SEGMENT:"aws.dynamodb.segment",AWS_DYNAMODB_TOTAL_SEGMENTS:"aws.dynamodb.total_segments",AWS_DYNAMODB_COUNT:"aws.dynamodb.count",AWS_DYNAMODB_SCANNED_COUNT:"aws.dynamodb.scanned_count",AWS_DYNAMODB_ATTRIBUTE_DEFINITIONS:"aws.dynamodb.attribute_definitions",AWS_DYNAMODB_GLOBAL_SECONDARY_INDEX_UPDATES:"aws.dynamodb.global_secondary_index_updates",MESSAGING_SYSTEM:"messaging.system",MESSAGING_DESTINATION:"messaging.destination",MESSAGING_DESTINATION_KIND:"messaging.destination_kind",MESSAGING_TEMP_DESTINATION:"messaging.temp_destination",MESSAGING_PROTOCOL:"messaging.protocol",MESSAGING_PROTOCOL_VERSION:"messaging.protocol_version",MESSAGING_URL:"messaging.url",MESSAGING_MESSAGE_ID:"messaging.message_id",MESSAGING_CONVERSATION_ID:"messaging.conversation_id",MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES:"messaging.message_payload_size_bytes",MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES:"messaging.message_payload_compressed_size_bytes",MESSAGING_OPERATION:"messaging.operation",MESSAGING_CONSUMER_ID:"messaging.consumer_id",MESSAGING_RABBITMQ_ROUTING_KEY:"messaging.rabbitmq.routing_key",MESSAGING_KAFKA_MESSAGE_KEY:"messaging.kafka.message_key",MESSAGING_KAFKA_CONSUMER_GROUP:"messaging.kafka.consumer_group",MESSAGING_KAFKA_CLIENT_ID:"messaging.kafka.client_id",MESSAGING_KAFKA_PARTITION:"messaging.kafka.partition",MESSAGING_KAFKA_TOMBSTONE:"messaging.kafka.tombstone",RPC_SYSTEM:"rpc.system",RPC_SERVICE:"rpc.service",RPC_METHOD:"rpc.method",RPC_GRPC_STATUS_CODE:"rpc.grpc.status_code",RPC_JSONRPC_VERSION:"rpc.jsonrpc.version",RPC_JSONRPC_REQUEST_ID:"rpc.jsonrpc.request_id",RPC_JSONRPC_ERROR_CODE:"rpc.jsonrpc.error_code",RPC_JSONRPC_ERROR_MESSAGE:"rpc.jsonrpc.error_message",MESSAGE_TYPE:"message.type",MESSAGE_ID:"message.id",MESSAGE_COMPRESSED_SIZE:"message.compressed_size",MESSAGE_UNCOMPRESSED_SIZE:"message.uncompressed_size"},tZe={OTHER_SQL:"other_sql",MSSQL:"mssql",MYSQL:"mysql",ORACLE:"oracle",DB2:"db2",POSTGRESQL:"postgresql",REDSHIFT:"redshift",HIVE:"hive",CLOUDSCAPE:"cloudscape",HSQLDB:"hsqldb",PROGRESS:"progress",MAXDB:"maxdb",HANADB:"hanadb",INGRES:"ingres",FIRSTSQL:"firstsql",EDB:"edb",CACHE:"cache",ADABAS:"adabas",FIREBIRD:"firebird",DERBY:"derby",FILEMAKER:"filemaker",INFORMIX:"informix",INSTANTDB:"instantdb",INTERBASE:"interbase",MARIADB:"mariadb",NETEZZA:"netezza",PERVASIVE:"pervasive",POINTBASE:"pointbase",SQLITE:"sqlite",SYBASE:"sybase",TERADATA:"teradata",VERTICA:"vertica",H2:"h2",COLDFUSION:"coldfusion",CASSANDRA:"cassandra",HBASE:"hbase",MONGODB:"mongodb",REDIS:"redis",COUCHBASE:"couchbase",COUCHDB:"couchdb",COSMOSDB:"cosmosdb",DYNAMODB:"dynamodb",NEO4J:"neo4j",GEODE:"geode",ELASTICSEARCH:"elasticsearch",MEMCACHED:"memcached",COCKROACHDB:"cockroachdb"},rZe={ALL:"all",EACH_QUORUM:"each_quorum",QUORUM:"quorum",LOCAL_QUORUM:"local_quorum",ONE:"one",TWO:"two",THREE:"three",LOCAL_ONE:"local_one",ANY:"any",SERIAL:"serial",LOCAL_SERIAL:"local_serial"},nZe={DATASOURCE:"datasource",HTTP:"http",PUBSUB:"pubsub",TIMER:"timer",OTHER:"other"},iZe={INSERT:"insert",EDIT:"edit",DELETE:"delete"},oZe={ALIBABA_CLOUD:"alibaba_cloud",AWS:"aws",AZURE:"azure",GCP:"gcp"},sZe={IP_TCP:"ip_tcp",IP_UDP:"ip_udp",IP:"ip",UNIX:"unix",PIPE:"pipe",INPROC:"inproc",OTHER:"other"},aZe={WIFI:"wifi",WIRED:"wired",CELL:"cell",UNAVAILABLE:"unavailable",UNKNOWN:"unknown"},cZe={GPRS:"gprs",EDGE:"edge",UMTS:"umts",CDMA:"cdma",EVDO_0:"evdo_0",EVDO_A:"evdo_a",CDMA2000_1XRTT:"cdma2000_1xrtt",HSDPA:"hsdpa",HSUPA:"hsupa",HSPA:"hspa",IDEN:"iden",EVDO_B:"evdo_b",LTE:"lte",EHRPD:"ehrpd",HSPAP:"hspap",GSM:"gsm",TD_SCDMA:"td_scdma",IWLAN:"iwlan",NR:"nr",NRNSA:"nrnsa",LTE_CA:"lte_ca"},uZe={HTTP_1_0:"1.0",HTTP_1_1:"1.1",HTTP_2_0:"2.0",SPDY:"SPDY",QUIC:"QUIC"},lZe={QUEUE:"queue",TOPIC:"topic"},dZe={RECEIVE:"receive",PROCESS:"process"},pZe={OK:0,CANCELLED:1,UNKNOWN:2,INVALID_ARGUMENT:3,DEADLINE_EXCEEDED:4,NOT_FOUND:5,ALREADY_EXISTS:6,PERMISSION_DENIED:7,RESOURCE_EXHAUSTED:8,FAILED_PRECONDITION:9,ABORTED:10,OUT_OF_RANGE:11,UNIMPLEMENTED:12,INTERNAL:13,UNAVAILABLE:14,DATA_LOSS:15,UNAUTHENTICATED:16},fZe={SENT:"SENT",RECEIVED:"RECEIVED"}});var Xxe=A(()=>{Qxe()});var gr,mZe,hZe,gZe,vZe,bZe,oQ,Jxe=A(()=>{gr={CLOUD_PROVIDER:"cloud.provider",CLOUD_ACCOUNT_ID:"cloud.account.id",CLOUD_REGION:"cloud.region",CLOUD_AVAILABILITY_ZONE:"cloud.availability_zone",CLOUD_PLATFORM:"cloud.platform",AWS_ECS_CONTAINER_ARN:"aws.ecs.container.arn",AWS_ECS_CLUSTER_ARN:"aws.ecs.cluster.arn",AWS_ECS_LAUNCHTYPE:"aws.ecs.launchtype",AWS_ECS_TASK_ARN:"aws.ecs.task.arn",AWS_ECS_TASK_FAMILY:"aws.ecs.task.family",AWS_ECS_TASK_REVISION:"aws.ecs.task.revision",AWS_EKS_CLUSTER_ARN:"aws.eks.cluster.arn",AWS_LOG_GROUP_NAMES:"aws.log.group.names",AWS_LOG_GROUP_ARNS:"aws.log.group.arns",AWS_LOG_STREAM_NAMES:"aws.log.stream.names",AWS_LOG_STREAM_ARNS:"aws.log.stream.arns",CONTAINER_NAME:"container.name",CONTAINER_ID:"container.id",CONTAINER_RUNTIME:"container.runtime",CONTAINER_IMAGE_NAME:"container.image.name",CONTAINER_IMAGE_TAG:"container.image.tag",DEPLOYMENT_ENVIRONMENT:"deployment.environment",DEVICE_ID:"device.id",DEVICE_MODEL_IDENTIFIER:"device.model.identifier",DEVICE_MODEL_NAME:"device.model.name",FAAS_NAME:"faas.name",FAAS_ID:"faas.id",FAAS_VERSION:"faas.version",FAAS_INSTANCE:"faas.instance",FAAS_MAX_MEMORY:"faas.max_memory",HOST_ID:"host.id",HOST_NAME:"host.name",HOST_TYPE:"host.type",HOST_ARCH:"host.arch",HOST_IMAGE_NAME:"host.image.name",HOST_IMAGE_ID:"host.image.id",HOST_IMAGE_VERSION:"host.image.version",K8S_CLUSTER_NAME:"k8s.cluster.name",K8S_NODE_NAME:"k8s.node.name",K8S_NODE_UID:"k8s.node.uid",K8S_NAMESPACE_NAME:"k8s.namespace.name",K8S_POD_UID:"k8s.pod.uid",K8S_POD_NAME:"k8s.pod.name",K8S_CONTAINER_NAME:"k8s.container.name",K8S_REPLICASET_UID:"k8s.replicaset.uid",K8S_REPLICASET_NAME:"k8s.replicaset.name",K8S_DEPLOYMENT_UID:"k8s.deployment.uid",K8S_DEPLOYMENT_NAME:"k8s.deployment.name",K8S_STATEFULSET_UID:"k8s.statefulset.uid",K8S_STATEFULSET_NAME:"k8s.statefulset.name",K8S_DAEMONSET_UID:"k8s.daemonset.uid",K8S_DAEMONSET_NAME:"k8s.daemonset.name",K8S_JOB_UID:"k8s.job.uid",K8S_JOB_NAME:"k8s.job.name",K8S_CRONJOB_UID:"k8s.cronjob.uid",K8S_CRONJOB_NAME:"k8s.cronjob.name",OS_TYPE:"os.type",OS_DESCRIPTION:"os.description",OS_NAME:"os.name",OS_VERSION:"os.version",PROCESS_PID:"process.pid",PROCESS_EXECUTABLE_NAME:"process.executable.name",PROCESS_EXECUTABLE_PATH:"process.executable.path",PROCESS_COMMAND:"process.command",PROCESS_COMMAND_LINE:"process.command_line",PROCESS_COMMAND_ARGS:"process.command_args",PROCESS_OWNER:"process.owner",PROCESS_RUNTIME_NAME:"process.runtime.name",PROCESS_RUNTIME_VERSION:"process.runtime.version",PROCESS_RUNTIME_DESCRIPTION:"process.runtime.description",SERVICE_NAME:"service.name",SERVICE_NAMESPACE:"service.namespace",SERVICE_INSTANCE_ID:"service.instance.id",SERVICE_VERSION:"service.version",TELEMETRY_SDK_NAME:"telemetry.sdk.name",TELEMETRY_SDK_LANGUAGE:"telemetry.sdk.language",TELEMETRY_SDK_VERSION:"telemetry.sdk.version",TELEMETRY_AUTO_VERSION:"telemetry.auto.version",WEBENGINE_NAME:"webengine.name",WEBENGINE_VERSION:"webengine.version",WEBENGINE_DESCRIPTION:"webengine.description"},mZe={ALIBABA_CLOUD:"alibaba_cloud",AWS:"aws",AZURE:"azure",GCP:"gcp"},hZe={ALIBABA_CLOUD_ECS:"alibaba_cloud_ecs",ALIBABA_CLOUD_FC:"alibaba_cloud_fc",AWS_EC2:"aws_ec2",AWS_ECS:"aws_ecs",AWS_EKS:"aws_eks",AWS_LAMBDA:"aws_lambda",AWS_ELASTIC_BEANSTALK:"aws_elastic_beanstalk",AZURE_VM:"azure_vm",AZURE_CONTAINER_INSTANCES:"azure_container_instances",AZURE_AKS:"azure_aks",AZURE_FUNCTIONS:"azure_functions",AZURE_APP_SERVICE:"azure_app_service",GCP_COMPUTE_ENGINE:"gcp_compute_engine",GCP_CLOUD_RUN:"gcp_cloud_run",GCP_KUBERNETES_ENGINE:"gcp_kubernetes_engine",GCP_CLOUD_FUNCTIONS:"gcp_cloud_functions",GCP_APP_ENGINE:"gcp_app_engine"},gZe={EC2:"ec2",FARGATE:"fargate"},vZe={AMD64:"amd64",ARM32:"arm32",ARM64:"arm64",IA64:"ia64",PPC32:"ppc32",PPC64:"ppc64",X86:"x86"},bZe={WINDOWS:"windows",LINUX:"linux",DARWIN:"darwin",FREEBSD:"freebsd",NETBSD:"netbsd",OPENBSD:"openbsd",DRAGONFLYBSD:"dragonflybsd",HPUX:"hpux",AIX:"aix",SOLARIS:"solaris",Z_OS:"z_os"},oQ={CPP:"cpp",DOTNET:"dotnet",ERLANG:"erlang",GO:"go",JAVA:"java",NODEJS:"nodejs",PHP:"php",PYTHON:"python",RUBY:"ruby",WEBJS:"webjs"}});var Zxe=A(()=>{Jxe()});var sQ={};_n(sQ,{AwsEcsLaunchtypeValues:()=>gZe,CloudPlatformValues:()=>hZe,CloudProviderValues:()=>mZe,DbCassandraConsistencyLevelValues:()=>rZe,DbSystemValues:()=>tZe,FaasDocumentOperationValues:()=>iZe,FaasInvokedProviderValues:()=>oZe,FaasTriggerValues:()=>nZe,HostArchValues:()=>vZe,HttpFlavorValues:()=>uZe,MessageTypeValues:()=>fZe,MessagingDestinationKindValues:()=>lZe,MessagingOperationValues:()=>dZe,NetHostConnectionSubtypeValues:()=>cZe,NetHostConnectionTypeValues:()=>aZe,NetTransportValues:()=>sZe,OsTypeValues:()=>bZe,RpcGrpcStatusCodeValues:()=>pZe,SemanticAttributes:()=>Am,SemanticResourceAttributes:()=>gr,TelemetrySdkLanguageValues:()=>oQ});var td=A(()=>{Xxe();Zxe()});var wT,rA,eSe=A(()=>{k6();td();rA=(wT={},wT[gr.TELEMETRY_SDK_NAME]="opentelemetry",wT[gr.PROCESS_RUNTIME_NAME]="node",wT[gr.TELEMETRY_SDK_LANGUAGE]=oQ.NODEJS,wT[gr.TELEMETRY_SDK_VERSION]=iQ,wT)});function aQ(t){t.unref()}var tSe=A(()=>{});var rSe=A(()=>{jxe();Hxe();Gxe();Wxe();Yxe();eSe();tSe()});var cQ=A(()=>{rSe()});function Dp(t){var e=t/1e3,r=Math.trunc(e),n=Math.round(t%1e3*_Ze);return[r,n]}function nA(){var t=Pm.timeOrigin;if(typeof t!="number"){var e=Pm;t=e.timing&&e.timing.fetchStart}return t}function A6(t){var e=Dp(nA()),r=Dp(typeof t=="number"?t:Pm.now());return L6(e,r)}function xZe(t){if(iA(t))return t;if(typeof t=="number")return t<nA()?A6(t):Dp(t);if(t instanceof Date)return Dp(t.getTime());throw TypeError("Invalid input type")}function uQ(t,e){var r=e[0]-t[0],n=e[1]-t[1];return n<0&&(r-=1,n+=P6),[r,n]}function SZe(t){var e=nSe,r=""+"0".repeat(e)+t[1]+"Z",n=r.substr(r.length-e-1),o=new Date(t[0]*1e3).toISOString();return o.replace("000Z",n)}function IZe(t){return t[0]*P6+t[1]}function CZe(t){return t[0]*1e3+t[1]/1e6}function D6(t){return t[0]*1e6+t[1]/1e3}function iA(t){return Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number"}function N6(t){return iA(t)||typeof t=="number"||t instanceof Date}function L6(t,e){var r=[t[0]+e[0],t[1]+e[1]];return r[1]>=P6&&(r[1]-=P6,r[0]+=1),r}var nSe,yZe,_Ze,P6,iSe=A(()=>{cQ();nSe=9,yZe=6,_Ze=Math.pow(10,yZe),P6=Math.pow(10,nSe)});var oSe=A(()=>{});var Ku,sSe=A(()=>{(function(t){t[t.SUCCESS=0]="SUCCESS",t[t.FAILED=1]="FAILED"})(Ku||(Ku={}))});var TZe,lQ,aSe=A(()=>{Pr();TZe=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},lQ=function(){function t(e){e===void 0&&(e={});var r;this._propagators=(r=e.propagators)!==null&&r!==void 0?r:[],this._fields=Array.from(new Set(this._propagators.map(function(n){return typeof n.fields=="function"?n.fields():[]}).reduce(function(n,o){return n.concat(o)},[])))}return t.prototype.inject=function(e,r,n){var o,s;try{for(var a=TZe(this._propagators),c=a.next();!c.done;c=a.next()){var u=c.value;try{u.inject(e,r,n)}catch(l){Tt.warn("Failed to inject with "+u.constructor.name+". Err: "+l.message)}}}catch(l){o={error:l}}finally{try{c&&!c.done&&(s=a.return)&&s.call(a)}finally{if(o)throw o.error}}},t.prototype.extract=function(e,r,n){return this._propagators.reduce(function(o,s){try{return s.extract(o,r,n)}catch(a){Tt.warn("Failed to inject with "+s.constructor.name+". Err: "+a.message)}return o},e)},t.prototype.fields=function(){return this._fields.slice()},t}()});function cSe(t){return RZe.test(t)}function uSe(t){return kZe.test(t)&&!PZe.test(t)}var dQ,EZe,wZe,RZe,kZe,PZe,lSe=A(()=>{dQ="[_0-9a-z-*/]",EZe="[a-z]"+dQ+"{0,255}",wZe="[a-z0-9]"+dQ+"{0,240}@[a-z]"+dQ+"{0,13}",RZe=new RegExp("^(?:"+EZe+"|"+wZe+")$"),kZe=/^[ -~]{0,255}[!-~]$/,PZe=/,|=/});var dSe,AZe,pSe,fSe,pQ,fQ=A(()=>{lSe();dSe=32,AZe=512,pSe=",",fSe="=",pQ=function(){function t(e){this._internalState=new Map,e&&this._parse(e)}return t.prototype.set=function(e,r){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,r),n},t.prototype.unset=function(e){var r=this._clone();return r._internalState.delete(e),r},t.prototype.get=function(e){return this._internalState.get(e)},t.prototype.serialize=function(){var e=this;return this._keys().reduce(function(r,n){return r.push(n+fSe+e.get(n)),r},[]).join(pSe)},t.prototype._parse=function(e){e.length>AZe||(this._internalState=e.split(pSe).reverse().reduce(function(r,n){var o=n.trim(),s=o.indexOf(fSe);if(s!==-1){var a=o.slice(0,s),c=o.slice(s+1,n.length);cSe(a)&&uSe(c)&&r.set(a,c)}return r},new Map),this._internalState.size>dSe&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,dSe))))},t.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},t.prototype._clone=function(){var e=new t;return e._internalState=new Map(this._internalState),e},t}()});function mSe(t){var e=FZe.exec(t);return!e||e[1]==="00"&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}}var O6,M6,DZe,NZe,LZe,OZe,MZe,FZe,mQ,hSe=A(()=>{Pr();eA();fQ();O6="traceparent",M6="tracestate",DZe="00",NZe="(?!ff)[\\da-f]{2}",LZe="(?![0]{32})[\\da-f]{32}",OZe="(?![0]{16})[\\da-f]{16}",MZe="[\\da-f]{2}",FZe=new RegExp("^\\s?("+NZe+")-("+LZe+")-("+OZe+")-("+MZe+")(-.*)?\\s?$");mQ=function(){function t(){}return t.prototype.inject=function(e,r,n){var o=Ro.getSpanContext(e);if(!(!o||o_(e)||!Wu(o))){var s=DZe+"-"+o.traceId+"-"+o.spanId+"-0"+Number(o.traceFlags||$i.NONE).toString(16);n.set(r,O6,s),o.traceState&&n.set(r,M6,o.traceState.serialize())}},t.prototype.extract=function(e,r,n){var o=n.get(r,O6);if(!o)return e;var s=Array.isArray(o)?o[0]:o;if(typeof s!="string")return e;var a=mSe(s);if(!a)return e;a.isRemote=!0;var c=n.get(r,M6);if(c){var u=Array.isArray(c)?c.join(","):c;a.traceState=new pQ(typeof u=="string"?u:void 0)}return Ro.setSpanContext(e,a)},t.prototype.fields=function(){return[O6,M6]},t}()});var gSe=A(()=>{});function UZe(t,e){return t.setValue(gQ,e)}function BZe(t){return t.deleteValue(gQ)}function qZe(t){return t.getValue(gQ)}var gQ,hQ,vSe=A(()=>{Pr();gQ=Ap("OpenTelemetry SDK Context Key RPC_METADATA");(function(t){t.HTTP="http"})(hQ||(hQ={}))});var F6,vQ=A(()=>{Pr();F6=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:nc.NOT_RECORD}},t.prototype.toString=function(){return"AlwaysOffSampler"},t}()});var oA,bQ=A(()=>{Pr();oA=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:nc.RECORD_AND_SAMPLED}},t.prototype.toString=function(){return"AlwaysOnSampler"},t}()});var jZe,bSe=A(()=>{Pr();eQ();vQ();bQ();jZe=function(){function t(e){var r,n,o,s;this._root=e.root,this._root||(ic(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new oA),this._remoteParentSampled=(r=e.remoteParentSampled)!==null&&r!==void 0?r:new oA,this._remoteParentNotSampled=(n=e.remoteParentNotSampled)!==null&&n!==void 0?n:new F6,this._localParentSampled=(o=e.localParentSampled)!==null&&o!==void 0?o:new oA,this._localParentNotSampled=(s=e.localParentNotSampled)!==null&&s!==void 0?s:new F6}return t.prototype.shouldSample=function(e,r,n,o,s,a){var c=Ro.getSpanContext(e);return!c||!Wu(c)?this._root.shouldSample(e,r,n,o,s,a):c.isRemote?c.traceFlags&$i.SAMPLED?this._remoteParentSampled.shouldSample(e,r,n,o,s,a):this._remoteParentNotSampled.shouldSample(e,r,n,o,s,a):c.traceFlags&$i.SAMPLED?this._localParentSampled.shouldSample(e,r,n,o,s,a):this._localParentNotSampled.shouldSample(e,r,n,o,s,a)},t.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},t}()});var HZe,ySe=A(()=>{Pr();HZe=function(){function t(e){e===void 0&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(this._ratio*4294967295)}return t.prototype.shouldSample=function(e,r){return{decision:i_(r)&&this._accumulate(r)<this._upperBound?nc.RECORD_AND_SAMPLED:nc.NOT_RECORD}},t.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},t.prototype._normalize=function(e){return typeof e!="number"||isNaN(e)?0:e>=1?1:e<=0?0:e},t.prototype._accumulate=function(e){for(var r=0,n=0;n<e.length/8;n++){var o=n*8,s=parseInt(e.slice(o,o+8),16);r=(r^s)>>>0}return r},t}()});function YZe(t,e){return function(r){return t(e(r))}}function yQ(t){if(!QZe(t)||XZe(t)!==VZe)return!1;var e=KZe(t);if(e===null)return!0;var r=SSe.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&_Se.call(r)===WZe}function QZe(t){return t!=null&&typeof t=="object"}function XZe(t){return t==null?t===void 0?zZe:GZe:a_&&a_ in Object(t)?JZe(t):ZZe(t)}function JZe(t){var e=SSe.call(t,a_),r=t[a_],n=!1;try{t[a_]=void 0,n=!0}catch{}var o=ISe.call(t);return n&&(e?t[a_]=r:delete t[a_]),o}function ZZe(t){return ISe.call(t)}var VZe,GZe,zZe,$Ze,_Se,WZe,KZe,xSe,SSe,a_,ISe,CSe=A(()=>{VZe="[object Object]",GZe="[object Null]",zZe="[object Undefined]",$Ze=Function.prototype,_Se=$Ze.toString,WZe=_Se.call(Object),KZe=YZe(Object.getPrototypeOf,Object),xSe=Object.prototype,SSe=xSe.hasOwnProperty,a_=Symbol?Symbol.toStringTag:void 0,ISe=xSe.toString});function xQ(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=t.shift(),n=new WeakMap;t.length>0;)r=ESe(r,t.shift(),0,n);return r}function _Q(t){return B6(t)?t.slice():t}function ESe(t,e,r,n){r===void 0&&(r=0);var o;if(!(r>eet)){if(r++,U6(t)||U6(e)||wSe(e))o=_Q(e);else if(B6(t)){if(o=t.slice(),B6(e))for(var s=0,a=e.length;s<a;s++)o.push(_Q(e[s]));else if(sA(e))for(var c=Object.keys(e),s=0,a=c.length;s<a;s++){var u=c[s];o[u]=_Q(e[u])}}else if(sA(t))if(sA(e)){if(!tet(t,e))return e;o=Object.assign({},t);for(var c=Object.keys(e),s=0,a=c.length;s<a;s++){var u=c[s],l=e[u];if(U6(l))typeof l>"u"?delete o[u]:o[u]=l;else{var d=o[u],p=l;if(TSe(t,u,n)||TSe(e,u,n))delete o[u];else{if(sA(d)&&sA(p)){var f=n.get(d)||[],m=n.get(p)||[];f.push({obj:t,key:u}),m.push({obj:e,key:u}),n.set(d,f),n.set(p,m)}o[u]=ESe(o[u],l,r,n)}}}}else o=e;return o}}function TSe(t,e,r){for(var n=r.get(t[e])||[],o=0,s=n.length;o<s;o++){var a=n[o];if(a.key===e&&a.obj===t)return!0}return!1}function B6(t){return Array.isArray(t)}function wSe(t){return typeof t=="function"}function sA(t){return!U6(t)&&!B6(t)&&!wSe(t)&&typeof t=="object"}function U6(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t>"u"||t instanceof Date||t instanceof RegExp||t===null}function tet(t,e){return!(!yQ(t)||!yQ(e))}var eet,RSe=A(()=>{CSe();eet=20});function net(t,e){var r,n=new Promise(function(s,a){r=setTimeout(function(){a(new kSe("Operation timed out."))},e)});return Promise.race([t,n]).then(function(o){return clearTimeout(r),o},function(o){throw clearTimeout(r),o})}var ret,kSe,PSe=A(()=>{ret=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),kSe=function(t){ret(e,t);function e(r){var n=t.call(this,r)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error)});function ASe(t,e){return typeof e=="string"?t===e:!!t.match(e)}function oet(t,e){var r,n;if(!e)return!1;try{for(var o=iet(e),s=o.next();!s.done;s=o.next()){var a=s.value;if(ASe(t,a))return!0}}catch(c){r={error:c}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!1}var iet,DSe=A(()=>{iet=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}});function set(t){return typeof t=="function"&&typeof t.__original=="function"&&typeof t.__unwrap=="function"&&t.__wrapped===!0}var NSe=A(()=>{});var LSe,OSe=A(()=>{LSe=function(){function t(){var e=this;this._promise=new Promise(function(r,n){e._resolve=r,e._reject=n})}return Object.defineProperty(t.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),t.prototype.resolve=function(e){this._resolve(e)},t.prototype.reject=function(e){this._reject(e)},t}()});var aet,cet,aA,MSe=A(()=>{OSe();aet=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},cet=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},aA=function(){function t(e,r){this._callback=e,this._that=r,this._isCalled=!1,this._deferred=new LSe}return Object.defineProperty(t.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),t.prototype.call=function(){for(var e,r=this,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,cet([this._that],aet(n),!1))).then(function(s){return r._deferred.resolve(s)},function(s){return r._deferred.reject(s)})}catch(s){this._deferred.reject(s)}}return this._deferred.promise},t}()});function FSe(t,e){return new Promise(function(r){wa.with(Z2(wa.active()),function(){t.export(e,function(n){r(n)})})})}var USe=A(()=>{Pr();eA()});var BSe={};_n(BSe,{AlwaysOffSampler:()=>F6,AlwaysOnSampler:()=>oA,AnchoredClock:()=>AJe,BindOnceFuture:()=>aA,CompositePropagator:()=>lQ,DEFAULT_ATTRIBUTE_COUNT_LIMIT:()=>ET,DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT:()=>TT,DEFAULT_ENVIRONMENT:()=>w6,DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:()=>Uxe,DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:()=>Bxe,ExportResultCode:()=>Ku,ParentBasedSampler:()=>jZe,RPCType:()=>hQ,RandomIdGenerator:()=>eZe,SDK_INFO:()=>rA,TRACE_PARENT_HEADER:()=>O6,TRACE_STATE_HEADER:()=>M6,TimeoutError:()=>kSe,TraceIdRatioBasedSampler:()=>HZe,TraceState:()=>pQ,TracesSamplerValues:()=>Gc,VERSION:()=>iQ,W3CBaggagePropagator:()=>XY,W3CTraceContextPropagator:()=>mQ,_globalThis:()=>YJe,addHrTimes:()=>L6,baggageUtils:()=>YY,callWithTimeout:()=>net,deleteRPCMetadata:()=>BZe,getEnv:()=>ko,getEnvWithoutDefaults:()=>rQ,getRPCMetadata:()=>qZe,getTimeOrigin:()=>nA,globalErrorHandler:()=>ic,hexToBase64:()=>JJe,hrTime:()=>A6,hrTimeDuration:()=>uQ,hrTimeToMicroseconds:()=>D6,hrTimeToMilliseconds:()=>CZe,hrTimeToNanoseconds:()=>IZe,hrTimeToTimeStamp:()=>SZe,internal:()=>SQ,isAttributeKey:()=>Dxe,isAttributeValue:()=>E6,isTimeInput:()=>N6,isTimeInputHrTime:()=>iA,isTracingSuppressed:()=>o_,isUrlIgnored:()=>oet,isWrapped:()=>set,loggingErrorHandler:()=>JY,merge:()=>xQ,millisToHrTime:()=>Dp,otperformance:()=>Pm,parseEnvironment:()=>tA,parseTraceParent:()=>mSe,sanitizeAttributes:()=>s_,setGlobalErrorHandler:()=>MJe,setRPCMetadata:()=>UZe,suppressTracing:()=>Z2,timeInputToHrTime:()=>xZe,unrefTimer:()=>aQ,unsuppressTracing:()=>RJe,urlMatches:()=>ASe});var SQ,Ra=A(()=>{kxe();Pxe();Lxe();eQ();ZY();iSe();oSe();sSe();k6();QY();cQ();aSe();hSe();gSe();vSe();vQ();bQ();bSe();ySe();eA();fQ();nQ();RSe();tQ();PSe();DSe();NSe();MSe();k6();USe();SQ={_export:FSe}});var qSe,jSe=A(()=>{qSe="exception"});var uet,det,IQ,CQ=A(()=>{Pr();Ra();td();jSe();uet=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},det=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},IQ=function(){function t(e,r,n,o,s,a,c,u,l){c===void 0&&(c=[]),this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:ST.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=n,this._spanContext=o,this.parentSpanId=a,this.kind=s,this.links=c;var d=Date.now();this._performanceStartTime=Pm.now(),this._performanceOffset=d-(this._performanceStartTime+nA()),this._startTimeProvided=u!=null,this.startTime=this._getTime(u??d),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._spanLimits=e.getSpanLimits(),this._spanProcessor=e.getActiveSpanProcessor(),this._spanProcessor.onStart(this,r),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,r){return r==null||this._isSpanEnded()?this:e.length===0?(Tt.warn("Invalid attribute key: "+e),this):E6(r)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(r),this):(Tt.warn("Invalid attribute value set for key: "+e),this)},t.prototype.setAttributes=function(e){var r,n;try{for(var o=uet(Object.entries(e)),s=o.next();!s.done;s=o.next()){var a=det(s.value,2),c=a[0],u=a[1];this.setAttribute(c,u)}}catch(l){r={error:l}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return this},t.prototype.addEvent=function(e,r,n){if(this._isSpanEnded())return this;if(this._spanLimits.eventCountLimit===0)return Tt.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(Tt.warn("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),N6(r)&&(N6(n)||(n=r),r=void 0);var o=s_(r);return this.events.push({name:e,attributes:o,time:this._getTime(n),droppedAttributesCount:0}),this},t.prototype.setStatus=function(e){return this._isSpanEnded()?this:(this.status=e,this)},t.prototype.updateName=function(e){return this._isSpanEnded()?this:(this.name=e,this)},t.prototype.end=function(e){if(this._isSpanEnded()){Tt.error(this.name+" "+this._spanContext.traceId+"-"+this._spanContext.spanId+" - You can only call end() on a span once.");return}this._ended=!0,this.endTime=this._getTime(e),this._duration=uQ(this.startTime,this.endTime),this._duration[0]<0&&(Tt.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._spanProcessor.onEnd(this)},t.prototype._getTime=function(e){if(typeof e=="number"&&e<Pm.now())return A6(e+this._performanceOffset);if(typeof e=="number")return Dp(e);if(e instanceof Date)return Dp(e.getTime());if(iA(e))return e;if(this._startTimeProvided)return Dp(Date.now());var r=Pm.now()-this._performanceStartTime;return L6(this.startTime,Dp(r))},t.prototype.isRecording=function(){return this._ended===!1},t.prototype.recordException=function(e,r){var n={};typeof e=="string"?n[Am.EXCEPTION_MESSAGE]=e:e&&(e.code?n[Am.EXCEPTION_TYPE]=e.code.toString():e.name&&(n[Am.EXCEPTION_TYPE]=e.name),e.message&&(n[Am.EXCEPTION_MESSAGE]=e.message),e.stack&&(n[Am.EXCEPTION_STACKTRACE]=e.stack)),n[Am.EXCEPTION_TYPE]||n[Am.EXCEPTION_MESSAGE]?this.addEvent(qSe,n,r):Tt.warn("Failed to record an exception "+e)},Object.defineProperty(t.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedAttributesCount",{get:function(){return this._droppedAttributesCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedEventsCount",{get:function(){return this._droppedEventsCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"droppedLinksCount",{get:function(){return this._droppedLinksCount},enumerable:!1,configurable:!0}),t.prototype._isSpanEnded=function(){return this._ended&&Tt.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},t.prototype._truncateToLimitUtil=function(e,r){return e.length<=r?e:e.substr(0,r)},t.prototype._truncateToSize=function(e){var r=this,n=this._attributeValueLengthLimit;return n<=0?(Tt.warn("Attribute value limit must be positive, got "+n),e):typeof e=="string"?this._truncateToLimitUtil(e,n):Array.isArray(e)?e.map(function(o){return typeof o=="string"?r._truncateToLimitUtil(o,n):o}):e},t}()});var Np,cA=A(()=>{(function(t){t[t.NOT_RECORD=0]="NOT_RECORD",t[t.RECORD=1]="RECORD",t[t.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(Np||(Np={}))});var c_,q6=A(()=>{cA();c_=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:Np.NOT_RECORD}},t.prototype.toString=function(){return"AlwaysOffSampler"},t}()});var Dm,j6=A(()=>{cA();Dm=function(){function t(){}return t.prototype.shouldSample=function(){return{decision:Np.RECORD_AND_SAMPLED}},t.prototype.toString=function(){return"AlwaysOnSampler"},t}()});var uA,TQ=A(()=>{Pr();Ra();q6();j6();uA=function(){function t(e){var r,n,o,s;this._root=e.root,this._root||(ic(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Dm),this._remoteParentSampled=(r=e.remoteParentSampled)!==null&&r!==void 0?r:new Dm,this._remoteParentNotSampled=(n=e.remoteParentNotSampled)!==null&&n!==void 0?n:new c_,this._localParentSampled=(o=e.localParentSampled)!==null&&o!==void 0?o:new Dm,this._localParentNotSampled=(s=e.localParentNotSampled)!==null&&s!==void 0?s:new c_}return t.prototype.shouldSample=function(e,r,n,o,s,a){var c=Ro.getSpanContext(e);return!c||!Wu(c)?this._root.shouldSample(e,r,n,o,s,a):c.isRemote?c.traceFlags&$i.SAMPLED?this._remoteParentSampled.shouldSample(e,r,n,o,s,a):this._remoteParentNotSampled.shouldSample(e,r,n,o,s,a):c.traceFlags&$i.SAMPLED?this._localParentSampled.shouldSample(e,r,n,o,s,a):this._localParentNotSampled.shouldSample(e,r,n,o,s,a)},t.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},t}()});var H6,EQ=A(()=>{Pr();cA();H6=function(){function t(e){e===void 0&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(this._ratio*4294967295)}return t.prototype.shouldSample=function(e,r){return{decision:i_(r)&&this._accumulate(r)<this._upperBound?Np.RECORD_AND_SAMPLED:Np.NOT_RECORD}},t.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},t.prototype._normalize=function(e){return typeof e!="number"||isNaN(e)?0:e>=1?1:e<=0?0:e},t.prototype._accumulate=function(e){for(var r=0,n=0;n<e.length/8;n++){var o=n*8,s=parseInt(e.slice(o,o+8),16);r=(r^s)>>>0}return r},t}()});function V6(){return{sampler:wQ(pet),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:ko().OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:ko().OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:ko().OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:ko().OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:ko().OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:ko().OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:ko().OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:ko().OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT}}}function wQ(t){switch(t===void 0&&(t=ko()),t.OTEL_TRACES_SAMPLER){case Gc.AlwaysOn:return new Dm;case Gc.AlwaysOff:return new c_;case Gc.ParentBasedAlwaysOn:return new uA({root:new Dm});case Gc.ParentBasedAlwaysOff:return new uA({root:new c_});case Gc.TraceIdRatio:return new H6(HSe(t));case Gc.ParentBasedTraceIdRatio:return new uA({root:new H6(HSe(t))});default:return Tt.error('OTEL_TRACES_SAMPLER value "'+t.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+fet+'".'),new Dm}}function HSe(t){if(t.OTEL_TRACES_SAMPLER_ARG===void 0||t.OTEL_TRACES_SAMPLER_ARG==="")return Tt.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to "+RT+"."),RT;var e=Number(t.OTEL_TRACES_SAMPLER_ARG);return isNaN(e)?(Tt.error("OTEL_TRACES_SAMPLER_ARG="+t.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to "+RT+"."),RT):e<0||e>1?(Tt.error("OTEL_TRACES_SAMPLER_ARG="+t.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to "+RT+"."),RT):e}var pet,fet,RT,RQ=A(()=>{Pr();Ra();q6();j6();TQ();EQ();pet=ko(),fet=Gc.AlwaysOn,RT=1});function VSe(t){var e={sampler:wQ()},r=V6(),n=Object.assign({},r,e,t);return n.generalLimits=Object.assign({},r.generalLimits,t.generalLimits||{}),n.spanLimits=Object.assign({},r.spanLimits,t.spanLimits||{}),n}function GSe(t){var e,r,n,o,s,a,c,u,l,d,p,f,m=Object.assign({},t.spanLimits),h=rQ();return m.attributeCountLimit=(a=(s=(o=(r=(e=t.spanLimits)===null||e===void 0?void 0:e.attributeCountLimit)!==null&&r!==void 0?r:(n=t.generalLimits)===null||n===void 0?void 0:n.attributeCountLimit)!==null&&o!==void 0?o:h.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)!==null&&s!==void 0?s:h.OTEL_ATTRIBUTE_COUNT_LIMIT)!==null&&a!==void 0?a:ET,m.attributeValueLengthLimit=(f=(p=(d=(u=(c=t.spanLimits)===null||c===void 0?void 0:c.attributeValueLengthLimit)!==null&&u!==void 0?u:(l=t.generalLimits)===null||l===void 0?void 0:l.attributeValueLengthLimit)!==null&&d!==void 0?d:h.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&p!==void 0?p:h.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&f!==void 0?f:TT,Object.assign({},t,{spanLimits:m})}var kQ=A(()=>{RQ();Ra()});var zSe,$Se=A(()=>{Pr();Ra();zSe=function(){function t(e,r){this._exporter=e,this._finishedSpans=[],this._droppedSpansCount=0;var n=ko();this._maxExportBatchSize=typeof r?.maxExportBatchSize=="number"?r.maxExportBatchSize:n.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize=typeof r?.maxQueueSize=="number"?r.maxQueueSize:n.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis=typeof r?.scheduledDelayMillis=="number"?r.scheduledDelayMillis:n.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis=typeof r?.exportTimeoutMillis=="number"?r.exportTimeoutMillis:n.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new aA(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(Tt.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return t.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},t.prototype.onStart=function(e,r){},t.prototype.onEnd=function(e){this._shutdownOnce.isCalled||e.spanContext().traceFlags&$i.SAMPLED&&this._addToBuffer(e)},t.prototype.shutdown=function(){return this._shutdownOnce.call()},t.prototype._shutdown=function(){var e=this;return Promise.resolve().then(function(){return e.onShutdown()}).then(function(){return e._flushAll()}).then(function(){return e._exporter.shutdown()})},t.prototype._addToBuffer=function(e){if(this._finishedSpans.length>=this._maxQueueSize){this._droppedSpansCount===0&&Tt.debug("maxQueueSize reached, dropping spans"),this._droppedSpansCount++;return}this._droppedSpansCount>0&&(Tt.warn("Dropped "+this._droppedSpansCount+" spans because maxQueueSize reached"),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()},t.prototype._flushAll=function(){var e=this;return new Promise(function(r,n){for(var o=[],s=Math.ceil(e._finishedSpans.length/e._maxExportBatchSize),a=0,c=s;a<c;a++)o.push(e._flushOneBatch());Promise.all(o).then(function(){r()}).catch(n)})},t.prototype._flushOneBatch=function(){var e=this;return this._clearTimer(),this._finishedSpans.length===0?Promise.resolve():new Promise(function(r,n){var o=setTimeout(function(){n(new Error("Timeout"))},e._exportTimeoutMillis);wa.with(Z2(wa.active()),function(){var s=e._finishedSpans.splice(0,e._maxExportBatchSize),a=function(){return e._exporter.export(s,function(u){var l;clearTimeout(o),u.code===Ku.SUCCESS?r():n((l=u.error)!==null&&l!==void 0?l:new Error("BatchSpanProcessor: span export failed"))})},c=s.map(function(u){return u.resource}).filter(function(u){return u.asyncAttributesPending});c.length===0?a():Promise.all(c.map(function(u){var l;return(l=u.waitForAsyncAttributes)===null||l===void 0?void 0:l.call(u)})).then(a,function(u){ic(u),n(u)})})})},t.prototype._maybeStartTimer=function(){var e=this;this._timer===void 0&&(this._timer=setTimeout(function(){e._flushOneBatch().then(function(){e._finishedSpans.length>0&&(e._clearTimer(),e._maybeStartTimer())}).catch(function(r){ic(r)})},this._scheduledDelayMillis),aQ(this._timer))},t.prototype._clearTimer=function(){this._timer!==void 0&&(clearTimeout(this._timer),this._timer=void 0)},t}()});var met,PQ,WSe=A(()=>{$Se();met=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),PQ=function(t){met(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.onShutdown=function(){},e}(zSe)});function KSe(t){return function(){for(var r=0;r<t/4;r++)G6.writeUInt32BE(Math.random()*Math.pow(2,32)>>>0,r*4);for(var r=0;r<t&&!(G6[r]>0);r++)r===t-1&&(G6[t-1]=1);return G6.toString("hex",0,t)}}var het,YSe,AQ,G6,QSe=A(()=>{het=8,YSe=16,AQ=function(){function t(){this.generateTraceId=KSe(YSe),this.generateSpanId=KSe(het)}return t}(),G6=Buffer.allocUnsafe(YSe)});var XSe=A(()=>{WSe();QSe()});var z6=A(()=>{XSe()});var DQ,JSe=A(()=>{Pr();Ra();CQ();kQ();z6();DQ=function(){function t(e,r,n){this._tracerProvider=n;var o=VSe(r);this._sampler=o.sampler,this._generalLimits=o.generalLimits,this._spanLimits=o.spanLimits,this._idGenerator=r.idGenerator||new AQ,this.resource=n.resource,this.instrumentationLibrary=e}return t.prototype.startSpan=function(e,r,n){var o,s,a;r===void 0&&(r={}),n===void 0&&(n=wa.active()),r.root&&(n=Ro.deleteSpan(n));var c=Ro.getSpan(n);if(o_(n)){Tt.debug("Instrumentation suppressed, returning Noop Span");var u=Ro.wrapSpanContext(_T);return u}var l=c?.spanContext(),d=this._idGenerator.generateSpanId(),p,f,m;!l||!Ro.isSpanContextValid(l)?p=this._idGenerator.generateTraceId():(p=l.traceId,f=l.traceState,m=l.spanId);var h=(o=r.kind)!==null&&o!==void 0?o:xT.INTERNAL,g=((s=r.links)!==null&&s!==void 0?s:[]).map(function(E){return{context:E.context,attributes:s_(E.attributes)}}),v=s_(r.attributes),y=this._sampler.shouldSample(n,p,e,h,v,g);f=(a=y.traceState)!==null&&a!==void 0?a:f;var _=y.decision===nc.RECORD_AND_SAMPLED?$i.SAMPLED:$i.NONE,x={traceId:p,spanId:d,traceFlags:_,traceState:f};if(y.decision===nc.NOT_RECORD){Tt.debug("Recording is off, propagating context in a non-recording span");var u=Ro.wrapSpanContext(x);return u}var S=new IQ(this,n,e,x,h,m,g,r.startTime),I=s_(Object.assign(v,y.attributes));return S.setAttributes(I),S},t.prototype.startActiveSpan=function(e,r,n,o){var s,a,c;if(!(arguments.length<2)){arguments.length===2?c=r:arguments.length===3?(s=r,c=n):(s=r,a=n,c=o);var u=a??wa.active(),l=this.startSpan(e,s,u),d=Ro.setSpan(u,l);return wa.with(d,c,void 0,l)}},t.prototype.getGeneralLimits=function(){return this._generalLimits},t.prototype.getSpanLimits=function(){return this._spanLimits},t.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},t}()});function ZSe(){return"unknown_service:"+process.argv0}var e1e=A(()=>{});var t1e,r1e,NQ=A(()=>{t1e=function(t){switch(t){case"arm":return"arm32";case"ppc":return"ppc32";case"x64":return"amd64";default:return t}},r1e=function(t){switch(t){case"sunos":return"solaris";case"win32":return"windows";default:return t}}});var n1e,i1e,kT,$6=A(()=>{n1e=H(require("child_process")),i1e=H(require("util")),kT=i1e.promisify(n1e.exec)});var o1e={};_n(o1e,{getMachineId:()=>bet});function bet(){return get(this,void 0,void 0,function(){var t,e,r,n;return vet(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,kT('ioreg -rd1 -c "IOPlatformExpertDevice"')];case 1:return t=o.sent(),e=t.stdout.split(`
`).find(function(s){return s.includes("IOPlatformUUID")}),e?(r=e.split('" = "'),r.length===2?[2,r[1].slice(0,-1)]:[3,3]):[2,""];case 2:return n=o.sent(),Tt.debug("error reading machine id: "+n),[3,3];case 3:return[2,""]}})})}var get,vet,s1e=A(()=>{$6();Pr();get=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},vet=function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}});var c1e={};_n(c1e,{getMachineId:()=>Iet});function Iet(){return yet(this,void 0,void 0,function(){var t,e,r,n,o,s,a,c,u;return _et(this,function(l){switch(l.label){case 0:t=["/etc/machine-id","/var/lib/dbus/machine-id"],l.label=1;case 1:l.trys.push([1,8,9,10]),e=xet(t),r=e.next(),l.label=2;case 2:if(r.done)return[3,7];n=r.value,l.label=3;case 3:return l.trys.push([3,5,,6]),[4,a1e.promises.readFile(n,{encoding:"utf8"})];case 4:return o=l.sent(),[2,o.trim()];case 5:return s=l.sent(),Tt.debug("error reading machine id: "+s),[3,6];case 6:return r=e.next(),[3,2];case 7:return[3,10];case 8:return a=l.sent(),c={error:a},[3,10];case 9:try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(c)throw c.error}return[7];case 10:return[2,""]}})})}var a1e,yet,_et,xet,u1e=A(()=>{a1e=require("fs");Pr();yet=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},_et=function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},xet=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}});var d1e={};_n(d1e,{getMachineId:()=>Eet});function Eet(){return Cet(this,void 0,void 0,function(){var e,t,e,r;return Tet(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,l1e.promises.readFile("/etc/hostid",{encoding:"utf8"})];case 1:return e=n.sent(),[2,e.trim()];case 2:return t=n.sent(),Tt.debug("error reading machine id: "+t),[3,3];case 3:return n.trys.push([3,5,,6]),[4,kT("kenv -q smbios.system.uuid")];case 4:return e=n.sent(),[2,e.stdout.trim()];case 5:return r=n.sent(),Tt.debug("error reading machine id: "+r),[3,6];case 6:return[2,""]}})})}var l1e,Cet,Tet,p1e=A(()=>{l1e=require("fs");$6();Pr();Cet=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},Tet=function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}});var f1e={};_n(f1e,{getMachineId:()=>ket});function ket(){return wet(this,void 0,void 0,function(){var t,e,r,n,o;return Ret(this,function(s){switch(s.label){case 0:t="QUERY HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography /v MachineGuid",e="%windir%\\System32\\REG.exe",W6.arch==="ia32"&&"PROCESSOR_ARCHITEW6432"in W6.env&&(e="%windir%\\sysnative\\cmd.exe /c "+e),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,kT(e+" "+t)];case 2:return r=s.sent(),n=r.stdout.split("REG_SZ"),n.length===2?[2,n[1].trim()]:[3,4];case 3:return o=s.sent(),Tt.debug("error reading machine id: "+o),[3,4];case 4:return[2,""]}})})}var W6,wet,Ret,m1e=A(()=>{W6=H(require("process"));$6();Pr();wet=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},Ret=function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}});var h1e={};_n(h1e,{getMachineId:()=>Det});function Det(){return Pet(this,void 0,void 0,function(){return Aet(this,function(t){return Tt.debug("could not read machine-id: unsupported platform"),[2,""]})})}var Pet,Aet,g1e=A(()=>{Pr();Pet=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},Aet=function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}});var v1e,u_,b1e=A(()=>{v1e=H(require("process"));switch(v1e.platform){case"darwin":u_=(s1e(),eo(o1e)).getMachineId;break;case"linux":u_=(u1e(),eo(c1e)).getMachineId;break;case"freebsd":u_=(p1e(),eo(d1e)).getMachineId;break;case"win32":u_=(m1e(),eo(f1e)).getMachineId;break;default:u_=(g1e(),eo(h1e)).getMachineId}});var K6,Net,y1e,LQ=A(()=>{td();PT();K6=require("os");NQ();b1e();Net=function(){function t(){}return t.prototype.detect=function(e){var r,n=(r={},r[gr.HOST_NAME]=(0,K6.hostname)(),r[gr.HOST_ARCH]=t1e((0,K6.arch)()),r);return new ka(n,this._getAsyncAttributes())},t.prototype._getAsyncAttributes=function(){return u_().then(function(e){var r={};return e&&(r[gr.HOST_ID]=e),r})},t}(),y1e=new Net});var Let,fPr,_1e=A(()=>{LQ();Let=function(){function t(){}return t.prototype.detect=function(e){return Promise.resolve(y1e.detect(e))},t}(),fPr=new Let});var Y6,Oet,x1e,OQ=A(()=>{td();PT();Y6=require("os");NQ();Oet=function(){function t(){}return t.prototype.detect=function(e){var r,n=(r={},r[gr.OS_TYPE]=r1e((0,Y6.platform)()),r[gr.OS_VERSION]=(0,Y6.release)(),r);return new ka(n)},t}(),x1e=new Oet});var Met,_Pr,S1e=A(()=>{OQ();Met=function(){function t(){}return t.prototype.detect=function(e){return Promise.resolve(x1e.detect(e))},t}(),_Pr=new Met});var T1e,I1e,C1e,Fet,E1e,MQ=A(()=>{Pr();td();PT();T1e=H(require("os")),I1e=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},C1e=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},Fet=function(){function t(){}return t.prototype.detect=function(e){var r,n=(r={},r[gr.PROCESS_PID]=process.pid,r[gr.PROCESS_EXECUTABLE_NAME]=process.title,r[gr.PROCESS_EXECUTABLE_PATH]=process.execPath,r[gr.PROCESS_COMMAND_ARGS]=C1e(C1e([process.argv[0]],I1e(process.execArgv),!1),I1e(process.argv.slice(1)),!1),r[gr.PROCESS_RUNTIME_VERSION]=process.versions.node,r[gr.PROCESS_RUNTIME_NAME]="nodejs",r[gr.PROCESS_RUNTIME_DESCRIPTION]="Node.js",r);process.argv.length>1&&(n[gr.PROCESS_COMMAND]=process.argv[1]);try{var o=T1e.userInfo();n[gr.PROCESS_OWNER]=o.username}catch(s){Tt.debug("error obtaining process owner: "+s)}return new ka(n)},t}(),E1e=new Fet});var Uet,wPr,w1e=A(()=>{MQ();Uet=function(){function t(){}return t.prototype.detect=function(e){return Promise.resolve(E1e.detect(e))},t}(),wPr=new Uet});var R1e=A(()=>{e1e();_1e();S1e();LQ();OQ();w1e();MQ()});var FQ=A(()=>{R1e()});var Yv,Bet,qet,jet,ka,PT=A(()=>{Pr();td();Ra();FQ();Yv=function(){return Yv=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Yv.apply(this,arguments)},Bet=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},qet=function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},jet=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},ka=function(){function t(e,r){var n=this,o;this._attributes=e,this.asyncAttributesPending=r!=null,this._syncAttributes=(o=this._attributes)!==null&&o!==void 0?o:{},this._asyncAttributesPromise=r?.then(function(s){return n._attributes=Object.assign({},n._attributes,s),n.asyncAttributesPending=!1,s},function(s){return Tt.debug("a resource's async attributes promise rejected: %s",s),n.asyncAttributesPending=!1,{}})}return t.empty=function(){return t.EMPTY},t.default=function(){var e;return new t((e={},e[gr.SERVICE_NAME]=ZSe(),e[gr.TELEMETRY_SDK_LANGUAGE]=rA[gr.TELEMETRY_SDK_LANGUAGE],e[gr.TELEMETRY_SDK_NAME]=rA[gr.TELEMETRY_SDK_NAME],e[gr.TELEMETRY_SDK_VERSION]=rA[gr.TELEMETRY_SDK_VERSION],e))},Object.defineProperty(t.prototype,"attributes",{get:function(){var e;return this.asyncAttributesPending&&Tt.error("Accessing resource attributes before async attributes settled"),(e=this._attributes)!==null&&e!==void 0?e:{}},enumerable:!1,configurable:!0}),t.prototype.waitForAsyncAttributes=function(){return Bet(this,void 0,void 0,function(){return qet(this,function(e){switch(e.label){case 0:return this.asyncAttributesPending?[4,this._asyncAttributesPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.merge=function(e){var r=this,n;if(!e)return this;var o=Yv(Yv({},this._syncAttributes),(n=e._syncAttributes)!==null&&n!==void 0?n:e.attributes);if(!this._asyncAttributesPromise&&!e._asyncAttributesPromise)return new t(o);var s=Promise.all([this._asyncAttributesPromise,e._asyncAttributesPromise]).then(function(a){var c,u=jet(a,2),l=u[0],d=u[1];return Yv(Yv(Yv(Yv({},r._syncAttributes),l),(c=e._syncAttributes)!==null&&c!==void 0?c:e.attributes),d)});return new t(o,s)},t.EMPTY=new t({}),t}()});var k1e=A(()=>{});var P1e=A(()=>{});var A1e=A(()=>{});var Het,zPr,D1e=A(()=>{Q6();Het=function(){function t(){}return t.prototype.detect=function(e){return Promise.resolve(N1e.detect(e))},t}(),zPr=new Het});var Vet,Get,zet,L1e,UQ=A(()=>{Pr();Ra();td();PT();Vet=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Get=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},zet=function(){function t(){this._MAX_LENGTH=255,this._COMMA_SEPARATOR=",",this._LABEL_KEY_VALUE_SPLITTER="=",this._ERROR_MESSAGE_INVALID_CHARS="should be a ASCII string with a length greater than 0 and not exceed "+this._MAX_LENGTH+" characters.",this._ERROR_MESSAGE_INVALID_VALUE="should be a ASCII string with a length not exceed "+this._MAX_LENGTH+" characters."}return t.prototype.detect=function(e){var r={},n=ko(),o=n.OTEL_RESOURCE_ATTRIBUTES,s=n.OTEL_SERVICE_NAME;if(o)try{var a=this._parseResourceAttributes(o);Object.assign(r,a)}catch(c){Tt.debug("EnvDetector failed: "+c.message)}return s&&(r[gr.SERVICE_NAME]=s),new ka(r)},t.prototype._parseResourceAttributes=function(e){var r,n;if(!e)return{};var o={},s=e.split(this._COMMA_SEPARATOR,-1);try{for(var a=Vet(s),c=a.next();!c.done;c=a.next()){var u=c.value,l=u.split(this._LABEL_KEY_VALUE_SPLITTER,-1);if(l.length===2){var d=Get(l,2),p=d[0],f=d[1];if(p=p.trim(),f=f.trim().split(/^"|"$/).join(""),!this._isValidAndNotEmpty(p))throw new Error("Attribute key "+this._ERROR_MESSAGE_INVALID_CHARS);if(!this._isValid(f))throw new Error("Attribute value "+this._ERROR_MESSAGE_INVALID_VALUE);o[p]=decodeURIComponent(f)}}}catch(m){r={error:m}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o},t.prototype._isValid=function(e){return e.length<=this._MAX_LENGTH&&this._isBaggageOctetString(e)},t.prototype._isBaggageOctetString=function(e){for(var r=0;r<e.length;r++){var n=e.charCodeAt(r);if(n<33||n===44||n===59||n===92||n>126)return!1}return!0},t.prototype._isValidAndNotEmpty=function(e){return e.length>0&&this._isValid(e)},t}(),L1e=new zet});var $et,ZPr,O1e=A(()=>{UQ();$et=function(){function t(){}return t.prototype.detect=function(e){return Promise.resolve(L1e.detect(e))},t}(),ZPr=new $et});var BQ,Wet,N1e,M1e=A(()=>{td();Q6();Pr();BQ=function(){return BQ=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},BQ.apply(this,arguments)},Wet=function(){function t(){}return t.prototype.detect=function(e){var r,n=typeof navigator<"u";if(!n)return ka.empty();var o=(r={},r[gr.PROCESS_RUNTIME_NAME]="browser",r[gr.PROCESS_RUNTIME_DESCRIPTION]="Web Browser",r[gr.PROCESS_RUNTIME_VERSION]=navigator.userAgent,r);return this._getResourceAttributes(o,e)},t.prototype._getResourceAttributes=function(e,r){return e[gr.PROCESS_RUNTIME_VERSION]===""?(Tt.debug("BrowserDetector failed: Unable to find required browser resources. "),ka.empty()):new ka(BQ({},e))},t}(),N1e=new Wet});var F1e=A(()=>{D1e();O1e();M1e();UQ()});var U1e=A(()=>{});var Q6=A(()=>{PT();k1e();FQ();P1e();A1e();F1e();U1e()});var X6,B1e,q1e=A(()=>{Ra();X6=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},B1e=function(){function t(e){this._spanProcessors=e}return t.prototype.forceFlush=function(){var e,r,n=[];try{for(var o=X6(this._spanProcessors),s=o.next();!s.done;s=o.next()){var a=s.value;n.push(a.forceFlush())}}catch(c){e={error:c}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return new Promise(function(c){Promise.all(n).then(function(){c()}).catch(function(u){ic(u||new Error("MultiSpanProcessor: forceFlush failed")),c()})})},t.prototype.onStart=function(e,r){var n,o;try{for(var s=X6(this._spanProcessors),a=s.next();!a.done;a=s.next()){var c=a.value;c.onStart(e,r)}}catch(u){n={error:u}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}},t.prototype.onEnd=function(e){var r,n;try{for(var o=X6(this._spanProcessors),s=o.next();!s.done;s=o.next()){var a=s.value;a.onEnd(e)}}catch(c){r={error:c}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},t.prototype.shutdown=function(){var e,r,n=[];try{for(var o=X6(this._spanProcessors),s=o.next();!s.done;s=o.next()){var a=s.value;n.push(a.shutdown())}}catch(c){e={error:c}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return new Promise(function(c,u){Promise.all(n).then(function(){c()},u)})},t}()});var qQ,jQ=A(()=>{qQ=function(){function t(){}return t.prototype.onStart=function(e,r){},t.prototype.onEnd=function(e){},t.prototype.shutdown=function(){return Promise.resolve()},t.prototype.forceFlush=function(){return Promise.resolve()},t}()});var Qv,Ket,j1e=A(()=>{Pr();Ra();Q6();HQ();RQ();q1e();jQ();z6();kQ();(function(t){t[t.resolved=0]="resolved",t[t.timeout=1]="timeout",t[t.error=2]="error",t[t.unresolved=3]="unresolved"})(Qv||(Qv={}));Ket=function(){function t(e){e===void 0&&(e={});var r;this._registeredSpanProcessors=[],this._tracers=new Map;var n=xQ({},V6(),GSe(e));this.resource=(r=n.resource)!==null&&r!==void 0?r:ka.empty(),this.resource=ka.default().merge(this.resource),this._config=Object.assign({},n,{resource:this.resource});var o=this._buildExporterFromEnv();if(o!==void 0){var s=new PQ(o);this.activeSpanProcessor=s}else this.activeSpanProcessor=new qQ}return t.prototype.getTracer=function(e,r,n){var o=e+"@"+(r||"")+":"+(n?.schemaUrl||"");return this._tracers.has(o)||this._tracers.set(o,new DQ({name:e,version:r,schemaUrl:n?.schemaUrl},this._config,this)),this._tracers.get(o)},t.prototype.addSpanProcessor=function(e){this._registeredSpanProcessors.length===0&&this.activeSpanProcessor.shutdown().catch(function(r){return Tt.error("Error while trying to shutdown current span processor",r)}),this._registeredSpanProcessors.push(e),this.activeSpanProcessor=new B1e(this._registeredSpanProcessors)},t.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},t.prototype.register=function(e){e===void 0&&(e={}),Ro.setGlobalTracerProvider(this),e.propagator===void 0&&(e.propagator=this._buildPropagatorFromEnv()),e.contextManager&&wa.setGlobalContextManager(e.contextManager),e.propagator&&km.setGlobalPropagator(e.propagator)},t.prototype.forceFlush=function(){var e=this._config.forceFlushTimeoutMillis,r=this._registeredSpanProcessors.map(function(n){return new Promise(function(o){var s,a=setTimeout(function(){o(new Error("Span processor did not completed within timeout period of "+e+" ms")),s=Qv.timeout},e);n.forceFlush().then(function(){clearTimeout(a),s!==Qv.timeout&&(s=Qv.resolved,o(s))}).catch(function(c){clearTimeout(a),s=Qv.error,o(c)})})});return new Promise(function(n,o){Promise.all(r).then(function(s){var a=s.filter(function(c){return c!==Qv.resolved});a.length>0?o(a):n()}).catch(function(s){return o([s])})})},t.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},t.prototype._getPropagator=function(e){var r;return(r=this.constructor._registeredPropagators.get(e))===null||r===void 0?void 0:r()},t.prototype._getSpanExporter=function(e){var r;return(r=this.constructor._registeredExporters.get(e))===null||r===void 0?void 0:r()},t.prototype._buildPropagatorFromEnv=function(){var e=this,r=Array.from(new Set(ko().OTEL_PROPAGATORS)),n=r.map(function(s){var a=e._getPropagator(s);return a||Tt.warn('Propagator "'+s+'" requested through environment variable is unavailable.'),a}),o=n.reduce(function(s,a){return a&&s.push(a),s},[]);if(o.length!==0)return r.length===1?o[0]:new lQ({propagators:o})},t.prototype._buildExporterFromEnv=function(){var e=ko().OTEL_TRACES_EXPORTER;if(!(e==="none"||e==="")){var r=this._getSpanExporter(e);return r||Tt.error('Exporter "'+e+'" requested through environment variable is unavailable.'),r}},t._registeredPropagators=new Map([["tracecontext",function(){return new mQ}],["baggage",function(){return new XY}]]),t._registeredExporters=new Map,t}()});var Yet,Qet,H1e=A(()=>{Ra();Yet=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Qet=function(){function t(){}return t.prototype.export=function(e,r){return this._sendSpans(e,r)},t.prototype.shutdown=function(){return this._sendSpans([]),this.forceFlush()},t.prototype.forceFlush=function(){return Promise.resolve()},t.prototype._exportInfo=function(e){var r;return{traceId:e.spanContext().traceId,parentId:e.parentSpanId,traceState:(r=e.spanContext().traceState)===null||r===void 0?void 0:r.serialize(),name:e.name,id:e.spanContext().spanId,kind:e.kind,timestamp:D6(e.startTime),duration:D6(e.duration),attributes:e.attributes,status:e.status,events:e.events,links:e.links}},t.prototype._sendSpans=function(e,r){var n,o;try{for(var s=Yet(e),a=s.next();!a.done;a=s.next()){var c=a.value;console.dir(this._exportInfo(c),{depth:3})}}catch(u){n={error:u}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}if(r)return r({code:Ku.SUCCESS})},t}()});var Xet,Jet,Zet,V1e=A(()=>{Ra();Xet=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),o,s=[],a;try{for(;(e===void 0||e-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s},Jet=function(t,e,r){if(r||arguments.length===2)for(var n=0,o=e.length,s;n<o;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},Zet=function(){function t(){this._finishedSpans=[],this._stopped=!1}return t.prototype.export=function(e,r){var n;if(this._stopped)return r({code:Ku.FAILED,error:new Error("Exporter has been stopped")});(n=this._finishedSpans).push.apply(n,Jet([],Xet(e),!1)),setTimeout(function(){return r({code:Ku.SUCCESS})},0)},t.prototype.shutdown=function(){return this._stopped=!0,this._finishedSpans=[],this.forceFlush()},t.prototype.forceFlush=function(){return Promise.resolve()},t.prototype.reset=function(){this._finishedSpans=[]},t.prototype.getFinishedSpans=function(){return this._finishedSpans},t}()});var G1e=A(()=>{});var ett,ttt,rtt,z1e=A(()=>{Pr();Ra();ett=function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},ttt=function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},rtt=function(){function t(e){this._exporter=e,this._shutdownOnce=new aA(this._shutdown,this),this._unresolvedExports=new Set}return t.prototype.forceFlush=function(){return ett(this,void 0,void 0,function(){return ttt(this,function(e){switch(e.label){case 0:return[4,Promise.all(Array.from(this._unresolvedExports))];case 1:return e.sent(),this._exporter.forceFlush?[4,this._exporter.forceFlush()]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.onStart=function(e,r){},t.prototype.onEnd=function(e){var r=this,n,o;if(!this._shutdownOnce.isCalled&&e.spanContext().traceFlags&$i.SAMPLED){var s=function(){return SQ._export(r._exporter,[e]).then(function(c){var u;c.code!==Ku.SUCCESS&&ic((u=c.error)!==null&&u!==void 0?u:new Error("SimpleSpanProcessor: span export failed (status "+c+")"))}).catch(function(c){ic(c)})};if(e.resource.asyncAttributesPending){var a=(o=(n=e.resource).waitForAsyncAttributes)===null||o===void 0?void 0:o.call(n).then(function(){return a!=null&&r._unresolvedExports.delete(a),s()},function(c){return ic(c)});a!=null&&this._unresolvedExports.add(a)}else s()}},t.prototype.shutdown=function(){return this._shutdownOnce.call()},t.prototype._shutdown=function(){return this._exporter.shutdown()},t}()});var $1e=A(()=>{});var W1e=A(()=>{});var K1e=A(()=>{});var Y1e=A(()=>{});var Q1e=A(()=>{});var X1e={};_n(X1e,{AlwaysOffSampler:()=>c_,AlwaysOnSampler:()=>Dm,BasicTracerProvider:()=>Ket,BatchSpanProcessor:()=>PQ,ConsoleSpanExporter:()=>Qet,ForceFlushState:()=>Qv,InMemorySpanExporter:()=>Zet,NoopSpanProcessor:()=>qQ,ParentBasedSampler:()=>uA,RandomIdGenerator:()=>AQ,SamplingDecision:()=>Np,SimpleSpanProcessor:()=>rtt,Span:()=>IQ,TraceIdRatioBasedSampler:()=>H6,Tracer:()=>DQ});var HQ=A(()=>{JSe();j1e();z6();H1e();V1e();G1e();z1e();$1e();jQ();q6();j6();TQ();EQ();cA();CQ();W1e();K1e();Y1e();Q1e()});var Z1e=O(Yu=>{"use strict";Object.defineProperty(Yu,"__esModule",{value:!0});Yu.enable=Yu.azureCoreTracing=Yu.AzureMonitorSymbol=void 0;var VQ=Ni();Yu.AzureMonitorSymbol="Azure_Monitor_Tracer";var GQ="azure-coretracing",J1e=!1,ntt=function(t){if(J1e)return t;try{var e=(HQ(),eo(X1e)),r=(Pr(),eo(IT)),n=new e.BasicTracerProvider,o=n.getTracer("applicationinsights tracer");if(t.setTracer){var s=t.setTracer;t.setTracer=function(l){var d=l.startSpan;l.startSpan=function(p,f,m){var h=d.call(this,p,f,m),g=h.end;return h.end=function(){var v=g.apply(this,arguments);return VQ.channel.publish(GQ,h),v},h},l[Yu.AzureMonitorSymbol]=!0,s.call(this,l)},r.trace.getSpan(r.context.active()),t.setTracer(o)}else{var a=r.trace.setGlobalTracerProvider;r.trace.setGlobalTracerProvider=function(l){var d=l.getTracer;return l.getTracer=function(p,f){var m=d.call(this,p,f);if(!m[Yu.AzureMonitorSymbol]){var h=m.startSpan;m.startSpan=function(g,v,y){var _=h.call(this,g,v,y),x=_.end;return _.end=function(){var S=x.apply(this,arguments);return VQ.channel.publish(GQ,_),S},_},m[Yu.AzureMonitorSymbol]=!0}return m},a.call(this,l)},n.register(),r.trace.getSpan(r.context.active());var c=require("@opentelemetry/instrumentation"),u=require("@azure/opentelemetry-instrumentation-azure-sdk");c.registerInstrumentations({instrumentations:[u.createAzureSdkInstrumentation()]})}J1e=!0}catch{}return t};Yu.azureCoreTracing={versionSpecifier:">= 1.0.0 < 2.0.0",patch:ntt,publisherName:GQ};function itt(){VQ.channel.registerMonkeyPatch("@azure/core-tracing",Yu.azureCoreTracing)}Yu.enable=itt});var tIe=O(l_=>{"use strict";Object.defineProperty(l_,"__esModule",{value:!0});l_.enable=l_.bunyan=void 0;var eIe=Ni(),ott=function(t){var e=t.prototype._emit;return t.prototype._emit=function(r,n){var o=e.apply(this,arguments);if(!n){var s=o;s||(s=e.call(this,r,!0)),eIe.channel.publish("bunyan",{level:r.level,result:s})}return o},t};l_.bunyan={versionSpecifier:">= 1.0.0 < 2.0.0",patch:ott};function stt(){eIe.channel.registerMonkeyPatch("bunyan",l_.bunyan)}l_.enable=stt});var nIe=O(d_=>{"use strict";Object.defineProperty(d_,"__esModule",{value:!0});d_.enable=d_.console=void 0;var zQ=Ni(),rIe=require("stream"),att=function(t){var e=new rIe.Writable,r=new rIe.Writable;e.write=function(l){if(!l)return!0;var d=l.toString();return zQ.channel.publish("console",{message:d}),!0},r.write=function(l){if(!l)return!0;var d=l.toString();return zQ.channel.publish("console",{message:d,stderr:!0}),!0};for(var n=new t.Console(e,r),o=["log","info","warn","error","dir","time","timeEnd","trace","assert"],s=function(l){var d=t[l];d&&(t[l]=function(){if(n[l])try{n[l].apply(n,arguments)}catch{}return d.apply(t,arguments)})},a=0,c=o;a<c.length;a++){var u=c[a];s(u)}return t};d_.console={versionSpecifier:">= 4.0.0",patch:att};function ctt(){zQ.channel.registerMonkeyPatch("console",d_.console),require("console")}d_.enable=ctt});var iIe=O(p_=>{"use strict";Object.defineProperty(p_,"__esModule",{value:!0});p_.enable=p_.mongoCore=void 0;var $Q=Ni(),utt=function(t){var e=t.Server.prototype.connect;return t.Server.prototype.connect=function(){var n=e.apply(this,arguments),o=this.s.pool.write;this.s.pool.write=function(){var c=typeof arguments[1]=="function"?1:2;return typeof arguments[c]=="function"&&(arguments[c]=$Q.channel.bindToContext(arguments[c])),o.apply(this,arguments)};var s=this.s.pool.logout;return this.s.pool.logout=function(){return typeof arguments[1]=="function"&&(arguments[1]=$Q.channel.bindToContext(arguments[1])),s.apply(this,arguments)},n},t};p_.mongoCore={versionSpecifier:">= 2.0.0 < 4.0.0",patch:utt};function ltt(){$Q.channel.registerMonkeyPatch("mongodb-core",p_.mongoCore)}p_.enable=ltt});var oIe=O(Pa=>{"use strict";var AT=Pa&&Pa.__assign||function(){return AT=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},AT.apply(this,arguments)};Object.defineProperty(Pa,"__esModule",{value:!0});Pa.enable=Pa.mongo330=Pa.mongo3=Pa.mongo2=void 0;var Qs=Ni(),dtt=function(t){var e=t.instrument({operationIdGenerator:{next:function(){return Qs.channel.bindToContext(function(n){return n()})}}}),r={};return e.on("started",function(n){r[n.requestId]||(r[n.requestId]=AT(AT({},n),{time:new Date}))}),e.on("succeeded",function(n){var o=r[n.requestId];o&&delete r[n.requestId],typeof n.operationId=="function"?n.operationId(function(){return Qs.channel.publish("mongodb",{startedData:o,event:n,succeeded:!0})}):Qs.channel.publish("mongodb",{startedData:o,event:n,succeeded:!0})}),e.on("failed",function(n){var o=r[n.requestId];o&&delete r[n.requestId],typeof n.operationId=="function"?n.operationId(function(){return Qs.channel.publish("mongodb",{startedData:o,event:n,succeeded:!1})}):Qs.channel.publish("mongodb",{startedData:o,event:n,succeeded:!1})}),t},ptt=function(t){var e=t.instrument(),r={},n={};return e.on("started",function(o){r[o.requestId]||(n[o.requestId]=Qs.channel.bindToContext(function(s){return s()}),r[o.requestId]=AT(AT({},o),{time:new Date}))}),e.on("succeeded",function(o){var s=r[o.requestId];s&&delete r[o.requestId],typeof o=="object"&&typeof n[o.requestId]=="function"&&(n[o.requestId](function(){return Qs.channel.publish("mongodb",{startedData:s,event:o,succeeded:!0})}),delete n[o.requestId])}),e.on("failed",function(o){var s=r[o.requestId];s&&delete r[o.requestId],typeof o=="object"&&typeof n[o.requestId]=="function"&&(n[o.requestId](function(){return Qs.channel.publish("mongodb",{startedData:s,event:o,succeeded:!1})}),delete n[o.requestId])}),t},ftt=function(t){var e=t.Server.prototype.connect;return t.Server.prototype.connect=function(){var n=e.apply(this,arguments),o=this.s.coreTopology.s.pool.write;this.s.coreTopology.s.pool.write=function(){var c=typeof arguments[1]=="function"?1:2;return typeof arguments[c]=="function"&&(arguments[c]=Qs.channel.bindToContext(arguments[c])),o.apply(this,arguments)};var s=this.s.coreTopology.s.pool.logout;return this.s.coreTopology.s.pool.logout=function(){return typeof arguments[1]=="function"&&(arguments[1]=Qs.channel.bindToContext(arguments[1])),s.apply(this,arguments)},n},t},mtt=function(t){ftt(t);var e=t.instrument(),r={},n={};return e.on("started",function(o){r[o.requestId]||(n[o.requestId]=Qs.channel.bindToContext(function(s){return s()}),r[o.requestId]=o)}),e.on("succeeded",function(o){var s=r[o.requestId];s&&delete r[o.requestId],typeof o=="object"&&typeof n[o.requestId]=="function"&&(n[o.requestId](function(){return Qs.channel.publish("mongodb",{startedData:s,event:o,succeeded:!0})}),delete n[o.requestId])}),e.on("failed",function(o){var s=r[o.requestId];s&&delete r[o.requestId],typeof o=="object"&&typeof n[o.requestId]=="function"&&(n[o.requestId](function(){return Qs.channel.publish("mongodb",{startedData:s,event:o,succeeded:!1})}),delete n[o.requestId])}),t};Pa.mongo2={versionSpecifier:">= 2.0.0 <= 3.0.5",patch:dtt};Pa.mongo3={versionSpecifier:"> 3.0.5 < 3.3.0",patch:ptt};Pa.mongo330={versionSpecifier:">= 3.3.0 < 4.0.0",patch:mtt};function htt(){Qs.channel.registerMonkeyPatch("mongodb",Pa.mongo2),Qs.channel.registerMonkeyPatch("mongodb",Pa.mongo3),Qs.channel.registerMonkeyPatch("mongodb",Pa.mongo330)}Pa.enable=htt});var aIe=O(f_=>{"use strict";Object.defineProperty(f_,"__esModule",{value:!0});f_.enable=f_.mysql=void 0;var J6=Ni(),sIe=require("path"),gtt=function(t,e){var r=function(u,l){return function(d,p){var f=u[d];f&&(u[d]=function(){for(var h=arguments.length-1,g=arguments.length-1;g>=0;--g)if(typeof arguments[g]=="function"){h=g;break}else if(typeof arguments[g]<"u")break;var v=arguments[h],y={result:null,startTime:null,startDate:null};typeof v=="function"&&(p?(y.startTime=process.hrtime(),y.startDate=new Date,arguments[h]=J6.channel.bindToContext(p(y,v))):arguments[h]=J6.channel.bindToContext(v));var _=f.apply(this,arguments);return y.result=_,_})}},n=function(u,l){return r(u.prototype,l+".prototype")},o=["connect","changeUser","ping","statistics","end"],s=require(sIe.dirname(e)+"/lib/Connection");o.forEach(function(u){return n(s,"Connection")(u)}),r(s,"Connection")("createQuery",function(u,l){return function(d){var p=process.hrtime(u.startTime),f=p[0]*1e3+p[1]/1e6|0;J6.channel.publish("mysql",{query:u.result,callbackArgs:arguments,err:d,duration:f,time:u.startDate}),l.apply(this,arguments)}});var a=["_enqueueCallback"],c=require(sIe.dirname(e)+"/lib/Pool");return a.forEach(function(u){return n(c,"Pool")(u)}),t};f_.mysql={versionSpecifier:">= 2.0.0 < 3.0.0",patch:gtt};function vtt(){J6.channel.registerMonkeyPatch("mysql",f_.mysql)}f_.enable=vtt});var uIe=O(m_=>{"use strict";Object.defineProperty(m_,"__esModule",{value:!0});m_.enable=m_.postgresPool1=void 0;var cIe=Ni();function btt(t){var e=t.prototype.connect;return t.prototype.connect=function(n){return n&&(arguments[0]=cIe.channel.bindToContext(n)),e.apply(this,arguments)},t}m_.postgresPool1={versionSpecifier:">= 1.0.0 < 3.0.0",patch:btt};function ytt(){cIe.channel.registerMonkeyPatch("pg-pool",m_.postgresPool1)}m_.enable=ytt});var dIe=O(Lp=>{"use strict";Object.defineProperty(Lp,"__esModule",{value:!0});Lp.enable=Lp.postgres=Lp.postgres6=void 0;var DT=Ni(),lIe=require("events"),WQ="postgres";function _tt(t,e){var r=t.Client.prototype.query,n="__diagnosticOriginalFunc";return t.Client.prototype.query=function(s,a,c){var u={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},l=process.hrtime(),d;function p(f){f&&f[n]&&(f=f[n]);var m=DT.channel.bindToContext(function(h,g){var v=process.hrtime(l);if(u.result=g&&{rowCount:g.rowCount,command:g.command},u.error=h,u.duration=Math.ceil(v[0]*1e3+v[1]/1e6),DT.channel.publish(WQ,u),h){if(f)return f.apply(this,arguments);d&&d instanceof lIe.EventEmitter&&d.emit("error",h)}else f&&f.apply(this,arguments)});try{return Object.defineProperty(m,n,{value:f}),m}catch{return f}}try{typeof s=="string"?a instanceof Array?(u.query.preparable={text:s,args:a},c=p(c)):(u.query.text=s,c?c=p(c):a=p(a)):(typeof s.name=="string"?u.query.plan=s.name:s.values instanceof Array?u.query.preparable={text:s.text,args:s.values}:u.query.text=s.text,c?c=p(c):a?a=p(a):s.callback=p(s.callback))}catch{return r.apply(this,arguments)}return arguments[0]=s,arguments[1]=a,arguments[2]=c,arguments.length=arguments.length>3?arguments.length:3,d=r.apply(this,arguments),d},t}function xtt(t,e){var r=t.Client.prototype.query,n="__diagnosticOriginalFunc";return t.Client.prototype.query=function(s,a,c){var u=this,l,d,p=!!c,f={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},m,h=process.hrtime();function g(_){_&&_[n]&&(_=_[n]);var x=DT.channel.bindToContext(function(S,I){var E=process.hrtime(h);if(f.result=I&&{rowCount:I.rowCount,command:I.command},f.error=S,f.duration=Math.ceil(E[0]*1e3+E[1]/1e6),DT.channel.publish(WQ,f),S){if(_)return _.apply(this,arguments);m&&m instanceof lIe.EventEmitter&&m.emit("error",S)}else _&&_.apply(this,arguments)});try{return Object.defineProperty(x,n,{value:_}),x}catch{return _}}try{typeof s=="string"?a instanceof Array?(f.query.preparable={text:s,args:a},p=typeof c=="function",c=p?g(c):c):(f.query.text=s,c?(p=typeof c=="function",c=p?g(c):c):(p=typeof a=="function",a=p?g(a):a)):(typeof s.name=="string"?f.query.plan=s.name:s.values instanceof Array?f.query.preparable={text:s.text,args:s.values}:s.cursor?f.query.text=(l=s.cursor)===null||l===void 0?void 0:l.text:f.query.text=s.text,c?(p=typeof c=="function",c=g(c)):a?(p=typeof a=="function",a=p?g(a):a):(p=typeof s.callback=="function",s.callback=p?g(s.callback):s.callback))}catch{return r.apply(this,arguments)}arguments[0]=s,arguments[1]=a,arguments[2]=c,arguments.length=arguments.length>3?arguments.length:3;try{m=r.apply(this,arguments)}catch(_){throw g()(_,void 0),_}if(!p){if(m instanceof Promise)return m.then(function(_){return g()(void 0,_),new u._Promise(function(x,S){x(_)})}).catch(function(_){return g()(_,void 0),new u._Promise(function(x,S){S(_)})});var v=m.text?m.text:"";if(m.cursor&&(v=(d=m.cursor)===null||d===void 0?void 0:d.text),v){var y={command:v,rowCount:0};g()(void 0,y)}}return m},t}Lp.postgres6={versionSpecifier:"6.*",patch:_tt};Lp.postgres={versionSpecifier:">=7.* <=8.*",patch:xtt,publisherName:WQ};function Stt(){DT.channel.registerMonkeyPatch("pg",Lp.postgres6),DT.channel.registerMonkeyPatch("pg",Lp.postgres)}Lp.enable=Stt});var pIe=O(h_=>{"use strict";Object.defineProperty(h_,"__esModule",{value:!0});h_.enable=h_.redis=void 0;var KQ=Ni(),Itt=function(t){var e=t.RedisClient.prototype.internal_send_command;return t.RedisClient.prototype.internal_send_command=function(r){if(r){var n=r.callback;if(!n||!n.pubsubBound){var o=this.address,s=process.hrtime(),a=new Date;r.callback=KQ.channel.bindToContext(function(c,u){var l=process.hrtime(s),d=l[0]*1e3+l[1]/1e6|0;KQ.channel.publish("redis",{duration:d,address:o,commandObj:r,err:c,result:u,time:a}),typeof n=="function"&&n.apply(this,arguments)}),r.callback.pubsubBound=!0}}return e.call(this,r)},t};h_.redis={versionSpecifier:">= 2.0.0 < 4.0.0",patch:Itt};function Ctt(){KQ.channel.registerMonkeyPatch("redis",h_.redis)}h_.enable=Ctt});var fIe=O(Nm=>{"use strict";var Z6=Nm&&Nm.__assign||function(){return Z6=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Z6.apply(this,arguments)};Object.defineProperty(Nm,"__esModule",{value:!0});Nm.enable=Nm.tedious=void 0;var YQ=Ni(),Ttt=function(t){var e=t.Connection.prototype.makeRequest;return t.Connection.prototype.makeRequest=function(){function n(s){var a=process.hrtime(),c={query:{},database:{host:null,port:null},result:null,error:null,duration:0};return YQ.channel.bindToContext(function(u,l,d){var p=process.hrtime(a);c=Z6(Z6({},c),{database:{host:this.connection.config.server,port:this.connection.config.options.port},result:!u&&{rowCount:l,rows:d},query:{text:this.parametersByName.statement.value},error:u,duration:Math.ceil(p[0]*1e3+p[1]/1e6)}),YQ.channel.publish("tedious",c),s.call(this,u,l,d)})}var o=arguments[0];arguments[0].callback=n(o.callback),e.apply(this,arguments)},t};Nm.tedious={versionSpecifier:">= 6.0.0 < 9.0.0",patch:Ttt};function Ett(){YQ.channel.registerMonkeyPatch("tedious",Nm.tedious)}Nm.enable=Ett});var mIe=O(oc=>{"use strict";var wtt=oc&&oc.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Rtt=oc&&oc.__rest||function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r};Object.defineProperty(oc,"__esModule",{value:!0});oc.enable=oc.winston2=oc.winston3=void 0;var e8=Ni(),ktt=function(t){var e=t.Logger.prototype.log,r,n=function(o,s,a){var c;return r===t.config.npm.levels?c="npm":r===t.config.syslog.levels?c="syslog":c="unknown",e8.channel.publish("winston",{level:o,message:s,meta:a,levelKind:c}),s};return t.Logger.prototype.log=function(){return r=this.levels,!this.filters||this.filters.length===0?this.filters=[n]:this.filters[this.filters.length-1]!==n&&(this.filters=this.filters.filter(function(s){return s!==n}),this.filters.push(n)),e.apply(this,arguments)},t},Ptt=function(t){var e=function(a,c){var u;return a.config.npm.levels[c]!=null?u="npm":a.config.syslog.levels[c]!=null?u="syslog":u="unknown",u},r=function(a){wtt(c,a);function c(u,l){var d=a.call(this,l)||this;return d.winston=u,d}return c.prototype.log=function(u,l){var d=u.message,p=u.level,f=u.meta,m=Rtt(u,["message","level","meta"]);p=typeof Symbol.for=="function"?u[Symbol.for("level")]:p,d=u instanceof Error?u:d;var h=e(this.winston,p);f=f||{};for(var g in m)m.hasOwnProperty(g)&&(f[g]=m[g]);e8.channel.publish("winston",{message:d,level:p,levelKind:h,meta:f}),l()},c}(t.Transport);function n(){var a=t.config.npm.levels;arguments&&arguments[0]&&arguments[0].levels&&(a=arguments[0].levels);var c;for(var u in a)a.hasOwnProperty(u)&&(c=c===void 0||a[u]>a[c]?u:c);this.add(new r(t,{level:c}))}var o=t.createLogger;t.createLogger=function(){var c=t.config.npm.levels;arguments&&arguments[0]&&arguments[0].levels&&(c=arguments[0].levels);var u;for(var l in c)c.hasOwnProperty(l)&&(u=u===void 0||c[l]>c[u]?l:u);var d=o.apply(this,arguments);d.add(new r(t,{level:u}));var p=d.configure;return d.configure=function(){p.apply(this,arguments),n.apply(this,arguments)},d};var s=t.configure;return t.configure=function(){s.apply(this,arguments),n.apply(this,arguments)},t.add(new r(t)),t};oc.winston3={versionSpecifier:"3.x",patch:Ptt};oc.winston2={versionSpecifier:"2.x",patch:ktt};function Att(){e8.channel.registerMonkeyPatch("winston",oc.winston2),e8.channel.registerMonkeyPatch("winston",oc.winston3)}oc.enable=Att});var EIe=O(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});Mn.enable=Mn.tedious=Mn.pgPool=Mn.pg=Mn.winston=Mn.redis=Mn.mysql=Mn.mongodb=Mn.mongodbCore=Mn.console=Mn.bunyan=Mn.azuresdk=void 0;var hIe=Z1e();Mn.azuresdk=hIe;var gIe=tIe();Mn.bunyan=gIe;var vIe=nIe();Mn.console=vIe;var bIe=iIe();Mn.mongodbCore=bIe;var yIe=oIe();Mn.mongodb=yIe;var _Ie=aIe();Mn.mysql=_Ie;var xIe=uIe();Mn.pgPool=xIe;var SIe=dIe();Mn.pg=SIe;var IIe=pIe();Mn.redis=IIe;var CIe=fIe();Mn.tedious=CIe;var TIe=mIe();Mn.winston=TIe;function Dtt(){gIe.enable(),vIe.enable(),bIe.enable(),yIe.enable(),_Ie.enable(),SIe.enable(),xIe.enable(),IIe.enable(),TIe.enable(),hIe.enable(),CIe.enable()}Mn.enable=Dtt});var n8=O(Xv=>{"use strict";Object.defineProperty(Xv,"__esModule",{value:!0});Xv.registerContextPreservation=Xv.IsInitialized=void 0;var QQ=Wn(),RIe=JF();Xv.IsInitialized=!RIe.JsonConfig.getInstance().noDiagnosticChannel;var XQ="DiagnosticChannel";if(Xv.IsInitialized){rd=EIe(),wIe=RIe.JsonConfig.getInstance().noPatchModules,t8=wIe.split(","),JQ={bunyan:rd.bunyan,console:rd.console,mongodb:rd.mongodb,mongodbCore:rd.mongodbCore,mysql:rd.mysql,redis:rd.redis,pg:rd.pg,pgPool:rd.pgPool,winston:rd.winston,azuresdk:rd.azuresdk};for(r8 in JQ)t8.indexOf(r8)===-1&&(JQ[r8].enable(),QQ.info(XQ,"Subscribed to "+r8+" events"));t8.length>0&&QQ.info(XQ,"Some modules will not be patched",t8)}else QQ.info(XQ,"Not subscribing to dependency autocollection because APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL was set");var rd,wIe,t8,JQ,r8;function Ntt(t){if(Xv.IsInitialized){var e=Ni();e.channel.addContextPreservation(t)}}Xv.registerContextPreservation=Ntt});var NT=O((vAr,kIe)=>{"use strict";kIe.exports={requestContextHeader:"request-context",requestContextSourceKey:"appId",requestContextTargetKey:"appId",requestIdHeader:"request-id",parentIdHeader:"x-ms-request-id",rootIdHeader:"x-ms-request-root-id",correlationContextHeader:"correlation-context",traceparentHeader:"traceparent",traceStateHeader:"tracestate"}});var Is=O((tX,PIe)=>{"use strict";var Zv=tX&&tX.__assign||function(){return Zv=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Zv.apply(this,arguments)},Ltt=require("http"),ZQ=require("https"),eX=require("url"),Jv=require("constants"),g_=Wn(),LT=NT(),Ott=JF(),Mtt=function(){function t(){t._addCloseHandler()}return t.getCookie=function(e,r){var n="";if(e&&e.length&&typeof r=="string")for(var o=e+"=",s=r.split(";"),a=0;a<s.length;a++){var r=s[a];if(r=t.trim(r),r&&r.indexOf(o)===0){n=r.substring(o.length,s[a].length);break}}return n},t.trim=function(e){return typeof e=="string"?e.replace(/^\s+|\s+$/g,""):""},t.int32ArrayToBase64=function(e){var r=function(c,u){return String.fromCharCode(c>>u&255)},n=function(c){return r(c,24)+r(c,16)+r(c,8)+r(c,0)},o=e.map(n).join(""),s=Buffer.from?Buffer.from(o,"binary"):new Buffer(o,"binary"),a=s.toString("base64");return a.substr(0,a.indexOf("="))},t.random32=function(){return 4294967296*Math.random()|0},t.randomu32=function(){return t.random32()+2147483648},t.w3cTraceId=function(){for(var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],r="",n,o=0;o<4;o++)n=t.random32(),r+=e[n&15]+e[n>>4&15]+e[n>>8&15]+e[n>>12&15]+e[n>>16&15]+e[n>>20&15]+e[n>>24&15]+e[n>>28&15];var s=e[8+Math.random()*4|0];return r.substr(0,8)+r.substr(9,4)+"4"+r.substr(13,3)+s+r.substr(16,3)+r.substr(19,12)},t.w3cSpanId=function(){return t.w3cTraceId().substring(16)},t.isValidW3CId=function(e){return e.length===32&&e!=="00000000000000000000000000000000"},t.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},t.isError=function(e){return Object.prototype.toString.call(e)==="[object Error]"},t.isPrimitive=function(e){var r=typeof e;return r==="string"||r==="number"||r==="boolean"},t.isDate=function(e){return Object.prototype.toString.call(e)==="[object Date]"},t.msToTimeSpan=function(e){(isNaN(e)||e<0)&&(e=0);var r=(e/1e3%60).toFixed(7).replace(/0{0,4}$/,""),n=""+Math.floor(e/(1e3*60))%60,o=""+Math.floor(e/(1e3*60*60))%24,s=Math.floor(e/(1e3*60*60*24));r=r.indexOf(".")<2?"0"+r:r,n=n.length<2?"0"+n:n,o=o.length<2?"0"+o:o;var a=s>0?s+".":"";return a+o+":"+n+":"+r},t.extractError=function(e){var r=e;return{message:e.message,code:r.code||r.id||""}},t.extractObject=function(e){return e instanceof Error?t.extractError(e):typeof e.toJSON=="function"?e.toJSON():e},t.validateStringMap=function(e){if(typeof e!="object"){g_.info("Invalid properties dropped from payload");return}var r={};for(var n in e){var o="",s=e[n],a=typeof s;if(t.isPrimitive(s))o=s.toString();else if(s===null||a==="undefined")o="";else if(a==="function"){g_.info("key: "+n+" was function; will not serialize");continue}else{var c=t.isArray(s)?s:t.extractObject(s);try{t.isPrimitive(c)?o=c:o=JSON.stringify(c)}catch(u){o=s.constructor.name.toString()+" (Error: "+u.message+")",g_.info("key: "+n+", could not be serialized")}}r[n]=o.substring(0,t.MAX_PROPERTY_LENGTH)}return r},t.canIncludeCorrelationHeader=function(e,r){var n=e&&e.config&&e.config.correlationHeaderExcludedDomains;if(!n||n.length==0||!r)return!0;for(var o=0;o<n.length;o++){var s=new RegExp(n[o].replace(/\./g,".").replace(/\*/g,".*"));try{if(s.test(new eX.URL(r).hostname))return!1}catch{}}return!0},t.getCorrelationContextTarget=function(e,r){var n=e.headers&&e.headers[LT.requestContextHeader];if(n)for(var o=n.split(","),s=0;s<o.length;++s){var a=o[s].split("=");if(a.length==2&&a[0]==r)return a[1]}},t.makeRequest=function(e,r,n,o,s,a){s===void 0&&(s=!0),a===void 0&&(a=!0),r&&r.indexOf("//")===0&&(r="https:"+r);var c=new eX.URL(r),u=Zv(Zv({},n),{host:c.hostname,port:c.port,path:c.pathname}),l=void 0;if(s&&(c.protocol==="https:"&&(l=e.proxyHttpsUrl||void 0),c.protocol==="http:"&&(l=e.proxyHttpUrl||void 0),l)){l.indexOf("//")===0&&(l="http:"+l);try{var d=new eX.URL(l);d.protocol==="https:"?(g_.info("Proxies that use HTTPS are not supported"),l=void 0):u=Zv(Zv({},u),{host:d.hostname,port:d.port||"80",path:r,headers:Zv(Zv({},u.headers),{Host:c.hostname})})}catch{g_.warn("Wrong proxy URL provided")}}var p=c.protocol==="https:"&&!l;return a&&(p&&e.httpsAgent!==void 0?u.agent=e.httpsAgent:!p&&e.httpAgent!==void 0?u.agent=e.httpAgent:p&&(u.agent=t._useKeepAlive?t.keepAliveAgent:t.tlsRestrictedAgent)),p?ZQ.request(u,o):Ltt.request(u,o)},t.safeIncludeCorrelationHeader=function(e,r,n){var o;if(typeof n=="string")o=n;else if(n instanceof Array)o=n.join(",");else if(n&&typeof n.toString=="function")try{o=n.toString()}catch(s){g_.warn("Outgoing request-context header could not be read. Correlation of requests may be lost.",s,n)}o?t.addCorrelationIdHeaderFromString(e,r,o):r.setHeader(LT.requestContextHeader,LT.requestContextSourceKey+"="+e.config.correlationId)},t.dumpObj=function(e){if(e)try{var r=Object.prototype.toString.call(e),n="";return r==="[object Error]"?n="{ stack: '"+e.stack+"', message: '"+e.message+"', name: '"+e.name+"'":n=this.stringify(e),r+n}catch{return e.toString()}},t.stringify=function(e){try{return JSON.stringify(e)}catch(r){g_.warn("Failed to serialize payload",r,e)}},t.addCorrelationIdHeaderFromString=function(e,r,n){var o=n.split(","),s=LT.requestContextSourceKey+"=",a=o.some(function(c){return c.substring(0,s.length)===s});a||r.setHeader(LT.requestContextHeader,n+","+LT.requestContextSourceKey+"="+e.config.correlationId)},t._addCloseHandler=function(){t._listenerAttached||(process.on("exit",function(){t.isNodeExit=!0,t._useKeepAlive=!1}),t._listenerAttached=!0)},t._useKeepAlive=!Ott.JsonConfig.getInstance().noHttpAgentKeepAlive,t._listenerAttached=!1,t.MAX_PROPERTY_LENGTH=8192,t.keepAliveAgent=new ZQ.Agent({keepAlive:!0,maxSockets:25,secureOptions:Jv.SSL_OP_NO_SSLv2|Jv.SSL_OP_NO_SSLv3|Jv.SSL_OP_NO_TLSv1|Jv.SSL_OP_NO_TLSv1_1}),t.tlsRestrictedAgent=new ZQ.Agent({secureOptions:Jv.SSL_OP_NO_SSLv2|Jv.SSL_OP_NO_SSLv3|Jv.SSL_OP_NO_TLSv1|Jv.SSL_OP_NO_TLSv1_1}),t.isNodeExit=!1,t}();PIe.exports=Mtt});var v_=O((bAr,AIe)=>{"use strict";var rX=Is(),Ftt=function(){function t(){}return t.queryCorrelationId=function(e,r){},t.cancelCorrelationIdQuery=function(e,r){},t.generateRequestId=function(e){if(e){e=e[0]=="|"?e:"|"+e,e[e.length-1]!=="."&&(e+=".");var r=(t.currentRootId++).toString(16);return t.appendSuffix(e,r,"_")}else return t.generateRootId()},t.getRootId=function(e){var r=e.indexOf(".");r<0&&(r=e.length);var n=e[0]==="|"?1:0;return e.substring(n,r)},t.generateRootId=function(){return"|"+rX.w3cTraceId()+"."},t.appendSuffix=function(e,r,n){if(e.length+r.length<t.requestIdMaxLength)return e+r+n;var o=t.requestIdMaxLength-9;if(e.length>o)for(;o>1;--o){var s=e[o-1];if(s==="."||s==="_")break}if(o<=1)return t.generateRootId();for(r=rX.randomu32().toString(16);r.length<8;)r="0"+r;return e.substring(0,o)+r+"#"},t.correlationIdPrefix="cid-v1:",t.w3cEnabled=!0,t.HTTP_TIMEOUT=2500,t.requestIdMaxLength=1024,t.currentRootId=rX.randomu32(),t}();AIe.exports=Ftt});var i8=O((yAr,DIe)=>{"use strict";var Cs=Is(),Utt=v_(),Btt=function(){function t(e,r){if(this.traceFlag=t.DEFAULT_TRACE_FLAG,this.version=t.DEFAULT_VERSION,e&&typeof e=="string")if(e.split(",").length>1)this.traceId=Cs.w3cTraceId(),this.spanId=Cs.w3cTraceId().substr(0,16);else{var n=e.trim().split("-"),o=n.length;o>=4?(this.version=n[0],this.traceId=n[1],this.spanId=n[2],this.traceFlag=n[3]):(this.traceId=Cs.w3cTraceId(),this.spanId=Cs.w3cTraceId().substr(0,16)),this.version.match(/^[0-9a-f]{2}$/g)||(this.version=t.DEFAULT_VERSION,this.traceId=Cs.w3cTraceId()),this.version==="00"&&o!==4&&(this.traceId=Cs.w3cTraceId(),this.spanId=Cs.w3cTraceId().substr(0,16)),this.version==="ff"&&(this.version=t.DEFAULT_VERSION,this.traceId=Cs.w3cTraceId(),this.spanId=Cs.w3cTraceId().substr(0,16)),this.version.match(/^0[0-9a-f]$/g)||(this.version=t.DEFAULT_VERSION),this.traceFlag.match(/^[0-9a-f]{2}$/g)||(this.traceFlag=t.DEFAULT_TRACE_FLAG,this.traceId=Cs.w3cTraceId()),t.isValidTraceId(this.traceId)||(this.traceId=Cs.w3cTraceId()),t.isValidSpanId(this.spanId)||(this.spanId=Cs.w3cTraceId().substr(0,16),this.traceId=Cs.w3cTraceId()),this.parentId=this.getBackCompatRequestId()}else if(r){this.parentId=r.slice();var s=Utt.getRootId(r);t.isValidTraceId(s)||(this.legacyRootId=s,s=Cs.w3cTraceId()),r.indexOf("|")!==-1&&(r=r.substring(1+r.substring(0,r.length-1).lastIndexOf("."),r.length-1)),this.traceId=s,this.spanId=r}else this.traceId=Cs.w3cTraceId(),this.spanId=Cs.w3cTraceId().substr(0,16)}return t.isValidTraceId=function(e){return e.match(/^[0-9a-f]{32}$/)&&e!=="00000000000000000000000000000000"},t.isValidSpanId=function(e){return e.match(/^[0-9a-f]{16}$/)&&e!=="0000000000000000"},t.formatOpenTelemetryTraceFlags=function(e){var r="0"+e.toString(16);return r.substring(r.length-2)},t.prototype.getBackCompatRequestId=function(){return"|"+this.traceId+"."+this.spanId+"."},t.prototype.toString=function(){return this.version+"-"+this.traceId+"-"+this.spanId+"-"+this.traceFlag},t.prototype.updateSpanId=function(){this.spanId=Cs.w3cTraceId().substr(0,16)},t.DEFAULT_TRACE_FLAG="01",t.DEFAULT_VERSION="00",t}();DIe.exports=Btt});var nX=O((_Ar,NIe)=>{"use strict";var qtt=function(){function t(e){this.fieldmap=[],e&&(this.fieldmap=this.parseHeader(e))}return t.prototype.toString=function(){var e=this.fieldmap;return!e||e.length==0?null:e.join(", ")},t.validateKeyChars=function(e){var r=e.split("@");if(r.length==2){var n=r[0].trim(),o=r[1].trim(),s=!!n.match(/^[\ ]?[a-z0-9\*\-\_/]{1,241}$/),a=!!o.match(/^[\ ]?[a-z0-9\*\-\_/]{1,14}$/);return s&&a}else if(r.length==1)return!!e.match(/^[\ ]?[a-z0-9\*\-\_/]{1,256}$/);return!1},t.prototype.parseHeader=function(e){var r=[],n={},o=e.split(",");if(o.length>32)return null;for(var s=0,a=o;s<a.length;s++){var c=a[s],u=c.trim();if(u.length!==0){var l=u.split("=");if(l.length!==2||!t.validateKeyChars(l[0])||n[l[0]])return null;n[l[0]]=!0,r.push(u)}}return r},t.strict=!0,t}();NIe.exports=qtt});var Lm=O((xAr,LIe)=>{"use strict";var jtt=function(){function t(){}return t}();LIe.exports=jtt});var MIe=O((iX,OIe)=>{"use strict";var Htt=iX&&iX.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Vtt=Lm(),Gtt=function(t){Htt(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(Vtt);OIe.exports=Gtt});var oX=O((SAr,FIe)=>{"use strict";var ztt=function(){function t(){}return t}();FIe.exports=ztt});var BIe=O((IAr,UIe)=>{"use strict";var $tt=function(){function t(){this.applicationVersion="ai.application.ver",this.deviceId="ai.device.id",this.deviceLocale="ai.device.locale",this.deviceModel="ai.device.model",this.deviceOEMName="ai.device.oemName",this.deviceOSVersion="ai.device.osVersion",this.deviceType="ai.device.type",this.locationIp="ai.location.ip",this.operationId="ai.operation.id",this.operationName="ai.operation.name",this.operationParentId="ai.operation.parentId",this.operationSyntheticSource="ai.operation.syntheticSource",this.operationCorrelationVector="ai.operation.correlationVector",this.sessionId="ai.session.id",this.sessionIsFirst="ai.session.isFirst",this.userAccountId="ai.user.accountId",this.userId="ai.user.id",this.userAuthUserId="ai.user.authUserId",this.cloudRole="ai.cloud.role",this.cloudRoleInstance="ai.cloud.roleInstance",this.internalSdkVersion="ai.internal.sdkVersion",this.internalAgentVersion="ai.internal.agentVersion",this.internalNodeName="ai.internal.nodeName"}return t}();UIe.exports=$tt});var jIe=O((sX,qIe)=>{"use strict";var Wtt=sX&&sX.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ktt=oX(),Ytt=function(t){Wtt(e,t);function e(){return t.call(this)||this}return e}(Ktt);qIe.exports=Ytt});var cX=O((CAr,HIe)=>{"use strict";var aX;(function(t){t[t.Measurement=0]="Measurement",t[t.Aggregation=1]="Aggregation"})(aX||(aX={}));HIe.exports=aX});var GIe=O((TAr,VIe)=>{"use strict";var Qtt=cX(),Xtt=function(){function t(){this.kind=Qtt.Measurement}return t}();VIe.exports=Xtt});var $Ie=O((EAr,zIe)=>{"use strict";var Jtt=function(){function t(){this.ver=1,this.sampleRate=100,this.tags={}}return t}();zIe.exports=Jtt});var lX=O((uX,WIe)=>{"use strict";var Ztt=uX&&uX.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),ert=Lm(),trt=function(t){Ztt(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(ert);WIe.exports=trt});var YIe=O((dX,KIe)=>{"use strict";var rrt=dX&&dX.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),nrt=Lm(),irt=function(t){rrt(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.exceptions=[],r.properties={},r.measurements={},r}return e}(nrt);KIe.exports=irt});var XIe=O((wAr,QIe)=>{"use strict";var ort=function(){function t(){this.hasFullStack=!0,this.parsedStack=[]}return t}();QIe.exports=ort});var ZIe=O((pX,JIe)=>{"use strict";var srt=pX&&pX.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),art=Lm(),crt=function(t){srt(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r}return e}(art);JIe.exports=crt});var tCe=O((fX,eCe)=>{"use strict";var urt=fX&&fX.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),lrt=Lm(),drt=function(t){urt(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.metrics=[],r.properties={},r}return e}(lrt);eCe.exports=drt});var nCe=O((mX,rCe)=>{"use strict";var prt=mX&&mX.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),frt=lX(),mrt=function(t){prt(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(frt);rCe.exports=mrt});var oCe=O((hX,iCe)=>{"use strict";var hrt=hX&&hX.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),grt=Lm(),vrt=function(t){hrt(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.success=!0,r.properties={},r.measurements={},r}return e}(grt);iCe.exports=vrt});var aCe=O((gX,sCe)=>{"use strict";var brt=gX&&gX.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),yrt=Lm(),_rt=function(t){brt(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(yrt);sCe.exports=_rt});var uCe=O((RAr,cCe)=>{"use strict";var vX;(function(t){t[t.Verbose=0]="Verbose",t[t.Information=1]="Information",t[t.Warning=2]="Warning",t[t.Error=3]="Error",t[t.Critical=4]="Critical"})(vX||(vX={}));cCe.exports=vX});var dCe=O((kAr,lCe)=>{"use strict";var xrt=function(){function t(){}return t}();lCe.exports=xrt});var bX=O(co=>{"use strict";Object.defineProperty(co,"__esModule",{value:!0});co.AvailabilityData=MIe();co.Base=oX();co.ContextTagKeys=BIe();co.Data=jIe();co.DataPoint=GIe();co.DataPointType=cX();co.Domain=Lm();co.Envelope=$Ie();co.EventData=lX();co.ExceptionData=YIe();co.ExceptionDetails=XIe();co.MessageData=ZIe();co.MetricData=tCe();co.PageViewData=nCe();co.RemoteDependencyData=oCe();co.RequestData=aCe();co.SeverityLevel=uCe();co.StackFrame=dCe()});var pCe=O(OT=>{"use strict";Object.defineProperty(OT,"__esModule",{value:!0});OT.domainSupportsProperties=OT.RemoteDependencyDataConstants=void 0;var b_=bX(),Srt=function(){function t(){}return t.TYPE_HTTP="Http",t.TYPE_AI="Http (tracked component)",t}();OT.RemoteDependencyDataConstants=Srt;function Irt(t){return"properties"in t||t instanceof b_.EventData||t instanceof b_.ExceptionData||t instanceof b_.MessageData||t instanceof b_.MetricData||t instanceof b_.PageViewData||t instanceof b_.RemoteDependencyData||t instanceof b_.RequestData}OT.domainSupportsProperties=Irt});var mCe=O(fCe=>{"use strict";Object.defineProperty(fCe,"__esModule",{value:!0})});var gCe=O(hCe=>{"use strict";Object.defineProperty(hCe,"__esModule",{value:!0})});var bCe=O(vCe=>{"use strict";Object.defineProperty(vCe,"__esModule",{value:!0})});var _Ce=O(yCe=>{"use strict";Object.defineProperty(yCe,"__esModule",{value:!0})});var SCe=O(xCe=>{"use strict";Object.defineProperty(xCe,"__esModule",{value:!0})});var CCe=O(ICe=>{"use strict";Object.defineProperty(ICe,"__esModule",{value:!0})});var ECe=O(TCe=>{"use strict";Object.defineProperty(TCe,"__esModule",{value:!0})});var RCe=O(wCe=>{"use strict";Object.defineProperty(wCe,"__esModule",{value:!0})});var PCe=O(kCe=>{"use strict";Object.defineProperty(kCe,"__esModule",{value:!0})});var DCe=O(ACe=>{"use strict";Object.defineProperty(ACe,"__esModule",{value:!0})});var LCe=O(NCe=>{"use strict";Object.defineProperty(NCe,"__esModule",{value:!0})});var MCe=O(OCe=>{"use strict";Object.defineProperty(OCe,"__esModule",{value:!0})});var FCe=O(nd=>{"use strict";Object.defineProperty(nd,"__esModule",{value:!0});nd.TelemetryType=nd.TelemetryTypeString=nd.baseTypeToTelemetryType=nd.telemetryTypeToBaseType=void 0;function Crt(t){switch(t){case Ts.Event:return"EventData";case Ts.Exception:return"ExceptionData";case Ts.Trace:return"MessageData";case Ts.Metric:return"MetricData";case Ts.Request:return"RequestData";case Ts.Dependency:return"RemoteDependencyData";case Ts.Availability:return"AvailabilityData";case Ts.PageView:return"PageViewData"}}nd.telemetryTypeToBaseType=Crt;function Trt(t){switch(t){case"EventData":return Ts.Event;case"ExceptionData":return Ts.Exception;case"MessageData":return Ts.Trace;case"MetricData":return Ts.Metric;case"RequestData":return Ts.Request;case"RemoteDependencyData":return Ts.Dependency;case"AvailabilityData":return Ts.Availability;case"PageViewData":return Ts.PageView}}nd.baseTypeToTelemetryType=Trt;nd.TelemetryTypeString={Event:"EventData",Exception:"ExceptionData",Trace:"MessageData",Metric:"MetricData",Request:"RequestData",Dependency:"RemoteDependencyData",Availability:"AvailabilityData",PageView:"PageViewData"};var Ts;(function(t){t[t.Event=0]="Event",t[t.Exception=1]="Exception",t[t.Trace=2]="Trace",t[t.Metric=3]="Metric",t[t.Request=4]="Request",t[t.Dependency=5]="Dependency",t[t.Availability=6]="Availability",t[t.PageView=7]="PageView"})(Ts=nd.TelemetryType||(nd.TelemetryType={}))});var UCe=O(Po=>{"use strict";var Ert=Po&&Po.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),zc=Po&&Po.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Ert(e,t,r)};Object.defineProperty(Po,"__esModule",{value:!0});zc(mCe(),Po);zc(gCe(),Po);zc(bCe(),Po);zc(_Ce(),Po);zc(SCe(),Po);zc(CCe(),Po);zc(ECe(),Po);zc(RCe(),Po);zc(PCe(),Po);zc(DCe(),Po);zc(LCe(),Po);zc(MCe(),Po);zc(FCe(),Po)});var qCe=O(BCe=>{"use strict";Object.defineProperty(BCe,"__esModule",{value:!0})});var HCe=O(jCe=>{"use strict";Object.defineProperty(jCe,"__esModule",{value:!0})});var GCe=O(VCe=>{"use strict";Object.defineProperty(VCe,"__esModule",{value:!0})});var $Ce=O(zCe=>{"use strict";Object.defineProperty(zCe,"__esModule",{value:!0})});var KCe=O(WCe=>{"use strict";Object.defineProperty(WCe,"__esModule",{value:!0})});var QCe=O(YCe=>{"use strict";Object.defineProperty(YCe,"__esModule",{value:!0})});var JCe=O(XCe=>{"use strict";Object.defineProperty(XCe,"__esModule",{value:!0})});var eTe=O(ZCe=>{"use strict";Object.defineProperty(ZCe,"__esModule",{value:!0})});var tTe=O(sc=>{"use strict";var wrt=sc&&sc.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),e0=sc&&sc.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&wrt(e,t,r)};Object.defineProperty(sc,"__esModule",{value:!0});e0(qCe(),sc);e0(HCe(),sc);e0(GCe(),sc);e0($Ce(),sc);e0(KCe(),sc);e0(QCe(),sc);e0(JCe(),sc);e0(eTe(),sc)});var Xs=O(Op=>{"use strict";var Rrt=Op&&Op.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),o8=Op&&Op.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&Rrt(e,t,r)};Object.defineProperty(Op,"__esModule",{value:!0});o8(pCe(),Op);o8(bX(),Op);o8(UCe(),Op);o8(tTe(),Op)});var yX=O((rDr,rTe)=>{"use strict";var krt=function(){function t(){}return t.prototype.getUrl=function(){return this.url},t.prototype.RequestParser=function(){this.startTime=+new Date},t.prototype._setStatus=function(e,r){var n=+new Date;this.duration=n-this.startTime,this.statusCode=e;var o=this.properties||{};if(r){if(typeof r=="string")o.error=r;else if(r instanceof Error)o.error=r.message;else if(typeof r=="object")for(var s in r)o[s]=r[s]&&r[s].toString&&r[s].toString()}this.properties=o},t.prototype._isSuccess=function(){return 0<this.statusCode&&this.statusCode<400},t}();rTe.exports=krt});var fi=O(He=>{"use strict";var id;Object.defineProperty(He,"__esModule",{value:!0});He.WEB_INSTRUMENTATION_DEPRECATED_SOURCE=He.WEB_INSTRUMENTATION_DEFAULT_SOURCE=He.TIME_SINCE_ENQUEUED=He.ENQUEUED_TIME=He.MessageBusDestination=He.MicrosoftEventHub=He.AzNamespace=He.HttpRequestCookieNames=He.StatsbeatNetworkCategory=He.StatsbeatFeatureType=He.StatsbeatInstrumentation=He.StatsbeatFeature=He.StatsbeatCounter=He.StatsbeatAttach=He.StatsbeatResourceProvider=He.StatsbeatTelemetryName=He.HeartBeatMetricName=He.DependencyTypeName=He.TelemetryTypeStringToQuickPulseDocumentType=He.TelemetryTypeStringToQuickPulseType=He.QuickPulseType=He.QuickPulseDocumentType=He.PerformanceToQuickPulseCounter=He.MetricId=He.PerformanceCounter=He.QuickPulseCounter=He.DEFAULT_LIVEMETRICS_HOST=He.DEFAULT_LIVEMETRICS_ENDPOINT=He.DEFAULT_BREEZE_ENDPOINT=He.APPLICATION_INSIGHTS_SDK_VERSION=void 0;He.APPLICATION_INSIGHTS_SDK_VERSION="2.9.1";He.DEFAULT_BREEZE_ENDPOINT="https://dc.services.visualstudio.com";He.DEFAULT_LIVEMETRICS_ENDPOINT="https://rt.services.visualstudio.com";He.DEFAULT_LIVEMETRICS_HOST="rt.services.visualstudio.com";var Js;(function(t){t.COMMITTED_BYTES="\\Memory\\Committed Bytes",t.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",t.REQUEST_RATE="\\ApplicationInsights\\Requests/Sec",t.REQUEST_FAILURE_RATE="\\ApplicationInsights\\Requests Failed/Sec",t.REQUEST_DURATION="\\ApplicationInsights\\Request Duration",t.DEPENDENCY_RATE="\\ApplicationInsights\\Dependency Calls/Sec",t.DEPENDENCY_FAILURE_RATE="\\ApplicationInsights\\Dependency Calls Failed/Sec",t.DEPENDENCY_DURATION="\\ApplicationInsights\\Dependency Call Duration",t.EXCEPTION_RATE="\\ApplicationInsights\\Exceptions/Sec"})(Js=He.QuickPulseCounter||(He.QuickPulseCounter={}));var s8;(function(t){t.PRIVATE_BYTES="\\Process(??APP_WIN32_PROC??)\\Private Bytes",t.AVAILABLE_BYTES="\\Memory\\Available Bytes",t.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",t.PROCESS_TIME="\\Process(??APP_WIN32_PROC??)\\% Processor Time",t.REQUEST_RATE="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Requests/Sec",t.REQUEST_DURATION="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Request Execution Time"})(s8=He.PerformanceCounter||(He.PerformanceCounter={}));var Prt;(function(t){t.REQUESTS_DURATION="requests/duration",t.DEPENDENCIES_DURATION="dependencies/duration",t.EXCEPTIONS_COUNT="exceptions/count",t.TRACES_COUNT="traces/count"})(Prt=He.MetricId||(He.MetricId={}));He.PerformanceToQuickPulseCounter=(id={},id[s8.PROCESSOR_TIME]=Js.PROCESSOR_TIME,id[s8.REQUEST_RATE]=Js.REQUEST_RATE,id[s8.REQUEST_DURATION]=Js.REQUEST_DURATION,id[Js.COMMITTED_BYTES]=Js.COMMITTED_BYTES,id[Js.REQUEST_FAILURE_RATE]=Js.REQUEST_FAILURE_RATE,id[Js.DEPENDENCY_RATE]=Js.DEPENDENCY_RATE,id[Js.DEPENDENCY_FAILURE_RATE]=Js.DEPENDENCY_FAILURE_RATE,id[Js.DEPENDENCY_DURATION]=Js.DEPENDENCY_DURATION,id[Js.EXCEPTION_RATE]=Js.EXCEPTION_RATE,id);He.QuickPulseDocumentType={Event:"Event",Exception:"Exception",Trace:"Trace",Metric:"Metric",Request:"Request",Dependency:"RemoteDependency",Availability:"Availability",PageView:"PageView"};He.QuickPulseType={Event:"EventTelemetryDocument",Exception:"ExceptionTelemetryDocument",Trace:"TraceTelemetryDocument",Metric:"MetricTelemetryDocument",Request:"RequestTelemetryDocument",Dependency:"DependencyTelemetryDocument",Availability:"AvailabilityTelemetryDocument",PageView:"PageViewTelemetryDocument"};He.TelemetryTypeStringToQuickPulseType={EventData:He.QuickPulseType.Event,ExceptionData:He.QuickPulseType.Exception,MessageData:He.QuickPulseType.Trace,MetricData:He.QuickPulseType.Metric,RequestData:He.QuickPulseType.Request,RemoteDependencyData:He.QuickPulseType.Dependency,AvailabilityData:He.QuickPulseType.Availability,PageViewData:He.QuickPulseType.PageView};He.TelemetryTypeStringToQuickPulseDocumentType={EventData:He.QuickPulseDocumentType.Event,ExceptionData:He.QuickPulseDocumentType.Exception,MessageData:He.QuickPulseDocumentType.Trace,MetricData:He.QuickPulseDocumentType.Metric,RequestData:He.QuickPulseDocumentType.Request,RemoteDependencyData:He.QuickPulseDocumentType.Dependency,AvailabilityData:He.QuickPulseDocumentType.Availability,PageViewData:He.QuickPulseDocumentType.PageView};He.DependencyTypeName={Grpc:"GRPC",Http:"HTTP",InProc:"InProc",Sql:"SQL",QueueMessage:"Queue Message"};He.HeartBeatMetricName="HeartbeatState";He.StatsbeatTelemetryName="Statsbeat";He.StatsbeatResourceProvider={appsvc:"appsvc",aks:"aks",functions:"functions",vm:"vm",unknown:"unknown"};He.StatsbeatAttach={codeless:"codeless",sdk:"sdk"};He.StatsbeatCounter={REQUEST_SUCCESS:"Request Success Count",REQUEST_FAILURE:"Request Failure Count",REQUEST_DURATION:"Request Duration",RETRY_COUNT:"Retry Count",THROTTLE_COUNT:"Throttle Count",EXCEPTION_COUNT:"Exception Count",ATTACH:"Attach",FEATURE:"Feature"};var Art;(function(t){t[t.NONE=0]="NONE",t[t.DISK_RETRY=1]="DISK_RETRY",t[t.AAD_HANDLING=2]="AAD_HANDLING",t[t.WEB_SNIPPET=4]="WEB_SNIPPET"})(Art=He.StatsbeatFeature||(He.StatsbeatFeature={}));var Drt;(function(t){t[t.NONE=0]="NONE",t[t.AZURE_CORE_TRACING=1]="AZURE_CORE_TRACING",t[t.MONGODB=2]="MONGODB",t[t.MYSQL=4]="MYSQL",t[t.REDIS=8]="REDIS",t[t.POSTGRES=16]="POSTGRES",t[t.BUNYAN=32]="BUNYAN",t[t.WINSTON=64]="WINSTON",t[t.CONSOLE=128]="CONSOLE"})(Drt=He.StatsbeatInstrumentation||(He.StatsbeatInstrumentation={}));var Nrt;(function(t){t[t.Feature=0]="Feature",t[t.Instrumentation=1]="Instrumentation"})(Nrt=He.StatsbeatFeatureType||(He.StatsbeatFeatureType={}));var Lrt;(function(t){t[t.Breeze=0]="Breeze",t[t.Quickpulse=1]="Quickpulse"})(Lrt=He.StatsbeatNetworkCategory||(He.StatsbeatNetworkCategory={}));var Ort;(function(t){t.SESSION="ai_session",t.USER="ai_user",t.AUTH_USER="ai_authUser"})(Ort=He.HttpRequestCookieNames||(He.HttpRequestCookieNames={}));He.AzNamespace="az.namespace";He.MicrosoftEventHub="Microsoft.EventHub";He.MessageBusDestination="message_bus.destination";He.ENQUEUED_TIME="enqueuedTime";He.TIME_SINCE_ENQUEUED="timeSinceEnqueued";He.WEB_INSTRUMENTATION_DEFAULT_SOURCE="https://js.monitor.azure.com/scripts/b/ai";He.WEB_INSTRUMENTATION_DEPRECATED_SOURCE="https://az416426.vo.msecnd.net/scripts/b/ai"});var IX=O((SX,nTe)=>{"use strict";var Mrt=SX&&SX.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),a8=require("url"),Frt=Xs(),_X=Is(),$c=NT(),Urt=yX(),t0=v_(),Brt=nX(),xX=i8(),qrt=Wn(),c8=fi(),jrt=function(t){Mrt(e,t);function e(r,n){var o=t.call(this)||this;return r&&(o.method=r.method,o.url=o._getAbsoluteUrl(r),o.startTime=+new Date,o.socketRemoteAddress=r.socket&&r.socket.remoteAddress,o.parseHeaders(r,n),r.connection&&(o.connectionRemoteAddress=r.connection.remoteAddress,o.legacySocketRemoteAddress=r.connection.socket&&r.connection.socket.remoteAddress)),o}return e.prototype.onError=function(r,n){this._setStatus(void 0,r),n&&(this.duration=n)},e.prototype.onResponse=function(r,n){this._setStatus(r.statusCode,void 0),n&&(this.duration=n)},e.prototype.getRequestTelemetry=function(r){var n=this.method;try{n+=" "+new a8.URL(this.url).pathname}catch{}var o={id:this.requestId,name:n,url:this.url,source:this.sourceCorrelationId,duration:this.duration,resultCode:this.statusCode?this.statusCode.toString():null,success:this._isSuccess(),properties:this.properties};if(r&&r.time?o.time=r.time:this.startTime&&(o.time=new Date(this.startTime)),r){for(var s in r)o[s]||(o[s]=r[s]);if(r.properties)for(var s in r.properties)o.properties[s]=r.properties[s]}return o},e.prototype.getRequestTags=function(r){var n={};for(var o in r)n[o]=r[o];return n[e.keys.locationIp]=r[e.keys.locationIp]||this._getIp(),n[e.keys.sessionId]=r[e.keys.sessionId]||this._getId(c8.HttpRequestCookieNames.SESSION),n[e.keys.userId]=r[e.keys.userId]||this._getId(c8.HttpRequestCookieNames.USER),n[e.keys.userAuthUserId]=r[e.keys.userAuthUserId]||this._getId(c8.HttpRequestCookieNames.AUTH_USER),n[e.keys.operationName]=this.getOperationName(r),n[e.keys.operationParentId]=this.getOperationParentId(r),n[e.keys.operationId]=this.getOperationId(r),n},e.prototype.getOperationId=function(r){return r[e.keys.operationId]||this.operationId},e.prototype.getOperationParentId=function(r){return r[e.keys.operationParentId]||this.parentId||this.getOperationId(r)},e.prototype.getOperationName=function(r){if(r[e.keys.operationName])return r[e.keys.operationName];var n="";try{n=new a8.URL(this.url).pathname}catch{}var o=this.method;return n&&(o+=" "+n),o},e.prototype.getRequestId=function(){return this.requestId},e.prototype.getCorrelationContextHeader=function(){return this.correlationContextHeader},e.prototype.getTraceparent=function(){return this.traceparent},e.prototype.getTracestate=function(){return this.tracestate},e.prototype.getLegacyRootId=function(){return this.legacyRootId},e.prototype._getAbsoluteUrl=function(r){if(!r.headers)return r.url;var n=r.connection?r.connection.encrypted:null,o=n||r.headers["x-forwarded-proto"]=="https"?"https":"http",s=o+"://"+r.headers.host+"/",a="",c="";try{var u=new a8.URL(r.url,s);a=u.pathname,c=u.search}catch{}var l=a8.format({protocol:o,host:r.headers.host,pathname:a,search:c});return l},e.prototype._getIp=function(){var r=/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/,n=function(s){var a=r.exec(s);if(a)return a[0]},o=n(this.rawHeaders["x-forwarded-for"])||n(this.rawHeaders["x-client-ip"])||n(this.rawHeaders["x-real-ip"])||n(this.connectionRemoteAddress)||n(this.socketRemoteAddress)||n(this.legacySocketRemoteAddress);return!o&&this.connectionRemoteAddress&&this.connectionRemoteAddress.substr&&this.connectionRemoteAddress.substr(0,2)==="::"&&(o="127.0.0.1"),o},e.prototype._getId=function(r){var n=this.rawHeaders&&this.rawHeaders.cookie&&typeof this.rawHeaders.cookie=="string"&&this.rawHeaders.cookie||"";if(r===c8.HttpRequestCookieNames.AUTH_USER)try{n=decodeURI(n)}catch(s){n="",qrt.warn("Could not decode the auth cookie with error: ",_X.dumpObj(s))}var o=e.parseId(_X.getCookie(r,n));return o},e.prototype.setBackCompatFromThisTraceContext=function(){this.operationId=this.traceparent.traceId,this.traceparent.legacyRootId&&(this.legacyRootId=this.traceparent.legacyRootId),this.parentId=this.traceparent.parentId,this.traceparent.updateSpanId(),this.requestId=this.traceparent.getBackCompatRequestId()},e.prototype.parseHeaders=function(r,n){if(this.rawHeaders=r.headers||r.rawHeaders,this.userAgent=r.headers&&r.headers["user-agent"],this.sourceCorrelationId=_X.getCorrelationContextTarget(r,$c.requestContextSourceKey),r.headers){var o=r.headers[$c.traceStateHeader]?r.headers[$c.traceStateHeader].toString():null,s=r.headers[$c.traceparentHeader]?r.headers[$c.traceparentHeader].toString():null,a=r.headers[$c.requestIdHeader]?r.headers[$c.requestIdHeader].toString():null,c=r.headers[$c.parentIdHeader]?r.headers[$c.parentIdHeader].toString():null,u=r.headers[$c.rootIdHeader]?r.headers[$c.rootIdHeader].toString():null;this.correlationContextHeader=r.headers[$c.correlationContextHeader]?r.headers[$c.correlationContextHeader].toString():null,t0.w3cEnabled&&(s||o)?(this.traceparent=new xX(s?s.toString():null),this.tracestate=s&&o&&new Brt(o?o.toString():null),this.setBackCompatFromThisTraceContext()):a?t0.w3cEnabled?(this.traceparent=new xX(null,a),this.setBackCompatFromThisTraceContext()):(this.parentId=a,this.requestId=t0.generateRequestId(this.parentId),this.operationId=t0.getRootId(this.requestId)):t0.w3cEnabled?(this.traceparent=new xX,this.traceparent.parentId=c,this.traceparent.legacyRootId=u||c,this.setBackCompatFromThisTraceContext()):(this.parentId=c,this.requestId=t0.generateRequestId(u||this.parentId),this.correlationContextHeader=null,this.operationId=t0.getRootId(this.requestId)),n&&(this.requestId=n,this.operationId=t0.getRootId(this.requestId))}},e.parseId=function(r){var n=r.split("|");return n.length>0?n[0]:""},e.keys=new Frt.ContextTagKeys,e}(Urt);nTe.exports=jrt});var _Te=O(($t,yTe)=>{$t=yTe.exports=Mr;var gn;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?gn=function(){var t=Array.prototype.slice.call(arguments,0);t.unshift("SEMVER"),console.log.apply(console,t)}:gn=function(){};$t.SEMVER_SPEC_VERSION="2.0.0";var lA=256,u8=Number.MAX_SAFE_INTEGER||9007199254740991,CX=16,Hrt=lA-6,dA=$t.re=[],Fn=$t.safeRe=[],Ae=$t.src=[],Ar=0,kX="[a-zA-Z0-9-]",TX=[["\\s",1],["\\d",lA],[kX,Hrt]];function h8(t){for(var e=0;e<TX.length;e++){var r=TX[e][0],n=TX[e][1];t=t.split(r+"*").join(r+"{0,"+n+"}").split(r+"+").join(r+"{1,"+n+"}")}return t}var MT=Ar++;Ae[MT]="0|[1-9]\\d*";var FT=Ar++;Ae[FT]="\\d+";var PX=Ar++;Ae[PX]="\\d*[a-zA-Z-]"+kX+"*";var oTe=Ar++;Ae[oTe]="("+Ae[MT]+")\\.("+Ae[MT]+")\\.("+Ae[MT]+")";var sTe=Ar++;Ae[sTe]="("+Ae[FT]+")\\.("+Ae[FT]+")\\.("+Ae[FT]+")";var EX=Ar++;Ae[EX]="(?:"+Ae[MT]+"|"+Ae[PX]+")";var wX=Ar++;Ae[wX]="(?:"+Ae[FT]+"|"+Ae[PX]+")";var AX=Ar++;Ae[AX]="(?:-("+Ae[EX]+"(?:\\."+Ae[EX]+")*))";var DX=Ar++;Ae[DX]="(?:-?("+Ae[wX]+"(?:\\."+Ae[wX]+")*))";var RX=Ar++;Ae[RX]=kX+"+";var fA=Ar++;Ae[fA]="(?:\\+("+Ae[RX]+"(?:\\."+Ae[RX]+")*))";var NX=Ar++,aTe="v?"+Ae[oTe]+Ae[AX]+"?"+Ae[fA]+"?";Ae[NX]="^"+aTe+"$";var LX="[v=\\s]*"+Ae[sTe]+Ae[DX]+"?"+Ae[fA]+"?",OX=Ar++;Ae[OX]="^"+LX+"$";var HT=Ar++;Ae[HT]="((?:<|>)?=?)";var l8=Ar++;Ae[l8]=Ae[FT]+"|x|X|\\*";var d8=Ar++;Ae[d8]=Ae[MT]+"|x|X|\\*";var y_=Ar++;Ae[y_]="[v=\\s]*("+Ae[d8]+")(?:\\.("+Ae[d8]+")(?:\\.("+Ae[d8]+")(?:"+Ae[AX]+")?"+Ae[fA]+"?)?)?";var BT=Ar++;Ae[BT]="[v=\\s]*("+Ae[l8]+")(?:\\.("+Ae[l8]+")(?:\\.("+Ae[l8]+")(?:"+Ae[DX]+")?"+Ae[fA]+"?)?)?";var cTe=Ar++;Ae[cTe]="^"+Ae[HT]+"\\s*"+Ae[y_]+"$";var uTe=Ar++;Ae[uTe]="^"+Ae[HT]+"\\s*"+Ae[BT]+"$";var lTe=Ar++;Ae[lTe]="(?:^|[^\\d])(\\d{1,"+CX+"})(?:\\.(\\d{1,"+CX+"}))?(?:\\.(\\d{1,"+CX+"}))?(?:$|[^\\d])";var g8=Ar++;Ae[g8]="(?:~>?)";var qT=Ar++;Ae[qT]="(\\s*)"+Ae[g8]+"\\s+";dA[qT]=new RegExp(Ae[qT],"g");Fn[qT]=new RegExp(h8(Ae[qT]),"g");var Vrt="$1~",dTe=Ar++;Ae[dTe]="^"+Ae[g8]+Ae[y_]+"$";var pTe=Ar++;Ae[pTe]="^"+Ae[g8]+Ae[BT]+"$";var v8=Ar++;Ae[v8]="(?:\\^)";var jT=Ar++;Ae[jT]="(\\s*)"+Ae[v8]+"\\s+";dA[jT]=new RegExp(Ae[jT],"g");Fn[jT]=new RegExp(h8(Ae[jT]),"g");var Grt="$1^",fTe=Ar++;Ae[fTe]="^"+Ae[v8]+Ae[y_]+"$";var mTe=Ar++;Ae[mTe]="^"+Ae[v8]+Ae[BT]+"$";var MX=Ar++;Ae[MX]="^"+Ae[HT]+"\\s*("+LX+")$|^$";var FX=Ar++;Ae[FX]="^"+Ae[HT]+"\\s*("+aTe+")$|^$";var __=Ar++;Ae[__]="(\\s*)"+Ae[HT]+"\\s*("+LX+"|"+Ae[y_]+")";dA[__]=new RegExp(Ae[__],"g");Fn[__]=new RegExp(h8(Ae[__]),"g");var zrt="$1$2$3",hTe=Ar++;Ae[hTe]="^\\s*("+Ae[y_]+")\\s+-\\s+("+Ae[y_]+")\\s*$";var gTe=Ar++;Ae[gTe]="^\\s*("+Ae[BT]+")\\s+-\\s+("+Ae[BT]+")\\s*$";var vTe=Ar++;Ae[vTe]="(<|>)?=?\\s*\\*";for(Mp=0;Mp<Ar;Mp++)gn(Mp,Ae[Mp]),dA[Mp]||(dA[Mp]=new RegExp(Ae[Mp]),Fn[Mp]=new RegExp(h8(Ae[Mp])));var Mp;$t.parse=x_;function x_(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof Mr)return t;if(typeof t!="string"||t.length>lA)return null;var r=e.loose?Fn[OX]:Fn[NX];if(!r.test(t))return null;try{return new Mr(t,e)}catch{return null}}$t.valid=$rt;function $rt(t,e){var r=x_(t,e);return r?r.version:null}$t.clean=Wrt;function Wrt(t,e){var r=x_(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null}$t.SemVer=Mr;function Mr(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof Mr){if(t.loose===e.loose)return t;t=t.version}else if(typeof t!="string")throw new TypeError("Invalid Version: "+t);if(t.length>lA)throw new TypeError("version is longer than "+lA+" characters");if(!(this instanceof Mr))return new Mr(t,e);gn("SemVer",t,e),this.options=e,this.loose=!!e.loose;var r=t.trim().match(e.loose?Fn[OX]:Fn[NX]);if(!r)throw new TypeError("Invalid Version: "+t);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>u8||this.major<0)throw new TypeError("Invalid major version");if(this.minor>u8||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>u8||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(n){if(/^[0-9]+$/.test(n)){var o=+n;if(o>=0&&o<u8)return o}return n}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}Mr.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};Mr.prototype.toString=function(){return this.version};Mr.prototype.compare=function(t){return gn("SemVer.compare",this.version,this.options,t),t instanceof Mr||(t=new Mr(t,this.options)),this.compareMain(t)||this.comparePre(t)};Mr.prototype.compareMain=function(t){return t instanceof Mr||(t=new Mr(t,this.options)),UT(this.major,t.major)||UT(this.minor,t.minor)||UT(this.patch,t.patch)};Mr.prototype.comparePre=function(t){if(t instanceof Mr||(t=new Mr(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;var e=0;do{var r=this.prerelease[e],n=t.prerelease[e];if(gn("prerelease compare",e,r,n),r===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(r===void 0)return-1;if(r===n)continue;return UT(r,n)}while(++e)};Mr.prototype.inc=function(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)typeof this.prerelease[r]=="number"&&(this.prerelease[r]++,r=-2);r===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+t)}return this.format(),this.raw=this.version,this};$t.inc=Krt;function Krt(t,e,r,n){typeof r=="string"&&(n=r,r=void 0);try{return new Mr(t,r).inc(e,n).version}catch{return null}}$t.diff=Yrt;function Yrt(t,e){if(UX(t,e))return null;var r=x_(t),n=x_(e),o="";if(r.prerelease.length||n.prerelease.length){o="pre";var s="prerelease"}for(var a in r)if((a==="major"||a==="minor"||a==="patch")&&r[a]!==n[a])return o+a;return s}$t.compareIdentifiers=UT;var iTe=/^[0-9]+$/;function UT(t,e){var r=iTe.test(t),n=iTe.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1}$t.rcompareIdentifiers=Qrt;function Qrt(t,e){return UT(e,t)}$t.major=Xrt;function Xrt(t,e){return new Mr(t,e).major}$t.minor=Jrt;function Jrt(t,e){return new Mr(t,e).minor}$t.patch=Zrt;function Zrt(t,e){return new Mr(t,e).patch}$t.compare=Om;function Om(t,e,r){return new Mr(t,r).compare(new Mr(e,r))}$t.compareLoose=ent;function ent(t,e){return Om(t,e,!0)}$t.rcompare=tnt;function tnt(t,e,r){return Om(e,t,r)}$t.sort=rnt;function rnt(t,e){return t.sort(function(r,n){return $t.compare(r,n,e)})}$t.rsort=nnt;function nnt(t,e){return t.sort(function(r,n){return $t.rcompare(r,n,e)})}$t.gt=pA;function pA(t,e,r){return Om(t,e,r)>0}$t.lt=p8;function p8(t,e,r){return Om(t,e,r)<0}$t.eq=UX;function UX(t,e,r){return Om(t,e,r)===0}$t.neq=bTe;function bTe(t,e,r){return Om(t,e,r)!==0}$t.gte=BX;function BX(t,e,r){return Om(t,e,r)>=0}$t.lte=qX;function qX(t,e,r){return Om(t,e,r)<=0}$t.cmp=f8;function f8(t,e,r,n){switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return UX(t,r,n);case"!=":return bTe(t,r,n);case">":return pA(t,r,n);case">=":return BX(t,r,n);case"<":return p8(t,r,n);case"<=":return qX(t,r,n);default:throw new TypeError("Invalid operator: "+e)}}$t.Comparator=Qu;function Qu(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof Qu){if(t.loose===!!e.loose)return t;t=t.value}if(!(this instanceof Qu))return new Qu(t,e);t=t.trim().split(/\s+/).join(" "),gn("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===mA?this.value="":this.value=this.operator+this.semver.version,gn("comp",this)}var mA={};Qu.prototype.parse=function(t){var e=this.options.loose?Fn[MX]:Fn[FX],r=t.match(e);if(!r)throw new TypeError("Invalid comparator: "+t);this.operator=r[1],this.operator==="="&&(this.operator=""),r[2]?this.semver=new Mr(r[2],this.options.loose):this.semver=mA};Qu.prototype.toString=function(){return this.value};Qu.prototype.test=function(t){return gn("Comparator.test",t,this.options.loose),this.semver===mA?!0:(typeof t=="string"&&(t=new Mr(t,this.options)),f8(t,this.operator,this.semver,this.options))};Qu.prototype.intersects=function(t,e){if(!(t instanceof Qu))throw new TypeError("a Comparator is required");(!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1});var r;if(this.operator==="")return r=new mi(t.value,e),m8(this.value,r,e);if(t.operator==="")return r=new mi(this.value,e),m8(t.semver,r,e);var n=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">"),o=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<"),s=this.semver.version===t.semver.version,a=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<="),c=f8(this.semver,"<",t.semver,e)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<"),u=f8(this.semver,">",t.semver,e)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return n||o||s&&a||c||u};$t.Range=mi;function mi(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof mi)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new mi(t.raw,e);if(t instanceof Qu)return new mi(t.value,e);if(!(this instanceof mi))return new mi(t,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(r){return this.parseRange(r.trim())},this).filter(function(r){return r.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}mi.prototype.format=function(){return this.range=this.set.map(function(t){return t.join(" ").trim()}).join("||").trim(),this.range};mi.prototype.toString=function(){return this.range};mi.prototype.parseRange=function(t){var e=this.options.loose,r=e?Fn[gTe]:Fn[hTe];t=t.replace(r,fnt),gn("hyphen replace",t),t=t.replace(Fn[__],zrt),gn("comparator trim",t,Fn[__]),t=t.replace(Fn[qT],Vrt),t=t.replace(Fn[jT],Grt);var n=e?Fn[MX]:Fn[FX],o=t.split(" ").map(function(s){return ont(s,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(o=o.filter(function(s){return!!s.match(n)})),o=o.map(function(s){return new Qu(s,this.options)},this),o};mi.prototype.intersects=function(t,e){if(!(t instanceof mi))throw new TypeError("a Range is required");return this.set.some(function(r){return r.every(function(n){return t.set.some(function(o){return o.every(function(s){return n.intersects(s,e)})})})})};$t.toComparators=int;function int(t,e){return new mi(t,e).set.map(function(r){return r.map(function(n){return n.value}).join(" ").trim().split(" ")})}function ont(t,e){return gn("comp",t,e),t=cnt(t,e),gn("caret",t),t=snt(t,e),gn("tildes",t),t=lnt(t,e),gn("xrange",t),t=pnt(t,e),gn("stars",t),t}function Aa(t){return!t||t.toLowerCase()==="x"||t==="*"}function snt(t,e){return t.trim().split(/\s+/).map(function(r){return ant(r,e)}).join(" ")}function ant(t,e){var r=e.loose?Fn[pTe]:Fn[dTe];return t.replace(r,function(n,o,s,a,c){gn("tilde",t,n,o,s,a,c);var u;return Aa(o)?u="":Aa(s)?u=">="+o+".0.0 <"+(+o+1)+".0.0":Aa(a)?u=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0":c?(gn("replaceTilde pr",c),u=">="+o+"."+s+"."+a+"-"+c+" <"+o+"."+(+s+1)+".0"):u=">="+o+"."+s+"."+a+" <"+o+"."+(+s+1)+".0",gn("tilde return",u),u})}function cnt(t,e){return t.trim().split(/\s+/).map(function(r){return unt(r,e)}).join(" ")}function unt(t,e){gn("caret",t,e);var r=e.loose?Fn[mTe]:Fn[fTe];return t.replace(r,function(n,o,s,a,c){gn("caret",t,n,o,s,a,c);var u;return Aa(o)?u="":Aa(s)?u=">="+o+".0.0 <"+(+o+1)+".0.0":Aa(a)?o==="0"?u=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0":u=">="+o+"."+s+".0 <"+(+o+1)+".0.0":c?(gn("replaceCaret pr",c),o==="0"?s==="0"?u=">="+o+"."+s+"."+a+"-"+c+" <"+o+"."+s+"."+(+a+1):u=">="+o+"."+s+"."+a+"-"+c+" <"+o+"."+(+s+1)+".0":u=">="+o+"."+s+"."+a+"-"+c+" <"+(+o+1)+".0.0"):(gn("no pr"),o==="0"?s==="0"?u=">="+o+"."+s+"."+a+" <"+o+"."+s+"."+(+a+1):u=">="+o+"."+s+"."+a+" <"+o+"."+(+s+1)+".0":u=">="+o+"."+s+"."+a+" <"+(+o+1)+".0.0"),gn("caret return",u),u})}function lnt(t,e){return gn("replaceXRanges",t,e),t.split(/\s+/).map(function(r){return dnt(r,e)}).join(" ")}function dnt(t,e){t=t.trim();var r=e.loose?Fn[uTe]:Fn[cTe];return t.replace(r,function(n,o,s,a,c,u){gn("xRange",t,n,o,s,a,c,u);var l=Aa(s),d=l||Aa(a),p=d||Aa(c),f=p;return o==="="&&f&&(o=""),l?o===">"||o==="<"?n="<0.0.0":n="*":o&&f?(d&&(a=0),c=0,o===">"?(o=">=",d?(s=+s+1,a=0,c=0):(a=+a+1,c=0)):o==="<="&&(o="<",d?s=+s+1:a=+a+1),n=o+s+"."+a+"."+c):d?n=">="+s+".0.0 <"+(+s+1)+".0.0":p&&(n=">="+s+"."+a+".0 <"+s+"."+(+a+1)+".0"),gn("xRange return",n),n})}function pnt(t,e){return gn("replaceStars",t,e),t.trim().replace(Fn[vTe],"")}function fnt(t,e,r,n,o,s,a,c,u,l,d,p,f){return Aa(r)?e="":Aa(n)?e=">="+r+".0.0":Aa(o)?e=">="+r+"."+n+".0":e=">="+e,Aa(u)?c="":Aa(l)?c="<"+(+u+1)+".0.0":Aa(d)?c="<"+u+"."+(+l+1)+".0":p?c="<="+u+"."+l+"."+d+"-"+p:c="<="+c,(e+" "+c).trim()}mi.prototype.test=function(t){if(!t)return!1;typeof t=="string"&&(t=new Mr(t,this.options));for(var e=0;e<this.set.length;e++)if(mnt(this.set[e],t,this.options))return!0;return!1};function mnt(t,e,r){for(var n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(n=0;n<t.length;n++)if(gn(t[n].semver),t[n].semver!==mA&&t[n].semver.prerelease.length>0){var o=t[n].semver;if(o.major===e.major&&o.minor===e.minor&&o.patch===e.patch)return!0}return!1}return!0}$t.satisfies=m8;function m8(t,e,r){try{e=new mi(e,r)}catch{return!1}return e.test(t)}$t.maxSatisfying=hnt;function hnt(t,e,r){var n=null,o=null;try{var s=new mi(e,r)}catch{return null}return t.forEach(function(a){s.test(a)&&(!n||o.compare(a)===-1)&&(n=a,o=new Mr(n,r))}),n}$t.minSatisfying=gnt;function gnt(t,e,r){var n=null,o=null;try{var s=new mi(e,r)}catch{return null}return t.forEach(function(a){s.test(a)&&(!n||o.compare(a)===1)&&(n=a,o=new Mr(n,r))}),n}$t.minVersion=vnt;function vnt(t,e){t=new mi(t,e);var r=new Mr("0.0.0");if(t.test(r)||(r=new Mr("0.0.0-0"),t.test(r)))return r;r=null;for(var n=0;n<t.set.length;++n){var o=t.set[n];o.forEach(function(s){var a=new Mr(s.semver.version);switch(s.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!r||pA(r,a))&&(r=a);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+s.operator)}})}return r&&t.test(r)?r:null}$t.validRange=bnt;function bnt(t,e){try{return new mi(t,e).range||"*"}catch{return null}}$t.ltr=ynt;function ynt(t,e,r){return jX(t,e,"<",r)}$t.gtr=_nt;function _nt(t,e,r){return jX(t,e,">",r)}$t.outside=jX;function jX(t,e,r,n){t=new Mr(t,n),e=new mi(e,n);var o,s,a,c,u;switch(r){case">":o=pA,s=qX,a=p8,c=">",u=">=";break;case"<":o=p8,s=BX,a=pA,c="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(m8(t,e,n))return!1;for(var l=0;l<e.set.length;++l){var d=e.set[l],p=null,f=null;if(d.forEach(function(m){m.semver===mA&&(m=new Qu(">=0.0.0")),p=p||m,f=f||m,o(m.semver,p.semver,n)?p=m:a(m.semver,f.semver,n)&&(f=m)}),p.operator===c||p.operator===u||(!f.operator||f.operator===c)&&s(t,f.semver))return!1;if(f.operator===u&&a(t,f.semver))return!1}return!0}$t.prerelease=xnt;function xnt(t,e){var r=x_(t,e);return r&&r.prerelease.length?r.prerelease:null}$t.intersects=Snt;function Snt(t,e,r){return t=new mi(t,r),e=new mi(e,r),t.intersects(e)}$t.coerce=Int;function Int(t){if(t instanceof Mr)return t;if(typeof t!="string")return null;var e=t.match(Fn[lTe]);return e==null?null:x_(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}});var b8=O((iDr,ITe)=>{"use strict";function HX(t){return typeof t=="function"}var Da=console.error.bind(console);function hA(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function gA(t){t&&t.logger&&(HX(t.logger)?Da=t.logger:Da("new logger isn't a function, not replacing"))}function xTe(t,e,r){if(!t||!t[e]){Da("no original function "+e+" to wrap");return}if(!r){Da("no wrapper function"),Da(new Error().stack);return}if(!HX(t[e])||!HX(r)){Da("original object and wrapper must be functions");return}var n=t[e],o=r(n,e);return hA(o,"__original",n),hA(o,"__unwrap",function(){t[e]===o&&hA(t,e,n)}),hA(o,"__wrapped",!0),hA(t,e,o),o}function Cnt(t,e,r){if(t)Array.isArray(t)||(t=[t]);else{Da("must provide one or more modules to patch"),Da(new Error().stack);return}if(!(e&&Array.isArray(e))){Da("must provide one or more functions to wrap on modules");return}t.forEach(function(n){e.forEach(function(o){xTe(n,o,r)})})}function STe(t,e){if(!t||!t[e]){Da("no function to unwrap."),Da(new Error().stack);return}if(!t[e].__unwrap)Da("no original to unwrap to -- has "+e+" already been unwrapped?");else return t[e].__unwrap()}function Tnt(t,e){if(t)Array.isArray(t)||(t=[t]);else{Da("must provide one or more modules to patch"),Da(new Error().stack);return}if(!(e&&Array.isArray(e))){Da("must provide one or more functions to unwrap on modules");return}t.forEach(function(r){e.forEach(function(n){STe(r,n)})})}gA.wrap=xTe;gA.massWrap=Cnt;gA.unwrap=STe;gA.massUnwrap=Tnt;ITe.exports=gA});var x8=O((oDr,wTe)=>{"use strict";var TTe=b8(),VT=TTe.wrap,y8=TTe.unwrap,Mm="wrap@before";function _8(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function Ent(t,e){for(var r=e.length,n=0;n<r;n++){var o=e[n],s=t[Mm];if(typeof s=="function")s(o);else if(Array.isArray(s))for(var a=s.length,c=0;c<a;c++)s[c](o)}}function ETe(t,e){var r;return r=t._events&&t._events[e],Array.isArray(r)||(r?r=[r]:r=[]),r}function wnt(t,e,r){var n=ETe(t,e),o=n.filter(function(s){return r.indexOf(s)===-1});o.length>0&&Ent(t,o)}function CTe(t,e){if(t){var r=t;if(typeof t=="function")r=e(t);else if(Array.isArray(t)){r=[];for(var n=0;n<t.length;n++)r[n]=e(t[n])}return r}}wTe.exports=function(e,r,n){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!r)throw new Error("must have function to run on listener addition");if(!n)throw new Error("must have function to wrap listeners when emitting");function o(a){return function(u,l){var d=ETe(this,u).slice();try{var p=a.call(this,u,l);return wnt(this,u,d),p}finally{this.on.__wrapped||VT(this,"on",o),this.addListener.__wrapped||VT(this,"addListener",o)}}}function s(a){return function(u){if(!this._events||!this._events[u])return a.apply(this,arguments);var l=this._events[u];function d(p){return function(){this._events[u]=l;try{return p.apply(this,arguments)}finally{l=this._events[u],this._events[u]=CTe(l,n)}}}VT(this,"removeListener",d);try{return this._events[u]=CTe(l,n),a.apply(this,arguments)}finally{y8(this,"removeListener"),this._events[u]=l}}}e[Mm]?typeof e[Mm]=="function"?_8(e,Mm,[e[Mm],r]):Array.isArray(e[Mm])&&e[Mm].push(r):_8(e,Mm,r),e.__wrapped||(VT(e,"addListener",o),VT(e,"on",o),VT(e,"emit",s),_8(e,"__unwrap",function(){y8(e,"addListener"),y8(e,"on"),y8(e,"emit"),delete e[Mm],delete e.__wrapped}),_8(e,"__wrapped",!0))}});var ATe=O((sDr,PTe)=>{"use strict";var cn=require("util"),Fm=require("assert"),Rnt=x8(),Yn=require("async_hooks"),vA="cls@contexts",bA="error@context",hi=process.env.DEBUG_CLS_HOOKED,an=-1;PTe.exports={getNamespace:RTe,createNamespace:knt,destroyNamespace:kTe,reset:Pnt,ERROR_SYMBOL:bA};function Xu(t){this.name=t,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}Xu.prototype.set=function(e,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=r,hi){let n=" ".repeat(this._indent<0?0:this._indent);ti(n+"CONTEXT-SET KEY:"+e+"="+r+" in ns:"+this.name+" currentUid:"+an+" active:"+cn.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return r};Xu.prototype.get=function(e){if(!this.active){if(hi){let r=Yn.currentId(),n=Yn.triggerAsyncId(),o=" ".repeat(this._indent<0?0:this._indent);ti(`${o}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${an} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length}`)}return}if(hi){let r=Yn.executionAsyncId(),n=Yn.triggerAsyncId(),o=" ".repeat(this._indent<0?0:this._indent);ti(o+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+an+" active:"+cn.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),ti(`${o}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${an} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} active:${cn.inspect(this.active)}`)}return this.active[e]};Xu.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=an,hi){let r=Yn.executionAsyncId(),n=Yn.triggerAsyncId(),o=" ".repeat(this._indent<0?0:this._indent);ti(`${o}CONTEXT-CREATED Context: (${this.name}) currentUid:${an} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} context:${cn.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};Xu.prototype.run=function(e){let r=this.createContext();this.enter(r);try{if(hi){let n=Yn.triggerAsyncId(),o=Yn.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);ti(`${s}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${an} triggerId:${n} asyncHooksCurrentId:${o} len:${this._set.length} context:${cn.inspect(r)}`)}return e(r),r}catch(n){throw n&&(n[bA]=r),n}finally{if(hi){let n=Yn.triggerAsyncId(),o=Yn.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);ti(`${s}CONTEXT-RUN END: (${this.name}) currentUid:${an} triggerId:${n} asyncHooksCurrentId:${o} len:${this._set.length} ${cn.inspect(r)}`)}this.exit(r)}};Xu.prototype.runAndReturn=function(e){let r;return this.run(function(n){r=e(n)}),r};Xu.prototype.runPromise=function(e){let r=this.createContext();this.enter(r);let n=e(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return hi&&ti("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+an+" len:"+this._set.length+" "+cn.inspect(r)),n.then(o=>(hi&&ti("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+an+" len:"+this._set.length+" "+cn.inspect(r)),this.exit(r),o)).catch(o=>{throw o[bA]=r,hi&&ti("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+an+" len:"+this._set.length+" "+cn.inspect(r)),this.exit(r),o})};Xu.prototype.bind=function(e,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return e.apply(this,arguments)}catch(s){throw s&&(s[bA]=r),s}finally{n.exit(r)}}};Xu.prototype.enter=function(e){if(Fm.ok(e,"context must be provided for entering"),hi){let r=Yn.executionAsyncId(),n=Yn.triggerAsyncId(),o=" ".repeat(this._indent<0?0:this._indent);ti(`${o}CONTEXT-ENTER: (${this.name}) currentUid:${an} triggerId:${n} asyncHooksCurrentId:${r} len:${this._set.length} ${cn.inspect(e)}`)}this._set.push(this.active),this.active=e};Xu.prototype.exit=function(e){if(Fm.ok(e,"context must be provided for exiting"),hi){let n=Yn.executionAsyncId(),o=Yn.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);ti(`${s}CONTEXT-EXIT: (${this.name}) currentUid:${an} triggerId:${o} asyncHooksCurrentId:${n} len:${this._set.length} ${cn.inspect(e)}`)}if(this.active===e){Fm.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(e);r<0?(hi&&ti("??ERROR?? context exiting but not entered - ignoring: "+cn.inspect(e)),Fm.ok(r>=0,`context not currently entered; can't exit. 
`+cn.inspect(this)+`
`+cn.inspect(e))):(Fm.ok(r,"can't remove top context"),this._set.splice(r,1))};Xu.prototype.bindEmitter=function(e){Fm.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function o(a){a&&(a[vA]||(a[vA]=Object.create(null)),a[vA][n]={namespace:r,context:r.active})}function s(a){if(!(a&&a[vA]))return a;let c=a,u=a[vA];return Object.keys(u).forEach(function(l){let d=u[l];c=d.namespace.bind(c,d.context)}),c}Rnt(e,o,s)};Xu.prototype.fromException=function(e){return e[bA]};function RTe(t){return process.namespaces[t]}function knt(t){Fm.ok(t,"namespace must be given a name."),hi&&ti(`NS-CREATING NAMESPACE (${t})`);let e=new Xu(t);return e.id=an,Yn.createHook({init(n,o,s,a){if(an=Yn.executionAsyncId(),e.active){if(e._contexts.set(n,e.active),hi){let c=" ".repeat(e._indent<0?0:e._indent);ti(`${c}INIT [${o}] (${t}) asyncId:${n} currentUid:${an} triggerId:${s} active:${cn.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(an===0){let c=Yn.triggerAsyncId(),u=e._contexts.get(c);if(u){if(e._contexts.set(n,u),hi){let l=" ".repeat(e._indent<0?0:e._indent);ti(`${l}INIT USING CONTEXT FROM TRIGGERID [${o}] (${t}) asyncId:${n} currentUid:${an} triggerId:${c} active:${cn.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(hi){let l=" ".repeat(e._indent<0?0:e._indent);ti(`${l}INIT MISSING CONTEXT [${o}] (${t}) asyncId:${n} currentUid:${an} triggerId:${c} active:${cn.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}if(hi&&o==="PROMISE"){ti(cn.inspect(a,{showHidden:!0}));let c=a.parentId,u=" ".repeat(e._indent<0?0:e._indent);ti(`${u}INIT RESOURCE-PROMISE [${o}] (${t}) parentId:${c} asyncId:${n} currentUid:${an} triggerId:${s} active:${cn.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}},before(n){an=Yn.executionAsyncId();let o;if(o=e._contexts.get(n)||e._contexts.get(an),o){if(hi){let s=Yn.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);ti(`${a}BEFORE (${t}) asyncId:${n} currentUid:${an} triggerId:${s} active:${cn.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${cn.inspect(o)}`),e._indent+=2}e.enter(o)}else if(hi){let s=Yn.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);ti(`${a}BEFORE MISSING CONTEXT (${t}) asyncId:${n} currentUid:${an} triggerId:${s} active:${cn.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${cn.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(n){an=Yn.executionAsyncId();let o;if(o=e._contexts.get(n)||e._contexts.get(an),o){if(hi){let s=Yn.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);ti(`${a}AFTER (${t}) asyncId:${n} currentUid:${an} triggerId:${s} active:${cn.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${cn.inspect(o)}`)}e.exit(o)}else if(hi){let s=Yn.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);ti(`${a}AFTER MISSING CONTEXT (${t}) asyncId:${n} currentUid:${an} triggerId:${s} active:${cn.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${cn.inspect(o)}`)}},destroy(n){if(an=Yn.executionAsyncId(),hi){let o=Yn.triggerAsyncId(),s=" ".repeat(e._indent<0?0:e._indent);ti(`${s}DESTROY (${t}) currentUid:${an} asyncId:${n} triggerId:${o} active:${cn.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${cn.inspect(e._contexts.get(an))}`)}e._contexts.delete(n)}}).enable(),process.namespaces[t]=e,e}function kTe(t){let e=RTe(t);Fm.ok(e,`can't delete nonexistent namespace! "`+t+'"'),Fm.ok(e.id,"don't assign to process.namespaces directly! "+cn.inspect(e)),process.namespaces[t]=null}function Pnt(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){kTe(t)}),process.namespaces=Object.create(null)}process.namespaces={};function ti(...t){hi&&process._rawDebug(`${cn.format(...t)}`)}});var NTe=O((aDr,DTe)=>{"use strict";function Ant(){}DTe.exports=function(){let e=this._hooks,r=this._state,n=process.nextTick;process.nextTick=function(){if(!r.enabled)return n.apply(process,arguments);let o=new Array(arguments.length);for(let u=0;u<arguments.length;u++)o[u]=arguments[u];let s=o[0];if(typeof s!="function")throw new TypeError("callback is not a function");let a=new Ant,c=--r.counter;return e.init.call(a,c,0,null,null),o[0]=function(){e.pre.call(a,c);let u=!0;try{s.apply(this,arguments),u=!1}finally{u&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",function(){e.post.call(a,c,!0),e.destroy.call(null,c)})}e.post.call(a,c,!1),e.destroy.call(null,c)},n.apply(process,o)}}});var OTe=O((cDr,LTe)=>{"use strict";function Dnt(){}LTe.exports=function(){let e=this._hooks,r=this._state,n=global.Promise,o=n.prototype.then;n.prototype.then=u;function s(l,d,p,f){return typeof l!="function"?f?a(p):c(p):function(){e.pre.call(d,p);try{return l.apply(this,arguments)}finally{e.post.call(d,p,!1),e.destroy.call(null,p)}}}function a(l){return function(p){return e.destroy.call(null,l),p}}function c(l){return function(p){throw e.destroy.call(null,l),p}}function u(l,d){if(!r.enabled)return o.call(this,l,d);let p=new Dnt,f=--r.counter;return e.init.call(p,f,0,null,null),o.call(this,s(l,p,f,!0),s(d,p,f,!1))}}});var FTe=O((uDr,MTe)=>{"use strict";var Wc=require("timers");function Nnt(){}function Lnt(){}function Ont(){}var Mnt=new Map,Fnt=new Map,Unt=new Map,VX=null,GX=!1;MTe.exports=function(){zX(this._hooks,this._state,"setTimeout","clearTimeout",Nnt,Mnt,!0),zX(this._hooks,this._state,"setInterval","clearInterval",Lnt,Fnt,!1),zX(this._hooks,this._state,"setImmediate","clearImmediate",Ont,Unt,!0),global.setTimeout=Wc.setTimeout,global.setInterval=Wc.setInterval,global.setImmediate=Wc.setImmediate,global.clearTimeout=Wc.clearTimeout,global.clearInterval=Wc.clearInterval,global.clearImmediate=Wc.clearImmediate};function zX(t,e,r,n,o,s,a){let c=Wc[r],u=Wc[n];Wc[r]=function(){if(!e.enabled)return c.apply(Wc,arguments);let l=new Array(arguments.length);for(let h=0;h<arguments.length;h++)l[h]=arguments[h];let d=l[0];if(typeof d!="function")throw new TypeError('"callback" argument must be a function');let p=new o,f=--e.counter,m;return t.init.call(p,f,0,null,null),l[0]=function(){VX=m,t.pre.call(p,f);let h=!0;try{d.apply(this,arguments),h=!1}finally{h&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",function(){t.post.call(p,f,!0),s.delete(m),t.destroy.call(null,f)})}t.post.call(p,f,!1),VX=null,(a||GX)&&(GX=!1,s.delete(m),t.destroy.call(null,f))},m=c.apply(Wc,l),s.set(m,f),m},Wc[n]=function(l){if(VX===l&&l!==null)GX=!0;else if(s.has(l)){let d=s.get(l);s.delete(l),t.destroy.call(null,d)}u.apply(Wc,arguments)}}});var qTe=O((lDr,BTe)=>{"use strict";var _A=process.binding("async_wrap"),Bnt=_A.Providers.TIMERWRAP,UTe={nextTick:NTe(),promise:OTe(),timers:FTe()},yA=new Set;function qnt(){this.enabled=!1,this.counter=0}function $X(){let t=this.initFns=[],e=this.preFns=[],r=this.postFns=[],n=this.destroyFns=[];this.init=function(o,s,a,c){if(s===Bnt){yA.add(o);return}for(let u of t)u(o,this,s,a,c)},this.pre=function(o){if(!yA.has(o))for(let s of e)s(o,this)},this.post=function(o,s){if(!yA.has(o))for(let a of r)a(o,this,s)},this.destroy=function(o){if(yA.has(o)){yA.delete(o);return}for(let s of n)s(o)}}$X.prototype.add=function(t){t.init&&this.initFns.push(t.init),t.pre&&this.preFns.push(t.pre),t.post&&this.postFns.push(t.post),t.destroy&&this.destroyFns.push(t.destroy)};function S8(t,e){let r=t.indexOf(e);r!==-1&&t.splice(r,1)}$X.prototype.remove=function(t){t.init&&S8(this.initFns,t.init),t.pre&&S8(this.preFns,t.pre),t.post&&S8(this.postFns,t.post),t.destroy&&S8(this.destroyFns,t.destroy)};function xA(){this._state=new qnt,this._hooks=new $X,this.version=require("./package.json").version,this.providers=_A.Providers;for(let t of Object.keys(UTe))UTe[t].call(this);process.env.hasOwnProperty("NODE_ASYNC_HOOK_WARNING")&&console.warn("warning: you are using async-hook-jl which is unstable."),_A.setupHooks({init:this._hooks.init,pre:this._hooks.pre,post:this._hooks.post,destroy:this._hooks.destroy})}BTe.exports=xA;xA.prototype.addHooks=function(t){this._hooks.add(t)};xA.prototype.removeHooks=function(t){this._hooks.remove(t)};xA.prototype.enable=function(){this._state.enabled=!0,_A.enable()};xA.prototype.disable=function(){this._state.enabled=!1,_A.disable()}});var HTe=O((dDr,jTe)=>{function jnt(t){try{return Error.prototype.toString.call(t)}catch(e){try{return"<error: "+e+">"}catch{return"<error>"}}}jTe.exports=function(e,r){var n=[];n.push(jnt(e));for(var o=0;o<r.length;o++){var s=r[o],a;try{a=s.toString()}catch(c){try{a="<error: "+c+">"}catch{a="<error>"}}n.push("    at "+a)}return n.join(`
`)}});var $Te=O((pDr,zTe)=>{var I8=HTe();function GTe(){this.extend=new SA,this.filter=new SA,this.format=new IA,this.version=require("./package.json").version}var KX=!1;GTe.prototype.callSite=function t(e){e||(e={}),KX=!0;var r={};Error.captureStackTrace(r,t);var n=r.stack;return KX=!1,n=n.slice(e.slice||0),e.extend&&(n=this.extend._modify(r,n)),e.filter&&(n=this.filter._modify(r,n)),n};var r0=new GTe;function SA(){this._modifiers=[]}SA.prototype._modify=function(t,e){for(var r=0,n=this._modifiers.length;r<n;r++)e=this._modifiers[r](t,e);return e};SA.prototype.attach=function(t){this._modifiers.push(t)};SA.prototype.deattach=function(t){var e=this._modifiers.indexOf(t);return e===-1?!1:(this._modifiers.splice(e,1),!0)};function IA(){this._formater=I8,this._previous=void 0}IA.prototype.replace=function(t){t?this._formater=t:this.restore()};IA.prototype.restore=function(){this._formater=I8,this._previous=void 0};IA.prototype._backup=function(){this._previous=this._formater};IA.prototype._roolback=function(){this._previous===I8?this.replace(void 0):this.replace(this._previous),this._previous=void 0};Error.prepareStackTrace&&r0.format.replace(Error.prepareStackTrace);var WX=!1;function VTe(t,e){if(KX)return e;if(WX)return I8(t,e);var r=e.concat();r=r0.extend._modify(t,r),r=r0.filter._modify(t,r),r=r.slice(0,Error.stackTraceLimit),Object.isExtensible(t)&&Object.getOwnPropertyDescriptor(t,"callSite")===void 0&&(t.callSite={original:e,mutated:r}),WX=!0;var n=r0.format._formater(t,r);return WX=!1,n}Object.defineProperty(Error,"prepareStackTrace",{get:function(){return VTe},set:function(t){t===VTe?r0.format._roolback():(r0.format._backup(),r0.format.replace(t))}});function Hnt(){return this.stack,this.callSite}Object.defineProperty(Error.prototype,"callSite",{get:Hnt,set:function(t){Object.defineProperty(this,"callSite",{value:t,writable:!0,configurable:!0})},configurable:!0});zTe.exports=r0});var QX=O((fDr,YX)=>{if(global._stackChain)if(global._stackChain.version===require("./package.json").version)YX.exports=global._stackChain;else throw new Error("Conflicting version of stack-chain found");else YX.exports=global._stackChain=$Te()});var WTe=O((mDr,XX)=>{"use strict";var Vnt=qTe();if(global._asyncHook)if(global._asyncHook.version===require("./package.json").version)XX.exports=global._asyncHook;else throw new Error("Conflicting version of async-hook-jl found");else QX().filter.attach(function(e,r){return r.filter(function(n){let o=n.getFileName();return!(o&&o.slice(0,__dirname.length)===__dirname)})}),XX.exports=global._asyncHook=new Vnt});var ZTe=O((hDr,JTe)=>{"use strict";var Ki=require("util"),Um=require("assert"),Gnt=x8(),GT=WTe(),CA="cls@contexts",TA="error@context",YTe=[];for(let t in GT.providers)YTe[GT.providers[t]]=t;var Li=process.env.DEBUG_CLS_HOOKED,uo=-1;JTe.exports={getNamespace:QTe,createNamespace:znt,destroyNamespace:XTe,reset:$nt,ERROR_SYMBOL:TA};function Ju(t){this.name=t,this.active=null,this._set=[],this.id=null,this._contexts=new Map}Ju.prototype.set=function(e,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return Li&&Wi("    SETTING KEY:"+e+"="+r+" in ns:"+this.name+" uid:"+uo+" active:"+Ki.inspect(this.active,!0)),this.active[e]=r,r};Ju.prototype.get=function(e){if(!this.active){Li&&Wi("    GETTING KEY:"+e+"=undefined "+this.name+" uid:"+uo+" active:"+Ki.inspect(this.active,!0));return}return Li&&Wi("    GETTING KEY:"+e+"="+this.active[e]+" "+this.name+" uid:"+uo+" active:"+Ki.inspect(this.active,!0)),this.active[e]};Ju.prototype.createContext=function(){Li&&Wi("   CREATING Context: "+this.name+" uid:"+uo+" len:"+this._set.length+"  active:"+Ki.inspect(this.active,!0,2,!0));let e=Object.create(this.active?this.active:Object.prototype);return e._ns_name=this.name,e.id=uo,Li&&Wi("   CREATED Context: "+this.name+" uid:"+uo+" len:"+this._set.length+"  context:"+Ki.inspect(e,!0,2,!0)),e};Ju.prototype.run=function(e){let r=this.createContext();this.enter(r);try{return Li&&Wi(" BEFORE RUN: "+this.name+" uid:"+uo+" len:"+this._set.length+" "+Ki.inspect(r)),e(r),r}catch(n){throw n&&(n[TA]=r),n}finally{Li&&Wi(" AFTER RUN: "+this.name+" uid:"+uo+" len:"+this._set.length+" "+Ki.inspect(r)),this.exit(r)}};Ju.prototype.runAndReturn=function(e){var r;return this.run(function(n){r=e(n)}),r};Ju.prototype.runPromise=function(e){let r=this.createContext();this.enter(r);let n=e(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return Li&&Wi(" BEFORE runPromise: "+this.name+" uid:"+uo+" len:"+this._set.length+" "+Ki.inspect(r)),n.then(o=>(Li&&Wi(" AFTER runPromise: "+this.name+" uid:"+uo+" len:"+this._set.length+" "+Ki.inspect(r)),this.exit(r),o)).catch(o=>{throw o[TA]=r,Li&&Wi(" AFTER runPromise: "+this.name+" uid:"+uo+" len:"+this._set.length+" "+Ki.inspect(r)),this.exit(r),o})};Ju.prototype.bind=function(e,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return e.apply(this,arguments)}catch(s){throw s&&(s[TA]=r),s}finally{n.exit(r)}}};Ju.prototype.enter=function(e){Um.ok(e,"context must be provided for entering"),Li&&Wi("  ENTER "+this.name+" uid:"+uo+" len:"+this._set.length+" context: "+Ki.inspect(e)),this._set.push(this.active),this.active=e};Ju.prototype.exit=function(e){if(Um.ok(e,"context must be provided for exiting"),Li&&Wi("  EXIT "+this.name+" uid:"+uo+" len:"+this._set.length+" context: "+Ki.inspect(e)),this.active===e){Um.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(e);r<0?(Li&&Wi("??ERROR?? context exiting but not entered - ignoring: "+Ki.inspect(e)),Um.ok(r>=0,`context not currently entered; can't exit. 
`+Ki.inspect(this)+`
`+Ki.inspect(e))):(Um.ok(r,"can't remove top context"),this._set.splice(r,1))};Ju.prototype.bindEmitter=function(e){Um.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function o(a){a&&(a[CA]||(a[CA]=Object.create(null)),a[CA][n]={namespace:r,context:r.active})}function s(a){if(!(a&&a[CA]))return a;let c=a,u=a[CA];return Object.keys(u).forEach(function(l){let d=u[l];c=d.namespace.bind(c,d.context)}),c}Gnt(e,o,s)};Ju.prototype.fromException=function(e){return e[TA]};function QTe(t){return process.namespaces[t]}function znt(t){Um.ok(t,"namespace must be given a name."),Li&&Wi("CREATING NAMESPACE "+t);let e=new Ju(t);return e.id=uo,GT.addHooks({init(r,n,o,s,a){uo=r,s?(e._contexts.set(r,e._contexts.get(s)),Li&&Wi("PARENTID: "+t+" uid:"+r+" parent:"+s+" provider:"+o)):e._contexts.set(uo,e.active),Li&&Wi("INIT "+t+" uid:"+r+" parent:"+s+" provider:"+YTe[o]+" active:"+Ki.inspect(e.active,!0))},pre(r,n){uo=r;let o=e._contexts.get(r);o?(Li&&Wi(" PRE "+t+" uid:"+r+" handle:"+C8(n)+" context:"+Ki.inspect(o)),e.enter(o)):Li&&Wi(" PRE MISSING CONTEXT "+t+" uid:"+r+" handle:"+C8(n))},post(r,n){uo=r;let o=e._contexts.get(r);o?(Li&&Wi(" POST "+t+" uid:"+r+" handle:"+C8(n)+" context:"+Ki.inspect(o)),e.exit(o)):Li&&Wi(" POST MISSING CONTEXT "+t+" uid:"+r+" handle:"+C8(n))},destroy(r){uo=r,Li&&Wi("DESTROY "+t+" uid:"+r+" context:"+Ki.inspect(e._contexts.get(uo))+" active:"+Ki.inspect(e.active,!0)),e._contexts.delete(r)}}),process.namespaces[t]=e,e}function XTe(t){let e=QTe(t);Um.ok(e,`can't delete nonexistent namespace! "`+t+'"'),Um.ok(e.id,"don't assign to process.namespaces directly! "+Ki.inspect(e)),process.namespaces[t]=null}function $nt(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){XTe(t)}),process.namespaces=Object.create(null)}process.namespaces={};GT._state&&!GT._state.enabled&&GT.enable();function Wi(t){process.env.DEBUG&&process._rawDebug(t)}function C8(t){if(!t)return t;if(typeof t=="function")return t.name?t.name:(t.toString().trim().match(/^function\s*([^\s(]+)/)||[])[1];if(t.constructor&&t.constructor.name)return t.constructor.name}if(Li){JX=QX();for(KTe in JX.filter._modifiers)JX.filter.deattach(KTe)}var JX,KTe});var eEe=O((gDr,ZX)=>{"use strict";var Wnt=_Te();process&&Wnt.gte(process.versions.node,"8.0.0")?ZX.exports=ATe():ZX.exports=ZTe()});var vEe=O((Wt,gEe)=>{Wt=gEe.exports=Fr;var vn;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?vn=function(){var t=Array.prototype.slice.call(arguments,0);t.unshift("SEMVER"),console.log.apply(console,t)}:vn=function(){};Wt.SEMVER_SPEC_VERSION="2.0.0";var EA=256,T8=Number.MAX_SAFE_INTEGER||9007199254740991,eJ=16,Knt=EA-6,wA=Wt.re=[],Un=Wt.safeRe=[],De=Wt.src=[],Dr=0,oJ="[a-zA-Z0-9-]",tJ=[["\\s",1],["\\d",EA],[oJ,Knt]];function A8(t){for(var e=0;e<tJ.length;e++){var r=tJ[e][0],n=tJ[e][1];t=t.split(r+"*").join(r+"{0,"+n+"}").split(r+"+").join(r+"{1,"+n+"}")}return t}var zT=Dr++;De[zT]="0|[1-9]\\d*";var $T=Dr++;De[$T]="\\d+";var sJ=Dr++;De[sJ]="\\d*[a-zA-Z-]"+oJ+"*";var rEe=Dr++;De[rEe]="("+De[zT]+")\\.("+De[zT]+")\\.("+De[zT]+")";var nEe=Dr++;De[nEe]="("+De[$T]+")\\.("+De[$T]+")\\.("+De[$T]+")";var rJ=Dr++;De[rJ]="(?:"+De[zT]+"|"+De[sJ]+")";var nJ=Dr++;De[nJ]="(?:"+De[$T]+"|"+De[sJ]+")";var aJ=Dr++;De[aJ]="(?:-("+De[rJ]+"(?:\\."+De[rJ]+")*))";var cJ=Dr++;De[cJ]="(?:-?("+De[nJ]+"(?:\\."+De[nJ]+")*))";var iJ=Dr++;De[iJ]=oJ+"+";var kA=Dr++;De[kA]="(?:\\+("+De[iJ]+"(?:\\."+De[iJ]+")*))";var uJ=Dr++,iEe="v?"+De[rEe]+De[aJ]+"?"+De[kA]+"?";De[uJ]="^"+iEe+"$";var lJ="[v=\\s]*"+De[nEe]+De[cJ]+"?"+De[kA]+"?",dJ=Dr++;De[dJ]="^"+lJ+"$";var XT=Dr++;De[XT]="((?:<|>)?=?)";var E8=Dr++;De[E8]=De[$T]+"|x|X|\\*";var w8=Dr++;De[w8]=De[zT]+"|x|X|\\*";var S_=Dr++;De[S_]="[v=\\s]*("+De[w8]+")(?:\\.("+De[w8]+")(?:\\.("+De[w8]+")(?:"+De[aJ]+")?"+De[kA]+"?)?)?";var KT=Dr++;De[KT]="[v=\\s]*("+De[E8]+")(?:\\.("+De[E8]+")(?:\\.("+De[E8]+")(?:"+De[cJ]+")?"+De[kA]+"?)?)?";var oEe=Dr++;De[oEe]="^"+De[XT]+"\\s*"+De[S_]+"$";var sEe=Dr++;De[sEe]="^"+De[XT]+"\\s*"+De[KT]+"$";var aEe=Dr++;De[aEe]="(?:^|[^\\d])(\\d{1,"+eJ+"})(?:\\.(\\d{1,"+eJ+"}))?(?:\\.(\\d{1,"+eJ+"}))?(?:$|[^\\d])";var D8=Dr++;De[D8]="(?:~>?)";var YT=Dr++;De[YT]="(\\s*)"+De[D8]+"\\s+";wA[YT]=new RegExp(De[YT],"g");Un[YT]=new RegExp(A8(De[YT]),"g");var Ynt="$1~",cEe=Dr++;De[cEe]="^"+De[D8]+De[S_]+"$";var uEe=Dr++;De[uEe]="^"+De[D8]+De[KT]+"$";var N8=Dr++;De[N8]="(?:\\^)";var QT=Dr++;De[QT]="(\\s*)"+De[N8]+"\\s+";wA[QT]=new RegExp(De[QT],"g");Un[QT]=new RegExp(A8(De[QT]),"g");var Qnt="$1^",lEe=Dr++;De[lEe]="^"+De[N8]+De[S_]+"$";var dEe=Dr++;De[dEe]="^"+De[N8]+De[KT]+"$";var pJ=Dr++;De[pJ]="^"+De[XT]+"\\s*("+lJ+")$|^$";var fJ=Dr++;De[fJ]="^"+De[XT]+"\\s*("+iEe+")$|^$";var I_=Dr++;De[I_]="(\\s*)"+De[XT]+"\\s*("+lJ+"|"+De[S_]+")";wA[I_]=new RegExp(De[I_],"g");Un[I_]=new RegExp(A8(De[I_]),"g");var Xnt="$1$2$3",pEe=Dr++;De[pEe]="^\\s*("+De[S_]+")\\s+-\\s+("+De[S_]+")\\s*$";var fEe=Dr++;De[fEe]="^\\s*("+De[KT]+")\\s+-\\s+("+De[KT]+")\\s*$";var mEe=Dr++;De[mEe]="(<|>)?=?\\s*\\*";for(Fp=0;Fp<Dr;Fp++)vn(Fp,De[Fp]),wA[Fp]||(wA[Fp]=new RegExp(De[Fp]),Un[Fp]=new RegExp(A8(De[Fp])));var Fp;Wt.parse=C_;function C_(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof Fr)return t;if(typeof t!="string"||t.length>EA)return null;var r=e.loose?Un[dJ]:Un[uJ];if(!r.test(t))return null;try{return new Fr(t,e)}catch{return null}}Wt.valid=Jnt;function Jnt(t,e){var r=C_(t,e);return r?r.version:null}Wt.clean=Znt;function Znt(t,e){var r=C_(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null}Wt.SemVer=Fr;function Fr(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof Fr){if(t.loose===e.loose)return t;t=t.version}else if(typeof t!="string")throw new TypeError("Invalid Version: "+t);if(t.length>EA)throw new TypeError("version is longer than "+EA+" characters");if(!(this instanceof Fr))return new Fr(t,e);vn("SemVer",t,e),this.options=e,this.loose=!!e.loose;var r=t.trim().match(e.loose?Un[dJ]:Un[uJ]);if(!r)throw new TypeError("Invalid Version: "+t);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>T8||this.major<0)throw new TypeError("Invalid major version");if(this.minor>T8||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>T8||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(n){if(/^[0-9]+$/.test(n)){var o=+n;if(o>=0&&o<T8)return o}return n}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}Fr.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};Fr.prototype.toString=function(){return this.version};Fr.prototype.compare=function(t){return vn("SemVer.compare",this.version,this.options,t),t instanceof Fr||(t=new Fr(t,this.options)),this.compareMain(t)||this.comparePre(t)};Fr.prototype.compareMain=function(t){return t instanceof Fr||(t=new Fr(t,this.options)),WT(this.major,t.major)||WT(this.minor,t.minor)||WT(this.patch,t.patch)};Fr.prototype.comparePre=function(t){if(t instanceof Fr||(t=new Fr(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;var e=0;do{var r=this.prerelease[e],n=t.prerelease[e];if(vn("prerelease compare",e,r,n),r===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(r===void 0)return-1;if(r===n)continue;return WT(r,n)}while(++e)};Fr.prototype.inc=function(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)typeof this.prerelease[r]=="number"&&(this.prerelease[r]++,r=-2);r===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+t)}return this.format(),this.raw=this.version,this};Wt.inc=eit;function eit(t,e,r,n){typeof r=="string"&&(n=r,r=void 0);try{return new Fr(t,r).inc(e,n).version}catch{return null}}Wt.diff=tit;function tit(t,e){if(mJ(t,e))return null;var r=C_(t),n=C_(e),o="";if(r.prerelease.length||n.prerelease.length){o="pre";var s="prerelease"}for(var a in r)if((a==="major"||a==="minor"||a==="patch")&&r[a]!==n[a])return o+a;return s}Wt.compareIdentifiers=WT;var tEe=/^[0-9]+$/;function WT(t,e){var r=tEe.test(t),n=tEe.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1}Wt.rcompareIdentifiers=rit;function rit(t,e){return WT(e,t)}Wt.major=nit;function nit(t,e){return new Fr(t,e).major}Wt.minor=iit;function iit(t,e){return new Fr(t,e).minor}Wt.patch=oit;function oit(t,e){return new Fr(t,e).patch}Wt.compare=Bm;function Bm(t,e,r){return new Fr(t,r).compare(new Fr(e,r))}Wt.compareLoose=sit;function sit(t,e){return Bm(t,e,!0)}Wt.rcompare=ait;function ait(t,e,r){return Bm(e,t,r)}Wt.sort=cit;function cit(t,e){return t.sort(function(r,n){return Wt.compare(r,n,e)})}Wt.rsort=uit;function uit(t,e){return t.sort(function(r,n){return Wt.rcompare(r,n,e)})}Wt.gt=RA;function RA(t,e,r){return Bm(t,e,r)>0}Wt.lt=R8;function R8(t,e,r){return Bm(t,e,r)<0}Wt.eq=mJ;function mJ(t,e,r){return Bm(t,e,r)===0}Wt.neq=hEe;function hEe(t,e,r){return Bm(t,e,r)!==0}Wt.gte=hJ;function hJ(t,e,r){return Bm(t,e,r)>=0}Wt.lte=gJ;function gJ(t,e,r){return Bm(t,e,r)<=0}Wt.cmp=k8;function k8(t,e,r,n){switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return mJ(t,r,n);case"!=":return hEe(t,r,n);case">":return RA(t,r,n);case">=":return hJ(t,r,n);case"<":return R8(t,r,n);case"<=":return gJ(t,r,n);default:throw new TypeError("Invalid operator: "+e)}}Wt.Comparator=Zu;function Zu(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof Zu){if(t.loose===!!e.loose)return t;t=t.value}if(!(this instanceof Zu))return new Zu(t,e);t=t.trim().split(/\s+/).join(" "),vn("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===PA?this.value="":this.value=this.operator+this.semver.version,vn("comp",this)}var PA={};Zu.prototype.parse=function(t){var e=this.options.loose?Un[pJ]:Un[fJ],r=t.match(e);if(!r)throw new TypeError("Invalid comparator: "+t);this.operator=r[1],this.operator==="="&&(this.operator=""),r[2]?this.semver=new Fr(r[2],this.options.loose):this.semver=PA};Zu.prototype.toString=function(){return this.value};Zu.prototype.test=function(t){return vn("Comparator.test",t,this.options.loose),this.semver===PA?!0:(typeof t=="string"&&(t=new Fr(t,this.options)),k8(t,this.operator,this.semver,this.options))};Zu.prototype.intersects=function(t,e){if(!(t instanceof Zu))throw new TypeError("a Comparator is required");(!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1});var r;if(this.operator==="")return r=new gi(t.value,e),P8(this.value,r,e);if(t.operator==="")return r=new gi(this.value,e),P8(t.semver,r,e);var n=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">"),o=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<"),s=this.semver.version===t.semver.version,a=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<="),c=k8(this.semver,"<",t.semver,e)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<"),u=k8(this.semver,">",t.semver,e)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return n||o||s&&a||c||u};Wt.Range=gi;function gi(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof gi)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new gi(t.raw,e);if(t instanceof Zu)return new gi(t.value,e);if(!(this instanceof gi))return new gi(t,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(r){return this.parseRange(r.trim())},this).filter(function(r){return r.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}gi.prototype.format=function(){return this.range=this.set.map(function(t){return t.join(" ").trim()}).join("||").trim(),this.range};gi.prototype.toString=function(){return this.range};gi.prototype.parseRange=function(t){var e=this.options.loose,r=e?Un[fEe]:Un[pEe];t=t.replace(r,yit),vn("hyphen replace",t),t=t.replace(Un[I_],Xnt),vn("comparator trim",t,Un[I_]),t=t.replace(Un[YT],Ynt),t=t.replace(Un[QT],Qnt);var n=e?Un[pJ]:Un[fJ],o=t.split(" ").map(function(s){return dit(s,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(o=o.filter(function(s){return!!s.match(n)})),o=o.map(function(s){return new Zu(s,this.options)},this),o};gi.prototype.intersects=function(t,e){if(!(t instanceof gi))throw new TypeError("a Range is required");return this.set.some(function(r){return r.every(function(n){return t.set.some(function(o){return o.every(function(s){return n.intersects(s,e)})})})})};Wt.toComparators=lit;function lit(t,e){return new gi(t,e).set.map(function(r){return r.map(function(n){return n.value}).join(" ").trim().split(" ")})}function dit(t,e){return vn("comp",t,e),t=mit(t,e),vn("caret",t),t=pit(t,e),vn("tildes",t),t=git(t,e),vn("xrange",t),t=bit(t,e),vn("stars",t),t}function Na(t){return!t||t.toLowerCase()==="x"||t==="*"}function pit(t,e){return t.trim().split(/\s+/).map(function(r){return fit(r,e)}).join(" ")}function fit(t,e){var r=e.loose?Un[uEe]:Un[cEe];return t.replace(r,function(n,o,s,a,c){vn("tilde",t,n,o,s,a,c);var u;return Na(o)?u="":Na(s)?u=">="+o+".0.0 <"+(+o+1)+".0.0":Na(a)?u=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0":c?(vn("replaceTilde pr",c),u=">="+o+"."+s+"."+a+"-"+c+" <"+o+"."+(+s+1)+".0"):u=">="+o+"."+s+"."+a+" <"+o+"."+(+s+1)+".0",vn("tilde return",u),u})}function mit(t,e){return t.trim().split(/\s+/).map(function(r){return hit(r,e)}).join(" ")}function hit(t,e){vn("caret",t,e);var r=e.loose?Un[dEe]:Un[lEe];return t.replace(r,function(n,o,s,a,c){vn("caret",t,n,o,s,a,c);var u;return Na(o)?u="":Na(s)?u=">="+o+".0.0 <"+(+o+1)+".0.0":Na(a)?o==="0"?u=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0":u=">="+o+"."+s+".0 <"+(+o+1)+".0.0":c?(vn("replaceCaret pr",c),o==="0"?s==="0"?u=">="+o+"."+s+"."+a+"-"+c+" <"+o+"."+s+"."+(+a+1):u=">="+o+"."+s+"."+a+"-"+c+" <"+o+"."+(+s+1)+".0":u=">="+o+"."+s+"."+a+"-"+c+" <"+(+o+1)+".0.0"):(vn("no pr"),o==="0"?s==="0"?u=">="+o+"."+s+"."+a+" <"+o+"."+s+"."+(+a+1):u=">="+o+"."+s+"."+a+" <"+o+"."+(+s+1)+".0":u=">="+o+"."+s+"."+a+" <"+(+o+1)+".0.0"),vn("caret return",u),u})}function git(t,e){return vn("replaceXRanges",t,e),t.split(/\s+/).map(function(r){return vit(r,e)}).join(" ")}function vit(t,e){t=t.trim();var r=e.loose?Un[sEe]:Un[oEe];return t.replace(r,function(n,o,s,a,c,u){vn("xRange",t,n,o,s,a,c,u);var l=Na(s),d=l||Na(a),p=d||Na(c),f=p;return o==="="&&f&&(o=""),l?o===">"||o==="<"?n="<0.0.0":n="*":o&&f?(d&&(a=0),c=0,o===">"?(o=">=",d?(s=+s+1,a=0,c=0):(a=+a+1,c=0)):o==="<="&&(o="<",d?s=+s+1:a=+a+1),n=o+s+"."+a+"."+c):d?n=">="+s+".0.0 <"+(+s+1)+".0.0":p&&(n=">="+s+"."+a+".0 <"+s+"."+(+a+1)+".0"),vn("xRange return",n),n})}function bit(t,e){return vn("replaceStars",t,e),t.trim().replace(Un[mEe],"")}function yit(t,e,r,n,o,s,a,c,u,l,d,p,f){return Na(r)?e="":Na(n)?e=">="+r+".0.0":Na(o)?e=">="+r+"."+n+".0":e=">="+e,Na(u)?c="":Na(l)?c="<"+(+u+1)+".0.0":Na(d)?c="<"+u+"."+(+l+1)+".0":p?c="<="+u+"."+l+"."+d+"-"+p:c="<="+c,(e+" "+c).trim()}gi.prototype.test=function(t){if(!t)return!1;typeof t=="string"&&(t=new Fr(t,this.options));for(var e=0;e<this.set.length;e++)if(_it(this.set[e],t,this.options))return!0;return!1};function _it(t,e,r){for(var n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(n=0;n<t.length;n++)if(vn(t[n].semver),t[n].semver!==PA&&t[n].semver.prerelease.length>0){var o=t[n].semver;if(o.major===e.major&&o.minor===e.minor&&o.patch===e.patch)return!0}return!1}return!0}Wt.satisfies=P8;function P8(t,e,r){try{e=new gi(e,r)}catch{return!1}return e.test(t)}Wt.maxSatisfying=xit;function xit(t,e,r){var n=null,o=null;try{var s=new gi(e,r)}catch{return null}return t.forEach(function(a){s.test(a)&&(!n||o.compare(a)===-1)&&(n=a,o=new Fr(n,r))}),n}Wt.minSatisfying=Sit;function Sit(t,e,r){var n=null,o=null;try{var s=new gi(e,r)}catch{return null}return t.forEach(function(a){s.test(a)&&(!n||o.compare(a)===1)&&(n=a,o=new Fr(n,r))}),n}Wt.minVersion=Iit;function Iit(t,e){t=new gi(t,e);var r=new Fr("0.0.0");if(t.test(r)||(r=new Fr("0.0.0-0"),t.test(r)))return r;r=null;for(var n=0;n<t.set.length;++n){var o=t.set[n];o.forEach(function(s){var a=new Fr(s.semver.version);switch(s.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!r||RA(r,a))&&(r=a);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+s.operator)}})}return r&&t.test(r)?r:null}Wt.validRange=Cit;function Cit(t,e){try{return new gi(t,e).range||"*"}catch{return null}}Wt.ltr=Tit;function Tit(t,e,r){return vJ(t,e,"<",r)}Wt.gtr=Eit;function Eit(t,e,r){return vJ(t,e,">",r)}Wt.outside=vJ;function vJ(t,e,r,n){t=new Fr(t,n),e=new gi(e,n);var o,s,a,c,u;switch(r){case">":o=RA,s=gJ,a=R8,c=">",u=">=";break;case"<":o=R8,s=hJ,a=RA,c="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(P8(t,e,n))return!1;for(var l=0;l<e.set.length;++l){var d=e.set[l],p=null,f=null;if(d.forEach(function(m){m.semver===PA&&(m=new Zu(">=0.0.0")),p=p||m,f=f||m,o(m.semver,p.semver,n)?p=m:a(m.semver,f.semver,n)&&(f=m)}),p.operator===c||p.operator===u||(!f.operator||f.operator===c)&&s(t,f.semver))return!1;if(f.operator===u&&a(t,f.semver))return!1}return!0}Wt.prerelease=wit;function wit(t,e){var r=C_(t,e);return r&&r.prerelease.length?r.prerelease:null}Wt.intersects=Rit;function Rit(t,e,r){return t=new gi(t,r),e=new gi(e,r),t.intersects(e)}Wt.coerce=kit;function kit(t){if(t instanceof Fr)return t;if(typeof t!="string")return null;var e=t.match(Un[aEe]);return e==null?null:C_(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}});var _Ee=O((vDr,yEe)=>{var Pit=b8().wrap,yJ=1,_J=2,xJ=4,O8=8,Rn=[],Ait=0,Zs=!1,n0=[],JT,SJ;function IJ(t,e){var r=t.length,n=e.length,o=[];if(r===0&&n===0)return o;for(var s=0;s<r;s++)o[s]=t[s];if(n===0)return o;for(var a=0;a<n;a++){var c=!0;for(s=0;s<r;s++)if(t[s].uid===e[a].uid){c=!1;break}c&&o.push(e[a])}return o}process._fatalException?(L8=!1,JT=function(e){var r=Rn.length;if(L8||r===0)return!1;var n=!1;L8=!0;for(var o=0;o<r;++o){var s=Rn[o];if(s.flags&O8){var a=ZT&&ZT[s.uid];n=s.error(a,e)||n}}return L8=!1,n0.length>0&&(Rn=n0.pop()),ZT=void 0,n&&!Zs},SJ=function(e,r,n){var o=[];Zs=!0;for(var s=0;s<n;++s){var a=r[s];if(o[a.uid]=a.data,!!(a.flags&yJ)){var c=a.create(a.data);c!==void 0&&(o[a.uid]=c)}}return Zs=!1,function(){ZT=o,n0.push(Rn),Rn=IJ(r,Rn),Zs=!0;for(var u=0;u<n;++u)(r[u].flags&_J)>0&&r[u].before(this,o[r[u].uid]);Zs=!1;var l=e.apply(this,arguments);for(Zs=!0,u=0;u<n;++u)(r[u].flags&xJ)>0&&r[u].after(this,o[r[u].uid]);return Zs=!1,Rn=n0.pop(),ZT=void 0,l}},Pit(process,"_fatalException",function(t){return function(r){return JT(r)||t(r)}})):(bJ=!1,JT=function(e){if(bJ)throw e;for(var r=!1,n=Rn.length,o=0;o<n;++o){var s=Rn[o];s.flags&O8&&(r=s.error(null,e)||r)}if(!r&&Zs)throw e},SJ=function(e,r,n){var o=[];Zs=!0;for(var s=0;s<n;++s){var a=r[s];if(o[a.uid]=a.data,!!(a.flags&yJ)){var c=a.create(a.data);c!==void 0&&(o[a.uid]=c)}}return Zs=!1,function(){var u=!1,l=!1;n0.push(Rn),Rn=IJ(r,Rn),Zs=!0;for(var d=0;d<n;++d)(r[d].flags&_J)>0&&r[d].before(this,o[r[d].uid]);Zs=!1;var p;try{p=e.apply(this,arguments)}catch(f){u=!0;for(var d=0;d<n;++d)if(Rn[d].flags&O8)try{l=Rn[d].error(o[r[d].uid],f)||l}catch(h){throw bJ=!0,h}if(!l)throw process.removeListener("uncaughtException",JT),process._originalNextTick(function(){process.addListener("uncaughtException",JT)}),f}finally{if(!u||l){for(Zs=!0,d=0;d<n;++d)(r[d].flags&xJ)>0&&r[d].after(this,o[r[d].uid]);Zs=!1}Rn=n0.pop()}return p}},process.addListener("uncaughtException",JT));var L8,ZT,bJ;function Dit(t,e,r){Zs=!0;for(var n=0;n<r;++n){var o=e[n];o.create&&o.create(o.data)}return Zs=!1,function(){n0.push(Rn),Rn=IJ(e,Rn);var s=t.apply(this,arguments);return Rn=n0.pop(),s}}function Nit(t){var e=Rn.length;if(e===0)return t;for(var r=Rn.slice(),n=0;n<e;++n)if(r[n].flags>0)return SJ(t,r,e);return Dit(t,r,e)}function Up(t,e){typeof t.create=="function"&&(this.create=t.create,this.flags|=yJ),typeof t.before=="function"&&(this.before=t.before,this.flags|=_J),typeof t.after=="function"&&(this.after=t.after,this.flags|=xJ),typeof t.error=="function"&&(this.error=t.error,this.flags|=O8),this.uid=++Ait,this.data=e===void 0?null:e}Up.prototype.create=void 0;Up.prototype.before=void 0;Up.prototype.after=void 0;Up.prototype.error=void 0;Up.prototype.data=void 0;Up.prototype.uid=0;Up.prototype.flags=0;function bEe(t,e){if(typeof t!="object"||!t)throw new TypeError("callbacks argument must be an object");return t instanceof Up?t:new Up(t,e)}function Lit(t,e){var r;t instanceof Up?r=t:r=bEe(t,e);for(var n=!1,o=0;o<Rn.length;o++)if(r===Rn[o]){n=!0;break}return n||Rn.push(r),r}function Oit(t){for(var e=0;e<Rn.length;e++)if(t===Rn[e]){Rn.splice(e,1);break}}process.createAsyncListener=bEe;process.addAsyncListener=Lit;process.removeAsyncListener=Oit;yEe.exports=Nit});var SEe=O((yDr,xEe)=>{"use strict";xEe.exports=(t,e)=>class extends t{constructor(n){var o,s;super(c);var a=this;try{n.apply(o,s)}catch(u){s[1](u)}return a;function c(u,l){o=this,s=[d,p];function d(f){return e(a,!1),u(f)}function p(f){return e(a,!1),l(f)}}}}});var kEe=O(()=>{"use strict";if(process.addAsyncListener)throw new Error("Don't require polyfill unless needed");var EEe=b8(),F8=vEe(),ac=EEe.wrap,i0=EEe.massWrap,vi=_Ee(),Mit=require("util"),Fit=F8.gte(process.version,"6.0.0"),EJ=F8.gte(process.version,"7.0.0"),Uit=F8.gte(process.version,"8.0.0"),Bit=F8.gte(process.version,"11.0.0"),Bp=require("net");EJ&&!Bp._normalizeArgs?Bp._normalizeArgs=function(t){if(t.length===0)return[{},null];var e=t[0],r={};typeof e=="object"&&e!==null?r=e:Git(e)?r.path=e:(r.port=e,t.length>1&&typeof t[1]=="string"&&(r.host=t[1]));var n=t[t.length-1];return typeof n!="function"?[r,null]:[r,n]}:!EJ&&!Bp._normalizeConnectArgs&&(Bp._normalizeConnectArgs=function(t){var e={};function r(o){return(o=Number(o))>=0?o:!1}typeof t[0]=="object"&&t[0]!==null?e=t[0]:typeof t[0]=="string"&&r(t[0])===!1?e.path=t[0]:(e.port=t[0],typeof t[1]=="string"&&(e.host=t[1]));var n=t[t.length-1];return typeof n=="function"?[e,n]:[e]});"_setUpListenHandle"in Bp.Server.prototype?ac(Bp.Server.prototype,"_setUpListenHandle",IEe):ac(Bp.Server.prototype,"_listen2",IEe);function IEe(t){return function(){this.on("connection",function(e){e._handle&&(e._handle.onread=vi(e._handle.onread))});try{return t.apply(this,arguments)}finally{this._handle&&this._handle.onconnection&&(this._handle.onconnection=vi(this._handle.onconnection))}}}function wEe(t){if(t&&t._handle){var e=t._handle;e._originalOnread||(e._originalOnread=e.onread),e.onread=vi(e._originalOnread)}}ac(Bp.Socket.prototype,"connect",function(t){return function(){var e;Uit&&Array.isArray(arguments[0])&&Object.getOwnPropertySymbols(arguments[0]).length>0?e=arguments[0]:e=EJ?Bp._normalizeArgs(arguments):Bp._normalizeConnectArgs(arguments),e[1]&&(e[1]=vi(e[1]));var r=t.apply(this,e);return wEe(this),r}});var qit=require("http");ac(qit.Agent.prototype,"addRequest",function(t){return function(e){var r=e.onSocket;return e.onSocket=vi(function(n){return wEe(n),r.apply(this,arguments)}),t.apply(this,arguments)}});var CJ=require("child_process");function CEe(t){Array.isArray(t.stdio)&&t.stdio.forEach(function(e){e&&e._handle&&(e._handle.onread=vi(e._handle.onread),ac(e._handle,"close",U8))}),t._handle&&(t._handle.onexit=vi(t._handle.onexit))}CJ.ChildProcess?ac(CJ.ChildProcess.prototype,"spawn",function(t){return function(){var e=t.apply(this,arguments);return CEe(this),e}}):i0(CJ,["execFile","fork","spawn"],function(t){return function(){var e=t.apply(this,arguments);return CEe(e),e}});process._fatalException||(process._originalNextTick=process.nextTick);var kJ=[];process._nextDomainTick&&kJ.push("_nextDomainTick");process._tickDomainCallback&&kJ.push("_tickDomainCallback");i0(process,kJ,qp);ac(process,"nextTick",U8);var PJ=["setTimeout","setInterval"];global.setImmediate&&PJ.push("setImmediate");var REe=require("timers"),jit=global.setTimeout===REe.setTimeout;i0(REe,PJ,U8);jit&&i0(global,PJ,U8);var wJ=require("dns");i0(wJ,["lookup","resolve","resolve4","resolve6","resolveCname","resolveMx","resolveNs","resolveTxt","resolveSrv","reverse"],qp);wJ.resolveNaptr&&ac(wJ,"resolveNaptr",qp);var E_=require("fs");i0(E_,["watch","rename","truncate","chown","fchown","chmod","fchmod","stat","lstat","fstat","link","symlink","readlink","realpath","unlink","rmdir","mkdir","readdir","close","open","utimes","futimes","fsync","write","read","readFile","writeFile","appendFile","watchFile","unwatchFile","exists"],qp);E_.lchown&&ac(E_,"lchown",qp);E_.lchmod&&ac(E_,"lchmod",qp);E_.ftruncate&&ac(E_,"ftruncate",qp);var AA;try{AA=require("zlib")}catch{}AA&&AA.Deflate&&AA.Deflate.prototype&&(T_=Object.getPrototypeOf(AA.Deflate.prototype),T_._transform?ac(T_,"_transform",qp):T_.write&&T_.flush&&T_.end&&i0(T_,["write","flush","end"],qp));var T_,RJ;try{RJ=require("crypto")}catch{}RJ&&(TJ=["pbkdf2","randomBytes"],Bit||TJ.push("pseudoRandomBytes"),i0(RJ,TJ,qp));var TJ,M8=!!global.Promise&&Promise.toString()==="function Promise() { [native code] }"&&Promise.toString.toString()==="function toString() { [native code] }";M8&&(TEe=process.addAsyncListener({create:function(){M8=!1}}),global.Promise.resolve(!0).then(function(){M8=!1}),process.removeAsyncListener(TEe));var TEe;M8&&Hit();function Hit(){var t=global.Promise;function e(a){if(!(this instanceof e))return t(a);if(typeof a!="function")return new t(a);var c,u,l=new t(d);l.__proto__=e.prototype;try{a.apply(c,u)}catch(p){u[1](p)}return l;function d(p,f){c=this,u=[m,h];function m(g){return n(l,!1),p(g)}function h(g){return n(l,!1),f(g)}}}if(Mit.inherits(e,t),ac(t.prototype,"then",s),t.prototype.chain&&ac(t.prototype,"chain",s),Fit)global.Promise=SEe()(t,n);else{var r=["all","race","reject","resolve","accept","defer"];r.forEach(function(a){typeof t[a]=="function"&&(e[a]=t[a])}),global.Promise=e}function n(a,c){(!a.__asl_wrapper||c)&&(a.__asl_wrapper=vi(o))}function o(a,c,u,l){var d;try{return d=c.call(a,u),{returnVal:d,error:!1}}catch(p){return{errorVal:p,error:!0}}finally{d instanceof t?l.__asl_wrapper=function(){var f=d.__asl_wrapper||o;return f.apply(this,arguments)}:n(l,!0)}}function s(a){return function(){var u=this,l=a.apply(u,Array.prototype.map.call(arguments,d));return l.__asl_wrapper=function(f,m,h,g){return u.__asl_wrapper?(u.__asl_wrapper(f,function(){},null,l),l.__asl_wrapper(f,m,h,g)):o(f,m,h,g)},l;function d(p){return typeof p!="function"?p:vi(function(f){var m=(u.__asl_wrapper||o)(this,p,f,l);if(m.error)throw m.errorVal;return m.returnVal})}}}}function qp(t){var e=function(){var r,n=arguments.length-1;if(typeof arguments[n]=="function"){r=Array(arguments.length);for(var o=0;o<arguments.length-1;o++)r[o]=arguments[o];r[n]=vi(arguments[n])}return t.apply(this,r||arguments)};switch(t.length){case 1:return function(r){return arguments.length!==1?e.apply(this,arguments):(typeof r=="function"&&(r=vi(r)),t.call(this,r))};case 2:return function(r,n){return arguments.length!==2?e.apply(this,arguments):(typeof n=="function"&&(n=vi(n)),t.call(this,r,n))};case 3:return function(r,n,o){return arguments.length!==3?e.apply(this,arguments):(typeof o=="function"&&(o=vi(o)),t.call(this,r,n,o))};case 4:return function(r,n,o,s){return arguments.length!==4?e.apply(this,arguments):(typeof s=="function"&&(s=vi(s)),t.call(this,r,n,o,s))};case 5:return function(r,n,o,s,a){return arguments.length!==5?e.apply(this,arguments):(typeof a=="function"&&(a=vi(a)),t.call(this,r,n,o,s,a))};case 6:return function(r,n,o,s,a,c){return arguments.length!==6?e.apply(this,arguments):(typeof c=="function"&&(c=vi(c)),t.call(this,r,n,o,s,a,c))};default:return e}}function U8(t){var e=function(){var r;if(typeof arguments[0]=="function"){r=Array(arguments.length),r[0]=vi(arguments[0]);for(var n=1;n<arguments.length;n++)r[n]=arguments[n]}return t.apply(this,r||arguments)};switch(t.length){case 1:return function(r){return arguments.length!==1?e.apply(this,arguments):(typeof r=="function"&&(r=vi(r)),t.call(this,r))};case 2:return function(r,n){return arguments.length!==2?e.apply(this,arguments):(typeof r=="function"&&(r=vi(r)),t.call(this,r,n))};case 3:return function(r,n,o){return arguments.length!==3?e.apply(this,arguments):(typeof r=="function"&&(r=vi(r)),t.call(this,r,n,o))};case 4:return function(r,n,o,s){return arguments.length!==4?e.apply(this,arguments):(typeof r=="function"&&(r=vi(r)),t.call(this,r,n,o,s))};case 5:return function(r,n,o,s,a){return arguments.length!==5?e.apply(this,arguments):(typeof r=="function"&&(r=vi(r)),t.call(this,r,n,o,s,a))};case 6:return function(r,n,o,s,a,c){return arguments.length!==6?e.apply(this,arguments):(typeof r=="function"&&(r=vi(r)),t.call(this,r,n,o,s,a,c))};default:return e}}function Vit(t){return(t=Number(t))>=0?t:!1}function Git(t){return typeof t=="string"&&Vit(t)===!1}});var LEe=O((SDr,NEe)=>{"use strict";var qm=require("assert"),zit=x8(),DA="cls@contexts",AJ="error@context";process.addAsyncListener||kEe();function od(t){this.name=t,this.active=null,this._set=[],this.id=null}od.prototype.set=function(t,e){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return this.active[t]=e,e};od.prototype.get=function(t){if(this.active)return this.active[t]};od.prototype.createContext=function(){return Object.create(this.active)};od.prototype.run=function(t){var e=this.createContext();this.enter(e);try{return t(e),e}catch(r){throw r&&(r[AJ]=e),r}finally{this.exit(e)}};od.prototype.runAndReturn=function(t){var e;return this.run(function(r){e=t(r)}),e};od.prototype.bind=function(t,e){e||(this.active?e=this.active:e=this.createContext());var r=this;return function(){r.enter(e);try{return t.apply(this,arguments)}catch(n){throw n&&(n[AJ]=e),n}finally{r.exit(e)}}};od.prototype.enter=function(t){qm.ok(t,"context must be provided for entering"),this._set.push(this.active),this.active=t};od.prototype.exit=function(t){if(qm.ok(t,"context must be provided for exiting"),this.active===t){qm.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}var e=this._set.lastIndexOf(t);qm.ok(e>=0,"context not currently entered; can't exit"),qm.ok(e,"can't remove top context"),this._set.splice(e,1)};od.prototype.bindEmitter=function(t){qm.ok(t.on&&t.addListener&&t.emit,"can only bind real EEs");var e=this,r="context@"+this.name;function n(s){s&&(s[DA]||(s[DA]=Object.create(null)),s[DA][r]={namespace:e,context:e.active})}function o(s){if(!(s&&s[DA]))return s;var a=s,c=s[DA];return Object.keys(c).forEach(function(u){var l=c[u];a=l.namespace.bind(a,l.context)}),a}zit(t,n,o)};od.prototype.fromException=function(t){return t[AJ]};function PEe(t){return process.namespaces[t]}function $it(t){qm.ok(t,"namespace must be given a name!");var e=new od(t);return e.id=process.addAsyncListener({create:function(){return e.active},before:function(r,n){n&&e.enter(n)},after:function(r,n){n&&e.exit(n)},error:function(r){r&&e.exit(r)}}),process.namespaces[t]=e,e}function AEe(t){var e=PEe(t);qm.ok(e,"can't delete nonexistent namespace!"),qm.ok(e.id,"don't assign to process.namespaces directly!"),process.removeAsyncListener(e.id),process.namespaces[t]=null}function DEe(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){AEe(t)}),process.namespaces=Object.create(null)}process.namespaces||DEe();NEe.exports={getNamespace:PEe,createNamespace:$it,destroyNamespace:AEe,reset:DEe}});var o0=O(q8=>{"use strict";Object.defineProperty(q8,"__esModule",{value:!0});q8.CorrelationContextManager=void 0;var eE=Wn(),Wit=n8(),w_=i8(),DJ=nX(),OEe=IX(),B8=Is(),Kit=function(){function t(){}return t.getCurrentContext=function(){if(!t.enabled)return null;var e=t.session.get(t.CONTEXT_NAME);return e===void 0?null:e},t.generateContextObject=function(e,r,n,o,s,a){return r=r||e,this.enabled?{operation:{name:n,id:e,parentId:r,traceparent:s,tracestate:a},customProperties:new Yit(o)}:null},t.spanToContextObject=function(e,r,n){var o=new w_;return o.traceId=e.traceId,o.spanId=e.spanId,o.traceFlag=w_.formatOpenTelemetryTraceFlags(e.traceFlags)||w_.DEFAULT_TRACE_FLAG,o.parentId=r,t.generateContextObject(o.traceId,o.parentId,n,null,o)},t.runWithContext=function(e,r){var n;if(t.enabled)try{return t.session.bind(r,(n={},n[t.CONTEXT_NAME]=e,n))()}catch(o){eE.warn("Error binding to session context",B8.dumpObj(o))}return r()},t.wrapEmitter=function(e){if(t.enabled)try{t.session.bindEmitter(e)}catch(r){eE.warn("Error binding to session context",B8.dumpObj(r))}},t.wrapCallback=function(e,r){var n;if(t.enabled)try{return t.session.bind(e,r?(n={},n[t.CONTEXT_NAME]=r,n):void 0)}catch(o){eE.warn("Error binding to session context",B8.dumpObj(o))}return e},t.enable=function(e){if(!this.enabled){if(!this.isNodeVersionCompatible()){this.enabled=!1;return}t.hasEverEnabled||(this.forceClsHooked=e,this.hasEverEnabled=!0,typeof this.cls>"u"&&(t.forceClsHooked===!0||t.forceClsHooked===void 0&&t.shouldUseClsHooked()?this.cls=eEe():this.cls=LEe()),t.session=this.cls.createNamespace("AI-CLS-Session"),Wit.registerContextPreservation(function(r){try{return t.session.bind(r)}catch(n){eE.warn("Error binding to session context",B8.dumpObj(n))}})),this.enabled=!0}},t.startOperation=function(e,r){var n=e&&e.traceContext||null,o=e&&e.spanContext?e:null,s=e&&e.traceId?e:null,a=e&&e.headers;if(o)return this.spanToContextObject(o.spanContext(),o.parentSpanId,o.name);if(s)return this.spanToContextObject(s,"|"+s.traceId+"."+s.spanId+".",typeof r=="string"?r:"");var c=typeof r=="string"?r:"";if(n){var u=null,l=null;if(c=n.attributes.OperationName||c,r){var d=r;d.headers&&(d.headers.traceparent?u=new w_(d.headers.traceparent):d.headers["request-id"]&&(u=new w_(null,d.headers["request-id"])),d.headers.tracestate&&(l=new DJ(d.headers.tracestate)))}u||(u=new w_(n.traceParent||n.traceparent)),l||(l=new DJ(n.traceState||n.tracestate));var p=void 0;if(typeof r=="object"){var f=new OEe(r);p=f.getCorrelationContextHeader(),c=f.getOperationName({})}var m=t.generateContextObject(u.traceId,u.parentId,c,p,u,l);return m}if(a){var u=new w_(a.traceparent?a.traceparent.toString():null),l=new DJ(a.tracestate?a.tracestate.toString():null),f=new OEe(e),m=t.generateContextObject(u.traceId,u.parentId,f.getOperationName({}),f.getCorrelationContextHeader(),u,l);return m}return eE.warn("startOperation was called with invalid arguments",arguments),null},t.disable=function(){this.enabled=!1},t.reset=function(){t.hasEverEnabled&&(t.session=null,t.session=this.cls.createNamespace("AI-CLS-Session"))},t.isNodeVersionCompatible=function(){var e=process.versions.node.split(".");return parseInt(e[0])>3||parseInt(e[0])>2&&parseInt(e[1])>2},t.shouldUseClsHooked=function(){var e=process.versions.node.split(".");return parseInt(e[0])>8||parseInt(e[0])>=8&&parseInt(e[1])>=2},t.canUseClsHooked=function(){var e=process.versions.node.split("."),r=parseInt(e[0])>8||parseInt(e[0])>=8&&parseInt(e[1])>=0,n=parseInt(e[0])<8||parseInt(e[0])<=8&&parseInt(e[1])<2,o=parseInt(e[0])>4||parseInt(e[0])>=4&&parseInt(e[1])>=7;return!(r&&n)&&o},t.enabled=!1,t.hasEverEnabled=!1,t.forceClsHooked=void 0,t.CONTEXT_NAME="ApplicationInsights-Context",t}();q8.CorrelationContextManager=Kit;var Yit=function(){function t(e){this.props=[],this.addHeaderData(e)}return t.prototype.addHeaderData=function(e){var r=e?e.split(", "):[];this.props=r.map(function(n){var o=n.split("=");return{key:o[0],value:o[1]}}).concat(this.props)},t.prototype.serializeToHeader=function(){return this.props.map(function(e){return e.key+"="+e.value}).join(", ")},t.prototype.getProperty=function(e){for(var r=0;r<this.props.length;++r){var n=this.props[r];if(n.key===e)return n.value}},t.prototype.setProperty=function(e,r){if(t.bannedCharacters.test(e)||t.bannedCharacters.test(r)){eE.warn("Correlation context property keys and values must not contain ',' or '='. setProperty was called with key: "+e+" and value: "+r);return}for(var n=0;n<this.props.length;++n){var o=this.props[n];if(o.key===e){o.value=r;return}}this.props.push({key:e,value:r})},t.bannedCharacters=/[,=]/,t}()});var MEe=O(tE=>{"use strict";Object.defineProperty(tE,"__esModule",{value:!0});tE.dispose=tE.enable=void 0;var j8=Xs(),Qit=fi(),H8=Ni(),s0=[],NJ=function(t){var e=t.data.message;s0.forEach(function(r){e instanceof Error&&!r.config.enableLoggerErrorToTrace?r.trackException({exception:e}):e instanceof Error?r.trackTrace({message:e.toString(),severity:t.data.stderr?j8.SeverityLevel.Error:j8.SeverityLevel.Information}):(e.lastIndexOf(`
`)==e.length-1&&(e=e.substring(0,e.length-1)),r.trackTrace({message:e,severity:t.data.stderr?j8.SeverityLevel.Warning:j8.SeverityLevel.Information}))})};function Xit(t,e){if(t){var r=s0.find(function(n){return n==e});if(r)return;s0.length===0&&H8.channel.subscribe("console",NJ,H8.trueFilter,function(n,o){var s=e.getStatsbeat();s&&s.addInstrumentation(Qit.StatsbeatInstrumentation.CONSOLE)}),s0.push(e)}else s0=s0.filter(function(n){return n!=e}),s0.length===0&&H8.channel.unsubscribe("console",NJ)}tE.enable=Xit;function Jit(){H8.channel.unsubscribe("console",NJ),s0=[]}tE.dispose=Jit});var FEe=O(nE=>{"use strict";Object.defineProperty(nE,"__esModule",{value:!0});nE.dispose=nE.enable=void 0;var rE=Xs(),Zit=fi(),V8=Ni(),a0=[],eot={10:rE.SeverityLevel.Verbose,20:rE.SeverityLevel.Verbose,30:rE.SeverityLevel.Information,40:rE.SeverityLevel.Warning,50:rE.SeverityLevel.Error,60:rE.SeverityLevel.Critical},LJ=function(t){var e=t.data.result,r=eot[t.data.level];a0.forEach(function(n){try{var o=JSON.parse(e);if(o.err){var s=new Error(o.err.message);if(s.name=o.err.name,s.stack=o.err.stack,n.config.enableLoggerErrorToTrace){n.trackTrace({message:e,severity:r});return}n.trackException({exception:s});return}}catch{}n.trackTrace({message:e,severity:r})})};function tot(t,e){if(t){var r=a0.find(function(n){return n==e});if(r)return;a0.length===0&&V8.channel.subscribe("bunyan",LJ,V8.trueFilter,function(n,o){var s=e.getStatsbeat();s&&s.addInstrumentation(Zit.StatsbeatInstrumentation.BUNYAN)}),a0.push(e)}else a0=a0.filter(function(n){return n!=e}),a0.length===0&&V8.channel.unsubscribe("bunyan",LJ)}nE.enable=tot;function rot(){V8.channel.unsubscribe("bunyan",LJ),a0=[]}nE.dispose=rot});var UEe=O(iE=>{"use strict";Object.defineProperty(iE,"__esModule",{value:!0});iE.dispose=iE.enable=void 0;var not=fi(),Es=Xs(),G8=Ni(),c0=[],iot={syslog:function(t){var e={emerg:Es.SeverityLevel.Critical,alert:Es.SeverityLevel.Critical,crit:Es.SeverityLevel.Critical,error:Es.SeverityLevel.Error,warning:Es.SeverityLevel.Warning,notice:Es.SeverityLevel.Information,info:Es.SeverityLevel.Information,debug:Es.SeverityLevel.Verbose};return e[t]===void 0?Es.SeverityLevel.Information:e[t]},npm:function(t){var e={error:Es.SeverityLevel.Error,warn:Es.SeverityLevel.Warning,info:Es.SeverityLevel.Information,verbose:Es.SeverityLevel.Verbose,debug:Es.SeverityLevel.Verbose,silly:Es.SeverityLevel.Verbose};return e[t]===void 0?Es.SeverityLevel.Information:e[t]},unknown:function(t){return Es.SeverityLevel.Information}},OJ=function(t){var e=t.data.message,r=iot[t.data.levelKind](t.data.level);c0.forEach(function(n){e instanceof Error&&!n.config.enableLoggerErrorToTrace?n.trackException({exception:e,properties:t.data.meta}):e instanceof Error?n.trackTrace({message:e.toString(),severity:r,properties:t.data.meta}):n.trackTrace({message:e,severity:r,properties:t.data.meta})})};function oot(t,e){if(t){var r=c0.find(function(n){return n==e});if(r)return;c0.length===0&&G8.channel.subscribe("winston",OJ,G8.trueFilter,function(n,o){var s=e.getStatsbeat();s&&s.addInstrumentation(not.StatsbeatInstrumentation.WINSTON)}),c0.push(e)}else c0=c0.filter(function(n){return n!=e}),c0.length===0&&G8.channel.unsubscribe("winston",OJ)}iE.enable=oot;function sot(){G8.channel.unsubscribe("winston",OJ),c0=[]}iE.dispose=sot});var qEe=O((wDr,BEe)=>{"use strict";var aot=n8(),cot=function(){function t(e){if(t.INSTANCE)throw new Error("Console logging adapter tracking should be configured from the applicationInsights object");this._client=e,t.INSTANCE=this}return t.prototype.enable=function(e,r){aot.IsInitialized&&(MEe().enable(e&&r,this._client),FEe().enable(e,this._client),UEe().enable(e,this._client))},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1,!1)},t._methodNames=["debug","info","log","warn","error"],t}();BEe.exports=cot});var HEe=O((RDr,jEe)=>{"use strict";var uot=function(){function t(e){if(t.INSTANCE)throw new Error("Exception tracking should be configured from the applicationInsights object");t.INSTANCE=this,this._client=e;var r=process.versions.node.split(".");t._canUseUncaughtExceptionMonitor=parseInt(r[0])>13||parseInt(r[0])===13&&parseInt(r[1])>=7}return t.prototype.isInitialized=function(){return this._isInitialized},t.prototype.enable=function(e){var r=this;if(e){if(this._isInitialized=!0,!this._exceptionListenerHandle){var n=function(o,s,a){a===void 0&&(a=new Error(t._FALLBACK_ERROR_MESSAGE));var c={exception:a};c.contextObjects={},c.contextObjects.Error=a,r._client.trackException(c),r._client.flush({isAppCrashing:!0}),o&&s&&process.listeners(s).length===1&&(console.error(a),process.exit(1))};t._canUseUncaughtExceptionMonitor?(this._exceptionListenerHandle=n.bind(this,!1,void 0),process.on(t.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle)):(this._exceptionListenerHandle=n.bind(this,!0,t.UNCAUGHT_EXCEPTION_HANDLER_NAME),this._rejectionListenerHandle=n.bind(this,!1,void 0),process.on(t.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.on(t.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle))}}else this._exceptionListenerHandle&&(t._canUseUncaughtExceptionMonitor?process.removeListener(t.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle):(process.removeListener(t.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.removeListener(t.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle)),this._exceptionListenerHandle=void 0,this._rejectionListenerHandle=void 0,delete this._exceptionListenerHandle,delete this._rejectionListenerHandle)},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t.INSTANCE=null,t.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME="uncaughtExceptionMonitor",t.UNCAUGHT_EXCEPTION_HANDLER_NAME="uncaughtException",t.UNHANDLED_REJECTION_HANDLER_NAME="unhandledRejection",t._RETHROW_EXIT_MESSAGE="Application Insights Rethrow Exception Handler",t._FALLBACK_ERROR_MESSAGE="A promise was rejected without providing an error. Application Insights generated this error stack for you.",t._canUseUncaughtExceptionMonitor=!1,t}();jEe.exports=uot});var $8=O((kDr,VEe)=>{"use strict";var z8=require("os"),el=fi(),lot=function(){function t(e,r,n){r===void 0&&(r=6e4),n===void 0&&(n=!1),this._lastIntervalRequestExecutionTime=0,this._lastIntervalDependencyExecutionTime=0,t.INSTANCE||(t.INSTANCE=this),this._lastRequests={totalRequestCount:0,totalFailedRequestCount:0,time:0},this._lastDependencies={totalDependencyCount:0,totalFailedDependencyCount:0,time:0},this._lastExceptions={totalExceptionCount:0,time:0},this._isInitialized=!1,this._client=e,this._collectionInterval=r,this._enableLiveMetricsCounters=n}return t.prototype.enable=function(e,r){var n=this;this._isEnabled=e,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),e?this._handle||(this._lastCpus=z8.cpus(),this._lastRequests={totalRequestCount:t._totalRequestCount,totalFailedRequestCount:t._totalFailedRequestCount,time:+new Date},this._lastDependencies={totalDependencyCount:t._totalDependencyCount,totalFailedDependencyCount:t._totalFailedDependencyCount,time:+new Date},this._lastExceptions={totalExceptionCount:t._totalExceptionCount,time:+new Date},typeof process.cpuUsage=="function"&&(this._lastAppCpuUsage=process.cpuUsage()),this._lastHrtime=process.hrtime(),this._collectionInterval=r||this._collectionInterval,this._handle=setInterval(function(){return n.trackPerformance()},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=void 0)},t.countRequest=function(e,r){var n;if(t.isEnabled()){if(typeof e=="string")n=+new Date("1970-01-01T"+e+"Z");else if(typeof e=="number")n=e;else return;t._intervalRequestExecutionTime+=n,r===!1&&t._totalFailedRequestCount++,t._totalRequestCount++}},t.countException=function(){t._totalExceptionCount++},t.countDependency=function(e,r){var n;if(t.isEnabled()){if(typeof e=="string")n=+new Date("1970-01-01T"+e+"Z");else if(typeof e=="number")n=e;else return;t._intervalDependencyExecutionTime+=n,r===!1&&t._totalFailedDependencyCount++,t._totalDependencyCount++}},t.prototype.isInitialized=function(){return this._isInitialized},t.isEnabled=function(){return t.INSTANCE&&t.INSTANCE._isEnabled},t.prototype.trackPerformance=function(){this._trackCpu(),this._trackMemory(),this._trackNetwork(),this._trackDependencyRate(),this._trackExceptionRate()},t.prototype._trackCpu=function(){var e=z8.cpus();if(e&&e.length&&this._lastCpus&&e.length===this._lastCpus.length){for(var r=0,n=0,o=0,s=0,a=0,c=0;e&&c<e.length;c++){var u=e[c],l=this._lastCpus[c],d="% cpu("+c+") ",p=u.model,f=u.speed,m=u.times,h=l.times,g=m.user-h.user||0;r+=g;var v=m.sys-h.sys||0;n+=v;var y=m.nice-h.nice||0;o+=y;var _=m.idle-h.idle||0;s+=_;var x=m.irq-h.irq||0;a+=x}var S=void 0;if(typeof process.cpuUsage=="function"){var I=process.cpuUsage(),E=process.hrtime(),R=I.user-this._lastAppCpuUsage.user+(I.system-this._lastAppCpuUsage.system)||0;if(typeof this._lastHrtime<"u"&&this._lastHrtime.length===2){var B=(E[0]-this._lastHrtime[0])*1e6+(E[1]-this._lastHrtime[1])/1e3||0;S=100*R/(B*e.length)}this._lastAppCpuUsage=I,this._lastHrtime=E}var V=r+n+o+s+a||1;this._client.trackMetric({name:el.PerformanceCounter.PROCESSOR_TIME,value:(V-s)/V*100}),this._client.trackMetric({name:el.PerformanceCounter.PROCESS_TIME,value:S||r/V*100})}this._lastCpus=e},t.prototype._trackMemory=function(){var e=z8.freemem(),r=process.memoryUsage().rss,n=z8.totalmem()-e;this._client.trackMetric({name:el.PerformanceCounter.PRIVATE_BYTES,value:r}),this._client.trackMetric({name:el.PerformanceCounter.AVAILABLE_BYTES,value:e}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:el.QuickPulseCounter.COMMITTED_BYTES,value:n})},t.prototype._trackNetwork=function(){var e=this._lastRequests,r={totalRequestCount:t._totalRequestCount,totalFailedRequestCount:t._totalFailedRequestCount,time:+new Date},n=r.totalRequestCount-e.totalRequestCount||0,o=r.totalFailedRequestCount-e.totalFailedRequestCount||0,s=r.time-e.time,a=s/1e3,c=(t._intervalRequestExecutionTime-this._lastIntervalRequestExecutionTime)/n||0;if(this._lastIntervalRequestExecutionTime=t._intervalRequestExecutionTime,s>0){var u=n/a,l=o/a;this._client.trackMetric({name:el.PerformanceCounter.REQUEST_RATE,value:u}),(!this._enableLiveMetricsCounters||n>0)&&this._client.trackMetric({name:el.PerformanceCounter.REQUEST_DURATION,value:c}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:el.QuickPulseCounter.REQUEST_FAILURE_RATE,value:l})}this._lastRequests=r},t.prototype._trackDependencyRate=function(){if(this._enableLiveMetricsCounters){var e=this._lastDependencies,r={totalDependencyCount:t._totalDependencyCount,totalFailedDependencyCount:t._totalFailedDependencyCount,time:+new Date},n=r.totalDependencyCount-e.totalDependencyCount||0,o=r.totalFailedDependencyCount-e.totalFailedDependencyCount||0,s=r.time-e.time,a=s/1e3,c=(t._intervalDependencyExecutionTime-this._lastIntervalDependencyExecutionTime)/n||0;if(this._lastIntervalDependencyExecutionTime=t._intervalDependencyExecutionTime,s>0){var u=n/a,l=o/a;this._client.trackMetric({name:el.QuickPulseCounter.DEPENDENCY_RATE,value:u}),this._client.trackMetric({name:el.QuickPulseCounter.DEPENDENCY_FAILURE_RATE,value:l}),(!this._enableLiveMetricsCounters||n>0)&&this._client.trackMetric({name:el.QuickPulseCounter.DEPENDENCY_DURATION,value:c})}this._lastDependencies=r}},t.prototype._trackExceptionRate=function(){if(this._enableLiveMetricsCounters){var e=this._lastExceptions,r={totalExceptionCount:t._totalExceptionCount,time:+new Date},n=r.totalExceptionCount-e.totalExceptionCount||0,o=r.time-e.time,s=o/1e3;if(o>0){var a=n/s;this._client.trackMetric({name:el.QuickPulseCounter.EXCEPTION_RATE,value:a})}this._lastExceptions=r}},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t._totalRequestCount=0,t._totalFailedRequestCount=0,t._totalDependencyCount=0,t._totalFailedDependencyCount=0,t._totalExceptionCount=0,t._intervalDependencyExecutionTime=0,t._intervalRequestExecutionTime=0,t}();VEe.exports=lot});var GEe=O(W8=>{"use strict";Object.defineProperty(W8,"__esModule",{value:!0});W8.AggregatedMetricCounter=void 0;var dot=function(){function t(e){this.dimensions=e,this.totalCount=0,this.lastTotalCount=0,this.intervalExecutionTime=0,this.lastTime=+new Date,this.lastIntervalExecutionTime=0}return t}();W8.AggregatedMetricCounter=dot});var zEe=O(K8=>{"use strict";Object.defineProperty(K8,"__esModule",{value:!0});K8.PreaggregatedMetricPropertyNames=void 0;K8.PreaggregatedMetricPropertyNames={cloudRoleInstance:"cloud/roleInstance",cloudRoleName:"cloud/roleName",operationSynthetic:"operation/synthetic",requestSuccess:"Request.Success",requestResultCode:"request/resultCode",dependencyType:"Dependency.Type",dependencyTarget:"dependency/target",dependencySuccess:"Dependency.Success",dependencyResultCode:"dependency/resultCode",traceSeverityLevel:"trace/severityLevel"}});var FJ=O((MJ,$Ee)=>{"use strict";var Q8=MJ&&MJ.__assign||function(){return Q8=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Q8.apply(this,arguments)},Y8=fi(),pot=GEe(),fot=zEe(),mot=function(){function t(e,r){r===void 0&&(r=6e4),t.INSTANCE||(t.INSTANCE=this),this._isInitialized=!1,t._dependencyCountersCollection=[],t._requestCountersCollection=[],t._exceptionCountersCollection=[],t._traceCountersCollection=[],this._client=e,this._collectionInterval=r}return t.prototype.enable=function(e,r){var n=this;this._isEnabled=e,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),e?this._handle||(this._collectionInterval=r||this._collectionInterval,this._handle=setInterval(function(){return n.trackPreAggregatedMetrics()},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=void 0)},t.countException=function(e){if(t.isEnabled()){var r=t._getAggregatedCounter(e,this._exceptionCountersCollection);r.totalCount++}},t.countTrace=function(e){if(t.isEnabled()){var r=t._getAggregatedCounter(e,this._traceCountersCollection);r.totalCount++}},t.countRequest=function(e,r){if(t.isEnabled()){var n,o=t._getAggregatedCounter(r,this._requestCountersCollection);if(typeof e=="string")n=+new Date("1970-01-01T"+e+"Z");else if(typeof e=="number")n=e;else return;o.intervalExecutionTime+=n,o.totalCount++}},t.countDependency=function(e,r){if(t.isEnabled()){var n=t._getAggregatedCounter(r,this._dependencyCountersCollection),o;if(typeof e=="string")o=+new Date("1970-01-01T"+e+"Z");else if(typeof e=="number")o=e;else return;n.intervalExecutionTime+=o,n.totalCount++}},t.prototype.isInitialized=function(){return this._isInitialized},t.isEnabled=function(){return t.INSTANCE&&t.INSTANCE._isEnabled},t.prototype.trackPreAggregatedMetrics=function(){this._trackRequestMetrics(),this._trackDependencyMetrics(),this._trackExceptionMetrics(),this._trackTraceMetrics()},t._getAggregatedCounter=function(e,r){for(var n=!1,o=0;o<r.length;o++){if(e===r[o].dimensions)return r[o];if(Object.keys(e).length===Object.keys(r[o].dimensions).length){for(var s in e)if(e[s]!=r[o].dimensions[s]){n=!0;break}if(!n)return r[o];n=!1}}var a=new pot.AggregatedMetricCounter(e);return r.push(a),a},t.prototype._trackRequestMetrics=function(){for(var e=0;e<t._requestCountersCollection.length;e++){var r=t._requestCountersCollection[e];r.time=+new Date;var n=r.totalCount-r.lastTotalCount||0,o=r.time-r.lastTime,s=(r.intervalExecutionTime-r.lastIntervalExecutionTime)/n||0;r.lastIntervalExecutionTime=r.intervalExecutionTime,o>0&&n>0&&this._trackPreAggregatedMetric({name:"Server response time",dimensions:r.dimensions,value:s,count:n,aggregationInterval:o,metricType:Y8.MetricId.REQUESTS_DURATION}),r.lastTotalCount=r.totalCount,r.lastTime=r.time}},t.prototype._trackDependencyMetrics=function(){for(var e=0;e<t._dependencyCountersCollection.length;e++){var r=t._dependencyCountersCollection[e];r.time=+new Date;var n=r.totalCount-r.lastTotalCount||0,o=r.time-r.lastTime,s=(r.intervalExecutionTime-r.lastIntervalExecutionTime)/n||0;r.lastIntervalExecutionTime=r.intervalExecutionTime,o>0&&n>0&&this._trackPreAggregatedMetric({name:"Dependency duration",dimensions:r.dimensions,value:s,count:n,aggregationInterval:o,metricType:Y8.MetricId.DEPENDENCIES_DURATION}),r.lastTotalCount=r.totalCount,r.lastTime=r.time}},t.prototype._trackExceptionMetrics=function(){for(var e=0;e<t._exceptionCountersCollection.length;e++){var r=t._exceptionCountersCollection[e];r.time=+new Date;var n=r.totalCount-r.lastTotalCount||0,o=r.time-r.lastTime;o>0&&n>0&&this._trackPreAggregatedMetric({name:"Exceptions",dimensions:r.dimensions,value:n,count:n,aggregationInterval:o,metricType:Y8.MetricId.EXCEPTIONS_COUNT}),r.lastTotalCount=r.totalCount,r.lastTime=r.time}},t.prototype._trackTraceMetrics=function(){for(var e=0;e<t._traceCountersCollection.length;e++){var r=t._traceCountersCollection[e];r.time=+new Date;var n=r.totalCount-r.lastTotalCount||0,o=r.time-r.lastTime;o>0&&n>0&&this._trackPreAggregatedMetric({name:"Traces",dimensions:r.dimensions,value:n,count:n,aggregationInterval:o,metricType:Y8.MetricId.TRACES_COUNT}),r.lastTotalCount=r.totalCount,r.lastTime=r.time}},t.prototype._trackPreAggregatedMetric=function(e){var r={};for(var n in e.dimensions)r[fot.PreaggregatedMetricPropertyNames[n]]=e.dimensions[n];r=Q8(Q8({},r),{"_MS.MetricId":e.metricType,"_MS.AggregationIntervalMs":String(e.aggregationInterval),"_MS.IsAutocollected":"True"});var o={name:e.name,value:e.value,count:e.count,properties:r,kind:"Aggregation"};this._client.trackMetric(o)},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t}();$Ee.exports=mot});var oE=O((DDr,WEe)=>{"use strict";var jm=require("os"),hot=require("fs"),got=require("path"),vot=Xs(),bot=fi(),yot=Wn(),_ot=function(){function t(e){this.keys=new vot.ContextTagKeys,this.tags={},this._loadApplicationContext(e),this._loadDeviceContext(),this._loadInternalContext()}return t.prototype._loadApplicationContext=function(e){try{if(e=e||got.resolve(__dirname,"../../../../package.json"),!t.appVersion[e]){t.appVersion[e]="unknown";var r=JSON.parse(hot.readFileSync(e,"utf8"));r&&typeof r.version=="string"&&(t.appVersion[e]=r.version)}this.tags[this.keys.applicationVersion]=t.appVersion[e]}catch(n){yot.info("Failed to read app version: ",n)}},t.prototype._loadDeviceContext=function(){var e=jm&&jm.hostname(),r=t.DefaultRoleName;process.env.WEBSITE_SITE_NAME&&(r=process.env.WEBSITE_SITE_NAME),process.env.WEBSITE_INSTANCE_ID&&(e=process.env.WEBSITE_INSTANCE_ID),this.tags[this.keys.deviceId]="",this.tags[this.keys.cloudRoleInstance]=e,this.tags[this.keys.deviceOSVersion]=jm&&jm.type()+" "+jm.release(),this.tags[this.keys.cloudRole]=r,this.tags["ai.device.osArchitecture"]=jm&&jm.arch(),this.tags["ai.device.osPlatform"]=jm&&jm.platform()},t.prototype._loadInternalContext=function(){t.sdkVersion=bot.APPLICATION_INSIGHTS_SDK_VERSION,this.tags[this.keys.internalSdkVersion]="node:"+t.sdkVersion},t.DefaultRoleName="Web",t.appVersion={},t.sdkVersion=null,t}();WEe.exports=_ot});var QEe=O((NDr,YEe)=>{"use strict";var xot=require("crypto"),KEe=require("os"),Sot=fi(),Iot=oE(),Cot=function(){function t(e){this._collectionInterval=9e5,t.INSTANCE||(t.INSTANCE=this),this._isInitialized=!1,this._client=e}return t.prototype.enable=function(e){var r=this;this._isEnabled=e,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),e?this._handle||(this._handle=setInterval(function(){return r.trackHeartBeat(r._client.config,function(){})},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=null)},t.prototype.isInitialized=function(){return this._isInitialized},t.isEnabled=function(){return t.INSTANCE&&t.INSTANCE._isEnabled},t.prototype.trackHeartBeat=function(e,r){var n={},o=Iot.sdkVersion;n.sdkVersion=o,n.osType=KEe.type(),n.osVersion=KEe.release(),this._uniqueProcessId||(this._uniqueProcessId=xot.randomBytes(16).toString("hex")),n.processSessionId=this._uniqueProcessId,process.env.WEBSITE_SITE_NAME&&(n.appSrv_SiteName=process.env.WEBSITE_SITE_NAME),process.env.WEBSITE_HOME_STAMPNAME&&(n.appSrv_wsStamp=process.env.WEBSITE_HOME_STAMPNAME),process.env.WEBSITE_HOSTNAME&&(n.appSrv_wsHost=process.env.WEBSITE_HOSTNAME),process.env.WEBSITE_OWNER_NAME&&(n.appSrv_wsOwner=process.env.WEBSITE_OWNER_NAME),process.env.WEBSITE_RESOURCE_GROUP&&(n.appSrv_ResourceGroup=process.env.WEBSITE_RESOURCE_GROUP),process.env.WEBSITE_SLOT_NAME&&(n.appSrv_SlotName=process.env.WEBSITE_SLOT_NAME),this._client.trackMetric({name:Sot.HeartBeatMetricName,value:0,properties:n}),r()},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t}();YEe.exports=Cot});var XEe=O(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.isContentTypeHeaderHtml=Kt.insertSnippetByIndex=Kt.getContentEncodingFromHeaders=Kt.isSupportedContentEncoding=Kt.findBufferEncodingType=Kt.isBufferType=Kt.getBrotliDecompressSync=Kt.getBrotliDecompressAsync=Kt.getBrotliCompressSync=Kt.getBrotliCompressAsync=Kt.inflateAsync=Kt.deflateAsync=Kt.gunzipAsync=Kt.gzipAsync=Kt.isBrotliSupperted=Kt.bufferEncodingTypes=Kt.contentEncodingMethod=void 0;var J8=require("zlib"),sE=require("util"),X8;(function(t){t.GZIP="gzip",t.DEFLATE="deflate",t.BR="br"})(X8=Kt.contentEncodingMethod||(Kt.contentEncodingMethod={}));Kt.bufferEncodingTypes=["utf8","utf16le","latin1","base64","hex","ascii","binary","ucs2"];var Tot=function(){var t=process.versions.node.split(".")[0];return parseInt(t)>=10};Kt.isBrotliSupperted=Tot;Kt.gzipAsync=sE.promisify(J8.gzip);Kt.gunzipAsync=sE.promisify(J8.gunzip);Kt.deflateAsync=sE.promisify(J8.deflate);Kt.inflateAsync=sE.promisify(J8.inflate);var Eot=function(t){var e=Kt.isBrotliSupperted();return e&&typeof t.brotliCompress=="function"?sE.promisify(t.brotliCompress):null};Kt.getBrotliCompressAsync=Eot;var wot=function(t){var e=Kt.isBrotliSupperted();return e&&typeof t.brotliCompressSync=="function"?t.brotliCompressSync:null};Kt.getBrotliCompressSync=wot;var Rot=function(t){var e=Kt.isBrotliSupperted();return e&&typeof t.brotliDecompress=="function"?sE.promisify(t.brotliDecompress):null};Kt.getBrotliDecompressAsync=Rot;var kot=function(t){var e=Kt.isBrotliSupperted();return e&&typeof t.brotliDecompressSync=="function"?t.brotliDecompressSync:null};Kt.getBrotliDecompressSync=kot;var Pot=function(t,e){var r=e||"utf8",n=!1;if(Buffer.isEncoding(r)){var o=Buffer.from(t.toString(r),r);n=o.toJSON().data.toString()===t.toJSON().data.toString()}return n};Kt.isBufferType=Pot;var Aot=function(t){var e=null;for(var r in Kt.bufferEncodingTypes){var n=Kt.bufferEncodingTypes[r];if(Buffer.isEncoding(n)&&Kt.isBufferType(t,n)){e=n;break}}return e};Kt.findBufferEncodingType=Aot;var Dot=function(t){var e=null;switch(t){case"gzip":e=X8.GZIP;break;case"br":e=X8.BR;break;case"deflate":e=X8.DEFLATE;break;default:}return e};Kt.isSupportedContentEncoding=Dot;var Not=function(t){var e=[],r=t.getHeader("Content-Encoding");if(!r)return null;if(typeof r=="string"){var n=Kt.isSupportedContentEncoding(r);n&&e.push(n)}return e};Kt.getContentEncodingFromHeaders=Not;var Lot=function(t,e,r){if(t<0)return null;var n=null,o=e.substring(0,t),s=e.substring(t);return n=o+'<script type="text/javascript">'+r+"</script>"+s,n};Kt.insertSnippetByIndex=Lot;var Oot=function(t){var e=!1,r=t.getHeader("Content-Type");return r&&(typeof r=="string"?e=r.indexOf("html")>=0:e=r.toString().indexOf("html")>=0),e};Kt.isContentTypeHeaderHtml=Oot});var JEe=O(rs=>{"use strict";Object.defineProperty(rs,"__esModule",{value:!0});rs.getResourceProvider=rs.getOsPrefix=rs.isFunctionApp=rs.isWebApp=rs.isLinux=rs.isWindows=void 0;var Mot=function(){return process.platform==="win32"};rs.isWindows=Mot;var Fot=function(){return process.platform==="linux"};rs.isLinux=Fot;var Uot=function(){return!!process.env.WEBSITE_SITE_NAME};rs.isWebApp=Uot;var Bot=function(){return!!process.env.FUNCTIONS_WORKER_RUNTIME};rs.isFunctionApp=Bot;var qot=function(){return rs.isWindows()?"w":rs.isLinux()?"l":"u"};rs.getOsPrefix=qot;var jot=function(){return rs.isWebApp()?"a":rs.isFunctionApp()?"f":"u"};rs.getResourceProvider=jot});var UJ=O((MDr,ewe)=>{"use strict";var ZEe=fi(),Hot=function(){function t(){}return t.parse=function(e){if(!e)return{};var r=e.split(t._FIELDS_SEPARATOR),n=r.reduce(function(s,a){var c=a.split(t._FIELD_KEY_VALUE_SEPARATOR);if(c.length===2){var u=c[0].toLowerCase(),l=c[1];s[u]=l}return s},{});if(Object.keys(n).length>0){if(n.endpointsuffix){var o=n.location?n.location+".":"";n.ingestionendpoint=n.ingestionendpoint||"https://"+o+"dc."+n.endpointsuffix,n.liveendpoint=n.liveendpoint||"https://"+o+"live."+n.endpointsuffix}n.ingestionendpoint=n.ingestionendpoint||ZEe.DEFAULT_BREEZE_ENDPOINT,n.liveendpoint=n.liveendpoint||ZEe.DEFAULT_LIVEMETRICS_ENDPOINT}return n},t.isIkeyValid=function(e){if(!e||e=="")return!1;var r="^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",n=new RegExp(r);return n.test(e)},t._FIELDS_SEPARATOR=";",t._FIELD_KEY_VALUE_SEPARATOR="=",t}();ewe.exports=Hot});var twe={};_n(twe,{webSnippet:()=>Vot});var Vot,rwe=A(()=>{Vot=`!function(T,l,y){var S=T.location,k="script",D="instrumentationKey",C="ingestionendpoint",I="disableExceptionTracking",E="ai.device.",b="toLowerCase",w="crossOrigin",N="POST",e="appInsightsSDK",t=y.name||"appInsights";(y.name||T[e])&&(T[e]=t);var n=T[t]||function(d){var g=!1,f=!1,m={initialize:!0,queue:[],sv:"5",version:2,config:d};function v(e,t){var n={},a="Browser";return n[E+"id"]=a[b](),n[E+"type"]=a,n["ai.operation.name"]=S&&S.pathname||"_unknown_",n["ai.internal.sdkVersion"]="javascript:snippet_"+(m.sv||m.version),{time:function(){var e=new Date;function t(e){var t=""+e;return 1===t.length&&(t="0"+t),t}return e.getUTCFullYear()+"-"+t(1+e.getUTCMonth())+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+((e.getUTCMilliseconds()/1e3).toFixed(3)+"").slice(2,5)+"Z"}(),iKey:e,name:"Microsoft.ApplicationInsights."+e.replace(/-/g,"")+"."+t,sampleRate:100,tags:n,data:{baseData:{ver:2}}}}var h=d.url||y.src;if(h){function a(e){var t,n,a,i,r,o,s,c,u,p,l;g=!0,m.queue=[],f||(f=!0,t=h,s=function(){var e={},t=d.connectionString;if(t)for(var n=t.split(";"),a=0;a<n.length;a++){var i=n[a].split("=");2===i.length&&(e[i[0][b]()]=i[1])}if(!e[C]){var r=e.endpointsuffix,o=r?e.location:null;e[C]="https://"+(o?o+".":"")+"dc."+(r||"services.visualstudio.com")}return e}(),c=s[D]||d[D]||"",u=s[C],p=u?u+"/v2/track":d.endpointUrl,(l=[]).push((n="SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details)",a=t,i=p,(o=(r=v(c,"Exception")).data).baseType="ExceptionData",o.baseData.exceptions=[{typeName:"SDKLoadFailed",message:n.replace(/\\./g,"-"),hasFullStack:!1,stack:n+"\\nSnippet failed to load ["+a+"] -- Telemetry is disabled\\nHelp Link: https://go.microsoft.com/fwlink/?linkid=2128109\\nHost: "+(S&&S.pathname||"_unknown_")+"\\nEndpoint: "+i,parsedStack:[]}],r)),l.push(function(e,t,n,a){var i=v(c,"Message"),r=i.data;r.baseType="MessageData";var o=r.baseData;return o.message='AI (Internal): 99 message:"'+("SDK LOAD Failure: Failed to load Application Insights SDK script (See stack for details) ("+n+")").replace(/\\"/g,"")+'"',o.properties={endpoint:a},i}(0,0,t,p)),function(e,t){if(JSON){var n=T.fetch;if(n&&!y.useXhr)n(t,{method:N,body:JSON.stringify(e),mode:"cors"});else if(XMLHttpRequest){var a=new XMLHttpRequest;a.open(N,t),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(e))}}}(l,p))}function i(e,t){f||setTimeout(function(){!t&&m.core||a()},500)}var e=function(){var n=l.createElement(k);n.src=h;var e=y[w];return!e&&""!==e||"undefined"==n[w]||(n[w]=e),n.onload=i,n.onerror=a,n.onreadystatechange=function(e,t){"loaded"!==n.readyState&&"complete"!==n.readyState||i(0,t)},n}();y.ld<0?l.getElementsByTagName("head")[0].appendChild(e):setTimeout(function(){l.getElementsByTagName(k)[0].parentNode.appendChild(e)},y.ld||0)}try{m.cookie=l.cookie}catch(p){}function t(e){for(;e.length;)!function(t){m[t]=function(){var e=arguments;g||m.queue.push(function(){m[t].apply(m,e)})}}(e.pop())}var n="track",r="TrackPage",o="TrackEvent";t([n+"Event",n+"PageView",n+"Exception",n+"Trace",n+"DependencyData",n+"Metric",n+"PageViewPerformance","start"+r,"stop"+r,"start"+o,"stop"+o,"addTelemetryInitializer","setAuthenticatedUserContext","clearAuthenticatedUserContext","flush"]),m.SeverityLevel={Verbose:0,Information:1,Warning:2,Error:3,Critical:4};var s=(d.extensionConfig||{}).ApplicationInsightsAnalytics||{};if(!0!==d[I]&&!0!==s[I]){var c="onerror";t(["_"+c]);var u=T[c];T[c]=function(e,t,n,a,i){var r=u&&u(e,t,n,a,i);return!0!==r&&m["_"+c]({message:e,url:t,lineNumber:n,columnNumber:a,error:i}),r},d.autoExceptionInstrumented=!0}return m}(y.cfg);function a(){y.onInit&&y.onInit(n)}(T[t]=n).queue&&0===n.queue.length?(n.queue.push(a),n.trackPageView({})):a()}(window,document,{\r
src: "https://js.monitor.azure.com/scripts/b/ai.2.min.js", // The SDK URL Source\r
// name: "appInsights", // Global SDK Instance name defaults to "appInsights" when not supplied\r
// ld: 0, // Defines the load delay (in ms) before attempting to load the sdk. -1 = block page load and add to head. (default) = 0ms load after timeout,\r
// useXhr: 1, // Use XHR instead of fetch to report failures (if available),\r
// crossOrigin: "anonymous", // When supplied this will add the provided value as the cross origin attribute on the script tag\r
// onInit: null, // Once the application insights instance has loaded and initialized this callback function will be called with 1 argument -- the sdk instance (DO NOT ADD anything to the sdk.queue -- As they won't get called)\r
cfg: { // Application Insights Configuration\r
    instrumentationKey: "INSTRUMENTATION_KEY"\r
}});`});var cwe=O((FDr,awe)=>{"use strict";var nwe=require("http"),iwe=require("https"),aE=require("zlib"),jp=Wn(),tl=XEe(),owe=JEe(),NA=fi(),swe=UJ(),Got=(rwe(),eo(twe)),zot=function(){function t(e){var r;if(this._isIkeyValid=!0,t.INSTANCE)throw new Error("Web snippet injection should be configured from the applicationInsights object");t.INSTANCE=this,t._aiUrl=NA.WEB_INSTRUMENTATION_DEFAULT_SOURCE,t._aiDeprecatedUrl=NA.WEB_INSTRUMENTATION_DEPRECATED_SOURCE;var n=this._getWebSnippetIkey((r=e.config)===null||r===void 0?void 0:r.webInstrumentationConnectionString);this._webInstrumentationIkey=n||e.config.instrumentationKey,this._clientWebInstrumentationConfig=e.config.webInstrumentationConfig,this._clientWebInstrumentationSrc=e.config.webInstrumentationSrc,this._statsbeat=e.getStatsbeat()}return t.prototype.enable=function(e,r){this._isEnabled=e,this._webInstrumentationIkey=this._getWebSnippetIkey(r)||this._webInstrumentationIkey,t._snippet=this._getWebInstrumentationReplacedStr(),this._isEnabled&&!this._isInitialized&&this._isIkeyValid?(this._statsbeat&&this._statsbeat.addFeature(NA.StatsbeatFeature.WEB_SNIPPET),this._initialize()):this._isEnabled||this._statsbeat&&this._statsbeat.removeFeature(NA.StatsbeatFeature.WEB_SNIPPET)},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype._getWebSnippetIkey=function(e){var r=null;try{var n=swe.parse(e),o=n.instrumentationkey||"";swe.isIkeyValid(o)?(this._isIkeyValid=!0,r=o):(this._isIkeyValid=!1,jp.info("Invalid web Instrumentation connection string, web Instrumentation is not enabled."))}catch(s){jp.info("get web snippet ikey error: "+s)}return r},t.prototype._getWebInstrumentationReplacedStr=function(){var e=this._getClientWebInstrumentationConfigStr(this._clientWebInstrumentationConfig),r=owe.getOsPrefix(),n=owe.getResourceProvider(),o=this._webInstrumentationIkey+`",\r
`+e+` disableIkeyDeprecationMessage: true,\r
 sdkExtension: "`+n+r+"d_n_",s=Got.webSnippet.replace("INSTRUMENTATION_KEY",o);return this._clientWebInstrumentationSrc?s.replace(NA.WEB_INSTRUMENTATION_DEFAULT_SOURCE+".2.min.js",this._clientWebInstrumentationSrc):s},t.prototype._getClientWebInstrumentationConfigStr=function(e){var r="";try{e!=null&&e.length>0&&e.forEach(function(n){var o=n.name;if(o!==void 0){var s=n.value,a="";switch(typeof s){case"function":break;case"object":break;case"string":a=" "+o+': "'+s+`",\r
`,r+=a;break;default:a=" "+o+": "+s+`,\r
`,r+=a;break}}})}catch{this._isEnabled=!1,jp.info("Parse client web instrumentation error. Web Instrumentation is disabled")}return r},t.prototype._initialize=function(){this._isInitialized=!0;var e=nwe.createServer,r=iwe.createServer,n=this._isEnabled;nwe.createServer=function(o){var s=o;return s&&(o=function(a,c){var u=c.write,l=a.method=="GET";c.write=function(f,m,h){try{if(n&&l){var g=tl.getContentEncodingFromHeaders(c),v=void 0;if(typeof m=="string"&&(v=m),g==null)t.INSTANCE.ValidateInjection(c,f)&&(arguments[0]=t.INSTANCE.InjectWebSnippet(c,f,void 0,v));else if(g.length){var y=g[0];arguments[0]=t.INSTANCE.InjectWebSnippet(c,f,y)}}}catch(_){jp.warn("Inject snippet error: "+_)}return u.apply(c,arguments)};var d=c.end;return c.end=function(f,m,h){if(n&&l)try{if(n&&l){var g=tl.getContentEncodingFromHeaders(c),v=void 0;if(typeof m=="string"&&(v=m),g==null)t.INSTANCE.ValidateInjection(c,f)&&(arguments[0]=t.INSTANCE.InjectWebSnippet(c,f,void 0,v));else if(g.length){var y=g[0];arguments[0]=t.INSTANCE.InjectWebSnippet(c,f,y)}}}catch(_){jp.warn("Inject snipet error: "+_)}return d.apply(c,arguments)},s(a,c)}),e(o)},iwe.createServer=function(o,s){var a=s;if(a)return s=function(c,u){var l=c.method=="GET",d=u.write,p=u.end;return u.write=function(m,h,g){try{if(n&&l){var v=tl.getContentEncodingFromHeaders(u),y=void 0;if(typeof h=="string"&&(y=h),v==null)t.INSTANCE.ValidateInjection(u,m)&&(arguments[0]=this.InjectWebSnippet(u,m,void 0,y));else if(v.length){var _=v[0];arguments[0]=t.INSTANCE.InjectWebSnippet(u,m,_)}}}catch(x){jp.warn("Inject snippet error: "+x)}return d.apply(u,arguments)},u.end=function(m,h,g){try{if(n&&l){var v=tl.getContentEncodingFromHeaders(u),y=void 0;if(typeof h=="string"&&(y=h),v==null)t.INSTANCE.ValidateInjection(u,m)&&(arguments[0]=t.INSTANCE.InjectWebSnippet(u,m,void 0,y));else if(v.length){var _=v[0];arguments[0]=t.INSTANCE.InjectWebSnippet(u,m,_)}}}catch(x){jp.warn("Inject snippet error: "+x)}return p.apply(u,arguments)},a(c,u)},r(o,s)}},t.prototype.ValidateInjection=function(e,r){try{if(!e||!r||e.statusCode!=200)return!1;var n=tl.isContentTypeHeaderHtml(e);if(!n)return!1;var o=r.slice().toString();if(o.indexOf("<head>")>=0&&o.indexOf("</head>")>=0&&o.indexOf(t._aiUrl)<0&&o.indexOf(t._aiDeprecatedUrl)<0)return!0}catch(s){jp.info("validate injections error: "+s)}return!1},t.prototype.InjectWebSnippet=function(e,r,n,o){try{var s=!!n;if(s)e.removeHeader("Content-Length"),r=this._getInjectedCompressBuffer(e,r,n),e.setHeader("Content-Length",r.length);else{var a=r.toString(),c=a.indexOf("</head>");if(c<0)return r;var u=tl.insertSnippetByIndex(c,a,t._snippet);if(typeof r=="string")e.removeHeader("Content-Length"),r=u,e.setHeader("Content-Length",Buffer.byteLength(r));else if(Buffer.isBuffer(r)){var l=o||"utf8",d=tl.isBufferType(r,l);if(d){e.removeHeader("Content-Length");var p=Buffer.from(u).toString(l);r=Buffer.from(p,l),e.setHeader("Content-Length",r.length)}}}}catch(f){jp.warn("Failed to inject web snippet and change content-lenght headers. Exception:"+f)}return r},t.prototype._getInjectedCompressBuffer=function(e,r,n){try{switch(n){case tl.contentEncodingMethod.GZIP:var o=aE.gunzipSync(r);if(this.ValidateInjection(e,o)){var s=this.InjectWebSnippet(e,o);r=aE.gzipSync(s)}break;case tl.contentEncodingMethod.DEFLATE:var a=aE.inflateSync(r);if(this.ValidateInjection(e,a)){var c=this.InjectWebSnippet(e,a);r=aE.deflateSync(c)}break;case tl.contentEncodingMethod.BR:var u=tl.getBrotliDecompressSync(aE),l=tl.getBrotliCompressSync(aE);if(u&&l){var d=u(r);if(this.ValidateInjection(e,d)){var p=this.InjectWebSnippet(e,d);r=l(p)}break}}}catch(f){jp.info("get web injection compress buffer error: "+f)}return r},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t}();awe.exports=zot});var lwe=O((qJ,uwe)=>{"use strict";var $ot=qJ&&qJ.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),rl=require("url"),BJ=Xs(),Wot=Is(),Kot=NT(),Yot=yX(),Qot=v_(),Xot=function(t){$ot(e,t);function e(r,n){var o=t.call(this)||this;return n&&n.method&&r&&(o.method=n.method,o.url=e._getUrlFromRequestOptions(r,n),o.startTime=+new Date),o}return e.prototype.onError=function(r){this._setStatus(void 0,r)},e.prototype.onResponse=function(r){this._setStatus(r.statusCode,void 0),this.correlationId=Wot.getCorrelationContextTarget(r,Kot.requestContextTargetKey)},e.prototype.getDependencyTelemetry=function(r,n){var o=this.method.toUpperCase(),s=BJ.RemoteDependencyDataConstants.TYPE_HTTP,a="";try{var c=new rl.URL(this.url);c.search=void 0,c.hash=void 0,o+=" "+c.pathname,a=c.hostname,c.port&&(a+=":"+c.port)}catch{}this.correlationId?(s=BJ.RemoteDependencyDataConstants.TYPE_AI,this.correlationId!==Qot.correlationIdPrefix&&(a+=" | "+this.correlationId)):s=BJ.RemoteDependencyDataConstants.TYPE_HTTP;var u={id:n,name:o,data:this.url,duration:this.duration,success:this._isSuccess(),resultCode:this.statusCode?this.statusCode.toString():null,properties:this.properties||{},dependencyTypeName:s,target:a};if(r&&r.time?u.time=r.time:this.startTime&&(u.time=new Date(this.startTime)),r){for(var l in r)u[l]||(u[l]=r[l]);if(r.properties)for(var l in r.properties)u.properties[l]=r.properties[l]}return u},e._getUrlFromRequestOptions=function(r,n){if(typeof r=="string")if(r.indexOf("http://")===0||r.indexOf("https://")===0)try{r=new rl.URL(r)}catch{}else try{var o=new rl.URL("http://"+r);o.port==="443"?r=new rl.URL("https://"+r):r=new rl.URL("http://"+r)}catch{}else{if(r&&typeof rl.URL=="function"&&r instanceof rl.URL)return rl.format(r);var s=r;r={},s&&Object.keys(s).forEach(function(u){r[u]=s[u]})}if(r.path&&r.host)try{var a=new rl.URL(r.path,"http://"+r.host+r.path);r.pathname=a.pathname,r.search=a.search}catch{}if(r.path&&r.hostname&&!r.host)try{var a=new rl.URL(r.path,"http://"+r.hostname+r.path);r.pathname=a.pathname,r.search=a.search}catch{}if(r.host&&r.port)try{var c=new rl.URL("http://"+r.host);!c.port&&r.port&&(r.hostname=r.host,delete r.host)}catch{}return r.protocol=r.protocol||n.agent&&n.agent.protocol||n.protocol||void 0,r.hostname=r.hostname||"localhost",rl.format(r)},e}(Yot);uwe.exports=Xot});var dwe=O(cE=>{"use strict";var Z8=cE&&cE.__assign||function(){return Z8=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Z8.apply(this,arguments)};Object.defineProperty(cE,"__esModule",{value:!0});cE.parseEventHubSpan=void 0;var jJ=(Pr(),eo(IT)),Jot=(Ra(),eo(BSe)),Zot=(td(),eo(sQ)),LA=fi(),est=function(t){var e=0,r=0,n=Jot.hrTimeToMilliseconds(t.startTime);return t.links.forEach(function(o){var s=o.attributes,a=s?.[LA.ENQUEUED_TIME];a&&(e+=1,r+=n-(parseFloat(a.toString())||0))}),Math.max(r/(e||1),0)},tst=function(t,e){var r,n=t.attributes[LA.AzNamespace],o=(t.attributes[Zot.SemanticAttributes.NET_PEER_NAME]||t.attributes["peer.address"]||"unknown").replace(/\/$/g,""),s=t.attributes[LA.MessageBusDestination]||"unknown";switch(t.kind){case jJ.SpanKind.CLIENT:e.dependencyTypeName=n,e.target=o+"/"+s;break;case jJ.SpanKind.PRODUCER:e.dependencyTypeName=LA.DependencyTypeName.QueueMessage+" | "+n,e.target=o+"/"+s;break;case jJ.SpanKind.CONSUMER:e.source=o+"/"+s,e.measurements=Z8(Z8({},e.measurements),(r={},r[LA.TIME_SINCE_ENQUEUED]=est(t),r));break;default:}};cE.parseEventHubSpan=tst});var mwe=O(e9=>{"use strict";Object.defineProperty(e9,"__esModule",{value:!0});e9.spanToTelemetryContract=void 0;var pwe=require("url"),sd=(Pr(),eo(IT)),lr=(td(),eo(sQ)),Hm=fi(),rst=dwe(),nst=Is();function ist(t){for(var e={},r=0,n=Object.keys(t.attributes);r<n.length;r++){var o=n[r];o.startsWith("http.")||o.startsWith("rpc.")||o.startsWith("db.")||o.startsWith("peer.")||o.startsWith("net.")||(e[o]=t.attributes[o])}var s=t.links.map(function(a){return{operation_Id:a.context.traceId,id:a.context.spanId}});return s.length>0&&(e["_MS.links"]=nst.stringify(s)),e}function ost(t){return t===lr.DbSystemValues.DB2||t===lr.DbSystemValues.DERBY||t===lr.DbSystemValues.MARIADB||t===lr.DbSystemValues.MSSQL||t===lr.DbSystemValues.ORACLE||t===lr.DbSystemValues.SQLITE||t===lr.DbSystemValues.OTHER_SQL||t===lr.DbSystemValues.HSQLDB||t===lr.DbSystemValues.H2}function fwe(t){var e=t.attributes[lr.SemanticAttributes.HTTP_METHOD];if(e){var r=t.attributes[lr.SemanticAttributes.HTTP_URL];if(r)return String(r);var n=t.attributes[lr.SemanticAttributes.HTTP_SCHEME],o=t.attributes[lr.SemanticAttributes.HTTP_TARGET];if(n&&o){var s=t.attributes[lr.SemanticAttributes.HTTP_HOST];if(s)return n+"://"+s+o;var a=t.attributes[lr.SemanticAttributes.NET_PEER_PORT];if(a){var c=t.attributes[lr.SemanticAttributes.NET_PEER_NAME];if(c)return n+"://"+c+":"+a+o;var u=t.attributes[lr.SemanticAttributes.NET_PEER_IP];if(u)return n+"://"+u+":"+a+o}}}return""}function HJ(t){var e=t.attributes[lr.SemanticAttributes.PEER_SERVICE],r=t.attributes[lr.SemanticAttributes.HTTP_HOST],n=t.attributes[lr.SemanticAttributes.HTTP_URL],o=t.attributes[lr.SemanticAttributes.NET_PEER_NAME],s=t.attributes[lr.SemanticAttributes.NET_PEER_IP];return e?String(e):r?String(r):n?String(n):o?String(o):s?String(s):""}function sst(t){var e={name:t.name,success:t.status.code!=sd.SpanStatusCode.ERROR,resultCode:"0",duration:0,data:"",dependencyTypeName:""};t.kind===sd.SpanKind.PRODUCER&&(e.dependencyTypeName=Hm.DependencyTypeName.QueueMessage),t.kind===sd.SpanKind.INTERNAL&&t.parentSpanId&&(e.dependencyTypeName=Hm.DependencyTypeName.InProc);var r=t.attributes[lr.SemanticAttributes.HTTP_METHOD],n=t.attributes[lr.SemanticAttributes.DB_SYSTEM],o=t.attributes[lr.SemanticAttributes.RPC_SYSTEM];if(r){e.dependencyTypeName=Hm.DependencyTypeName.Http;var s=t.attributes[lr.SemanticAttributes.HTTP_URL];if(s){var a="";try{var c=new pwe.URL(String(s));a=c.pathname}catch{}e.name=r+" "+a}e.data=fwe(t);var u=t.attributes[lr.SemanticAttributes.HTTP_STATUS_CODE];u&&(e.resultCode=String(u));var l=HJ(t);if(l){try{var d=new RegExp(/(https?)(:\/\/.*)(:\d+)(\S*)/),p=d.exec(l);if(p!=null){var f=p[1],m=p[3];(f=="https"&&m==":443"||f=="http"&&m==":80")&&(l=p[1]+p[2]+p[4])}}catch{}e.target=""+l}}else if(n){String(n)===lr.DbSystemValues.MYSQL?e.dependencyTypeName="mysql":String(n)===lr.DbSystemValues.POSTGRESQL?e.dependencyTypeName="postgresql":String(n)===lr.DbSystemValues.MONGODB?e.dependencyTypeName="mongodb":String(n)===lr.DbSystemValues.REDIS?e.dependencyTypeName="redis":ost(String(n))?e.dependencyTypeName="SQL":e.dependencyTypeName=String(n);var h=t.attributes[lr.SemanticAttributes.DB_STATEMENT],g=t.attributes[lr.SemanticAttributes.DB_OPERATION];h?e.data=String(h):g&&(e.data=String(g));var l=HJ(t),v=t.attributes[lr.SemanticAttributes.DB_NAME];l?e.target=v?l+"|"+v:""+l:e.target=v?""+v:""+n}else if(o){e.dependencyTypeName=Hm.DependencyTypeName.Grpc;var y=t.attributes[lr.SemanticAttributes.RPC_GRPC_STATUS_CODE];y&&(e.resultCode=String(y));var l=HJ(t);l?e.target=""+l:o&&(e.target=String(o))}return e}function ast(t){var e={name:t.name,success:t.status.code!=sd.SpanStatusCode.ERROR,resultCode:"0",duration:0,url:"",source:void 0},r=t.attributes[lr.SemanticAttributes.HTTP_METHOD],n=t.attributes[lr.SemanticAttributes.RPC_GRPC_STATUS_CODE];if(r){if(t.kind==sd.SpanKind.SERVER){var o=t.attributes[lr.SemanticAttributes.HTTP_ROUTE],s=t.attributes[lr.SemanticAttributes.HTTP_URL];if(o)e.name=r+" "+o;else if(s)try{var a=new pwe.URL(String(s));e.name=r+" "+a.pathname}catch{}}e.url=fwe(t);var c=t.attributes[lr.SemanticAttributes.HTTP_STATUS_CODE];c&&(e.resultCode=String(c))}else n&&(e.resultCode=String(n));return e}function cst(t){var e;switch(t.kind){case sd.SpanKind.CLIENT:case sd.SpanKind.PRODUCER:case sd.SpanKind.INTERNAL:e=sst(t);break;case sd.SpanKind.SERVER:case sd.SpanKind.CONSUMER:e=ast(t);break}var r=t.spanContext?t.spanContext():t.context(),n=""+r.spanId,o=Math.round(t.duration[0]*1e3+t.duration[1]/1e6);return e.id=n,e.duration=o,e.properties=ist(t),t.attributes[Hm.AzNamespace]&&(t.kind===sd.SpanKind.INTERNAL&&(e.dependencyTypeName=Hm.DependencyTypeName.InProc+" | "+t.attributes[Hm.AzNamespace]),t.attributes[Hm.AzNamespace]===Hm.MicrosoftEventHub&&rst.parseEventHubSpan(t,e)),e}e9.spanToTelemetryContract=cst});var gwe=O(l0=>{"use strict";var uE=l0&&l0.__assign||function(){return uE=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},uE.apply(this,arguments)};Object.defineProperty(l0,"__esModule",{value:!0});l0.AsyncScopeManager=l0.OpenTelemetryScopeManagerWrapper=void 0;var u0=o0(),ust=require("events"),hwe=function(){function t(){}return t.prototype.active=function(){var e=this,r=u0.CorrelationContextManager.getCurrentContext();return uE(uE({},r),{getValue:function(n){return e._activeSymbol?n===e._activeSymbol?r:!1:(e._activeSymbol=n,r)},setValue:function(){}})},t.prototype.with=function(e,r){var n=e.parentSpanId,o=e.name,s=t._spanToContext(e,n,o);return u0.CorrelationContextManager.runWithContext(s,r)()},t.prototype.bind=function(e){return typeof e=="function"?u0.CorrelationContextManager.wrapCallback(e):(e instanceof ust.EventEmitter&&u0.CorrelationContextManager.wrapEmitter(e),e)},t.prototype.enable=function(){return u0.CorrelationContextManager.enable(),this},t.prototype.disable=function(){return u0.CorrelationContextManager.disable(),this},t._spanToContext=function(e,r,n){var o=e.spanContext?e.spanContext():e.context(),s=uE(uE({},e.spanContext()),{traceFlags:e.spanContext().traceFlags}),a=r?"|"+o.traceId+"."+r+".":o.traceId,c=u0.CorrelationContextManager.getCurrentContext();c&&(s.traceId=c.operation.id,r||(a=c.operation.parentId));var u=u0.CorrelationContextManager.spanToContextObject(s,a,n);return u},t}();l0.OpenTelemetryScopeManagerWrapper=hwe;l0.AsyncScopeManager=new hwe});var vwe=O(d0=>{"use strict";Object.defineProperty(d0,"__esModule",{value:!0});d0.enable=d0.subscriber=void 0;var OA=(Pr(),eo(IT)),lst=fi(),VJ=Ni(),dst=mwe(),pst=gwe(),R_=[],fst=function(t){try{var e=t.data,r=dst.spanToTelemetryContract(e);pst.AsyncScopeManager.with(e,function(){R_.forEach(function(n){e.kind===OA.SpanKind.SERVER||e.kind===OA.SpanKind.CONSUMER?n.trackRequest(r):(e.kind===OA.SpanKind.CLIENT||e.kind===OA.SpanKind.INTERNAL||e.kind===OA.SpanKind.PRODUCER)&&n.trackDependency(r)})})}catch{}};d0.subscriber=fst;function mst(t,e){if(t){var r=R_.find(function(n){return n==e});if(r)return;R_.length===0&&VJ.channel.subscribe("azure-coretracing",d0.subscriber,VJ.trueFilter,function(n,o){var s=e.getStatsbeat();s&&s.addInstrumentation(lst.StatsbeatInstrumentation.AZURE_CORE_TRACING)}),R_.push(e)}else R_=R_.filter(function(n){return n!=e}),R_.length===0&&VJ.channel.unsubscribe("azure-coretracing",d0.subscriber)}d0.enable=mst});var bwe=O(p0=>{"use strict";Object.defineProperty(p0,"__esModule",{value:!0});p0.enable=p0.subscriber=void 0;var hst=fi(),GJ=Ni(),k_=[],gst=function(t){t.data.event.commandName!=="ismaster"&&k_.forEach(function(e){var r=t.data.startedData&&t.data.startedData.databaseName||"Unknown database";e.trackDependency({target:r,data:t.data.event.commandName,name:t.data.event.commandName,duration:t.data.event.duration,success:t.data.succeeded,resultCode:t.data.succeeded?"0":"1",time:t.data.startedData.time,dependencyTypeName:"mongodb"})})};p0.subscriber=gst;function vst(t,e){if(t){var r=k_.find(function(n){return n==e});if(r)return;k_.length===0&&GJ.channel.subscribe("mongodb",p0.subscriber,GJ.trueFilter,function(n,o){var s=e.getStatsbeat();s&&s.addInstrumentation(hst.StatsbeatInstrumentation.MONGODB)}),k_.push(e)}else k_=k_.filter(function(n){return n!=e}),k_.length===0&&GJ.channel.unsubscribe("mongodb",p0.subscriber)}p0.enable=vst});var ywe=O(f0=>{"use strict";Object.defineProperty(f0,"__esModule",{value:!0});f0.enable=f0.subscriber=void 0;var bst=fi(),zJ=Ni(),P_=[],yst=function(t){P_.forEach(function(e){var r=t.data.query||{},n=r.sql||"Unknown query",o=!t.data.err,s=r._connection||{},a=s.config||{},c=a.socketPath?a.socketPath:(a.host||"localhost")+":"+a.port;e.trackDependency({target:c,data:n,name:n,duration:t.data.duration,success:o,resultCode:o?"0":"1",time:t.data.time,dependencyTypeName:"mysql"})})};f0.subscriber=yst;function _st(t,e){if(t){var r=P_.find(function(n){return n==e});if(r)return;P_.length===0&&zJ.channel.subscribe("mysql",f0.subscriber,zJ.trueFilter,function(n,o){var s=e.getStatsbeat();s&&s.addInstrumentation(bst.StatsbeatInstrumentation.MYSQL)}),P_.push(e)}else P_=P_.filter(function(n){return n!=e}),P_.length===0&&zJ.channel.unsubscribe("mysql",f0.subscriber)}f0.enable=_st});var _we=O(m0=>{"use strict";Object.defineProperty(m0,"__esModule",{value:!0});m0.enable=m0.subscriber=void 0;var xst=fi(),$J=Ni(),A_=[],Sst=function(t){A_.forEach(function(e){t.data.commandObj.command!=="info"&&e.trackDependency({target:t.data.address,name:t.data.commandObj.command,data:t.data.commandObj.command,duration:t.data.duration,success:!t.data.err,resultCode:t.data.err?"1":"0",time:t.data.time,dependencyTypeName:"redis"})})};m0.subscriber=Sst;function Ist(t,e){if(t){var r=A_.find(function(n){return n==e});if(r)return;A_.length===0&&$J.channel.subscribe("redis",m0.subscriber,$J.trueFilter,function(n,o){var s=e.getStatsbeat();s&&s.addInstrumentation(xst.StatsbeatInstrumentation.REDIS)}),A_.push(e)}else A_=A_.filter(function(n){return n!=e}),A_.length===0&&$J.channel.unsubscribe("redis",m0.subscriber)}m0.enable=Ist});var xwe=O(h0=>{"use strict";Object.defineProperty(h0,"__esModule",{value:!0});h0.enable=h0.subscriber=void 0;var Cst=fi(),WJ=Ni(),D_=[],Tst=function(t){D_.forEach(function(e){var r=t.data.query,n=r.preparable&&r.preparable.text||r.plan||r.text||"unknown query",o=!t.data.error,s=t.data.database.host+":"+t.data.database.port;e.trackDependency({target:s,data:n,name:n,duration:t.data.duration,success:o,resultCode:o?"0":"1",time:t.data.time,dependencyTypeName:"postgres"})})};h0.subscriber=Tst;function Est(t,e){if(t){var r=D_.find(function(n){return n==e});if(r)return;D_.length===0&&WJ.channel.subscribe("postgres",h0.subscriber,WJ.trueFilter,function(n,o){var s=e.getStatsbeat();s&&s.addInstrumentation(Cst.StatsbeatInstrumentation.POSTGRES)}),D_.push(e)}else D_=D_.filter(function(n){return n!=e}),D_.length===0&&WJ.channel.unsubscribe("postgres",h0.subscriber)}h0.enable=Est});var pE=O((YJ,Swe)=>{"use strict";var t9=YJ&&YJ.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,o++)n[o]=s[a];return n},lE=require("http"),dE=require("https"),r9=Wn(),KJ=Is(),g0=NT(),wst=lwe(),MA=o0(),n9=i8(),Rst=n8(),FA=v_(),kst=function(){function t(e){if(t.INSTANCE)throw new Error("Client request tracking should be configured from the applicationInsights object");t.INSTANCE=this,this._client=e}return t.prototype.enable=function(e){this._isEnabled=e,this._isEnabled&&!this._isInitialized&&this._initialize(),Rst.IsInitialized&&(vwe().enable(e,this._client),bwe().enable(e,this._client),ywe().enable(e,this._client),_we().enable(e,this._client),xwe().enable(e,this._client))},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype._initialize=function(){var e=this;this._isInitialized=!0;var r=lE.request,n=dE.request,o=function(s,a){try{var c=!a[t.disableCollectionRequestOption]&&!s[t.alreadyAutoCollectedFlag],u=null;if(a.headers&&(u=a.headers["User-Agent"]||a.headers["user-agent"],u&&u.toString().indexOf("azsdk-js")!==-1&&(c=!1)),s&&a&&c&&(MA.CorrelationContextManager.wrapEmitter(s),e._isEnabled))if(s[t.alreadyAutoCollectedFlag]=!0,MA.CorrelationContextManager.getCurrentContext())t.trackRequest(e._client,{options:a,request:s});else{var l=null;if(FA.w3cEnabled){var d=new n9;l=d.traceId}else{var p=FA.generateRequestId(null);l=FA.getRootId(p)}var f=MA.CorrelationContextManager.generateContextObject(l);MA.CorrelationContextManager.runWithContext(f,function(){t.trackRequest(e._client,{options:a,request:s})})}}catch(m){r9.warn("Failed to generate dependency telemetry.",KJ.dumpObj(m))}};lE.request=function(s){for(var a=[],c=1;c<arguments.length;c++)a[c-1]=arguments[c];var u=r.call.apply(r,t9([lE,s],a));return o(u,s),u},dE.request=function(s){for(var a=[],c=1;c<arguments.length;c++)a[c-1]=arguments[c];var u=n.call.apply(n,t9([dE,s],a));return o(u,s),u},lE.get=function(s){for(var a,c=[],u=1;u<arguments.length;u++)c[u-1]=arguments[u];var l=(a=lE.request).call.apply(a,t9([lE,s],c));return l.end(),l},dE.get=function(s){for(var a,c=[],u=1;u<arguments.length;u++)c[u-1]=arguments[u];var l=(a=dE.request).call.apply(a,t9([dE,s],c));return l.end(),l}},t.trackRequest=function(e,r){if(!r.options||!r.request||!e){r9.info("AutoCollectHttpDependencies.trackRequest was called with invalid parameters: ",!r.options,!r.request,!e);return}var n=new wst(r.options,r.request),o=MA.CorrelationContextManager.getCurrentContext(),s,a;if(o&&o.operation&&o.operation.traceparent&&n9.isValidTraceId(o.operation.traceparent.traceId))o.operation.traceparent.updateSpanId(),s=o.operation.traceparent.getBackCompatRequestId();else if(FA.w3cEnabled){var c=new n9;a=c.toString(),s=c.getBackCompatRequestId()}else s=o&&o.operation&&o.operation.parentId+t.requestNumber+++".";if(KJ.canIncludeCorrelationHeader(e,n.getUrl())&&r.request.getHeader&&r.request.setHeader&&e.config&&e.config.correlationId){var u=r.request.getHeader(g0.requestContextHeader);try{KJ.safeIncludeCorrelationHeader(e,r.request,u)}catch(p){r9.warn("Request-Context header could not be set. Correlation of requests may be lost",p)}if(o&&o.operation)try{if(r.request.setHeader(g0.requestIdHeader,s),e.config.ignoreLegacyHeaders||(r.request.setHeader(g0.parentIdHeader,o.operation.id),r.request.setHeader(g0.rootIdHeader,s)),a||o.operation.traceparent)r.request.setHeader(g0.traceparentHeader,a||o.operation.traceparent.toString());else if(FA.w3cEnabled){var c=new n9().toString();r.request.setHeader(g0.traceparentHeader,c)}if(o.operation.tracestate){var l=o.operation.tracestate.toString();l&&r.request.setHeader(g0.traceStateHeader,l)}var d=o.customProperties.serializeToHeader();d&&r.request.setHeader(g0.correlationContextHeader,d)}catch(p){r9.warn("Correlation headers could not be set. Correlation of requests may be lost.",p)}}r.request.on&&(r.request.on("response",function(p){if(!r.isProcessed){r.isProcessed=!0,n.onResponse(p);var f=n.getDependencyTelemetry(r,s);f.contextObjects=f.contextObjects||{},f.contextObjects["http.RequestOptions"]=r.options,f.contextObjects["http.ClientRequest"]=r.request,f.contextObjects["http.ClientResponse"]=p,e.trackDependency(f)}}),r.request.on("error",function(p){if(!r.isProcessed){r.isProcessed=!0,n.onError(p);var f=n.getDependencyTelemetry(r,s);f.contextObjects=f.contextObjects||{},f.contextObjects["http.RequestOptions"]=r.options,f.contextObjects["http.ClientRequest"]=r.request,f.contextObjects.Error=p,e.trackDependency(f)}}),r.request.on("abort",function(){if(!r.isProcessed){r.isProcessed=!0,n.onError(new Error("The request has been aborted and the network socket has closed."));var p=n.getDependencyTelemetry(r,s);p.contextObjects=p.contextObjects||{},p.contextObjects["http.RequestOptions"]=r.options,p.contextObjects["http.ClientRequest"]=r.request,e.trackDependency(p)}}))},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t.disableCollectionRequestOption="disableAppInsightsAutoCollection",t.requestNumber=1,t.alreadyAutoCollectedFlag="_appInsightsAutoCollected",t}();Swe.exports=kst});var XJ=O(($Dr,wwe)=>{"use strict";var Iwe=require("http"),Cwe=require("https"),Twe=Wn(),Ewe=Is(),Pst=NT(),QJ=IX(),Vm=o0(),Ast=$8(),Dst=function(){function t(e){if(t.INSTANCE)throw new Error("Server request tracking should be configured from the applicationInsights object");t.INSTANCE=this,this._client=e}return t.prototype.enable=function(e){this._isEnabled=e,(this._isAutoCorrelating||this._isEnabled||Ast.isEnabled())&&!this._isInitialized&&(this.useAutoCorrelation(this._isAutoCorrelating),this._initialize())},t.prototype.useAutoCorrelation=function(e,r){e&&!this._isAutoCorrelating?Vm.CorrelationContextManager.enable(r):!e&&this._isAutoCorrelating&&Vm.CorrelationContextManager.disable(),this._isAutoCorrelating=e},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype.isAutoCorrelating=function(){return this._isAutoCorrelating},t.prototype._generateCorrelationContext=function(e){if(this._isAutoCorrelating)return Vm.CorrelationContextManager.generateContextObject(e.getOperationId(this._client.context.tags),e.getRequestId(),e.getOperationName(this._client.context.tags),e.getCorrelationContextHeader(),e.getTraceparent(),e.getTracestate())},t.prototype._registerRequest=function(e,r,n){var o=this,s=new QJ(e),a=this._generateCorrelationContext(s);Vm.CorrelationContextManager.runWithContext(a,function(){o._isEnabled&&(e[t.alreadyAutoCollectedFlag]=!0,t.trackRequest(o._client,{request:e,response:r},s)),typeof n=="function"&&n(e,r)})},t.prototype._initialize=function(){if(this._isInitialized=!0,!t.HANDLER_READY){t.HANDLER_READY=!0;var e=function(s){if(s){if(typeof s!="function")throw new Error("onRequest handler must be a function");return function(a,c){Vm.CorrelationContextManager.wrapEmitter(a),Vm.CorrelationContextManager.wrapEmitter(c);var u=a&&!a[t.alreadyAutoCollectedFlag];a&&u&&t.INSTANCE?t.INSTANCE._registerRequest(a,c,s):s(a,c)}}},r=function(s){var a=s.addListener.bind(s);s.addListener=function(c,u){switch(c){case"request":case"checkContinue":return a(c,e(u));default:return a(c,u)}},s.on=s.addListener},n=Iwe.createServer;Iwe.createServer=function(s,a){if(a&&typeof a=="function"){var c=n(s,e(a));return r(c),c}else{var c=n(e(s));return r(c),c}};var o=Cwe.createServer;Cwe.createServer=function(s,a){var c=o(s,e(a));return r(c),c}}},t.trackRequestSync=function(e,r){if(!r.request||!r.response||!e){Twe.info("AutoCollectHttpRequests.trackRequestSync was called with invalid parameters: ",!r.request,!r.response,!e);return}r.isProcessed=!1,t.addResponseCorrelationIdHeader(e,r.response);var n=Vm.CorrelationContextManager.getCurrentContext(),o=new QJ(r.request,n&&n.operation.parentId);n&&(n.operation.id=o.getOperationId(e.context.tags)||n.operation.id,n.operation.name=o.getOperationName(e.context.tags)||n.operation.name,n.operation.parentId=o.getRequestId()||n.operation.parentId,n.customProperties.addHeaderData(o.getCorrelationContextHeader())),t.endRequest(e,o,r,r.duration,r.error)},t.trackRequest=function(e,r,n){if(!r.request||!r.response||!e){Twe.info("AutoCollectHttpRequests.trackRequest was called with invalid parameters: ",!r.request,!r.response,!e);return}r.isProcessed=!1;var o=Vm.CorrelationContextManager.getCurrentContext(),s=n||new QJ(r.request,o&&o.operation.parentId);Ewe.canIncludeCorrelationHeader(e,s.getUrl())&&t.addResponseCorrelationIdHeader(e,r.response),o&&!n&&(o.operation.id=s.getOperationId(e.context.tags)||o.operation.id,o.operation.name=s.getOperationName(e.context.tags)||o.operation.name,o.operation.parentId=s.getOperationParentId(e.context.tags)||o.operation.parentId,o.customProperties.addHeaderData(s.getCorrelationContextHeader())),r.response.once&&r.response.once("finish",function(){t.endRequest(e,s,r,null,null)}),r.request.on&&r.request.on("error",function(a){t.endRequest(e,s,r,null,a)}),r.request.on&&r.request.on("aborted",function(){var a="The request has been aborted and the network socket has closed.";t.endRequest(e,s,r,null,a)})},t.addResponseCorrelationIdHeader=function(e,r){if(e.config&&e.config.correlationId&&r.getHeader&&r.setHeader&&!r.headersSent){var n=r.getHeader(Pst.requestContextHeader);Ewe.safeIncludeCorrelationHeader(e,r,n)}},t.endRequest=function(e,r,n,o,s){if(!n.isProcessed){n.isProcessed=!0,s?r.onError(s,o):r.onResponse(n.response,o);var a=r.getRequestTelemetry(n);if(a.tagOverrides=r.getRequestTags(e.context.tags),n.tagOverrides)for(var c in n.tagOverrides)a.tagOverrides[c]=n.tagOverrides[c];var u=r.getLegacyRootId();u&&(a.properties.ai_legacyRootId=u),a.contextObjects=a.contextObjects||{},a.contextObjects["http.ServerRequest"]=n.request,a.contextObjects["http.ServerResponse"]=n.response,e.trackRequest(a)}},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1,Vm.CorrelationContextManager.disable(),this._isAutoCorrelating=!1},t.HANDLER_READY=!1,t.alreadyAutoCollectedFlag="_appInsightsAutoCollected",t}();wwe.exports=Dst});var Pwe=O((ZJ,kwe)=>{"use strict";var nl=ZJ&&ZJ.__assign||function(){return nl=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},nl.apply(this,arguments)},JJ=require("os"),N_=Xs(),Rwe=fi(),Nst=Is(),Lst=Wn(),Ost=Nst.w3cTraceId(),Mst=function(){function t(){}return t.createQuickPulseEnvelope=function(e,r,n,o){var s=JJ&&typeof JJ.hostname=="function"&&JJ.hostname()||"Unknown",a=o.tags&&o.keys&&o.keys.cloudRoleInstance&&o.tags[o.keys.cloudRoleInstance]||s,c=o.tags&&o.keys&&o.keys.cloudRole&&o.tags[o.keys.cloudRole]||null,u={Documents:r.length>0?r:null,InstrumentationKey:n.instrumentationKey||"",Metrics:e.length>0?e:null,InvariantVersion:1,Timestamp:"/Date("+Date.now()+")/",Version:o.tags[o.keys.internalSdkVersion],StreamId:Ost,MachineName:s,Instance:a,RoleName:c};return u},t.createQuickPulseMetric=function(e){var r;return r={Name:e.name,Value:e.value,Weight:e.count||1},r},t.telemetryEnvelopeToQuickPulseDocument=function(e){switch(e.data.baseType){case N_.TelemetryTypeString.Event:return t.createQuickPulseEventDocument(e);case N_.TelemetryTypeString.Exception:return t.createQuickPulseExceptionDocument(e);case N_.TelemetryTypeString.Trace:return t.createQuickPulseTraceDocument(e);case N_.TelemetryTypeString.Dependency:return t.createQuickPulseDependencyDocument(e);case N_.TelemetryTypeString.Request:return t.createQuickPulseRequestDocument(e)}return null},t.createQuickPulseEventDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData.name,o=nl(nl({},r),{Name:n});return o},t.createQuickPulseTraceDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData.severityLevel||0,o=nl(nl({},r),{Message:e.data.baseData.message,SeverityLevel:N_.SeverityLevel[n]});return o},t.createQuickPulseExceptionDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData.exceptions,o="",s="",a="";n&&n.length>0&&(n[0].parsedStack&&n[0].parsedStack.length>0?n[0].parsedStack.forEach(function(u){o+=u.assembly+`
`}):n[0].stack&&n[0].stack.length>0&&(o=n[0].stack),s=n[0].message,a=n[0].typeName);var c=nl(nl({},r),{Exception:o,ExceptionMessage:s,ExceptionType:a});return c},t.createQuickPulseRequestDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData,o=nl(nl({},r),{Name:n.name,Success:n.success,Duration:n.duration,ResponseCode:n.responseCode,OperationName:n.name});return o},t.createQuickPulseDependencyDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData,o=nl(nl({},r),{Name:n.name,Target:n.target,Success:n.success,Duration:n.duration,ResultCode:n.resultCode,CommandName:n.data,OperationName:r.OperationId,DependencyTypeName:n.type});return o},t.createQuickPulseDocument=function(e){var r,n,o,s;e.data.baseType?(n=Rwe.TelemetryTypeStringToQuickPulseType[e.data.baseType],r=Rwe.TelemetryTypeStringToQuickPulseDocumentType[e.data.baseType]):Lst.warn("Document type invalid; not sending live metric document",e.data.baseType),o=e.tags[t.keys.operationId],s=t.aggregateProperties(e);var a={DocumentType:r,__type:n,OperationId:o,Version:"1.0",Properties:s};return a},t.aggregateProperties=function(e){var r=[],n=e.data.baseData.measurements||{};for(var o in n)if(n.hasOwnProperty(o)){var s=n[o],a={key:o,value:s};r.push(a)}var c=e.data.baseData.properties||{};for(var o in c)if(c.hasOwnProperty(o)){var s=c[o],a={key:o,value:s};r.push(a)}return r},t.keys=new N_.ContextTagKeys,t}();kwe.exports=Mst});var Dwe=O((WDr,Awe)=>{"use strict";var Fst=function(){return(Date.now()+621355968e5)*1e4};Awe.exports={getTransmissionTime:Fst}});var Mwe=O((UA,Owe)=>{"use strict";var Nwe=UA&&UA.__awaiter||function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},Lwe=UA&&UA.__generator||function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},Ust=require("https"),Bst=pE(),eZ=Wn(),qst=Dwe(),tZ=Is(),jst=require("url"),il={method:"POST",time:"x-ms-qps-transmission-time",pollingIntervalHint:"x-ms-qps-service-polling-interval-hint",endpointRedirect:"x-ms-qps-service-endpoint-redirect-v2",instanceName:"x-ms-qps-instance-name",streamId:"x-ms-qps-stream-id",machineName:"x-ms-qps-machine-name",roleName:"x-ms-qps-role-name",streamid:"x-ms-qps-stream-id",invariantVersion:"x-ms-qps-invariant-version",subscribed:"x-ms-qps-subscribed"},Hst=function(){function t(e,r){this._config=e,this._consecutiveErrors=0,this._getAuthorizationHandler=r}return t.prototype.ping=function(e,r,n){var o=[{name:il.streamId,value:e.StreamId},{name:il.machineName,value:e.MachineName},{name:il.roleName,value:e.RoleName},{name:il.instanceName,value:e.Instance},{name:il.invariantVersion,value:e.InvariantVersion.toString()}];this._submitData(e,r,n,"ping",o)},t.prototype.post=function(e,r,n){return Nwe(this,void 0,void 0,function(){return Lwe(this,function(o){switch(o.label){case 0:return[4,this._submitData([e],r,n,"post")];case 1:return o.sent(),[2]}})})},t.prototype._submitData=function(e,r,n,o,s){return Nwe(this,void 0,void 0,function(){var a,c,u,l,d,p,f,m,h=this;return Lwe(this,function(g){switch(g.label){case 0:if(a=tZ.stringify(e),c=(f={},f[Bst.disableCollectionRequestOption]=!0,f.host=r&&r.length>0?r:this._config.quickPulseHost,f.method=il.method,f.path="/QuickPulseService.svc/"+o+"?ikey="+this._config.instrumentationKey,f.headers=(m={Expect:"100-continue"},m[il.time]=qst.getTransmissionTime(),m["Content-Type"]="application/json",m["Content-Length"]=Buffer.byteLength(a),m),f),s&&s.length>0&&s.forEach(function(v){return c.headers[v.name]=v.value}),o!=="post")return[3,4];if(u=this._getAuthorizationHandler?this._getAuthorizationHandler(this._config):null,!u)return[3,4];g.label=1;case 1:return g.trys.push([1,3,,4]),[4,u.addAuthorizationHeader(c)];case 2:return g.sent(),[3,4];case 3:return l=g.sent(),d="Failed to get AAD bearer token for the Application. Error:",eZ.info(t.TAG,d,l),[2];case 4:return this._config.httpsAgent?c.agent=this._config.httpsAgent:c.agent=tZ.tlsRestrictedAgent,p=Ust.request(c,function(v){if(v.statusCode==200){var y=v.headers[il.subscribed]==="true",_=null;try{_=v.headers[il.endpointRedirect]?new jst.URL(v.headers[il.endpointRedirect].toString()).host:null}catch(S){h._onError("Failed to parse redirect header from QuickPulse: "+tZ.dumpObj(S))}var x=v.headers[il.pollingIntervalHint]?parseInt(v.headers[il.pollingIntervalHint].toString()):null;h._consecutiveErrors=0,n(y,v,_,x)}else h._onError("StatusCode:"+v.statusCode+" StatusMessage:"+v.statusMessage),n()}),p.on("error",function(v){h._onError(v),n()}),p.write(a),p.end(),[2]}})})},t.prototype._onError=function(e){this._consecutiveErrors++;var r="Transient error connecting to the Live Metrics endpoint. This packet will not appear in your Live Metrics Stream. Error:";this._consecutiveErrors%t.MAX_QPS_FAILURES_BEFORE_WARN===0?(r="Live Metrics endpoint could not be reached "+this._consecutiveErrors+" consecutive times. Most recent error:",eZ.warn(t.TAG,r,e)):eZ.info(t.TAG,r,e)},t.TAG="QuickPulseSender",t.MAX_QPS_FAILURES_BEFORE_WARN=25,t}();Owe.exports=Hst});var jwe=O((BA,qwe)=>{"use strict";var Fwe=BA&&BA.__awaiter||function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},Uwe=BA&&BA.__generator||function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},Bwe=Wn(),rZ=Pwe(),Vst=Mwe(),Gst=fi(),zst=oE(),$st=function(){function t(e,r,n){this._isCollectingData=!1,this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0,this._metrics={},this._documents=[],this._collectors=[],this._redirectedHost=null,this._pollingIntervalHint=-1,this.config=e,this.context=r||new zst,this._sender=new Vst(this.config,n),this._isEnabled=!1}return t.prototype.addCollector=function(e){this._collectors.push(e)},t.prototype.trackMetric=function(e){this._addMetric(e)},t.prototype.addDocument=function(e){if(this._isCollectingData){var r=rZ.telemetryEnvelopeToQuickPulseDocument(e);r&&this._documents.push(r)}},t.prototype.enable=function(e){e&&!this._isEnabled?(this._isEnabled=!0,this._goQuickPulse()):!e&&this._isEnabled&&(this._isEnabled=!1,clearTimeout(this._handle),this._handle=void 0)},t.prototype.enableCollectors=function(e){this._collectors.forEach(function(r){r.enable(e)})},t.prototype._addMetric=function(e){var r=e.value,n=e.count||1,o=Gst.PerformanceToQuickPulseCounter[e.name];o&&(this._metrics[o]?(this._metrics[o].Value=(this._metrics[o].Value*this._metrics[o].Weight+r*n)/(this._metrics[o].Weight+n),this._metrics[o].Weight+=n):(this._metrics[o]=rZ.createQuickPulseMetric(e),this._metrics[o].Name=o,this._metrics[o].Weight=1))},t.prototype._resetQuickPulseBuffer=function(){delete this._metrics,this._metrics={},this._documents.length=0},t.prototype._goQuickPulse=function(){return Fwe(this,void 0,void 0,function(){var e,r,n,o,s=this;return Uwe(this,function(a){switch(a.label){case 0:return e=Object.keys(this._metrics).map(function(c){return s._metrics[c]}),r=rZ.createQuickPulseEnvelope(e,this._documents.slice(),this.config,this.context),this._resetQuickPulseBuffer(),this._isCollectingData?[4,this._post(r)]:[3,2];case 1:return a.sent(),[3,3];case 2:this._ping(r),a.label=3;case 3:return n=this._pollingIntervalHint>0?this._pollingIntervalHint:t.PING_INTERVAL,o=this._isCollectingData?t.POST_INTERVAL:n,this._isCollectingData&&Date.now()-this._lastSuccessTime>=t.MAX_POST_WAIT_TIME&&!this._lastSendSucceeded?(this._isCollectingData=!1,o=t.FALLBACK_INTERVAL):!this._isCollectingData&&Date.now()-this._lastSuccessTime>=t.MAX_PING_WAIT_TIME&&!this._lastSendSucceeded&&(o=t.FALLBACK_INTERVAL),this._lastSendSucceeded=null,this._handle=setTimeout(this._goQuickPulse.bind(this),o),this._handle.unref(),[2]}})})},t.prototype._ping=function(e){this._sender.ping(e,this._redirectedHost,this._quickPulseDone.bind(this))},t.prototype._post=function(e){return Fwe(this,void 0,void 0,function(){return Uwe(this,function(r){switch(r.label){case 0:return[4,this._sender.post(e,this._redirectedHost,this._quickPulseDone.bind(this))];case 1:return r.sent(),[2]}})})},t.prototype._quickPulseDone=function(e,r,n,o){e!=null?(this._isCollectingData!==e&&(Bwe.info("Live Metrics sending data",e),this.enableCollectors(e)),this._isCollectingData=e,n&&n.length>0&&(this._redirectedHost=n,Bwe.info("Redirecting endpoint to: ",n)),o&&o>0&&(this._pollingIntervalHint=o),r&&r.statusCode<300&&r.statusCode>=200?(this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0):this._lastSendSucceeded=!1):this._lastSendSucceeded=!1},t.MAX_POST_WAIT_TIME=2e4,t.MAX_PING_WAIT_TIME=6e4,t.FALLBACK_INTERVAL=6e4,t.PING_INTERVAL=5e3,t.POST_INTERVAL=1e3,t}();qwe.exports=$st});var Hwe=O(fE=>{"use strict";var i9=fE&&fE.__assign||function(){return i9=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},i9.apply(this,arguments)};Object.defineProperty(fE,"__esModule",{value:!0});fE.AutoCollectNativePerformance=void 0;var qA=oE(),Wst=Wn(),Kst=function(){function t(e){this._disabledMetrics={},t.INSTANCE&&t.INSTANCE.dispose(),t.INSTANCE=this,this._client=e}return t.prototype.enable=function(e,r,n){var o=this;if(r===void 0&&(r={}),n===void 0&&(n=6e4),t._metricsAvailable==null&&e&&!this._isInitialized)try{var s=require("applicationinsights-native-metrics");t._emitter=new s,t._metricsAvailable=!0,Wst.info("Native metrics module successfully loaded!")}catch{t._metricsAvailable=!1;return}this._isEnabled=e,this._disabledMetrics=r,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),this._isEnabled&&t._emitter?(t._emitter.enable(!0,n),this._handle||(this._handle=setInterval(function(){return o._trackNativeMetrics()},n),this._handle.unref())):t._emitter&&(t._emitter.enable(!1),this._handle&&(clearInterval(this._handle),this._handle=void 0))},t.prototype.dispose=function(){this.enable(!1)},t.parseEnabled=function(e,r){var n=r.disableAllExtendedMetrics,o=r.extendedMetricDisablers;if(n)return{isEnabled:!1,disabledMetrics:{}};if(o){var s=o.split(","),a={};if(s.length>0)for(var c=0,u=s;c<u.length;c++){var l=u[c];a[l]=!0}return typeof e=="object"?{isEnabled:!0,disabledMetrics:i9(i9({},e),a)}:{isEnabled:e,disabledMetrics:a}}return typeof e=="boolean"?{isEnabled:e,disabledMetrics:{}}:{isEnabled:!0,disabledMetrics:e}},t.prototype._trackNativeMetrics=function(){var e=!0;typeof this._isEnabled!="object"&&(e=this._isEnabled),e&&(this._trackGarbageCollection(),this._trackEventLoop(),this._trackHeapUsage())},t.prototype._trackGarbageCollection=function(){var e;if(!this._disabledMetrics.gc){var r=t._emitter.getGCData();for(var n in r){var o=r[n].metrics,s=n+" Garbage Collection Duration",a=Math.sqrt(o.sumSquares/o.count-Math.pow(o.total/o.count,2))||0;this._client.trackMetric({name:s,value:o.total,count:o.count,max:o.max,min:o.min,stdDev:a,tagOverrides:(e={},e[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+qA.sdkVersion,e)})}}},t.prototype._trackEventLoop=function(){var e;if(!this._disabledMetrics.loop){var r=t._emitter.getLoopData(),n=r.loopUsage;if(n.count!=0){var o="Event Loop CPU Time",s=Math.sqrt(n.sumSquares/n.count-Math.pow(n.total/n.count,2))||0;this._client.trackMetric({name:o,value:n.total,count:n.count,min:n.min,max:n.max,stdDev:s,tagOverrides:(e={},e[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+qA.sdkVersion,e)})}}},t.prototype._trackHeapUsage=function(){var e,r,n;if(!this._disabledMetrics.heap){var o=process.memoryUsage(),s=o.heapUsed,a=o.heapTotal,c=o.rss;this._client.trackMetric({name:"Memory Usage (Heap)",value:s,count:1,tagOverrides:(e={},e[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+qA.sdkVersion,e)}),this._client.trackMetric({name:"Memory Total (Heap)",value:a,count:1,tagOverrides:(r={},r[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+qA.sdkVersion,r)}),this._client.trackMetric({name:"Memory Usage (Non-Heap)",value:c-a,count:1,tagOverrides:(n={},n[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+qA.sdkVersion,n)})}},t}();fE.AutoCollectNativePerformance=Kst});var zwe=O(v0=>{"use strict";var Vwe=v0&&v0.__awaiter||function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},Gwe=v0&&v0.__generator||function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};Object.defineProperty(v0,"__esModule",{value:!0});v0.AzureFunctionsHook=void 0;var o9=Wn(),nZ=o0(),Yst=function(){function t(e){this._client=e,this._autoGenerateIncomingRequests=!1;try{this._functionsCoreModule=require("@azure/functions-core"),this._addPreInvocationHook(),this._addPostInvocationHook()}catch{o9.info("AzureFunctionsHook failed to load, not running in Azure Functions")}}return t.prototype._getFuncModelHelper=function(){if(this._cachedModelHelper===void 0){var e=this._functionsCoreModule.getProgrammingModel();e.name==="@azure/functions"&&(e.version.startsWith("3.")?this._cachedModelHelper=new Qst:e.version.startsWith("4.")&&(this._cachedModelHelper=new Xst)),this._cachedModelHelper||(this._cachedModelHelper=null,o9.warn('AzureFunctionsHook does not support model "'+e.name+'" version "'+e.version+'"'))}return this._cachedModelHelper},t.prototype.enable=function(e){this._autoGenerateIncomingRequests=e},t.prototype.dispose=function(){this.enable(!1),this._removeInvocationHooks(),this._functionsCoreModule=void 0},t.prototype._addPreInvocationHook=function(){var e=this;this._preInvocationHook||(this._preInvocationHook=this._functionsCoreModule.registerHook("preInvocation",function(r){return Vwe(e,void 0,void 0,function(){var n,o,s,a;return Gwe(this,function(c){try{n=this._getFuncModelHelper(),n&&(o=r.invocationContext,s=nZ.CorrelationContextManager.startOperation(o),s&&(s.customProperties.setProperty("InvocationId",o.invocationId),a=o.traceContext,a.attributes&&(s.customProperties.setProperty("ProcessId",a.attributes.ProcessId),s.customProperties.setProperty("LogLevel",a.attributes.LogLevel),s.customProperties.setProperty("Category",a.attributes.Category),s.customProperties.setProperty("HostInstanceId",a.attributes.HostInstanceId),s.customProperties.setProperty("AzFuncLiveLogsSessionId",a.attributes["#AzFuncLiveLogsSessionId"])),r.functionCallback=nZ.CorrelationContextManager.wrapCallback(r.functionCallback,s),n.isHttpTrigger(r)&&this._autoGenerateIncomingRequests&&(r.hookData.appInsightsExtractedContext=s,r.hookData.appInsightsStartTime=Date.now())))}catch(u){return o9.warn("Failed to propagate context in Azure Functions",u),[2]}return[2]})})}))},t.prototype._addPostInvocationHook=function(){var e=this;this._postInvocationHook||(this._postInvocationHook=this._functionsCoreModule.registerHook("postInvocation",function(r){return Vwe(e,void 0,void 0,function(){var n,o,s,a,c=this;return Gwe(this,function(u){try{n=this._getFuncModelHelper(),n&&this._autoGenerateIncomingRequests&&n.isHttpTrigger(r)&&(o=r.inputs[0],o&&(s=r.hookData.appInsightsStartTime||Date.now(),a=r.hookData.appInsightsExtractedContext,a?nZ.CorrelationContextManager.runWithContext(a,function(){c._createIncomingRequestTelemetry(o,r,s,a.operation.parentId)}):this._createIncomingRequestTelemetry(o,r,s,null)))}catch(l){o9.warn("Error creating automatic incoming request in Azure Functions",l)}return[2]})})}))},t.prototype._createIncomingRequestTelemetry=function(e,r,n,o){var s=this._getFuncModelHelper().getStatusCodes(r),a=200;if(s)for(var c=0,u=s;c<u.length;c++){var l=u[c];if(typeof l=="number"&&Number.isInteger(l)){a=l;break}else if(typeof l=="string"){var d=parseInt(l);if(!isNaN(d)){a=d;break}}}else a=void 0;this._client.trackRequest({name:e.method+" "+e.url,resultCode:a,success:typeof a=="number"?0<a&&a<400:void 0,url:e.url,time:new Date(n),duration:Date.now()-n,id:o}),this._client.flush()},t.prototype._removeInvocationHooks=function(){this._preInvocationHook&&(this._preInvocationHook.dispose(),this._preInvocationHook=void 0),this._postInvocationHook&&(this._postInvocationHook.dispose(),this._postInvocationHook=void 0)},t}();v0.AzureFunctionsHook=Yst;var Qst=function(){function t(){}return t.prototype._getInvocationContext=function(e){return e.invocationContext},t.prototype.getStatusCodes=function(e){var r=this._getInvocationContext(e),n,o=r.bindingDefinitions.find(function(s){return s.direction==="out"&&s.type.toLowerCase()==="http"});return o?.name==="$return"?n=e.result:o&&r.bindings&&r.bindings[o.name]!==void 0?n=r.bindings[o.name]:n=r.res,n?[n.statusCode,n.status]:void 0},t.prototype.isHttpTrigger=function(e){var r=this._getInvocationContext(e);return!!r.bindingDefinitions.find(function(n){var o;return((o=n.type)===null||o===void 0?void 0:o.toLowerCase())==="httptrigger"})},t}(),Xst=function(){function t(){}return t.prototype._getInvocationContext=function(e){return e.invocationContext},t.prototype.getStatusCodes=function(e){var r=e.result;return r?[r.status]:void 0},t.prototype.isHttpTrigger=function(e){var r=this._getInvocationContext(e);return r.options.trigger.type.toLowerCase()==="httptrigger"},t}()});var iZ=O((QDr,Kwe)=>{"use strict";var Jst=v_(),$we=UJ(),Zst=Wn(),Wwe=fi(),eat=require("url"),tat=JF(),rat=function(){function t(e){this._endpointBase=Wwe.DEFAULT_BREEZE_ENDPOINT,this._mergeConfig();var r=this._connectionString,n=$we.parse(e),o=$we.parse(r),s=!n.instrumentationkey&&Object.keys(n).length>0?null:e,a=this._instrumentationKey;this.instrumentationKey=n.instrumentationkey||s||o.instrumentationkey||a;var c=""+(this.endpointUrl||n.ingestionendpoint||o.ingestionendpoint||this._endpointBase);c.endsWith("/")&&(c=c.slice(0,-1)),this.endpointUrl=c+"/v2.1/track",this.maxBatchSize=this.maxBatchSize||250,this.maxBatchIntervalMs=this.maxBatchIntervalMs||15e3,this.disableAppInsights=this.disableAppInsights||!1,this.samplingPercentage=this.samplingPercentage||100,this.correlationIdRetryIntervalMs=this.correlationIdRetryIntervalMs||30*1e3,this.enableWebInstrumentation=this.enableWebInstrumentation||this.enableAutoWebSnippetInjection||!1,this.webInstrumentationConfig=this.webInstrumentationConfig||null,this.enableAutoWebSnippetInjection=this.enableWebInstrumentation,this.correlationHeaderExcludedDomains=this.correlationHeaderExcludedDomains||["*.core.windows.net","*.core.chinacloudapi.cn","*.core.cloudapi.de","*.core.usgovcloudapi.net","*.core.microsoft.scloud","*.core.eaglex.ic.gov"],this.ignoreLegacyHeaders=this.ignoreLegacyHeaders||!1,this.profileQueryEndpoint=n.ingestionendpoint||o.ingestionendpoint||process.env[t.ENV_profileQueryEndpoint]||this._endpointBase,this.quickPulseHost=this.quickPulseHost||n.liveendpoint||o.liveendpoint||process.env[t.ENV_quickPulseHost]||Wwe.DEFAULT_LIVEMETRICS_HOST,this.webInstrumentationConnectionString=this.webInstrumentationConnectionString||this._webInstrumentationConnectionString||"",this.webSnippetConnectionString=this.webInstrumentationConnectionString,this.quickPulseHost.match(/^https?:\/\//)&&(this.quickPulseHost=new eat.URL(this.quickPulseHost).host),this.aadAudience=n.aadaudience||o.aadaudience}return Object.defineProperty(t.prototype,"profileQueryEndpoint",{get:function(){return this._profileQueryEndpoint},set:function(e){this._profileQueryEndpoint=e,this.correlationId=Jst.correlationIdPrefix},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"instrumentationKey",{get:function(){return this._instrumentationKey},set:function(e){t._validateInstrumentationKey(e)||Zst.warn("An invalid instrumentation key was provided. There may be resulting telemetry loss",this.instrumentationKey),this._instrumentationKey=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"webSnippetConnectionString",{get:function(){return this._webInstrumentationConnectionString},set:function(e){this._webInstrumentationConnectionString=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"webInstrumentationConnectionString",{get:function(){return this._webInstrumentationConnectionString},set:function(e){this._webInstrumentationConnectionString=e},enumerable:!1,configurable:!0}),t.prototype._mergeConfig=function(){var e=tat.JsonConfig.getInstance();this._connectionString=e.connectionString,this._instrumentationKey=e.instrumentationKey,this.correlationHeaderExcludedDomains=e.correlationHeaderExcludedDomains,this.correlationIdRetryIntervalMs=e.correlationIdRetryIntervalMs,this.disableAllExtendedMetrics=e.disableAllExtendedMetrics,this.disableAppInsights=e.disableAppInsights,this.disableStatsbeat=e.disableStatsbeat,this.distributedTracingMode=e.distributedTracingMode,this.enableAutoCollectConsole=e.enableAutoCollectConsole,this.enableLoggerErrorToTrace=e.enableLoggerErrorToTrace,this.enableAutoCollectDependencies=e.enableAutoCollectDependencies,this.enableAutoCollectIncomingRequestAzureFunctions=e.enableAutoCollectIncomingRequestAzureFunctions,this.enableAutoCollectExceptions=e.enableAutoCollectExceptions,this.enableAutoCollectExtendedMetrics=e.enableAutoCollectExtendedMetrics,this.enableAutoCollectExternalLoggers=e.enableAutoCollectExternalLoggers,this.enableAutoCollectHeartbeat=e.enableAutoCollectHeartbeat,this.enableAutoCollectPerformance=e.enableAutoCollectPerformance,this.enableAutoCollectPreAggregatedMetrics=e.enableAutoCollectPreAggregatedMetrics,this.enableAutoCollectRequests=e.enableAutoCollectRequests,this.enableAutoDependencyCorrelation=e.enableAutoDependencyCorrelation,this.enableInternalDebugLogging=e.enableInternalDebugLogging,this.enableInternalWarningLogging=e.enableInternalWarningLogging,this.enableResendInterval=e.enableResendInterval,this.enableMaxBytesOnDisk=e.enableMaxBytesOnDisk,this.enableSendLiveMetrics=e.enableSendLiveMetrics,this.enableUseAsyncHooks=e.enableUseAsyncHooks,this.enableUseDiskRetryCaching=e.enableUseDiskRetryCaching,this.endpointUrl=e.endpointUrl,this.extendedMetricDisablers=e.extendedMetricDisablers,this.ignoreLegacyHeaders=e.ignoreLegacyHeaders,this.maxBatchIntervalMs=e.maxBatchIntervalMs,this.maxBatchSize=e.maxBatchSize,this.proxyHttpUrl=e.proxyHttpUrl,this.proxyHttpsUrl=e.proxyHttpsUrl,this.quickPulseHost=e.quickPulseHost,this.samplingPercentage=e.samplingPercentage,this.enableWebInstrumentation=e.enableWebInstrumentation,this._webInstrumentationConnectionString=e.webInstrumentationConnectionString,this.webInstrumentationConfig=e.webInstrumentationConfig,this.webInstrumentationSrc=e.webInstrumentationSrc},t._validateInstrumentationKey=function(e){var r="^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",n=new RegExp(r);return n.test(e)},t.ENV_azurePrefix="APPSETTING_",t.ENV_iKey="APPINSIGHTS_INSTRUMENTATIONKEY",t.legacy_ENV_iKey="APPINSIGHTS_INSTRUMENTATION_KEY",t.ENV_profileQueryEndpoint="APPINSIGHTS_PROFILE_QUERY_ENDPOINT",t.ENV_quickPulseHost="APPINSIGHTS_QUICKPULSE_HOST",t}();Kwe.exports=rat});function s9(){return oZ.create()}var Ywe,oZ,sZ=A(()=>{Ywe=new Set(["Deserialize","Serialize","Retry","Sign"]),oZ=class t{constructor(e){var r;this._policies=[],this._policies=(r=e?.slice(0))!==null&&r!==void 0?r:[],this._orderedPolicies=void 0}addPolicy(e,r={}){if(r.phase&&r.afterPhase)throw new Error("Policies inside a phase cannot specify afterPhase.");if(r.phase&&!Ywe.has(r.phase))throw new Error(`Invalid phase name: ${r.phase}`);if(r.afterPhase&&!Ywe.has(r.afterPhase))throw new Error(`Invalid afterPhase name: ${r.afterPhase}`);this._policies.push({policy:e,options:r}),this._orderedPolicies=void 0}removePolicy(e){let r=[];return this._policies=this._policies.filter(n=>e.name&&n.policy.name===e.name||e.phase&&n.options.phase===e.phase?(r.push(n.policy),!1):!0),this._orderedPolicies=void 0,r}sendRequest(e,r){return this.getOrderedPolicies().reduceRight((s,a)=>c=>a.sendRequest(c,s),s=>e.sendRequest(s))(r)}getOrderedPolicies(){return this._orderedPolicies||(this._orderedPolicies=this.orderPolicies()),this._orderedPolicies}clone(){return new t(this._policies)}static create(){return new t}orderPolicies(){let e=[],r=new Map;function n(h){return{name:h,policies:new Set,hasRun:!1,hasAfterPolicies:!1}}let o=n("Serialize"),s=n("None"),a=n("Deserialize"),c=n("Retry"),u=n("Sign"),l=[o,s,a,c,u];function d(h){return h==="Retry"?c:h==="Serialize"?o:h==="Deserialize"?a:h==="Sign"?u:s}for(let h of this._policies){let g=h.policy,v=h.options,y=g.name;if(r.has(y))throw new Error("Duplicate policy names not allowed in pipeline");let _={policy:g,dependsOn:new Set,dependants:new Set};v.afterPhase&&(_.afterPhase=d(v.afterPhase),_.afterPhase.hasAfterPolicies=!0),r.set(y,_),d(v.phase).policies.add(_)}for(let h of this._policies){let{policy:g,options:v}=h,y=g.name,_=r.get(y);if(!_)throw new Error(`Missing node for policy ${y}`);if(v.afterPolicies)for(let x of v.afterPolicies){let S=r.get(x);S&&(_.dependsOn.add(S),S.dependants.add(_))}if(v.beforePolicies)for(let x of v.beforePolicies){let S=r.get(x);S&&(S.dependsOn.add(_),_.dependants.add(S))}}function p(h){h.hasRun=!0;for(let g of h.policies)if(!(g.afterPhase&&(!g.afterPhase.hasRun||g.afterPhase.policies.size))&&g.dependsOn.size===0){e.push(g.policy);for(let v of g.dependants)v.dependsOn.delete(g);r.delete(g.policy.name),h.policies.delete(g)}}function f(){for(let h of l){if(p(h),h.policies.size>0&&h!==s){s.hasRun||p(s);return}h.hasAfterPolicies&&p(s)}}let m=0;for(;r.size>0;){m++;let h=e.length;if(f(),e.length<=h&&m>1)throw new Error("Cannot satisfy policy dependencies due to requirements cycle.")}return e}}});function Jwe(t,...e){process.stderr.write(`${Xwe.default.format(t,...e)}${Qwe.EOL}`)}var Qwe,Xwe,Zwe=A(()=>{Qwe=require("os"),Xwe=H(require("util"))});function uZ(t){tRe=t,aZ=[],cZ=[];let e=/\*/g,r=t.split(",").map(n=>n.trim().replace(e,".*?"));for(let n of r)n.startsWith("-")?cZ.push(new RegExp(`^${n.substr(1)}$`)):aZ.push(new RegExp(`^${n}$`));for(let n of a9)n.enabled=lZ(n.namespace)}function lZ(t){if(t.endsWith("*"))return!0;for(let e of cZ)if(e.test(t))return!1;for(let e of aZ)if(e.test(t))return!0;return!1}function nat(){let t=tRe||"";return uZ(""),t}function nRe(t){let e=Object.assign(r,{enabled:lZ(t),destroy:iat,log:rRe.log,namespace:t,extend:oat});function r(...n){e.enabled&&(n.length>0&&(n[0]=`${t} ${n[0]}`),e.log(...n))}return a9.push(e),e}function iat(){let t=a9.indexOf(this);return t>=0?(a9.splice(t,1),!0):!1}function oat(t){let e=nRe(`${this.namespace}:${t}`);return e.log=this.log,e}var eRe,tRe,aZ,cZ,a9,rRe,mE,iRe=A(()=>{Zwe();eRe=typeof process<"u"&&process.env&&process.env.DEBUG||void 0,aZ=[],cZ=[],a9=[];eRe&&uZ(eRe);rRe=Object.assign(t=>nRe(t),{enable:uZ,enabled:lZ,disable:nat,log:Jwe});mE=rRe});function sat(t){if(t&&!uRe(t))throw new Error(`Unknown log level '${t}'. Acceptable values: ${fZ.join(",")}`);dZ=t;let e=[];for(let r of sRe)cRe(r)&&e.push(r.namespace);mE.enable(e.join(","))}function l9(t){let e=pZ.extend(t);return aRe(pZ,e),{error:u9(e,"error"),warning:u9(e,"warning"),info:u9(e,"info"),verbose:u9(e,"verbose")}}function aRe(t,e){e.log=(...r)=>{t.log(...r)}}function u9(t,e){let r=Object.assign(t.extend(e),{level:e});if(aRe(t,r),cRe(r)){let n=mE.disable();mE.enable(n+","+r.namespace)}return sRe.add(r),r}function cRe(t){return!!(dZ&&oRe[t.level]<=oRe[dZ])}function uRe(t){return fZ.includes(t)}var sRe,c9,dZ,pZ,fZ,oRe,mZ=A(()=>{iRe();sRe=new Set,c9=typeof process<"u"&&process.env&&process.env.AZURE_LOG_LEVEL||void 0,pZ=mE("azure");pZ.log=(...t)=>{mE.log(...t)};fZ=["verbose","info","warning","error"];c9&&(uRe(c9)?sat(c9):console.error(`AZURE_LOG_LEVEL set to unknown log level '${c9}'; logging is not enabled. Acceptable values: ${fZ.join(", ")}.`));oRe={verbose:400,info:300,warning:200,error:100}});var ws,hE=A(()=>{mZ();ws=l9("core-rest-pipeline")});var hZ,d9,lRe=A(()=>{d9=typeof process<"u"&&!!process.version&&!!(!((hZ=process.versions)===null||hZ===void 0)&&hZ.node)});function gZ(t){if(t.aborted)return;t.onabort&&t.onabort.call(t);let e=gE.get(t);e&&e.slice().forEach(r=>{r.call(t,{type:"abort"})}),p9.set(t,!0)}var gE,p9,jA,dRe=A(()=>{gE=new WeakMap,p9=new WeakMap,jA=class t{constructor(){this.onabort=null,gE.set(this,[]),p9.set(this,!1)}get aborted(){if(!p9.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");return p9.get(this)}static get none(){return new t}addEventListener(e,r){if(!gE.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");gE.get(this).push(r)}removeEventListener(e,r){if(!gE.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");let n=gE.get(this),o=n.indexOf(r);o>-1&&n.splice(o,1)}dispatchEvent(e){throw new Error("This is a stub dispatchEvent implementation that should not be used.  It only exists for type-checking purposes.")}}});var Hp,HA,pRe=A(()=>{dRe();Hp=class extends Error{constructor(e){super(e),this.name="AbortError"}},HA=class{constructor(e){if(this._signal=new jA,!!e){Array.isArray(e)||(e=arguments);for(let r of e)r.aborted?this.abort():r.addEventListener("abort",()=>{this.abort()})}}get signal(){return this._signal}abort(){gZ(this._signal)}static timeout(e){let r=new jA,n=setTimeout(gZ,e,r);return typeof n.unref=="function"&&n.unref(),r}}});var f9=A(()=>{pRe()});function vZ(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}var fRe=A(()=>{});function VA(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&!(t instanceof RegExp)&&!(t instanceof Date)}var bZ=A(()=>{});function vE(t){if(VA(t)){let e=typeof t.name=="string",r=typeof t.message=="string";return e&&r}return!1}function bE(t){if(vE(t))return t.message;{let e;try{typeof t=="object"&&t?e=JSON.stringify(t):e=String(t)}catch{e="[unable to stringify input]"}return`Unknown error ${e}`}}var mRe=A(()=>{bZ()});var yE=A(()=>{lRe();fRe();bZ();mRe()});var yZ,aat,cat,_E,_Z=A(()=>{yE();yZ="REDACTED",aat=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent","WWW-Authenticate"],cat=["api-version"],_E=class{constructor({additionalAllowedHeaderNames:e=[],additionalAllowedQueryParameters:r=[]}={}){e=aat.concat(e),r=cat.concat(r),this.allowedHeaderNames=new Set(e.map(n=>n.toLowerCase())),this.allowedQueryParameters=new Set(r.map(n=>n.toLowerCase()))}sanitize(e){let r=new Set;return JSON.stringify(e,(n,o)=>{if(o instanceof Error)return Object.assign(Object.assign({},o),{name:o.name,message:o.message});if(n==="headers")return this.sanitizeHeaders(o);if(n==="url")return this.sanitizeUrl(o);if(n==="query")return this.sanitizeQuery(o);if(n==="body")return;if(n==="response")return;if(n==="operationSpec")return;if(Array.isArray(o)||VA(o)){if(r.has(o))return"[Circular]";r.add(o)}return o},2)}sanitizeHeaders(e){let r={};for(let n of Object.keys(e))this.allowedHeaderNames.has(n.toLowerCase())?r[n]=e[n]:r[n]=yZ;return r}sanitizeQuery(e){if(typeof e!="object"||e===null)return e;let r={};for(let n of Object.keys(e))this.allowedQueryParameters.has(n.toLowerCase())?r[n]=e[n]:r[n]=yZ;return r}sanitizeUrl(e){if(typeof e!="string"||e===null)return e;let r=new URL(e);if(!r.search)return e;for(let[n]of r.searchParams)this.allowedQueryParameters.has(n.toLowerCase())||r.searchParams.set(n,yZ);return r.toString()}}});function m9(t={}){var e;let r=(e=t.logger)!==null&&e!==void 0?e:ws.info,n=new _E({additionalAllowedHeaderNames:t.additionalAllowedHeaderNames,additionalAllowedQueryParameters:t.additionalAllowedQueryParameters});return{name:xZ,async sendRequest(o,s){if(!r.enabled)return s(o);r(`Request: ${n.sanitize(o)}`);let a=await s(o);return r(`Response status code: ${a.status}`),r(`Headers: ${n.sanitize(a.headers)}`),a}}}var xZ,SZ=A(()=>{hE();_Z();xZ="logPolicy"});function h9(t={}){let{maxRetries:e=20}=t;return{name:IZ,async sendRequest(r,n){let o=await n(r);return gRe(n,o,e)}}}async function gRe(t,e,r,n=0){let{request:o,status:s,headers:a}=e,c=a.get("location");if(c&&(s===300||s===301&&hRe.includes(o.method)||s===302&&hRe.includes(o.method)||s===303&&o.method==="POST"||s===307)&&n<r){let u=new URL(c,o.url);o.url=u.toString(),s===303&&(o.method="GET",o.headers.delete("Content-Length"),delete o.body),o.headers.delete("Authorization");let l=await t(o);return gRe(t,l,r,n+1)}return e}var IZ,hRe,CZ=A(()=>{IZ="redirectPolicy",hRe=["GET","HEAD"]});function vRe(){return"User-Agent"}function bRe(t){t.set("Node",process.version),t.set("OS",`(${xE.arch()}-${xE.type()}-${xE.release()})`)}var xE,yRe=A(()=>{xE=H(require("os"))});var g9,TZ=A(()=>{g9="1.10.1"});function uat(t){let e=[];for(let[r,n]of t){let o=n?`${r}/${n}`:r;e.push(o)}return e.join(" ")}function _Re(){return vRe()}function v9(t){let e=new Map;e.set("core-rest-pipeline",g9),bRe(e);let r=uat(e);return t?`${t} ${r}`:r}var EZ=A(()=>{yRe();TZ()});function b9(t={}){let e=v9(t.userAgentPrefix);return{name:wZ,async sendRequest(r,n){return r.headers.has(xRe)||r.headers.set(xRe,e),n(r)}}}var xRe,wZ,RZ=A(()=>{EZ();xRe=_Re(),wZ="userAgentPolicy"});function y9(){return{name:kZ,async sendRequest(t,e){return t.method!=="HEAD"&&t.headers.set("Accept-Encoding","gzip,deflate"),e(t)}}}var kZ,PZ=A(()=>{kZ="decompressResponsePolicy"});function _9(t,e,r){return new Promise((n,o)=>{let s,a,c=()=>o(new Hp(r?.abortErrorMsg?r?.abortErrorMsg:lat)),u=()=>{r?.abortSignal&&a&&r.abortSignal.removeEventListener("abort",a)};if(a=()=>(s&&clearTimeout(s),u(),c()),r?.abortSignal&&r.abortSignal.aborted)return c();s=setTimeout(()=>{u(),n(e)},t),r?.abortSignal&&r.abortSignal.addEventListener("abort",a)})}function SRe(t,e){let r=t.headers.get(e);if(!r)return;let n=Number(r);if(!Number.isNaN(n))return n}var lat,x9=A(()=>{f9();lat="The operation was aborted."});function IRe(t){if(t&&[429,503].includes(t.status))try{for(let o of dat){let s=SRe(t,o);if(s===0||s)return s*(o===AZ?1e3:1)}let e=t.headers.get(AZ);if(!e)return;let n=Date.parse(e)-Date.now();return Number.isFinite(n)?Math.max(0,n):void 0}catch{return}}function CRe(t){return Number.isFinite(IRe(t))}function S9(){return{name:"throttlingRetryStrategy",retry({response:t}){let e=IRe(t);return Number.isFinite(e)?{retryAfterInMs:e}:{skipStrategy:!0}}}}var AZ,dat,I9=A(()=>{x9();AZ="Retry-After",dat=["retry-after-ms","x-ms-retry-after-ms",AZ]});function SE(t={}){var e,r;let n=(e=t.retryDelayInMs)!==null&&e!==void 0?e:pat,o=(r=t.maxRetryDelayInMs)!==null&&r!==void 0?r:fat,s=n;return{name:"exponentialRetryStrategy",retry({retryCount:a,response:c,responseError:u}){let l=hat(u),d=l&&t.ignoreSystemErrors,p=mat(c),f=p&&t.ignoreHttpStatusCodes;if(c&&(CRe(c)||!p)||f||d)return{skipStrategy:!0};if(u&&!l&&!p)return{errorToThrow:u};let h=s*Math.pow(2,a),g=Math.min(o,h);return s=g/2+vZ(0,g/2),{retryAfterInMs:s}}}}function mat(t){return!!(t&&t.status!==void 0&&(t.status>=500||t.status===408)&&t.status!==501&&t.status!==505)}function hat(t){return t?t.code==="ETIMEDOUT"||t.code==="ESOCKETTIMEDOUT"||t.code==="ECONNREFUSED"||t.code==="ECONNRESET"||t.code==="ENOENT":!1}var pat,fat,C9=A(()=>{yE();I9();pat=1e3,fat=1e3*64});function Vp(t,e={maxRetries:3}){let r=e.logger||TRe;return{name:gat,async sendRequest(n,o){var s,a;let c,u,l=-1;e:for(;;){l+=1,c=void 0,u=void 0;try{r.info(`Retry ${l}: Attempting to send request`,n.requestId),c=await o(n),r.info(`Retry ${l}: Received a response from request`,n.requestId)}catch(d){if(r.error(`Retry ${l}: Received an error from request`,n.requestId),u=d,!d||u.name!=="RestError")throw d;c=u.response}if(!((s=n.abortSignal)===null||s===void 0)&&s.aborted)throw r.error(`Retry ${l}: Request aborted.`),new Hp;if(l>=((a=e.maxRetries)!==null&&a!==void 0?a:3)){if(r.info(`Retry ${l}: Maximum retries reached. Returning the last received response, or throwing the last received error.`),u)throw u;if(c)return c;throw new Error("Maximum retries reached with no response or error to throw")}r.info(`Retry ${l}: Processing ${t.length} retry strategies.`);t:for(let d of t){let p=d.logger||TRe;p.info(`Retry ${l}: Processing retry strategy ${d.name}.`);let f=d.retry({retryCount:l,response:c,responseError:u});if(f.skipStrategy){p.info(`Retry ${l}: Skipped.`);continue t}let{errorToThrow:m,retryAfterInMs:h,redirectTo:g}=f;if(m)throw p.error(`Retry ${l}: Retry strategy ${d.name} throws error:`,m),m;if(h||h===0){p.info(`Retry ${l}: Retry strategy ${d.name} retries after ${h}`),await _9(h,void 0,{abortSignal:n.abortSignal});continue e}if(g){p.info(`Retry ${l}: Retry strategy ${d.name} redirects to ${g}`),n.url=g;continue e}}if(u)throw r.info("None of the retry strategies could work with the received error. Throwing it."),u;if(c)return r.info("None of the retry strategies could work with the received response. Returning it."),c}}}}var TRe,gat,IE=A(()=>{x9();mZ();f9();TRe=l9("core-rest-pipeline retryPolicy"),gat="retryPolicy"});function T9(t={}){var e;return{name:vat,sendRequest:Vp([S9(),SE(t)],{maxRetries:(e=t.maxRetries)!==null&&e!==void 0?e:3}).sendRequest}}var vat,DZ=A(()=>{C9();I9();IE();vat="defaultRetryPolicy"});var RRe=O((YNr,wRe)=>{var ERe=require("stream").Stream,bat=require("util");wRe.exports=ad;function ad(){this.source=null,this.dataSize=0,this.maxDataSize=1024*1024,this.pauseStream=!0,this._maxDataSizeExceeded=!1,this._released=!1,this._bufferedEvents=[]}bat.inherits(ad,ERe);ad.create=function(t,e){var r=new this;e=e||{};for(var n in e)r[n]=e[n];r.source=t;var o=t.emit;return t.emit=function(){return r._handleEmit(arguments),o.apply(t,arguments)},t.on("error",function(){}),r.pauseStream&&t.pause(),r};Object.defineProperty(ad.prototype,"readable",{configurable:!0,enumerable:!0,get:function(){return this.source.readable}});ad.prototype.setEncoding=function(){return this.source.setEncoding.apply(this.source,arguments)};ad.prototype.resume=function(){this._released||this.release(),this.source.resume()};ad.prototype.pause=function(){this.source.pause()};ad.prototype.release=function(){this._released=!0,this._bufferedEvents.forEach(function(t){this.emit.apply(this,t)}.bind(this)),this._bufferedEvents=[]};ad.prototype.pipe=function(){var t=ERe.prototype.pipe.apply(this,arguments);return this.resume(),t};ad.prototype._handleEmit=function(t){if(this._released){this.emit.apply(this,t);return}t[0]==="data"&&(this.dataSize+=t[1].length,this._checkIfMaxDataSizeExceeded()),this._bufferedEvents.push(t)};ad.prototype._checkIfMaxDataSizeExceeded=function(){if(!this._maxDataSizeExceeded&&!(this.dataSize<=this.maxDataSize)){this._maxDataSizeExceeded=!0;var t="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this.emit("error",new Error(t))}}});var DRe=O((QNr,ARe)=>{var yat=require("util"),PRe=require("stream").Stream,kRe=RRe();ARe.exports=Oi;function Oi(){this.writable=!1,this.readable=!0,this.dataSize=0,this.maxDataSize=2*1024*1024,this.pauseStreams=!0,this._released=!1,this._streams=[],this._currentStream=null,this._insideLoop=!1,this._pendingNext=!1}yat.inherits(Oi,PRe);Oi.create=function(t){var e=new this;t=t||{};for(var r in t)e[r]=t[r];return e};Oi.isStreamLike=function(t){return typeof t!="function"&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"&&!Buffer.isBuffer(t)};Oi.prototype.append=function(t){var e=Oi.isStreamLike(t);if(e){if(!(t instanceof kRe)){var r=kRe.create(t,{maxDataSize:1/0,pauseStream:this.pauseStreams});t.on("data",this._checkDataSize.bind(this)),t=r}this._handleErrors(t),this.pauseStreams&&t.pause()}return this._streams.push(t),this};Oi.prototype.pipe=function(t,e){return PRe.prototype.pipe.call(this,t,e),this.resume(),t};Oi.prototype._getNext=function(){if(this._currentStream=null,this._insideLoop){this._pendingNext=!0;return}this._insideLoop=!0;try{do this._pendingNext=!1,this._realGetNext();while(this._pendingNext)}finally{this._insideLoop=!1}};Oi.prototype._realGetNext=function(){var t=this._streams.shift();if(typeof t>"u"){this.end();return}if(typeof t!="function"){this._pipeNext(t);return}var e=t;e(function(r){var n=Oi.isStreamLike(r);n&&(r.on("data",this._checkDataSize.bind(this)),this._handleErrors(r)),this._pipeNext(r)}.bind(this))};Oi.prototype._pipeNext=function(t){this._currentStream=t;var e=Oi.isStreamLike(t);if(e){t.on("end",this._getNext.bind(this)),t.pipe(this,{end:!1});return}var r=t;this.write(r),this._getNext()};Oi.prototype._handleErrors=function(t){var e=this;t.on("error",function(r){e._emitError(r)})};Oi.prototype.write=function(t){this.emit("data",t)};Oi.prototype.pause=function(){this.pauseStreams&&(this.pauseStreams&&this._currentStream&&typeof this._currentStream.pause=="function"&&this._currentStream.pause(),this.emit("pause"))};Oi.prototype.resume=function(){this._released||(this._released=!0,this.writable=!0,this._getNext()),this.pauseStreams&&this._currentStream&&typeof this._currentStream.resume=="function"&&this._currentStream.resume(),this.emit("resume")};Oi.prototype.end=function(){this._reset(),this.emit("end")};Oi.prototype.destroy=function(){this._reset(),this.emit("close")};Oi.prototype._reset=function(){this.writable=!1,this._streams=[],this._currentStream=null};Oi.prototype._checkDataSize=function(){if(this._updateDataSize(),!(this.dataSize<=this.maxDataSize)){var t="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this._emitError(new Error(t))}};Oi.prototype._updateDataSize=function(){this.dataSize=0;var t=this;this._streams.forEach(function(e){e.dataSize&&(t.dataSize+=e.dataSize)}),this._currentStream&&this._currentStream.dataSize&&(this.dataSize+=this._currentStream.dataSize)};Oi.prototype._emitError=function(t){this._reset(),this.emit("error",t)}});var NRe=O((XNr,_at)=>{_at.exports={"application/1d-interleaved-parityfec":{source:"iana"},"application/3gpdash-qoe-report+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/3gpp-ims+xml":{source:"iana",compressible:!0},"application/3gpphal+json":{source:"iana",compressible:!0},"application/3gpphalforms+json":{source:"iana",compressible:!0},"application/a2l":{source:"iana"},"application/ace+cbor":{source:"iana"},"application/activemessage":{source:"iana"},"application/activity+json":{source:"iana",compressible:!0},"application/alto-costmap+json":{source:"iana",compressible:!0},"application/alto-costmapfilter+json":{source:"iana",compressible:!0},"application/alto-directory+json":{source:"iana",compressible:!0},"application/alto-endpointcost+json":{source:"iana",compressible:!0},"application/alto-endpointcostparams+json":{source:"iana",compressible:!0},"application/alto-endpointprop+json":{source:"iana",compressible:!0},"application/alto-endpointpropparams+json":{source:"iana",compressible:!0},"application/alto-error+json":{source:"iana",compressible:!0},"application/alto-networkmap+json":{source:"iana",compressible:!0},"application/alto-networkmapfilter+json":{source:"iana",compressible:!0},"application/alto-updatestreamcontrol+json":{source:"iana",compressible:!0},"application/alto-updatestreamparams+json":{source:"iana",compressible:!0},"application/aml":{source:"iana"},"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applefile":{source:"iana"},"application/applixware":{source:"apache",extensions:["aw"]},"application/at+jwt":{source:"iana"},"application/atf":{source:"iana"},"application/atfx":{source:"iana"},"application/atom+xml":{source:"iana",compressible:!0,extensions:["atom"]},"application/atomcat+xml":{source:"iana",compressible:!0,extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",compressible:!0,extensions:["atomdeleted"]},"application/atomicmail":{source:"iana"},"application/atomsvc+xml":{source:"iana",compressible:!0,extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",compressible:!0,extensions:["dwd"]},"application/atsc-dynamic-event-message":{source:"iana"},"application/atsc-held+xml":{source:"iana",compressible:!0,extensions:["held"]},"application/atsc-rdt+json":{source:"iana",compressible:!0},"application/atsc-rsat+xml":{source:"iana",compressible:!0,extensions:["rsat"]},"application/atxml":{source:"iana"},"application/auth-policy+xml":{source:"iana",compressible:!0},"application/bacnet-xdd+zip":{source:"iana",compressible:!1},"application/batch-smtp":{source:"iana"},"application/bdoc":{compressible:!1,extensions:["bdoc"]},"application/beep+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/calendar+json":{source:"iana",compressible:!0},"application/calendar+xml":{source:"iana",compressible:!0,extensions:["xcs"]},"application/call-completion":{source:"iana"},"application/cals-1840":{source:"iana"},"application/captive+json":{source:"iana",compressible:!0},"application/cbor":{source:"iana"},"application/cbor-seq":{source:"iana"},"application/cccex":{source:"iana"},"application/ccmp+xml":{source:"iana",compressible:!0},"application/ccxml+xml":{source:"iana",compressible:!0,extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",compressible:!0,extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cdni":{source:"iana"},"application/cea":{source:"iana"},"application/cea-2018+xml":{source:"iana",compressible:!0},"application/cellml+xml":{source:"iana",compressible:!0},"application/cfw":{source:"iana"},"application/city+json":{source:"iana",compressible:!0},"application/clr":{source:"iana"},"application/clue+xml":{source:"iana",compressible:!0},"application/clue_info+xml":{source:"iana",compressible:!0},"application/cms":{source:"iana"},"application/cnrp+xml":{source:"iana",compressible:!0},"application/coap-group+json":{source:"iana",compressible:!0},"application/coap-payload":{source:"iana"},"application/commonground":{source:"iana"},"application/conference-info+xml":{source:"iana",compressible:!0},"application/cose":{source:"iana"},"application/cose-key":{source:"iana"},"application/cose-key-set":{source:"iana"},"application/cpl+xml":{source:"iana",compressible:!0,extensions:["cpl"]},"application/csrattrs":{source:"iana"},"application/csta+xml":{source:"iana",compressible:!0},"application/cstadata+xml":{source:"iana",compressible:!0},"application/csvm+json":{source:"iana",compressible:!0},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/cwt":{source:"iana"},"application/cybercash":{source:"iana"},"application/dart":{compressible:!0},"application/dash+xml":{source:"iana",compressible:!0,extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",compressible:!0,extensions:["mpp"]},"application/dashdelta":{source:"iana"},"application/davmount+xml":{source:"iana",compressible:!0,extensions:["davmount"]},"application/dca-rft":{source:"iana"},"application/dcd":{source:"iana"},"application/dec-dx":{source:"iana"},"application/dialog-info+xml":{source:"iana",compressible:!0},"application/dicom":{source:"iana"},"application/dicom+json":{source:"iana",compressible:!0},"application/dicom+xml":{source:"iana",compressible:!0},"application/dii":{source:"iana"},"application/dit":{source:"iana"},"application/dns":{source:"iana"},"application/dns+json":{source:"iana",compressible:!0},"application/dns-message":{source:"iana"},"application/docbook+xml":{source:"apache",compressible:!0,extensions:["dbk"]},"application/dots+cbor":{source:"iana"},"application/dskpp+xml":{source:"iana",compressible:!0},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",compressible:!0,extensions:["xdssc"]},"application/dvcs":{source:"iana"},"application/ecmascript":{source:"iana",compressible:!0,extensions:["es","ecma"]},"application/edi-consent":{source:"iana"},"application/edi-x12":{source:"iana",compressible:!1},"application/edifact":{source:"iana",compressible:!1},"application/efi":{source:"iana"},"application/elm+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/elm+xml":{source:"iana",compressible:!0},"application/emergencycalldata.cap+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/emergencycalldata.comment+xml":{source:"iana",compressible:!0},"application/emergencycalldata.control+xml":{source:"iana",compressible:!0},"application/emergencycalldata.deviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.ecall.msd":{source:"iana"},"application/emergencycalldata.providerinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.serviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.subscriberinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.veds+xml":{source:"iana",compressible:!0},"application/emma+xml":{source:"iana",compressible:!0,extensions:["emma"]},"application/emotionml+xml":{source:"iana",compressible:!0,extensions:["emotionml"]},"application/encaprtp":{source:"iana"},"application/epp+xml":{source:"iana",compressible:!0},"application/epub+zip":{source:"iana",compressible:!1,extensions:["epub"]},"application/eshop":{source:"iana"},"application/exi":{source:"iana",extensions:["exi"]},"application/expect-ct-report+json":{source:"iana",compressible:!0},"application/express":{source:"iana",extensions:["exp"]},"application/fastinfoset":{source:"iana"},"application/fastsoap":{source:"iana"},"application/fdt+xml":{source:"iana",compressible:!0,extensions:["fdt"]},"application/fhir+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/fhir+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/fido.trusted-apps+json":{compressible:!0},"application/fits":{source:"iana"},"application/flexfec":{source:"iana"},"application/font-sfnt":{source:"iana"},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/font-woff":{source:"iana",compressible:!1},"application/framework-attributes+xml":{source:"iana",compressible:!0},"application/geo+json":{source:"iana",compressible:!0,extensions:["geojson"]},"application/geo+json-seq":{source:"iana"},"application/geopackage+sqlite3":{source:"iana"},"application/geoxacml+xml":{source:"iana",compressible:!0},"application/gltf-buffer":{source:"iana"},"application/gml+xml":{source:"iana",compressible:!0,extensions:["gml"]},"application/gpx+xml":{source:"apache",compressible:!0,extensions:["gpx"]},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",compressible:!1,extensions:["gz"]},"application/h224":{source:"iana"},"application/held+xml":{source:"iana",compressible:!0},"application/hjson":{extensions:["hjson"]},"application/http":{source:"iana"},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/ibe-key-request+xml":{source:"iana",compressible:!0},"application/ibe-pkg-reply+xml":{source:"iana",compressible:!0},"application/ibe-pp-data":{source:"iana"},"application/iges":{source:"iana"},"application/im-iscomposing+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/index":{source:"iana"},"application/index.cmd":{source:"iana"},"application/index.obj":{source:"iana"},"application/index.response":{source:"iana"},"application/index.vnd":{source:"iana"},"application/inkml+xml":{source:"iana",compressible:!0,extensions:["ink","inkml"]},"application/iotp":{source:"iana"},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/ipp":{source:"iana"},"application/isup":{source:"iana"},"application/its+xml":{source:"iana",compressible:!0,extensions:["its"]},"application/java-archive":{source:"apache",compressible:!1,extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",compressible:!1,extensions:["ser"]},"application/java-vm":{source:"apache",compressible:!1,extensions:["class"]},"application/javascript":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["js","mjs"]},"application/jf2feed+json":{source:"iana",compressible:!0},"application/jose":{source:"iana"},"application/jose+json":{source:"iana",compressible:!0},"application/jrd+json":{source:"iana",compressible:!0},"application/jscalendar+json":{source:"iana",compressible:!0},"application/json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["json","map"]},"application/json-patch+json":{source:"iana",compressible:!0},"application/json-seq":{source:"iana"},"application/json5":{extensions:["json5"]},"application/jsonml+json":{source:"apache",compressible:!0,extensions:["jsonml"]},"application/jwk+json":{source:"iana",compressible:!0},"application/jwk-set+json":{source:"iana",compressible:!0},"application/jwt":{source:"iana"},"application/kpml-request+xml":{source:"iana",compressible:!0},"application/kpml-response+xml":{source:"iana",compressible:!0},"application/ld+json":{source:"iana",compressible:!0,extensions:["jsonld"]},"application/lgr+xml":{source:"iana",compressible:!0,extensions:["lgr"]},"application/link-format":{source:"iana"},"application/load-control+xml":{source:"iana",compressible:!0},"application/lost+xml":{source:"iana",compressible:!0,extensions:["lostxml"]},"application/lostsync+xml":{source:"iana",compressible:!0},"application/lpf+zip":{source:"iana",compressible:!1},"application/lxf":{source:"iana"},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/macwriteii":{source:"iana"},"application/mads+xml":{source:"iana",compressible:!0,extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",compressible:!0,extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",compressible:!0,extensions:["mathml"]},"application/mathml-content+xml":{source:"iana",compressible:!0},"application/mathml-presentation+xml":{source:"iana",compressible:!0},"application/mbms-associated-procedure-description+xml":{source:"iana",compressible:!0},"application/mbms-deregister+xml":{source:"iana",compressible:!0},"application/mbms-envelope+xml":{source:"iana",compressible:!0},"application/mbms-msk+xml":{source:"iana",compressible:!0},"application/mbms-msk-response+xml":{source:"iana",compressible:!0},"application/mbms-protection-description+xml":{source:"iana",compressible:!0},"application/mbms-reception-report+xml":{source:"iana",compressible:!0},"application/mbms-register+xml":{source:"iana",compressible:!0},"application/mbms-register-response+xml":{source:"iana",compressible:!0},"application/mbms-schedule+xml":{source:"iana",compressible:!0},"application/mbms-user-service-description+xml":{source:"iana",compressible:!0},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",compressible:!0,extensions:["mpf"]},"application/media_control+xml":{source:"iana",compressible:!0},"application/mediaservercontrol+xml":{source:"iana",compressible:!0,extensions:["mscml"]},"application/merge-patch+json":{source:"iana",compressible:!0},"application/metalink+xml":{source:"apache",compressible:!0,extensions:["metalink"]},"application/metalink4+xml":{source:"iana",compressible:!0,extensions:["meta4"]},"application/mets+xml":{source:"iana",compressible:!0,extensions:["mets"]},"application/mf4":{source:"iana"},"application/mikey":{source:"iana"},"application/mipc":{source:"iana"},"application/missing-blocks+cbor-seq":{source:"iana"},"application/mmt-aei+xml":{source:"iana",compressible:!0,extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",compressible:!0,extensions:["musd"]},"application/mods+xml":{source:"iana",compressible:!0,extensions:["mods"]},"application/moss-keys":{source:"iana"},"application/moss-signature":{source:"iana"},"application/mosskey-data":{source:"iana"},"application/mosskey-request":{source:"iana"},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4s","m4p"]},"application/mpeg4-generic":{source:"iana"},"application/mpeg4-iod":{source:"iana"},"application/mpeg4-iod-xmt":{source:"iana"},"application/mrb-consumer+xml":{source:"iana",compressible:!0},"application/mrb-publish+xml":{source:"iana",compressible:!0},"application/msc-ivr+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msc-mixer+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msword":{source:"iana",compressible:!1,extensions:["doc","dot"]},"application/mud+json":{source:"iana",compressible:!0},"application/multipart-core":{source:"iana"},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/nasdata":{source:"iana"},"application/news-checkgroups":{source:"iana",charset:"US-ASCII"},"application/news-groupinfo":{source:"iana",charset:"US-ASCII"},"application/news-transmission":{source:"iana"},"application/nlsml+xml":{source:"iana",compressible:!0},"application/node":{source:"iana",extensions:["cjs"]},"application/nss":{source:"iana"},"application/oauth-authz-req+jwt":{source:"iana"},"application/oblivious-dns-message":{source:"iana"},"application/ocsp-request":{source:"iana"},"application/ocsp-response":{source:"iana"},"application/octet-stream":{source:"iana",compressible:!1,extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/odm+xml":{source:"iana",compressible:!0},"application/odx":{source:"iana"},"application/oebps-package+xml":{source:"iana",compressible:!0,extensions:["opf"]},"application/ogg":{source:"iana",compressible:!1,extensions:["ogx"]},"application/omdoc+xml":{source:"apache",compressible:!0,extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/opc-nodeset+xml":{source:"iana",compressible:!0},"application/oscore":{source:"iana"},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p21":{source:"iana"},"application/p21+zip":{source:"iana",compressible:!1},"application/p2p-overlay+xml":{source:"iana",compressible:!0,extensions:["relo"]},"application/parityfec":{source:"iana"},"application/passport":{source:"iana"},"application/patch-ops-error+xml":{source:"iana",compressible:!0,extensions:["xer"]},"application/pdf":{source:"iana",compressible:!1,extensions:["pdf"]},"application/pdx":{source:"iana"},"application/pem-certificate-chain":{source:"iana"},"application/pgp-encrypted":{source:"iana",compressible:!1,extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["asc","sig"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pidf+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pidf-diff+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs12":{source:"iana"},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkcs8-encrypted":{source:"iana"},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",compressible:!0,extensions:["pls"]},"application/poc-settings+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/postscript":{source:"iana",compressible:!0,extensions:["ai","eps","ps"]},"application/ppsp-tracker+json":{source:"iana",compressible:!0},"application/problem+json":{source:"iana",compressible:!0},"application/problem+xml":{source:"iana",compressible:!0},"application/provenance+xml":{source:"iana",compressible:!0,extensions:["provx"]},"application/prs.alvestrand.titrax-sheet":{source:"iana"},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/prs.cyn":{source:"iana",charset:"7-BIT"},"application/prs.hpub+zip":{source:"iana",compressible:!1},"application/prs.nprend":{source:"iana"},"application/prs.plucker":{source:"iana"},"application/prs.rdf-xml-crypt":{source:"iana"},"application/prs.xsf+xml":{source:"iana",compressible:!0},"application/pskc+xml":{source:"iana",compressible:!0,extensions:["pskcxml"]},"application/pvd+json":{source:"iana",compressible:!0},"application/qsig":{source:"iana"},"application/raml+yaml":{compressible:!0,extensions:["raml"]},"application/raptorfec":{source:"iana"},"application/rdap+json":{source:"iana",compressible:!0},"application/rdf+xml":{source:"iana",compressible:!0,extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",compressible:!0,extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/remote-printing":{source:"iana"},"application/reputon+json":{source:"iana",compressible:!0},"application/resource-lists+xml":{source:"iana",compressible:!0,extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",compressible:!0,extensions:["rld"]},"application/rfc+xml":{source:"iana",compressible:!0},"application/riscos":{source:"iana"},"application/rlmi+xml":{source:"iana",compressible:!0},"application/rls-services+xml":{source:"iana",compressible:!0,extensions:["rs"]},"application/route-apd+xml":{source:"iana",compressible:!0,extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",compressible:!0,extensions:["sls"]},"application/route-usd+xml":{source:"iana",compressible:!0,extensions:["rusd"]},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-publication":{source:"iana"},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rpki-updown":{source:"iana"},"application/rsd+xml":{source:"apache",compressible:!0,extensions:["rsd"]},"application/rss+xml":{source:"apache",compressible:!0,extensions:["rss"]},"application/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"application/rtploopback":{source:"iana"},"application/rtx":{source:"iana"},"application/samlassertion+xml":{source:"iana",compressible:!0},"application/samlmetadata+xml":{source:"iana",compressible:!0},"application/sarif+json":{source:"iana",compressible:!0},"application/sarif-external-properties+json":{source:"iana",compressible:!0},"application/sbe":{source:"iana"},"application/sbml+xml":{source:"iana",compressible:!0,extensions:["sbml"]},"application/scaip+xml":{source:"iana",compressible:!0},"application/scim+json":{source:"iana",compressible:!0},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/secevent+jwt":{source:"iana"},"application/senml+cbor":{source:"iana"},"application/senml+json":{source:"iana",compressible:!0},"application/senml+xml":{source:"iana",compressible:!0,extensions:["senmlx"]},"application/senml-etch+cbor":{source:"iana"},"application/senml-etch+json":{source:"iana",compressible:!0},"application/senml-exi":{source:"iana"},"application/sensml+cbor":{source:"iana"},"application/sensml+json":{source:"iana",compressible:!0},"application/sensml+xml":{source:"iana",compressible:!0,extensions:["sensmlx"]},"application/sensml-exi":{source:"iana"},"application/sep+xml":{source:"iana",compressible:!0},"application/sep-exi":{source:"iana"},"application/session-info":{source:"iana"},"application/set-payment":{source:"iana"},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration":{source:"iana"},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/sgml":{source:"iana"},"application/sgml-open-catalog":{source:"iana"},"application/shf+xml":{source:"iana",compressible:!0,extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/simple-filter+xml":{source:"iana",compressible:!0},"application/simple-message-summary":{source:"iana"},"application/simplesymbolcontainer":{source:"iana"},"application/sipc":{source:"iana"},"application/slate":{source:"iana"},"application/smil":{source:"iana"},"application/smil+xml":{source:"iana",compressible:!0,extensions:["smi","smil"]},"application/smpte336m":{source:"iana"},"application/soap+fastinfoset":{source:"iana"},"application/soap+xml":{source:"iana",compressible:!0},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",compressible:!0,extensions:["srx"]},"application/spdx+json":{source:"iana",compressible:!0},"application/spirits-event+xml":{source:"iana",compressible:!0},"application/sql":{source:"iana"},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",compressible:!0,extensions:["grxml"]},"application/sru+xml":{source:"iana",compressible:!0,extensions:["sru"]},"application/ssdl+xml":{source:"apache",compressible:!0,extensions:["ssdl"]},"application/ssml+xml":{source:"iana",compressible:!0,extensions:["ssml"]},"application/stix+json":{source:"iana",compressible:!0},"application/swid+xml":{source:"iana",compressible:!0,extensions:["swidtag"]},"application/tamp-apex-update":{source:"iana"},"application/tamp-apex-update-confirm":{source:"iana"},"application/tamp-community-update":{source:"iana"},"application/tamp-community-update-confirm":{source:"iana"},"application/tamp-error":{source:"iana"},"application/tamp-sequence-adjust":{source:"iana"},"application/tamp-sequence-adjust-confirm":{source:"iana"},"application/tamp-status-query":{source:"iana"},"application/tamp-status-response":{source:"iana"},"application/tamp-update":{source:"iana"},"application/tamp-update-confirm":{source:"iana"},"application/tar":{compressible:!0},"application/taxii+json":{source:"iana",compressible:!0},"application/td+json":{source:"iana",compressible:!0},"application/tei+xml":{source:"iana",compressible:!0,extensions:["tei","teicorpus"]},"application/tetra_isi":{source:"iana"},"application/thraud+xml":{source:"iana",compressible:!0,extensions:["tfi"]},"application/timestamp-query":{source:"iana"},"application/timestamp-reply":{source:"iana"},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/tlsrpt+gzip":{source:"iana"},"application/tlsrpt+json":{source:"iana",compressible:!0},"application/tnauthlist":{source:"iana"},"application/token-introspection+jwt":{source:"iana"},"application/toml":{compressible:!0,extensions:["toml"]},"application/trickle-ice-sdpfrag":{source:"iana"},"application/trig":{source:"iana",extensions:["trig"]},"application/ttml+xml":{source:"iana",compressible:!0,extensions:["ttml"]},"application/tve-trigger":{source:"iana"},"application/tzif":{source:"iana"},"application/tzif-leap":{source:"iana"},"application/ubjson":{compressible:!1,extensions:["ubj"]},"application/ulpfec":{source:"iana"},"application/urc-grpsheet+xml":{source:"iana",compressible:!0},"application/urc-ressheet+xml":{source:"iana",compressible:!0,extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",compressible:!0,extensions:["td"]},"application/urc-uisocketdesc+xml":{source:"iana",compressible:!0},"application/vcard+json":{source:"iana",compressible:!0},"application/vcard+xml":{source:"iana",compressible:!0},"application/vemmi":{source:"iana"},"application/vividence.scriptfile":{source:"apache"},"application/vnd.1000minds.decision-model+xml":{source:"iana",compressible:!0,extensions:["1km"]},"application/vnd.3gpp-prose+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc3ch+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-v2x-local-service-information":{source:"iana"},"application/vnd.3gpp.5gnas":{source:"iana"},"application/vnd.3gpp.access-transfer-events+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.bsf+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gmop+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gtpc":{source:"iana"},"application/vnd.3gpp.interworking-data":{source:"iana"},"application/vnd.3gpp.lpp":{source:"iana"},"application/vnd.3gpp.mc-signalling-ear":{source:"iana"},"application/vnd.3gpp.mcdata-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-payload":{source:"iana"},"application/vnd.3gpp.mcdata-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-signalling":{source:"iana"},"application/vnd.3gpp.mcdata-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-floor-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-signed+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-init-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-transmission-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mid-call+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ngap":{source:"iana"},"application/vnd.3gpp.pfcp":{source:"iana"},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp.s1ap":{source:"iana"},"application/vnd.3gpp.sms":{source:"iana"},"application/vnd.3gpp.sms+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-ext+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.state-and-event-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ussd+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.bcmcsinfo+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.sms":{source:"iana"},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3lightssoftware.imagescal":{source:"iana"},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",compressible:!1,extensions:["air"]},"application/vnd.adobe.flash.movie":{source:"iana"},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.partial-upload":{source:"iana"},"application/vnd.adobe.xdp+xml":{source:"iana",compressible:!0,extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"iana",extensions:["xfdf"]},"application/vnd.aether.imp":{source:"iana"},"application/vnd.afpc.afplinedata":{source:"iana"},"application/vnd.afpc.afplinedata-pagedef":{source:"iana"},"application/vnd.afpc.cmoca-cmresource":{source:"iana"},"application/vnd.afpc.foca-charset":{source:"iana"},"application/vnd.afpc.foca-codedfont":{source:"iana"},"application/vnd.afpc.foca-codepage":{source:"iana"},"application/vnd.afpc.modca":{source:"iana"},"application/vnd.afpc.modca-cmtable":{source:"iana"},"application/vnd.afpc.modca-formdef":{source:"iana"},"application/vnd.afpc.modca-mediummap":{source:"iana"},"application/vnd.afpc.modca-objectcontainer":{source:"iana"},"application/vnd.afpc.modca-overlay":{source:"iana"},"application/vnd.afpc.modca-pagesegment":{source:"iana"},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ah-barcode":{source:"iana"},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amadeus+json":{source:"iana",compressible:!0},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.amazon.mobi8-ebook":{source:"iana"},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.amundsen.maze+xml":{source:"iana",compressible:!0},"application/vnd.android.ota":{source:"iana"},"application/vnd.android.package-archive":{source:"apache",compressible:!1,extensions:["apk"]},"application/vnd.anki":{source:"iana"},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apache.arrow.file":{source:"iana"},"application/vnd.apache.arrow.stream":{source:"iana"},"application/vnd.apache.thrift.binary":{source:"iana"},"application/vnd.apache.thrift.compact":{source:"iana"},"application/vnd.apache.thrift.json":{source:"iana"},"application/vnd.api+json":{source:"iana",compressible:!0},"application/vnd.aplextor.warrp+json":{source:"iana",compressible:!0},"application/vnd.apothekende.reservation+json":{source:"iana",compressible:!0},"application/vnd.apple.installer+xml":{source:"iana",compressible:!0,extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.apple.pkpass":{compressible:!1,extensions:["pkpass"]},"application/vnd.arastra.swi":{source:"iana"},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.artisan+json":{source:"iana",compressible:!0},"application/vnd.artsquare":{source:"iana"},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.autopackage":{source:"iana"},"application/vnd.avalon+json":{source:"iana",compressible:!0},"application/vnd.avistar+xml":{source:"iana",compressible:!0},"application/vnd.balsamiq.bmml+xml":{source:"iana",compressible:!0,extensions:["bmml"]},"application/vnd.balsamiq.bmpr":{source:"iana"},"application/vnd.banana-accounting":{source:"iana"},"application/vnd.bbf.usp.error":{source:"iana"},"application/vnd.bbf.usp.msg":{source:"iana"},"application/vnd.bbf.usp.msg+json":{source:"iana",compressible:!0},"application/vnd.bekitzur-stech+json":{source:"iana",compressible:!0},"application/vnd.bint.med-content":{source:"iana"},"application/vnd.biopax.rdf+xml":{source:"iana",compressible:!0},"application/vnd.blink-idb-value-wrapper":{source:"iana"},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bluetooth.ep.oob":{source:"iana"},"application/vnd.bluetooth.le.oob":{source:"iana"},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.bpf":{source:"iana"},"application/vnd.bpf3":{source:"iana"},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.byu.uapi+json":{source:"iana",compressible:!0},"application/vnd.cab-jscript":{source:"iana"},"application/vnd.canon-cpdl":{source:"iana"},"application/vnd.canon-lips":{source:"iana"},"application/vnd.capasystems-pg+json":{source:"iana",compressible:!0},"application/vnd.cendio.thinlinc.clientconf":{source:"iana"},"application/vnd.century-systems.tcp_stream":{source:"iana"},"application/vnd.chemdraw+xml":{source:"iana",compressible:!0,extensions:["cdxml"]},"application/vnd.chess-pgn":{source:"iana"},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.ciedi":{source:"iana"},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.cirpack.isdn-ext":{source:"iana"},"application/vnd.citationstyles.style+xml":{source:"iana",compressible:!0,extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.coffeescript":{source:"iana"},"application/vnd.collabio.xodocuments.document":{source:"iana"},"application/vnd.collabio.xodocuments.document-template":{source:"iana"},"application/vnd.collabio.xodocuments.presentation":{source:"iana"},"application/vnd.collabio.xodocuments.presentation-template":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet-template":{source:"iana"},"application/vnd.collection+json":{source:"iana",compressible:!0},"application/vnd.collection.doc+json":{source:"iana",compressible:!0},"application/vnd.collection.next+json":{source:"iana",compressible:!0},"application/vnd.comicbook+zip":{source:"iana",compressible:!1},"application/vnd.comicbook-rar":{source:"iana"},"application/vnd.commerce-battelle":{source:"iana"},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.coreos.ignition+json":{source:"iana",compressible:!0},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",compressible:!0,extensions:["wbs"]},"application/vnd.cryptii.pipe+json":{source:"iana",compressible:!0},"application/vnd.crypto-shade-file":{source:"iana"},"application/vnd.cryptomator.encrypted":{source:"iana"},"application/vnd.cryptomator.vault":{source:"iana"},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.ctct.ws+xml":{source:"iana",compressible:!0},"application/vnd.cups-pdf":{source:"iana"},"application/vnd.cups-postscript":{source:"iana"},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.cups-raster":{source:"iana"},"application/vnd.cups-raw":{source:"iana"},"application/vnd.curl":{source:"iana"},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.cyan.dean.root+xml":{source:"iana",compressible:!0},"application/vnd.cybank":{source:"iana"},"application/vnd.cyclonedx+json":{source:"iana",compressible:!0},"application/vnd.cyclonedx+xml":{source:"iana",compressible:!0},"application/vnd.d2l.coursepackage1p0+zip":{source:"iana",compressible:!1},"application/vnd.d3m-dataset":{source:"iana"},"application/vnd.d3m-problem":{source:"iana"},"application/vnd.dart":{source:"iana",compressible:!0,extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.datapackage+json":{source:"iana",compressible:!0},"application/vnd.dataresource+json":{source:"iana",compressible:!0},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.debian.binary-package":{source:"iana"},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",compressible:!0,extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.desmume.movie":{source:"iana"},"application/vnd.dir-bi.plate-dl-nosuffix":{source:"iana"},"application/vnd.dm.delegation+xml":{source:"iana",compressible:!0},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.document+json":{source:"iana",compressible:!0},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dolby.mobile.1":{source:"iana"},"application/vnd.dolby.mobile.2":{source:"iana"},"application/vnd.doremir.scorecloud-binary-document":{source:"iana"},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.drive+json":{source:"iana",compressible:!0},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dtg.local":{source:"iana"},"application/vnd.dtg.local.flash":{source:"iana"},"application/vnd.dtg.local.html":{source:"iana"},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.dvbisl+xml":{source:"iana",compressible:!0},"application/vnd.dvb.dvbj":{source:"iana"},"application/vnd.dvb.esgcontainer":{source:"iana"},"application/vnd.dvb.ipdcdftnotifaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess2":{source:"iana"},"application/vnd.dvb.ipdcesgpdd":{source:"iana"},"application/vnd.dvb.ipdcroaming":{source:"iana"},"application/vnd.dvb.iptv.alfec-base":{source:"iana"},"application/vnd.dvb.iptv.alfec-enhancement":{source:"iana"},"application/vnd.dvb.notif-aggregate-root+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-container+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-generic+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-msglist+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-request+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-response+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-init+xml":{source:"iana",compressible:!0},"application/vnd.dvb.pfr":{source:"iana"},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dxr":{source:"iana"},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.dzr":{source:"iana"},"application/vnd.easykaraoke.cdgdownload":{source:"iana"},"application/vnd.ecdis-update":{source:"iana"},"application/vnd.ecip.rlp":{source:"iana"},"application/vnd.eclipse.ditto+json":{source:"iana",compressible:!0},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.ecowin.filerequest":{source:"iana"},"application/vnd.ecowin.fileupdate":{source:"iana"},"application/vnd.ecowin.series":{source:"iana"},"application/vnd.ecowin.seriesrequest":{source:"iana"},"application/vnd.ecowin.seriesupdate":{source:"iana"},"application/vnd.efi.img":{source:"iana"},"application/vnd.efi.iso":{source:"iana"},"application/vnd.emclient.accessrequest+xml":{source:"iana",compressible:!0},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.enphase.envoy":{source:"iana"},"application/vnd.eprints.data+xml":{source:"iana",compressible:!0},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.ericsson.quickcall":{source:"iana"},"application/vnd.espass-espass+zip":{source:"iana",compressible:!1},"application/vnd.eszigno3+xml":{source:"iana",compressible:!0,extensions:["es3","et3"]},"application/vnd.etsi.aoc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.asic-e+zip":{source:"iana",compressible:!1},"application/vnd.etsi.asic-s+zip":{source:"iana",compressible:!1},"application/vnd.etsi.cug+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvcommand+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-bc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-cod+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-npvr+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvservice+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsync+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvueprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mcid+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mheg5":{source:"iana"},"application/vnd.etsi.overload-control-policy-dataset+xml":{source:"iana",compressible:!0},"application/vnd.etsi.pstn+xml":{source:"iana",compressible:!0},"application/vnd.etsi.sci+xml":{source:"iana",compressible:!0},"application/vnd.etsi.simservs+xml":{source:"iana",compressible:!0},"application/vnd.etsi.timestamp-token":{source:"iana"},"application/vnd.etsi.tsl+xml":{source:"iana",compressible:!0},"application/vnd.etsi.tsl.der":{source:"iana"},"application/vnd.eu.kasparian.car+json":{source:"iana",compressible:!0},"application/vnd.eudora.data":{source:"iana"},"application/vnd.evolv.ecig.profile":{source:"iana"},"application/vnd.evolv.ecig.settings":{source:"iana"},"application/vnd.evolv.ecig.theme":{source:"iana"},"application/vnd.exstream-empower+zip":{source:"iana",compressible:!1},"application/vnd.exstream-package":{source:"iana"},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.f-secure.mobile":{source:"iana"},"application/vnd.familysearch.gedcom+zip":{source:"iana",compressible:!1},"application/vnd.fastcopy-disk-image":{source:"iana"},"application/vnd.fdf":{source:"iana",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.ffsns":{source:"iana"},"application/vnd.ficlab.flb+zip":{source:"iana",compressible:!1},"application/vnd.filmit.zfc":{source:"iana"},"application/vnd.fints":{source:"iana"},"application/vnd.firemonkeys.cloudcell":{source:"iana"},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.font-fontforge-sfd":{source:"iana"},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{source:"iana",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"iana",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujifilm.fb.docuworks":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.binder":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.container":{source:"iana"},"application/vnd.fujifilm.fb.jfi+xml":{source:"iana",compressible:!0},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.art-ex":{source:"iana"},"application/vnd.fujixerox.art4":{source:"iana"},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fujixerox.docuworks.container":{source:"iana"},"application/vnd.fujixerox.hbpl":{source:"iana"},"application/vnd.fut-misnet":{source:"iana"},"application/vnd.futoin+cbor":{source:"iana"},"application/vnd.futoin+json":{source:"iana",compressible:!0},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.gentics.grd+json":{source:"iana",compressible:!0},"application/vnd.geo+json":{source:"iana",compressible:!0},"application/vnd.geocube+xml":{source:"iana",compressible:!0},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.slides":{source:"iana"},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gerber":{source:"iana"},"application/vnd.globalplatform.card-content-mgt":{source:"iana"},"application/vnd.globalplatform.card-content-mgt-response":{source:"iana"},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.google-apps.document":{compressible:!1,extensions:["gdoc"]},"application/vnd.google-apps.presentation":{compressible:!1,extensions:["gslides"]},"application/vnd.google-apps.spreadsheet":{compressible:!1,extensions:["gsheet"]},"application/vnd.google-earth.kml+xml":{source:"iana",compressible:!0,extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",compressible:!1,extensions:["kmz"]},"application/vnd.gov.sk.e-form+xml":{source:"iana",compressible:!0},"application/vnd.gov.sk.e-form+zip":{source:"iana",compressible:!1},"application/vnd.gov.sk.xmldatacontainer+xml":{source:"iana",compressible:!0},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.gridmp":{source:"iana"},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+json":{source:"iana",compressible:!0},"application/vnd.hal+xml":{source:"iana",compressible:!0,extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",compressible:!0,extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hc+json":{source:"iana",compressible:!0},"application/vnd.hcl-bireports":{source:"iana"},"application/vnd.hdt":{source:"iana"},"application/vnd.heroku+json":{source:"iana",compressible:!0},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hl7cda+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hl7v2+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.httphone":{source:"iana"},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.hyper+json":{source:"iana",compressible:!0},"application/vnd.hyper-item+json":{source:"iana",compressible:!0},"application/vnd.hyperdrive+json":{source:"iana",compressible:!0},"application/vnd.hzn-3d-crossword":{source:"iana"},"application/vnd.ibm.afplinedata":{source:"iana"},"application/vnd.ibm.electronic-media":{source:"iana"},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"iana",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.ieee.1905":{source:"iana"},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.imagemeter.folder+zip":{source:"iana",compressible:!1},"application/vnd.imagemeter.image+zip":{source:"iana",compressible:!1},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.ims.imsccv1p1":{source:"iana"},"application/vnd.ims.imsccv1p2":{source:"iana"},"application/vnd.ims.imsccv1p3":{source:"iana"},"application/vnd.ims.lis.v2.result+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolconsumerprofile+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy.id+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings.simple+json":{source:"iana",compressible:!0},"application/vnd.informedcontrol.rms+xml":{source:"iana",compressible:!0},"application/vnd.informix-visionary":{source:"iana"},"application/vnd.infotech.project":{source:"iana"},"application/vnd.infotech.project+xml":{source:"iana",compressible:!0},"application/vnd.innopath.wamp.notification":{source:"iana"},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intertrust.digibox":{source:"iana"},"application/vnd.intertrust.nncp":{source:"iana"},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.iptc.g2.catalogitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.conceptitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.knowledgeitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsmessage+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.packageitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.planningitem+xml":{source:"iana",compressible:!0},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",compressible:!0,extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.iso11783-10+zip":{source:"iana",compressible:!1},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.japannet-directory-service":{source:"iana"},"application/vnd.japannet-jpnstore-wakeup":{source:"iana"},"application/vnd.japannet-payment-wakeup":{source:"iana"},"application/vnd.japannet-registration":{source:"iana"},"application/vnd.japannet-registration-wakeup":{source:"iana"},"application/vnd.japannet-setstore-wakeup":{source:"iana"},"application/vnd.japannet-verification":{source:"iana"},"application/vnd.japannet-verification-wakeup":{source:"iana"},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.jsk.isdn-ngn":{source:"iana"},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las":{source:"iana"},"application/vnd.las.las+json":{source:"iana",compressible:!0},"application/vnd.las.las+xml":{source:"iana",compressible:!0,extensions:["lasxml"]},"application/vnd.laszip":{source:"iana"},"application/vnd.leap+json":{source:"iana",compressible:!0},"application/vnd.liberty-request+xml":{source:"iana",compressible:!0},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",compressible:!0,extensions:["lbe"]},"application/vnd.logipipe.circuit+zip":{source:"iana",compressible:!1},"application/vnd.loom":{source:"iana"},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.marlin.drm.actiontoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.conftoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.license+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.mdcf":{source:"iana"},"application/vnd.mason+json":{source:"iana",compressible:!0},"application/vnd.maxar.archive.3tz+zip":{source:"iana",compressible:!1},"application/vnd.maxmind.maxmind-db":{source:"iana"},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.meridian-slingshot":{source:"iana"},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micro+json":{source:"iana",compressible:!0},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.microsoft.portable-executable":{source:"iana"},"application/vnd.microsoft.windows.thumbnail-cache":{source:"iana"},"application/vnd.miele+json":{source:"iana",compressible:!0},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.minisoft-hp3000-save":{source:"iana"},"application/vnd.mitsubishi.misty-guard.trustweb":{source:"iana"},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.motorola.flexsuite":{source:"iana"},"application/vnd.motorola.flexsuite.adsi":{source:"iana"},"application/vnd.motorola.flexsuite.fis":{source:"iana"},"application/vnd.motorola.flexsuite.gotap":{source:"iana"},"application/vnd.motorola.flexsuite.kmr":{source:"iana"},"application/vnd.motorola.flexsuite.ttc":{source:"iana"},"application/vnd.motorola.flexsuite.wem":{source:"iana"},"application/vnd.motorola.iprm":{source:"iana"},"application/vnd.mozilla.xul+xml":{source:"iana",compressible:!0,extensions:["xul"]},"application/vnd.ms-3mfdocument":{source:"iana"},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-asf":{source:"iana"},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-color.iccprofile":{source:"apache"},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",compressible:!0,extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-office.activex+xml":{source:"iana",compressible:!0},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-opentype":{source:"apache",compressible:!0},"application/vnd.ms-outlook":{compressible:!1,extensions:["msg"]},"application/vnd.ms-package.obfuscated-opentype":{source:"apache"},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-playready.initiator+xml":{source:"iana",compressible:!0},"application/vnd.ms-powerpoint":{source:"iana",compressible:!1,extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-printdevicecapabilities+xml":{source:"iana",compressible:!0},"application/vnd.ms-printing.printticket+xml":{source:"apache",compressible:!0},"application/vnd.ms-printschematicket+xml":{source:"iana",compressible:!0},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-tnef":{source:"iana"},"application/vnd.ms-windows.devicepairing":{source:"iana"},"application/vnd.ms-windows.nwprinting.oob":{source:"iana"},"application/vnd.ms-windows.printerpairing":{source:"iana"},"application/vnd.ms-windows.wsd.oob":{source:"iana"},"application/vnd.ms-wmdrm.lic-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.lic-resp":{source:"iana"},"application/vnd.ms-wmdrm.meter-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.meter-resp":{source:"iana"},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",compressible:!1,extensions:["xps"]},"application/vnd.msa-disk-image":{source:"iana"},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.msign":{source:"iana"},"application/vnd.multiad.creator":{source:"iana"},"application/vnd.multiad.creator.cif":{source:"iana"},"application/vnd.music-niff":{source:"iana"},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.nacamar.ybrid+json":{source:"iana",compressible:!0},"application/vnd.ncd.control":{source:"iana"},"application/vnd.ncd.reference":{source:"iana"},"application/vnd.nearst.inv+json":{source:"iana",compressible:!0},"application/vnd.nebumind.line":{source:"iana"},"application/vnd.nervana":{source:"iana"},"application/vnd.netfpx":{source:"iana"},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nimn":{source:"iana"},"application/vnd.nintendo.nitro.rom":{source:"iana"},"application/vnd.nintendo.snes.rom":{source:"iana"},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.catalogs":{source:"iana"},"application/vnd.nokia.conml+wbxml":{source:"iana"},"application/vnd.nokia.conml+xml":{source:"iana",compressible:!0},"application/vnd.nokia.iptv.config+xml":{source:"iana",compressible:!0},"application/vnd.nokia.isds-radio-presets":{source:"iana"},"application/vnd.nokia.landmark+wbxml":{source:"iana"},"application/vnd.nokia.landmark+xml":{source:"iana",compressible:!0},"application/vnd.nokia.landmarkcollection+xml":{source:"iana",compressible:!0},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",compressible:!0,extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"iana",extensions:["n-gage"]},"application/vnd.nokia.ncd":{source:"iana"},"application/vnd.nokia.pcd+wbxml":{source:"iana"},"application/vnd.nokia.pcd+xml":{source:"iana",compressible:!0},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.ntt-local.content-share":{source:"iana"},"application/vnd.ntt-local.file-transfer":{source:"iana"},"application/vnd.ntt-local.ogw_remote-access":{source:"iana"},"application/vnd.ntt-local.sip-ta_remote":{source:"iana"},"application/vnd.ntt-local.sip-ta_tcp_stream":{source:"iana"},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"iana",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",compressible:!1,extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",compressible:!1,extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",compressible:!1,extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",compressible:!1,extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.obn":{source:"iana"},"application/vnd.ocf+cbor":{source:"iana"},"application/vnd.oci.image.manifest.v1+json":{source:"iana",compressible:!0},"application/vnd.oftn.l10n+json":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessdownload+xml":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessstreaming+xml":{source:"iana",compressible:!0},"application/vnd.oipf.cspg-hexbinary":{source:"iana"},"application/vnd.oipf.dae.svg+xml":{source:"iana",compressible:!0},"application/vnd.oipf.dae.xhtml+xml":{source:"iana",compressible:!0},"application/vnd.oipf.mippvcontrolmessage+xml":{source:"iana",compressible:!0},"application/vnd.oipf.pae.gem":{source:"iana"},"application/vnd.oipf.spdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.oipf.spdlist+xml":{source:"iana",compressible:!0},"application/vnd.oipf.ueprofile+xml":{source:"iana",compressible:!0},"application/vnd.oipf.userprofile+xml":{source:"iana",compressible:!0},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma-scws-config":{source:"iana"},"application/vnd.oma-scws-http-request":{source:"iana"},"application/vnd.oma-scws-http-response":{source:"iana"},"application/vnd.oma.bcast.associated-procedure-parameter+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.drm-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.imd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.ltkm":{source:"iana"},"application/vnd.oma.bcast.notification+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.provisioningtrigger":{source:"iana"},"application/vnd.oma.bcast.sgboot":{source:"iana"},"application/vnd.oma.bcast.sgdd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sgdu":{source:"iana"},"application/vnd.oma.bcast.simple-symbol-container":{source:"iana"},"application/vnd.oma.bcast.smartcard-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sprov+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.stkm":{source:"iana"},"application/vnd.oma.cab-address-book+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-feature-handler+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-pcc+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-subs-invite+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-user-prefs+xml":{source:"iana",compressible:!0},"application/vnd.oma.dcd":{source:"iana"},"application/vnd.oma.dcdc":{source:"iana"},"application/vnd.oma.dd2+xml":{source:"iana",compressible:!0,extensions:["dd2"]},"application/vnd.oma.drm.risd+xml":{source:"iana",compressible:!0},"application/vnd.oma.group-usage-list+xml":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+cbor":{source:"iana"},"application/vnd.oma.lwm2m+json":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+tlv":{source:"iana"},"application/vnd.oma.pal+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.detailed-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.final-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.groups+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.invocation-descriptor+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.optimized-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.push":{source:"iana"},"application/vnd.oma.scidm.messages+xml":{source:"iana",compressible:!0},"application/vnd.oma.xcap-directory+xml":{source:"iana",compressible:!0},"application/vnd.omads-email+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-file+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-folder+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omaloc-supl-init":{source:"iana"},"application/vnd.onepager":{source:"iana"},"application/vnd.onepagertamp":{source:"iana"},"application/vnd.onepagertamx":{source:"iana"},"application/vnd.onepagertat":{source:"iana"},"application/vnd.onepagertatp":{source:"iana"},"application/vnd.onepagertatx":{source:"iana"},"application/vnd.openblox.game+xml":{source:"iana",compressible:!0,extensions:["obgx"]},"application/vnd.openblox.game-binary":{source:"iana"},"application/vnd.openeye.oeb":{source:"iana"},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",compressible:!0,extensions:["osm"]},"application/vnd.opentimestamps.ots":{source:"iana"},"application/vnd.openxmlformats-officedocument.custom-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.customxmlproperties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawing+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chart+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramdata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.extended-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.commentauthors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesslide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",compressible:!1,extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidelayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidemaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tablestyles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tags+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.presentationml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.viewprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",compressible:!1,extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.theme+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.themeoverride+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.vmldrawing":{source:"iana"},"application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",compressible:!1,extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.core-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.digital-signature-xmlsignature+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.relationships+xml":{source:"iana",compressible:!0},"application/vnd.oracle.resource+json":{source:"iana",compressible:!0},"application/vnd.orange.indata":{source:"iana"},"application/vnd.osa.netdeploy":{source:"iana"},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.bundle":{source:"iana"},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.otps.ct-kip+xml":{source:"iana",compressible:!0},"application/vnd.oxli.countgraph":{source:"iana"},"application/vnd.pagerduty+json":{source:"iana",compressible:!0},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.panoply":{source:"iana"},"application/vnd.paos.xml":{source:"iana"},"application/vnd.patentdive":{source:"iana"},"application/vnd.patientecommsdoc":{source:"iana"},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pcos":{source:"iana"},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.piaccess.application-licence":{source:"iana"},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.poc.group-advertisement+xml":{source:"iana",compressible:!0},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.powerbuilder6-s":{source:"iana"},"application/vnd.powerbuilder7":{source:"iana"},"application/vnd.powerbuilder7-s":{source:"iana"},"application/vnd.powerbuilder75":{source:"iana"},"application/vnd.powerbuilder75-s":{source:"iana"},"application/vnd.preminet":{source:"iana"},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.psfs":{source:"iana"},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.pwg-multiplexed":{source:"iana"},"application/vnd.pwg-xhtml-print+xml":{source:"iana",compressible:!0},"application/vnd.qualcomm.brew-app-res":{source:"iana"},"application/vnd.quarantainenet":{source:"iana"},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.quobject-quoxdocument":{source:"iana"},"application/vnd.radisys.moml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conn+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-stream+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-base+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-detect+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-sendrecv+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-group+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-speech+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-transform+xml":{source:"iana",compressible:!0},"application/vnd.rainstor.data":{source:"iana"},"application/vnd.rapid":{source:"iana"},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",compressible:!0,extensions:["musicxml"]},"application/vnd.renlearn.rlprint":{source:"iana"},"application/vnd.resilient.logic":{source:"iana"},"application/vnd.restful+json":{source:"iana",compressible:!0},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",compressible:!0,extensions:["link66"]},"application/vnd.rs-274x":{source:"iana"},"application/vnd.ruckus.download":{source:"iana"},"application/vnd.s3sms":{source:"iana"},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.sar":{source:"iana"},"application/vnd.sbm.cid":{source:"iana"},"application/vnd.sbm.mid2":{source:"iana"},"application/vnd.scribus":{source:"iana"},"application/vnd.sealed.3df":{source:"iana"},"application/vnd.sealed.csf":{source:"iana"},"application/vnd.sealed.doc":{source:"iana"},"application/vnd.sealed.eml":{source:"iana"},"application/vnd.sealed.mht":{source:"iana"},"application/vnd.sealed.net":{source:"iana"},"application/vnd.sealed.ppt":{source:"iana"},"application/vnd.sealed.tiff":{source:"iana"},"application/vnd.sealed.xls":{source:"iana"},"application/vnd.sealedmedia.softseal.html":{source:"iana"},"application/vnd.sealedmedia.softseal.pdf":{source:"iana"},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.seis+json":{source:"iana",compressible:!0},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shade-save-file":{source:"iana"},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.shootproof+json":{source:"iana",compressible:!0},"application/vnd.shopkick+json":{source:"iana",compressible:!0},"application/vnd.shp":{source:"iana"},"application/vnd.shx":{source:"iana"},"application/vnd.sigrok.session":{source:"iana"},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.siren+json":{source:"iana",compressible:!0},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.notebook":{source:"iana"},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.snesdev-page-table":{source:"iana"},"application/vnd.software602.filler.form+xml":{source:"iana",compressible:!0,extensions:["fo"]},"application/vnd.software602.filler.form-xml-zip":{source:"iana"},"application/vnd.solent.sdkm+xml":{source:"iana",compressible:!0,extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.sqlite3":{source:"iana"},"application/vnd.sss-cod":{source:"iana"},"application/vnd.sss-dtf":{source:"iana"},"application/vnd.sss-ntf":{source:"iana"},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.street-stream":{source:"iana"},"application/vnd.sun.wadl+xml":{source:"iana",compressible:!0,extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.swiftview-ics":{source:"iana"},"application/vnd.sycle+xml":{source:"iana",compressible:!0},"application/vnd.syft+json":{source:"iana",compressible:!0},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xdm"]},"application/vnd.syncml.dm.notification":{source:"iana"},"application/vnd.syncml.dmddf+wbxml":{source:"iana"},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["ddf"]},"application/vnd.syncml.dmtnds+wbxml":{source:"iana"},"application/vnd.syncml.dmtnds+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.syncml.ds.notification":{source:"iana"},"application/vnd.tableschema+json":{source:"iana",compressible:!0},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.think-cell.ppttc+json":{source:"iana",compressible:!0},"application/vnd.tmd.mediaflex.api+xml":{source:"iana",compressible:!0},"application/vnd.tml":{source:"iana"},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.tri.onesource":{source:"iana"},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.truedoc":{source:"iana"},"application/vnd.ubisoft.webplayer":{source:"iana"},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",compressible:!0,extensions:["uoml"]},"application/vnd.uplanet.alert":{source:"iana"},"application/vnd.uplanet.alert-wbxml":{source:"iana"},"application/vnd.uplanet.bearer-choice":{source:"iana"},"application/vnd.uplanet.bearer-choice-wbxml":{source:"iana"},"application/vnd.uplanet.cacheop":{source:"iana"},"application/vnd.uplanet.cacheop-wbxml":{source:"iana"},"application/vnd.uplanet.channel":{source:"iana"},"application/vnd.uplanet.channel-wbxml":{source:"iana"},"application/vnd.uplanet.list":{source:"iana"},"application/vnd.uplanet.list-wbxml":{source:"iana"},"application/vnd.uplanet.listcmd":{source:"iana"},"application/vnd.uplanet.listcmd-wbxml":{source:"iana"},"application/vnd.uplanet.signal":{source:"iana"},"application/vnd.uri-map":{source:"iana"},"application/vnd.valve.source.material":{source:"iana"},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.vd-study":{source:"iana"},"application/vnd.vectorworks":{source:"iana"},"application/vnd.vel+json":{source:"iana",compressible:!0},"application/vnd.verimatrix.vcas":{source:"iana"},"application/vnd.veritone.aion+json":{source:"iana",compressible:!0},"application/vnd.veryant.thin":{source:"iana"},"application/vnd.ves.encrypted":{source:"iana"},"application/vnd.vidsoft.vidconference":{source:"iana"},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vividence.scriptfile":{source:"iana"},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.sic":{source:"iana"},"application/vnd.wap.slc":{source:"iana"},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wfa.dpp":{source:"iana"},"application/vnd.wfa.p2p":{source:"iana"},"application/vnd.wfa.wsc":{source:"iana"},"application/vnd.windows.devicepairing":{source:"iana"},"application/vnd.wmc":{source:"iana"},"application/vnd.wmf.bootstrap":{source:"iana"},"application/vnd.wolfram.mathematica":{source:"iana"},"application/vnd.wolfram.mathematica.package":{source:"iana"},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wrq-hp3000-labelled":{source:"iana"},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.wv.csp+wbxml":{source:"iana"},"application/vnd.wv.csp+xml":{source:"iana",compressible:!0},"application/vnd.wv.ssp+xml":{source:"iana",compressible:!0},"application/vnd.xacml+json":{source:"iana",compressible:!0},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.xfdl.webform":{source:"iana"},"application/vnd.xmi+xml":{source:"iana",compressible:!0},"application/vnd.xmpie.cpkg":{source:"iana"},"application/vnd.xmpie.dpkg":{source:"iana"},"application/vnd.xmpie.plan":{source:"iana"},"application/vnd.xmpie.ppkg":{source:"iana"},"application/vnd.xmpie.xlim":{source:"iana"},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",compressible:!0,extensions:["osfpvg"]},"application/vnd.yamaha.remote-setup":{source:"iana"},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yamaha.through-ngn":{source:"iana"},"application/vnd.yamaha.tunnel-udpencap":{source:"iana"},"application/vnd.yaoweme":{source:"iana"},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.youtube.yt":{source:"iana"},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",compressible:!0,extensions:["zaz"]},"application/voicexml+xml":{source:"iana",compressible:!0,extensions:["vxml"]},"application/voucher-cms+json":{source:"iana",compressible:!0},"application/vq-rtcpxr":{source:"iana"},"application/wasm":{source:"iana",compressible:!0,extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",compressible:!0,extensions:["wif"]},"application/webpush-options+json":{source:"iana",compressible:!0},"application/whoispp-query":{source:"iana"},"application/whoispp-response":{source:"iana"},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wita":{source:"iana"},"application/wordperfect5.1":{source:"iana"},"application/wsdl+xml":{source:"iana",compressible:!0,extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",compressible:!0,extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",compressible:!1,extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-amf":{source:"apache"},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-arj":{compressible:!1,extensions:["arj"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bdoc":{compressible:!1,extensions:["bdoc"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",compressible:!1,extensions:["bz"]},"application/x-bzip2":{source:"apache",compressible:!1,extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-chrome-extension":{extensions:["crx"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-compress":{source:"apache"},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-deb":{compressible:!1},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",compressible:!0,extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",compressible:!0,extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",compressible:!0,extensions:["res"]},"application/x-dvi":{source:"apache",compressible:!1,extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-dos":{source:"apache"},"application/x-font-framemaker":{source:"apache"},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-libgrx":{source:"apache"},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-speedo":{source:"apache"},"application/x-font-sunos-news":{source:"apache"},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-font-vfont":{source:"apache"},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-gzip":{source:"apache"},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-httpd-php":{compressible:!0,extensions:["php"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-iwork-keynote-sffkey":{extensions:["key"]},"application/x-iwork-numbers-sffnumbers":{extensions:["numbers"]},"application/x-iwork-pages-sffpages":{extensions:["pages"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",compressible:!1,extensions:["jnlp"]},"application/x-javascript":{compressible:!0},"application/x-keepass2":{extensions:["kdbx"]},"application/x-latex":{source:"apache",compressible:!1,extensions:["latex"]},"application/x-lua-bytecode":{extensions:["luac"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-mpegurl":{compressible:!1},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdos-program":{extensions:["exe"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-ns-proxy-autoconfig":{compressible:!0,extensions:["pac"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",compressible:!1,extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-pki-message":{source:"iana"},"application/x-rar-compressed":{source:"apache",compressible:!1,extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",compressible:!0,extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",compressible:!1,extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",compressible:!1,extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",compressible:!0,extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-virtualbox-hdd":{compressible:!0,extensions:["hdd"]},"application/x-virtualbox-ova":{compressible:!0,extensions:["ova"]},"application/x-virtualbox-ovf":{compressible:!0,extensions:["ovf"]},"application/x-virtualbox-vbox":{compressible:!0,extensions:["vbox"]},"application/x-virtualbox-vbox-extpack":{compressible:!1,extensions:["vbox-extpack"]},"application/x-virtualbox-vdi":{compressible:!0,extensions:["vdi"]},"application/x-virtualbox-vhd":{compressible:!0,extensions:["vhd"]},"application/x-virtualbox-vmdk":{compressible:!0,extensions:["vmdk"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-web-app-manifest+json":{compressible:!0,extensions:["webapp"]},"application/x-www-form-urlencoded":{source:"iana",compressible:!0},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-x509-ca-ra-cert":{source:"iana"},"application/x-x509-next-ca-cert":{source:"iana"},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",compressible:!0,extensions:["xlf"]},"application/x-xpinstall":{source:"apache",compressible:!1,extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/x400-bp":{source:"iana"},"application/xacml+xml":{source:"iana",compressible:!0},"application/xaml+xml":{source:"apache",compressible:!0,extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",compressible:!0,extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",compressible:!0,extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",compressible:!0,extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",compressible:!0,extensions:["xel"]},"application/xcap-error+xml":{source:"iana",compressible:!0},"application/xcap-ns+xml":{source:"iana",compressible:!0,extensions:["xns"]},"application/xcon-conference-info+xml":{source:"iana",compressible:!0},"application/xcon-conference-info-diff+xml":{source:"iana",compressible:!0},"application/xenc+xml":{source:"iana",compressible:!0,extensions:["xenc"]},"application/xhtml+xml":{source:"iana",compressible:!0,extensions:["xhtml","xht"]},"application/xhtml-voice+xml":{source:"apache",compressible:!0},"application/xliff+xml":{source:"iana",compressible:!0,extensions:["xlf"]},"application/xml":{source:"iana",compressible:!0,extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",compressible:!0,extensions:["dtd"]},"application/xml-external-parsed-entity":{source:"iana"},"application/xml-patch+xml":{source:"iana",compressible:!0},"application/xmpp+xml":{source:"iana",compressible:!0},"application/xop+xml":{source:"iana",compressible:!0,extensions:["xop"]},"application/xproc+xml":{source:"apache",compressible:!0,extensions:["xpl"]},"application/xslt+xml":{source:"iana",compressible:!0,extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",compressible:!0,extensions:["xspf"]},"application/xv+xml":{source:"iana",compressible:!0,extensions:["mxml","xhvml","xvml","xvm"]},"application/yang":{source:"iana",extensions:["yang"]},"application/yang-data+json":{source:"iana",compressible:!0},"application/yang-data+xml":{source:"iana",compressible:!0},"application/yang-patch+json":{source:"iana",compressible:!0},"application/yang-patch+xml":{source:"iana",compressible:!0},"application/yin+xml":{source:"iana",compressible:!0,extensions:["yin"]},"application/zip":{source:"iana",compressible:!1,extensions:["zip"]},"application/zlib":{source:"iana"},"application/zstd":{source:"iana"},"audio/1d-interleaved-parityfec":{source:"iana"},"audio/32kadpcm":{source:"iana"},"audio/3gpp":{source:"iana",compressible:!1,extensions:["3gpp"]},"audio/3gpp2":{source:"iana"},"audio/aac":{source:"iana"},"audio/ac3":{source:"iana"},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/amr-wb":{source:"iana"},"audio/amr-wb+":{source:"iana"},"audio/aptx":{source:"iana"},"audio/asc":{source:"iana"},"audio/atrac-advanced-lossless":{source:"iana"},"audio/atrac-x":{source:"iana"},"audio/atrac3":{source:"iana"},"audio/basic":{source:"iana",compressible:!1,extensions:["au","snd"]},"audio/bv16":{source:"iana"},"audio/bv32":{source:"iana"},"audio/clearmode":{source:"iana"},"audio/cn":{source:"iana"},"audio/dat12":{source:"iana"},"audio/dls":{source:"iana"},"audio/dsr-es201108":{source:"iana"},"audio/dsr-es202050":{source:"iana"},"audio/dsr-es202211":{source:"iana"},"audio/dsr-es202212":{source:"iana"},"audio/dv":{source:"iana"},"audio/dvi4":{source:"iana"},"audio/eac3":{source:"iana"},"audio/encaprtp":{source:"iana"},"audio/evrc":{source:"iana"},"audio/evrc-qcp":{source:"iana"},"audio/evrc0":{source:"iana"},"audio/evrc1":{source:"iana"},"audio/evrcb":{source:"iana"},"audio/evrcb0":{source:"iana"},"audio/evrcb1":{source:"iana"},"audio/evrcnw":{source:"iana"},"audio/evrcnw0":{source:"iana"},"audio/evrcnw1":{source:"iana"},"audio/evrcwb":{source:"iana"},"audio/evrcwb0":{source:"iana"},"audio/evrcwb1":{source:"iana"},"audio/evs":{source:"iana"},"audio/flexfec":{source:"iana"},"audio/fwdred":{source:"iana"},"audio/g711-0":{source:"iana"},"audio/g719":{source:"iana"},"audio/g722":{source:"iana"},"audio/g7221":{source:"iana"},"audio/g723":{source:"iana"},"audio/g726-16":{source:"iana"},"audio/g726-24":{source:"iana"},"audio/g726-32":{source:"iana"},"audio/g726-40":{source:"iana"},"audio/g728":{source:"iana"},"audio/g729":{source:"iana"},"audio/g7291":{source:"iana"},"audio/g729d":{source:"iana"},"audio/g729e":{source:"iana"},"audio/gsm":{source:"iana"},"audio/gsm-efr":{source:"iana"},"audio/gsm-hr-08":{source:"iana"},"audio/ilbc":{source:"iana"},"audio/ip-mr_v2.5":{source:"iana"},"audio/isac":{source:"apache"},"audio/l16":{source:"iana"},"audio/l20":{source:"iana"},"audio/l24":{source:"iana",compressible:!1},"audio/l8":{source:"iana"},"audio/lpc":{source:"iana"},"audio/melp":{source:"iana"},"audio/melp1200":{source:"iana"},"audio/melp2400":{source:"iana"},"audio/melp600":{source:"iana"},"audio/mhas":{source:"iana"},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp3":{compressible:!1,extensions:["mp3"]},"audio/mp4":{source:"iana",compressible:!1,extensions:["m4a","mp4a"]},"audio/mp4a-latm":{source:"iana"},"audio/mpa":{source:"iana"},"audio/mpa-robust":{source:"iana"},"audio/mpeg":{source:"iana",compressible:!1,extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/mpeg4-generic":{source:"iana"},"audio/musepack":{source:"apache"},"audio/ogg":{source:"iana",compressible:!1,extensions:["oga","ogg","spx","opus"]},"audio/opus":{source:"iana"},"audio/parityfec":{source:"iana"},"audio/pcma":{source:"iana"},"audio/pcma-wb":{source:"iana"},"audio/pcmu":{source:"iana"},"audio/pcmu-wb":{source:"iana"},"audio/prs.sid":{source:"iana"},"audio/qcelp":{source:"iana"},"audio/raptorfec":{source:"iana"},"audio/red":{source:"iana"},"audio/rtp-enc-aescm128":{source:"iana"},"audio/rtp-midi":{source:"iana"},"audio/rtploopback":{source:"iana"},"audio/rtx":{source:"iana"},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/scip":{source:"iana"},"audio/silk":{source:"apache",extensions:["sil"]},"audio/smv":{source:"iana"},"audio/smv-qcp":{source:"iana"},"audio/smv0":{source:"iana"},"audio/sofa":{source:"iana"},"audio/sp-midi":{source:"iana"},"audio/speex":{source:"iana"},"audio/t140c":{source:"iana"},"audio/t38":{source:"iana"},"audio/telephone-event":{source:"iana"},"audio/tetra_acelp":{source:"iana"},"audio/tetra_acelp_bb":{source:"iana"},"audio/tone":{source:"iana"},"audio/tsvcis":{source:"iana"},"audio/uemclip":{source:"iana"},"audio/ulpfec":{source:"iana"},"audio/usac":{source:"iana"},"audio/vdvi":{source:"iana"},"audio/vmr-wb":{source:"iana"},"audio/vnd.3gpp.iufp":{source:"iana"},"audio/vnd.4sb":{source:"iana"},"audio/vnd.audiokoz":{source:"iana"},"audio/vnd.celp":{source:"iana"},"audio/vnd.cisco.nse":{source:"iana"},"audio/vnd.cmles.radio-events":{source:"iana"},"audio/vnd.cns.anp1":{source:"iana"},"audio/vnd.cns.inf1":{source:"iana"},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dlna.adts":{source:"iana"},"audio/vnd.dolby.heaac.1":{source:"iana"},"audio/vnd.dolby.heaac.2":{source:"iana"},"audio/vnd.dolby.mlp":{source:"iana"},"audio/vnd.dolby.mps":{source:"iana"},"audio/vnd.dolby.pl2":{source:"iana"},"audio/vnd.dolby.pl2x":{source:"iana"},"audio/vnd.dolby.pl2z":{source:"iana"},"audio/vnd.dolby.pulse.1":{source:"iana"},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.dts.uhd":{source:"iana"},"audio/vnd.dvb.file":{source:"iana"},"audio/vnd.everad.plj":{source:"iana"},"audio/vnd.hns.audio":{source:"iana"},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nokia.mobile-xmf":{source:"iana"},"audio/vnd.nortel.vbk":{source:"iana"},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.octel.sbc":{source:"iana"},"audio/vnd.presonus.multitrack":{source:"iana"},"audio/vnd.qcelp":{source:"iana"},"audio/vnd.rhetorex.32kadpcm":{source:"iana"},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/vnd.rn-realaudio":{compressible:!1},"audio/vnd.sealedmedia.softseal.mpeg":{source:"iana"},"audio/vnd.vmx.cvsd":{source:"iana"},"audio/vnd.wave":{compressible:!1},"audio/vorbis":{source:"iana",compressible:!1},"audio/vorbis-config":{source:"iana"},"audio/wav":{compressible:!1,extensions:["wav"]},"audio/wave":{compressible:!1,extensions:["wav"]},"audio/webm":{source:"apache",compressible:!1,extensions:["weba"]},"audio/x-aac":{source:"apache",compressible:!1,extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",compressible:!1,extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-tta":{source:"apache"},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/xm":{source:"apache",extensions:["xm"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-pdb":{source:"apache"},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",compressible:!0,extensions:["otf"]},"font/sfnt":{source:"iana"},"font/ttf":{source:"iana",compressible:!0,extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"image/aces":{source:"iana",extensions:["exr"]},"image/apng":{compressible:!1,extensions:["apng"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",compressible:!1,extensions:["avif"]},"image/bmp":{source:"iana",compressible:!0,extensions:["bmp"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",compressible:!1,extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/hsj2":{source:"iana",extensions:["hsj2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",compressible:!1,extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",compressible:!1,extensions:["jpeg","jpg","jpe"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",compressible:!1,extensions:["jpm"]},"image/jpx":{source:"iana",compressible:!1,extensions:["jpx","jpf"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/naplps":{source:"iana"},"image/pjpeg":{compressible:!1},"image/png":{source:"iana",compressible:!1,extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/pwg-raster":{source:"iana"},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",compressible:!0,extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",compressible:!1,extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",compressible:!0,extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.cns.inf2":{source:"iana"},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.globalgraphics.pgb":{source:"iana"},"image/vnd.microsoft.icon":{source:"iana",compressible:!0,extensions:["ico"]},"image/vnd.mix":{source:"iana"},"image/vnd.mozilla.apng":{source:"iana"},"image/vnd.ms-dds":{compressible:!0,extensions:["dds"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.radiance":{source:"iana"},"image/vnd.sealed.png":{source:"iana"},"image/vnd.sealedmedia.softseal.gif":{source:"iana"},"image/vnd.sealedmedia.softseal.jpg":{source:"iana"},"image/vnd.svf":{source:"iana"},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"apache",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",compressible:!0,extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",compressible:!0,extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xcf":{compressible:!1},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"message/cpim":{source:"iana"},"message/delivery-status":{source:"iana"},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/external-body":{source:"iana"},"message/feedback-report":{source:"iana"},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/http":{source:"iana",compressible:!1},"message/imdn+xml":{source:"iana",compressible:!0},"message/news":{source:"iana"},"message/partial":{source:"iana",compressible:!1},"message/rfc822":{source:"iana",compressible:!0,extensions:["eml","mime"]},"message/s-http":{source:"iana"},"message/sip":{source:"iana"},"message/sipfrag":{source:"iana"},"message/tracking-status":{source:"iana"},"message/vnd.si.simp":{source:"iana"},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/e57":{source:"iana"},"model/gltf+json":{source:"iana",compressible:!0,extensions:["gltf"]},"model/gltf-binary":{source:"iana",compressible:!0,extensions:["glb"]},"model/iges":{source:"iana",compressible:!1,extensions:["igs","iges"]},"model/mesh":{source:"iana",compressible:!1,extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/step":{source:"iana"},"model/step+xml":{source:"iana",compressible:!0,extensions:["stpx"]},"model/step+zip":{source:"iana",compressible:!1,extensions:["stpz"]},"model/step-xml+zip":{source:"iana",compressible:!1,extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/vnd.collada+xml":{source:"iana",compressible:!0,extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.flatland.3dml":{source:"iana"},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gs-gdl":{source:"apache"},"model/vnd.gs.gdl":{source:"iana"},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.moml+xml":{source:"iana",compressible:!0},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.pytha.pyox":{source:"iana"},"model/vnd.rosette.annotated-data-model":{source:"iana"},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usdz+zip":{source:"iana",compressible:!1,extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",compressible:!1,extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",compressible:!1,extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",compressible:!1,extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",compressible:!0,extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"multipart/alternative":{source:"iana",compressible:!1},"multipart/appledouble":{source:"iana"},"multipart/byteranges":{source:"iana"},"multipart/digest":{source:"iana"},"multipart/encrypted":{source:"iana",compressible:!1},"multipart/form-data":{source:"iana",compressible:!1},"multipart/header-set":{source:"iana"},"multipart/mixed":{source:"iana"},"multipart/multilingual":{source:"iana"},"multipart/parallel":{source:"iana"},"multipart/related":{source:"iana",compressible:!1},"multipart/report":{source:"iana"},"multipart/signed":{source:"iana",compressible:!1},"multipart/vnd.bint.med-plus":{source:"iana"},"multipart/voice-message":{source:"iana"},"multipart/x-mixed-replace":{source:"iana"},"text/1d-interleaved-parityfec":{source:"iana"},"text/cache-manifest":{source:"iana",compressible:!0,extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/calender":{compressible:!0},"text/cmd":{compressible:!0},"text/coffeescript":{extensions:["coffee","litcoffee"]},"text/cql":{source:"iana"},"text/cql-expression":{source:"iana"},"text/cql-identifier":{source:"iana"},"text/css":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["css"]},"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"text/csv-schema":{source:"iana"},"text/directory":{source:"iana"},"text/dns":{source:"iana"},"text/ecmascript":{source:"iana"},"text/encaprtp":{source:"iana"},"text/enriched":{source:"iana"},"text/fhirpath":{source:"iana"},"text/flexfec":{source:"iana"},"text/fwdred":{source:"iana"},"text/gff3":{source:"iana"},"text/grammar-ref-list":{source:"iana"},"text/html":{source:"iana",compressible:!0,extensions:["html","htm","shtml"]},"text/jade":{extensions:["jade"]},"text/javascript":{source:"iana",compressible:!0},"text/jcr-cnd":{source:"iana"},"text/jsx":{compressible:!0,extensions:["jsx"]},"text/less":{compressible:!0,extensions:["less"]},"text/markdown":{source:"iana",compressible:!0,extensions:["markdown","md"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/mdx":{compressible:!0,extensions:["mdx"]},"text/mizar":{source:"iana"},"text/n3":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["n3"]},"text/parameters":{source:"iana",charset:"UTF-8"},"text/parityfec":{source:"iana"},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]},"text/provenance-notation":{source:"iana",charset:"UTF-8"},"text/prs.fallenstein.rst":{source:"iana"},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/prs.prop.logic":{source:"iana"},"text/raptorfec":{source:"iana"},"text/red":{source:"iana"},"text/rfc822-headers":{source:"iana"},"text/richtext":{source:"iana",compressible:!0,extensions:["rtx"]},"text/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"text/rtp-enc-aescm128":{source:"iana"},"text/rtploopback":{source:"iana"},"text/rtx":{source:"iana"},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shaclc":{source:"iana"},"text/shex":{source:"iana",extensions:["shex"]},"text/slim":{extensions:["slim","slm"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/strings":{source:"iana"},"text/stylus":{extensions:["stylus","styl"]},"text/t140":{source:"iana"},"text/tab-separated-values":{source:"iana",compressible:!0,extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/ulpfec":{source:"iana"},"text/uri-list":{source:"iana",compressible:!0,extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",compressible:!0,extensions:["vcard"]},"text/vnd.a":{source:"iana"},"text/vnd.abc":{source:"iana"},"text/vnd.ascii-art":{source:"iana"},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.debian.copyright":{source:"iana",charset:"UTF-8"},"text/vnd.dmclientscript":{source:"iana"},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.esmertec.theme-descriptor":{source:"iana",charset:"UTF-8"},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.ficlab.flt":{source:"iana"},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.gml":{source:"iana"},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.hans":{source:"iana"},"text/vnd.hgl":{source:"iana"},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.iptc.newsml":{source:"iana"},"text/vnd.iptc.nitf":{source:"iana"},"text/vnd.latex-z":{source:"iana"},"text/vnd.motorola.reflex":{source:"iana"},"text/vnd.ms-mediapackage":{source:"iana"},"text/vnd.net2phone.commcenter.command":{source:"iana"},"text/vnd.radisys.msml-basic-layout":{source:"iana"},"text/vnd.senx.warpscript":{source:"iana"},"text/vnd.si.uricatalogue":{source:"iana"},"text/vnd.sosi":{source:"iana"},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.trolltech.linguist":{source:"iana",charset:"UTF-8"},"text/vnd.wap.si":{source:"iana"},"text/vnd.wap.sl":{source:"iana"},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vtt":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["vtt"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-gwt-rpc":{compressible:!0},"text/x-handlebars-template":{extensions:["hbs"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-jquery-tmpl":{compressible:!0},"text/x-lua":{extensions:["lua"]},"text/x-markdown":{compressible:!0,extensions:["mkd"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-org":{compressible:!0,extensions:["org"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-processing":{compressible:!0,extensions:["pde"]},"text/x-sass":{extensions:["sass"]},"text/x-scss":{extensions:["scss"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-suse-ymp":{compressible:!0,extensions:["ymp"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",compressible:!0,extensions:["xml"]},"text/xml-external-parsed-entity":{source:"iana"},"text/yaml":{compressible:!0,extensions:["yaml","yml"]},"video/1d-interleaved-parityfec":{source:"iana"},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp-tt":{source:"iana"},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/av1":{source:"iana"},"video/bmpeg":{source:"iana"},"video/bt656":{source:"iana"},"video/celb":{source:"iana"},"video/dv":{source:"iana"},"video/encaprtp":{source:"iana"},"video/ffv1":{source:"iana"},"video/flexfec":{source:"iana"},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h263-1998":{source:"iana"},"video/h263-2000":{source:"iana"},"video/h264":{source:"iana",extensions:["h264"]},"video/h264-rcdo":{source:"iana"},"video/h264-svc":{source:"iana"},"video/h265":{source:"iana"},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpeg2000":{source:"iana"},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/jxsv":{source:"iana"},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp1s":{source:"iana"},"video/mp2p":{source:"iana"},"video/mp2t":{source:"iana",extensions:["ts"]},"video/mp4":{source:"iana",compressible:!1,extensions:["mp4","mp4v","mpg4"]},"video/mp4v-es":{source:"iana"},"video/mpeg":{source:"iana",compressible:!1,extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/mpeg4-generic":{source:"iana"},"video/mpv":{source:"iana"},"video/nv":{source:"iana"},"video/ogg":{source:"iana",compressible:!1,extensions:["ogv"]},"video/parityfec":{source:"iana"},"video/pointer":{source:"iana"},"video/quicktime":{source:"iana",compressible:!1,extensions:["qt","mov"]},"video/raptorfec":{source:"iana"},"video/raw":{source:"iana"},"video/rtp-enc-aescm128":{source:"iana"},"video/rtploopback":{source:"iana"},"video/rtx":{source:"iana"},"video/scip":{source:"iana"},"video/smpte291":{source:"iana"},"video/smpte292m":{source:"iana"},"video/ulpfec":{source:"iana"},"video/vc1":{source:"iana"},"video/vc2":{source:"iana"},"video/vnd.cctv":{source:"iana"},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.mp4":{source:"iana"},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.directv.mpeg":{source:"iana"},"video/vnd.directv.mpeg-tts":{source:"iana"},"video/vnd.dlna.mpeg-tts":{source:"iana"},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.hns.video":{source:"iana"},"video/vnd.iptvforum.1dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.1dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.2dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.2dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.ttsavc":{source:"iana"},"video/vnd.iptvforum.ttsmpeg2":{source:"iana"},"video/vnd.motorola.video":{source:"iana"},"video/vnd.motorola.videop":{source:"iana"},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.nokia.interleaved-multimedia":{source:"iana"},"video/vnd.nokia.mp4vr":{source:"iana"},"video/vnd.nokia.videovoip":{source:"iana"},"video/vnd.objectvideo":{source:"iana"},"video/vnd.radgamettools.bink":{source:"iana"},"video/vnd.radgamettools.smacker":{source:"iana"},"video/vnd.sealed.mpeg1":{source:"iana"},"video/vnd.sealed.mpeg4":{source:"iana"},"video/vnd.sealed.swf":{source:"iana"},"video/vnd.sealedmedia.softseal.mov":{source:"iana"},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/vnd.youtube.yt":{source:"iana"},"video/vp8":{source:"iana"},"video/vp9":{source:"iana"},"video/webm":{source:"apache",compressible:!1,extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",compressible:!1,extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",compressible:!1,extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",compressible:!1,extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]},"x-shader/x-fragment":{compressible:!0},"x-shader/x-vertex":{compressible:!0}}});var ORe=O((JNr,LRe)=>{LRe.exports=NRe()});var URe=O(cc=>{"use strict";var E9=ORe(),xat=require("path").extname,MRe=/^\s*([^;\s]*)(?:;|\s|$)/,Sat=/^text\//i;cc.charset=FRe;cc.charsets={lookup:FRe};cc.contentType=Iat;cc.extension=Cat;cc.extensions=Object.create(null);cc.lookup=Tat;cc.types=Object.create(null);Eat(cc.extensions,cc.types);function FRe(t){if(!t||typeof t!="string")return!1;var e=MRe.exec(t),r=e&&E9[e[1].toLowerCase()];return r&&r.charset?r.charset:e&&Sat.test(e[1])?"UTF-8":!1}function Iat(t){if(!t||typeof t!="string")return!1;var e=t.indexOf("/")===-1?cc.lookup(t):t;if(!e)return!1;if(e.indexOf("charset")===-1){var r=cc.charset(e);r&&(e+="; charset="+r.toLowerCase())}return e}function Cat(t){if(!t||typeof t!="string")return!1;var e=MRe.exec(t),r=e&&cc.extensions[e[1].toLowerCase()];return!r||!r.length?!1:r[0]}function Tat(t){if(!t||typeof t!="string")return!1;var e=xat("x."+t).toLowerCase().substr(1);return e&&cc.types[e]||!1}function Eat(t,e){var r=["nginx","apache",void 0,"iana"];Object.keys(E9).forEach(function(o){var s=E9[o],a=s.extensions;if(!(!a||!a.length)){t[o]=a;for(var c=0;c<a.length;c++){var u=a[c];if(e[u]){var l=r.indexOf(E9[e[u]].source),d=r.indexOf(s.source);if(e[u]!=="application/octet-stream"&&(l>d||l===d&&e[u].substr(0,12)==="application/"))continue}e[u]=o}}})}});var qRe=O((eLr,BRe)=>{BRe.exports=wat;function wat(t){var e=typeof setImmediate=="function"?setImmediate:typeof process=="object"&&typeof process.nextTick=="function"?process.nextTick:null;e?e(t):setTimeout(t,0)}});var NZ=O((tLr,HRe)=>{var jRe=qRe();HRe.exports=Rat;function Rat(t){var e=!1;return jRe(function(){e=!0}),function(n,o){e?t(n,o):jRe(function(){t(n,o)})}}});var LZ=O((rLr,VRe)=>{VRe.exports=kat;function kat(t){Object.keys(t.jobs).forEach(Pat.bind(t)),t.jobs={}}function Pat(t){typeof this.jobs[t]=="function"&&this.jobs[t]()}});var OZ=O((nLr,zRe)=>{var GRe=NZ(),Aat=LZ();zRe.exports=Dat;function Dat(t,e,r,n){var o=r.keyedList?r.keyedList[r.index]:r.index;r.jobs[o]=Nat(e,o,t[o],function(s,a){o in r.jobs&&(delete r.jobs[o],s?Aat(r):r.results[o]=a,n(s,r.results))})}function Nat(t,e,r,n){var o;return t.length==2?o=t(r,GRe(n)):o=t(r,e,GRe(n)),o}});var MZ=O((iLr,$Re)=>{$Re.exports=Lat;function Lat(t,e){var r=!Array.isArray(t),n={index:0,keyedList:r||e?Object.keys(t):null,jobs:{},results:r?{}:[],size:r?Object.keys(t).length:t.length};return e&&n.keyedList.sort(r?e:function(o,s){return e(t[o],t[s])}),n}});var FZ=O((oLr,WRe)=>{var Oat=LZ(),Mat=NZ();WRe.exports=Fat;function Fat(t){Object.keys(this.jobs).length&&(this.index=this.size,Oat(this),Mat(t)(null,this.results))}});var YRe=O((sLr,KRe)=>{var Uat=OZ(),Bat=MZ(),qat=FZ();KRe.exports=jat;function jat(t,e,r){for(var n=Bat(t);n.index<(n.keyedList||t).length;)Uat(t,e,n,function(o,s){if(o){r(o,s);return}if(Object.keys(n.jobs).length===0){r(null,n.results);return}}),n.index++;return qat.bind(n,r)}});var UZ=O((aLr,w9)=>{var QRe=OZ(),Hat=MZ(),Vat=FZ();w9.exports=Gat;w9.exports.ascending=XRe;w9.exports.descending=zat;function Gat(t,e,r,n){var o=Hat(t,r);return QRe(t,e,o,function s(a,c){if(a){n(a,c);return}if(o.index++,o.index<(o.keyedList||t).length){QRe(t,e,o,s);return}n(null,o.results)}),Vat.bind(o,n)}function XRe(t,e){return t<e?-1:t>e?1:0}function zat(t,e){return-1*XRe(t,e)}});var ZRe=O((cLr,JRe)=>{var $at=UZ();JRe.exports=Wat;function Wat(t,e,r){return $at(t,e,null,r)}});var tke=O((uLr,eke)=>{eke.exports={parallel:YRe(),serial:ZRe(),serialOrdered:UZ()}});var nke=O((lLr,rke)=>{rke.exports=function(t,e){return Object.keys(e).forEach(function(r){t[r]=t[r]||e[r]}),t}});var ske=O((dLr,oke)=>{var HZ=DRe(),ike=require("util"),BZ=require("path"),Kat=require("http"),Yat=require("https"),Qat=require("url").parse,Xat=require("fs"),Jat=require("stream").Stream,qZ=URe(),Zat=tke(),jZ=nke();oke.exports=Kr;ike.inherits(Kr,HZ);function Kr(t){if(!(this instanceof Kr))return new Kr(t);this._overheadLength=0,this._valueLength=0,this._valuesToMeasure=[],HZ.call(this),t=t||{};for(var e in t)this[e]=t[e]}Kr.LINE_BREAK=`\r
`;Kr.DEFAULT_CONTENT_TYPE="application/octet-stream";Kr.prototype.append=function(t,e,r){r=r||{},typeof r=="string"&&(r={filename:r});var n=HZ.prototype.append.bind(this);if(typeof e=="number"&&(e=""+e),ike.isArray(e)){this._error(new Error("Arrays are not supported."));return}var o=this._multiPartHeader(t,e,r),s=this._multiPartFooter();n(o),n(e),n(s),this._trackLength(o,e,r)};Kr.prototype._trackLength=function(t,e,r){var n=0;r.knownLength!=null?n+=+r.knownLength:Buffer.isBuffer(e)?n=e.length:typeof e=="string"&&(n=Buffer.byteLength(e)),this._valueLength+=n,this._overheadLength+=Buffer.byteLength(t)+Kr.LINE_BREAK.length,!(!e||!e.path&&!(e.readable&&e.hasOwnProperty("httpVersion"))&&!(e instanceof Jat))&&(r.knownLength||this._valuesToMeasure.push(e))};Kr.prototype._lengthRetriever=function(t,e){t.hasOwnProperty("fd")?t.end!=null&&t.end!=1/0&&t.start!=null?e(null,t.end+1-(t.start?t.start:0)):Xat.stat(t.path,function(r,n){var o;if(r){e(r);return}o=n.size-(t.start?t.start:0),e(null,o)}):t.hasOwnProperty("httpVersion")?e(null,+t.headers["content-length"]):t.hasOwnProperty("httpModule")?(t.on("response",function(r){t.pause(),e(null,+r.headers["content-length"])}),t.resume()):e("Unknown stream")};Kr.prototype._multiPartHeader=function(t,e,r){if(typeof r.header=="string")return r.header;var n=this._getContentDisposition(e,r),o=this._getContentType(e,r),s="",a={"Content-Disposition":["form-data",'name="'+t+'"'].concat(n||[]),"Content-Type":[].concat(o||[])};typeof r.header=="object"&&jZ(a,r.header);var c;for(var u in a)a.hasOwnProperty(u)&&(c=a[u],c!=null&&(Array.isArray(c)||(c=[c]),c.length&&(s+=u+": "+c.join("; ")+Kr.LINE_BREAK)));return"--"+this.getBoundary()+Kr.LINE_BREAK+s+Kr.LINE_BREAK};Kr.prototype._getContentDisposition=function(t,e){var r,n;return typeof e.filepath=="string"?r=BZ.normalize(e.filepath).replace(/\\/g,"/"):e.filename||t.name||t.path?r=BZ.basename(e.filename||t.name||t.path):t.readable&&t.hasOwnProperty("httpVersion")&&(r=BZ.basename(t.client._httpMessage.path||"")),r&&(n='filename="'+r+'"'),n};Kr.prototype._getContentType=function(t,e){var r=e.contentType;return!r&&t.name&&(r=qZ.lookup(t.name)),!r&&t.path&&(r=qZ.lookup(t.path)),!r&&t.readable&&t.hasOwnProperty("httpVersion")&&(r=t.headers["content-type"]),!r&&(e.filepath||e.filename)&&(r=qZ.lookup(e.filepath||e.filename)),!r&&typeof t=="object"&&(r=Kr.DEFAULT_CONTENT_TYPE),r};Kr.prototype._multiPartFooter=function(){return function(t){var e=Kr.LINE_BREAK,r=this._streams.length===0;r&&(e+=this._lastBoundary()),t(e)}.bind(this)};Kr.prototype._lastBoundary=function(){return"--"+this.getBoundary()+"--"+Kr.LINE_BREAK};Kr.prototype.getHeaders=function(t){var e,r={"content-type":"multipart/form-data; boundary="+this.getBoundary()};for(e in t)t.hasOwnProperty(e)&&(r[e.toLowerCase()]=t[e]);return r};Kr.prototype.setBoundary=function(t){this._boundary=t};Kr.prototype.getBoundary=function(){return this._boundary||this._generateBoundary(),this._boundary};Kr.prototype.getBuffer=function(){for(var t=new Buffer.alloc(0),e=this.getBoundary(),r=0,n=this._streams.length;r<n;r++)typeof this._streams[r]!="function"&&(Buffer.isBuffer(this._streams[r])?t=Buffer.concat([t,this._streams[r]]):t=Buffer.concat([t,Buffer.from(this._streams[r])]),(typeof this._streams[r]!="string"||this._streams[r].substring(2,e.length+2)!==e)&&(t=Buffer.concat([t,Buffer.from(Kr.LINE_BREAK)])));return Buffer.concat([t,Buffer.from(this._lastBoundary())])};Kr.prototype._generateBoundary=function(){for(var t="--------------------------",e=0;e<24;e++)t+=Math.floor(Math.random()*10).toString(16);this._boundary=t};Kr.prototype.getLengthSync=function(){var t=this._overheadLength+this._valueLength;return this._streams.length&&(t+=this._lastBoundary().length),this.hasKnownLength()||this._error(new Error("Cannot calculate proper length in synchronous way.")),t};Kr.prototype.hasKnownLength=function(){var t=!0;return this._valuesToMeasure.length&&(t=!1),t};Kr.prototype.getLength=function(t){var e=this._overheadLength+this._valueLength;if(this._streams.length&&(e+=this._lastBoundary().length),!this._valuesToMeasure.length){process.nextTick(t.bind(this,null,e));return}Zat.parallel(this._valuesToMeasure,this._lengthRetriever,function(r,n){if(r){t(r);return}n.forEach(function(o){e+=o}),t(null,e)})};Kr.prototype.submit=function(t,e){var r,n,o={method:"post"};return typeof t=="string"?(t=Qat(t),n=jZ({port:t.port,path:t.pathname,host:t.hostname,protocol:t.protocol},o)):(n=jZ(t,o),n.port||(n.port=n.protocol=="https:"?443:80)),n.headers=this.getHeaders(t.headers),n.protocol=="https:"?r=Yat.request(n):r=Kat.request(n),this.getLength(function(s,a){if(s&&s!=="Unknown stream"){this._error(s);return}if(a&&r.setHeader("Content-Length",a),this.pipe(r),e){var c,u=function(l,d){return r.removeListener("error",u),r.removeListener("response",c),e.call(this,l,d)};c=u.bind(this,null),r.on("error",u),r.on("response",c)}}.bind(this)),r};Kr.prototype._error=function(t){this.error||(this.error=t,this.pause(),this.emit("error",t))};Kr.prototype.toString=function(){return"[object FormData]"}});function R9(){return{name:VZ,async sendRequest(t,e){if(t.formData){let r=t.headers.get("Content-Type");r&&r.indexOf("application/x-www-form-urlencoded")!==-1?(t.body=ect(t.formData),t.formData=void 0):await tct(t.formData,t)}return e(t)}}}function ect(t){let e=new URLSearchParams;for(let[r,n]of Object.entries(t))if(Array.isArray(n))for(let o of n)e.append(r,o.toString());else e.append(r,n.toString());return e.toString()}async function tct(t,e){let r=new ake.default;for(let o of Object.keys(t)){let s=t[o];if(Array.isArray(s))for(let a of s)r.append(o,a);else r.append(o,s)}e.body=r,e.formData=void 0;let n=e.headers.get("Content-Type");n&&n.indexOf("multipart/form-data")!==-1&&e.headers.set("Content-Type",`multipart/form-data; boundary=${r.getBoundary()}`);try{let o=await new Promise((s,a)=>{r.getLength((c,u)=>{c?a(c):s(u)})});e.headers.set("Content-Length",o)}catch{}}var ake,VZ,GZ=A(()=>{ake=H(ske()),VZ="formDataPolicy"});var cke=O(zZ=>{"use strict";Object.defineProperty(zZ,"__esModule",{value:!0});function rct(t){return function(e,r){return new Promise((n,o)=>{t.call(this,e,r,(s,a)=>{s?o(s):n(a)})})}}zZ.default=rct});var KZ=O((WZ,lke)=>{"use strict";var uke=WZ&&WZ.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},nct=require("events"),ict=uke($l()),oct=uke(cke()),zA=ict.default("agent-base");function sct(t){return!!t&&typeof t.addRequest=="function"}function $Z(){let{stack:t}=new Error;return typeof t!="string"?!1:t.split(`
`).some(e=>e.indexOf("(https.js:")!==-1||e.indexOf("node:https:")!==-1)}function k9(t,e){return new k9.Agent(t,e)}(function(t){class e extends nct.EventEmitter{constructor(n,o){super();let s=o;typeof n=="function"?this.callback=n:n&&(s=n),this.timeout=null,s&&typeof s.timeout=="number"&&(this.timeout=s.timeout),this.maxFreeSockets=1,this.maxSockets=1,this.maxTotalSockets=1/0,this.sockets={},this.freeSockets={},this.requests={},this.options={}}get defaultPort(){return typeof this.explicitDefaultPort=="number"?this.explicitDefaultPort:$Z()?443:80}set defaultPort(n){this.explicitDefaultPort=n}get protocol(){return typeof this.explicitProtocol=="string"?this.explicitProtocol:$Z()?"https:":"http:"}set protocol(n){this.explicitProtocol=n}callback(n,o,s){throw new Error('"agent-base" has no default implementation, you must subclass and override `callback()`')}addRequest(n,o){let s=Object.assign({},o);typeof s.secureEndpoint!="boolean"&&(s.secureEndpoint=$Z()),s.host==null&&(s.host="localhost"),s.port==null&&(s.port=s.secureEndpoint?443:80),s.protocol==null&&(s.protocol=s.secureEndpoint?"https:":"http:"),s.host&&s.path&&delete s.path,delete s.agent,delete s.hostname,delete s._defaultAgent,delete s.defaultPort,delete s.createConnection,n._last=!0,n.shouldKeepAlive=!1;let a=!1,c=null,u=s.timeout||this.timeout,l=m=>{n._hadError||(n.emit("error",m),n._hadError=!0)},d=()=>{c=null,a=!0;let m=new Error(`A "socket" was not created for HTTP request before ${u}ms`);m.code="ETIMEOUT",l(m)},p=m=>{a||(c!==null&&(clearTimeout(c),c=null),l(m))},f=m=>{if(a)return;if(c!=null&&(clearTimeout(c),c=null),sct(m)){zA("Callback returned another Agent instance %o",m.constructor.name),m.addRequest(n,s);return}if(m){m.once("free",()=>{this.freeSocket(m,s)}),n.onSocket(m);return}let h=new Error(`no Duplex stream was returned to agent-base for \`${n.method} ${n.path}\``);l(h)};if(typeof this.callback!="function"){l(new Error("`callback` is not defined"));return}this.promisifiedCallback||(this.callback.length>=3?(zA("Converting legacy callback function to promise"),this.promisifiedCallback=oct.default(this.callback)):this.promisifiedCallback=this.callback),typeof u=="number"&&u>0&&(c=setTimeout(d,u)),"port"in s&&typeof s.port!="number"&&(s.port=Number(s.port));try{zA("Resolving socket for %o request: %o",s.protocol,`${n.method} ${n.path}`),Promise.resolve(this.promisifiedCallback(n,s)).then(f,p)}catch(m){Promise.reject(m).catch(p)}}freeSocket(n,o){zA("Freeing socket %o %o",n.constructor.name,o),n.destroy()}destroy(){zA("Destroying agent %o",this.constructor.name)}}t.Agent=e,t.prototype=t.Agent.prototype})(k9||(k9={}));lke.exports=k9});var dke=O(WA=>{"use strict";var act=WA&&WA.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(WA,"__esModule",{value:!0});var cct=act($l()),$A=cct.default("https-proxy-agent:parse-proxy-response");function uct(t){return new Promise((e,r)=>{let n=0,o=[];function s(){let p=t.read();p?d(p):t.once("readable",s)}function a(){t.removeListener("end",u),t.removeListener("error",l),t.removeListener("close",c),t.removeListener("readable",s)}function c(p){$A("onclose had error %o",p)}function u(){$A("onend")}function l(p){a(),$A("onerror %o",p),r(p)}function d(p){o.push(p),n+=p.length;let f=Buffer.concat(o,n);if(f.indexOf(`\r
\r
`)===-1){$A("have not received end of HTTP headers yet..."),s();return}let h=f.toString("ascii",0,f.indexOf(`\r
`)),g=+h.split(" ")[1];$A("got proxy server response: %o",h),e({statusCode:g,buffered:f})}t.on("error",l),t.on("close",c),t.on("end",u),s()})}WA.default=uct});var mke=O(L_=>{"use strict";var lct=L_&&L_.__awaiter||function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},CE=L_&&L_.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(L_,"__esModule",{value:!0});var pke=CE(require("net")),fke=CE(require("tls")),dct=CE(require("url")),pct=CE(require("assert")),fct=CE($l()),mct=KZ(),hct=CE(dke()),KA=fct.default("https-proxy-agent:agent"),YZ=class extends mct.Agent{constructor(e){let r;if(typeof e=="string"?r=dct.default.parse(e):r=e,!r)throw new Error("an HTTP(S) proxy server `host` and `port` must be specified!");KA("creating new HttpsProxyAgent instance: %o",r),super(r);let n=Object.assign({},r);this.secureProxy=r.secureProxy||bct(n.protocol),n.host=n.hostname||n.host,typeof n.port=="string"&&(n.port=parseInt(n.port,10)),!n.port&&n.host&&(n.port=this.secureProxy?443:80),this.secureProxy&&!("ALPNProtocols"in n)&&(n.ALPNProtocols=["http 1.1"]),n.host&&n.path&&(delete n.path,delete n.pathname),this.proxy=n}callback(e,r){return lct(this,void 0,void 0,function*(){let{proxy:n,secureProxy:o}=this,s;o?(KA("Creating `tls.Socket`: %o",n),s=fke.default.connect(n)):(KA("Creating `net.Socket`: %o",n),s=pke.default.connect(n));let a=Object.assign({},n.headers),u=`CONNECT ${`${r.host}:${r.port}`} HTTP/1.1\r
`;n.auth&&(a["Proxy-Authorization"]=`Basic ${Buffer.from(n.auth).toString("base64")}`);let{host:l,port:d,secureEndpoint:p}=r;vct(d,p)||(l+=`:${d}`),a.Host=l,a.Connection="close";for(let v of Object.keys(a))u+=`${v}: ${a[v]}\r
`;let f=hct.default(s);s.write(`${u}\r
`);let{statusCode:m,buffered:h}=yield f;if(m===200){if(e.once("socket",gct),r.secureEndpoint){KA("Upgrading socket connection to TLS");let v=r.servername||r.host;return fke.default.connect(Object.assign(Object.assign({},yct(r,"host","hostname","path","port")),{socket:s,servername:v}))}return s}s.destroy();let g=new pke.default.Socket({writable:!1});return g.readable=!0,e.once("socket",v=>{KA("replaying proxy buffer for failed request"),pct.default(v.listenerCount("data")>0),v.push(h),v.push(null)}),g})}};L_.default=YZ;function gct(t){t.resume()}function vct(t,e){return!!(!e&&t===80||e&&t===443)}function bct(t){return typeof t=="string"?/^https:?$/i.test(t):!1}function yct(t,...e){let r={},n;for(n in t)e.includes(n)||(r[n]=t[n]);return r}});var gke=O((JZ,hke)=>{"use strict";var _ct=JZ&&JZ.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},QZ=_ct(mke());function XZ(t){return new QZ.default(t)}(function(t){t.HttpsProxyAgent=QZ.default,t.prototype=QZ.default.prototype})(XZ||(XZ={}));hke.exports=XZ});var vke=O(ZZ=>{"use strict";Object.defineProperty(ZZ,"__esModule",{value:!0});function xct(t,e,{signal:r}={}){return new Promise((n,o)=>{function s(){r?.removeEventListener("abort",s),t.removeListener(e,a),t.removeListener("error",c)}function a(...u){s(),n(u)}function c(u){s(),o(u)}r?.addEventListener("abort",s),t.on(e,a),t.on("error",c)})}ZZ.default=xct});var bke=O(O_=>{"use strict";var Sct=O_&&O_.__awaiter||function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},YA=O_&&O_.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(O_,"__esModule",{value:!0});var Ict=YA(require("net")),Cct=YA(require("tls")),eee=YA(require("url")),Tct=YA($l()),Ect=YA(vke()),wct=KZ(),b0=(0,Tct.default)("http-proxy-agent");function Rct(t){return typeof t=="string"?/^https:?$/i.test(t):!1}var tee=class extends wct.Agent{constructor(e){let r;if(typeof e=="string"?r=eee.default.parse(e):r=e,!r)throw new Error("an HTTP(S) proxy server `host` and `port` must be specified!");b0("Creating new HttpProxyAgent instance: %o",r),super(r);let n=Object.assign({},r);this.secureProxy=r.secureProxy||Rct(n.protocol),n.host=n.hostname||n.host,typeof n.port=="string"&&(n.port=parseInt(n.port,10)),!n.port&&n.host&&(n.port=this.secureProxy?443:80),n.host&&n.path&&(delete n.path,delete n.pathname),this.proxy=n}callback(e,r){return Sct(this,void 0,void 0,function*(){let{proxy:n,secureProxy:o}=this,s=eee.default.parse(e.path);s.protocol||(s.protocol="http:"),s.hostname||(s.hostname=r.hostname||r.host||null),s.port==null&&typeof r.port&&(s.port=String(r.port)),s.port==="80"&&(s.port=""),e.path=eee.default.format(s),n.auth&&e.setHeader("Proxy-Authorization",`Basic ${Buffer.from(n.auth).toString("base64")}`);let a;if(o?(b0("Creating `tls.Socket`: %o",n),a=Cct.default.connect(n)):(b0("Creating `net.Socket`: %o",n),a=Ict.default.connect(n)),e._header){let c,u;b0("Regenerating stored HTTP header string for request"),e._header=null,e._implicitHeader(),e.output&&e.output.length>0?(b0("Patching connection write() output buffer with updated header"),c=e.output[0],u=c.indexOf(`\r
\r
`)+4,e.output[0]=e._header+c.substring(u),b0("Output buffer: %o",e.output)):e.outputData&&e.outputData.length>0&&(b0("Patching connection write() output buffer with updated header"),c=e.outputData[0].data,u=c.indexOf(`\r
\r
`)+4,e.outputData[0].data=e._header+c.substring(u),b0("Output buffer: %o",e.outputData[0].data))}return yield(0,Ect.default)(a,"connect"),a})}};O_.default=tee});var _ke=O((iee,yke)=>{"use strict";var kct=iee&&iee.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},ree=kct(bke());function nee(t){return new ree.default(t)}(function(t){t.HttpProxyAgent=ree.default,t.prototype=ree.default.prototype})(nee||(nee={}));yke.exports=nee});function P9(t){if(process.env[t])return process.env[t];if(process.env[t.toLowerCase()])return process.env[t.toLowerCase()]}function Oct(){if(!process)return;let t=P9(Pct),e=P9(Dct),r=P9(Act);return t||e||r}function Mct(t,e,r){if(e.length===0)return!1;let n=new URL(t).hostname;if(r?.has(n))return r.get(n);let o=!1;for(let s of e)s[0]==="."?(n.endsWith(s)||n.length===s.length-1&&n===s.slice(1))&&(o=!0):n===s&&(o=!0);return r?.set(n,o),o}function Fct(){let t=P9(Nct);return Tke=!0,t?t.split(",").map(e=>e.trim()).filter(e=>e.length):[]}function see(t){if(!t&&(t=Oct(),!t))return;let e=new URL(t);return{host:(e.protocol?e.protocol+"//":"")+e.hostname,port:Number.parseInt(e.port||"80"),username:e.username,password:e.password}}function Ske(t,{headers:e,tlsSettings:r}){let n;try{n=new URL(t.host)}catch{throw new Error(`Expecting a valid host string in proxy settings, but found "${t.host}".`)}r&&ws.warning("TLS settings are not supported in combination with custom Proxy, certificates provided to the client will be ignored.");let o={hostname:n.hostname,port:t.port,protocol:n.protocol,headers:e.toJSON()};return t.username&&t.password?o.auth=`${t.username}:${t.password}`:t.username&&(o.auth=`${t.username}`),o}function Uct(t,e){if(t.agent)return;let n=new URL(t.url).protocol!=="https:",o=t.proxySettings;if(o)if(n){if(!e.httpProxyAgent){let s=Ske(o,t);e.httpProxyAgent=new Cke.HttpProxyAgent(s)}t.agent=e.httpProxyAgent}else{if(!e.httpsProxyAgent){let s=Ske(o,t);e.httpsProxyAgent=new Ike.HttpsProxyAgent(s)}t.agent=e.httpsProxyAgent}}function A9(t=see(),e){Tke||xke.push(...Fct());let r={};return{name:oee,async sendRequest(n,o){var s;return!n.proxySettings&&!Mct(n.url,(s=e?.customNoProxyList)!==null&&s!==void 0?s:xke,e?.customNoProxyList?void 0:Lct)&&(n.proxySettings=t),n.proxySettings&&Uct(n,r),o(n)}}}var Ike,Cke,Pct,Act,Dct,Nct,oee,xke,Tke,Lct,aee=A(()=>{Ike=H(gke()),Cke=H(_ke());hE();Pct="HTTPS_PROXY",Act="HTTP_PROXY",Dct="ALL_PROXY",Nct="NO_PROXY",oee="proxyPolicy",xke=[],Tke=!1,Lct=new Map});function D9(t="x-ms-client-request-id"){return{name:cee,async sendRequest(e,r){return e.headers.has(t)||e.headers.set(t,e.requestId),r(e)}}}var cee,uee=A(()=>{cee="setClientRequestIdPolicy"});function N9(t){return{name:lee,sendRequest:async(e,r)=>(e.tlsSettings||(e.tlsSettings=t),r(e))}}var lee,dee=A(()=>{lee="tlsPolicy"});function Eke(t={}){let e=new pee(t.parentContext);return t.span&&(e=e.setValue(TE.span,t.span)),t.namespace&&(e=e.setValue(TE.namespace,t.namespace)),e}var TE,pee,fee=A(()=>{TE={span:Symbol.for("@azure/core-tracing span"),namespace:Symbol.for("@azure/core-tracing namespace")};pee=class t{constructor(e){this._contextMap=e instanceof t?new Map(e._contextMap):new Map}setValue(e,r){let n=new t(this);return n._contextMap.set(e,r),n}getValue(e){return this._contextMap.get(e)}deleteValue(e){let r=new t(this);return r._contextMap.delete(e),r}}});function Bct(){return{end:()=>{},isRecording:()=>!1,recordException:()=>{},setAttribute:()=>{},setStatus:()=>{}}}function qct(){return{createRequestHeaders:()=>({}),parseTraceparentHeader:()=>{},startSpan:(t,e)=>({span:Bct(),tracingContext:Eke({parentContext:e.tracingContext})}),withContext(t,e,...r){return e(...r)}}}function QA(){return mee||(mee=qct()),mee}var mee,wke=A(()=>{fee()});function hee(t){let{namespace:e,packageName:r,packageVersion:n}=t;function o(l,d,p){var f;let m=QA().startSpan(l,Object.assign(Object.assign({},p),{packageName:r,packageVersion:n,tracingContext:(f=d?.tracingOptions)===null||f===void 0?void 0:f.tracingContext})),h=m.tracingContext,g=m.span;h.getValue(TE.namespace)||(h=h.setValue(TE.namespace,e)),g.setAttribute("az.namespace",h.getValue(TE.namespace));let v=Object.assign({},d,{tracingOptions:Object.assign(Object.assign({},d?.tracingOptions),{tracingContext:h})});return{span:g,updatedOptions:v}}async function s(l,d,p,f){let{span:m,updatedOptions:h}=o(l,d,f);try{let g=await a(h.tracingOptions.tracingContext,()=>Promise.resolve(p(h,m)));return m.setStatus({status:"success"}),g}catch(g){throw m.setStatus({status:"error",error:g}),g}finally{m.end()}}function a(l,d,...p){return QA().withContext(l,d,...p)}function c(l){return QA().parseTraceparentHeader(l)}function u(l){return QA().createRequestHeaders(l)}return{startSpan:o,withSpan:s,withContext:a,parseTraceparentHeader:c,createRequestHeaders:u}}var Rke=A(()=>{wke();fee()});var kke=A(()=>{Rke()});var Pke,Ake,Dke=A(()=>{Pke=require("util"),Ake=Pke.inspect.custom});function L9(t){return t instanceof Kc?!0:vE(t)&&t.name==="RestError"}var jct,Kc,O9=A(()=>{yE();Dke();_Z();jct=new _E,Kc=class t extends Error{constructor(e,r={}){super(e),this.name="RestError",this.code=r.code,this.statusCode=r.statusCode,this.request=r.request,this.response=r.response,Object.setPrototypeOf(this,t.prototype)}[Ake](){return`RestError: ${this.message} 
 ${jct.sanitize(this)}`}};Kc.REQUEST_SEND_ERROR="REQUEST_SEND_ERROR";Kc.PARSE_ERROR="PARSE_ERROR"});function M9(t={}){let e=v9(t.userAgentPrefix),r=Hct();return{name:gee,async sendRequest(n,o){var s,a;if(!r||!(!((s=n.tracingOptions)===null||s===void 0)&&s.tracingContext))return o(n);let{span:c,tracingContext:u}=(a=Vct(r,n,e))!==null&&a!==void 0?a:{};if(!c||!u)return o(n);try{let l=await r.withContext(u,o,n);return zct(c,l),l}catch(l){throw Gct(c,l),l}}}}function Hct(){try{return hee({namespace:"",packageName:"@azure/core-rest-pipeline",packageVersion:g9})}catch(t){ws.warning(`Error when creating the TracingClient: ${bE(t)}`);return}}function Vct(t,e,r){try{let{span:n,updatedOptions:o}=t.startSpan(`HTTP ${e.method}`,{tracingOptions:e.tracingOptions},{spanKind:"client",spanAttributes:{"http.method":e.method,"http.url":e.url,requestId:e.requestId}});if(!n.isRecording()){n.end();return}r&&n.setAttribute("http.user_agent",r);let s=t.createRequestHeaders(o.tracingOptions.tracingContext);for(let[a,c]of Object.entries(s))e.headers.set(a,c);return{span:n,tracingContext:o.tracingOptions.tracingContext}}catch(n){ws.warning(`Skipping creating a tracing span due to an error: ${bE(n)}`);return}}function Gct(t,e){try{t.setStatus({status:"error",error:vE(e)?e:void 0}),L9(e)&&e.statusCode&&t.setAttribute("http.status_code",e.statusCode),t.end()}catch(r){ws.warning(`Skipping tracing span processing due to an error: ${bE(r)}`)}}function zct(t,e){try{t.setAttribute("http.status_code",e.status);let r=e.headers.get("x-ms-request-id");r&&t.setAttribute("serviceRequestId",r),t.setStatus({status:"success"}),t.end()}catch(r){ws.warning(`Skipping tracing span processing due to an error: ${bE(r)}`)}}var gee,vee=A(()=>{kke();TZ();EZ();hE();yE();O9();gee="tracingPolicy"});function Nke(t){let e=s9();return d9&&(t.tlsOptions&&e.addPolicy(N9(t.tlsOptions)),e.addPolicy(A9(t.proxyOptions)),e.addPolicy(y9())),e.addPolicy(R9()),e.addPolicy(b9(t.userAgentOptions)),e.addPolicy(D9()),e.addPolicy(T9(t.retryOptions),{phase:"Retry"}),e.addPolicy(M9(t.userAgentOptions),{afterPhase:"Retry"}),d9&&e.addPolicy(h9(t.redirectOptions),{afterPhase:"Retry"}),e.addPolicy(m9(t.loggingOptions),{afterPhase:"Sign"}),e}var Lke=A(()=>{SZ();sZ();CZ();RZ();PZ();DZ();GZ();yE();aee();uee();dee();vee()});function F9(t){return t.toLowerCase()}function*$ct(t){for(let e of t.values())yield[e.name,e.value]}function EE(t){return new bee(t)}var bee,U9=A(()=>{bee=class{constructor(e){if(this._headersMap=new Map,e)for(let r of Object.keys(e))this.set(r,e[r])}set(e,r){this._headersMap.set(F9(e),{name:e,value:String(r)})}get(e){var r;return(r=this._headersMap.get(F9(e)))===null||r===void 0?void 0:r.value}has(e){return this._headersMap.has(F9(e))}delete(e){this._headersMap.delete(F9(e))}toJSON(e={}){let r={};if(e.preserveCase)for(let n of this._headersMap.values())r[n.name]=n.value;else for(let[n,o]of this._headersMap)r[n]=o.value;return r}toString(){return JSON.stringify(this.toJSON({preserveCase:!0}))}[Symbol.iterator](){return $ct(this._headersMap)}}});function XA(t){return t&&typeof t.pipe=="function"}function Oke(t){return new Promise(e=>{t.on("close",e),t.on("end",e),t.on("error",e)})}function Fke(t){return t&&typeof t.byteLength=="number"}function Kct(t){let e=EE();for(let r of Object.keys(t.headers)){let n=t.headers[r];Array.isArray(n)?n.length>0&&e.set(r,n[0]):n&&e.set(r,n)}return e}function Yct(t,e){let r=e.get("Content-Encoding");if(r==="gzip"){let n=q9.createGunzip();return t.pipe(n),n}else if(r==="deflate"){let n=q9.createInflate();return t.pipe(n),n}return t}function Qct(t){return new Promise((e,r)=>{let n=[];t.on("data",o=>{Buffer.isBuffer(o)?n.push(o):n.push(Buffer.from(o))}),t.on("end",()=>{e(Buffer.concat(n).toString("utf8"))}),t.on("error",o=>{o&&o?.name==="AbortError"?r(o):r(new Kc(`Error reading response as text: ${o.message}`,{code:Kc.PARSE_ERROR}))})})}function Xct(t){return t?Buffer.isBuffer(t)?t.length:XA(t)?null:Fke(t)?t.byteLength:typeof t=="string"?Buffer.from(t).length:null:0}function Uke(){return new yee}var wE,RE,q9,Mke,Wct,B9,yee,Bke=A(()=>{wE=H(require("http")),RE=H(require("https")),q9=H(require("zlib")),Mke=require("stream");f9();U9();O9();hE();Wct={};B9=class extends Mke.Transform{constructor(e){super(),this.loadedBytes=0,this.progressCallback=e}_transform(e,r,n){this.push(e),this.loadedBytes+=e.length;try{this.progressCallback({loadedBytes:this.loadedBytes}),n()}catch(o){n(o)}}},yee=class{constructor(){this.cachedHttpsAgents=new WeakMap}async sendRequest(e){var r,n,o;let s=new HA,a;if(e.abortSignal){if(e.abortSignal.aborted)throw new Hp("The operation was aborted.");a=p=>{p.type==="abort"&&s.abort()},e.abortSignal.addEventListener("abort",a)}e.timeout>0&&setTimeout(()=>{s.abort()},e.timeout);let c=e.headers.get("Accept-Encoding"),u=c?.includes("gzip")||c?.includes("deflate"),l=typeof e.body=="function"?e.body():e.body;if(l&&!e.headers.has("Content-Length")){let p=Xct(l);p!==null&&e.headers.set("Content-Length",p)}let d;try{if(l&&e.onUploadProgress){let v=e.onUploadProgress,y=new B9(v);y.on("error",_=>{ws.error("Error in upload progress",_)}),XA(l)?l.pipe(y):y.end(l),l=y}let p=await this.makeRequest(e,s,l),f=Kct(p),h={status:(r=p.statusCode)!==null&&r!==void 0?r:0,headers:f,request:e};if(e.method==="HEAD")return p.resume(),h;d=u?Yct(p,f):p;let g=e.onDownloadProgress;if(g){let v=new B9(g);v.on("error",y=>{ws.error("Error in download progress",y)}),d.pipe(v),d=v}return!((n=e.streamResponseStatusCodes)===null||n===void 0)&&n.has(Number.POSITIVE_INFINITY)||!((o=e.streamResponseStatusCodes)===null||o===void 0)&&o.has(h.status)?h.readableStreamBody=d:h.bodyAsText=await Qct(d),h}finally{if(e.abortSignal&&a){let p=Promise.resolve();XA(l)&&(p=Oke(l));let f=Promise.resolve();XA(d)&&(f=Oke(d)),Promise.all([p,f]).then(()=>{var m;a&&((m=e.abortSignal)===null||m===void 0||m.removeEventListener("abort",a))}).catch(m=>{ws.warning("Error when cleaning up abortListener on httpRequest",m)})}}}makeRequest(e,r,n){var o;let s=new URL(e.url),a=s.protocol!=="https:";if(a&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);let u={agent:(o=e.agent)!==null&&o!==void 0?o:this.getOrCreateAgent(e,a),hostname:s.hostname,path:`${s.pathname}${s.search}`,port:s.port,method:e.method,headers:e.headers.toJSON({preserveCase:!0})};return new Promise((l,d)=>{let p=a?wE.request(u,l):RE.request(u,l);p.once("error",f=>{var m;d(new Kc(f.message,{code:(m=f.code)!==null&&m!==void 0?m:Kc.REQUEST_SEND_ERROR,request:e}))}),r.signal.addEventListener("abort",()=>{let f=new Hp("The operation was aborted.");p.destroy(f),d(f)}),n&&XA(n)?n.pipe(p):n?typeof n=="string"||Buffer.isBuffer(n)?p.end(n):Fke(n)?p.end(ArrayBuffer.isView(n)?Buffer.from(n.buffer):Buffer.from(n)):(ws.error("Unrecognized body type",n),d(new Kc("Unrecognized body type"))):p.end()})}getOrCreateAgent(e,r){var n;let o=e.disableKeepAlive;if(r)return o?wE.globalAgent:(this.cachedHttpAgent||(this.cachedHttpAgent=new wE.Agent({keepAlive:!0})),this.cachedHttpAgent);{if(o&&!e.tlsSettings)return RE.globalAgent;let s=(n=e.tlsSettings)!==null&&n!==void 0?n:Wct,a=this.cachedHttpsAgents.get(s);return a&&a.options.keepAlive===!o||(ws.info("No cached TLS Agent exist, creating a new Agent"),a=new RE.Agent(Object.assign({keepAlive:!o},s)),this.cachedHttpsAgents.set(s,a)),a}}}});function qke(){return Uke()}var jke=A(()=>{Bke()});function _ee(){return j9>H9.length-16&&(Hke.default.randomFillSync(H9),j9=0),H9.slice(j9,j9+=16)}var Hke,H9,j9,Vke=A(()=>{Hke=H(require("crypto")),H9=new Uint8Array(256),j9=H9.length});var Gke,zke=A(()=>{Gke=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i});function Jct(t){return typeof t=="string"&&Gke.test(t)}var $ke,Wke=A(()=>{zke();$ke=Jct});function Zct(t,e=0){let r=(Rs[t[e+0]]+Rs[t[e+1]]+Rs[t[e+2]]+Rs[t[e+3]]+"-"+Rs[t[e+4]]+Rs[t[e+5]]+"-"+Rs[t[e+6]]+Rs[t[e+7]]+"-"+Rs[t[e+8]]+Rs[t[e+9]]+"-"+Rs[t[e+10]]+Rs[t[e+11]]+Rs[t[e+12]]+Rs[t[e+13]]+Rs[t[e+14]]+Rs[t[e+15]]).toLowerCase();if(!$ke(r))throw TypeError("Stringified UUID is invalid");return r}var Rs,Kke,Yke=A(()=>{Wke();Rs=[];for(let t=0;t<256;++t)Rs.push((t+256).toString(16).substr(1));Kke=Zct});function eut(t,e,r){t=t||{};let n=t.random||(t.rng||_ee)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(let o=0;o<16;++o)e[r+o]=n[o];return e}return Kke(n)}var xee,Qke=A(()=>{Vke();Yke();xee=eut});var Xke=A(()=>{Qke()});function Jke(){return xee()}var Zke=A(()=>{Xke()});function ePe(t){return new See(t)}var See,tPe=A(()=>{U9();Zke();See=class{constructor(e){var r,n,o,s,a,c,u;this.url=e.url,this.body=e.body,this.headers=(r=e.headers)!==null&&r!==void 0?r:EE(),this.method=(n=e.method)!==null&&n!==void 0?n:"GET",this.timeout=(o=e.timeout)!==null&&o!==void 0?o:0,this.formData=e.formData,this.disableKeepAlive=(s=e.disableKeepAlive)!==null&&s!==void 0?s:!1,this.proxySettings=e.proxySettings,this.streamResponseStatusCodes=e.streamResponseStatusCodes,this.withCredentials=(a=e.withCredentials)!==null&&a!==void 0?a:!1,this.abortSignal=e.abortSignal,this.tracingOptions=e.tracingOptions,this.onUploadProgress=e.onUploadProgress,this.onDownloadProgress=e.onDownloadProgress,this.requestId=e.requestId||Jke(),this.allowInsecureConnection=(c=e.allowInsecureConnection)!==null&&c!==void 0?c:!1,this.enableBrowserStreams=(u=e.enableBrowserStreams)!==null&&u!==void 0?u:!1}}});function nPe(t={}){var e;return Vp([SE(Object.assign(Object.assign({},t),{ignoreSystemErrors:!0}))],{maxRetries:(e=t.maxRetries)!==null&&e!==void 0?e:3})}var rPe,iPe=A(()=>{C9();IE();rPe="exponentialRetryPolicy"});function oPe(t={}){var e;return{name:Iee,sendRequest:Vp([SE(Object.assign(Object.assign({},t),{ignoreHttpStatusCodes:!0}))],{maxRetries:(e=t.maxRetries)!==null&&e!==void 0?e:3}).sendRequest}}var Iee,sPe=A(()=>{C9();IE();Iee="systemErrorRetryPolicy"});function aPe(t={}){var e;return{name:Cee,sendRequest:Vp([S9()],{maxRetries:(e=t.maxRetries)!==null&&e!==void 0?e:3}).sendRequest}}var Cee,cPe=A(()=>{I9();IE();Cee="throttlingRetryPolicy"});async function rut(t,e,r){async function n(){if(Date.now()<r)try{return await t()}catch{return null}else{let s=await t();if(s===null)throw new Error("Failed to refresh access token.");return s}}let o=await n();for(;o===null;)await _9(e),o=await n();return o}function uPe(t,e){let r=null,n=null,o,s=Object.assign(Object.assign({},tut),e),a={get isRefreshing(){return r!==null},get shouldRefresh(){var u;return!a.isRefreshing&&((u=n?.expiresOnTimestamp)!==null&&u!==void 0?u:0)-s.refreshWindowInMs<Date.now()},get mustRefresh(){return n===null||n.expiresOnTimestamp-s.forcedRefreshWindowInMs<Date.now()}};function c(u,l){var d;return a.isRefreshing||(r=rut(()=>t.getToken(u,l),s.retryIntervalInMs,(d=n?.expiresOnTimestamp)!==null&&d!==void 0?d:Date.now()).then(f=>(r=null,n=f,o=l.tenantId,n)).catch(f=>{throw r=null,n=null,o=void 0,f})),r}return async(u,l)=>o!==l.tenantId||!!l.claims||a.mustRefresh?c(u,l):(a.shouldRefresh&&c(u,l),n)}var tut,lPe=A(()=>{x9();tut={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:1e3*60*2}});async function nut(t){let{scopes:e,getAccessToken:r,request:n}=t,o={abortSignal:n.abortSignal,tracingOptions:n.tracingOptions},s=await r(e,o);s&&t.request.headers.set("Authorization",`Bearer ${s.token}`)}function iut(t){let e=t.headers.get("WWW-Authenticate");if(t.status===401&&e)return e}function dPe(t){var e;let{credential:r,scopes:n,challengeCallbacks:o}=t,s=t.logger||ws,a=Object.assign({authorizeRequest:(e=o?.authorizeRequest)!==null&&e!==void 0?e:nut,authorizeRequestOnChallenge:o?.authorizeRequestOnChallenge},o),c=r?uPe(r):()=>Promise.resolve(null);return{name:Tee,async sendRequest(u,l){if(!u.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");await a.authorizeRequest({scopes:Array.isArray(n)?n:[n],request:u,getAccessToken:c,logger:s});let d,p;try{d=await l(u)}catch(f){p=f,d=f.response}if(a.authorizeRequestOnChallenge&&d?.status===401&&iut(d)&&await a.authorizeRequestOnChallenge({scopes:Array.isArray(n)?n:[n],request:u,response:d,getAccessToken:c,logger:s}))return l(u);if(p)throw p;return d}}}var Tee,pPe=A(()=>{lPe();hE();Tee="bearerTokenAuthenticationPolicy"});function fPe(){return{name:Eee,async sendRequest(t,e){if(typeof t.body=="string"&&t.body.startsWith("[")){let r=JSON.parse(t.body);Array.isArray(r)&&(t.body=r.map(n=>JSON.stringify(n)+`
`).join(""))}return e(t)}}}var Eee,mPe=A(()=>{Eee="ndJsonPolicy"});var hPe={};_n(hPe,{RestError:()=>Kc,bearerTokenAuthenticationPolicy:()=>dPe,bearerTokenAuthenticationPolicyName:()=>Tee,createDefaultHttpClient:()=>qke,createEmptyPipeline:()=>s9,createHttpHeaders:()=>EE,createPipelineFromOptions:()=>Nke,createPipelineRequest:()=>ePe,decompressResponsePolicy:()=>y9,decompressResponsePolicyName:()=>kZ,defaultRetryPolicy:()=>T9,exponentialRetryPolicy:()=>nPe,exponentialRetryPolicyName:()=>rPe,formDataPolicy:()=>R9,formDataPolicyName:()=>VZ,getDefaultProxySettings:()=>see,isRestError:()=>L9,logPolicy:()=>m9,logPolicyName:()=>xZ,ndJsonPolicy:()=>fPe,ndJsonPolicyName:()=>Eee,proxyPolicy:()=>A9,proxyPolicyName:()=>oee,redirectPolicy:()=>h9,redirectPolicyName:()=>IZ,retryPolicy:()=>Vp,setClientRequestIdPolicy:()=>D9,setClientRequestIdPolicyName:()=>cee,systemErrorRetryPolicy:()=>oPe,systemErrorRetryPolicyName:()=>Iee,throttlingRetryPolicy:()=>aPe,throttlingRetryPolicyName:()=>Cee,tlsPolicy:()=>N9,tlsPolicyName:()=>lee,tracingPolicy:()=>M9,tracingPolicyName:()=>gee,userAgentPolicy:()=>b9,userAgentPolicyName:()=>wZ});var gPe=A(()=>{sZ();Lke();jke();U9();tPe();O9();PZ();iPe();uee();SZ();aee();CZ();sPe();cPe();IE();vee();DZ();RZ();dee();GZ();pPe();mPe()});var yPe=O((JA,bPe)=>{"use strict";var sut=JA&&JA.__awaiter||function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},aut=JA&&JA.__generator||function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},vPe=(gPe(),eo(hPe)),cut="https://monitor.azure.com//.default";function uut(t){return null}var lut=function(){function t(e,r){var n=r?[r]:[cut];this._azureTokenPolicy=vPe.bearerTokenAuthenticationPolicy({credential:e,scopes:n})}return t.prototype.addAuthorizationHeader=function(e){return sut(this,void 0,void 0,function(){var r,n;return aut(this,function(o){switch(o.label){case 0:return r="authorization",n=vPe.createPipelineRequest({url:"https://"}),[4,this._azureTokenPolicy.sendRequest(n,uut)];case 1:return o.sent(),e.headers[r]=n.headers.get(r),[2]}})})},t}();bPe.exports=lut});var xPe=O((cOr,_Pe)=>{"use strict";var dut=Wn(),put=Is(),fut=function(){function t(e,r,n,o){this._buffer=[],this._lastSend=0,this._isDisabled=e,this._getBatchSize=r,this._getBatchIntervalMs=n,this._sender=o}return t.prototype.setUseDiskRetryCaching=function(e,r,n){this._sender.setDiskRetryMode(e,r,n)},t.prototype.send=function(e){var r=this;if(!this._isDisabled()){if(!e){dut.warn("Cannot send null/undefined telemetry");return}if(this._buffer.push(e),this._buffer.length>=this._getBatchSize()){this.triggerSend(!1);return}!this._timeoutHandle&&this._buffer.length>0&&(this._timeoutHandle=setTimeout(function(){r._timeoutHandle=null,r.triggerSend(!1)},this._getBatchIntervalMs()))}},t.prototype.triggerSend=function(e,r){var n=this._buffer.length<1;n||(e||put.isNodeExit?(this._sender.saveOnCrash(this._buffer),typeof r=="function"&&r("data saved on crash")):this._sender.send(this._buffer,r)),this._lastSend=+new Date,this._buffer=[],clearTimeout(this._timeoutHandle),this._timeoutHandle=null,n&&typeof r=="function"&&r("no data to send")},t}();_Pe.exports=fut});var SPe=O(V9=>{"use strict";Object.defineProperty(V9,"__esModule",{value:!0});V9.azureRoleEnvironmentTelemetryProcessor=void 0;function mut(t,e){}V9.azureRoleEnvironmentTelemetryProcessor=mut});var TPe=O(kE=>{"use strict";Object.defineProperty(kE,"__esModule",{value:!0});kE.getSamplingHashCode=kE.samplingTelemetryProcessor=void 0;var IPe=Xs();function hut(t,e){var r=t.sampleRate,n=!1;return r==null||r>=100||t.data&&IPe.TelemetryType.Metric===IPe.baseTypeToTelemetryType(t.data.baseType)?!0:(e.correlationContext&&e.correlationContext.operation?n=CPe(e.correlationContext.operation.id)<r:n=Math.random()*100<r,n)}kE.samplingTelemetryProcessor=hut;function CPe(t){var e=-2147483648,r=2147483647,n=5381;if(!t)return 0;for(;t.length<8;)t=t+t;for(var o=0;o<t.length;o++)n=((n<<5)+n|0)+t.charCodeAt(o)|0;return n=n<=e?r:Math.abs(n),n/r*100}kE.getSamplingHashCode=CPe});var EPe=O(G9=>{"use strict";Object.defineProperty(G9,"__esModule",{value:!0});G9.performanceMetricsTelemetryProcessor=void 0;var wee=$8(),Ree=Xs();function gut(t,e){switch(e&&e.addDocument(t),t.data.baseType){case Ree.TelemetryTypeString.Exception:wee.countException();break;case Ree.TelemetryTypeString.Request:var r=t.data.baseData;wee.countRequest(r.duration,r.success);break;case Ree.TelemetryTypeString.Dependency:var n=t.data.baseData;wee.countDependency(n.duration,n.success);break}return!0}G9.performanceMetricsTelemetryProcessor=gut});var wPe=O(PE=>{"use strict";var Gp=PE&&PE.__assign||function(){return Gp=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Gp.apply(this,arguments)};Object.defineProperty(PE,"__esModule",{value:!0});PE.preAggregatedMetricsTelemetryProcessor=void 0;var vut=Xs(),ZA=FJ(),z9=Xs();function but(t,e){if(ZA.isEnabled())switch(t.data.baseType){case z9.TelemetryTypeString.Exception:var r=t.data.baseData;r.properties=Gp(Gp({},r.properties),{"_MS.ProcessedByMetricExtractors":"(Name:'Exceptions', Ver:'1.1')"});var n={cloudRoleInstance:t.tags[e.keys.cloudRoleInstance],cloudRoleName:t.tags[e.keys.cloudRole]};ZA.countException(n);break;case z9.TelemetryTypeString.Trace:var o=t.data.baseData;o.properties=Gp(Gp({},o.properties),{"_MS.ProcessedByMetricExtractors":"(Name:'Traces', Ver:'1.1')"});var s={cloudRoleInstance:t.tags[e.keys.cloudRoleInstance],cloudRoleName:t.tags[e.keys.cloudRole],traceSeverityLevel:vut.SeverityLevel[o.severity]};ZA.countTrace(s);break;case z9.TelemetryTypeString.Request:var a=t.data.baseData;a.properties=Gp(Gp({},a.properties),{"_MS.ProcessedByMetricExtractors":"(Name:'Requests', Ver:'1.1')"});var c={cloudRoleInstance:t.tags[e.keys.cloudRoleInstance],cloudRoleName:t.tags[e.keys.cloudRole],operationSynthetic:t.tags[e.keys.operationSyntheticSource],requestSuccess:a.success,requestResultCode:a.responseCode};ZA.countRequest(a.duration,c);break;case z9.TelemetryTypeString.Dependency:var u=t.data.baseData;u.properties=Gp(Gp({},u.properties),{"_MS.ProcessedByMetricExtractors":"(Name:'Dependencies', Ver:'1.1')"});var l={cloudRoleInstance:t.tags[e.keys.cloudRoleInstance],cloudRoleName:t.tags[e.keys.cloudRole],operationSynthetic:t.tags[e.keys.operationSyntheticSource],dependencySuccess:u.success,dependencyType:u.type,dependencyTarget:u.target,dependencyResultCode:u.resultCode};ZA.countDependency(u.duration,l);break}return!0}PE.preAggregatedMetricsTelemetryProcessor=but});var RPe=O(zp=>{"use strict";var yut=zp&&zp.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[r]}})}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),$9=zp&&zp.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&yut(e,t,r)};Object.defineProperty(zp,"__esModule",{value:!0});$9(SPe(),zp);$9(TPe(),zp);$9(EPe(),zp);$9(wPe(),zp)});var kee=O((mOr,APe)=>{"use strict";var Ht=Xs(),uc=Is(),kPe=o0(),_ut=Wn(),xut=function(){function t(){}return t.createEnvelope=function(e,r,n,o,s){var a=null;switch(r){case Ht.TelemetryType.Trace:a=t.createTraceData(e);break;case Ht.TelemetryType.Dependency:a=t.createDependencyData(e);break;case Ht.TelemetryType.Event:a=t.createEventData(e);break;case Ht.TelemetryType.Exception:a=t.createExceptionData(e);break;case Ht.TelemetryType.Request:a=t.createRequestData(e);break;case Ht.TelemetryType.Metric:a=t.createMetricData(e);break;case Ht.TelemetryType.Availability:a=t.createAvailabilityData(e);break;case Ht.TelemetryType.PageView:a=t.createPageViewData(e);break}if(a&&a.baseData&&Ht.domainSupportsProperties(a.baseData)){if(n)if(!a.baseData.properties)a.baseData.properties=n;else for(var c in n)a.baseData.properties[c]||(a.baseData.properties[c]=n[c]);t.addAzureFunctionsCorrelationProperties(a.baseData.properties),a.baseData.properties&&(a.baseData.properties=uc.validateStringMap(a.baseData.properties))}var u=s&&s.instrumentationKey||"",l=new Ht.Envelope;return l.data=a,l.iKey=u,l.name="Microsoft.ApplicationInsights."+u.replace(/-/g,"")+"."+a.baseType.substr(0,a.baseType.length-4),l.tags=this.getTags(o,e.tagOverrides),l.time=new Date().toISOString(),l.ver=1,l.sampleRate=s?s.samplingPercentage:100,r===Ht.TelemetryType.Metric&&(l.sampleRate=100),l},t.addAzureFunctionsCorrelationProperties=function(e){var r=kPe.CorrelationContextManager.getCurrentContext();if(r&&r.customProperties&&r.customProperties.getProperty instanceof Function){e=e||{};var n=r.customProperties.getProperty("InvocationId");n&&(e.InvocationId=n),n=r.customProperties.getProperty("ProcessId"),n&&(e.ProcessId=n),n=r.customProperties.getProperty("LogLevel"),n&&(e.LogLevel=n),n=r.customProperties.getProperty("Category"),n&&(e.Category=n),n=r.customProperties.getProperty("HostInstanceId"),n&&(e.HostInstanceId=n),n=r.customProperties.getProperty("AzFuncLiveLogsSessionId"),n&&(e.AzFuncLiveLogsSessionId=n)}},t.truncateProperties=function(e){if(e.properties)try{for(var r={},n=Object.keys(e.properties),o=Object.values(e.properties),s=0;s<n.length;s++)n[s].length<=150&&(uc.isDate(o[s])||(o[s]==null&&(o[s]=""),typeof o[s]=="object"&&(o[s]=uc.stringify(o[s])),r[n[s]]=String(o[s]).substring(0,8192)),r[n[s]]=o[s]);return r}catch(a){_ut.warn("Failed to properly truncate telemetry properties: ",a)}},t.createTraceData=function(e){var r,n=new Ht.MessageData;n.message=(r=e.message)===null||r===void 0?void 0:r.substring(0,32768),n.properties=this.truncateProperties(e),isNaN(e.severity)?n.severityLevel=Ht.SeverityLevel.Information:n.severityLevel=e.severity;var o=new Ht.Data;return o.baseType=Ht.telemetryTypeToBaseType(Ht.TelemetryType.Trace),o.baseData=n,o},t.createDependencyData=function(e){var r,n,o,s=new Ht.RemoteDependencyData;s.name=(r=e.name)===null||r===void 0?void 0:r.substring(0,1024),s.data=(n=e.data)===null||n===void 0?void 0:n.substring(0,8192),s.target=(o=e.target)===null||o===void 0?void 0:o.substring(0,1024),s.duration=uc.msToTimeSpan(e.duration),s.success=e.success,s.type=e.dependencyTypeName,s.properties=this.truncateProperties(e),s.resultCode=e.resultCode?e.resultCode.toString():"0",e.id?s.id=e.id:s.id=uc.w3cTraceId();var a=new Ht.Data;return a.baseType=Ht.telemetryTypeToBaseType(Ht.TelemetryType.Dependency),a.baseData=s,a},t.createEventData=function(e){var r,n=new Ht.EventData;n.name=(r=e.name)===null||r===void 0?void 0:r.substring(0,512),n.properties=this.truncateProperties(e),n.measurements=e.measurements;var o=new Ht.Data;return o.baseType=Ht.telemetryTypeToBaseType(Ht.TelemetryType.Event),o.baseData=n,o},t.createExceptionData=function(e){var r,n,o=new Ht.ExceptionData;o.properties=this.truncateProperties(e),isNaN(e.severity)?o.severityLevel=Ht.SeverityLevel.Error:o.severityLevel=e.severity,o.measurements=e.measurements,o.exceptions=[];var s=e.exception.stack,a=new Ht.ExceptionDetails;a.message=(r=e.exception.message)===null||r===void 0?void 0:r.substring(0,32768),a.typeName=(n=e.exception.name)===null||n===void 0?void 0:n.substring(0,1024),a.parsedStack=this.parseStack(s),a.hasFullStack=uc.isArray(a.parsedStack)&&a.parsedStack.length>0,o.exceptions.push(a);var c=new Ht.Data;return c.baseType=Ht.telemetryTypeToBaseType(Ht.TelemetryType.Exception),c.baseData=o,c},t.createRequestData=function(e){var r,n,o,s,a=new Ht.RequestData;e.id?a.id=e.id:a.id=uc.w3cTraceId(),a.name=(r=e.name)===null||r===void 0?void 0:r.substring(0,1024),a.url=(n=e.url)===null||n===void 0?void 0:n.substring(0,2048),a.source=(o=e.source)===null||o===void 0?void 0:o.substring(0,1024),a.duration=uc.msToTimeSpan(e.duration),a.responseCode=(s=e.resultCode?e.resultCode.toString():"0")===null||s===void 0?void 0:s.substring(0,1024),a.success=e.success,a.properties=this.truncateProperties(e),a.measurements=e.measurements;var c=new Ht.Data;return c.baseType=Ht.telemetryTypeToBaseType(Ht.TelemetryType.Request),c.baseData=a,c},t.createMetricData=function(e){var r,n=new Ht.MetricData;n.metrics=[];var o=new Ht.DataPoint;o.count=isNaN(e.count)?1:e.count,o.kind=Ht.DataPointType.Aggregation,o.max=isNaN(e.max)?e.value:e.max,o.min=isNaN(e.min)?e.value:e.min,o.name=(r=e.name)===null||r===void 0?void 0:r.substring(0,1024),o.stdDev=isNaN(e.stdDev)?0:e.stdDev,o.value=e.value,o.ns=e.namespace,n.metrics.push(o),n.properties=this.truncateProperties(e);var s=new Ht.Data;return s.baseType=Ht.telemetryTypeToBaseType(Ht.TelemetryType.Metric),s.baseData=n,s},t.createAvailabilityData=function(e){var r,n,o=new Ht.AvailabilityData;e.id?o.id=e.id:o.id=uc.w3cTraceId(),o.name=(r=e.name)===null||r===void 0?void 0:r.substring(0,1024),o.duration=uc.msToTimeSpan(e.duration),o.success=e.success,o.runLocation=e.runLocation,o.message=(n=e.message)===null||n===void 0?void 0:n.substring(0,8192),o.measurements=e.measurements,o.properties=this.truncateProperties(e);var s=new Ht.Data;return s.baseType=Ht.telemetryTypeToBaseType(Ht.TelemetryType.Availability),s.baseData=o,s},t.createPageViewData=function(e){var r,n,o=new Ht.PageViewData;o.name=(r=e.name)===null||r===void 0?void 0:r.substring(0,1024),o.duration=uc.msToTimeSpan(e.duration),o.url=(n=e.url)===null||n===void 0?void 0:n.substring(0,2048),o.measurements=e.measurements,o.properties=this.truncateProperties(e);var s=new Ht.Data;return s.baseType=Ht.telemetryTypeToBaseType(Ht.TelemetryType.PageView),s.baseData=o,s},t.getTags=function(e,r){var n=kPe.CorrelationContextManager.getCurrentContext(),o={};if(e&&e.tags)for(var s in e.tags)o[s]=e.tags[s];if(r)for(var s in r)o[s]=r[s];return n&&(o[e.keys.operationId]=o[e.keys.operationId]||n.operation.id,o[e.keys.operationName]=o[e.keys.operationName]||n.operation.name,o[e.keys.operationParentId]=o[e.keys.operationParentId]||n.operation.parentId),o},t.parseStack=function(e){var r=void 0;if(typeof e=="string"){var n=e.split(`
`);r=[];for(var o=0,s=0,a=0;a<=n.length;a++){var c=n[a];if(PPe.regex.test(c)){var u=new PPe(n[a],o++);s+=u.sizeInBytes,r.push(u)}}var l=32*1024;if(s>l)for(var d=0,p=r.length-1,f=0,m=d,h=p;d<p;){var g=r[d].sizeInBytes,v=r[p].sizeInBytes;if(f+=g+v,f>l){var y=h-m+1;r.splice(m,y);break}m=d,h=p,d++,p--}}return r},t}(),PPe=function(){function t(e,r){this.sizeInBytes=0,this.level=r,this.method="<no_method>",this.assembly=uc.trim(e);var n=e.match(t.regex);n&&n.length>=5&&(this.method=uc.trim(n[2])||this.method,this.fileName=uc.trim(n[4])||"<no_filename>",this.line=parseInt(n[5])||0),this.sizeInBytes+=this.method.length,this.sizeInBytes+=this.fileName.length,this.sizeInBytes+=this.assembly.length,this.sizeInBytes+=t.baseSize,this.sizeInBytes+=this.level.toString().length,this.sizeInBytes+=this.line.toString().length}return t.regex=/^(\s+at)?(.*?)(\@|\s\(|\s)([^\(\n]+):(\d+):(\d+)(\)?)$/,t.baseSize=58,t}();APe.exports=xut});var DPe=O(y0=>{"use strict";var Sut=y0&&y0.__awaiter||function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},Iut=y0&&y0.__generator||function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};Object.defineProperty(y0,"__esModule",{value:!0});y0.FileAccessControl=void 0;var Cut=require("fs"),Tut=require("os"),AE=require("child_process"),Eut=Wn(),wut=function(){function t(){}return t.checkFileProtection=function(){if(!t.OS_PROVIDES_FILE_PROTECTION&&!t.OS_FILE_PROTECTION_CHECKED)if(t.OS_FILE_PROTECTION_CHECKED=!0,t.USE_ICACLS){try{t.OS_PROVIDES_FILE_PROTECTION=Cut.existsSync(t.ICACLS_PATH)}catch{}t.OS_PROVIDES_FILE_PROTECTION||Eut.warn(t.TAG,"Could not find ICACLS in expected location! This is necessary to use disk retry mode on Windows.")}else t.OS_PROVIDES_FILE_PROTECTION=!0},t.applyACLRules=function(e){return Sut(this,void 0,void 0,function(){var r,n;return Iut(this,function(o){switch(o.label){case 0:if(!t.USE_ICACLS)return[3,7];if(t.ACLED_DIRECTORIES[e]!==void 0)return[3,6];t.ACLED_DIRECTORIES[e]=!1,o.label=1;case 1:return o.trys.push([1,4,,5]),[4,this._getACLIdentity()];case 2:return r=o.sent(),[4,this._runICACLS(this._getACLArguments(e,r))];case 3:return o.sent(),t.ACLED_DIRECTORIES[e]=!0,[3,5];case 4:throw n=o.sent(),t.ACLED_DIRECTORIES[e]=!1,n;case 5:return[3,7];case 6:if(!t.ACLED_DIRECTORIES[e])throw new Error("Setting ACL restrictions did not succeed (cached result)");o.label=7;case 7:return[2]}})})},t.applyACLRulesSync=function(e){if(t.USE_ICACLS){if(t.ACLED_DIRECTORIES[e]===void 0){this._runICACLSSync(this._getACLArguments(e,this._getACLIdentitySync())),t.ACLED_DIRECTORIES[e]=!0;return}else if(!t.ACLED_DIRECTORIES[e])throw new Error("Setting ACL restrictions did not succeed (cached result)")}},t._runICACLS=function(e){return new Promise(function(r,n){var o=AE.spawn(t.ICACLS_PATH,e,{windowsHide:!0});o.on("error",function(s){return n(s)}),o.on("close",function(s,a){s===0?r():n(new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+s+")"))})})},t._runICACLSSync=function(e){if(AE.spawnSync){var r=AE.spawnSync(t.ICACLS_PATH,e,{windowsHide:!0});if(r.error)throw r.error;if(r.status!==0)throw new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+r.status+")")}else throw new Error("Could not synchronously call ICACLS under current version of Node.js")},t._getACLIdentity=function(){return new Promise(function(e,r){t.ACL_IDENTITY&&e(t.ACL_IDENTITY);var n=AE.spawn(t.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]}),o="";n.stdout.on("data",function(s){return o+=s}),n.on("error",function(s){return r(s)}),n.on("close",function(s,a){t.ACL_IDENTITY=o&&o.trim(),s===0?e(t.ACL_IDENTITY):r(new Error("Getting ACL identity did not succeed (PS returned code "+s+")"))})})},t._getACLIdentitySync=function(){if(t.ACL_IDENTITY)return t.ACL_IDENTITY;if(AE.spawnSync){var e=AE.spawnSync(t.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]});if(e.error)throw e.error;if(e.status!==0)throw new Error("Getting ACL identity did not succeed (PS returned code "+e.status+")");return t.ACL_IDENTITY=e.stdout&&e.stdout.toString().trim(),t.ACL_IDENTITY}else throw new Error("Could not synchronously get ACL identity under current version of Node.js")},t._getACLArguments=function(e,r){return[e,"/grant","*S-1-5-32-544:(OI)(CI)F","/grant",r+":(OI)(CI)F","/inheritance:r"]},t.TAG="FileAccessControl",t.ICACLS_PATH=process.env.systemdrive+"/windows/system32/icacls.exe",t.POWERSHELL_PATH=process.env.systemdrive+"/windows/system32/windowspowershell/v1.0/powershell.exe",t.ACLED_DIRECTORIES={},t.ACL_IDENTITY=null,t.OS_FILE_PROTECTION_CHECKED=!1,t.OS_PROVIDES_FILE_PROTECTION=!1,t.USE_ICACLS=Tut.type()==="Windows_NT",t}();y0.FileAccessControl=wut});var Aee=O((tD,LPe)=>{"use strict";var W9=tD&&tD.__awaiter||function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},K9=tD&&tD.__generator||function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},Pee=require("fs"),Rut=require("os"),M_=require("path"),kut=require("zlib"),_0=fi(),Put=pE(),Gm=JK(),lc=Is(),Aut=require("url"),NPe=Wn(),eD=DPe(),Dut=439,Nut=402,Lut=[200,206,402,408,429,439,500],Out=function(){function t(e,r,n,o,s,a,c){this._redirectedHost=null,this._config=e,this._onSuccess=n,this._onError=o,this._statsbeat=s,this._enableDiskRetryMode=!1,this._resendInterval=t.WAIT_BETWEEN_RESEND,this._maxBytesOnDisk=t.MAX_BYTES_ON_DISK,this._numConsecutiveFailures=0,this._numConsecutiveRedirects=0,this._resendTimer=null,this._getAuthorizationHandler=r,this._fileCleanupTimer=null,this._tempDir=M_.join(Rut.tmpdir(),t.TEMPDIR_PREFIX+this._config.instrumentationKey),this._isStatsbeatSender=a||!1,this._shutdownStatsbeat=c,this._failedToIngestCounter=0,this._statsbeatHasReachedIngestionAtLeastOnce=!1}return t.prototype.setDiskRetryMode=function(e,r,n){var o=this;e&&eD.FileAccessControl.checkFileProtection(),this._enableDiskRetryMode=eD.FileAccessControl.OS_PROVIDES_FILE_PROTECTION&&e,typeof r=="number"&&r>=0&&(this._resendInterval=Math.floor(r)),typeof n=="number"&&n>=0&&(this._maxBytesOnDisk=Math.floor(n)),e&&!eD.FileAccessControl.OS_PROVIDES_FILE_PROTECTION&&(this._enableDiskRetryMode=!1,this._logWarn("Ignoring request to enable disk retry mode. Sufficient file protection capabilities were not detected.")),this._enableDiskRetryMode?(this._statsbeat&&this._statsbeat.addFeature(_0.StatsbeatFeature.DISK_RETRY),this._fileCleanupTimer||(this._fileCleanupTimer=setTimeout(function(){o._fileCleanupTask()},t.CLEANUP_TIMEOUT),this._fileCleanupTimer.unref())):(this._statsbeat&&this._statsbeat.removeFeature(_0.StatsbeatFeature.DISK_RETRY),this._fileCleanupTimer&&clearTimeout(this._fileCleanupTimer))},t.prototype.send=function(e,r){return W9(this,void 0,void 0,function(){var n,o,s,a,c,u,l,d,p=this;return K9(this,function(f){switch(f.label){case 0:if(!e)return[3,5];if(n=this._redirectedHost||this._config.endpointUrl,o=new Aut.URL(n).hostname,s={method:"POST",withCredentials:!1,headers:{"Content-Type":"application/x-json-stream"}},a=this._getAuthorizationHandler?this._getAuthorizationHandler(this._config):null,!a)return[3,4];this._statsbeat&&this._statsbeat.addFeature(_0.StatsbeatFeature.AAD_HANDLING),f.label=1;case 1:return f.trys.push([1,3,,4]),[4,a.addAuthorizationHeader(s)];case 2:return f.sent(),[3,4];case 3:return c=f.sent(),u="Failed to get AAD bearer token for the Application.",this._enableDiskRetryMode&&(u+="This batch of telemetry items will be retried. ",this._storeToDisk(e)),u+="Error:"+c.toString(),this._logWarn(u),typeof r=="function"&&r(u),[2];case 4:l="",e.forEach(function(m){var h=lc.stringify(m);typeof h=="string"&&(l+=h+`
`)}),l.length>0&&(l=l.substring(0,l.length-1)),d=Buffer.from?Buffer.from(l):new Buffer(l),kut.gzip(d,function(m,h){var g=h;m?(p._logWarn(lc.dumpObj(m)),g=d,s.headers["Content-Length"]=d.length.toString()):(s.headers["Content-Encoding"]="gzip",s.headers["Content-Length"]=h.length.toString()),p._logInfo(lc.dumpObj(s)),s[Put.disableCollectionRequestOption]=!0;var v=+new Date,y=function(x){x.setEncoding("utf-8");var S="";x.on("data",function(I){S+=I}),x.on("end",function(){var I=+new Date,E=I-v;if(p._numConsecutiveFailures=0,p._isStatsbeatSender&&!p._statsbeatHasReachedIngestionAtLeastOnce&&(Lut.includes(x.statusCode)?p._statsbeatHasReachedIngestionAtLeastOnce=!0:p._statsbeatFailedToIngest()),p._statsbeat&&(x.statusCode==Nut||x.statusCode==Dut?p._statsbeat.countThrottle(_0.StatsbeatNetworkCategory.Breeze,o,x.statusCode):p._statsbeat.countRequest(_0.StatsbeatNetworkCategory.Breeze,o,E,x.statusCode===200,x.statusCode)),p._enableDiskRetryMode){if(x.statusCode===200)p._resendTimer||(p._resendTimer=setTimeout(function(){p._resendTimer=null,p._sendFirstFileOnDisk()},p._resendInterval),p._resendTimer.unref());else if(p._isRetriable(x.statusCode))try{p._statsbeat&&p._statsbeat.countRetry(_0.StatsbeatNetworkCategory.Breeze,o,x.statusCode);var R=JSON.parse(S),B=[];R.errors&&(R.errors.forEach(function(le){(le.statusCode==429||le.statusCode==500||le.statusCode==503)&&B.push(e[le.index])}),B.length>0&&p._storeToDisk(B))}catch{p._storeToDisk(e)}}if(x.statusCode===307||x.statusCode===308)if(p._numConsecutiveRedirects++,p._numConsecutiveRedirects<10){var V=x.headers.location?x.headers.location.toString():null;V&&(p._redirectedHost=V,p.send(e,r))}else{var M={name:"Circular Redirect",message:"Error sending telemetry because of circular redirects."};p._statsbeat&&p._statsbeat.countException(_0.StatsbeatNetworkCategory.Breeze,o,M),typeof r=="function"&&r("Error sending telemetry because of circular redirects.")}else p._numConsecutiveRedirects=0,typeof r=="function"&&r(S),p._logInfo(S),typeof p._onSuccess=="function"&&p._onSuccess(S)})},_=lc.makeRequest(p._config,n,s,y);_.setTimeout(t.HTTP_TIMEOUT,function(){p._requestTimedOut=!0,_.abort()}),_.on("error",function(x){if(p._isStatsbeatSender&&!p._statsbeatHasReachedIngestionAtLeastOnce&&p._statsbeatFailedToIngest(),p._numConsecutiveFailures++,p._statsbeat&&p._statsbeat.countException(_0.StatsbeatNetworkCategory.Breeze,o,x),!p._enableDiskRetryMode||p._numConsecutiveFailures>0&&p._numConsecutiveFailures%t.MAX_CONNECTION_FAILURES_BEFORE_WARN===0){var S="Ingestion endpoint could not be reached. This batch of telemetry items has been lost. Use Disk Retry Caching to enable resending of failed telemetry. Error:";p._enableDiskRetryMode&&(S="Ingestion endpoint could not be reached "+p._numConsecutiveFailures+" consecutive times. There may be resulting telemetry loss. Most recent error:"),p._logWarn(S,lc.dumpObj(x))}else{var S="Transient failure to reach ingestion endpoint. This batch of telemetry items will be retried. Error:";p._logInfo(S,lc.dumpObj(x))}p._onErrorHelper(x),typeof r=="function"&&(x?(p._requestTimedOut&&(x.name="telemetry timeout",x.message="telemetry request timed out"),r(lc.dumpObj(x))):r("Error sending telemetry")),p._enableDiskRetryMode&&p._storeToDisk(e)}),_.write(g),_.end()}),f.label=5;case 5:return[2]}})})},t.prototype.saveOnCrash=function(e){this._enableDiskRetryMode&&this._storeToDiskSync(lc.stringify(e))},t.prototype._isRetriable=function(e){return e===206||e===401||e===403||e===408||e===429||e===500||e===502||e===503||e===504},t.prototype._logInfo=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this._isStatsbeatSender||NPe.info(t.TAG,e,r)},t.prototype._logWarn=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];this._isStatsbeatSender||NPe.warn(t.TAG,e,r)},t.prototype._statsbeatFailedToIngest=function(){this._shutdownStatsbeat&&(this._failedToIngestCounter++,this._failedToIngestCounter>=3&&this._shutdownStatsbeat())},t.prototype._storeToDisk=function(e){return W9(this,void 0,void 0,function(){var r,n,o,s,a,c,u;return K9(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),this._logInfo("Checking existence of data storage directory: "+this._tempDir),[4,Gm.confirmDirExists(this._tempDir)];case 1:return l.sent(),[3,3];case 2:return r=l.sent(),this._logWarn("Failed to create folder to put telemetry: "+lc.dumpObj(r)),this._onErrorHelper(r),[2];case 3:return l.trys.push([3,5,,6]),[4,eD.FileAccessControl.applyACLRules(this._tempDir)];case 4:return l.sent(),[3,6];case 5:return n=l.sent(),this._logWarn("Failed to apply file access control to folder: "+lc.dumpObj(n)),this._onErrorHelper(n),[2];case 6:return l.trys.push([6,8,,9]),[4,Gm.getShallowDirectorySize(this._tempDir)];case 7:return o=l.sent(),o>this._maxBytesOnDisk?(this._logWarn("Not saving data due to max size limit being met. Directory size in bytes is: "+o),[2]):[3,9];case 8:return s=l.sent(),this._logWarn("Failed to read directory for retriable telemetry: "+lc.dumpObj(s)),this._onErrorHelper(s),[2];case 9:return l.trys.push([9,11,,12]),a=new Date().getTime()+".ai.json",c=M_.join(this._tempDir,a),this._logInfo("saving data to disk at: "+c),[4,Gm.writeFileAsync(c,lc.stringify(e),{mode:384})];case 10:return l.sent(),[3,12];case 11:return u=l.sent(),this._logWarn("Failed to persist telemetry to disk: "+lc.dumpObj(u)),this._onErrorHelper(u),[2];case 12:return[2]}})})},t.prototype._storeToDiskSync=function(e){try{this._logInfo("Checking existence of data storage directory: "+this._tempDir),Pee.existsSync(this._tempDir)||Pee.mkdirSync(this._tempDir),eD.FileAccessControl.applyACLRulesSync(this._tempDir);var r=Gm.getShallowDirectorySizeSync(this._tempDir);if(r>this._maxBytesOnDisk){this._logInfo("Not saving data due to max size limit being met. Directory size in bytes is: "+r);return}var n=new Date().getTime()+".ai.json",o=M_.join(this._tempDir,n);this._logInfo("saving data before crash to disk at: "+o),Pee.writeFileSync(o,e,{mode:384})}catch(s){this._logWarn("Error while saving data to disk: "+lc.dumpObj(s)),this._onErrorHelper(s)}},t.prototype._sendFirstFileOnDisk=function(){return W9(this,void 0,void 0,function(){var e,r,n,o,s,a;return K9(this,function(c){switch(c.label){case 0:return c.trys.push([0,6,,7]),[4,Gm.readdirAsync(this._tempDir)];case 1:return e=c.sent(),e=e.filter(function(u){return M_.basename(u).indexOf(".ai.json")>-1}),e.length>0?(r=e[0],n=M_.join(this._tempDir,r),[4,Gm.readFileAsync(n)]):[3,5];case 2:return o=c.sent(),[4,Gm.unlinkAsync(n)];case 3:return c.sent(),s=JSON.parse(o.toString()),[4,this.send(s)];case 4:c.sent(),c.label=5;case 5:return[3,7];case 6:return a=c.sent(),this._onErrorHelper(a),[3,7];case 7:return[2]}})})},t.prototype._onErrorHelper=function(e){typeof this._onError=="function"&&this._onError(e)},t.prototype._fileCleanupTask=function(){return W9(this,void 0,void 0,function(){var e,r,n,o,s,a,c=this;return K9(this,function(u){switch(u.label){case 0:return u.trys.push([0,6,,7]),[4,Gm.readdirAsync(this._tempDir)];case 1:if(e=u.sent(),e=e.filter(function(l){return M_.basename(l).indexOf(".ai.json")>-1}),!(e.length>0))return[3,5];r=0,u.label=2;case 2:return r<e.length?(n=new Date(parseInt(e[r].split(".ai.json")[0])),o=new Date(+new Date-t.FILE_RETEMPTION_PERIOD)>n,o?(s=M_.join(this._tempDir,e[r]),[4,Gm.unlinkAsync(s).catch(function(l){c._onErrorHelper(l)})]):[3,4]):[3,5];case 3:u.sent(),u.label=4;case 4:return r++,[3,2];case 5:return[3,7];case 6:return a=u.sent(),a.code!="ENOENT"&&this._onErrorHelper(a),[3,7];case 7:return[2]}})})},t.TAG="Sender",t.WAIT_BETWEEN_RESEND=60*1e3,t.MAX_BYTES_ON_DISK=50*1024*1024,t.MAX_CONNECTION_FAILURES_BEFORE_WARN=5,t.CLEANUP_TIMEOUT=60*60*1e3,t.FILE_RETEMPTION_PERIOD=7*24*60*60*1e3,t.TEMPDIR_PREFIX="appInsights-node",t.HTTP_TIMEOUT=2e4,t}();LPe.exports=Out});var MPe=O(Y9=>{"use strict";Object.defineProperty(Y9,"__esModule",{value:!0});Y9.AzureVirtualMachine=void 0;var OPe=Wn(),Mut=Is(),Fut=pE(),Uut="http://169.254.169.254/metadata/instance/compute",But="api-version=2017-12-01",qut="format=json",jut="UNREACH",Hut=function(){function t(){}return t.getAzureComputeMetadata=function(e,r){var n,o=this,s={},a=Uut+"?"+But+"&"+qut,c=(n={method:"GET"},n[Fut.disableCollectionRequestOption]=!0,n.headers={Metadata:"True"},n),u=Mut.makeRequest(e,a,c,function(l){if(l.statusCode===200){s.isVM=!0;var d="";l.on("data",function(p){d+=p}),l.on("end",function(){try{var p=JSON.parse(d);s.id=p.vmId||"",s.subscriptionId=p.subscriptionId||"",s.osType=p.osType||""}catch(f){OPe.info(t.TAG,f)}r(s)})}else r(s)},!1,!1);u&&(setTimeout(function(){o._requestTimedOut=!0,u.abort()},t.HTTP_TIMEOUT),u.on("error",function(l){o._requestTimedOut&&l&&(l.name="telemetry timeout",l.message="telemetry request timed out"),l&&l.message&&l.message.indexOf(jut)>-1?s.isVM=!1:OPe.info(t.TAG,l),r(s)}),u.end())},t.HTTP_TIMEOUT=2500,t.TAG="AzureVirtualMachine",t}();Y9.AzureVirtualMachine=Hut});var FPe=O(Q9=>{"use strict";Object.defineProperty(Q9,"__esModule",{value:!0});Q9.NetworkStatsbeat=void 0;var Vut=function(){function t(e,r){this.endpoint=e,this.host=r,this.totalRequestCount=0,this.totalSuccesfulRequestCount=0,this.totalFailedRequestCount=[],this.retryCount=[],this.exceptionCount=[],this.throttleCount=[],this.intervalRequestExecutionTime=0,this.lastIntervalRequestExecutionTime=0,this.lastTime=+new Date,this.lastRequestCount=0}return t}();Q9.NetworkStatsbeat=Vut});var HPe=O((F_,jPe)=>{"use strict";var $p=F_&&F_.__assign||function(){return $p=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},$p.apply(this,arguments)},Dee=F_&&F_.__awaiter||function(t,e,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(d){try{l(n.next(d))}catch(p){a(p)}}function u(d){try{l(n.throw(d))}catch(p){a(p)}}function l(d){d.done?s(d.value):o(d.value).then(c,u)}l((n=n.apply(t,e||[])).next())})},Nee=F_&&F_.__generator||function(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(d){return u([l,d])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=l[0]&2?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,o=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(d){l=[6,d],o=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},Gut=require("os"),zut=kee(),UPe=Wn(),$ut=Aee(),Qn=fi(),Wut=Xs(),Kut=MPe(),Yut=iZ(),BPe=oE(),Qut=FPe(),qPe=Is(),Xut="node",Jut=function(){function t(e,r){this._attach=Qn.StatsbeatAttach.sdk,this._feature=Qn.StatsbeatFeature.NONE,this._instrumentation=Qn.StatsbeatInstrumentation.NONE,this._isInitialized=!1,this._statbeatMetrics=[],this._networkStatsbeatCollection=[],this._config=e,this._context=r||new BPe;var n=this._getConnectionString(e);this._statsbeatConfig=new Yut(n),this._statsbeatConfig.samplingPercentage=100,this._sender=new $ut(this._statsbeatConfig,null,null,null,null,!0,this._shutdownStatsbeat.bind(this))}return t.prototype.enable=function(e){var r=this;this._isEnabled=e,this._isEnabled&&!this._isInitialized&&(this._getCustomProperties(),this._isInitialized=!0),e?(this._handle||(this._handle=setInterval(function(){r.trackShortIntervalStatsbeats()},t.STATS_COLLECTION_SHORT_INTERVAL),this._handle.unref()),this._longHandle||(this.trackLongIntervalStatsbeats(),this._longHandle=setInterval(function(){r.trackLongIntervalStatsbeats()},t.STATS_COLLECTION_LONG_INTERVAL),this._longHandle.unref())):(this._handle&&(clearInterval(this._handle),this._handle=null),this._longHandle&&(clearInterval(this._longHandle),this._longHandle=null))},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype.isEnabled=function(){return this._isEnabled},t.prototype.setCodelessAttach=function(){this._attach=Qn.StatsbeatAttach.codeless},t.prototype.addFeature=function(e){this._feature|=e},t.prototype.removeFeature=function(e){this._feature&=~e},t.prototype.addInstrumentation=function(e){this._instrumentation|=e},t.prototype.removeInstrumentation=function(e){this._instrumentation&=~e},t.prototype.countRequest=function(e,r,n,o,s){if(this.isEnabled()){var a=this._getNetworkStatsbeatCounter(e,r);if(a.totalRequestCount++,a.intervalRequestExecutionTime+=n,o===!1){if(!s)return;var c=a.totalFailedRequestCount.find(function(u){return s===u.statusCode});c?c.count++:a.totalFailedRequestCount.push({statusCode:s,count:1})}else a.totalSuccesfulRequestCount++}},t.prototype.countException=function(e,r,n){if(this.isEnabled()){var o=this._getNetworkStatsbeatCounter(e,r),s=o.exceptionCount.find(function(a){return n.name===a.exceptionType});s?s.count++:o.exceptionCount.push({exceptionType:n.name,count:1})}},t.prototype.countThrottle=function(e,r,n){if(this.isEnabled()){var o=this._getNetworkStatsbeatCounter(e,r),s=o.throttleCount.find(function(a){return n===a.statusCode});s?s.count++:o.throttleCount.push({statusCode:n,count:1})}},t.prototype.countRetry=function(e,r,n){if(this.isEnabled()){var o=this._getNetworkStatsbeatCounter(e,r),s=o.retryCount.find(function(a){return n===a.statusCode});s?s.count++:o.retryCount.push({statusCode:n,count:1})}},t.prototype.trackShortIntervalStatsbeats=function(){return Dee(this,void 0,void 0,function(){var e,r;return Nee(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,this._getResourceProvider()];case 1:return n.sent(),e={os:this._os,rp:this._resourceProvider,cikey:this._cikey,runtimeVersion:this._runtimeVersion,language:this._language,version:this._sdkVersion,attach:this._attach},this._trackRequestDuration(e),this._trackRequestsCount(e),[4,this._sendStatsbeats()];case 2:return n.sent(),[3,4];case 3:return r=n.sent(),UPe.info(t.TAG,"Failed to send Statsbeat metrics: "+qPe.dumpObj(r)),[3,4];case 4:return[2]}})})},t.prototype.trackLongIntervalStatsbeats=function(){return Dee(this,void 0,void 0,function(){var e,r,n,o,s;return Nee(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,this._getResourceProvider()];case 1:return a.sent(),e={os:this._os,rp:this._resourceProvider,cikey:this._cikey,runtimeVersion:this._runtimeVersion,language:this._language,version:this._sdkVersion,attach:this._attach},r=Object.assign({rpId:this._resourceIdentifier},e),this._statbeatMetrics.push({name:Qn.StatsbeatCounter.ATTACH,value:1,properties:r}),this._instrumentation!=Qn.StatsbeatInstrumentation.NONE&&(n=Object.assign({feature:this._instrumentation,type:Qn.StatsbeatFeatureType.Instrumentation},e),this._statbeatMetrics.push({name:Qn.StatsbeatCounter.FEATURE,value:1,properties:n})),this._feature!=Qn.StatsbeatFeature.NONE&&(o=Object.assign({feature:this._feature,type:Qn.StatsbeatFeatureType.Feature},e),this._statbeatMetrics.push({name:Qn.StatsbeatCounter.FEATURE,value:1,properties:o})),[4,this._sendStatsbeats()];case 2:return a.sent(),[3,4];case 3:return s=a.sent(),UPe.info(t.TAG,"Failed to send Statsbeat metrics: "+qPe.dumpObj(s)),[3,4];case 4:return[2]}})})},t.prototype._getNetworkStatsbeatCounter=function(e,r){for(var n=this._getShortHost(r),o=0;o<this._networkStatsbeatCollection.length;o++)if(e===this._networkStatsbeatCollection[o].endpoint&&n===this._networkStatsbeatCollection[o].host)return this._networkStatsbeatCollection[o];var s=new Qut.NetworkStatsbeat(e,n);return this._networkStatsbeatCollection.push(s),s},t.prototype._trackRequestDuration=function(e){for(var r=0;r<this._networkStatsbeatCollection.length;r++){var n=this._networkStatsbeatCollection[r];n.time=+new Date;var o=n.totalRequestCount-n.lastRequestCount||0,s=n.intervalRequestExecutionTime-n.lastIntervalRequestExecutionTime,a=s>0&&s/o||0;if(n.lastIntervalRequestExecutionTime=n.intervalRequestExecutionTime,o>0){var c=Object.assign({endpoint:this._networkStatsbeatCollection[r].endpoint,host:this._networkStatsbeatCollection[r].host},e);this._statbeatMetrics.push({name:Qn.StatsbeatCounter.REQUEST_DURATION,value:a,properties:c})}n.lastRequestCount=n.totalRequestCount,n.lastTime=n.time}},t.prototype._getShortHost=function(e){var r=e;try{var n=new RegExp(/^https?:\/\/(?:www\.)?([^\/.-]+)/),o=n.exec(e);o!=null&&o.length>1&&(r=o[1]),r=r.replace(".in.applicationinsights.azure.com","")}catch{}return r},t.prototype._trackRequestsCount=function(e){for(var r=this,n=function(c){s=o._networkStatsbeatCollection[c];var u=Object.assign({endpoint:s.endpoint,host:s.host},e);s.totalSuccesfulRequestCount>0&&(o._statbeatMetrics.push({name:Qn.StatsbeatCounter.REQUEST_SUCCESS,value:s.totalSuccesfulRequestCount,properties:u}),s.totalSuccesfulRequestCount=0),s.totalFailedRequestCount.length>0&&(s.totalFailedRequestCount.forEach(function(l){u=Object.assign($p($p({},u),{statusCode:l.statusCode})),r._statbeatMetrics.push({name:Qn.StatsbeatCounter.REQUEST_FAILURE,value:l.count,properties:u})}),s.totalFailedRequestCount=[]),s.retryCount.length>0&&(s.retryCount.forEach(function(l){u=Object.assign($p($p({},u),{statusCode:l.statusCode})),r._statbeatMetrics.push({name:Qn.StatsbeatCounter.RETRY_COUNT,value:l.count,properties:u})}),s.retryCount=[]),s.throttleCount.length>0&&(s.throttleCount.forEach(function(l){u=Object.assign($p($p({},u),{statusCode:l.statusCode})),r._statbeatMetrics.push({name:Qn.StatsbeatCounter.THROTTLE_COUNT,value:l.count,properties:u})}),s.throttleCount=[]),s.exceptionCount.length>0&&(s.exceptionCount.forEach(function(l){u=Object.assign($p($p({},u),{exceptionType:l.exceptionType})),r._statbeatMetrics.push({name:Qn.StatsbeatCounter.EXCEPTION_COUNT,value:l.count,properties:u})}),s.exceptionCount=[])},o=this,s,a=0;a<this._networkStatsbeatCollection.length;a++)n(a)},t.prototype._sendStatsbeats=function(){return Dee(this,void 0,void 0,function(){var e,r,n,o;return Nee(this,function(s){switch(s.label){case 0:for(e=[],r=0;r<this._statbeatMetrics.length;r++)n={name:this._statbeatMetrics[r].name,value:this._statbeatMetrics[r].value,properties:this._statbeatMetrics[r].properties},o=zut.createEnvelope(n,Wut.TelemetryType.Metric,null,this._context,this._statsbeatConfig),o.name=Qn.StatsbeatTelemetryName,e.push(o);return this._statbeatMetrics=[],[4,this._sender.send(e)];case 1:return s.sent(),[2]}})})},t.prototype._getCustomProperties=function(){this._language=Xut,this._cikey=this._config.instrumentationKey,this._sdkVersion=BPe.sdkVersion,this._os=Gut.type(),this._runtimeVersion=process.version},t.prototype._getResourceProvider=function(){var e=this;return new Promise(function(r,n){var o=!1;e._resourceProvider=Qn.StatsbeatResourceProvider.unknown,e._resourceIdentifier=Qn.StatsbeatResourceProvider.unknown,process.env.AKS_ARM_NAMESPACE_ID?(e._resourceProvider=Qn.StatsbeatResourceProvider.aks,e._resourceIdentifier=process.env.AKS_ARM_NAMESPACE_ID):process.env.WEBSITE_SITE_NAME?(e._resourceProvider=Qn.StatsbeatResourceProvider.appsvc,e._resourceIdentifier=process.env.WEBSITE_SITE_NAME,process.env.WEBSITE_HOME_STAMPNAME&&(e._resourceIdentifier+="/"+process.env.WEBSITE_HOME_STAMPNAME)):process.env.FUNCTIONS_WORKER_RUNTIME?(e._resourceProvider=Qn.StatsbeatResourceProvider.functions,process.env.WEBSITE_HOSTNAME&&(e._resourceIdentifier=process.env.WEBSITE_HOSTNAME)):e._config&&(e._isVM===void 0||e._isVM==!0?(o=!0,Kut.AzureVirtualMachine.getAzureComputeMetadata(e._config,function(s){e._isVM=s.isVM,e._isVM&&(e._resourceProvider=Qn.StatsbeatResourceProvider.vm,e._resourceIdentifier=s.id+"/"+s.subscriptionId,s.osType&&(e._os=s.osType)),r()})):e._resourceProvider=Qn.StatsbeatResourceProvider.unknown),o||r()})},t.prototype._shutdownStatsbeat=function(){this.enable(!1)},t.prototype._getConnectionString=function(e){for(var r=e.endpointUrl,n=["westeurope","northeurope","francecentral","francesouth","germanywestcentral","norwayeast","norwaywest","swedencentral","switzerlandnorth","switzerlandwest","uksouth","ukwest"],o=0;o<n.length;o++)if(r.indexOf(n[o])>-1)return t.EU_CONNECTION_STRING;return t.NON_EU_CONNECTION_STRING},t.NON_EU_CONNECTION_STRING="InstrumentationKey=c4a29126-a7cb-47e5-b348-11414998b11e;IngestionEndpoint=https://westus-0.in.applicationinsights.azure.com",t.EU_CONNECTION_STRING="InstrumentationKey=7dc56bab-3c0c-4e9f-9ebb-d1acadee8d0f;IngestionEndpoint=https://westeurope-5.in.applicationinsights.azure.com",t.STATS_COLLECTION_SHORT_INTERVAL=9e5,t.STATS_COLLECTION_LONG_INTERVAL=864e5,t.TAG="Statsbeat",t}();jPe.exports=Jut});var zPe=O((bOr,GPe)=>{"use strict";var Zut=require("url"),elt=iZ(),tlt=yPe(),rlt=oE(),zm=Xs(),nlt=xPe(),Lee=RPe(),VPe=o0(),ilt=HPe(),olt=Aee(),Oee=Is(),X9=Wn(),slt=kee(),alt=function(){function t(e){this._telemetryProcessors=[];var r=new elt(e);if(this.config=r,!this.config.instrumentationKey||this.config.instrumentationKey=="")throw new Error("Instrumentation key not found, please provide a connection string before starting Application Insights SDK.");this.context=new rlt,this.commonProperties={},this.authorizationHandler=null,this.config.disableStatsbeat||(this._statsbeat=new ilt(this.config,this.context),this._statsbeat.enable(!0));var n=new olt(this.config,this.getAuthorizationHandler,null,null,this._statsbeat);this.channel=new nlt(function(){return r.disableAppInsights},function(){return r.maxBatchSize},function(){return r.maxBatchIntervalMs},n)}return t.prototype.trackAvailability=function(e){this.track(e,zm.TelemetryType.Availability)},t.prototype.trackPageView=function(e){this.track(e,zm.TelemetryType.PageView)},t.prototype.trackTrace=function(e){this.track(e,zm.TelemetryType.Trace)},t.prototype.trackMetric=function(e){this.track(e,zm.TelemetryType.Metric)},t.prototype.trackException=function(e){e&&e.exception&&!Oee.isError(e.exception)&&(e.exception=new Error(e.exception.toString())),this.track(e,zm.TelemetryType.Exception)},t.prototype.trackEvent=function(e){this.track(e,zm.TelemetryType.Event)},t.prototype.trackRequest=function(e){this.track(e,zm.TelemetryType.Request)},t.prototype.trackDependency=function(e){if(e&&!e.target&&e.data)try{e.target=new Zut.URL(e.data).host}catch(r){e.target=null,X9.warn(t.TAG,"The URL object is failed to create.",r)}this.track(e,zm.TelemetryType.Dependency)},t.prototype.flush=function(e){this.channel.triggerSend(e?!!e.isAppCrashing:!1,e?e.callback:void 0)},t.prototype.track=function(e,r){if(e&&zm.telemetryTypeToBaseType(r)){var n=slt.createEnvelope(e,r,this.commonProperties,this.context,this.config);e.time&&(n.time=e.time.toISOString());var o=this.runTelemetryProcessors(n,e.contextObjects);o=o&&Lee.samplingTelemetryProcessor(n,{correlationContext:VPe.CorrelationContextManager.getCurrentContext()}),Lee.preAggregatedMetricsTelemetryProcessor(n,this.context),o&&(Lee.performanceMetricsTelemetryProcessor(n,this.quickPulseClient),this.channel.send(n))}else X9.warn(t.TAG,"track() requires telemetry object and telemetryType to be specified.")},t.prototype.setAutoPopulateAzureProperties=function(e){},t.prototype.getAuthorizationHandler=function(e){return e&&e.aadTokenCredential?(this.authorizationHandler||(X9.info(t.TAG,"Adding authorization handler"),this.authorizationHandler=new tlt(e.aadTokenCredential,e.aadAudience)),this.authorizationHandler):null},t.prototype.addTelemetryProcessor=function(e){this._telemetryProcessors.push(e)},t.prototype.clearTelemetryProcessors=function(){this._telemetryProcessors=[]},t.prototype.runTelemetryProcessors=function(e,r){var n=!0,o=this._telemetryProcessors.length;if(o===0)return n;r=r||{},r.correlationContext=VPe.CorrelationContextManager.getCurrentContext();for(var s=0;s<o;++s)try{var a=this._telemetryProcessors[s];if(a&&a.apply(null,[e,r])===!1){n=!1;break}}catch(c){n=!0,X9.warn(t.TAG,"One of telemetry processors failed, telemetry item will be sent.",c,e)}return n&&(e&&e.tags&&(e.tags=Oee.validateStringMap(e.tags)),e&&e.data&&e.data.baseData&&e.data.baseData.properties&&(e.data.baseData.properties=Oee.validateStringMap(e.data.baseData.properties))),n},t.prototype.getStatsbeat=function(){return this._statsbeat},t.TAG="TelemetryClient",t}();GPe.exports=alt});var KPe=O((Mee,WPe)=>{"use strict";var clt=Mee&&Mee.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])},t(e,r)};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),ult=zPe(),$Pe=XJ(),llt=pE(),J9=Wn(),dlt=function(t){clt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.trackNodeHttpRequestSync=function(r){r&&r.request&&r.response&&r.duration?$Pe.trackRequestSync(this,r):J9.warn("trackNodeHttpRequestSync requires NodeHttpRequestTelemetry object with request, response and duration specified.")},e.prototype.trackNodeHttpRequest=function(r){(r.duration||r.error)&&J9.warn("trackNodeHttpRequest will ignore supplied duration and error parameters. These values are collected from the request and response objects."),r&&r.request&&r.response?$Pe.trackRequest(this,r):J9.warn("trackNodeHttpRequest requires NodeHttpRequestTelemetry object with request and response specified.")},e.prototype.trackNodeHttpDependency=function(r){r&&r.request?llt.trackRequest(this,r):J9.warn("trackNodeHttpDependency requires NodeHttpDependencyTelemetry object with request specified.")},e}(ult);WPe.exports=dlt});var QPe=O(YPe=>{"use strict";Object.defineProperty(YPe,"__esModule",{value:!0})});var t2e=O(ae=>{"use strict";Object.defineProperty(ae,"__esModule",{value:!0});ae.dispose=ae.Configuration=ae.wrapWithCorrelationContext=ae.startOperation=ae.getCorrelationContext=ae.start=ae.setup=ae.liveMetricsClient=ae.defaultClient=ae.DistributedTracingModes=void 0;var Fee=o0(),plt=qEe(),flt=HEe(),Uee=$8(),mlt=FJ(),hlt=QEe(),glt=cwe(),vlt=pE(),blt=XJ(),XPe=v_(),rD=Wn(),JPe=jwe(),Bee=Hwe(),ylt=zwe();ae.TelemetryClient=KPe();ae.Contracts=Xs();ae.azureFunctionsTypes=QPe();var ZPe;(function(t){t[t.AI=0]="AI",t[t.AI_AND_W3C=1]="AI_AND_W3C"})(ZPe=ae.DistributedTracingModes||(ae.DistributedTracingModes={}));var nD,iD,oD,sD,aD,DE,NE,U_,cD,uD,Yc=!1,Z9;function _lt(t){return ae.defaultClient?rD.info("The default client is already setup"):(ae.defaultClient=new ae.TelemetryClient(t),nD=new plt(ae.defaultClient),iD=new flt(ae.defaultClient),oD=new Uee(ae.defaultClient),sD=new mlt(ae.defaultClient),aD=new hlt(ae.defaultClient),DE=new glt(ae.defaultClient),U_=new blt(ae.defaultClient),cD=new vlt(ae.defaultClient),NE||(NE=new Bee.AutoCollectNativePerformance(ae.defaultClient)),uD=new ylt.AzureFunctionsHook(ae.defaultClient)),qee}ae.setup=_lt;function xlt(){ae.defaultClient&&(ae.defaultClient.config.enableAutoCollectExternalLoggers==null&&(ae.defaultClient.config.enableAutoCollectExternalLoggers=!0),ae.defaultClient.config.enableAutoCollectConsole==null&&(ae.defaultClient.config.enableAutoCollectConsole=!1),ae.defaultClient.config.enableAutoCollectExceptions==null&&(ae.defaultClient.config.enableAutoCollectExceptions=!0),ae.defaultClient.config.enableAutoCollectPerformance==null&&(ae.defaultClient.config.enableAutoCollectPerformance=!0),ae.defaultClient.config.enableAutoCollectPreAggregatedMetrics==null&&(ae.defaultClient.config.enableAutoCollectPreAggregatedMetrics=!0),ae.defaultClient.config.enableAutoCollectHeartbeat==null&&(ae.defaultClient.config.enableAutoCollectHeartbeat=!0),ae.defaultClient.config.enableAutoCollectRequests==null&&(ae.defaultClient.config.enableAutoCollectRequests=!0),ae.defaultClient.config.enableAutoCollectDependencies==null&&(ae.defaultClient.config.enableAutoCollectDependencies=!0),ae.defaultClient.config.enableUseDiskRetryCaching==null&&(ae.defaultClient.config.enableUseDiskRetryCaching=!0),ae.defaultClient.config.enableAutoDependencyCorrelation==null&&(ae.defaultClient.config.enableAutoDependencyCorrelation=!0),ae.defaultClient.config.enableSendLiveMetrics==null&&(ae.defaultClient.config.enableSendLiveMetrics=!1),ae.defaultClient.config.enableAutoCollectExtendedMetrics==null&&(ae.defaultClient.config.enableAutoCollectExtendedMetrics=!0),ae.defaultClient.config.enableWebInstrumentation==null&&(ae.defaultClient.config.enableWebInstrumentation=!1),ae.defaultClient.config.enableAutoCollectIncomingRequestAzureFunctions==null&&(ae.defaultClient.config.enableAutoCollectIncomingRequestAzureFunctions=!1))}function e2e(){if(ae.defaultClient){Yc=!0,xlt(),nD.enable(ae.defaultClient.config.enableAutoCollectExternalLoggers,ae.defaultClient.config.enableAutoCollectConsole),iD.enable(ae.defaultClient.config.enableAutoCollectExceptions),oD.enable(ae.defaultClient.config.enableAutoCollectPerformance),sD.enable(ae.defaultClient.config.enableAutoCollectPreAggregatedMetrics),aD.enable(ae.defaultClient.config.enableAutoCollectHeartbeat),U_.useAutoCorrelation(ae.defaultClient.config.enableAutoDependencyCorrelation,ae.defaultClient.config.enableUseAsyncHooks),U_.enable(ae.defaultClient.config.enableAutoCollectRequests),cD.enable(ae.defaultClient.config.enableAutoCollectDependencies),DE.enable(ae.defaultClient.config.enableWebInstrumentation,ae.defaultClient.config.webInstrumentationConnectionString),ae.defaultClient.config.enableSendLiveMetrics&&(ae.liveMetricsClient||(ae.liveMetricsClient=new JPe(ae.defaultClient.config,ae.defaultClient.context,ae.defaultClient.getAuthorizationHandler),Z9=new Uee(ae.liveMetricsClient,1e3,!0),ae.liveMetricsClient.addCollector(Z9),ae.defaultClient.quickPulseClient=ae.liveMetricsClient),ae.liveMetricsClient.enable(ae.defaultClient.config.enableSendLiveMetrics)),uD.enable(ae.defaultClient.config.enableAutoCollectIncomingRequestAzureFunctions);var t=Bee.AutoCollectNativePerformance.parseEnabled(ae.defaultClient.config.enableAutoCollectExtendedMetrics,ae.defaultClient.config);NE.enable(ae.defaultClient.config.enableAutoCollectExtendedMetrics,t.disabledMetrics),ae.defaultClient&&ae.defaultClient.channel&&ae.defaultClient.channel.setUseDiskRetryCaching(ae.defaultClient.config.enableUseDiskRetryCaching,ae.defaultClient.config.enableResendInterval,ae.defaultClient.config.enableMaxBytesOnDisk)}else rD.warn("Start cannot be called before setup");return qee}ae.start=e2e;function Slt(){return Fee.CorrelationContextManager.getCurrentContext()}ae.getCorrelationContext=Slt;function Ilt(t,e){return Fee.CorrelationContextManager.startOperation(t,e)}ae.startOperation=Ilt;function Clt(t,e){return Fee.CorrelationContextManager.wrapCallback(t,e)}ae.wrapWithCorrelationContext=Clt;var qee=function(){function t(){}return t.setDistributedTracingMode=function(e){return XPe.w3cEnabled=e===ZPe.AI_AND_W3C,t},t.setAutoCollectConsole=function(e,r){return r===void 0&&(r=!1),ae.defaultClient&&(ae.defaultClient.config.enableAutoCollectExternalLoggers=e,ae.defaultClient.config.enableAutoCollectConsole=r,Yc&&nD.enable(e,r)),t},t.setAutoCollectExceptions=function(e){return ae.defaultClient&&(ae.defaultClient.config.enableAutoCollectExceptions=e,Yc&&iD.enable(e)),t},t.setAutoCollectPerformance=function(e,r){if(r===void 0&&(r=!0),ae.defaultClient){ae.defaultClient.config.enableAutoCollectPerformance=e;var n=Bee.AutoCollectNativePerformance.parseEnabled(r,ae.defaultClient.config);ae.defaultClient.config.enableAutoCollectExtendedMetrics=n.isEnabled,Yc&&(oD.enable(e),NE.enable(ae.defaultClient.config.enableAutoCollectExtendedMetrics,n.disabledMetrics))}return t},t.setAutoCollectPreAggregatedMetrics=function(e){return ae.defaultClient&&(ae.defaultClient.config.enableAutoCollectPreAggregatedMetrics=e,Yc&&sD.enable(e)),t},t.setAutoCollectHeartbeat=function(e){return ae.defaultClient&&(ae.defaultClient.config.enableAutoCollectHeartbeat=e,Yc&&aD.enable(e)),t},t.enableAutoWebSnippetInjection=function(e,r){return ae.defaultClient&&(ae.defaultClient.config.enableWebInstrumentation=e,ae.defaultClient.config.webInstrumentationConnectionString=r,Yc&&DE.enable(ae.defaultClient.config.enableAutoWebSnippetInjection,ae.defaultClient.config.webSnippetConnectionString)),t},t.enableWebInstrumentation=function(e,r){return ae.defaultClient&&(ae.defaultClient.config.enableWebInstrumentation=e,ae.defaultClient.config.webInstrumentationConnectionString=r,Yc&&DE.enable(ae.defaultClient.config.enableWebInstrumentation,ae.defaultClient.config.webInstrumentationConnectionString)),t},t.setAutoCollectRequests=function(e){return ae.defaultClient&&(ae.defaultClient.config.enableAutoCollectRequests=e,Yc&&U_.enable(e)),t},t.setAutoCollectDependencies=function(e){return ae.defaultClient&&(ae.defaultClient.config.enableAutoCollectDependencies=e,Yc&&cD.enable(e)),t},t.setAutoDependencyCorrelation=function(e,r){return ae.defaultClient&&(ae.defaultClient.config.enableAutoDependencyCorrelation=e,ae.defaultClient.config.enableUseAsyncHooks=r,Yc&&U_.useAutoCorrelation(e,r)),t},t.setUseDiskRetryCaching=function(e,r,n){return ae.defaultClient&&(ae.defaultClient.config.enableUseDiskRetryCaching=e,ae.defaultClient.config.enableResendInterval=r,ae.defaultClient.config.enableMaxBytesOnDisk=n,ae.defaultClient.channel&&ae.defaultClient.channel.setUseDiskRetryCaching(ae.defaultClient.config.enableUseDiskRetryCaching,ae.defaultClient.config.enableResendInterval,ae.defaultClient.config.enableMaxBytesOnDisk)),t},t.setInternalLogging=function(e,r){return e===void 0&&(e=!1),r===void 0&&(r=!0),rD.enableDebug=e,rD.disableWarnings=!r,t},t.setAutoCollectIncomingRequestAzureFunctions=function(e){return ae.defaultClient&&(ae.defaultClient.config.enableAutoCollectIncomingRequestAzureFunctions=e,Yc&&uD.enable(e)),t},t.setSendLiveMetrics=function(e){return e===void 0&&(e=!1),ae.defaultClient?(!ae.liveMetricsClient&&e?(ae.liveMetricsClient=new JPe(ae.defaultClient.config,ae.defaultClient.context,ae.defaultClient.getAuthorizationHandler),Z9=new Uee(ae.liveMetricsClient,1e3,!0),ae.liveMetricsClient.addCollector(Z9),ae.defaultClient.quickPulseClient=ae.liveMetricsClient):ae.liveMetricsClient&&ae.liveMetricsClient.enable(e),ae.defaultClient.config.enableSendLiveMetrics=e,t):(rD.warn("Live metrics client cannot be setup without the default client"),t)},t.start=e2e,t}();ae.Configuration=qee;function Tlt(){XPe.w3cEnabled=!0,ae.defaultClient=null,Yc=!1,nD&&nD.dispose(),iD&&iD.dispose(),oD&&oD.dispose(),sD&&sD.dispose(),aD&&aD.dispose(),DE&&DE.dispose(),NE&&NE.dispose(),U_&&U_.dispose(),cD&&cD.dispose(),ae.liveMetricsClient&&(ae.liveMetricsClient.enable(!1),ae.liveMetricsClient=void 0),uD&&uD.dispose()}ae.dispose=Tlt});var Hee=O(x0=>{"use strict";Object.defineProperty(x0,"__esModule",{value:!0});x0.TargetPopulation=x0.Filters=x0.VSCodeFilterProvider=void 0;var t7=require("vscode"),jee=class t{constructor(e,r,n){this.extensionName=e,this.extensionVersion=r,this.targetPopulation=n}static trimVersionSuffix(e){let r=/\-[a-zA-Z0-9]+$/;return e.split(r)[0]}getFilterValue(e){switch(e){case Wp.ApplicationVersion:return t.trimVersionSuffix(t7.version);case Wp.Build:return t7.env.appName;case Wp.ClientId:return t7.env.machineId;case Wp.ExtensionName:return this.extensionName;case Wp.ExtensionVersion:return t.trimVersionSuffix(this.extensionVersion);case Wp.Language:return t7.env.language;case Wp.TargetPopulation:return this.targetPopulation;default:return""}}getFilters(){let e=new Map,r=Object.values(Wp);for(let n of r)e.set(n,this.getFilterValue(n));return e}};x0.VSCodeFilterProvider=jee;var Wp;(function(t){t.Market="X-MSEdge-Market",t.CorpNet="X-FD-Corpnet",t.ApplicationVersion="X-VSCode-AppVersion",t.Build="X-VSCode-Build",t.ClientId="X-MSEdge-ClientId",t.ExtensionName="X-VSCode-ExtensionName",t.ExtensionVersion="X-VSCode-ExtensionVersion",t.Language="X-VSCode-Language",t.TargetPopulation="X-VSCode-TargetPopulation"})(Wp||(x0.Filters=Wp={}));var s2e;(function(t){t.Team="team",t.Internal="internal",t.Insiders="insider",t.Public="public"})(s2e||(x0.TargetPopulation=s2e={}))});var a2e=O(r7=>{"use strict";Object.defineProperty(r7,"__esModule",{value:!0});r7.BaseFeatureProvider=void 0;var Vee=class{constructor(e){this.telemetry=e,this.isFetching=!1}async getFeatures(){if(this.isFetching&&this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetch();let e=await this.fetchPromise;return this.isFetching=!1,this.fetchPromise=void 0,e}};r7.BaseFeatureProvider=Vee});var c2e=O(n7=>{"use strict";Object.defineProperty(n7,"__esModule",{value:!0});n7.FilteredFeatureProvider=void 0;var Rlt=a2e(),Gee=class extends Rlt.BaseFeatureProvider{constructor(e,r){super(e),this.telemetry=e,this.filterProviders=r,this.cachedTelemetryEvents=[]}getFilters(){let e=new Map;for(let r of this.filterProviders){let n=r.getFilters();for(let o of n.keys()){let s=n.get(o);e.set(o,s)}}return e}PostEventToTelemetry(e){if(this.cachedTelemetryEvents.includes(e))return;let r=JSON.stringify(e);this.telemetry.postEvent("report-headers",new Map([["ABExp.headers",r]])),this.cachedTelemetryEvents.push(e)}};n7.FilteredFeatureProvider=Gee});var u2e=O(S0=>{"use strict";Object.defineProperty(S0,"__esModule",{value:!0});S0.TasApiFeatureProvider=S0.TASAPI_FETCHERROR_EVENTNAME=void 0;var klt=c2e();S0.TASAPI_FETCHERROR_EVENTNAME="call-tas-error";var zee="ErrorType",$ee=class extends klt.FilteredFeatureProvider{constructor(e,r,n){super(r,n),this.httpClient=e,this.telemetry=r,this.filterProviders=n}async fetch(){let e=this.getFilters(),r={};for(let c of e.keys()){let u=e.get(c);r[c]=u}let n;try{n=await this.httpClient.get({headers:r})}catch(c){let u=c,l=new Map;u.responseReceived&&!u.responseOk?l.set(zee,"ServerError"):u.responseReceived===!1?l.set(zee,"NoResponse"):l.set(zee,"GenericError"),this.telemetry.postEvent(S0.TASAPI_FETCHERROR_EVENTNAME,l)}if(!n)throw Error(S0.TASAPI_FETCHERROR_EVENTNAME);e.keys.length>0&&this.PostEventToTelemetry(r);let o=n.data,s=o.Configs,a=[];for(let c of s)if(c.Parameters)for(let u of Object.keys(c.Parameters)){let l=u+(c.Parameters[u]?"":"cf");a.includes(l)||a.push(l)}return{features:a,assignmentContext:o.AssignmentContext,configs:s}}};S0.TasApiFeatureProvider=$ee});var l2e=O(ME=>{"use strict";Object.defineProperty(ME,"__esModule",{value:!0});ME.HttpClient=ME.FetchError=void 0;var OE=class extends Error{constructor(e,r,n){super(e),this.responseReceived=r,this.responseOk=n}};ME.FetchError=OE;var Wee=class{constructor(e){this.endpoint=e}async get(e){let r=await fetch(this.endpoint,{method:"GET",headers:e?.headers});if(!r)throw new OE("No response received",!1);if(!r.ok)throw new OE("Response not ok",!0,!1);let n=await r.json();if(!n)throw new OE("No data received",!1);return{data:n}}};ME.HttpClient=Wee});var d2e=O(i7=>{"use strict";Object.defineProperty(i7,"__esModule",{value:!0});i7.MemoryKeyValueStorage=void 0;var Kee=class{constructor(){this.storage=new Map}async getValue(e,r){return this.storage.has(e)?await Promise.resolve(this.storage.get(e)):await Promise.resolve(r||void 0)}setValue(e,r){this.storage.set(e,r)}};i7.MemoryKeyValueStorage=Kee});var p2e=O(o7=>{"use strict";Object.defineProperty(o7,"__esModule",{value:!0});o7.ExperimentationServiceBase=void 0;var Plt=d2e(),Yee=class{get features(){return this._features}set features(e){this._features=e,this.telemetry&&this.telemetry.setSharedProperty(this.assignmentContextTelemetryPropertyName,this.features.assignmentContext)}constructor(e,r,n,o,s){this.telemetry=e,this.assignmentContextTelemetryPropertyName=r,this.telemetryEventName=n,this.storageKey=o,this.storage=s,this.featuresConsumed=!1,this.cachedTelemetryEvents=[],this._features={features:[],assignmentContext:"",configs:[]},this.storageKey||(this.storageKey="ABExp.Features"),this.storage||(s=new Plt.MemoryKeyValueStorage),this.loadCachePromise=this.loadCachedFeatureData(),this.initializePromise=this.loadCachePromise,this.initialFetch=new Promise((a,c)=>{this.resolveInitialFetchPromise=a})}async getFeaturesAsync(e=!1){if(this.fetchPromise!=null){try{await this.fetchPromise}catch{}return this.features}if(!this.featureProviders||this.featureProviders.length===0)return Promise.resolve({features:[],assignmentContext:"",configs:[]});try{this.fetchPromise=Promise.all(this.featureProviders.map(async n=>await n.getFeatures()));let r=await this.fetchPromise;this.updateFeatures(r,e)}catch{}return this.fetchPromise=void 0,this.resolveInitialFetchPromise&&(this.resolveInitialFetchPromise(),this.resolveInitialFetchPromise=void 0),this.features}updateFeatures(e,r=!1){let n={features:[],assignmentContext:"",configs:[]};for(let o of e){for(let s of o.features)n.features.includes(s)||n.features.push(s);for(let s of o.configs){let a=n.configs.find(c=>c.Id===s.Id);a?a.Parameters=Object.assign(Object.assign({},a.Parameters),s.Parameters):n.configs.push(s)}n.assignmentContext+=o.assignmentContext}(r||!this.featuresConsumed)&&(this.features=n),this.storage&&this.storage.setValue(this.storageKey,n)}async loadCachedFeatureData(){let e;this.storage&&(e=await this.storage.getValue(this.storageKey),e!==void 0&&e.configs===void 0&&(e.configs=[])),this.features.features.length===0&&(this.features=e||{features:[],assignmentContext:"",configs:[]})}isFlightEnabled(e){return this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isCachedFlightEnabled(e){return await this.loadCachePromise,this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isFlightEnabledAsync(e){let r=await this.getFeaturesAsync(!0);return this.featuresConsumed=!0,this.PostEventToTelemetry(e),r.features.includes(e)}getTreatmentVariable(e,r){this.featuresConsumed=!0,this.PostEventToTelemetry(`${e}.${r}`);let n=this.features.configs.find(o=>o.Id===e);return n?.Parameters[r]}async getTreatmentVariableAsync(e,r,n){if(n){let o=this.featuresConsumed,s=this.getTreatmentVariable(e,r);if(s===void 0)this.featuresConsumed=o;else return s}return await this.getFeaturesAsync(!0),this.getTreatmentVariable(e,r)}PostEventToTelemetry(e){this.cachedTelemetryEvents.includes(e)||(this.telemetry.postEvent(this.telemetryEventName,new Map([["ABExp.queriedFeature",e]])),this.cachedTelemetryEvents.push(e))}invokeInit(){this.init()}addFeatureProvider(...e){if(!(e==null||this.featureProviders==null))for(let r of e)this.featureProviders.push(r)}};o7.ExperimentationServiceBase=Yee});var f2e=O(s7=>{"use strict";Object.defineProperty(s7,"__esModule",{value:!0});s7.PollingService=void 0;var Qee=class{constructor(e){this.fetchInterval=e}StopPolling(){clearInterval(this.intervalHandle),this.intervalHandle=void 0}OnPollTick(e){this.onTick=e}StartPolling(e=!1){this.intervalHandle&&this.StopPolling(),this.onTick!=null&&(e&&this.onTick().then(()=>{}).catch(()=>{}),this.intervalHandle=setInterval(async()=>{await this.onTick()},this.fetchInterval),this.intervalHandle.unref&&this.intervalHandle.unref())}};s7.PollingService=Qee});var m2e=O(a7=>{"use strict";Object.defineProperty(a7,"__esModule",{value:!0});a7.ExperimentationServiceAutoPolling=void 0;var Alt=p2e(),Dlt=f2e(),Xee=class extends Alt.ExperimentationServiceBase{constructor(e,r,n,o,s,a,c){if(super(e,o,s,a,c),this.telemetry=e,this.filterProviders=r,this.refreshRateMs=n,this.assignmentContextTelemetryPropertyName=o,this.telemetryEventName=s,this.storageKey=a,this.storage=c,n<1e3&&n!==0)throw new Error("The minimum refresh rate for polling is 1000 ms (1 second). If you wish to deactivate this auto-polling use value of 0.");n>0&&(this.pollingService=new Dlt.PollingService(n),this.pollingService.OnPollTick(async()=>{await super.getFeaturesAsync()}))}init(){this.pollingService?this.pollingService.StartPolling(!0):super.getFeaturesAsync()}async getFeaturesAsync(e=!1){if(this.pollingService){this.pollingService.StopPolling();let r=await super.getFeaturesAsync(e);return this.pollingService.StartPolling(),r}else return await super.getFeaturesAsync(e)}};a7.ExperimentationServiceAutoPolling=Xee});var h2e=O(u7=>{"use strict";Object.defineProperty(u7,"__esModule",{value:!0});u7.ExperimentationService=void 0;var Nlt=u2e(),Llt=l2e(),Olt=m2e(),c7=class extends Olt.ExperimentationServiceAutoPolling{constructor(e){super(e.telemetry,e.filterProviders||[],e.refetchInterval!=null?e.refetchInterval:0,e.assignmentContextTelemetryPropertyName,e.telemetryEventName,e.storageKey,e.keyValueStorage),this.options=e,this.invokeInit()}init(){this.featureProviders=[],this.addFeatureProvider(new Nlt.TasApiFeatureProvider(new Llt.HttpClient(this.options.endpoint),this.telemetry,this.filterProviders)),super.init()}};u7.ExperimentationService=c7;c7.REFRESH_RATE_IN_MINUTES=30});var g2e=O(l7=>{"use strict";Object.defineProperty(l7,"__esModule",{value:!0});l7.ExperimentationService=void 0;var Mlt=h2e();Object.defineProperty(l7,"ExperimentationService",{enumerable:!0,get:function(){return Mlt.ExperimentationService}})});var v2e=O(d7=>{"use strict";Object.defineProperty(d7,"__esModule",{value:!0});d7.MementoKeyValueStorage=void 0;var Jee=class{constructor(e){this.mementoGlobalStorage=e}async getValue(e,r){return await this.mementoGlobalStorage.get(e)||r}setValue(e,r){this.mementoGlobalStorage.update(e,r)}};d7.MementoKeyValueStorage=Jee});var b2e=O(ete=>{"use strict";Object.defineProperty(ete,"__esModule",{value:!0});var Zee=class{constructor(){this.initializePromise=Promise.resolve(),this.initialFetch=Promise.resolve()}isFlightEnabled(e){return!1}isCachedFlightEnabled(e){return Promise.resolve(!1)}isFlightEnabledAsync(e){return Promise.resolve(!1)}getTreatmentVariable(e,r){}getTreatmentVariableAsync(e,r){return Promise.resolve(void 0)}};ete.default=Zee});var _2e=O(FE=>{"use strict";Object.defineProperty(FE,"__esModule",{value:!0});FE.getExperimentationServiceAsync=FE.getExperimentationService=void 0;var Flt=Hee(),Ult=g2e(),tte=require("vscode"),Blt=v2e(),qlt=b2e(),jlt="https://default.exp-tas.com/vscode/ab",Hlt="query-expfeature",Vlt="abexp.assignmentcontext",Glt="VSCode.ABExp.FeatureData",zlt=1e3*60*30;function y2e(t,e,r,n,o,...s){if(!o)throw new Error("Memento storage was not provided.");let a=tte.workspace.getConfiguration("telemetry");if(!(tte.env.isTelemetryEnabled===void 0?a.get("enableTelemetry",!0):tte.env.isTelemetryEnabled))return new qlt.default;let l=[new Flt.VSCodeFilterProvider(t,e,r),...s],d=new Blt.MementoKeyValueStorage(o);return new Ult.ExperimentationService({filterProviders:l,telemetry:n,storageKey:Glt,keyValueStorage:d,featuresTelemetryPropertyName:"",assignmentContextTelemetryPropertyName:Vlt,telemetryEventName:Hlt,endpoint:jlt,refetchInterval:zlt})}FE.getExperimentationService=y2e;async function $lt(t,e,r,n,o,...s){let a=y2e(t,e,r,n,o,...s);return await a.initializePromise,a}FE.getExperimentationServiceAsync=$lt});var S2e=O(I0=>{"use strict";Object.defineProperty(I0,"__esModule",{value:!0});I0.TargetPopulation=I0.getExperimentationServiceAsync=I0.getExperimentationService=void 0;var x2e=_2e();Object.defineProperty(I0,"getExperimentationService",{enumerable:!0,get:function(){return x2e.getExperimentationService}});Object.defineProperty(I0,"getExperimentationServiceAsync",{enumerable:!0,get:function(){return x2e.getExperimentationServiceAsync}});var Wlt=Hee();Object.defineProperty(I0,"TargetPopulation",{enumerable:!0,get:function(){return Wlt.TargetPopulation}})});var T2e=O(h7=>{"use strict";Object.defineProperty(h7,"__esModule",{value:!0});h7.BaseTelemetryReporter=void 0;var nte=class{constructor(e,r,n){this.telemetrySender=e,this.vscodeAPI=r,this.userOptIn=!1,this.errorOptIn=!1,this.disposables=[],this._onDidChangeTelemetryLevel=new this.vscodeAPI.EventEmitter,this.onDidChangeTelemetryLevel=this._onDidChangeTelemetryLevel.event,this.telemetryLogger=this.vscodeAPI.env.createTelemetryLogger(this.telemetrySender,n),this.updateUserOptIn(),this.telemetryLogger.onDidChangeEnableStates(()=>{this.updateUserOptIn()})}updateUserOptIn(){this.errorOptIn=this.telemetryLogger.isErrorsEnabled,this.userOptIn=this.telemetryLogger.isUsageEnabled,(this.telemetryLogger.isErrorsEnabled||this.telemetryLogger.isUsageEnabled)&&this.telemetrySender.instantiateSender(),this._onDidChangeTelemetryLevel.fire(this.telemetryLevel)}get telemetryLevel(){return this.errorOptIn&&this.userOptIn?"all":this.errorOptIn?"error":"off"}internalSendTelemetryEvent(e,r,n,o){o?this.telemetrySender.sendEventData(e,{properties:r,measurements:n}):this.telemetryLogger.logUsage(e,{properties:r,measurements:n})}sendTelemetryEvent(e,r,n){this.internalSendTelemetryEvent(e,r,n,!1)}sendRawTelemetryEvent(e,r,n){let o={...r};for(let s of Object.keys(o??{})){let a=o[s];typeof s=="string"&&a!==void 0&&(o[s]=new this.vscodeAPI.TelemetryTrustedValue(typeof a=="string"?a:a.value))}this.sendTelemetryEvent(e,o,n)}sendDangerousTelemetryEvent(e,r,n){this.telemetrySender.instantiateSender(),this.internalSendTelemetryEvent(e,r,n,!0)}internalSendTelemetryErrorEvent(e,r,n,o){o?this.telemetrySender.sendEventData(e,{properties:r,measurements:n}):this.telemetryLogger.logError(e,{properties:r,measurements:n})}sendTelemetryErrorEvent(e,r,n){this.internalSendTelemetryErrorEvent(e,r,n,!1)}sendDangerousTelemetryErrorEvent(e,r,n){this.telemetrySender.instantiateSender(),this.internalSendTelemetryErrorEvent(e,r,n,!0)}async dispose(){return await this.telemetrySender.dispose(),this.telemetryLogger.dispose(),Promise.all(this.disposables.map(e=>e.dispose()))}};h7.BaseTelemetryReporter=nte});var E2e=O(g7=>{"use strict";Object.defineProperty(g7,"__esModule",{value:!0});g7.BaseTelemetrySender=void 0;var $m;(function(t){t[t.NOT_INSTANTIATED=0]="NOT_INSTANTIATED",t[t.INSTANTIATING=1]="INSTANTIATING",t[t.INSTANTIATED=2]="INSTANTIATED"})($m||($m={}));var ite=class{constructor(e,r){this._instantiationStatus=$m.NOT_INSTANTIATED,this._eventQueue=[],this._exceptionQueue=[],this._clientFactory=r,this._key=e}sendEventData(e,r){if(!this._telemetryClient){this._instantiationStatus!==$m.INSTANTIATED&&this._eventQueue.push({eventName:e,data:r});return}this._telemetryClient.logEvent(e,r)}sendErrorData(e,r){if(!this._telemetryClient){this._instantiationStatus!==$m.INSTANTIATED&&this._exceptionQueue.push({exception:e,data:r});return}let n={stack:e.stack,message:e.message,name:e.name};if(r){let o=r.properties||r;r.properties={...o,...n}}else r={properties:n};this._telemetryClient.logEvent("unhandlederror",r)}async flush(){return this._telemetryClient?.flush()}async dispose(){this._telemetryClient&&(await this._telemetryClient.dispose(),this._telemetryClient=void 0)}_flushQueues(){this._eventQueue.forEach(({eventName:e,data:r})=>this.sendEventData(e,r)),this._eventQueue=[],this._exceptionQueue.forEach(({exception:e,data:r})=>this.sendErrorData(e,r)),this._exceptionQueue=[]}instantiateSender(){this._instantiationStatus===$m.NOT_INSTANTIATED&&(this._instantiationStatus=$m.INSTANTIATING,this._clientFactory(this._key).then(e=>{this._telemetryClient=e,this._instantiationStatus=$m.INSTANTIATED,this._flushQueues()}).catch(e=>{console.error(e),this._instantiationStatus=$m.INSTANTIATED}))}};g7.BaseTelemetrySender=ite});var ste=O(v7=>{"use strict";Object.defineProperty(v7,"__esModule",{value:!0});v7.TelemetryUtil=void 0;var ote=class t{static applyReplacements(e,r){for(let n of Object.keys(e))for(let o of r)o.lookup.test(n)&&(o.replacementString!==void 0?e[n]=o.replacementString:delete e[n])}static shouldUseOneDataSystemSDK(e){return e.length===74&&e[32]==="-"&&e[41]==="-"&&e[46]==="-"&&e[51]==="-"&&e[56]==="-"&&e[69]==="-"}static getAdditionalCommonProperties(e){return{"common.os":e.platform,"common.nodeArch":e.architecture,"common.platformversion":(e.release||"").replace(/^(\d+)(\.\d+)?(\.\d+)?(.*)/,"$1$2$3"),"common.telemetryclientversion":"0.9.4"}}static getInstance(){return t._instance||(t._instance=new t),t._instance}};v7.TelemetryUtil=ote});var UE,Wm,Kp,cd,BE,dD,ate=A(()=>{UE="function",Wm="object",Kp="undefined",cd="prototype",BE=Object,dD=BE[cd]});var Yi,Mi,qE,C0,Km,ol,pD,Ym,fD,mD,w2e,sl,hD,bn,jE,Fi,HE,cte,Qc,ute,lte,Qm,dc,fr=A(()=>{Yi=void 0,Mi=null,qE="",C0="function",Km="object",ol="prototype",pD="__proto__",Ym="undefined",fD="constructor",mD="Symbol",w2e="_polyfill",sl="length",hD="name",bn="call",jE="toString",Fi=Object,HE=Fi[ol],cte=String,Qc=cte[ol],ute=Math,lte=Array,Qm=lte[ol],dc=Qm.slice});function ea(t,e){try{return{v:t.apply(this,e)}}catch(r){return{e:r}}}var VE=A(()=>{});function R2e(t,e){var r=ea(t);return r.e?e:r.v}var k2e=A(()=>{VE()});function b7(t){return function(e){return typeof e===t}}function P2e(t){var e="[object "+t+"]";return function(r){return!!(r&&gD(r)===e)}}function gD(t){return HE.toString.call(t)}function y7(t,e){return typeof t===e}function Ut(t){return typeof t===Ym||t===Ym}function we(t){return t===Mi||Ut(t)}function pte(t){return t===Mi||!_7(t)}function _7(t){return!!t||t!==Yi}function fte(t){return!dte&&(dte=["string","number","boolean",Ym,"symbol","bigint"]),t!==Km&&dte.indexOf(t)!==-1}function Bn(t){return!t&&we(t)?!1:!!t&&typeof t===Km}function E0(t){return!!(t&&t.then&&Et(t.then))}function x7(t){return!t||!al(t)}function al(t){return!(!t||R2e(function(){return!(t&&0+t)},!t))}var dte,Vt,Et,mt,GE,ta,ud,T0,Xc=A(()=>{fr();k2e();Vt=b7("string"),Et=b7(C0);mt=lte.isArray,GE=P2e("Date"),ta=b7("number"),ud=b7("boolean"),T0=P2e("Error")});var B_,S7=A(()=>{fr();B_=Fi.getOwnPropertyDescriptor});function Qi(t,e){return!!t&&HE.hasOwnProperty[bn](t,e)}var I7=A(()=>{fr()});function A2e(t,e){return Qi(t,e)||!!B_(t,e)}var pc,C7=A(()=>{fr();S7();I7();pc=Fi.hasOwn||A2e});function ot(t,e,r){if(t&&Bn(t)){for(var n in t)if(pc(t,n)&&e[bn](r||t,n,t[n])===-1)break}}var w0=A(()=>{Xc();fr();C7()});function mte(t,e,r,n){var o={};return ot(t,function(s,a){o[s]=e?a:s,o[a]=r?a:s}),n(o)}var D2e=A(()=>{w0()});function bi(t){throw new Error(t)}function ri(t){throw new TypeError(t)}var R0=A(()=>{});function N2e(t){var e=[];return ot(t,function(r,n){e.push([r,n])}),e}function L2e(t){var e=[];return ot(t,function(r,n){e.push(n)}),e}var O2e=A(()=>{w0()});function M2e(t){return t}function Ylt(t){return t[pD]||Mi}function La(t){return hte&&ot(t,function(e,r){(mt(r)||Bn(r))&&hte(r)}),Yp(t)}var hte,q_,Ao,Yp,T7,zE,Qlt,N3r,$E=A(()=>{fr();Xc();w0();O2e();hte=Fi.freeze;q_=Fi.assign,Ao=Fi.keys;Yp=hte||M2e,T7=Fi.seal||M2e,zE=Fi.getPrototypeOf||Ylt,Qlt=Fi.entries||N2e,N3r=Fi.values||L2e});function gte(t){return mte(t,1,0,La)}function vte(t){return mte(t,0,0,La)}function F2e(t){var e={};return ot(t,function(r,n){e[r]=n[1],e[n[0]]=n[1]}),La(e)}function bte(t){return F2e(t)}var yte=A(()=>{D2e();w0();$E()});var E7,_te=A(()=>{yte();E7=vte({asyncIterator:0,hasInstance:1,isConcatSpreadable:2,iterator:3,match:4,matchAll:5,replace:6,search:7,species:8,split:9,toPrimitive:10,toStringTag:11,unscopables:12})});var Xn,j_=A(()=>{fr();Xn=cte});function Ste(){var t;return typeof globalThis!==Ym&&(t=globalThis),!t&&typeof self!==Ym&&(t=self),!t&&typeof window!==Ym&&(t=window),!t&&typeof global!==Ym&&(t=global),t}function w7(){if(!xte){var t=ea(Ste).v||{};xte=t[U2e]=t[U2e]||{}}return xte}var U2e,xte,R7=A(()=>{VE();fr();U2e="__tsUtils$gblCfg"});function tt(t,e){var r=qE,n=HE[jE][bn](t);n===Xlt&&(t={stack:Xn(t.stack),message:Xn(t.message),name:Xn(t.name)});try{r=JSON.stringify(t,Mi,e?typeof e=="number"?e:4:Yi),r=r&&r.replace(/"(\w+)"\s*:\s{0,1}/g,"$1: ")||Xn(t)}catch(o){r=" - "+tt(o,e)}return n+": "+r}var Xlt,k0=A(()=>{fr();j_();Xlt="[object Error]"});function ld(t,e,r){var n=e&&e[t];return function(o){var s=o&&o[t]||n;if(s||r){var a=arguments;return(s||r).apply(o,s?dc[bn](a,1):a)}ri('"'+Xn(t)+'" not defined for '+tt(o))}}function B2e(t){return function(e){return e[t]}}var cl,ul=A(()=>{k0();R0();j_();fr();cl=ld});var t5r,q2e,j2e=A(()=>{fr();t5r=ute.min,q2e=ute.max});var Ite,H2e=A(()=>{fr();ul();Ite=cl("slice",Qc)});function V2e(t,e,r){return we(t)&&ri("'polyStrSubstr called with invalid "+tt(t)),r<0?qE:(e=e||0,e<0&&(e=q2e(e+t[sl],0)),Ut(r)?Ite(t,e):Ite(t,e,e+r))}function P0(t,e){return Ui(t,0,e)}var Ui,dd,k7=A(()=>{Xc();k0();R0();fr();ul();j2e();H2e();Ui=cl("substring",Qc),dd=ld("substr",Qc,V2e)});function Jlt(){if(!Cte){var t=w7();Cte=t.gblSym=t.gblSym||{k:{},s:{}}}return Cte}function A7(t){var e={description:Xn(t),toString:function(){return mD+"("+t+")"}};return e[w2e]=!0,e}function z2e(t){var e=Jlt();if(!pc(e.k,t)){var r=A7(t),n=Ao(e.s).length;r[G2e]=function(){return n+"_"+r[jE]()},e.k[t]=r,e.s[r[G2e]()]=Xn(t)}return e.k[t]}function $2e(t){!P7&&(P7={});var e,r=E7[t];return r&&(e=P7[r]=P7[r]||A7(mD+"."+r)),e}var G2e,Cte,P7,W2e=A(()=>{_te();fr();C7();j_();R7();$E();G2e="_urid"});function K2e(t){var e={};if(e[D7.c]=!0,e[D7.e]=!0,t.l){e.get=function(){return t.l.v};var r=B_(t.l,"v");r&&r.set&&(e.set=function(n){t.l.v=n})}return ot(t,function(n,o){e[D7[n]]=Ut(o)?e[D7[n]]:o}),e}function N7(t,e,r,n,o,s){var a={e:s,c:o};return r&&(a.g=r),n&&(a.s=n),Bi(t,e,K2e(a))}function en(t,e,r){return Bi(t,e,K2e(r))}var D7,Bi,Zlt,H_=A(()=>{fr();Xc();w0();S7();D7={e:"enumerable",c:"configurable",v:"value",w:"writable",g:"get",s:"set"};Bi=Fi.defineProperty,Zlt=Fi.defineProperties});function pd(){qi=w7()}function fd(t){var e={};return!qi&&pd(),e.b=qi.lzy,Bi(e,"v",{configurable:!0,get:function(){var r=t();return qi.lzy||Bi(e,"v",{value:r}),e.b=qi.lzy,r}}),e}var qi,V_=A(()=>{R7();H_()});function WE(t,e){return fd(function(){var r=ea(t);return r.e?e:r.v})}var Tte=A(()=>{V_();VE()});function vD(t){return Bi({toJSON:function(){return t}},"v",{value:t})}var Ete=A(()=>{H_()});function yD(t,e){var r;return function(){return!qi&&pd(),(!r||qi.lzy)&&(r=vD(ea(t,e).v)),r.v}}function Xm(t){return fd(function(){return ea(hn,[t]).v||Yi})}function ra(t){return!qi&&pd(),(!bD||t===!1||qi.lzy)&&(bD=vD(ea(Ste).v||Mi)),bD.v}function hn(t,e){var r=!bD||e===!1?ra(e):bD.v;return r&&r[t]?r[t]:t===Y2e?_i():Mi}function A0(){return!!yi()}function D0(){return!!_i()}function KE(){return!!lo()}function L7(){return!!_D()}var Y2e,bD,yi,_i,lo,_D,wte,xD=A(()=>{fr();R7();V_();Ete();VE();Y2e="window";yi=yD(hn,["document"]);_i=yD(hn,[Y2e]);lo=yD(hn,["navigator"]);_D=yD(hn,["history"]),wte=yD(function(){return!!ea(function(){return process&&(process.versions||{}).node}).v})});function O7(){(!na||!na.b)&&(na=Xm(mD),Rte=WE(function(){return na.v?na.v.for:Yi},Yi),edt=WE(function(){return na.v?na.v.keyFor:Yi},Yi))}function kte(){return!!Q2e()}function Q2e(){return!qi&&pd(),(!na||qi.lzy)&&O7(),na.v}function G_(t,e){var r=E7[t];return!qi&&pd(),(!na||qi.lzy)&&O7(),na.v?na.v[r||t]:e?Yi:$2e(t)}function z_(t,e){return!qi&&pd(),(!na||qi.lzy)&&O7(),na.v?na.v(t):e?Mi:A7(t)}function SD(t){return!qi&&pd(),(!Rte||!na||qi.lzy)&&O7(),(Rte.v||z2e)(t)}var na,Rte,edt,M7=A(()=>{fr();W2e();_te();V_();Tte();xD()});function ID(t){return!!t&&Et(t.next)}function X2e(t){return!pte(t)&&Et(t[G_(3)])}var Pte=A(()=>{M7();Xc()});function J2e(t,e,r){if(t&&(ID(t)||(!F7&&(F7=vD(G_(3))),t=t[F7.v]?t[F7.v]():null),ID(t))){var n=void 0,o=void 0;try{for(var s=0;!(o=t.next()).done&&e[bn](r||t,o.value,s,t)!==-1;)s++}catch(a){n={e:a},t.throw&&(o=null,t.throw(n))}finally{try{o&&!o.done&&t.return&&t.return(o)}finally{if(n)throw n.e}}}}var F7,Z2e=A(()=>{Ete();fr();M7();Pte()});function Jm(t,e,r){return t.apply(e,r)}var U7=A(()=>{});function ll(t,e){return!Ut(e)&&t&&(mt(e)?Jm(t.push,t,e):ID(e)||X2e(e)?J2e(e,function(r){t.push(r)}):t.push(e)),t}var eAe=A(()=>{Xc();Pte();Z2e();U7()});function _e(t,e,r){if(t)for(var n=t[sl]>>>0,o=0;o<n&&!(o in t&&e[bn](r||t,t[o],o,t)===-1);o++);}var B7=A(()=>{fr()});var Hr,Ate=A(()=>{fr();ul();Hr=cl("indexOf",Qm)});var Qp,tAe=A(()=>{fr();ul();Qp=cl("map",Qm)});function N0(t,e,r){return(t&&t.slice||dc).apply(t,dc[bn](arguments,1))}var rAe=A(()=>{fr()});function nAe(t,e,r){return Hr(t,e,r)!==-1}var iAe=A(()=>{Ate()});var q7,oAe=A(()=>{fr();ul();iAe();q7=ld("includes",Qm,nAe)});var YE,sAe=A(()=>{fr();ul();YE=cl("reduce",Qm)});function tdt(t){if(!t)return{};var e=typeof t;e!==Km&&e!==C0&&ri("Prototype must be an Object or function: "+tt(t));function r(){}return r[ol]=t,new r}var dl,Dte=A(()=>{fr();k0();R0();dl=Fi.create||tdt});function Lte(t,e){var r=Fi.setPrototypeOf||function(n,o){!Nte&&(Nte=fd(function(){var s;return s={},s[pD]=[],s instanceof Array})),Nte.v?n[pD]=o:ot(o,function(s,a){return n[s]=a})};return r(t,e)}var Nte,aAe=A(()=>{V_();fr();w0()});function rdt(t,e,r){ea(en,[e,hD,{v:t,c:!0,e:!1}]),e=Lte(e,r);function n(){this.constructor=e,ea(en,[this,hD,{v:t,c:!0,e:!1}])}return e[ol]=r===Mi?dl(r):(n[ol]=r[ol],new n),e}function cAe(t,e){e&&(t[hD]=e)}function Ote(t,e,r){var n=r||Error,o=n[ol][hD],s=Error.captureStackTrace;return rdt(t,function(){var a=this,c=arguments;try{ea(cAe,[n,t]);var u=Jm(n,a,dc[bn](c))||a;if(u!==a){var l=zE(a);l!==zE(u)&&Lte(u,l)}return s&&s(u,a[fD]),e&&e(u,c),u}finally{ea(cAe,[n,o])}},n)}var uAe=A(()=>{U7();fr();Dte();H_();$E();aAe();VE()});function xi(){return(Date.now||lAe)()}function lAe(){return new Date().getTime()}var Mte=A(()=>{});function ndt(t){return function(r){return we(r)&&ri("strTrim called ["+tt(r)+"]"),r&&r.replace&&(r=r.replace(t,qE)),r}}var dAe,pAe=A(()=>{Xc();k0();R0();fr();dAe=ndt(/^\s+|(?=\s)\s+$/g)});var Yr,fAe=A(()=>{fr();ul();pAe();Yr=ld("trim",Qc,dAe)});function Do(t){if(!t||typeof t!==Km)return!1;Bte||(Bte=D0()?_i():!0);var e=!1;if(t!==Bte){Ute||(Fte=Function[ol][jE],Ute=Fte[bn](Fi));try{var r=zE(t);e=!r,e||(Qi(r,fD)&&(r=r[fD]),e=r&&typeof r===C0&&Fte[bn](r)===Ute)}catch{}}return e}var Fte,Ute,Bte,qte=A(()=>{xD();fr();I7();$E()});function idt(t){return t.value&&bAe(t),!0}function odt(t,e,r,n){var o;return _e(t,function(s){if(s.k===e)return o=s,-1}),o||(o={k:e,v:e},t.push(o),n(o)),o.v}function jte(t,e,r,n){var o=r.handler,s=r.path?n?r.path.concat(n):r.path:[],a={handler:r.handler,src:r.src,path:s},c=typeof e,u=!1,l=!1;e&&c===Km?u=Do(e):l=e===Mi||fte(c);var d={type:c,isPrim:l,isPlain:u,value:e,result:e,path:s,origin:r.src,copy:function(p,f){return jte(t,p,f?a:r,f)},copyTo:function(p,f){return hAe(t,p,f,a)}};return d.isPrim?o&&o[bn](r,d)?d.result:e:odt(t,e,s,function(p){en(d,"result",{g:function(){return p.v},s:function(h){p.v=h}});for(var f=0,m=o;!(m||(f<mAe.length?mAe[f++]:idt))[bn](r,d);)m=Mi})}function hAe(t,e,r,n){if(!we(r))for(var o in r)e[o]=jte(t,r[o],n,o);return e}function gAe(t,e,r){var n={handler:r,src:e,path:[]};return hAe([],t,e,n)}function vAe(t,e){var r={handler:e,src:t};return jte([],t,r)}function sdt(t){var e=t.value;if(mt(e)){var r=t.result=[];return r.length=e.length,t.copyTo(r,e),!0}return!1}function adt(t){var e=t.value;return GE(e)?(t.result=new Date(e.getTime()),!0):!1}function cdt(t){return t.type===C0}function bAe(t){var e=t.value;if(e&&t.isPlain){var r=t.result={};return t.copyTo(r,e),!0}return!1}var mAe,yAe=A(()=>{B7();Xc();fr();H_();qte();mAe=[sdt,bAe,cdt,adt]});function udt(t,e){return _e(e,function(r){gAe(t,r)}),t}function j7(t,e,r,n,o,s,a){return udt(vAe(t)||{},dc[bn](arguments))}var _Ae=A(()=>{B7();fr();yAe()});var QE,xAe=A(()=>{fr();ul();QE=B2e(sl)});function Zm(){return!qi&&pd(),(!H7||!H7.b&&qi.lzy)&&(H7=Xm("performance")),H7.v}function XE(){var t=Zm();return t&&t.now?t.now():xi()}var H7,SAe=A(()=>{Mte();xD();V_()});function ldt(t,e,r){Vt(t)||ri("'"+tt(t)+"' is not a string");var n=Vt(e)?e:Xn(e),o=!Ut(r)&&r<t[sl]?r:t[sl];return Ui(t,o-n[sl],o)===n}var L0,IAe=A(()=>{Xc();k0();R0();fr();ul();j_();k7();L0=ld("endsWith",Qc,ldt)});var Oa,CAe=A(()=>{fr();ul();Oa=cl("indexOf",Qc)});function ddt(t,e,r){Vt(t)||ri("'"+tt(t)+"' is not a string");var n=Vt(e)?e:Xn(e),o=r>0?r:0;return Ui(t,o,o+n[sl])===n}var $_,TAe=A(()=>{Xc();k0();R0();fr();ul();j_();k7();$_=ld("startsWith",Qc,ddt)});function EAe(t,e,r){var n=!0,o=t?e(Mi):Mi,s;function a(){return n=!1,o&&o[Vte]&&o[Vte](),s}function c(){o&&r(o),o=Mi}function u(){return o=e(o),n||a(),s}function l(d){!d&&o&&c(),d&&!o&&u()}return s={cancel:c,refresh:u},s[Gte]=function(){return o&&o[Gte]?o[Gte]():n},s[Hte]=function(){return n=!0,o&&o[Hte]&&o[Hte](),s},s[Vte]=a,s=Bi(s,pdt,{get:function(){return!!o},set:l}),{h:s,dn:function(){o=Mi}}}var Hte,Vte,Gte,pdt,wAe=A(()=>{fr();H_();Hte="ref",Vte="unref",Gte="hasRef",pdt="enabled"});function zte(t,e,r){var n=mt(e),o=n?e.length:0,s=(o>0?e[0]:n?Yi:e)||setTimeout,a=(o>1?e[1]:Yi)||clearTimeout,c=r[0];r[0]=function(){u.dn(),Jm(c,Yi,dc[bn](arguments))};var u=EAe(t,function(l){if(l){if(l.refresh)return l.refresh(),l;Jm(a,Yi,[l])}return Jm(s,Yi,r)},function(l){Jm(a,Yi,[l])});return u.h}function fc(t,e){return zte(!0,Yi,dc[bn](arguments))}function $te(t,e,r){return zte(!0,t,dc[bn](arguments,1))}function Wte(t,e){return zte(!1,Yi,dc[bn](arguments))}var RAe=A(()=>{U7();Xc();fr();wAe()});var At=A(()=>{eAe();B7();oAe();Ate();tAe();sAe();rAe();Xc();uAe();Mte();k0();yte();xD();_Ae();V_();xAe();SAe();Tte();R0();Dte();H_();w0();S7();C7();I7();qte();$E();IAe();CAe();TAe();k7();j_();fAe();M7();RAe()});function mc(t,e){typeof e!==UE&&e!==null&&ri("Class extends value "+String(e)+" is not a constructor or null"),Kte(t,e);function r(){this.constructor=t}t[cd]=e===null?dl(e):(r[cd]=e[cd],new r)}function V7(t,e){for(var r=0,n=e.length,o=t.length;r<n;r++,o++)t[o]=e[r];return t}var u8r,l8r,kAe,hdt,pl,Kte,PAe=A(()=>{At();ate();u8r=(ra()||{}).Symbol,l8r=(ra()||{}).Reflect,kAe="hasOwnProperty",hdt=function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var o in e)dD[kAe].call(e,o)&&(t[o]=e[o])}return t},pl=q_||hdt,Kte=function(t,e){return Kte=BE.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)n[kAe](o)&&(r[o]=n[o])},Kte(t,e)}});var AAe=A(()=>{});var hc=A(()=>{ate();PAe();AAe();At()});function W7(t){return t&&(t===rre[eh]||t===Array[eh])}function nre(t){return W7(t)||t===Function[eh]}function W_(t){var e;if(t){if(TD)return TD(t);var r=t[tre]||t[eh]||(t[K7]?t[K7][eh]:null);e=t[z7]||r,Qi(t,z7)||(delete t[Yte],e=t[z7]=t[Yte]||t[z7],t[Yte]=r)}return e}function X7(t,e){var r=[];if(LAe)r=LAe(t);else for(var n in t)typeof n=="string"&&Qi(t,n)&&r.push(n);if(r&&r.length>0)for(var o=0;o<r.length;o++)e(r[o])}function ire(t,e,r){return e!==K7&&typeof t[e]===Y7&&(r||Qi(t,e))&&e!==tre&&e!==eh}function J7(t){ri("DynamicProto: "+t)}function vdt(t){var e=dl(null);return X7(t,function(r){!e[r]&&ire(t,r,!1)&&(e[r]=t[r])}),e}function ore(t,e){for(var r=t.length-1;r>=0;r--)if(t[r]===e)return!0;return!1}function bdt(t,e,r,n){function o(u,l,d){var p=l[d];if(p[Xte]&&n){var f=u[Q7]||{};f[CD]!==!1&&(p=(f[l[JE]]||{})[d]||p)}return function(){return p.apply(u,arguments)}}var s=dl(null);X7(r,function(u){s[u]=o(e,r,u)});for(var a=W_(t),c=[];a&&!nre(a)&&!ore(c,a);)X7(a,function(u){!s[u]&&ire(a,u,!TD)&&(s[u]=o(e,a,u))}),c.push(a),a=W_(a);return s}function ydt(t,e,r,n){var o=null;if(t&&Qi(r,JE)){var s=t[Q7]||dl(null);if(o=(s[r[JE]]||dl(null))[e],o||J7("Missing ["+e+"] "+Y7),!o[Jte]&&s[CD]!==!1){for(var a=!Qi(t,e),c=W_(t),u=[];a&&c&&!nre(c)&&!ore(u,c);){var l=c[e];if(l){a=l===n;break}u.push(c),c=W_(c)}try{a&&(t[e]=o),o[Jte]=1}catch{s[CD]=!1}}}return o}function _dt(t,e,r){var n=e[t];return n===r&&(n=W_(e)[t]),typeof n!==Y7&&J7("["+t+"] is not a "+Y7),n}function xdt(t,e,r,n,o){function s(u,l){var d=function(){var p=ydt(this,l,u,d)||_dt(l,u,d);return p.apply(this,arguments)};return d[Xte]=1,d}if(!W7(t)){var a=r[Q7]=r[Q7]||dl(null);if(!W7(a)){var c=a[e]=a[e]||dl(null);a[CD]!==!1&&(a[CD]=!!o),W7(c)||X7(r,function(u){ire(r,u,!1)&&r[u]!==n[u]&&(c[u]=r[u],delete r[u],(!Qi(t,u)||t[u]&&!t[u][Xte])&&(t[u]=s(t,u)))})}}}function Sdt(t,e){if(TD){for(var r=[],n=W_(e);n&&!nre(n)&&!ore(r,n);){if(n===t)return!0;r.push(n),n=W_(n)}return!1}return!0}function Qte(t,e){return Qi(t,eh)?t.name||e||DAe:((t||{})[K7]||{}).name||e||DAe}function mr(t,e,r,n){Qi(t,eh)||J7("theClass is an invalid class definition.");var o=t[eh];Sdt(o,e)||J7("["+Qte(t)+"] not in hierarchy of ["+Qte(e)+"]");var s=null;Qi(o,JE)?s=o[JE]:(s=gdt+Qte(t,"_")+"$"+ere.n,ere.n++,o[JE]=s);var a=mr[MAe],c=!!a[$7];c&&n&&n[$7]!==void 0&&(c=!!n[$7]);var u=vdt(e),l=bdt(o,e,u,c);r(e,l);var d=!!TD&&!!a[Zte];d&&n&&(d=!!n[Zte]),xdt(o,s,e,u,d!==!1)}var G7,K7,eh,Y7,Q7,Xte,JE,gdt,Jte,CD,MAe,DAe,tre,z7,NAe,Yte,$7,Zte,rre,TD,LAe,OAe,ere,ns=A(()=>{At();K7="constructor",eh="prototype",Y7="function",Q7="_dynInstFuncs",Xte="_isDynProxy",JE="_dynClass",gdt="_dynCls$",Jte="_dynInstChk",CD=Jte,MAe="_dfOpts",DAe="_unknown_",tre="__proto__",z7="_dyn"+tre,NAe="__dynProto$Gbl",Yte="_dynInstProto",$7="useBaseInst",Zte="setInstFuncs",rre=Object,TD=rre.getPrototypeOf,LAe=rre.getOwnPropertyNames,OAe=ra(),ere=OAe[NAe]||(OAe[NAe]={o:(G7={},G7[Zte]=!0,G7[$7]=!0,G7),n:1e3});mr[MAe]=ere.o});var sre,FAe=A(()=>{"use strict";sre=100});var po,are,Z7=A(()=>{At();po=gte,are=bte});var md,Idt,UAe=A(()=>{Z7();md=po({Unknown:0,NonRetryableStatus:1,InvalidEvent:2,SizeLimitExceeded:3,KillSwitch:4,QueueFull:5}),Idt=po({Unknown:0,NonRetryableStatus:1,CleanStorage:2,MaxInStorageTimeExceeded:3})});var gc,O0,yt,K_,Y_,ZE,th,hd,fl,Cn,M0,vr,Xp,eU,Q_,rh,Jp,vc,F0,cre,ia,U0,No,tU,ew,tw,rw,B0,ure,bc,ED,X_,rU,Zp,Jc,nw,ef,gd,yc,q0,J_,Zc,j0,nU,wD,ml,iU,vd,lre,_c,RD,Z_,dre,pre,fre,kD,H0,ex,bd,oU,iw,mre,sU,tx,hre,ow,sw,V0,kn=A(()=>{gc="toLowerCase",O0="blkVal",yt="length",K_="rdOnly",Y_="notify",ZE="warnToConsole",th="throwInternal",hd="setDf",fl="watch",Cn="logger",M0="apply",vr="push",Xp="splice",eU="hdlr",Q_="cancel",rh="initialize",Jp="identifier",vc="isInitialized",F0="getPlugin",cre="pollInternalLogs",ia="name",U0="time",No="processNext",tU="getProcessTelContext",ew="getNotifyMgr",tw="addNotificationListener",rw="removeNotificationListener",B0="enabled",ure="stopPollingInternalLogs",bc="unload",ED="onComplete",X_="version",rU="loggingLevelConsole",Zp="createNew",Jc="teardown",nw="messageId",ef="message",gd="isAsync",yc="diagLog",q0="_doTeardown",J_="update",Zc="getNext",j0="setNextPlugin",nU="protocol",wD="userAgent",ml="split",iU="nodeType",vd="replace",lre="logInternalMessage",_c="type",RD="handler",Z_="status",dre="itemsReceived",pre="getResponseHeader",fre="getAllResponseHeaders",kD="isChildEvt",H0="data",ex="getCtx",bd="setCtx",oU="complete",iw="urlString",mre="sendPOST",sU="headers",tx="timeout",hre="setRequestHeader",ow="traceId",sw="spanId",V0="traceFlags"});function BAe(t,e){gre||(gre=Ote("AggregationError",function(n,o){o[yt]>1&&(n.errors=o[1])}));var r=t||"One or more errors occurred.";throw _e(e,function(n,o){r+=`
`.concat(o," > ").concat(tt(n))}),new gre(r,e||[])}var gre,qAe=A(()=>{At();kn()});function G0(t,e){return aU(t,function(r){return e?e({value:r,rejected:!1}):r},function(r){return e?e({rejected:!0,reason:r}):r})}function aU(t,e,r,n){var o=t;return E0(t)?(e||r)&&(o=t.then(e,r)):e&&(o=e(t)),n&&jAe(o,n),o}function jAe(t,e){var r=t;return e&&(E0(t)?t.finally?r=t.finally(e):r=t.then(function(n){return e(),n},function(n){throw e(),n}):e()),r}var vre=A(()=>{At()});function HAe(t,e,r,n){bre=bre||{toString:function(){return"[[PromiseState]]"}},yre=yre||{toString:function(){return"[[PromiseResult]]"}},_re=_re||{toString:function(){return"[[PromiseIsHandled]]"}},Bi(t,bre,{get:e}),Bi(t,yre,{get:r}),Bi(t,_re,{get:n})}var bre,yre,_re,xre,VAe=A(()=>{At();xre=!1});var cU,Sre=A(()=>{cU=["pending","resolving","resolved","rejected"]});function zAe(t,e,r,n){var o=yi();!uU&&(uU=WE(function(){var u;return o&&o.createEvent&&(u=o.createEvent("Event")),!!u&&u.initEvent},null));var s=uU.v?o.createEvent("Event"):n?new Event(e):{};if(r&&r(s),uU.v&&s.initEvent(e,!1,!0),s&&t[GAe])t[GAe](s);else{var a=t["on"+e];if(a)a(s);else{var c=hn("console");c&&(c.error||c.log)(e,tt(s))}}}var GAe,uU,$Ae=A(()=>{At();GAe="dispatchEvent"});var aw,Ire=A(()=>{aw="Promise"});function WAe(t){return Et(t)?t.toString():tt(t)}function YAe(t,e,r){var n=N0(arguments,3),o=0,s=!1,a,c=[],u=Tdt++,l=PD.length>0?PD[PD.length-1]:void 0,d=!1,p=null,f;!Cre&&(Cre=Xm(aw+"RejectionEvent"));var m=function(I,E){try{PD.push(u),d=!0,p&&p.cancel(),p=null;var R=t(function(B,V){c.push(function(){try{var M=o===2?I:E,le=Ut(M)?a:Et(M)?M(a):M;E0(le)?le.then(B,V):M?B(le):o===3?V(le):B(le)}catch(ne){V(ne)}}),s&&y()},n);return R}finally{PD.pop()}},h=function(I){return m(void 0,I)},g=function(I){var E=I,R=I;return Et(I)&&(E=function(B){return I&&I(),B},R=function(B){throw I&&I(),B}),m(E,R)},v=function(){return cU[o]},y=function(){if(c.length>0){var I=c.slice();c=[],d=!0,e(I),p&&p.cancel(),p=null}},_=function(I,E){return function(R){if(o===E){if(I===2&&E0(R)){o=1,R.then(_(2,1),_(3,1));return}o=I,s=!0,a=R,y(),!d&&I===3&&!p&&(p=fc(x,Edt))}}},x=function(){if(!d)if(wte())process.emit(KAe,a,f);else{var I=_i()||ra();zAe(I,Cdt,function(E){return en(E,"promise",{g:function(){return f}}),E.reason=a,E},!!Cre.v)}};f={then:m,catch:h,finally:g},Bi(f,"state",{get:v}),xre&&HAe(f,v,function(){return gD(a)},function(){return d}),kte()&&(f[G_(11)]="IPromise");var S=function(){return"IPromise"+(xre?"["+u+(Ut(l)?"":":"+l)+"]":"")+" "+v()+(s?" - "+WAe(a):"")};return f.toString=S,function(){Et(r)||ri(aw+": executor is not a function - "+WAe(r));var E=_(3,0);try{r.call(f,_(2,0),E)}catch(R){E(R)}}(),f}function cw(t){return function(e){var r=N0(arguments,1);return t(function(n,o){try{var s=[],a=1;_e(e,function(c,u){c&&(a++,aU(c,function(l){s[u]=l,--a===0&&n(s)},o))}),a--,a===0&&n(s)}catch(c){o(c)}},r)}}function uw(t){return function(e){var r=N0(arguments,1);return E0(e)?e:t(function(n){n(e)},r)}}function lw(t){return function(e){var r=N0(arguments,1);return t(function(n,o){o(e)},r)}}var KAe,Cdt,PD,Tdt,Edt,Cre,lU=A(()=>{At();vre();VAe();Sre();$Ae();Ire();KAe="unhandledRejection",Cdt=KAe.toLowerCase(),PD=[],Tdt=0,Edt=10});function QAe(t){var e=ta(t)?t:0;return function(r){fc(function(){wdt(r)},e)}}var wdt,XAe=A(()=>{At();wdt=function(t){_e(t,function(e){try{e()}catch{}})}});function dw(t,e){return YAe(dw,QAe(e),t,e)}var c9r,u9r,l9r,JAe=A(()=>{lU();XAe();c9r=cw(dw),u9r=uw(dw),l9r=lw(dw)});function AD(t,e){!Tre&&(Tre=Xm(aw));var r=Tre.v;if(!r)return dw(t);Et(t)||ri(aw+": executor is not a function - "+tt(t));var n=0;function o(){return cU[n]}var s=new r(function(a,c){function u(d){n=2,a(d)}function l(d){n=3,c(d)}t(u,l)});return Bi(s,"state",{get:o}),s}var Tre,v9r,b9r,y9r,ZAe=A(()=>{JAe();lU();Sre();At();Ire();v9r=cw(AD),b9r=uw(AD),y9r=lw(AD)});function Ma(t,e){return!Ere&&(Ere=fd(function(){return AD})),Ere.v.call(this,t,e)}var Ere,wre,Rdt,kdt,eDe=A(()=>{At();lU();ZAe();wre=cw(Ma),Rdt=uw(Ma),kdt=lw(Ma)});var pw=A(()=>{vre();eDe()});var eu,Bt,z0,Si,dU,DD,nh,rx,xc,nx,fw,$0,mw,tf,pU,fU,mU,hw,hU,gU,tDe,fo=A(()=>{eu=void 0,Bt="",z0="channels",Si="core",dU="createPerfMgr",DD="disabled",nh="extensionConfig",rx="extensions",xc="processTelemetry",nx="priority",fw="eventsSent",$0="eventsDiscarded",mw="eventsSendRequest",tf="perfEvent",pU="offlineEventsStored",fU="offlineBatchSent",mU="offlineBatchDrop",hw="getPerfMgr",hU="domain",gU="path",tDe="Not dynamic - "});function Pdt(t,e){return function(){var r=arguments,n=kre(e);if(n){var o=n.listener;o&&o[t]&&o[t][M0](o,r)}}}function Adt(){var t=hn("Microsoft");return t&&(bU=t.ApplicationInsights),bU}function kre(t){var e=bU;return!e&&t.disableDbgExt!==!0&&(e=bU||Adt()),e?e.ChromeDbgExt:null}function rDe(t){if(!vU){vU={};for(var e=0;e<Rre[yt];e++)vU[Rre[e]]=Pdt(Rre[e],t)}return vU}var Rre,bU,vU,Pre=A(()=>{At();kn();fo();Rre=[fw,$0,mw,tf],bU=null});function sDe(t,e){var r=!1;if(t){try{if(r=e in t,!r){var n=t[cd];n&&(r=e in n)}}catch{}if(!r)try{var o=new t;r=!Ut(o[e])}catch{}}return r}function Mre(t){oDe=t}function ix(t){if(t&&oDe){var e=hn("__mockLocation");if(e)return e}return typeof location===Wm&&location?location:hn(Ndt)}function ND(){return typeof console!==Kp?console:hn(Ldt)}function rf(){return!!(typeof JSON===Wm&&JSON||hn(nDe)!==null)}function ks(){return rf()?JSON||hn(nDe):null}function LD(){return hn(Odt)}function OD(){return hn(Mdt)}function W0(){var t=lo();return t&&t.product?t.product===Fdt:!1}function K0(){var t=lo();if(t&&(t[wD]!==Dre||Are===null)){Dre=t[wD];var e=(Dre||Bt)[gc]();Are=Xi(e,Lre)||Xi(e,Ore)}return Are}function MD(t){if(t===void 0&&(t=null),!t){var e=lo()||{};t=e?(e.userAgent||Bt)[gc]():Bt}var r=(t||Bt)[gc]();if(Xi(r,Lre)){var n=yi()||{};return Math.max(parseInt(r[ml](Lre)[1]),n[Ddt]||0)}else if(Xi(r,Ore)){var o=parseInt(r[ml](Ore)[1]);if(o)return o+4}return null}function Sc(t){return(Nre===null||t===!1)&&(Nre=KE()&&!!lo().sendBeacon),Nre}function ih(t){var e=!1;try{e=!!hn("fetch");var r=hn("Request");e&&t&&r&&(e=sDe(r,"keepalive"))}catch{}return e}function FD(){return gw===null&&(gw=typeof XDomainRequest!==Kp,gw&&vw()&&(gw=gw&&!sDe(hn(iDe),"withCredentials"))),gw}function vw(){var t=!1;try{var e=hn(iDe);t=!!e}catch{}return t}function aDe(t,e){if(t)for(var r=0;r<t[yt];r++){var n=t[r];if(n[ia]&&n[ia]===e)return n}return{}}function Fre(t){var e=yi();return e&&t?aDe(e.querySelectorAll("meta"),t).content:null}function Ure(t){var e,r=Zm();if(r){var n=r.getEntriesByType("navigation")||[];e=aDe((n[yt]>0?n[0]:{}).serverTiming,t).description}return e}var Ddt,Ndt,Ldt,nDe,Odt,Mdt,Fdt,Lre,Ore,iDe,Are,Dre,oDe,gw,Nre,Y0=A(()=>{"use strict";hc();At();kn();nf();fo();Ddt="documentMode",Ndt="location",Ldt="console",nDe="JSON",Odt="crypto",Mdt="msCrypto",Fdt="ReactNative",Lre="msie",Ore="trident/",iDe="XMLHttpRequest",Are=null,Dre=null,oDe=!1,gw=null,Nre=null});function cDe(t){return t?'"'+t[vd](/\"/g,Bt)+'"':Bt}function Bre(t,e){var r=ND();if(r){var n="log";r[t]&&(n=t),Et(r[n])&&r[n](e)}}function yd(t,e){return(t||{})[Cn]||new Q0(e)}function qre(t){return t||new Q0}function je(t,e,r,n,o,s){s===void 0&&(s=!1),qre(t)[th](e,r,n,o,s)}function Fa(t,e){qre(t)[ZE](e)}function jre(t,e,r){qre(t)[lre](e,r)}var bw,uDe,Udt,Bdt,qdt,jdt,Hdt,ox,Q0,_d=A(()=>{"use strict";ns();At();X0();kn();Pre();Y0();fo();uDe="warnToConsole",Udt="AI (Internal): ",Bdt="AI: ",qdt="AITR_",jdt={loggingLevelConsole:0,loggingLevelTelemetry:1,maxMessageLimit:25,enableDebug:!1},Hdt=(bw={},bw[0]=null,bw[1]="errorToConsole",bw[2]=uDe,bw[3]="debugToConsole",bw);ox=function(){function t(e,r,n,o){n===void 0&&(n=!1);var s=this;s[nw]=e,s[ef]=(n?Bdt:Udt)+e;var a=Bt;rf()&&(a=ks().stringify(o));var c=(r?" message:"+cDe(r):Bt)+(o?" props:"+cDe(a):Bt);s[ef]+=c}return t.dataType="MessageData",t}();Q0=function(){function t(e){this.identifier="DiagnosticLogger",this.queue=[];var r=0,n={},o,s,a,c,u;mr(t,this,function(l){u=p(e||{}),l.consoleLoggingLevel=function(){return o},l[th]=function(h,g,v,y,_){_===void 0&&(_=!1);var x=new ox(g,v,_,y);if(c)throw tt(x);var S=Hdt[h]||uDe;if(Ut(x[ef]))m("throw"+(h===1?"Critical":"Warning"),x);else{if(_){var I=+x[nw];!n[I]&&o>=h&&(l[S](x[ef]),n[I]=!0)}else o>=h&&l[S](x[ef]);d(h,x)}},l.debugToConsole=function(h){Bre("debug",h),m("warning",h)},l[ZE]=function(h){Bre("warn",h),m("warning",h)},l.errorToConsole=function(h){Bre("error",h),m("error",h)},l.resetInternalMessageCount=function(){r=0,n={}},l[lre]=d,l[bc]=function(h){u&&u.rm(),u=null};function d(h,g){if(!f()){var v=!0,y=qdt+g[nw];if(n[y]?v=!1:n[y]=!0,v&&(h<=s&&(l.queue[vr](g),r++,m(h===1?"error":"warn",g)),r===a)){var _="Internal events throttle limit per PageView reached for this app.",x=new ox(23,_,!1);l.queue[vr](x),h===1?l.errorToConsole(_):l[ZE](_)}}}function p(h){return mo(ni(h,jdt,l).cfg,function(g){var v=g.cfg;o=v[rU],s=v.loggingLevelTelemetry,a=v.maxMessageLimit,c=v.enableDebug})}function f(){return r>=a}function m(h,g){var v=kre(e||{});v&&v[yc]&&v[yc](h,g)}})}return t.__ieDyn=1,t}()});function of(t){return!we(t)}function sx(t){var e=t;return e&&Vt(e)&&(e=e[vd](Gdt,function(r,n){return n.toUpperCase()}),e=e[vd](zdt,"_"),e=e[vd]($dt,function(r,n){return"_"+n})),e}function Xi(t,e){return t&&e?Oa(t,e)!==-1:!1}function tu(t){return t&&t.toISOString()||""}function qn(t){return T0(t)?t[ia]:Bt}function hl(t,e,r,n,o){var s=r;return t&&(s=t[e],s!==r&&(!o||o(s))&&(!n||n(r))&&(s=r,t[e]=s)),s}function UD(t,e,r){var n;return t?(n=t[e],!n&&we(n)&&(n=Ut(r)?{}:r,t[e]=n)):n=Ut(r)?{}:r,n}function dDe(t,e){var r=null,n=null;return Et(t)?r=t:n=t,function(){var o=arguments;if(r&&(n=r()),n)return n[e][M0](n,o)}}function Hre(t,e,r){if(t&&e&&Bn(t)&&Bn(e)){var n=function(s){if(Vt(s)){var a=e[s];Et(a)?(!r||r(s,!0,e,t))&&(t[s]=dDe(e,s)):(!r||r(s,!1,e,t))&&(pc(t,s)&&delete t[s],en(t,s,{g:function(){return e[s]},s:function(c){e[s]=c}}))}};for(var o in e)n(o)}return t}function oh(t,e,r,n,o){t&&e&&r&&(o!==!1||Ut(t[e]))&&(t[e]=dDe(r,n))}function ru(t,e,r,n){return t&&e&&Bn(t)&&mt(r)&&_e(r,function(o){Vt(o)&&oh(t,o,e,o,n)}),t}function Vre(t){return function(){function e(){var r=this;t&&ot(t,function(n,o){r[n]=o})}return e}()}function gl(t){return t&&q_&&(t=BE(q_({},t))),t}function yU(t,e,r,n,o,s){var a=arguments,c=a[0]||{},u=a[yt],l=!1,d=1;for(u>0&&ud(c)&&(l=c,c=a[d]||{},d++),Bn(c)||(c={});d<u;d++){var p=a[d],f=mt(p),m=Bn(p);for(var h in p){var g=f&&h in p||m&&pc(p,h);if(g){var v=p[h],y=void 0;if(l&&v&&((y=mt(v))||Do(v))){var _=c[h];y?mt(_)||(_=[]):Do(_)||(_={}),v=yU(l,_,v)}v!==void 0&&(c[h]=v)}}}return c}function xd(t){try{return t.responseText}catch{}return null}function ax(t,e){return t?"XDomainRequest,Response:"+xd(t)||"":e}function sh(t,e){return t?"XMLHttpRequest,Status:"+t[Z_]+",Response:"+xd(t)||t.response||"":e}function ah(t,e){return e&&(ta(e)?t=[e].concat(t):mt(e)&&(t=e.concat(t))),t}function cx(t,e){try{if(t&&t!==""){var r=ks().parse(t);if(r&&r[dre]&&r[dre]>=r.itemsAccepted&&r.itemsReceived-r.itemsAccepted===r.errors[yt])return r}}catch(n){je(e,1,43,"Cannot parse the response. "+qn(n),{response:t})}return null}function Gre(t,e,r,n,o,s){n===void 0&&(n=!1),o===void 0&&(o=!1);function a(u,l,d){try{u[l]=d}catch{}}var c=new XMLHttpRequest;return n&&a(c,Wdt,n),r&&a(c,lDe,r),c.open(t,e,!o),r&&a(c,lDe,r),!o&&s&&a(c,Kdt,s),c}function _U(t){var e={};if(Vt(t)){var r=Yr(t)[ml](/[\r\n]+/);_e(r,function(n){if(n){var o=n.indexOf(": ");if(o!==-1){var s=Yr(n.substring(0,o))[gc](),a=Yr(n.substring(o+1));e[s]=a}else e[Yr(n)]=1}})}return e}function yw(t,e,r){if(!t[r]&&e&&e[pre]){var n=e[pre](r);n&&(t[r]=Yr(n))}return t}function ch(t,e){var r={};return t[fre]?r=_U(t[fre]()):e&&(r=yw(r,t,Xdt),r=yw(r,t,Ydt),r=yw(r,t,Qdt)),r}var Vdt,Gdt,zdt,$dt,e7r,Wdt,lDe,Kdt,Ydt,Qdt,Xdt,nf=A(()=>{hc();At();kn();_d();Y0();fo();Vdt="getPrototypeOf",Gdt=/-([a-z])/g,zdt=/([^\w\d_$])/g,$dt=/^(\d+[\w\d_$])/,e7r=Object[Vdt];Wdt="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",lDe="withCredentials",Kdt="timeout";Ydt="kill-duration",Qdt="kill-duration-seconds",Xdt="time-delta-millis"});function Jdt(t){t<0&&(t>>>=0),BD=fDe+t&J0,qD=mDe-t&J0,hDe=!0}function Zdt(){try{var t=xi()&2147483647;Jdt((Math.random()*pDe^t)+t)}catch{}}function jD(t){return t>0?Math.floor(uh()/J0*(t+1))>>>0:0}function uh(t){var e=0,r=LD()||OD();return r&&r.getRandomValues&&(e=r.getRandomValues(new Uint32Array(1))[0]&J0),e===0&&K0()&&(hDe||Zdt(),e=gDe()&J0),e===0&&(e=Math.floor(pDe*Math.random()|0)),t||(e>>>=0),e}function gDe(t){qD=36969*(qD&65535)+(qD>>16)&J0,BD=18e3*(BD&65535)+(BD>>16)&J0;var e=(qD<<16)+(BD&65535)>>>0&J0|0;return t||(e>>>=0),e}function HD(t){t===void 0&&(t=22);for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=uh()>>>0,n=0,o=Bt;o[yt]<t;)n++,o+=e.charAt(r&63),r>>>=6,n===5&&(r=(uh()<<2&4294967295|r&3)>>>0,n=0);return o}var pDe,J0,fDe,mDe,hDe,BD,qD,xU=A(()=>{At();kn();Y0();fo();pDe=4294967296,J0=4294967295,fDe=123456789,mDe=987654321,hDe=!1,BD=fDe,qD=mDe});function bDe(t){return t[iU]===1||t[iU]===9||!+t[iU]}function rpt(t,e){var r=e[t.id];if(!r){r={};try{bDe(e)&&en(e,t.id,{e:!1,v:r})}catch{}}return r}function Ps(t,e){return e===void 0&&(e=!1),sx(t+tpt+++(e?"."+vDe:Bt)+ept)}function SU(t){var e={id:Ps("_aiData-"+(t||Bt)+"."+vDe),accept:function(r){return bDe(r)},get:function(r,n,o,s){var a=r[e.id];return a?a[sx(n)]:(s&&(a=rpt(e,r),a[sx(n)]=o),o)},kill:function(r,n){if(r&&r[n])try{delete r[n]}catch{}}};return e}var vDe,ept,tpt,_w=A(()=>{At();kn();nf();fo();xU();vDe="3.0.5",ept="."+HD(6),tpt=0});function IU(t){return t&&Bn(t)&&(t.isVal||t.fb||pc(t,"v")||pc(t,"mrg")||pc(t,"ref")||t.set)}function yDe(t,e,r){var n,o=r.dfVal||_7;if(e&&r.fb){var s=r.fb;mt(s)||(s=[s]);for(var a=0;a<s[yt];a++){var c=s[a],u=e[c];if(o(u)?n=u:t&&(u=t.cfg[c],o(u)&&(n=u),t.set(t.cfg,Xn(c),u)),o(n))break}}return!o(n)&&o(r.v)&&(n=r.v),n}function zre(t,e,r){var n=r;if(r&&IU(r)&&(n=yDe(t,e,r)),n){IU(n)&&(n=zre(t,e,n));var o;mt(n)?(o=[],o[yt]=n[yt]):Do(n)&&(o={}),o&&(ot(n,function(s,a){a&&IU(a)&&(a=zre(t,e,a)),o[s]=a}),n=o)}return n}function VD(t,e,r,n){var o,s,a,c=n,u,l,d,p;IU(c)?(o=c.isVal,s=c.set,d=c[K_],p=c[O0],u=c.mrg,l=c.ref,!l&&Ut(l)&&(l=!!u),a=yDe(t,e,c)):a=n,p&&t[O0](e,r);var f,m=!0,h=e[r];(h||!we(h))&&(f=h,m=!1,o&&f!==a&&!o(f)&&(f=a,m=!0),s&&(f=s(f,a,e),m=f===a)),m?a?f=zre(t,e,a):f=a:(Do(f)||mt(a))&&u&&a&&(Do(a)||mt(a))&&ot(a,function(g,v){VD(t,f,g,v)}),t.set(e,r,f),l&&t.ref(e,r),d&&t[K_](e,r)}var $re=A(()=>{At();kn()});function Wre(t){if(t){var e;if(mt(t)?(e=[],e[yt]=t[yt]):Do(t)&&(e={}),e)return ot(t,function(r,n){e[r]=Wre(n)}),e}return t}function GD(t){if(t){var e=t[sf]||t;if(e.cfg&&(e.cfg===t||e.cfg[sf]===e))return e}return null}function zD(t){if(t&&(Do(t)||mt(t)))try{t[_De]=!0}catch{}return t}function Kre(t){if(t)try{t[xDe]=!0}catch{}return t}function CU(t,e,r){var n=!1;return r&&!t[e.blkVal]&&(n=r[xDe],!n&&!r[_De]&&(n=Do(r)||mt(r))),n}function TU(t){ri("InvalidAccess:"+t)}var sf,_De,xDe,EU=A(()=>{At();kn();sf=SD("[[ai_dynCfg_1]]"),_De=SD("[[ai_blkDynCfg_1]]"),xDe=SD("[[ai_frcDynCfg_1]]")});function ipt(t,e,r){mt(e)&&_e(npt,function(n){var o=e[n];e[n]=function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];var c=o[M0](this,s);return $D(t,e,r,"Patching"),c}})}function wU(t,e){var r=B_(t,e);return r&&r.get}function opt(t,e,r,n){var o={n:r,h:[],trk:function(l){l&&l.fn&&(Hr(o.h,l)===-1&&o.h[vr](l),t.trk(l,o))},clr:function(l){var d=Hr(o.h,l);d!==-1&&o.h[Xp](d,1)}},s=!0,a=!1;function c(){s&&(a=a||CU(c,t,n),n&&!n[sf]&&a&&(n=$D(t,n,r,"Converting")),s=!1);var l=t.act;return l&&o.trk(l),n}c[t.prop]={chng:function(){t.add(o)}};function u(l){if(n!==l){c[t.ro]&&!t.upd&&TU("["+r+"] is read-only:"+tt(e)),s&&(a=a||CU(c,t,n),s=!1);var d=a&&c[t.rf];if(a)if(d){ot(n,function(f){n[f]=l?l[f]:eu});try{ot(l,function(f,m){WD(t,n,f,m)}),l=n}catch(f){xw((t.hdlr||{})[Cn],r,"Assigning",f),a=!1}}else n&&n[sf]&&ot(n,function(f){var m=wU(n,f);if(m){var h=m[t.prop];h&&h.chng()}});if(l!==n){var p=l&&CU(c,t,l);!d&&p&&(l=$D(t,l,r,"Converting")),n=l,a=p}t.add(o)}}en(e,o.n,{g:c,s:u})}function WD(t,e,r,n){if(e){var o=wU(e,r),s=o&&!!o[t.prop];s?e[r]=n:opt(t,e,r,n)}return e}function RU(t,e,r,n){if(e){var o=wU(e,r),s=o&&!!o[t.prop],a=n&&n[0],c=n&&n[1],u=n&&n[2];if(!s){if(u)try{zD(e)}catch(l){xw((t.hdlr||{})[Cn],r,"Blocking",l)}try{WD(t,e,r,e[r]),o=wU(e,r)}catch(l){xw((t.hdlr||{})[Cn],r,"State",l)}}a&&(o[t.rf]=a),c&&(o[t.ro]=c),u&&(o[t.blkVal]=!0)}return e}function $D(t,e,r,n){try{ot(e,function(o,s){WD(t,e,o,s)}),e[sf]||(Bi(e,sf,{get:function(){return t[eU]}}),ipt(t,e,r))}catch(o){xw((t.hdlr||{})[Cn],r,n,o)}return e}var npt,xw,SDe=A(()=>{At();fo();kn();EU();npt=["push","pop","shift","unshift","splice"],xw=function(t,e,r,n){t&&t[th](3,108,"".concat(r," [").concat(e,"] failed - ")+tt(n))}});function IDe(t){var e,r=z_(KD+"get"+t.uid+YD),n=z_(KD+"ro"+t.uid+YD),o=z_(KD+"rf"+t.uid+YD),s=z_(KD+"blkVal"+t.uid+YD),a=z_(KD+"dtl"+t.uid+YD),c=null,u=null,l;function d(h,g){var v=l.act;try{l.act=h,h&&h[a]&&(_e(h[a],function(_){_.clr(h)}),h[a]=[]),g({cfg:t.cfg,set:t.set.bind(t),setDf:t[hd].bind(t),ref:t.ref.bind(t),rdOnly:t[K_].bind(t)})}catch(_){var y=t[Cn];throw y&&y[th](1,107,tt(_)),_}finally{l.act=v||null}}function p(){if(c){var h=c;c=null,u&&u[Q_](),u=null;var g=[];if(_e(h,function(v){if(v&&(v[a]&&(_e(v[a],function(y){y.clr(v)}),v[a]=null),v.fn))try{d(v,v.fn)}catch(y){g[vr](y)}}),c)try{p()}catch(v){g[vr](v)}g[yt]>0&&BAe("Watcher error(s): ",g)}}function f(h){if(h&&h.h[yt]>0){c||(c=[]),u||(u=fc(function(){u=null,p()},0));for(var g=0;g<h.h[yt];g++){var v=h.h[g];v&&Hr(c,v)===-1&&c[vr](v)}}}function m(h,g){if(h){var v=h[a]=h[a]||[];Hr(v,g)===-1&&v[vr](g)}}return l=(e={prop:r,ro:n,rf:o},e[O0]=s,e[eU]=t,e.add=f,e[Y_]=p,e.use=d,e.trk=m,e),l}var KD,YD,CDe=A(()=>{At();qAe();kn();KD="[[ai_",YD="]]"});function spt(t,e){var r={fn:e,rm:function(){r.fn=null,t=null,e=null}};return t.use(r,e),r}function apt(t,e,r){var n,o=GD(e);if(o)return o;var s=Ps("dyncfg",!0),a=e&&r!==!1?e:Wre(e),c;function u(){c[Y_]()}function l(y,_,x){try{y=WD(c,y,_,x)}catch(S){xw(t,_,"Setting value",S)}return y[_]}function d(y){return spt(c,y)}function p(y,_){c.use(null,function(x){var S=c.upd;try{Ut(_)||(c.upd=_),y(x)}finally{c.upd=S}})}function f(y,_){var x;return RU(c,y,_,(x={},x[0]=!0,x))[_]}function m(y,_){var x;return RU(c,y,_,(x={},x[1]=!0,x))[_]}function h(y,_){var x;return RU(c,y,_,(x={},x[2]=!0,x))[_]}function g(y,_){return _&&ot(_,function(x,S){VD(v,y,x,S)}),y}var v=(n={uid:null,cfg:a},n[Cn]=t,n[Y_]=u,n.set=l,n[hd]=g,n[fl]=d,n.ref=f,n[K_]=m,n[O0]=h,n._block=p,n);return en(v,"uid",{c:!1,e:!1,w:!1,v:s}),c=IDe(v),$D(c,a,"config","Creating"),v}function cpt(t,e){t?(t[ZE](e),t[th](2,108,e)):TU(e)}function ni(t,e,r,n){var o=apt(r,t||{},n);return e&&o[hd](o.cfg,e),o}function mo(t,e,r){var n=t[sf]||t;return n.cfg&&(n.cfg===t||n.cfg[sf]===n)?n[fl](e):(cpt(r,tDe+tt(t)),ni(t,null,r)[fl](e))}var X0=A(()=>{At();_w();fo();kn();$re();SDe();CDe();EU()});function lh(t,e){if(t&&t[bc])return t[bc](e)}function kU(t,e,r){var n;return r||(n=Ma(function(o){r=o})),t&&QE(t)>0?G0(lh(t[0],e),function(){kU(N0(t,1),e,r)}):r(),n}var Yre=A(()=>{pw();At();kn()});var TDe,Qre,Xre=A(()=>{TDe=500,Qre="Microsoft_ApplicationInsights_BypassAjaxInstrumentation"});function upt(t,e,r){return!t&&we(t)?e:ud(t)?t:Xn(t)[gc]()==="true"}function Jre(t){return{mrg:!0,v:t}}function Sw(t,e,r){return{fb:r,isVal:t,v:e}}function vl(t,e){return{fb:e,set:upt,v:!!t}}var Zre=A(()=>{At();kn()});function one(){!af&&(af=fd(function(){return yi()}))}function dpt(t,e){var r=dh[Z0]||DU[Z0];return r||(r=dh[Z0]=dh(t,e),DU[Z0]=r),r}function AU(t){return t?t.isEnabled():!0}function ODe(t,e){return e&&t&&mt(t.ignoreCookies)?Hr(t.ignoreCookies,e)!==-1:!1}function ppt(t,e){return e&&t&&mt(t.blockedCookies)&&Hr(t.blockedCookies,e)!==-1?!0:ODe(t,e)}function ADe(t,e){var r=e[B0];if(we(r)){var n=void 0;Ut(t[RDe])||(n=!t[RDe]),Ut(t[nne])||(n=!t[nne]),r=n}return r}function sne(t,e){var r;if(t)r=t.getCookieMgr();else if(e){var n=e.cookieCfg;n&&n[Z0]?r=n[Z0]:r=dh(e)}return r||(r=dpt(e,(t||{})[Cn])),r}function dh(t,e){var r,n,o,s,a,c,u,l,d;t=ni(t||DU,null,e).cfg,a=mo(t,function(f){f[hd](f.cfg,lpt),n=f.ref(f.cfg,"cookieCfg"),o=n[gU]||"/",s=n[hU],c=ADe(t,n)!==!1,u=n.getCookie||fpt,l=n.setCookie||LDe,d=n.delCookie||LDe},e);var p=(r={isEnabled:function(){var f=ADe(t,n)!==!1&&c&&Iw(e),m=DU[Z0];return f&&m&&p!==m&&(f=AU(m)),f},setEnabled:function(f){c=f!==!1,n[B0]=f},set:function(f,m,h,g,v){var y=!1;if(AU(p)&&!ppt(n,f)){var _={},x=Yr(m||Bt),S=Oa(x,";");if(S!==-1&&(x=Yr(P0(m,S)),_=MDe(Ui(m,S+1))),hl(_,hU,g||s,al,Ut),!we(h)){var I=K0();if(Ut(_[tne])){var E=xi(),R=E+h*1e3;if(R>0){var B=new Date;B.setTime(R),hl(_,tne,DDe(B,I?EDe:wDe)||DDe(B,I?EDe:wDe)||Bt,al)}}I||hl(_,"max-age",Bt+h,null,Ut)}var V=ix();V&&V[nU]==="https:"&&(hl(_,"secure",null,null,Ut),rne===null&&(rne=!NU((lo()||{})[wD])),rne&&hl(_,"SameSite","None",null,Ut)),hl(_,gU,v||o,null,Ut),l(f,NDe(x,_)),y=!0}return y},get:function(f){var m=Bt;return AU(p)&&!ODe(n,f)&&(m=u(f)),m},del:function(f,m){var h=!1;return AU(p)&&(h=p.purge(f,m)),h},purge:function(f,m){var h,g=!1;if(Iw(e)){var v=(h={},h[gU]=m||"/",h[tne]="Thu, 01 Jan 1970 00:00:01 GMT",h);K0()||(v["max-age"]="0"),d(f,NDe(Bt,v)),g=!0}return g}},r[bc]=function(f){a&&a.rm(),a=null},r);return p[Z0]=p,p}function Iw(t){if(PU===null){PU=!1,!af&&one();try{var e=af.v||{};PU=e[ine]!==void 0}catch(r){je(t,2,68,"Cannot access document.cookie - "+qn(r),{exception:tt(r)})}}return PU}function MDe(t){var e={};if(t&&t[yt]){var r=Yr(t)[ml](";");_e(r,function(n){if(n=Yr(n||Bt),n){var o=Oa(n,"=");o===-1?e[n]=null:e[Yr(P0(n,o))]=Yr(Ui(n,o+1))}})}return e}function DDe(t,e){return Et(t[e])?t[e]():null}function NDe(t,e){var r=t||Bt;return ot(e,function(n,o){r+="; "+n+(we(o)?Bt:"="+o)}),r}function fpt(t){var e=Bt;if(!af&&one(),af.v){var r=af.v[ine]||Bt;kDe!==r&&(PDe=MDe(r),kDe=r),e=Yr(PDe[t]||Bt)}return e}function LDe(t,e){!af&&one(),af.v&&(af.v[ine]=t+"="+e)}function NU(t){return Vt(t)?!!(Xi(t,"CPU iPhone OS 12")||Xi(t,"iPad; CPU OS 12")||Xi(t,"Macintosh; Intel Mac OS X 10_14")&&Xi(t,"Version/")&&Xi(t,"Safari")||Xi(t,"Macintosh; Intel Mac OS X 10_14")&&L0(t,"AppleWebKit/605.1.15 (KHTML, like Gecko)")||Xi(t,"Chrome/5")||Xi(t,"Chrome/6")||Xi(t,"UnrealEngine")&&!Xi(t,"Chrome")||Xi(t,"UCBrowser/12")||Xi(t,"UCBrowser/11")):!1}var ene,ux,EDe,wDe,ine,tne,RDe,nne,Z0,PU,rne,kDe,af,PDe,DU,lpt,ane=A(()=>{At();Zre();X0();kn();_d();Y0();nf();fo();EDe="toGMTString",wDe="toUTCString",ine="cookie",tne="expires",RDe="isCookieUseDisabled",nne="disableCookiesUsage",Z0="_ckMgr",PU=null,rne=null,kDe=null,PDe={},DU={},lpt=(ene={cookieCfg:Jre((ux={},ux[hU]={fb:"cookieDomain",dfVal:of},ux.path={fb:"cookiePath",dfVal:of},ux.enabled=eu,ux.ignoreCookies=eu,ux.blockedCookies=eu,ux)),cookieDomain:eu,cookiePath:eu},ene[nne]=eu,ene)});function eb(t,e,r,n){_e(t,function(o){if(o&&o[e])if(r)fc(function(){return n(o)},0);else try{n(o)}catch{}})}var mpt,QD,cne=A(()=>{ns();pw();At();X0();kn();fo();mpt={perfEvtsSendAll:!1};QD=function(){function t(e){this.listeners=[];var r,n,o=[],s=ni(e,mpt);n=s[fl](function(a){r=!!a.cfg.perfEvtsSendAll}),mr(t,this,function(a){en(a,"listeners",{g:function(){return o}}),a[tw]=function(c){o[vr](c)},a[rw]=function(c){for(var u=Hr(o,c);u>-1;)o[Xp](u,1),u=Hr(o,c)},a[fw]=function(c){eb(o,fw,!0,function(u){u[fw](c)})},a[$0]=function(c,u){eb(o,$0,!0,function(l){l[$0](c,u)})},a[mw]=function(c,u){eb(o,mw,u,function(l){l[mw](c,u)})},a[tf]=function(c){c&&(r||!c[kD]())&&eb(o,tf,!1,function(u){c[gd]?fc(function(){return u[tf](c)},0):u[tf](c)})},a[pU]=function(c){c&&c[yt]&&eb(o,pU,!0,function(u){u[pU](c)})},a[fU]=function(c){c&&c[H0]&&eb(o,fU,!0,function(u){u[fU](c)})},a[mU]=function(c,u){if(c>0){var l=u||0;eb(o,mU,!0,function(d){d[mU](c,l)})}},a[bc]=function(c){var u=function(){n&&n.rm(),n=null,o=[]},l;if(eb(o,"unload",!1,function(d){var p=d[bc](c);p&&(l||(l=[]),l[vr](p))}),l)return Ma(function(d){return G0(wre(l),function(){u(),d()})});u()}})}return t.__ieDyn=1,t}()});function ji(t,e,r,n,o){if(t){var s=t;if(s[hw]&&(s=s[hw]()),s){var a=void 0,c=s[ex](une);try{if(a=s.create(e(),n,o),a){if(c&&a[bd]&&(a[bd](lx[lne],c),c[ex]&&c[bd])){var u=c[ex](lx[XD]);u||(u=[],c[bd](lx[XD],u)),u[vr](a)}return s[bd](une,a),r(a)}}catch(l){a&&a[bd]&&a[bd]("exception",l)}finally{a&&s.fire(a),s[bd](une,c)}}}return r()}function dne(){return hpt}var Cw,lne,XD,hpt,lx,JD,une,LU=A(()=>{ns();At();kn();fo();Cw="ctx",lne="ParentContextKey",XD="ChildrenContextKey",hpt=null,lx=function(){function t(e,r,n){var o=this;if(o.start=xi(),o[ia]=e,o[gd]=n,o[kD]=function(){return!1},Et(r)){var s;en(o,"payload",{g:function(){return!s&&Et(r)&&(s=r(),r=null),s}})}o[ex]=function(a){return a?a===t[lne]||a===t[XD]?o[a]:(o[Cw]||{})[a]:null},o[bd]=function(a,c){if(a)if(a===t[lne])o[a]||(o[kD]=function(){return!0}),o[a]=c;else if(a===t[XD])o[a]=c;else{var u=o[Cw]=o[Cw]||{};u[a]=c}},o[oU]=function(){var a=0,c=o[ex](t[XD]);if(mt(c))for(var u=0;u<c[yt];u++){var l=c[u];l&&(a+=l[U0])}o[U0]=xi()-o.start,o.exTime=o[U0]-a,o[oU]=function(){}}}return t.ParentContextKey="parent",t.ChildrenContextKey="childEvts",t}(),JD=function(){function t(e){this.ctx={},mr(t,this,function(r){r.create=function(n,o,s){return new lx(n,o,s)},r.fire=function(n){n&&(n[oU](),e&&Et(e[tf])&&e[tf](n))},r[bd]=function(n,o){if(n){var s=r[Cw]=r[Cw]||{};s[n]=o}},r[ex]=function(n){return(r[Cw]||{})[n]}})}return t.__ieDyn=1,t}(),une="CoreUtils.doPerf"});function ZD(){var t=dx();return Ui(t,0,8)+"-"+Ui(t,8,12)+"-"+Ui(t,12,16)+"-"+Ui(t,16,20)+"-"+Ui(t,20)}function dx(){for(var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],e=Bt,r,n=0;n<4;n++)r=uh(),e+=t[r&15]+t[r>>4&15]+t[r>>8&15]+t[r>>12&15]+t[r>>16&15]+t[r>>20&15]+t[r>>24&15]+t[r>>28&15];var o=t[8+(uh()&3)|0];return dd(e,0,8)+dd(e,9,4)+"4"+dd(e,13,3)+o+dd(e,16,3)+dd(e,19,12)}var pne=A(()=>{"use strict";At();fo();xU()});function ph(t,e,r){return t&&t[yt]===e&&t!==r?!!t.match(/^[\da-f]*$/i):!1}function UDe(t,e,r){return ph(t,e)?t:r}function BDe(t){(isNaN(t)||t<0||t>255)&&(t=1);for(var e=t.toString(16);e[yt]<2;)e="0"+e;return e}function eN(t,e,r,n){var o;return o={},o[X_]=ph(n,2,mne)?n:fne,o[ow]=cf(t)?t:dx(),o[sw]=uf(e)?e:P0(dx(),16),o.traceFlags=r>=0&&r<=255?r:1,o}function px(t,e){var r;if(!t||(mt(t)&&(t=t[0]||""),!t||!Vt(t)||t[yt]>8192))return null;if(t.indexOf(",")!==-1){var n=t[ml](",");t=n[e>0&&n[yt]>e?e:0]}var o=gpt.exec(Yr(t));return!o||o[1]===mne||o[2]===OU||o[3]===MU?null:(r={version:(o[1]||Bt)[gc](),traceId:(o[2]||Bt)[gc](),spanId:(o[3]||Bt)[gc]()},r[V0]=parseInt(o[4],16),r)}function cf(t){return ph(t,32,OU)}function uf(t){return ph(t,16,MU)}function Tw(t){return!(!t||!ph(t[X_],2,mne)||!ph(t[ow],32,OU)||!ph(t[sw],16,MU)||!ph(BDe(t[V0]),2))}function tN(t){return Tw(t)?(t[V0]&FDe)===FDe:!1}function rN(t){if(t){var e=BDe(t[V0]);ph(e,2)||(e="01");var r=t[X_]||fne;return r!=="00"&&r!=="ff"&&(r=fne),"".concat(r.toLowerCase(),"-").concat(UDe(t.traceId,32,OU).toLowerCase(),"-").concat(UDe(t.spanId,16,MU).toLowerCase(),"-").concat(e.toLowerCase())}return""}function nN(t){var e="traceparent",r=px(Fre(e),t);return r||(r=px(Ure(e),t)),r}var gpt,fne,mne,OU,MU,FDe,hne=A(()=>{At();kn();pne();Y0();fo();gpt=/^([\da-f]{2})-([\da-f]{32})-([\da-f]{16})-([\da-f]{2})(-[^\s]{1,64})?$/i,fne="00",mne="ff",OU="00000000000000000000000000000000",MU="0000000000000000",FDe=1});function fh(t){return vpt.get(t,"state",{},!0)}function gne(t,e){for(var r=[],n=null,o=t[Zc](),s;o;){var a=o[F0]();if(a){n&&n[j0]&&a[xc]&&n[j0](a),s=fh(a);var c=!!s[vc];a[vc]&&(c=a[vc]()),c||r[vr](a),n=a,o=o[Zc]()}}_e(r,function(u){var l=t[Si]();u[rh](t.getCfg(),l,e,t[Zc]()),s=fh(u),!u[Si]&&!s[Si]&&(s[Si]=l),s[vc]=!0,delete s[Jc]})}function FU(t){return t.sort(function(e,r){var n=0;if(r){var o=r[xc];e[xc]?n=o?e[nx]-r[nx]:1:o&&(n=-1)}else n=e?1:-1;return n})}function qDe(t){var e={};return{getName:function(){return e[ia]},setName:function(r){t&&t.setName(r),e[ia]=r},getTraceId:function(){return e[ow]},setTraceId:function(r){t&&t.setTraceId(r),cf(r)&&(e[ow]=r)},getSpanId:function(){return e[sw]},setSpanId:function(r){t&&t.setSpanId(r),uf(r)&&(e[sw]=r)},getTraceFlags:function(){return e[V0]},setTraceFlags:function(r){t&&t.setTraceFlags(r),e[V0]=r}}}var vpt,vne=A(()=>{"use strict";At();kn();_w();fo();hne();vpt=SU("plugin")});function ypt(t,e,r){for(;t;){if(t[F0]()===r)return t;t=t[Zc]()}return tb([r],e.config||{},e)}function bne(t,e,r,n){var o=null,s=[];e||(e=ni({},null,r[Cn])),n!==null&&(o=n?ypt(t,r,n):t);var a={_next:u,ctx:{core:function(){return r},diagLog:function(){return yd(r,e.cfg)},getCfg:function(){return e.cfg},getExtCfg:d,getConfig:p,hasNext:function(){return!!o},getNext:function(){return o},setNext:function(m){o=m},iterate:f,onComplete:c}};function c(m,h){for(var g=[],v=2;v<arguments.length;v++)g[v-2]=arguments[v];m&&s[vr]({func:m,self:Ut(h)?a.ctx:h,args:g})}function u(){var m=o;if(o=m?m[Zc]():null,!m){var h=s;h&&h[yt]>0&&(_e(h,function(g){try{g.func.call(g.self,g.args)}catch(v){je(r[Cn],2,73,"Unexpected Exception during onComplete - "+tt(v))}}),s=[])}return m}function l(m,h){var g=null,v=e.cfg;if(v&&m){var y=v[nh];!y&&h&&(y={}),v[nh]=y,y=e.ref(v,nh),y&&(g=y[m],!g&&h&&(g={}),y[m]=g,g=e.ref(y,m))}return g}function d(m,h){var g=l(m,!0);return h&&ot(h,function(v,y){if(we(g[v])){var _=e.cfg[v];(_||!we(_))&&(g[v]=_)}VD(e,g,v,y)}),e[hd](g,h)}function p(m,h,g){g===void 0&&(g=!1);var v,y=l(m,!1),_=e.cfg;return y&&(y[h]||!we(y[h]))?v=y[h]:(_[h]||!we(_[h]))&&(v=_[h]),v||!we(v)?v:g}function f(m){for(var h;h=a._next();){var g=h[F0]();g&&m(g)}}return a}function Ua(t,e,r,n){var o=ni(e),s=bne(t,o,r,n),a=s.ctx;function c(l){var d=s._next();return d&&d[xc](l,a),!d}function u(l,d){return l===void 0&&(l=null),mt(l)&&(l=tb(l,o.cfg,r,d)),Ua(l||a[Zc](),o.cfg,r,d)}return a[No]=c,a[Zp]=u,a}function Ew(t,e,r){var n=ni(e.config),o=bne(t,n,e,r),s=o.ctx;function a(u){var l=o._next();return l&&l[bc](s,u),!l}function c(u,l){return u===void 0&&(u=null),mt(u)&&(u=tb(u,n.cfg,e,l)),Ew(u||s[Zc](),e,l)}return s[No]=a,s[Zp]=c,s}function iN(t,e,r){var n=ni(e.config),o=bne(t,n,e,r),s=o.ctx;function a(u){return s.iterate(function(l){Et(l[J_])&&l[J_](s,u)})}function c(u,l){return u===void 0&&(u=null),mt(u)&&(u=tb(u,n.cfg,e,l)),iN(u||s[Zc](),e,l)}return s[No]=a,s[Zp]=c,s}function tb(t,e,r,n){var o=null,s=!n;if(mt(t)&&t[yt]>0){var a=null;_e(t,function(c){if(!s&&n===c&&(s=!0),s&&c&&Et(c[xc])){var u=_pt(c,e,r);o||(o=u),a&&a._setNext(u),a=u}})}return n&&!o?tb([n],e,r):o}function _pt(t,e,r){var n=null,o=Et(t[xc]),s=Et(t[j0]),a;t?a=t[Jp]+"-"+t[nx]+"-"+VDe++:a="Unknown-0-"+VDe++;var c={getPlugin:function(){return t},getNext:function(){return n},processTelemetry:d,unload:p,update:f,_id:a,_setNext:function(m){n=m}};function u(){var m;return t&&Et(t[HDe])&&(m=t[HDe]()),m||(m=Ua(c,e,r)),m}function l(m,h,g,v,y){var _=!1,x=t?t[Jp]:bpt,S=m[jDe];return S||(S=m[jDe]={}),m.setNext(n),t&&ji(m[Si](),function(){return x+":"+g},function(){S[a]=!0;try{var I=n?n._id:Bt;I&&(S[I]=!1),_=h(m)}catch(R){var E=n?S[n._id]:!0;E&&(_=!0),(!n||!E)&&je(m[yc](),1,73,"Plugin ["+x+"] failed during "+g+" - "+tt(R)+", run flags: "+tt(S))}},v,y),_}function d(m,h){h=h||u();function g(v){if(!t||!o)return!1;var y=fh(t);return y[Jc]||y[DD]?!1:(s&&t[j0](n),t[xc](m,v),!0)}l(h,g,"processTelemetry",function(){return{item:m}},!m.sync)||h[No](m)}function p(m,h){function g(){var v=!1;if(t){var y=fh(t),_=t[Si]||y[Si];t&&(!_||_===m.core())&&!y[Jc]&&(y[Si]=null,y[Jc]=!0,y[vc]=!1,t[Jc]&&t[Jc](m,h)===!0&&(v=!0))}return v}l(m,g,"unload",function(){},h[gd])||m[No](h)}function f(m,h){function g(){var v=!1;if(t){var y=fh(t),_=t[Si]||y[Si];t&&(!_||_===m.core())&&!y[Jc]&&t[J_]&&t[J_](m,h)===!0&&(v=!0)}return v}l(m,g,"update",function(){},!1)||m[No](h)}return Yp(c)}var bpt,jDe,HDe,VDe,yne,UU=A(()=>{"use strict";At();$re();X0();kn();_d();nf();fo();LU();vne();bpt="TelemetryPluginChain",jDe="_hasRun",HDe="_getTelCtx",VDe=0;yne=function(){function t(e,r,n,o){var s=this,a=Ua(e,r,n,o);ru(s,a,Ao(a))}return t}()});function fx(){var t=[];function e(n){n&&t[vr](n)}function r(n,o){_e(t,function(s){try{s(n,o)}catch(a){je(n[yc](),2,73,"Unexpected error calling unload handler - "+tt(a))}}),t=[]}return{add:e,run:r}}var BU=A(()=>{At();kn();_d()});function qU(){var t=[];function e(n){var o=t;t=[],_e(o,function(s){try{(s.rm||s.remove).call(s)}catch(a){je(n,2,73,"Unloading:"+tt(a))}})}function r(n){n&&ll(t,n)}return{run:e,add:r}}var _ne=A(()=>{At();_d()});var xne,rb,xpt,mh,Sne=A(()=>{"use strict";ns();At();X0();kn();_d();nf();fo();UU();BU();_ne();rb="getPlugin",xpt=(xne={},xne[nh]={isVal:of,v:{}},xne),mh=function(){function t(){var e=this,r,n,o,s,a;l(),mr(t,e,function(d){d[rh]=function(p,f,m,h){u(p,f,h),r=!0},d[Jc]=function(p,f){var m,h=d[Si];if(!h||p&&h!==p[Si]())return;var g,v=!1,y=p||Ew(null,h,o&&o[rb]?o[rb]():o),_=f||(m={reason:0},m[gd]=!1,m);function x(){v||(v=!0,s.run(y,f),a.run(y[yc]()),g===!0&&y[No](_),l())}return!d[q0]||d[q0](y,_,x)!==!0?x():g=!0,g},d[J_]=function(p,f){var m=d[Si];if(!m||p&&m!==p[Si]())return;var h,g=!1,v=p||iN(null,m,o&&o[rb]?o[rb]():o),y=f||{reason:0};function _(){g||(g=!0,u(v.getCfg(),v.core(),v[Zc]()))}return!d._doUpdate||d._doUpdate(v,y,_)!==!0?_():h=!0,h},oh(d,"_addUnloadCb",function(){return s},"add"),oh(d,"_addHook",function(){return a},"add"),en(d,"_unloadHooks",{g:function(){return a}})}),e[yc]=function(d){return c(d)[yc]()},e[vc]=function(){return r},e.setInitialized=function(d){r=d},e[j0]=function(d){o=d},e[No]=function(d,p){p?p[No](d):o&&Et(o[xc])&&o[xc](d,null)},e._getTelCtx=c;function c(d){d===void 0&&(d=null);var p=d;if(!p){var f=n||Ua(null,{},e[Si]);o&&o[rb]?p=f[Zp](null,o[rb]):p=f[Zp](null,o)}return p}function u(d,p,f){ni(d,xpt,yd(p)),!f&&p&&(f=p[tU]()[Zc]());var m=o;o&&o[rb]&&(m=o[rb]()),e[Si]=p,n=Ua(f,d,p,m)}function l(){r=!1,e[Si]=null,n=null,o=null,a=qU(),s=fx()}}return t.__ieDyn=1,t}()});function Spt(t,e,r){var n={id:e,fn:r};ll(t,n);var o={remove:function(){_e(t,function(s,a){if(s.id===n.id)return t[Xp](a,1),-1})}};return o}function Ipt(t,e,r){for(var n=!1,o=t[yt],s=0;s<o;++s){var a=t[s];if(a)try{if(a.fn[M0](null,[e])===!1){n=!0;break}}catch(c){je(r,2,64,"Telemetry initializer failed: "+qn(c),{exception:tt(c)},!0)}}return!n}var GDe,zDe=A(()=>{hc();ns();At();kn();Sne();_d();nf();fo();GDe=function(t){mc(e,t);function e(){var r=t.call(this)||this;r.identifier="TelemetryInitializerPlugin",r.priority=199;var n,o;s(),mr(e,r,function(a,c){a.addTelemetryInitializer=function(u){return Spt(o,n++,u)},a[xc]=function(u,l){Ipt(o,u,l?l[yc]():a[yc]())&&a[No](u,l)},a[q0]=function(){s()}});function s(){n=0,o=[]}return r}return e.__ieDyn=1,e}(mh)});function Ept(t,e){return new JD(e)}function wpt(t,e,r){var n,o=[],s=[],a={};return _e(r,function(c){(we(c)||we(c[rh]))&&bi(YDe);var u=c[nx],l=c[Jp];c&&u&&(we(a[u])?a[u]=l:Fa(t,"Two extensions have same priority #"+u+" - "+a[u]+", "+l)),!u||u<e?o[vr](c):s[vr](c)}),n={},n[Si]=o,n[z0]=s,n}function WDe(t,e){var r=!1;return _e(e,function(n){if(n===t)return r=!0,-1}),r}function Cne(t,e,r,n){r&&ot(r,function(o,s){n&&Do(s)&&Do(e[o])&&Cne(t,e[o],s,n),n&&Do(s)&&Do(e[o])?Cne(t,e[o],s,n):t.set(e,o,s)})}function KDe(t,e){var r=null,n=-1;return _e(t,function(o,s){if(o.w===e)return r=o,n=s,-1}),{i:n,l:r}}function Rpt(t,e){var r=KDe(t,e).l;return r||(r={w:e,rm:function(){var n=KDe(t,e);n.i!==-1&&t[Xp](n.i,1)}},t[vr](r)),r}function kpt(t,e,r){_e(e,function(n){var o=mo(t,n.w,r);delete n.w,n.rm=function(){o.rm()}})}var nb,YDe,Cpt,$De,Tpt,Ine,hh,QDe=A(()=>{"use strict";hc();ns();pw();At();X0();kn();Yre();Xre();ane();_w();Pre();_d();nf();fo();cne();LU();UU();vne();zDe();BU();_ne();YDe="Plugins must provide initialize method",Cpt="_notificationManager",$De="SDK is still unloading...",Tpt="SDK is not initialized",Ine=La((nb={cookieCfg:{}},nb[rx]={rdOnly:!0,ref:!0,v:[]},nb[z0]={rdOnly:!0,ref:!0,v:[]},nb[nh]={ref:!0,v:{}},nb[dU]=eu,nb.loggingLevelConsole=0,nb.diagnosticLogInterval=eu,nb));hh=function(){function t(){var e,r,n,o,s,a,c,u,l,d,p,f,m,h,g,v,y,_,x,S,I,E,R,B,V,M,le,ne;mr(t,this,function(q){U(),q._getDbgPlgTargets=function(){return[R]},q[vc]=function(){return r},q[rh]=function(G,pe,me,Pe){m&&bi($De),q[vc]()&&bi("Core cannot be initialized more than once"),e=ni(G,Ine,me||q[Cn],!1),G=e.cfg,lt(e[fl](function(Dt){I=Dt.cfg.instrumentationKey;var ln=Dt.ref(Dt.cfg,nh);ot(ln,function(Pn){Dt.ref(ln,Pn)}),we(I)&&bi("Please provide instrumentation key")})),s=Pe,vt(),We(),q[Cn]=me;var Ie=G[rx];if(d=[],d[vr].apply(d,V7(V7([],pe,!1),Ie,!1)),p=G[z0],$(null),(!f||f[yt]===0)&&bi("No "+z0+" available"),p&&p[yt]>1){var bt=q[F0]("TeeChannelController");(!bt||!bt.plugin)&&je(n,1,28,"TeeChannel required")}kpt(G,E,n),E=null,r=!0,q.releaseQueue(),q[cre]()},q.getChannels=function(){var G=[];return f&&_e(f,function(pe){G[vr](pe)}),Yp(G)},q.track=function(G){ji(q[hw](),function(){return"AppInsightsCore:track"},function(){G===null&&(ye(G),bi("Invalid telemetry item")),!G[ia]&&we(G[ia])&&(ye(G),bi("telemetry name required")),G.iKey=G.iKey||I,G[U0]=G[U0]||tu(new Date),G.ver=G.ver||"4.0",!m&&q[vc]()?F()[No](G):o[vr](G)},function(){return{item:G}},!G.sync)},q[tU]=F,q[ew]=function(){return s||(s=new QD(e.cfg),q[Cpt]=s),s},q[tw]=function(G){q[ew]()[tw](G)},q[rw]=function(G){s&&s[rw](G)},q.getCookieMgr=function(){return u||(u=dh(e.cfg,q[Cn])),u},q.setCookieMgr=function(G){u!==G&&(lh(u,!1),u=G)},q[hw]=function(){return!a&&!c&&lt(e[fl](function(G){if(G.cfg.enablePerfMgr){var pe=G.cfg[dU];Et(pe)&&(c=pe(q,q[ew]()))}})),a||c||dne()},q.setPerfMgr=function(G){a=G},q.eventCnt=function(){return o[yt]},q.releaseQueue=function(){if(r&&o[yt]>0){var G=o;o=[],_e(G,function(pe){F()[No](pe)})}},q[cre]=function(G){return g=G||null,ne=!1,M&&M[Q_](),P(!0)};function P(G){if((!M||!M[B0])&&!ne){var pe=G||n&&n.queue[yt]>0;pe&&(le||(le=!0,lt(e[fl](function(me){var Pe=me.cfg.diagnosticLogInterval;(!Pe||!(Pe>0))&&(Pe=1e4);var Ie=!1;M&&(Ie=M[B0],M[Q_]()),M=Wte(xe,Pe),M.unref(),M[B0]=Ie}))),M[B0]=!0)}return M}q[ure]=function(){ne=!0,M&&M[Q_](),xe()},ru(q,function(){return h},["addTelemetryInitializer"]),q[bc]=function(G,pe,me){var Pe;G===void 0&&(G=!0),r||bi(Tpt),m&&bi($De);var Ie=(Pe={reason:50},Pe[gd]=G,Pe.flushComplete=!1,Pe),bt;G&&!pe&&(bt=Ma(function(Pn){pe=Pn}));var Dt=Ew(Y(),q);Dt[ED](function(){_.run(q[Cn]),kU([u,s,n],G,function(){U(),pe&&pe(Ie)})},q);function ln(Pn){Ie.flushComplete=Pn,m=!0,y.run(Dt,Ie),q[ure](),Dt[No](Ie)}return xe(),ee(G,ln,6,me)||ln(!1),bt},q[F0]=ce,q.addPlugin=function(G,pe,me,Pe){if(!G){Pe&&Pe(!1),br(YDe);return}var Ie=ce(G[Jp]);if(Ie&&!pe){Pe&&Pe(!1),br("Plugin ["+G[Jp]+"] is already loaded!");return}var bt={reason:16};function Dt(ai){d[vr](G),bt.added=[G],$(bt),Pe&&Pe(!0)}if(Ie){var ln=[Ie.plugin],Pn={reason:2,isAsync:!!me};j(ln,Pn,function(ai){ai?(bt.removed=ln,bt.reason|=32,Dt(!0)):Pe&&Pe(!1)})}else Dt(!1)},q.updateCfg=function(G,pe){pe===void 0&&(pe=!0);var me;if(q[vc]()){me={reason:1,cfg:e.cfg,oldCfg:j7({},e.cfg),newConfig:j7({},G),merge:pe},G=me.newConfig;var Pe=e.cfg;G[rx]=Pe[rx],G[z0]=Pe[z0]}e._block(function(Ie){var bt=Ie.cfg;Cne(Ie,bt,G,pe),pe||ot(bt,function(Dt){pc(G,Dt)||Ie.set(bt,Dt,eu)}),Ie[hd](bt,Ine)},!0),e[Y_](),me&&Lt(me)},q.evtNamespace=function(){return v},q.flush=ee,q.getTraceCtx=function(G){return S||(S=qDe()),S},q.setTraceCtx=function(G){S=G||null},q.addUnloadHook=lt,oh(q,"addUnloadCb",function(){return y},"add"),q.onCfgChange=function(G){var pe;return r?pe=mo(e.cfg,G,q[Cn]):pe=Rpt(E,G),{rm:function(){pe.rm()}}},q.getWParam=function(){return A0()||e.cfg.enableWParam?0:-1};function k(){var G={};B=[];var pe=function(me){me&&_e(me,function(Pe){if(Pe[Jp]&&Pe[X_]&&!G[Pe.identifier]){var Ie=Pe[Jp]+"="+Pe[X_];B[vr](Ie),G[Pe.identifier]=Pe}})};pe(f),p&&_e(p,function(me){pe(me)}),pe(d)}function U(){r=!1,e=ni({},Ine,q[Cn]),e.cfg[rU]=1,en(q,"config",{g:function(){return e.cfg},s:function(pe){q.updateCfg(pe,!1)}}),en(q,"pluginVersionStringArr",{g:function(){return B||k(),B}}),en(q,"pluginVersionString",{g:function(){return V||(B||k(),V=B.join(";")),V||Bt}}),en(q,"logger",{g:function(){return n||(n=new Q0(e.cfg),e[Cn]=n),n},s:function(pe){e[Cn]=pe,n!==pe&&(lh(n,!1),n=pe)}}),q[Cn]=new Q0(e.cfg),R=[];var G=q.config[rx]||[];G.splice(0,G[yt]),ll(G,R),h=new GDe,o=[],lh(s,!1),s=null,a=null,c=null,lh(u,!1),u=null,l=null,d=[],p=null,f=null,m=!1,g=null,v=Ps("AIBaseCore",!0),y=fx(),S=null,I=null,_=qU(),E=[],V=null,B=null,ne=!1}function F(){var G=Ua(Y(),e.cfg,q);return G[ED](P),G}function $(G){var pe=wpt(q[Cn],TDe,d);l=null,V=null,B=null,f=(p||[])[0]||[],f=FU(ll(f,pe[z0]));var me=ll(FU(pe[Si]),f);R=Yp(me);var Pe=q.config[rx]||[];Pe.splice(0,Pe[yt]),ll(Pe,R);var Ie=F();f&&f[yt]>0&&gne(Ie[Zp](f),me),gne(Ie,me),G&&Lt(G)}function ce(G){var pe=null,me=null,Pe=[];return _e(R,function(Ie){if(Ie[Jp]===G&&Ie!==h)return me=Ie,-1;Ie.getChannel&&Pe[vr](Ie)}),!me&&Pe[yt]>0&&_e(Pe,function(Ie){if(me=Ie.getChannel(G),!me)return-1}),me&&(pe={plugin:me,setEnabled:function(Ie){fh(me)[DD]=!Ie},isEnabled:function(){var Ie=fh(me);return!Ie[Jc]&&!Ie[DD]},remove:function(Ie,bt){var Dt;Ie===void 0&&(Ie=!0);var ln=[me],Pn=(Dt={reason:1},Dt[gd]=Ie,Dt);j(ln,Pn,function(ai){ai&&$({reason:32,removed:ln}),bt&&bt(ai)})}}),pe}function Y(){if(!l){var G=(R||[]).slice();Hr(G,h)===-1&&G[vr](h),l=tb(FU(G),e.cfg,q)}return l}function j(G,pe,me){if(G&&G[yt]>0){var Pe=tb(G,e.cfg,q),Ie=Ew(Pe,q);Ie[ED](function(){var bt=!1,Dt=[];_e(d,function(Pn,ai){WDe(Pn,G)?bt=!0:Dt[vr](Pn)}),d=Dt,V=null,B=null;var ln=[];p&&(_e(p,function(Pn,ai){var Ls=[];_e(Pn,function(Cd){WDe(Cd,G)?bt=!0:Ls[vr](Cd)}),ln[vr](Ls)}),p=ln),me&&me(bt),P()}),Ie[No](pe)}else me(!1)}function xe(){if(n&&n.queue){var G=n.queue.slice(0);n.queue[yt]=0,_e(G,function(pe){var me,Pe=(me={},me[ia]=g||"InternalMessageId: "+pe[nw],me.iKey=I,me[U0]=tu(new Date),me.baseType=ox.dataType,me.baseData={message:pe[ef]},me);q.track(Pe)})}}function ee(G,pe,me,Pe){var Ie=1,bt=!1,Dt=null;Pe=Pe||5e3;function ln(){Ie--,bt&&Ie===0&&(Dt&&Dt[Q_](),Dt=null,pe&&pe(bt),pe=null)}if(f&&f[yt]>0){var Pn=F()[Zp](f);Pn.iterate(function(ai){if(ai.flush){Ie++;var Ls=!1;ai.flush(G,function(){Ls=!0,ln()},me)||Ls||(G&&Dt==null?Dt=fc(function(){Dt=null,ln()},Pe):ln())}})}return bt=!0,ln(),!0}function vt(){!s&&q[ew](),lt(e[fl](function(G){var pe=G.cfg.disableDbgExt;pe===!0&&x&&(s[rw](x),x=null),s&&!x&&pe!==!0&&(x=rDe(G.cfg),s[tw](x))}))}function We(){lt(e[fl](function(G){var pe=G.cfg.enablePerfMgr;!pe&&c&&(c=null),pe&&UD(G.cfg,dU,Ept)}))}function Lt(G){var pe=iN(Y(),q);pe[ED](P),(!q._updateHook||q._updateHook(pe,G)!==!0)&&pe[No](G)}function br(G){var pe=q[Cn];pe?(je(pe,2,73,G),P()):bi(G)}function ye(G){var pe=q[ew]();pe&&pe[$0]([G],2)}function lt(G){_.add(G)}})}return t.__ieDyn=1,t}()});var lf,Ppt,XDe,Tne,mx,JDe=A(()=>{ns();pw();At();kn();Xre();_d();Y0();nf();lf="",Ppt="NoResponseBody",XDe="&"+Ppt+"=true",Tne="POST",mx=function(){function t(){var e=0,r,n,o,s,a,c,u,l,d,p,f,m,h;mr(t,this,function(g,v){var y=!0;ne(),g[rh]=function(q,P){o=P,n&&je(o,1,28,"Sender is already initialized"),g.SetConfig(q),n=!0},g._getDbgPlgTargets=function(){return[n,s,c,r]},g.SetConfig=function(q){try{if(a=q.senderOnCompleteCallBack||{},c=!!q.disableCredentials,s=!!q.isOneDs,r=!!q.enableSendPromise,l=!!q.disableXhr,d=!!q.disableBeacon,p=!!q.disableBeaconSync,h=q.timeWrapper,m=!!q.addNoResponse,f=!!q.disableFetchKeepAlive,u={sendPOST:V},s||(y=!1),c){var P=ix();P&&P.protocol&&P.protocol[gc]()==="file:"&&(y=!1)}return!0}catch{}return!1},g.getSyncFetchPayload=function(){return e},g.getSenderInst=function(q,P){return q&&q[yt]?I(q,P):null},g.getFallbackInst=function(){return u},g[q0]=function(q,P){ne()};function _(q,P){E(P,200,{},q)}function x(q,P){je(o,2,26,"Failed to send telemetry.",{message:q}),E(P,400,{})}function S(q){x("No endpoint url is provided for the batch",q)}function I(q,P){for(var k,U=0,F=null,$=0;F==null&&$<q[yt];)U=q[$],!l&&U===1?FD()?F=le:vw()&&(F=V):U===2&&ih(P)&&(!P||!f)?F=M:U===3&&Sc()&&(P?!p:!d)&&(F=B),$++;return F?(k={_transport:U,_isSync:P},k[mre]=F,k):null}function E(q,P,k,U){try{q&&q(P,k,U)}catch{}}function R(q,P){var k=lo(),U=q[iw];if(!U)return S(P),!0;U=q[iw]+(m?XDe:lf);var F=q[H0],$=s?F:new Blob([F],{type:"text/plain;charset=UTF-8"}),ce=k.sendBeacon(U,$);return ce}function B(q,P,k){var U=q[H0];try{if(U)if(R(q,P))_(lf,P);else{var F=a&&a.beaconOnRetry;F&&Et(F)?F(q,P,R):(u&&u[mre](q,P,!0),je(o,2,40,". Failed to send telemetry with Beacon API, retried with normal sender."))}}catch($){s&&Fa(o,"Failed to send telemetry using sendBeacon API. Ex:"+tt($)),E(P,s?0:400,{},lf)}}function V(q,P,k){var U,F,$,ce=q[sU]||{};!k&&r&&(U=Ma(function(ee,vt){F=ee,$=vt})),s&&k&&q.disableXhrSync&&(k=!1);var Y=q[iw];if(!Y){S(P),F&&F(!1);return}var j=Gre(Tne,Y,y,!0,k,q[tx]);j[hre]("Content-type","application/json"),_e(Ao(ce),function(ee){j[hre](ee,ce[ee])}),j.onreadystatechange=function(){s||(xe(j),j.readyState===4&&F&&F(!0))},j.onload=function(){s&&xe(j)};function xe(ee){var vt=a&&a.xhrOnComplete,We=vt&&Et(vt);if(We)vt(ee,P,q);else{var Lt=xd(ee);E(P,ee[Z_],ch(ee,s),Lt)}}return j.onerror=function(ee){E(P,s?j[Z_]:400,ch(j,s),s?lf:sh(j)),$&&$(ee)},j.ontimeout=function(){E(P,s?j[Z_]:500,ch(j,s),s?lf:sh(j)),F&&F(!1)},j.send(q[H0]),U}function M(q,P,k){var U,F=q[iw],$=q[H0],ce=s?$:new Blob([$],{type:"application/json"}),Y,j,xe,ee=new Headers,vt=$[yt],We=!1,Lt=!1,br=q[sU]||{},ye=(U={method:Tne,body:ce},U[Qre]=!0,U);q.headers&&Ao(q.headers)[yt]>0&&(_e(Ao(br),function(me){ee.append(me,br[me])}),ye[sU]=ee),y&&s&&(ye.credentials="include"),k&&(ye.keepalive=!0,e+=vt,s?q._sendReason===2&&(We=!0,m&&(F+=XDe)):We=!0);var lt=new Request(F,ye);try{lt[Qre]=!0}catch{}if(!k&&r&&(Y=Ma(function(me,Pe){j=me,xe=Pe})),!F){S(P),j&&j(!1);return}function G(me){E(P,s?0:400,{},s?lf:me)}function pe(me,Pe,Ie){var bt=me[Z_],Dt=a.fetchOnComplete;Dt&&Et(Dt)?Dt(me,P,Ie||lf,Pe):E(P,bt,{},Ie||lf)}try{G0(fetch(s?F:lt,s?ye:null),function(me){if(k&&(e-=vt,vt=0),!Lt)if(Lt=!0,me.rejected)G(me.reason&&me.reason[ef]),xe&&xe(me.reason);else{var Pe=me.value;try{!s&&!Pe.ok?(G(Pe.statusText),j&&j(!1)):s&&!Pe.body?(pe(Pe,null,lf),j&&j(!0)):G0(Pe.text(),function(Ie){pe(Pe,q,Ie.value),j&&j(!0)})}catch(Ie){G(tt(Ie)),xe&&xe(Ie)}}})}catch(me){Lt||(G(tt(me)),xe&&xe(me))}return We&&!Lt&&(Lt=!0,E(P,200,{}),j&&j(!0)),s&&!Lt&&q[tx]>0&&h&&h.set(function(){Lt||(Lt=!0,E(P,500,{}),j&&j(!0))},q[tx]),Y}function le(q,P,k){var U=_i(),F=new XDomainRequest,$=q[H0];F.onload=function(){var ee=xd(F),vt=a&&a.xdrOnComplete;vt&&Et(vt)?vt(F,P,q):E(P,200,{},ee)},F.onerror=function(){E(P,400,{},s?lf:ax(F))},F.ontimeout=function(){E(P,500,{})},F.onprogress=function(){};var ce=U&&U.location&&U.location[nU]||"",Y=q[iw];if(!Y){S(P);return}if(!s&&Y.lastIndexOf(ce,0)!==0){var j="Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol.";je(o,2,40,". "+j),x(j,P);return}var xe=s?Y:Y[vd](/^(https?:)/,"");F.open(Tne,xe),q[tx]&&(F[tx]=q[tx]),F.send($),s&&k?h&&h.set(function(){F.send($)},0):F.send($)}function ne(){e=0,n=!1,r=!1,o=null,s=null,a=null,c=null,u=null,l=!1,d=!1,p=!1,f=!1,m=!1,h=null}})}return t.__ieDyn=1,t}()});function nNe(t){return t&&t[vd]?t[vd](/^[\s\.]+|(?=[\s\.])[\.\s]+$/g,Bt):t}function VU(t,e){var r;if(e){var n=Bt;mt(e)?(n=Bt,_e(e,function(s){s=nNe(s),s&&(s[0]!=="."&&(s="."+s),n+=s)})):n=nNe(e),n&&(n[0]!=="."&&(n="."+n),t=(t||Bt)+n)}var o=Lpt.exec(t||Bt)||[];return r={},r[_c]=o[1],r.ns=(o[2]||Bt).replace(Apt,".").replace(Dpt,Bt)[ml](".").sort().join("."),r}function Ene(t,e,r){var n=[],o=sN.get(t,jU,{},!1),s=VU(e,r);return ot(o,function(a,c){_e(c,function(u){var l;(!s[_c]||s[_c]===u.evtName[_c])&&(!s.ns||s.ns===s.ns)&&n[vr]((l={},l[ia]=u.evtName[_c]+(u.evtName.ns?"."+u.evtName.ns:Bt),l.handler=u[RD],l))})}),n}function dNe(t,e,r){r===void 0&&(r=!0);var n=sN.get(t,jU,{},r),o=n[e];return o||(o=n[e]=[]),o}function pNe(t,e,r,n){t&&e&&e[_c]&&(t[rNe]?t[rNe](e[_c],r,n):t[tNe]&&t[tNe](oNe+e[_c],r))}function Opt(t,e,r,n){var o=!1;return t&&e&&e[_c]&&r&&(t[eNe]?(t[eNe](e[_c],r,n),o=!0):t[ZDe]&&(t[ZDe](oNe+e[_c],r),o=!0)),o}function iNe(t,e,r,n){for(var o=e[yt];o--;){var s=e[o];s&&(!r.ns||r.ns===s.evtName.ns)&&(!n||n(s))&&(pNe(t,s.evtName,s[RD],s.capture),e[Xp](o,1))}}function Mpt(t,e,r){if(e[_c])iNe(t,dNe(t,e[_c]),e,r);else{var n=sN.get(t,jU,{});ot(n,function(o,s){iNe(t,s,e,r)}),Ao(n)[yt]===0&&sN.kill(t,jU)}}function nu(t,e){var r;return e?(mt(e)?r=[t].concat(e):r=[t,e],r=VU("xx",r).ns[ml](".")):r=t,r}function df(t,e,r,n,o){var s;o===void 0&&(o=!1);var a=!1;if(t)try{var c=VU(e,n);if(a=Opt(t,c,r,o),a&&sN.accept(t)){var u=(s={guid:Npt++,evtName:c},s[RD]=r,s.capture=o,s);dNe(t,c.type)[vr](u)}}catch{}return a}function gh(t,e,r,n,o){if(o===void 0&&(o=!1),t)try{var s=VU(e,n),a=!1;Mpt(t,s,function(c){return s.ns&&!r||c[RD]===r?(a=!0,!0):!1}),a||pNe(t,s,r,o)}catch{}}function wne(t,e,r,n){return n===void 0&&(n=!1),df(t,e,r,null,n)}function Rne(t,e,r,n){n===void 0&&(n=!1),gh(t,e,r,null,n)}function GU(t,e,r){var n=!1,o=_i();o&&(n=df(o,t,e,r),n=df(o.body,t,e,r)||n);var s=yi();return s&&(n=df(s,t,e,r)||n),n}function zU(t,e,r){var n=_i();n&&(gh(n,t,e,r),gh(n.body,t,e,r));var o=yi();o&&gh(o,t,e,r)}function ww(t,e,r,n){var o=!1;return e&&t&&t[yt]>0&&_e(t,function(s){s&&(!r||Hr(r,s)===-1)&&(o=GU(s,e,n)||o)}),o}function $U(t,e,r,n){var o=!1;return e&&t&&mt(t)&&(o=ww(t,e,r,n),!o&&r&&r[yt]>0&&(o=ww(t,e,null,n))),o}function ib(t,e,r){t&&mt(t)&&_e(t,function(n){n&&zU(n,e,r)})}function aN(t,e,r){return $U([cNe,aNe,HU],t,e,r)}function cN(t,e){ib([cNe,aNe,HU],t,e)}function Rw(t,e,r){function n(a){var c=yi();t&&c&&c.visibilityState==="hidden"&&t(a)}var o=nu(uNe,r),s=ww([HU],t,e,o);return(!e||Hr(e,oN)===-1)&&(s=ww([oN],n,e,o)||s),!s&&e&&(s=Rw(t,null,r)),s}function uN(t,e){var r=nu(uNe,e);ib([HU],t,r),ib([oN],null,r)}function kw(t,e,r){function n(a){var c=yi();t&&c&&c.visibilityState==="visible"&&t(a)}var o=nu(lNe,r),s=ww([sNe],t,e,o);return s=ww([oN],n,e,o)||s,!s&&e&&(s=kw(t,null,r)),s}function lN(t,e){var r=nu(lNe,e);ib([sNe],t,r),ib([oN],null,r)}var oNe,ZDe,eNe,tNe,rNe,jU,oN,HU,sNe,aNe,cNe,uNe,lNe,Apt,Dpt,Npt,sN,Lpt,fNe=A(()=>{At();kn();_w();fo();oNe="on",ZDe="attachEvent",eNe="addEventListener",tNe="detachEvent",rNe="removeEventListener",jU="events",oN="visibilitychange",HU="pagehide",sNe="pageshow",aNe="unload",cNe="beforeunload",uNe=Ps("aiEvtPageHide"),lNe=Ps("aiEvtPageShow"),Apt=/\.[\.]+/g,Dpt=/[\.]+$/,Npt=1,sN=SU("events"),Lpt=/^([^.]*)(?:\.(.+)|)/});var kne,mNe=A(()=>{Z7();kne=po({DISABLED:0,CRITICAL:1,WARNING:2,DEBUG:3})});var un=A(()=>{FAe();UAe();QDe();Sne();xU();pne();Yre();nf();JDe();At();Z7();fNe();Y0();hc();cne();LU();_d();UU();mNe();ane();_w();BU();hne();X0();EU();Zre()});var pf,hNe,Pne,WU,KU=A(()=>{pf="",hNe="https://browser.events.data.microsoft.com/OneCollector/1.0/",Pne="version",WU="properties"});var Ane,Dne,Pw,ff,Nne,ii,hx,vh,YU,QU,XU,JU,dN,ZU=A(()=>{Ane="initialize",Dne="logger",Pw="indexOf",ff="timings",Nne="pollInternalLogs",ii="value",hx="kind",vh="length",YU="processTelemetryStart",QU="handleField",XU="rmSanitizer",JU="rmFieldSanitizer",dN="canHandle"});function is(t){return!(t===pf||we(t))}function eB(t){if(t){var e=Oa(t,"-");if(e>-1)return P0(t,e)}return pf}function _Ne(){return Lne===null&&(Lne=!Ut(Uint8Array)&&!jpt()&&!W0()),Lne}function tB(t){return!!(t&&ta(t)&&t>=1&&t<=4)}function rB(t,e,r){if(!e&&!is(e)||typeof t!="string")return null;var n=typeof e;if(n==="string"||n==="number"||n==="boolean"||mt(e))e={value:e};else if(n==="object"&&!vNe.call(e,"value"))e={value:r?JSON.stringify(e):e};else if(we(e[ii])||e[ii]===pf||!Vt(e[ii])&&!ta(e[ii])&&!ud(e[ii])&&!mt(e[ii]))return null;if(mt(e[ii])&&!Mne(e[ii]))return null;if(!we(e[hx])){if(mt(e[ii])||!pN(e[hx]))return null;e[ii]=e[ii].toString()}return e}function Dw(t,e,r){var n=-1;if(!Ut(t))if(e>0&&(e===32?n=8192:e<=13&&(n=e<<5)),qpt(r))n===-1&&(n=0),n|=r;else{var o=Bpt[mf(t)]||-1;n!==-1&&o!==-1?n|=o:o===6&&(n=o)}return n}function xNe(t,e,r){r===void 0&&(r=!0);var n;return t&&(n=t.get(e),r&&n&&decodeURIComponent&&(n=decodeURIComponent(n))),n||pf}function SNe(t){t===void 0&&(t="D");var e=ZD();return t==="B"?e="{"+e+"}":t==="P"?e="("+e+")":t==="N"&&(e=e.replace(/-/g,pf)),e}function gx(t,e,r,n,o){var s={},a=!1,c=0,u=arguments[vh],l=arguments;for(ud(l[0])&&(a=l[0],c++);c<u;c++){var t=l[c];ot(t,function(p,f){a&&f&&Bn(f)?mt(f)?(s[p]=s[p]||[],_e(f,function(m,h){m&&Bn(m)?s[p][h]=gx(!0,s[p][h],m):s[p][h]=m})):s[p]=gx(!0,s[p],f):s[p]=f})}return s}function pN(t){return t===0||t>0&&t<=13||t===32}function qpt(t){return t>=0&&t<=9}function jpt(){var t=lo();if(!Ut(t)&&t.userAgent){var e=t.userAgent.toLowerCase();if((e[Pw]("safari")>=0||e[Pw]("firefox")>=0)&&e[Pw]("chrome")<0)return!0}return!1}function Mne(t){return t[vh]>0}function fN(t,e){var r=t;r[ff]=r[ff]||{},r[ff][YU]=r[ff][YU]||{},r[ff][YU][e]=Ic()}function mf(t){var e=0;if(t!=null){var r=typeof t;r==="string"?e=1:r==="number"?e=2:r==="boolean"?e=3:r===Wm&&(e=4,mt(t)?(e=4096,t[vh]>0&&(e|=mf(t[0]))):vNe.call(t,"value")&&(e=8192|mf(t[ii])))}return e}function nB(){return!!hn("chrome")}function INe(t,e,r,n,o,s){n===void 0&&(n=!1),o===void 0&&(o=!1);function a(u,l,d){try{u[l]=d}catch{}}var c=new XMLHttpRequest;return n&&a(c,Fpt,n),r&&a(c,gNe,r),c.open(t,e,!o),r&&a(c,gNe,r),!o&&s&&a(c,Upt,s),c}function ob(t){return t>0}var bh,One,Aw,vNe,Fpt,gNe,Upt,Bpt,Lne,bNe,yNe,Ic,iB=A(()=>{un();hc();At();KU();ZU();One="4.1.1",Aw="1DS-Web-JS-"+One,vNe=dD.hasOwnProperty,Fpt="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",gNe="withCredentials",Upt="timeout",Bpt=(bh={},bh[0]=0,bh[2]=6,bh[1]=1,bh[3]=7,bh[4098]=6,bh[4097]=1,bh[4099]=7,bh),Lne=null,bNe=A0(),yNe=D0();Ic=XE});function Vpt(t){return t&&(!t.getProperty||!t.setProperty)&&bi("Invalid property storage override passed."),!0}var Hpt,CNe,TNe=A(()=>{hc();ns();un();At();KU();iB();ZU();Hpt=La({endpointUrl:hNe,propertyStorageOverride:{isVal:Vpt}});CNe=function(t){mc(e,t);function e(){var r=t.call(this)||this;return mr(e,r,function(n,o){n[Ane]=function(s,a,c,u){ji(n,function(){return"AppInsightsCore.initialize"},function(){try{o[Ane](ni(s,Hpt,c||n[Dne],!1).cfg,a,c,u)}catch(p){var l=n[Dne],d=tt(p);d[Pw]("channels")!==-1&&(d+=`
 - Channels must be provided through config.channels only!`),je(l,1,514,"SDK Initialization Failed - no telemetry will be sent: "+d)}},function(){return{config:s,extensions:a,logger:c,notificationManager:u}})},n.track=function(s){ji(n,function(){return"AppInsightsCore.track"},function(){var a=s;if(a){a[ff]=a[ff]||{},a[ff].trackStart=Ic(),tB(a.latency)||(a.latency=1);var c=a.ext=a.ext||{};c.sdk=c.sdk||{},c.sdk.ver=Aw;var u=a.baseData=a.baseData||{};u[WU]=u[WU]||{};var l=u[WU];l[Pne]=l[Pne]||n.pluginVersionString||pf}o.track(a)},function(){return{item:s}},!s.sync)},n[Nne]=function(s){return o[Nne](s||"InternalLog")}}),r}return e.__ieDyn=1,e}(hh)});var ENe,wNe,RNe,kNe,PNe,ANe=A(()=>{un();ENe=po({NotSet:0,Pii_DistinguishedName:1,Pii_GenericData:2,Pii_IPV4Address:3,Pii_IPv6Address:4,Pii_MailSubject:5,Pii_PhoneNumber:6,Pii_QueryString:7,Pii_SipAddress:8,Pii_SmtpAddress:9,Pii_Identity:10,Pii_Uri:11,Pii_Fqdn:12,Pii_IPV4AddressLegacy:13,Pii_IPv6ScrubLastHextets:14,Pii_DropValue:15,CustomerContent_GenericContent:32}),wNe=po({Normal:1,CostDeferred:2,RealTime:3,Immediate:4}),RNe=po({Unspecified:0,String:1,Int32:2,UInt32:3,Int64:4,UInt64:5,Double:6,Bool:7,Guid:8,DateTime:9}),kNe=po({Normal:1,Critical:2}),PNe=po({NONE:0,ERROR:1,WARNING:2,INFORMATION:3})});var DNe,NNe=A(()=>{un();At();KU();iB();ZU();DNe=function(){function t(e){var r=this,n={},o=[],s=[];e&&s.push(e);function a(d,p){var f,m=n[d];if(m&&(f=m[p]),!f&&f!==null){if(Vt(d)&&Vt(p))if(s[vh]>0){for(var h=0;h<s[vh];h++)if(s[h][QU](d,p)){f={canHandle:!0,fieldHandler:s[h]};break}}else o[vh]===0&&(f={canHandle:!0});if(!f&&f!==null){f=null;for(var h=0;h<o[vh];h++)if(o[h][QU](d,p)){f={canHandle:!0,handler:o[h],fieldHandler:null};break}}m||(m=n[d]={}),m[p]=f}return f}r.clearCache=function(){n={}},r.addSanitizer=function(d){d&&(q7(o,d)||o.push(d),n={})},r.addFieldSanitizer=function(d){d&&(q7(s,d)||s.push(d),n={})},r[XU]=function(d){if(d){var p=Hr(o,d);p!==-1&&(o.splice(p,1),n={}),_e(o,function(f){f&&f[XU]&&f[XU](d)})}},r[JU]=function(d){if(d){var p=Hr(s,d);p!==-1&&(s.splice(p,1),n={}),_e(o,function(f){f&&f[JU]&&f[JU](d)})}},r.isEmpty=function(){return QE(o)+QE(s)===0},r[QU]=function(d,p){var f=a(d,p);return f?f[dN]:!1},r[ii]=function(d,p,f,m){var h=a(d,p);if(h&&h[dN]){if(!h||!h[dN])return null;if(h.handler)return h.handler[ii](d,p,f,m);if(!Vt(p)||we(f)||f===pf)return null;var g=null,v=mf(f);if((v&8192)===8192){var y=v&-8193;if(g=f,!is(g[ii])||y!==1&&y!==2&&y!==3&&(y&4096)!==4096)return null}else v===1||v===2||v===3||(v&4096)===4096?g=u(d,p,f):v===4&&(g=u(d,p,m?JSON.stringify(f):f));if(g)return c(h,d,p,v,g,m)}return null},r.property=function(d,p,f,m){var h=a(d,p);if(!h||!h[dN]||!Vt(p)||we(f)||!is(f[ii]))return null;var g=mf(f[ii]);return g===0?null:c(h,d,p,g,f,m)};function c(d,p,f,m,h,g){if(d.handler)return d.handler.property(p,f,h,g);if(!we(h[hx])){if((m&4096)===4096||!pN(h[hx]))return null;h[ii]=h[ii].toString()}return l(d.fieldHandler,p,f,m,h)}function u(d,p,f){return is(f)?{value:f}:null}function l(d,p,f,m,h){if(h&&d){var g=d.getSanitizer(p,f,m,h[hx],h.propertyType);if(g)if(m===4){var v={},y=h[ii];ot(y,function(x,S){var I=p+"."+f;if(is(S)){var E=u(I,x,S);E=l(d,I,x,mf(S),E),E&&(v[x]=E[ii])}}),h[ii]=v}else{var _={path:p,name:f,type:m,prop:h,sanitizer:r};h=g.call(r,_)}}return h}}return t.getFieldType=mf,t}()});var LNe={};_n(LNe,{AppInsightsCore:()=>CNe,BaseTelemetryPlugin:()=>mh,DiagnosticLogger:()=>Q0,EventLatency:()=>wNe,EventPersistence:()=>kNe,EventPropertyType:()=>RNe,EventsDiscardedReason:()=>md,FullVersionString:()=>Aw,InternalAppInsightsCore:()=>hh,LoggingSeverity:()=>kne,MinChannelPriorty:()=>sre,NotificationManager:()=>QD,PerfEvent:()=>lx,PerfManager:()=>JD,ProcessTelemetryContext:()=>yne,SenderPostManager:()=>mx,TraceLevel:()=>PNe,Undefined:()=>Kp,ValueKind:()=>ENe,ValueSanitizer:()=>DNe,Version:()=>One,_InternalLogMessage:()=>ox,__getRegisteredEvents:()=>Ene,_appendHeader:()=>yw,_getAllResponseHeaders:()=>ch,_logInternalMessage:()=>jre,_throwInternal:()=>je,_warnToConsole:()=>Fa,addEventHandler:()=>GU,addEventListeners:()=>$U,addPageHideEventListener:()=>Rw,addPageShowEventListener:()=>kw,addPageUnloadEventListener:()=>aN,areCookiesSupported:()=>Iw,arrForEach:()=>_e,arrIndexOf:()=>Hr,arrMap:()=>Qp,arrReduce:()=>YE,attachEvent:()=>wne,blockDynamicConversion:()=>zD,convertAllHeadersToMap:()=>_U,cookieAvailable:()=>Iw,createCookieMgr:()=>dh,createDynamicConfig:()=>ni,createEnumStyle:()=>po,createGuid:()=>SNe,createProcessTelemetryContext:()=>Ua,createTraceParent:()=>eN,createUniqueNamespace:()=>Ps,createUnloadHandlerContainer:()=>fx,dateNow:()=>xi,detachEvent:()=>Rne,disallowsSameSiteNone:()=>NU,doPerf:()=>ji,dumpObj:()=>tt,eventOff:()=>gh,eventOn:()=>df,extend:()=>gx,findW3cTraceParent:()=>nN,forceDynamicConversion:()=>Kre,formatErrorMessageXdr:()=>ax,formatErrorMessageXhr:()=>sh,formatTraceParent:()=>rN,generateW3CId:()=>dx,getCommonSchemaMetaData:()=>Dw,getConsole:()=>ND,getCookieValue:()=>xNe,getCrypto:()=>LD,getDocument:()=>yi,getDynamicConfigHandler:()=>GD,getExceptionName:()=>qn,getFieldValueType:()=>mf,getGlobal:()=>ra,getGlobalInst:()=>hn,getHistory:()=>_D,getIEVersion:()=>MD,getISOString:()=>tu,getJSON:()=>ks,getLocation:()=>ix,getMsCrypto:()=>OD,getNavigator:()=>lo,getPerformance:()=>Zm,getResponseText:()=>xd,getSetValue:()=>UD,getTenantId:()=>eB,getTime:()=>Ic,getWindow:()=>_i,hasDocument:()=>A0,hasHistory:()=>L7,hasJSON:()=>rf,hasNavigator:()=>KE,hasOwnProperty:()=>Qi,hasWindow:()=>D0,isArray:()=>mt,isArrayValid:()=>Mne,isBeaconsSupported:()=>Sc,isBoolean:()=>ud,isChromium:()=>nB,isDate:()=>GE,isDocumentObjectAvailable:()=>bNe,isError:()=>T0,isFetchSupported:()=>ih,isFunction:()=>Et,isGreaterThanZero:()=>ob,isIE:()=>K0,isLatency:()=>tB,isNotTruthy:()=>x7,isNullOrUndefined:()=>we,isNumber:()=>ta,isObject:()=>Bn,isReactNative:()=>W0,isSampledFlag:()=>tN,isString:()=>Vt,isTruthy:()=>al,isTypeof:()=>y7,isUint8ArrayAvailable:()=>_Ne,isUndefined:()=>Ut,isValidSpanId:()=>uf,isValidTraceId:()=>cf,isValidTraceParent:()=>Tw,isValueAssigned:()=>is,isValueKind:()=>pN,isWindowObjectAvailable:()=>yNe,isXhrSupported:()=>vw,mergeEvtNamespace:()=>nu,newGuid:()=>ZD,newId:()=>HD,normalizeJsName:()=>sx,objDefineAccessors:()=>N7,objForEachKey:()=>ot,objFreeze:()=>Yp,objKeys:()=>Ao,objSeal:()=>T7,onConfigChange:()=>mo,openXhr:()=>INe,optimizeObject:()=>gl,parseResponse:()=>cx,parseTraceParent:()=>px,perfNow:()=>XE,prependTransports:()=>ah,proxyAssign:()=>Hre,proxyFunctionAs:()=>oh,proxyFunctions:()=>ru,random32:()=>uh,randomValue:()=>jD,removeEventHandler:()=>zU,removeEventListeners:()=>ib,removePageHideEventListener:()=>uN,removePageShowEventListener:()=>lN,removePageUnloadEventListener:()=>cN,safeGetCookieMgr:()=>sne,safeGetLogger:()=>yd,sanitizeProperty:()=>rB,setEnableEnvMocks:()=>Mre,setProcessTelemetryTimings:()=>fN,setValue:()=>hl,strContains:()=>Xi,strEndsWith:()=>L0,strFunction:()=>UE,strObject:()=>Wm,strPrototype:()=>cd,strStartsWith:()=>$_,strTrim:()=>Yr,strUndefined:()=>Kp,throwError:()=>bi,toISOString:()=>tu,useXDomainRequest:()=>FD});var vx=A(()=>{TNe();ANe();NNe();un();iB()});var bx,oB,sB,Fne=A(()=>{bx="REAL_TIME",oB="NEAR_REAL_TIME",sB="BEST_EFFORT"});var Sd,aB,ONe,Une,MNe,FNe,UNe,Bne,qne,cB,BNe,qNe,jNe,uB,jne,lB,dB,pB,mN,Hne,Vne,HNe,Nw,Gne,fB,hN=A(()=>{Sd="",aB="drop",ONe="send",Une="requeue",MNe="rspFail",FNe="oth",UNe="no-cache, no-store",Bne="application/x-json-stream",qne="cache-control",cB="content-type",BNe="kill-tokens",qNe="kill-duration",jNe="time-delta-millis",uB="client-version",jne="client-id",lB="time-delta-to-apply-millis",dB="upload-time",pB="apikey",mN="AuthMsaDeviceTicket",Hne="WebAuthToken",Vne="AuthXToken",HNe="NoResponseBody",Nw="msfpc",Gne="trace",fB="user"});var gN,mB,hB,gB,vN,ar,hf,bl,Ji,gf,os,vf,yx,vB,sb,bB,_x,yB,_B,VNe,zne,$ne,GNe,zNe,xB,Wne,Kne,$Ne,WNe,Yne,Qne,KNe,SB,IB,Xne,xx,Lw,Jne,oa,Cc,bN,yN,Ow,CB,_N,YNe,TB,EB,Mw,Zne,xN,wB,RB,Fw,kB,PB,AB,SN,QNe,XNe,eie,tie,JNe,ZNe,eLe,DB,IN,ab,Sx,Uw=A(()=>{gN="allowRequestSending",mB="firstRequestSent",hB="shouldAddClockSkewHeaders",gB="getClockSkewHeaderValue",vN="setClockSkew",ar="length",hf="concat",bl="iKey",Ji="count",gf="events",os="push",vf="split",yx="splice",vB="toLowerCase",sb="hdrs",bB="useHdrs",_x="initialize",yB="setTimeoutOverride",_B="clearTimeoutOverride",VNe="payloadPreprocessor",zne="overrideEndpointUrl",$ne="avoidOptions",GNe="disableEventTimings",zNe="stringifyObjects",xB="enableCompoundKey",Wne="disableXhrSync",Kne="disableFetchKeepAlive",$Ne="addNoResponse",WNe="excludeCsMetaData",Yne="useSendBeacon",Qne="alwaysUseXhrOverride",KNe="unloadTransports",SB="serializeOfflineEvt",IB="getOfflineRequestDetails",Xne="createPayload",xx="headers",Lw="_thePayload",Jne="urlString",oa="batches",Cc="sendType",bN="addHeader",yN="canSendRequest",Ow="sendQueuedRequests",CB="isCompletelyIdle",_N="setUnloading",YNe="isTenantKilled",TB="sendSynchronousBatch",EB="_transport",Mw="getWParam",Zne="isBeacon",xN="timings",wB="isTeardown",RB="isSync",Fw="data",kB="_sendReason",PB="setKillSwitchTenants",AB="_backOffTransmission",SN="identifier",QNe="disableOptimizeObj",XNe="ignoreMc1Ms0CookieProcessing",eie="eventsLimitInMem",tie="autoFlushEventsLimit",JNe="disableAutoBatchFlushLimit",ZNe="overrideInstrumentationKey",eLe="disableTelemetry",DB="baseData",IN="sendAttempt",ab="latency",Sx="sync"});function rLe(t){var e=(t.ext||{}).intweb;return e&&is(e[Nw])?e[Nw]:null}function tLe(t){for(var e=null,r=0;e===null&&r<t[ar];r++)e=rLe(t[r]);return e}var Bw,rie=A(()=>{vx();hN();Uw();Bw=function(){function t(e,r){var n=r?[][hf](r):[],o=this,s=tLe(n);o[bl]=function(){return e},o.Msfpc=function(){return s||Sd},o[Ji]=function(){return n[ar]},o[gf]=function(){return n},o.addEvent=function(a){return a?(n[os](a),s||(s=rLe(a)),!0):!1},o[vf]=function(a,c){var u;if(a<n[ar]){var l=n[ar]-a;we(c)||(l=c<l?c:l),u=n[yx](a,l),s=tLe(n)}return new t(e,u)}}return t.create=function(e,r){return new t(e,r)},t}()});var nLe,iLe=A(()=>{ns();Uw();nLe=function(){function t(){var e=!0,r=!0,n=!0,o="use-collector-delta",s=!1;mr(t,this,function(a){a[gN]=function(){return e},a[mB]=function(){n&&(n=!1,s||(e=!1))},a[hB]=function(){return r},a[gB]=function(){return o},a[vN]=function(c){s||(c?(o=c,r=!0,s=!0):r=!1,e=!0)}})}return t.__ieDyn=1,t}()});var Gpt,oLe,sLe=A(()=>{ns();vx();Uw();Gpt=1e3,oLe=function(){function t(){var e={};function r(n){var o=[];return n&&_e(n,function(s){o[os](Yr(s))}),o}mr(t,this,function(n){n[PB]=function(o,s){if(o&&s)try{var a=r(o[vf](","));if(s==="this-request-only")return a;for(var c=parseInt(s,10)*Gpt,u=0;u<a[ar];++u)e[a[u]]=xi()+c}catch{return[]}return[]},n[YNe]=function(o){var s=e,a=Yr(o);return s[a]!==void 0&&s[a]>xi()?!0:(delete s[a],!1)}})}return t.__ieDyn=1,t}()});function cLe(t){return!(t>=300&&t<500&&t!=429||t==501||t==505)}function NB(t){var e=0,r=aLe*zpt,n=aLe*$pt,o=Math.floor(Math.random()*(n-r))+r;return e=Math.pow(2,t)*o,Math.min(e,Wpt)}var zpt,$pt,aLe,Wpt,nie=A(()=>{zpt=.8,$pt=1.2,aLe=3e3,Wpt=6e5});function Jpt(t,e,r,n,o){if(o&&e){var s=t(o.value,o.kind,o.propertyType);if(s>-1){var a=e[uLe];a||(a=e[uLe]={f:{}});var c=a[LB];if(c||(c=a[LB]={}),r)for(var u=0;u<r.length;u++){var l=r[u];c[l]||(c[l]={f:{}});var d=c[l][LB];d||(d=c[l][LB]={}),c=d}c=c[n]={},mt(o.value)?c.a={t:s}:c.t=s}}}var Kpt,Ypt,lLe,dLe,Qpt,uLe,LB,Xpt,pLe,fLe=A(()=>{ns();vx();rie();hN();At();Kpt=20,Ypt=3984588,lLe=65e3,dLe=2e6,Qpt=Math.min(dLe,lLe),uLe="metadata",LB="f",Xpt=/\./,pLe=function(){function t(e,r,n,o,s,a){var c="data",u="baseData",l="ext",d=!!o,p=!0,f=r,m={},h=!!a,g=s||Dw;mr(t,this,function(v){v.createPayload=function(x,S,I,E,R,B){return{apiKeys:[],payloadBlob:Sd,overflow:null,sizeExceed:[],failedEvts:[],batches:[],numEvents:0,retryCnt:x,isTeardown:S,isSync:I,isBeacon:E,sendType:B,sendReason:R}},v.appendPayload=function(x,S,I){var E=x&&S&&!x.overflow;return E&&ji(e,function(){return"Serializer:appendPayload"},function(){for(var R=S.events(),B=x.payloadBlob,V=x.numEvents,M=!1,le=[],ne=[],q=x.isBeacon,P=q?lLe:Ypt,k=q?Qpt:dLe,U=0,F=0;U<R.length;){var $=R[U];if($){if(V>=I){x.overflow=S.split(U);break}var ce=v.getEventBlob($);if(ce&&ce.length<=k){var Y=ce.length,j=B.length;if(j+Y>P){x.overflow=S.split(U);break}B&&(B+=`
`),B+=ce,F++,F>Kpt&&(dd(B,0,1),F=0),M=!0,V++}else ce?le.push($):ne.push($),R.splice(U,1),U--}U++}if(le.length>0&&x.sizeExceed.push(Bw.create(S.iKey(),le)),ne.length>0&&x.failedEvts.push(Bw.create(S.iKey(),ne)),M){x.batches.push(S),x.payloadBlob=B,x.numEvents=V;var xe=S.iKey();Hr(x.apiKeys,xe)===-1&&x.apiKeys.push(xe)}},function(){return{payload:x,theBatch:{iKey:S.iKey(),evts:S.events()},max:I}}),E},v.getEventBlob=function(x){try{return ji(e,function(){return"Serializer.getEventBlob"},function(){var S={};S.name=x.name,S.time=x.time,S.ver=x.ver,S.iKey="o:"+eB(x.iKey);var I={},E;h||(E=function(M,le,ne){Jpt(g,I,M,le,ne)});var R=x[l];R&&(S[l]=I,ot(R,function(M,le){var ne=I[M]={};_(le,ne,"ext."+M,!0,null,null,!0)}));var B=S[c]={};B.baseType=x.baseType;var V=B[u]={};return _(x.baseData,V,u,!1,[u],E,p),_(x.data,B,c,!1,[],E,p),JSON.stringify(S)},function(){return{item:x}})}catch{return null}};function y(x,S){var I=m[x];return I===void 0&&(x.length>=7&&(I=$_(x,"ext.metadata")||$_(x,"ext.web")),m[x]=I),I}function _(x,S,I,E,R,B,V){ot(x,function(M,le){var ne=null;if(le||is(le)){var q=I,P=M,k=R,U=S;if(d&&!E&&Xpt.test(M)){var F=M.split("."),$=F.length;if($>1){k&&(k=k.slice());for(var ce=0;ce<$-1;ce++){var Y=F[ce];U=U[Y]=U[Y]||{},q+="."+Y,k&&k.push(Y)}P=F[$-1]}}var j=E&&y(q,P);if(!j&&f&&f.handleField(q,P)?ne=f.value(q,P,le,n):ne=rB(P,le,n),ne){var xe=ne.value;if(U[P]=xe,B&&B(k,P,ne),V&&typeof xe=="object"&&!mt(xe)){var ee=k;ee&&(ee=ee.slice(),ee.push(P)),_(le,xe,q+"."+P,E,ee,B,V)}}}})}})}return t.__ieDyn=1,t}()});function qw(t,e){return{set:function(r,n){for(var o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];return $te([t,e],r,n,o)}}}var iie=A(()=>{At()});function Cx(t,e,r){sie[t]=e,r!==!1&&(aie[e]=t)}function mLe(t,e){var r=!1;if(t&&e){var n=Ao(t);if(n&&n[ar]>0)for(var o=e[vB](),s=0;s<n[ar];s++){var a=n[s];if(a&&Qi(e,a)&&a[vB]()===o){r=!0;break}}}return r}function jw(t,e,r,n){e&&r&&r[ar]>0&&(n&&sie[e]?(t[sb][sie[e]]=r,t[bB]=!0):t.url+="&"+e+"="+r)}function rft(t,e,r){for(var n=0;n<t[ar];n++)if(t[n].name===e){t[n].value=r;return}t[os]({name:e,value:r})}function nft(t,e){for(var r=0;r<t[ar];r++)if(t[r].name===e){t[yx](r,1);return}}var Ix,oie,Zpt,eft,tft,sie,aie,hLe,gLe=A(()=>{ns();vx();At();iLe();hN();sLe();nie();fLe();iie();Uw();oie="sendAttempt",Zpt="&"+HNe+"=true",eft="?cors=true&"+cB[vB]()+"="+Bne,tft=(Ix={},Ix[1]=Une,Ix[100]=Une,Ix[200]="sent",Ix[8004]=aB,Ix[8003]=aB,Ix),sie={},aie={};Cx(mN,mN,!1);Cx(uB,uB);Cx(jne,"Client-Id");Cx(pB,pB);Cx(lB,lB);Cx(dB,dB);Cx(Vne,Vne);hLe=function(){function t(e,r,n,o){var s,a,c,u,l=!1,d,p,f,m,h,g,v,y,_,x,S,I,E,R,B,V,M,le,ne,q,P,k,U,F,$,ce,Y;mr(t,this,function(j){Lt();var xe=!0;j[_x]=function(te,Ne,ze){F||(h=Ne,I=Ne.getCookieMgr(),p=ze,f=p.diagLog(),ll(q,mo(te,function(xt){var Q,ue=xt.cfg,ve=xt.cfg.extensionConfig[ze.identifier];$=qw(ve[yB],ve[_B]),is(ue.anonCookieName)?rft(v,"anoncknm",ue.anonCookieName):nft(v,"anoncknm"),P=ve[VNe],k=ve.payloadListener;var Ee=ve.httpXHROverride,W=ve[zne]?ve[zne]:ue.endpointUrl;s=W+eft,R=Ut(ve[$ne])?!0:!ve[$ne],S=!ve[GNe];var re=ve.valueSanitizer,fe=ve[zNe],Re=!!ue[xB];Ut(ve[xB])||(Re=!!ve[xB]),B=ve.xhrTimeout,V=!!ve[Wne],M=!!ve[Kne],ne=ve[$Ne]!==!1,ce=!!ve[WNe],Ne.getPlugin("LocalStorage")&&(M=!0),l=!W0(),x=new pLe(h,re,fe,Re,Dw,ce),we(ve[Yne])||(l=!!ve[Yne]);var ct=vt();Y?Y.SetConfig(ct):(Y=new mx,Y[_x](ct,f));var Oe=Ee,Er=ve[Qne]?Ee:null,Ur=ve[Qne]?Ee:null,Zi=[3,2];if(!Ee){g=!1;var Ec=[];W0()?(Ec=[2,1],Zi=[2,1,3]):Ec=[1,2,3],Ec=ah(Ec,ve.transports),Ee=ee(Ec,!1),Ee||Fa(f,"No available transport to send events"),Oe=ee(Ec,!0)}Er||(Zi=ah(Zi,ve[KNe]),Er=ee(Zi,!0)),le=!g&&(l&&Sc()||!M&&ih(!0)),m=(Q={},Q[0]=Ee,Q[1]=Oe||ee([1,2,3],!0),Q[2]=Er||Oe||ee([1],!0),Q[3]=Ur||ee([2,3],!0)||Oe||ee([1],!0),Q)})),F=!0)},j.addResponseHandler=function(te){return U[os](te),{rm:function(){var Ne=U.indexOf(te);Ne>=0&&U[yx](Ne,1)}}},j[SB]=function(te){try{if(x)return x.getEventBlob(te)}catch{}return Sd},j[IB]=function(){try{var te=x&&x[Xne](0,!1,!1,!1,1,0);return Pn(te,R)}catch{}return null};function ee(te,Ne){try{return Y&&Y.getSenderInst(te,Ne)}catch{}return null}j._getDbgPlgTargets=function(){return[m[0],a,x,m]};function vt(){try{var te={xdrOnComplete:We,fetchOnComplete:br,xhrOnComplete:ye,beaconOnRetry:G},Ne={enableSendPromise:!1,isOneDs:!0,disableCredentials:!xe,disableXhr:!1,disableBeacon:!l,disableBeaconSync:!l,disableFetchKeepAlive:M,timeWrapper:$,addNoResponse:ne,senderOnCompleteCallBack:te};return Ne}catch{}return null}function We(te,Ne,ze){var xt=xd(te);lt(Ne,200,{},xt),Cl(xt)}function Lt(){var te;s=null,a=new oLe,c=!1,u=new nLe,l=!1,d=0,p=null,f=null,m=null,h=null,g=!0,v=[],y={},_=[],x=null,S=!1,I=null,E=!1,R=!1,B=te,V=te,M=te,le=te,ne=te,q=[],P=te,k=te,U=[],F=!1,$=qw(),ce=!1,Y=null}function br(te,Ne,ze,xt){var Q=function(Ee,W,re){lt(Ne,Ee,W,re),Cl(re)},ue={},ve=te[xx];ve&&ve.forEach(function(Ee,W){ue[W]=Ee}),Q(te.status,ue,ze||Sd)}function ye(te,Ne,ze){var xt=xd(te);lt(Ne,te.status,ch(te,!0),xt),Cl(xt)}function lt(te,Ne,ze,xt){try{te(Ne,ze,xt)}catch(Q){je(f,2,518,tt(Q))}}function G(te,Ne,ze){var xt=te,Q=200,ue=xt[Lw],ve=te[Jne]+(ne?Zpt:Sd);try{var Ee=lo();if(ue){var W=!!h.getPlugin("LocalStorage"),re=[],fe=[];_e(ue[oa],function(Re){if(re&&Re&&Re[Ji]()>0)for(var ct=Re[gf](),Oe=0;Oe<ct[ar];Oe++)if(Ee.sendBeacon(ve,x.getEventBlob(ct[Oe])))fe[os](Re[Oe]);else{re[os](Re[vf](Oe));break}else re[os](Re[vf](0))}),fe[ar]>0&&(ue.sentEvts=fe),W||Ke(re,8003,ue[Cc],!0)}else Q=0}catch(Re){Fa(f,"Failed to send telemetry using sendBeacon API. Ex:"+tt(Re)),Q=0}finally{lt(Ne,Q,{},Sd)}}function pe(te){return te===2||te===3}function me(te){return E&&pe(te)&&(te=2),te}j[bN]=function(te,Ne){y[te]=Ne},j.removeHeader=function(te){delete y[te]},j[yN]=function(){return Pe()&&u[gN]()},j[Ow]=function(te,Ne){Ut(te)&&(te=0),E&&(te=me(te),Ne=2),bt(_,te,0)&&ln(Ie(),0,!1,te,Ne||0)},j[CB]=function(){return!c&&d===0&&_[ar]===0},j[_N]=function(te){E=te},j.addBatch=function(te){if(te&&te[Ji]()>0){if(a.isTenantKilled(te[bl]()))return!1;_[os](te)}return!0},j.teardown=function(){_[ar]>0&&ln(Ie(),0,!0,2,2),_e(q,function(te){te&&te.rm&&te.rm()}),q=[]},j.pause=function(){c=!0},j.resume=function(){c=!1,j[Ow](0,4)},j[TB]=function(te,Ne,ze){te&&te[Ji]()>0&&(we(Ne)&&(Ne=1),E&&(Ne=me(Ne),ze=2),ln([te],0,!1,Ne,ze||0))};function Pe(){return!c&&d<r}function Ie(){var te=_;return _=[],te}function bt(te,Ne,ze){var xt=!1;return te&&te[ar]>0&&!c&&m[Ne]&&x&&(xt=Ne!==0||Pe()&&(ze>0||u[gN]())),xt}function Dt(te){var Ne={};return te&&_e(te,function(ze,xt){Ne[xt]={iKey:ze[bl](),evts:ze[gf]()}}),Ne}function ln(te,Ne,ze,xt,Q){if(!(!te||te[ar]===0)){if(c){Ke(te,1,xt);return}xt=me(xt);try{var ue=te,ve=xt!==0;ji(h,function(){return"HttpManager:_sendBatches"},function(Ee){Ee&&(te=te.slice(0));for(var W=[],re=null,fe=Ic(),Re=m[xt]||(ve?m[1]:m[0]),ct=Re&&Re[EB],Oe=le&&(E||pe(xt)||ct===3||Re._isSync&&ct===2);bt(te,xt,Ne);){var Er=te.shift();Er&&Er[Ji]()>0&&(a.isTenantKilled(Er[bl]())?W[os](Er):(re=re||x[Xne](Ne,ze,ve,Oe,Q,xt),x.appendPayload(re,Er,e)?re.overflow!==null&&(te=[re.overflow][hf](te),re.overflow=null,Ls(re,fe,Ic(),Q),fe=Ic(),re=null):(Ls(re,fe,Ic(),Q),fe=Ic(),te=[Er][hf](te),re=null)))}re&&Ls(re,fe,Ic(),Q),te[ar]>0&&(_=te[hf](_)),Ke(W,8004,xt)},function(){return{batches:Dt(ue),retryCount:Ne,isTeardown:ze,isSynchronous:ve,sendReason:Q,useSendBeacon:pe(xt),sendType:xt}},!ve)}catch(Ee){je(f,2,48,"Unexpected Exception sending batch: "+tt(Ee))}}}function Pn(te,Ne){var ze={url:s,hdrs:{},useHdrs:!1};Ne?(ze[sb]=gx(ze[sb],y),ze.useHdrs=Ao(ze.hdrs)[ar]>0):ot(y,function(Ee,W){aie[Ee]?jw(ze,aie[Ee],W,!1):(ze[sb][Ee]=W,ze[bB]=!0)}),jw(ze,jne,"NO_AUTH",Ne),jw(ze,uB,Aw,Ne);var xt=Sd;_e(te.apiKeys,function(Ee){xt[ar]>0&&(xt+=","),xt+=Ee}),jw(ze,pB,xt,Ne),jw(ze,dB,xi().toString(),Ne);var Q=Gx(te);if(is(Q)&&(ze.url+="&ext.intweb.msfpc="+Q),u[hB]()&&jw(ze,lB,u[gB](),Ne),h[Mw]){var ue=h[Mw]();ue>=0&&(ze.url+="&w="+ue)}for(var ve=0;ve<v[ar];ve++)ze.url+="&"+v[ve].name+"="+v[ve].value;return ze}function ai(te,Ne,ze){te[Ne]=te[Ne]||{},te[Ne][p.identifier]=ze}function Ls(te,Ne,ze,xt){if(te&&te.payloadBlob&&te.payloadBlob[ar]>0){var Q=!!P,ue=m[te.sendType];!pe(te[Cc])&&te[Zne]&&te.sendReason===2&&(ue=m[2]||m[3]||ue);var ve=R;(te.isBeacon||ue[EB]===3)&&(ve=!1);var Ee=Pn(te,ve);ve=ve||Ee[bB];var W=Ic();ji(h,function(){return"HttpManager:_doPayloadSend"},function(){for(var re=0;re<te.batches[ar];re++)for(var fe=te[oa][re],Re=fe[gf](),ct=0;ct<Re[ar];ct++){var Oe=Re[ct];if(S){var Er=Oe[xN]=Oe[xN]||{};ai(Er,"sendEventStart",W),ai(Er,"serializationStart",Ne),ai(Er,"serializationCompleted",ze)}Oe[oie]>0?Oe[oie]++:Oe[oie]=1}Ke(te[oa],1e3+(xt||0),te[Cc],!0);var Ur={data:te.payloadBlob,urlString:Ee.url,headers:Ee[sb],_thePayload:te,_sendReason:xt,timeout:B,disableXhrSync:V,disableFetchKeepAlive:M};ve&&(mLe(Ur[xx],qne)||(Ur[xx][qne]=UNe),mLe(Ur[xx],cB)||(Ur[xx][cB]=Bne));var Zi=null;ue&&(Zi=function(Ec){u[mB]();var Lh=function(Oh,Lb){Db(Oh,Lb,te,xt)},ua=te[wB]||te[RB];try{ue.sendPOST(Ec,Lh,ua),k&&k(Ur,Ec,ua,te[Zne])}catch(Oh){Fa(f,"Unexpected exception sending payload. Ex:"+tt(Oh)),lt(Lh,0,{})}}),ji(h,function(){return"HttpManager:_doPayloadSend.sender"},function(){if(Zi)if(te[Cc]===0&&d++,Q&&!te.isBeacon&&ue[EB]!==3){var Ec={data:Ur[Fw],urlString:Ur[Jne],headers:gx({},Ur[xx]),timeout:Ur.timeout,disableXhrSync:Ur[Wne],disableFetchKeepAlive:Ur[Kne]},Lh=!1;ji(h,function(){return"HttpManager:_doPayloadSend.sendHook"},function(){try{P(Ec,function(ua){Lh=!0,!g&&!ua[Lw]&&(ua[Lw]=ua[Lw]||Ur[Lw],ua[kB]=ua[kB]||Ur[kB]),Zi(ua)},te.isSync||te[wB])}catch{Lh||Zi(Ur)}})}else Zi(Ur)})},function(){return{thePayload:te,serializationStart:Ne,serializationCompleted:ze,sendReason:xt}},te[RB])}te.sizeExceed&&te.sizeExceed[ar]>0&&Ke(te.sizeExceed,8003,te[Cc]),te.failedEvts&&te.failedEvts[ar]>0&&Ke(te.failedEvts,8002,te[Cc])}function Cd(te,Ne){S&&_e(te,function(ze){var xt=ze[xN]=ze[xN]||{};ai(xt,"sendEventCompleted",Ne)})}function Db(te,Ne,ze,xt){var Q=9e3,ue=null,ve=!1,Ee=!1;try{var W=!0;if(typeof te!==Kp){if(Ne){u[vN](Ne[jNe]);var re=Ne[qNe]||Ne["kill-duration-seconds"];_e(a[PB](Ne[BNe],re),function(Re){_e(ze[oa],function(ct){if(ct[bl]()===Re){ue=ue||[];var Oe=ct[vf](0);ze.numEvents-=Oe[Ji](),ue[os](Oe)}})})}if(te==200||te==204){Q=200;return}(!cLe(te)||ze.numEvents<=0)&&(W=!1),Q=9e3+te%1e3}if(W){Q=100;var fe=ze.retryCnt;ze[Cc]===0&&(fe<n?(ve=!0,Td(function(){ze[Cc]===0&&d--,ln(ze[oa],fe+1,ze[wB],E?2:ze[Cc],5)},E,NB(fe))):(Ee=!0,E&&(Q=8001)))}}finally{ve||(u[vN](),Dh(ze,Q,xt,Ee)),Ke(ue,8004,ze[Cc])}}function Dh(te,Ne,ze,xt){try{xt&&p[AB]();var Q=te[oa];Ne===200&&(Q=te.sentEvts||te[oa],!xt&&!te[RB]&&p._clearBackOff(),Nb(Q)),Ke(Q,Ne,te[Cc],!0)}finally{te[Cc]===0&&(d--,ze!==5&&j.sendQueuedRequests(te[Cc],ze))}}function Nb(te){if(S){var Ne=Ic();_e(te,function(ze){ze&&ze[Ji]()>0&&Cd(ze[gf](),Ne)})}}function Td(te,Ne,ze){Ne?te():$.set(te,ze)}function Gx(te){for(var Ne=0;Ne<te.batches[ar];Ne++){var ze=te[oa][Ne].Msfpc();if(ze)return encodeURIComponent(ze)}return Sd}function Cl(te){var Ne=U;try{for(var ze=0;ze<Ne[ar];ze++)try{Ne[ze](te)}catch(Q){je(f,1,519,"Response handler failed: "+Q)}if(te){var xt=JSON.parse(te);is(xt.webResult)&&is(xt.webResult[Nw])&&I.set("MSFPC",xt.webResult[Nw],365*86400)}}catch{}}function Ke(te,Ne,ze,xt){if(te&&te[ar]>0&&o){var Q=o[Nh(Ne)];if(Q){var ue=ze!==0;ji(h,function(){return"HttpManager:_sendBatchesNotification"},function(){Td(function(){try{Q.call(o,te,Ne,ue,ze)}catch(ve){je(f,1,74,"send request notification failed: "+ve)}},xt||ue,0)},function(){return{batches:Dt(te),reason:Ne,isSync:ue,sendSync:xt,sendType:ze}},!ue)}}}function Nh(te){var Ne=tft[te];return is(Ne)||(Ne=FNe,te>=9e3&&te<=9999?Ne=MNe:te>=8e3&&te<=8999?Ne=aB:te>=1e3&&te<=1999&&(Ne=ONe)),Ne}})}return t.__ieDyn=1,t}()});function uft(t){return t&&t.sendPOST}var ift,vLe,oft,_Le,xLe,sft,bLe,aft,cie,Tx,yLe,Lo,cft,SLe,ILe=A(()=>{hc();ns();vx();pw();At();Fne();rie();gLe();hN();nie();iie();Uw();ift=.25,vLe=500,oft=20,_Le=6,xLe=2,sft=4,bLe=2,aft=1,cie=1e4,Tx="eventsDiscarded",yLe="",Lo=void 0,cft=La({eventsLimitInMem:{isVal:ob,v:cie},immediateEventLimit:{isVal:ob,v:500},autoFlushEventsLimit:{isVal:ob,v:0},disableAutoBatchFlushLimit:!1,httpXHROverride:{isVal:uft,v:Lo},overrideInstrumentationKey:Lo,overrideEndpointUrl:Lo,disableTelemetry:!1,ignoreMc1Ms0CookieProcessing:!1,setTimeoutOverride:Lo,clearTimeoutOverride:Lo,payloadPreprocessor:Lo,payloadListener:Lo,disableEventTimings:Lo,valueSanitizer:Lo,stringifyObjects:Lo,enableCompoundKey:Lo,disableOptimizeObj:!1,transports:Lo,unloadTransports:Lo,useSendBeacon:Lo,disableFetchKeepAlive:Lo,avoidOptions:!1,xhrTimeout:Lo,disableXhrSync:Lo,alwaysUseXhrOverride:!1,maxEventRetryAttempts:{isVal:ta,v:_Le},maxUnloadEventRetryAttempts:{isVal:ta,v:xLe},addNoResponse:Lo,excludeCsMetaData:Lo});SLe=function(t){mc(e,t);function e(){var r=t.call(this)||this;r.identifier="PostChannel",r.priority=1011,r.version="4.1.1";var n,o=!1,s=[],a,c=!1,u=0,l,d=0,p,f={},m=bx,h,g,v,y,_,x,S,I,E,R,B,V,M,le,ne,q,P,k,U,F,$,ce;return mr(e,r,function(Y,j){Pe(),Y._getDbgPlgTargets=function(){return[_,n]},Y[_x]=function(W,re,fe){ji(re,function(){return"PostChannel:initialize"},function(){j[_x](W,re,fe),U=re.getNotifyMgr();try{ne=nu(Ps(Y[SN]),re.evtNamespace&&re.evtNamespace()),Y._addHook(mo(W,function(Re){var ct=Re.cfg,Oe=Ua(null,ct,re);n=Oe.getExtCfg(Y[SN],cft),q=qw(n[yB],n[_B]),B=!n[QNe]&&nB(),P=n[XNe],ee(re),p=n[eie],l=n.immediateEventLimit,S=n[tie],M=n.maxEventRetryAttempts,le=n.maxUnloadEventRetryAttempts,k=n[JNe],Ee(),$=n[ZNe],ce=!!n[eLe],F&&xe();var Er=ct.disablePageUnloadEvents||[];F=aN(Lt,Er,ne),F=Rw(Lt,Er,ne)||F,F=kw(br,ct.disablePageShowEvents,ne)||F})),_[_x](W,Y.core,Y)}catch(Re){throw Y.setInitialized(!1),Re}},function(){return{theConfig:W,core:re,extensions:fe}})},Y.processTelemetry=function(W,re){fN(W,Y[SN]),re=re||Y._getTelCtx(re);var fe=W;!ce&&!o&&($&&(fe[bl]=$),lt(fe,!0),V?Dt(2,2):me()),Y.processNext(fe,re)},Y.getOfflineSupport=function(){try{var W=_&&_[IB]();if(W)return{getUrl:function(){return W.url},serialize:We,batch:vt,shouldProcess:function(re){return!ce},createPayload:function(re){return{urlString:W.url,headers:W[sb],data:re}}}}catch{}return null},Y._doTeardown=function(W,re){Dt(2,2),o=!0,_.teardown(),xe(),Pe()};function xe(){cN(null,ne),uN(null,ne),lN(null,ne)}function ee(W){var re=W[Mw];W[Mw]=function(){var fe=0;return P&&(fe=fe|2),fe|re.call(W)}}function vt(W){var re=yLe;return W&&W[ar]&&_e(W,function(fe){re&&(re+=`
`),re+=fe}),re}function We(W){var re=yLe;try{ye(W),re=_[SB](W)}catch{}return re}function Lt(W){var re=W||_i().event;re.type!=="beforeunload"&&(V=!0,_[_N](V)),Dt(2,2)}function br(W){V=!1,_[_N](V)}function ye(W){W.ext&&W.ext[Gne]&&delete W.ext[Gne],W.ext&&W.ext[fB]&&W.ext[fB].id&&delete W.ext[fB].id,B&&(W.ext=gl(W.ext),W[DB]&&(W[DB]=gl(W[DB])),W[Fw]&&(W[Fw]=gl(W[Fw])))}function lt(W,re){if(W[IN]||(W[IN]=0),W[ab]||(W[ab]=1),ye(W),W[Sx]){if(v||c)W[ab]=3,W[Sx]=!1;else if(_){B&&(W=gl(W)),_[TB](Bw.create(W[bl],[W]),W[Sx]===!0?1:W[Sx],3);return}}var fe=W[ab],Re=d,ct=p;fe===4&&(Re=u,ct=l);var Oe=!1;if(Re<ct)Oe=!Ls(W,re);else{var Er=1,Ur=oft;fe===4&&(Er=4,Ur=1),Oe=!0,Cd(W[bl],W[ab],Er,Ur)&&(Oe=!Ls(W,re))}Oe&&te(Tx,[W],md.QueueFull)}Y.setEventQueueLimits=function(W,re){n[eie]=p=ob(W)?W:cie,n[tie]=S=ob(re)?re:0,Ee();var fe=d>W;if(!fe&&I>0)for(var Re=1;!fe&&Re<=3;Re++){var ct=x[Re];ct&&ct[oa]&&_e(ct[oa],function(Oe){Oe&&Oe[Ji]()>=I&&(fe=!0)})}ai(!0,fe)},Y.pause=function(){bt(),c=!0,_.pause()},Y.resume=function(){c=!1,_.resume(),me()},Y._loadTransmitProfiles=function(W){Gx(),ot(W,function(re,fe){var Re=fe[ar];if(Re>=2){var ct=Re>2?fe[2]:0;if(fe[yx](0,Re-2),fe[1]<0&&(fe[0]=-1),fe[1]>0&&fe[0]>0){var Oe=fe[0]/fe[1];fe[0]=Math.ceil(Oe)*fe[1]}ct>=0&&fe[1]>=0&&ct>fe[1]&&(ct=fe[1]),fe[os](ct),f[re]=fe}})},Y.flush=function(W,re,fe){W===void 0&&(W=!0);var Re;if(!c)if(fe=fe||1,W)re||(Re=Ma(function(Oe){re=Oe})),a==null?(bt(),Dh(1,0,fe),a=Ie(function(){a=null,Nb(re,fe)},0)):s[os](re);else{var ct=bt();G(1,1,fe),re&&re(),ct&&me()}return Re},Y.setMsaAuthTicket=function(W){_[bN](mN,W)},Y.setAuthPluginHeader=function(W){_[bN](Hne,W)},Y.removeAuthPluginHeader=function(){_.removeHeader(Hne)},Y.hasEvents=pe,Y._setTransmitProfile=function(W){m!==W&&f[W]!==void 0&&(bt(),m=W,me())},ru(Y,function(){return _},["addResponseHandler"]);function G(W,re,fe){var Re=Dh(W,re,fe);return _[Ow](re,fe),Re}function pe(){return d>0}function me(){if(E>=0&&Dh(E,0,R)&&_[Ow](0,R),u>0&&!g&&!c){var W=f[m][2];W>=0&&(g=Ie(function(){g=null,G(4,0,1),me()},W))}var re=f[m][1];!h&&!a&&re>=0&&!c&&(pe()?h=Ie(function(){h=null,G(y===0?3:1,0,1),y++,y%=2,me()},re):y=0)}Y[AB]=function(){v<sft&&(v++,bt(),me())},Y._clearBackOff=function(){v&&(v=0,bt(),me())};function Pe(){n=null,o=!1,s=[],a=null,c=!1,u=0,l=500,d=0,p=cie,f={},m=bx,h=null,g=null,v=0,y=0,x={},S=0,F=!1,I=0,E=-1,R=null,B=!0,V=!1,M=_Le,le=xLe,ne=null,$=null,ce=!1,q=qw(),_=new hLe(vLe,bLe,aft,{requeue:Ke,send:ze,sent:xt,drop:Q,rspFail:ue,oth:ve}),Cl(),ln(),Ee()}function Ie(W,re){re===0&&v&&(re=1);var fe=1e3;return v&&(fe=NB(v-1)),q.set(W,re*fe)}function bt(){return h!==null?(h.cancel(),h=null,y=0,!0):!1}function Dt(W,re){bt(),a&&(a.cancel(),a=null),c||G(1,W,re)}function ln(){x[4]={batches:[],iKeyMap:{}},x[3]={batches:[],iKeyMap:{}},x[2]={batches:[],iKeyMap:{}},x[1]={batches:[],iKeyMap:{}}}function Pn(W,re,fe){var Re=x[re];Re||(re=1,Re=x[re]);var ct=Re.iKeyMap[W];return!ct&&fe&&(ct=Bw.create(W),Re.batches[os](ct),Re.iKeyMap[W]=ct),ct}function ai(W,re){_[yN]()&&!v&&(S>0&&d>S&&(re=!0),re&&a==null&&Y.flush(W,function(){},20))}function Ls(W,re){B&&(W=gl(W));var fe=W[ab],Re=Pn(W[bl],fe,!0);return Re.addEvent(W)?(fe!==4?(d++,re&&W[IN]===0&&ai(!W.sync,I>0&&Re[Ji]()>=I)):u++,!0):!1}function Cd(W,re,fe,Re){for(;fe<=re;){var ct=Pn(W,re,!0);if(ct&&ct[Ji]()>0){var Oe=ct[vf](0,Re),Er=Oe[Ji]();if(Er>0)return fe===4?u-=Er:d-=Er,Ne(Tx,[Oe],md.QueueFull),!0}fe++}return Db(),!1}function Db(){for(var W=0,re=0,fe=function(ct){var Oe=x[ct];Oe&&Oe[oa]&&_e(Oe[oa],function(Er){ct===4?W+=Er[Ji]():re+=Er[Ji]()})},Re=1;Re<=4;Re++)fe(Re);d=re,u=W}function Dh(W,re,fe){var Re=!1,ct=re===0;return!ct||_[yN]()?ji(Y.core,function(){return"PostChannel._queueBatches"},function(){for(var Oe=[],Er=4;Er>=W;){var Ur=x[Er];Ur&&Ur.batches&&Ur.batches[ar]>0&&(_e(Ur[oa],function(Zi){_.addBatch(Zi)?Re=Re||Zi&&Zi[Ji]()>0:Oe=Oe[hf](Zi[gf]()),Er===4?u-=Zi[Ji]():d-=Zi[Ji]()}),Ur[oa]=[],Ur.iKeyMap={}),Er--}Oe[ar]>0&&te(Tx,Oe,md.KillSwitch),Re&&E>=W&&(E=-1,R=0)},function(){return{latency:W,sendType:re,sendReason:fe}},!ct):(E=E>=0?Math.min(E,W):W,R=Math.max(R,fe)),Re}function Nb(W,re){G(1,0,re),Db(),Td(function(){W&&W(),s[ar]>0?a=Ie(function(){a=null,Nb(s.shift(),re)},0):(a=null,me())})}function Td(W){_[CB]()?W():a=Ie(function(){a=null,Td(W)},ift)}function Gx(){bt(),Cl(),m=bx,me()}function Cl(){f={},f[bx]=[2,1,0],f[oB]=[6,3,0],f[sB]=[18,9,0]}function Ke(W,re){var fe=[],Re=M;V&&(Re=le),_e(W,function(ct){ct&&ct[Ji]()>0&&_e(ct[gf](),function(Oe){Oe&&(Oe[Sx]&&(Oe[ab]=4,Oe[Sx]=!1),Oe[IN]<Re?(fN(Oe,Y[SN]),lt(Oe,!1)):fe[os](Oe))})}),fe[ar]>0&&te(Tx,fe,md.NonRetryableStatus),V&&Dt(2,2)}function Nh(W,re){var fe=U||{},Re=fe[W];if(Re)try{Re.apply(fe,re)}catch(ct){je(Y.diagLog(),1,74,W+" notification failed: "+ct)}}function te(W,re){for(var fe=[],Re=2;Re<arguments.length;Re++)fe[Re-2]=arguments[Re];re&&re[ar]>0&&Nh(W,[re][hf](fe))}function Ne(W,re){for(var fe=[],Re=2;Re<arguments.length;Re++)fe[Re-2]=arguments[Re];re&&re[ar]>0&&_e(re,function(ct){ct&&ct[Ji]()>0&&Nh(W,[ct.events()][hf](fe))})}function ze(W,re,fe){W&&W[ar]>0&&Nh("eventsSendRequest",[re>=1e3&&re<=1999?re-1e3:0,fe!==!0])}function xt(W,re){Ne("eventsSent",W,re),me()}function Q(W,re){Ne(Tx,W,re>=8e3&&re<=8999?re-8e3:md.Unknown)}function ue(W){Ne(Tx,W,md.NonRetryableStatus),me()}function ve(W,re){Ne(Tx,W,md.Unknown),me()}function Ee(){k?I=0:I=Math.max(vLe*(bLe+1),p/6)}}),r}return e.__ieDyn=1,e}(mh)});var CLe={};_n(CLe,{BE_PROFILE:()=>sB,NRT_PROFILE:()=>oB,PostChannel:()=>SLe,RT_PROFILE:()=>bx});var TLe=A(()=>{Fne();ILe()});var wLe=O(bf=>{"use strict";var lft=bf&&bf.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(e,r);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,o)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),dft=bf&&bf.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),ELe=bf&&bf.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&lft(e,t,r);return dft(e,t),e};Object.defineProperty(bf,"__esModule",{value:!0});bf.oneDataSystemClientFactory=void 0;var pft=async(t,e,r)=>{let n=await Promise.resolve().then(()=>ELe((vx(),eo(LNe)))),o=await Promise.resolve().then(()=>ELe((TLe(),eo(CLe)))),s=new n.AppInsightsCore,a=new o.PostChannel,c={instrumentationKey:t,endpointUrl:"https://mobile.events.data.microsoft.com/OneCollector/1.0",loggingLevelTelemetry:0,loggingLevelConsole:0,disableCookiesUsage:!0,disableDbgExt:!0,disableInstrumentationKeyValidation:!0,channels:[[a]]};if(r){c.extensionConfig={};let d={alwaysUseXhrOverride:!0,httpXHROverride:r};c.extensionConfig[a.identifier]=d}let l=e.workspace.getConfiguration("telemetry").get("internalTesting");return s.initialize(c,[]),s.addTelemetryInitializer(d=>{d.ext=d.ext??{},d.ext.web=d.ext.web??{},d.ext.web.consentDetails='{"GPC_DataSharingOptIn":false}',l&&(d.ext.utc=d.ext.utc??{},d.ext.utc.flags=8462029)}),s},fft=async(t,e,r)=>{let n=await pft(t,e,r);return{logEvent:(a,c)=>{try{n?.track({name:a,baseData:{name:a,properties:c?.properties,measurements:c?.measurements}})}catch(u){throw new Error(`Failed to log event to app insights!
`+u.message)}},flush:async()=>{try{return new Promise((c,u)=>{if(!n){c();return}n.flush(!0,l=>{if(!l){u("Failed to flush app 1DS!");return}})})}catch(a){throw new Error(`Failed to flush 1DS!
`+a.message)}},dispose:async()=>new Promise(c=>{if(!n){c();return}n.unload(!1,()=>{c(),n=void 0},1e3)})}};bf.oneDataSystemClientFactory=fft});var RLe,Hw,Vw,CN,cb,yf,Oo,OB,yl=A(()=>{RLe="Microsoft_ApplicationInsights_BypassAjaxInstrumentation",Hw="sampleRate",Vw="ProcessLegacy",CN="http.method",cb="https://dc.services.visualstudio.com",yf="/v2/track",Oo="not_specified",OB="iKey"});var Ex,uie=A(()=>{un();Ex=are({requestContextHeader:[0,"Request-Context"],requestContextTargetKey:[1,"appId"],requestContextAppIdFormat:[2,"appId=cid-v1:"],requestIdHeader:[3,"Request-Id"],traceParentHeader:[4,"traceparent"],traceStateHeader:[5,"tracestate"],sdkContextHeader:[6,"Sdk-Context"],sdkContextHeaderAppIdRequest:[7,"appId"],requestContextHeaderLowerCase:[8,"request-context"]})});var yh,qt,_f,ub,_h,xh,MB,ho,Id,lb,FB,UB,BB,lie,qB,jB,wx,Gw,die,TN,Rx,_l,As,sa,kx,xf,Px,HB,VB,pie,Ax,db,EN,wN,Dx,zw,Nx,fie,Mo=A(()=>{yh="split",qt="length",_f="toLowerCase",ub="ingestionendpoint",_h="toString",xh="push",MB="removeItem",ho="name",Id="message",lb="count",FB="preTriggerDate",UB="disabled",BB="interval",lie="daysOfMonth",qB="date",jB="getUTCDate",wx="stringify",Gw="pathname",die="correlationHeaderExcludePatterns",TN="extensionConfig",Rx="exceptions",_l="parsedStack",As="properties",sa="measurements",kx="sizeInBytes",xf="typeName",Px="severityLevel",HB="problemGroup",VB="isManual",pie="CreateFromInterface",Ax="assembly",db="fileName",EN="hasFullStack",wN="level",Dx="method",zw="line",Nx="duration",fie="receivedResponse"});function GB(t,e,r){var n=e[qt],o=mie(t,e);if(o[qt]!==n){for(var s=0,a=o;r[a]!==void 0;)s++,a=Ui(o,0,147)+hie(s);o=a}return o}function mie(t,e){var r;return e&&(e=Yr(Xn(e)),e[qt]>150&&(r=Ui(e,0,150),je(t,2,57,"name is too long.  It has been truncated to 150 characters.",{name:e},!0))),r||e}function yn(t,e,r){r===void 0&&(r=1024);var n;return e&&(r=r||1024,e=Yr(Xn(e)),e[qt]>r&&(n=Ui(e,0,r),je(t,2,61,"string value is too long. It has been truncated to "+r+" characters.",{value:e},!0))),n||e}function pb(t,e){return WB(t,e,2048,66)}function $w(t,e){var r;return e&&e[qt]>32768&&(r=Ui(e,0,32768),je(t,2,56,"message is too long, it has been truncated to 32768 characters.",{message:e},!0)),r||e}function zB(t,e){var r;if(e){var n=""+e;n[qt]>32768&&(r=Ui(n,0,32768),je(t,2,52,"exception is too long, it has been truncated to 32768 characters.",{exception:e},!0))}return r||e}function aa(t,e){if(e){var r={};ot(e,function(n,o){if(Bn(o)&&rf())try{o=ks()[wx](o)}catch(s){je(t,2,49,"custom property is not valid",{exception:s},!0)}o=yn(t,o,8192),n=GB(t,n,r),r[n]=o}),e=r}return e}function ca(t,e){if(e){var r={};ot(e,function(n,o){n=GB(t,n,r),r[n]=o}),e=r}return e}function $B(t,e){return e&&WB(t,e,128,69)[_h]()}function WB(t,e,r,n){var o;return e&&(e=Yr(Xn(e)),e[qt]>r&&(o=Ui(e,0,r),je(t,2,n,"input is too long, it has been truncated to "+r+" characters.",{data:e},!0))),o||e}function hie(t){var e="00"+t;return dd(e,e[qt]-3)}var xl=A(()=>{un();At();Mo()});function Lx(t){var e=PLe,r=mft,n=r[e];return kLe.createElement?r[e]||(n=r[e]=kLe.createElement("a")):n={host:gie(t,!0)},n.href=t,e++,e>=r[qt]&&(e=0),PLe=e,n}function ALe(t){var e,r=Lx(t);return r&&(e=r.href),e}function DLe(t){var e,r=Lx(t);return r&&(e=r[Gw]),e}function NLe(t,e){return t?t.toUpperCase()+" "+e:e}function gie(t,e){var r=RN(t,e)||"";if(r){var n=r.match(/(www\d{0,5}\.)?([^\/:]{1,256})(:\d{1,20})?/i);if(n!=null&&n[qt]>3&&Vt(n[2])&&n[2][qt]>0)return n[2]+(n[3]||"")}return r}function RN(t,e){var r=null;if(t){var n=t.match(/(\w{1,150}):\/\/([^\/:]{1,256})(:\d{1,20})?/i);if(n!=null&&n[qt]>2&&Vt(n[2])&&n[2][qt]>0&&(r=n[2]||"",e&&n[qt]>2)){var o=(n[1]||"")[_f](),s=n[3]||"";(o==="http"&&s===":80"||o==="https"&&s===":443")&&(s=""),r+=s}}return r}var kLe,PLe,mft,vie=A(()=>{un();Mo();kLe=yi()||{},PLe=0,mft=[null,null,null,null,null]});function kN(t){return Hr(hft,t[_f]())!==-1}function LLe(t){bie=t}function OLe(){return bie}function MLe(t,e,r){if(!e||t&&t.disableCorrelationHeaders)return!1;if(t&&t[die]){for(var n=0;n<t.correlationHeaderExcludePatterns[qt];n++)if(t[die][n].test(e))return!1}var o=Lx(e).host[_f]();if(o&&(Oa(o,":443")!==-1||Oa(o,":80")!==-1)&&(o=(RN(e,!0)||"")[_f]()),(!t||!t.enableCorsCorrelation)&&o&&o!==r)return!1;var s=t&&t.correlationHeaderDomains;if(s){var a;if(_e(s,function(l){var d=new RegExp(l.toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*"));a=a||d.test(o)}),!a)return!1}var c=t&&t.correlationHeaderExcludedDomains;if(!c||c[qt]===0)return!0;for(var n=0;n<c[qt];n++){var u=new RegExp(c[n].toLowerCase().replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*"));if(u.test(o))return!1}return o&&o[qt]>0}function FLe(t){if(t){var e=yie(t,Ex[1]);if(e&&e!==bie)return e}}function yie(t,e){if(t)for(var r=t[yh](","),n=0;n<r[qt];++n){var o=r[n][yh]("=");if(o[qt]===2&&o[0]===e)return o[1]}}function ULe(t,e,r,n){var o,s=n,a=n;if(e&&e[qt]>0){var c=Lx(e);if(o=c.host,!s)if(c[Gw]!=null){var u=c.pathname[qt]===0?"/":c[Gw];u.charAt(0)!=="/"&&(u="/"+u),a=c[Gw],s=yn(t,r?r+" "+u:u)}else s=yn(t,e)}else o=n,s=n;return{target:o,name:s,data:a}}function BLe(){var t=Zm();if(t&&t.now&&t.timing){var e=t.now()+t.timing.navigationStart;if(e>0)return e}return xi()}function qLe(t,e){var r=null;return t!==0&&e!==0&&!we(t)&&!we(e)&&(r=e-t),r}function jLe(t,e){var r=t||{};return{getName:function(){return r[ho]},setName:function(n){e&&e.setName(n),r[ho]=n},getTraceId:function(){return r.traceID},setTraceId:function(n){e&&e.setTraceId(n),cf(n)&&(r.traceID=n)},getSpanId:function(){return r.parentID},setSpanId:function(n){e&&e.setSpanId(n),uf(n)&&(r.parentID=n)},getTraceFlags:function(){return r.traceFlags},setTraceFlags:function(n){e&&e.setTraceFlags(n),r.traceFlags=n}}}var hft,bie,_ie=A(()=>{un();At();yl();uie();xl();vie();Mo();hft=[cb+yf,"https://breeze.aimon.applicationinsights.io"+yf,"https://dc-int.services.visualstudio.com"+yf],bie="cid-v1:"});var Ww,HLe,VLe,xie=A(()=>{un();Ww=po({LocalStorage:0,SessionStorage:1}),HLe=po({AI:0,AI_AND_W3C:1,W3C:2}),VLe=po({Normal:1,Critical:2})});function Sie(){return Kw()?KB(Ww.LocalStorage):null}function KB(t){try{if(we(ra()))return null;var e=new Date()[_h](),r=hn(t===Ww.LocalStorage?"localStorage":"sessionStorage"),n=GLe+e;r.setItem(n,e);var o=r.getItem(n)!==e;if(r[MB](n),!o)return r}catch{}return null}function Iie(){return Ox()?KB(Ww.SessionStorage):null}function zLe(){fb=!1,mb=!1}function YB(t){GLe=t||""}function $Le(){fb=Kw(!0),mb=Ox(!0)}function Kw(t){return(t||fb===void 0)&&(fb=!!KB(Ww.LocalStorage)),fb}function QB(t,e){var r=Sie();if(r!==null)try{return r.getItem(e)}catch(n){fb=!1,je(t,2,1,"Browser failed read of local storage. "+qn(n),{exception:tt(n)})}return null}function XB(t,e,r){var n=Sie();if(n!==null)try{return n.setItem(e,r),!0}catch(o){fb=!1,je(t,2,3,"Browser failed write to local storage. "+qn(o),{exception:tt(o)})}return!1}function WLe(t,e){var r=Sie();if(r!==null)try{return r[MB](e),!0}catch(n){fb=!1,je(t,2,5,"Browser failed removal of local storage item. "+qn(n),{exception:tt(n)})}return!1}function Ox(t){return(t||mb===void 0)&&(mb=!!KB(Ww.SessionStorage)),mb}function KLe(){var t=[];return Ox()&&ot(hn("sessionStorage"),function(e){t[xh](e)}),t}function JB(t,e){var r=Iie();if(r!==null)try{return r.getItem(e)}catch(n){mb=!1,je(t,2,2,"Browser failed read of session storage. "+qn(n),{exception:tt(n)})}return null}function ZB(t,e,r){var n=Iie();if(n!==null)try{return n.setItem(e,r),!0}catch(o){mb=!1,je(t,2,4,"Browser failed write to session storage. "+qn(o),{exception:tt(o)})}return!1}function YLe(t,e){var r=Iie();if(r!==null)try{return r[MB](e),!0}catch(n){mb=!1,je(t,2,6,"Browser failed removal of session storage item. "+qn(n),{exception:tt(n)})}return!1}var fb,mb,GLe,Cie=A(()=>{un();xie();Mo();fb=void 0,mb=void 0,GLe=""});var gft,QLe,XLe=A(()=>{un();At();Cie();Mo();gft="appInsightsThrottle",QLe=function(){function t(e,r){var n=this,o,s,a,c,u,l,d,p=!1,f=!1;h(),n._getDbgPlgTargets=function(){return[d]},n.getConfig=function(){return a},n.canThrottle=function(P){var k=le(P),U=g(P);return _(U,o,k)},n.isTriggered=function(P){return ne(P)},n.isReady=function(){return p},n.flush=function(P){try{var k=q(P);if(k&&k[qt]>0){var U=k.slice(0);return d[P]=[],_e(U,function(F){m(F.msgID,F[Id],F.severity,!1)}),!0}}catch{}return!1},n.flushAll=function(){try{if(d){var P=!0;return ot(d,function(k){var U=n.flush(parseInt(k));P=P&&U}),P}}catch{}return!1},n.onReadyState=function(P,k){return k===void 0&&(k=!0),p=we(P)?!0:P,p&&k?n.flushAll():null},n.sendMessage=function(P,k,U){return m(P,k,U,!0)};function m(P,k,U,F){if(p){var $=M(P);if(!$)return;var ce=g(P),Y=le(P),j=_(ce,o,Y),xe=!1,ee=0,vt=ne(P);try{j&&!vt?(ee=Math.min(ce.limit.maxSendNumber,Y[lb]+1),Y[lb]=0,xe=!0,u[P]=!0,Y[FB]=new Date):(u[P]=j,Y[lb]+=1);var We=x(P);R(s,We,Y);for(var Lt=0;Lt<ee;Lt++)V(P,s,k,U)}catch{}return{isThrottled:xe,throttleNum:ee}}else if(F){var br=q(P);br[xh]({msgID:P,message:k,severity:U})}return null}function h(){s=yd(e),u={},c={},d={},a={},v(109),l=of(r)?r:"",e.addUnloadHook(mo(e.config,function(P){var k=P.cfg;o=Kw();var U=k.throttleMgrCfg||{};ot(U,function(F,$){v(parseInt(F),$)})}))}function g(P){return a[P]||a[109]}function v(P,k){var U,F;try{var $=k||{},ce={};ce[UB]=!!$[UB];var Y=$[BB]||{};f=Y?.daysOfMonth&&Y?.daysOfMonth[qt]>0,ce[BB]=y(Y);var j={samplingRate:((U=$.limit)===null||U===void 0?void 0:U.samplingRate)||100,maxSendNumber:((F=$.limit)===null||F===void 0?void 0:F.maxSendNumber)||1};ce.limit=j,a[P]=ce}catch{}}function y(P){P=P||{};var k=P?.monthInterval,U=P?.dayInterval;return we(k)&&we(U)&&(P.monthInterval=3,f||(P[lie]=[28],f=!0)),P={monthInterval:P?.monthInterval,dayInterval:P?.dayInterval,daysOfMonth:P?.daysOfMonth},P}function _(P,k,U){if(P&&!P[UB]&&k&&of(U)){var F=E(),$=U[qB],ce=P[BB],Y=1;if(ce?.monthInterval){var j=(F.getUTCFullYear()-$.getUTCFullYear())*12+F.getUTCMonth()-$.getUTCMonth();Y=B(ce.monthInterval,0,j)}var xe=1;if(f)xe=Hr(ce[lie],F[jB]());else if(ce?.dayInterval){var ee=Math.floor((F.getTime()-$.getTime())/864e5);xe=B(ce.dayInterval,0,ee)}return Y>=0&&xe>=0}return!1}function x(P,k){var U=of(k)?k:"";return P?gft+U+"-"+P:null}function S(P){try{if(P){var k=new Date;return P.getUTCFullYear()===k.getUTCFullYear()&&P.getUTCMonth()===k.getUTCMonth()&&P[jB]()===k[jB]()}}catch{}return!1}function I(P,k,U){try{var F={date:E(),count:0};if(P){var $=JSON.parse(P),ce={date:E($[qB])||F[qB],count:$[lb]||F[lb],preTriggerDate:$.preTriggerDate?E($[FB]):void 0};return ce}else return R(k,U,F),F}catch{}return null}function E(P){try{if(P){var k=new Date(P);if(!isNaN(k.getDate()))return k}else return new Date}catch{}return null}function R(P,k,U){try{return XB(P,k,Yr(JSON[wx](U)))}catch{}return!1}function B(P,k,U){return P<=0?1:U>=k&&(U-k)%P==0?Math.floor((U-k)/P)+1:-1}function V(P,k,U,F){je(k,F||1,P,U)}function M(P){try{var k=g(P);return jD(1e6)<=k.limit.samplingRate}catch{}return!1}function le(P){try{var k=c[P];if(!k){var U=x(P,l);k=I(QB(s,U),s,U),c[P]=k}return c[P]}catch{}return null}function ne(P){var k=u[P];if(we(k)){k=!1;var U=le(P);U&&(k=S(U[FB])),u[P]=k}return u[P]}function q(P){return d=d||{},we(d[P])&&(d[P]=[]),d[P]}}return t}()});function PN(t){if(!t)return{};var e=t[yh](vft),r=YE(e,function(o,s){var a=s[yh](bft);if(a[qt]===2){var c=a[0][_f](),u=a[1];o[c]=u}return o},{});if(Ao(r)[qt]>0){if(r.endpointsuffix){var n=r.location?r.location+".":"";r[ub]=r[ub]||"https://"+n+"dc."+r.endpointsuffix}r[ub]=r[ub]||cb,L0(r[ub],"/")&&(r[ub]=r[ub].slice(0,-1))}return r}var vft,bft,JLe,ZLe=A(()=>{un();yl();Mo();vft=";",bft="=";JLe={parse:PN}});var eq,e4e=A(()=>{un();yl();Mo();xl();eq=function(){function t(e,r,n){var o=this,s=this;s.ver=1,s.sampleRate=100,s.tags={},s[ho]=yn(e,n)||Oo,s.data=r,s.time=tu(new Date),s.aiDataContract={time:1,iKey:1,name:1,sampleRate:function(){return o.sampleRate===100?4:1},tags:1,data:1}}return t}()});var Sf,t4e=A(()=>{yl();Mo();xl();Sf=function(){function t(e,r,n,o){this.aiDataContract={ver:1,name:1,properties:0,measurements:0};var s=this;s.ver=2,s[ho]=yn(e,r)||Oo,s[As]=aa(e,n),s[sa]=ca(e,o)}return t.envelopeType="Microsoft.ApplicationInsights.{0}.Event",t.dataType="EventData",t}()});function Rie(t,e){var r=t;return r&&!Vt(r)&&(JSON&&JSON[wx]?(r=JSON[wx](t),e&&(!r||r==="{}")&&(Et(t[_h])?r=t[_h]():r=""+t)):r=""+t+" - (Missing JSON.stringify)"),r||""}function s4e(t,e){var r=t;return t&&(r&&!Vt(r)&&(r=t[wie]||t[o4e]||r),r&&!Vt(r)&&(r=Rie(r,!0)),t.filename&&(r=r+" @"+(t.filename||"")+":"+(t.lineno||"?")+":"+(t.colno||"?"))),e&&e!=="String"&&e!=="Object"&&e!=="Error"&&Oa(r||"",e)===-1&&(r=e+": "+r),r||""}function _ft(t){try{if(Bn(t))return"hasFullStack"in t&&"typeName"in t}catch{}return!1}function xft(t){try{if(Bn(t))return"ver"in t&&"exceptions"in t&&"properties"in t}catch{}return!1}function n4e(t){return t&&t.src&&Vt(t.src)&&t.obj&&mt(t.obj)}function Mx(t){var e=t||"";Vt(e)||(Vt(e[Tc])?e=e[Tc]:e=""+e);var r=e[yh](`
`);return{src:e,obj:r}}function Sft(t){for(var e=[],r=t[yh](`
`),n=0;n<r[qt];n++){var o=r[n];r[n+1]&&(o+="@"+r[n+1],n++),e[xh](o)}return{src:t,obj:e}}function a4e(t){var e=null;if(t)try{if(t[Tc])e=Mx(t[Tc]);else if(t[Yw]&&t[Yw][Tc])e=Mx(t[Yw][Tc]);else if(t.exception&&t.exception[Tc])e=Mx(t.exception[Tc]);else if(n4e(t))e=t;else if(n4e(t[Eie]))e=t[Eie];else if(_i()&&_i().opera&&t[wie])e=Sft(t[Id]);else if(t.reason&&t.reason[Tc])e=Mx(t.reason[Tc]);else if(Vt(t))e=Mx(t);else{var r=t[wie]||t[o4e]||"";Vt(t[r4e])&&(r&&(r+=`
`),r+=" from "+t[r4e]),r&&(e=Mx(r))}}catch(n){e=Mx(n)}return e||{src:"",obj:null}}function Ift(t){var e="";return t&&(t.obj?_e(t.obj,function(r){e+=r+`
`}):e=t.src||""),e}function Cft(t){var e,r=t.obj;if(r&&r[qt]>0){e=[];var n=0,o=0;_e(r,function(h){var g=h[_h]();if(kie.regex.test(g)){var v=new kie(g,n++);o+=v[kx],e[xh](v)}});var s=32*1024;if(o>s)for(var a=0,c=e[qt]-1,u=0,l=a,d=c;a<c;){var p=e[a][kx],f=e[c][kx];if(u+=p+f,u>s){var m=d-l+1;e.splice(l,m);break}l=a,d=c,a++,c--}}return e}function tq(t){var e="";if(t&&(e=t.typeName||t[ho]||"",!e))try{var r=/function (.{1,200})\(/,n=r.exec(t.constructor[_h]());e=n&&n[qt]>1?n[1]:""}catch{}return e}function Tie(t){if(t)try{if(!Vt(t)){var e=tq(t),r=Rie(t,!1);return(!r||r==="{}")&&(t[Yw]&&(t=t[Yw],e=tq(t)),r=Rie(t,!0)),Oa(r,e)!==0&&e!=="String"?e+":"+r:r}}catch{}return""+(t||"")}var yft,Yw,Tc,Eie,r4e,wie,o4e,hb,i4e,kie,c4e=A(()=>{hc();un();At();yl();Mo();xl();yft="<no_method>",Yw="error",Tc="stack",Eie="stackDetails",r4e="errorSrc",wie="message",o4e="description";hb=function(){function t(e,r,n,o,s,a){this.aiDataContract={ver:1,exceptions:1,severityLevel:0,properties:0,measurements:0};var c=this;c.ver=2,xft(r)?(c[Rx]=r[Rx]||[],c[As]=r[As],c[sa]=r[sa],r[Px]&&(c[Px]=r[Px]),r.id&&(c.id=r.id,r[As].id=r.id),r[HB]&&(c[HB]=r[HB]),we(r[VB])||(c[VB]=r[VB])):(n||(n={}),a&&(n.id=a),c[Rx]=[new i4e(e,r,n)],c[As]=aa(e,n),c[sa]=ca(e,o),s&&(c[Px]=s),a&&(c.id=a))}return t.CreateAutoException=function(e,r,n,o,s,a,c,u){var l,d=tq(s||a||e);return l={},l[Id]=s4e(e,d),l.url=r,l.lineNumber=n,l.columnNumber=o,l.error=Tie(s||a||e),l.evt=Tie(a||e),l[xf]=d,l.stackDetails=a4e(c||s||a),l.errorSrc=u,l},t.CreateFromInterface=function(e,r,n,o){var s=r[Rx]&&Qp(r[Rx],function(c){return i4e[pie](e,c)}),a=new t(e,pl(pl({},r),{exceptions:s}),n,o);return a},t.prototype.toInterface=function(){var e,r=this,n=r.exceptions,o=r.properties,s=r.measurements,a=r.severityLevel,c=r.problemGroup,u=r.id,l=r.isManual,d=n instanceof Array&&Qp(n,function(p){return p.toInterface()})||void 0;return e={ver:"4.0"},e[Rx]=d,e.severityLevel=a,e.properties=o,e.measurements=s,e.problemGroup=c,e.id=u,e.isManual=l,e},t.CreateSimpleException=function(e,r,n,o,s,a){var c;return{exceptions:[(c={},c[EN]=!0,c.message=e,c.stack=s,c.typeName=r,c)]}},t.envelopeType="Microsoft.ApplicationInsights.{0}.Exception",t.dataType="ExceptionData",t.formatError=Tie,t}(),i4e=function(){function t(e,r,n){this.aiDataContract={id:0,outerId:0,typeName:1,message:1,hasFullStack:0,stack:0,parsedStack:2};var o=this;if(_ft(r))o[xf]=r[xf],o[Id]=r[Id],o[Tc]=r[Tc],o[_l]=r[_l]||[],o[EN]=r[EN];else{var s=r,a=s&&s.evt;T0(s)||(s=s[Yw]||a||s),o[xf]=yn(e,tq(s))||Oo,o[Id]=$w(e,s4e(r||s,o[xf]))||Oo;var c=r[Eie]||a4e(r);o[_l]=Cft(c),mt(o[_l])&&Qp(o[_l],function(u){u[Ax]=yn(e,u[Ax]),u[db]=yn(e,u[db])}),o[Tc]=zB(e,Ift(c)),o.hasFullStack=mt(o.parsedStack)&&o.parsedStack[qt]>0,n&&(n[xf]=n[xf]||o[xf])}}return t.prototype.toInterface=function(){var e,r=this,n=r[_l]instanceof Array&&Qp(r[_l],function(s){return s.toInterface()}),o=(e={id:r.id,outerId:r.outerId,typeName:r[xf],message:r[Id],hasFullStack:r[EN],stack:r[Tc]},e[_l]=n||void 0,e);return o},t.CreateFromInterface=function(e,r){var n=r[_l]instanceof Array&&Qp(r[_l],function(s){return kie[pie](s)})||r[_l],o=new t(e,pl(pl({},r),{parsedStack:n}));return o},t}(),kie=function(){function t(e,r){this.aiDataContract={level:1,method:1,assembly:0,fileName:0,line:0};var n=this;if(n[kx]=0,typeof e=="string"){var o=e;n[wN]=r,n[Dx]=yft,n[Ax]=Yr(o),n[db]="",n[zw]=0;var s=o.match(t.regex);s&&s[qt]>=5&&(n[Dx]=Yr(s[2])||n[Dx],n[db]=Yr(s[4]),n[zw]=parseInt(s[5])||0)}else n[wN]=e[wN],n[Dx]=e[Dx],n[Ax]=e[Ax],n[db]=e[db],n[zw]=e[zw],n[kx]=0;n.sizeInBytes+=n.method[qt],n.sizeInBytes+=n.fileName[qt],n.sizeInBytes+=n.assembly[qt],n[kx]+=t.baseSize,n.sizeInBytes+=n.level.toString()[qt],n.sizeInBytes+=n.line.toString()[qt]}return t.CreateFromInterface=function(e){return new t(e,null)},t.prototype.toInterface=function(){var e=this;return{level:e[wN],method:e[Dx],assembly:e[Ax],fileName:e[db],line:e[zw]}},t.regex=/^([\s]+at)?[\s]{0,50}([^\@\()]+?)[\s]{0,50}(\@|\()([^\(\n]+):([0-9]+):([0-9]+)(\)?)$/,t.baseSize=58,t}()});var u4e,l4e=A(()=>{u4e=function(){function t(){this.aiDataContract={name:1,kind:0,value:1,count:0,min:0,max:0,stdDev:0},this.kind=0}return t}()});var If,d4e=A(()=>{yl();Mo();l4e();xl();If=function(){function t(e,r,n,o,s,a,c,u,l){this.aiDataContract={ver:1,metrics:1,properties:0};var d=this;d.ver=2;var p=new u4e;p[lb]=o>0?o:void 0,p.max=isNaN(a)||a===null?void 0:a,p.min=isNaN(s)||s===null?void 0:s,p[ho]=yn(e,r)||Oo,p.value=n,p.stdDev=isNaN(c)||c===null?void 0:c,d.metrics=[p],d[As]=aa(e,u),d[sa]=ca(e,l)}return t.envelopeType="Microsoft.ApplicationInsights.{0}.Metric",t.dataType="MetricData",t}()});function p4e(t,e){return e===void 0&&(e=!1),t==null?e:t.toString()[_f]()==="true"}function Qw(t){(isNaN(t)||t<0)&&(t=0),t=Math.round(t);var e=AN+t%1e3,r=AN+Math.floor(t/1e3)%60,n=AN+Math.floor(t/(1e3*60))%60,o=AN+Math.floor(t/(1e3*60*60))%24,s=Math.floor(t/(1e3*60*60*24));return e=e[qt]===1?"00"+e:e[qt]===2?"0"+e:e,r=r[qt]<2?"0"+r:r,n=n[qt]<2?"0"+n:n,o=o[qt]<2?"0"+o:o,(s>0?s+".":AN)+o+":"+n+":"+r+"."+e}function f4e(t,e){var r=null;return _e(t,function(n){if(n.identifier===e)return r=n,-1}),r}function m4e(t,e,r,n,o){return!o&&Vt(t)&&(t==="Script error."||t==="Script error")}var AN,rq=A(()=>{un();Mo();AN=""});var gb,h4e=A(()=>{yl();rq();Mo();xl();gb=function(){function t(e,r,n,o,s,a,c){this.aiDataContract={ver:1,name:0,url:0,duration:0,properties:0,measurements:0,id:0};var u=this;u.ver=2,u.id=$B(e,c),u.url=pb(e,n),u[ho]=yn(e,r)||Oo,isNaN(o)||(u[Nx]=Qw(o)),u[As]=aa(e,s),u[sa]=ca(e,a)}return t.envelopeType="Microsoft.ApplicationInsights.{0}.Pageview",t.dataType="PageviewData",t}()});var vb,g4e=A(()=>{rq();_ie();Mo();xl();vb=function(){function t(e,r,n,o,s,a,c,u,l,d,p,f){l===void 0&&(l="Ajax"),this.aiDataContract={id:1,ver:1,name:0,resultCode:0,duration:0,success:0,data:0,target:0,type:0,properties:0,measurements:0,kind:0,value:0,count:0,min:0,max:0,stdDev:0,dependencyKind:0,dependencySource:0,commandName:0,dependencyTypeName:0};var m=this;m.ver=2,m.id=r,m[Nx]=Qw(s),m.success=a,m.resultCode=c+"",m.type=yn(e,l);var h=ULe(e,n,u,o);m.data=pb(e,o)||h.data,m.target=yn(e,h.target),d&&(m.target="".concat(m.target," | ").concat(d)),m[ho]=yn(e,h[ho]),m[As]=aa(e,p),m[sa]=ca(e,f)}return t.envelopeType="Microsoft.ApplicationInsights.{0}.RemoteDependency",t.dataType="RemoteDependencyData",t}()});var bb,v4e=A(()=>{yl();Mo();xl();bb=function(){function t(e,r,n,o,s){this.aiDataContract={ver:1,message:1,severityLevel:0,properties:0};var a=this;a.ver=2,r=r||Oo,a[Id]=$w(e,r),a[As]=aa(e,o),a[sa]=ca(e,s),n&&(a[Px]=n)}return t.envelopeType="Microsoft.ApplicationInsights.{0}.Message",t.dataType="MessageData",t}()});var yb,b4e=A(()=>{yl();Mo();xl();yb=function(){function t(e,r,n,o,s,a,c){this.aiDataContract={ver:1,name:0,url:0,duration:0,perfTotal:0,networkConnect:0,sentRequest:0,receivedResponse:0,domProcessing:0,properties:0,measurements:0};var u=this;u.ver=2,u.url=pb(e,n),u[ho]=yn(e,r)||Oo,u[As]=aa(e,s),u[sa]=ca(e,a),c&&(u.domProcessing=c.domProcessing,u[Nx]=c[Nx],u.networkConnect=c.networkConnect,u.perfTotal=c.perfTotal,u[fie]=c[fie],u.sentRequest=c.sentRequest)}return t.envelopeType="Microsoft.ApplicationInsights.{0}.PageviewPerformance",t.dataType="PageviewPerformanceData",t}()});var Cf,y4e=A(()=>{Cf=function(){function t(e,r){this.aiDataContract={baseType:1,baseData:1},this.baseType=e,this.baseData=r}return t}()});var nq,_4e=A(()=>{un();nq=po({Verbose:0,Information:1,Warning:2,Error:3,Critical:4})});var x4e,S4e=A(()=>{un();Mo();x4e=function(){function t(){}return t.getConfig=function(e,r,n,o){o===void 0&&(o=!1);var s;return n&&e[TN]&&e[TN][n]&&!we(e[TN][n][r])?s=e[TN][n][r]:s=e[r],we(s)?o:s},t}()});function xb(t){var e="ai."+t+".";return function(r){return e+r}}var DN,Fo,iq,Xw,Pie,_b,Fx,NN,Jw,Aie=A(()=>{hc();un();DN=xb("application"),Fo=xb("device"),iq=xb("location"),Xw=xb("operation"),Pie=xb("session"),_b=xb("user"),Fx=xb("cloud"),NN=xb("internal"),Jw=function(t){mc(e,t);function e(){return t.call(this)||this}return e}(Vre({applicationVersion:DN("ver"),applicationBuild:DN("build"),applicationTypeId:DN("typeId"),applicationId:DN("applicationId"),applicationLayer:DN("layer"),deviceId:Fo("id"),deviceIp:Fo("ip"),deviceLanguage:Fo("language"),deviceLocale:Fo("locale"),deviceModel:Fo("model"),deviceFriendlyName:Fo("friendlyName"),deviceNetwork:Fo("network"),deviceNetworkName:Fo("networkName"),deviceOEMName:Fo("oemName"),deviceOS:Fo("os"),deviceOSVersion:Fo("osVersion"),deviceRoleInstance:Fo("roleInstance"),deviceRoleName:Fo("roleName"),deviceScreenResolution:Fo("screenResolution"),deviceType:Fo("type"),deviceMachineName:Fo("machineName"),deviceVMName:Fo("vmName"),deviceBrowser:Fo("browser"),deviceBrowserVersion:Fo("browserVersion"),locationIp:iq("ip"),locationCountry:iq("country"),locationProvince:iq("province"),locationCity:iq("city"),operationId:Xw("id"),operationName:Xw("name"),operationParentId:Xw("parentId"),operationRootId:Xw("rootId"),operationSyntheticSource:Xw("syntheticSource"),operationCorrelationVector:Xw("correlationVector"),sessionId:Pie("id"),sessionIsFirst:Pie("isFirst"),sessionIsNew:Pie("isNew"),userAccountAcquisitionDate:_b("accountAcquisitionDate"),userAccountId:_b("accountId"),userAgent:_b("userAgent"),userId:_b("id"),userStoreRegion:_b("storeRegion"),userAuthUserId:_b("authUserId"),userAnonymousUserAcquisitionDate:_b("anonUserAcquisitionDate"),userAuthenticatedUserAcquisitionDate:_b("authUserAcquisitionDate"),cloudName:Fx("name"),cloudRole:Fx("role"),cloudRoleVer:Fx("roleVer"),cloudRoleInstance:Fx("roleInstance"),cloudEnvironment:Fx("environment"),cloudLocation:Fx("location"),cloudDeploymentUnit:Fx("deploymentUnit"),internalNodeName:NN("nodeName"),internalSdkVersion:NN("sdkVersion"),internalAgentVersion:NN("agentVersion"),internalSnippet:NN("snippet"),internalSdkSrc:NN("sdkSrc")}))});function Die(t,e,r,n,o,s){var a;r=yn(n,r)||Oo,(we(t)||we(e)||we(r))&&bi("Input doesn't contain all required fields");var c="";t[OB]&&(c=t[OB],delete t[OB]);var u=(a={},a[ho]=r,a.time=tu(new Date),a.iKey=c,a.ext=s||{},a.tags=[],a.data={},a.baseType=e,a.baseData=t,a);return we(o)||ot(o,function(l,d){u.data[l]=d}),u}var I4e,C4e=A(()=>{un();yl();xl();Mo();I4e=function(){function t(){}return t.create=Die,t}()});var T4e,go,E4e=A(()=>{Aie();T4e={UserExt:"user",DeviceExt:"device",TraceExt:"trace",WebExt:"web",AppExt:"app",OSExt:"os",SessionExt:"ses",SDKExt:"sdk"},go=new Jw});function w4e(t){var e=null;if(Et(Event))e=new Event(t);else{var r=yi();r&&r.createEvent&&(e=r.createEvent("Event"),e.initEvent(t,!0,!0))}return e}var R4e=A(()=>{un()});function k4e(t,e){gh(t,null,null,e)}function oq(t){var e=yi(),r=lo(),n=!1,o=[],s=1;r&&!we(r.onLine)&&!r.onLine&&(s=2);var a=0,c=f(),u=nu(Ps("OfflineListener"),t);try{if(d(_i())&&(n=!0),e){var l=e.body||e;l.ononline&&d(l)&&(n=!0)}}catch{n=!1}function d(x){var S=!1;return x&&(S=df(x,"online",g,u),S&&df(x,"offline",v,u)),S}function p(){return c}function f(){return!(a===2||s===2)}function m(){var x=f();c!==x&&(c=x,_e(o,function(S){var I={isOnline:c,rState:s,uState:a};try{S(I)}catch{}}))}function h(x){a=x,m()}function g(){s=1,m()}function v(){s=2,m()}function y(){var x=_i();if(x&&n){if(k4e(x,u),e){var S=e.body||e;Ut(S.ononline)||k4e(S,u)}n=!1}}function _(x){return o[xh](x),{rm:function(){var S=o.indexOf(x);if(S>-1)return o.splice(S,1)}}}return{isOnline:p,isListening:function(){return n},unload:y,addListener:_,setOnlineState:h}}var P4e=A(()=>{un();Mo()});var A4e={};_n(A4e,{AnalyticsPluginIdentifier:()=>Eft,BreezeChannelIdentifier:()=>Nie,ConfigurationManager:()=>x4e,ConnectionStringParser:()=>JLe,ContextTagKeys:()=>Jw,CtxTagKeys:()=>go,DEFAULT_BREEZE_ENDPOINT:()=>cb,DEFAULT_BREEZE_PATH:()=>yf,Data:()=>Cf,DisabledPropertyName:()=>RLe,DistributedTracingModes:()=>HLe,Envelope:()=>eq,Event:()=>Sf,EventPersistence:()=>VLe,Exception:()=>hb,Extensions:()=>T4e,HttpMethod:()=>CN,Metric:()=>If,PageView:()=>gb,PageViewPerformance:()=>yb,ProcessLegacy:()=>Vw,PropertiesPluginIdentifier:()=>Tft,RemoteDependencyData:()=>vb,RequestHeaders:()=>Ex,SampleRate:()=>Hw,SeverityLevel:()=>nq,TelemetryItemCreator:()=>I4e,ThrottleMgr:()=>QLe,Trace:()=>bb,correlationIdCanIncludeCorrelationHeader:()=>MLe,correlationIdGetCorrelationContext:()=>FLe,correlationIdGetCorrelationContextValue:()=>yie,correlationIdGetPrefix:()=>OLe,correlationIdSetPrefix:()=>LLe,createDistributedTraceContextFromTrace:()=>jLe,createDomEvent:()=>w4e,createOfflineListener:()=>oq,createTelemetryItem:()=>Die,createTraceParent:()=>eN,dataSanitizeException:()=>zB,dataSanitizeId:()=>$B,dataSanitizeInput:()=>WB,dataSanitizeKey:()=>mie,dataSanitizeKeyAndAddUniqueness:()=>GB,dataSanitizeMeasurements:()=>ca,dataSanitizeMessage:()=>$w,dataSanitizeProperties:()=>aa,dataSanitizeString:()=>yn,dataSanitizeUrl:()=>pb,dateTimeUtilsDuration:()=>qLe,dateTimeUtilsNow:()=>BLe,dsPadNumber:()=>hie,findW3cTraceParent:()=>nN,formatTraceParent:()=>rN,getExtensionByName:()=>f4e,isBeaconApiSupported:()=>Sc,isCrossOriginError:()=>m4e,isInternalApplicationInsightsEndpoint:()=>kN,isSampledFlag:()=>tN,isValidSpanId:()=>uf,isValidTraceId:()=>cf,isValidTraceParent:()=>Tw,msToTimeSpan:()=>Qw,parseConnectionString:()=>PN,parseTraceParent:()=>px,strNotSpecified:()=>Oo,stringToBoolOrDefault:()=>p4e,urlGetAbsoluteUrl:()=>ALe,urlGetCompleteUrl:()=>NLe,urlGetPathName:()=>DLe,urlParseFullHost:()=>RN,urlParseHost:()=>gie,urlParseUrl:()=>Lx,utlCanUseLocalStorage:()=>Kw,utlCanUseSessionStorage:()=>Ox,utlDisableStorage:()=>zLe,utlEnableStorage:()=>$Le,utlGetLocalStorage:()=>QB,utlGetSessionStorage:()=>JB,utlGetSessionStorageKeys:()=>KLe,utlRemoveSessionStorage:()=>YLe,utlRemoveStorage:()=>WLe,utlSetLocalStorage:()=>XB,utlSetSessionStorage:()=>ZB,utlSetStoragePrefix:()=>YB});var Tft,Nie,Eft,Sh=A(()=>{_ie();XLe();ZLe();uie();yl();e4e();t4e();c4e();d4e();h4e();g4e();v4e();b4e();y4e();_4e();S4e();Aie();xl();C4e();E4e();xie();rq();un();R4e();Cie();vie();P4e();Tft="AppInsightsPropertiesPlugin",Nie="AppInsightsChannelPlugin",Eft="ApplicationInsightsAnalytics"});var Sb,D4e=A(()=>{Sb="duration"});var vo,sq,Ds,Tf,Ux,nr,Ib,Cb,Sl,Tb,Ih,Zw,Ch,Th,aq,Eh,LN,Eb,ON,eR,Bx,MN,cq,wh,tR,rR,Ns,uq,nR,lq,Lie,dq,pq,Oie,fq,Mie,Rh,Fie,Uie,Bie,qie,FN,jie,Hie,Vie,iR,wb,mq,UN,hq,N4e,gq,vq,oR,Gie,bq,L4e,Rb=A(()=>{vo="tags",sq="deviceType",Ds="data",Tf="name",Ux="traceID",nr="length",Ib="stringify",Cb="measurements",Sl="dataType",Tb="envelopeType",Ih="toString",Zw="_get",Ch="enqueue",Th="count",aq="eventsLimitInMem",Eh="push",LN="emitLineDelimitedJson",Eb="clear",ON="createNew",eR="markAsSent",Bx="clearSent",MN="bufferOverride",cq="BUFFER_KEY",wh="SENT_BUFFER_KEY",tR="MAX_BUFFER_SIZE",rR="triggerSend",Ns="diagLog",uq="initialize",nR="_sender",lq="customHeaders",Lie="maxBatchSizeInBytes",dq="onunloadDisableBeacon",pq="isBeaconApiDisabled",Oie="alwaysUseXhrOverride",fq="disableXhr",Mie="enableSessionStorageBuffer",Rh="_buffer",Fie="onunloadDisableFetch",Uie="disableSendBeaconSplit",Bie="instrumentationKey",qie="enableSendPromise",FN="getSenderInst",jie="unloadTransports",Hie="convertUndefined",Vie="maxBatchInterval",iR="serialize",wb="_onError",mq="_onPartialSuccess",UN="_onSuccess",hq="itemsAccepted",N4e="itemsReceived",gq="oriPayload",vq="baseType",oR="sampleRate",Gie="eventsSendRequest",bq="getSamplingScore",L4e="getHashCodeScore"});function bo(t,e,r){return hl(t,e,r,al)}function wft(t,e,r){var n=r[vo]=r[vo]||{},o=e.ext=e.ext||{},s=e[vo]=e[vo]||[],a=o.user;a&&(bo(n,go.userAuthUserId,a.authId),bo(n,go.userId,a.id||a.localId));var c=o.app;c&&bo(n,go.sessionId,c.sesId);var u=o.device;u&&(bo(n,go.deviceId,u.id||u.localId),bo(n,go[sq],u.deviceClass),bo(n,go.deviceIp,u.ip),bo(n,go.deviceModel,u.model),bo(n,go[sq],u[sq]));var l=e.ext.web;if(l){bo(n,go.deviceLanguage,l.browserLang),bo(n,go.deviceBrowserVersion,l.browserVer),bo(n,go.deviceBrowser,l.browser);var d=r[Ds]=r[Ds]||{},p=d[oi]=d[oi]||{},f=p[ss]=p[ss]||{};bo(f,"domain",l.domain),bo(f,"isManual",l.isManual?O4e:null),bo(f,"screenRes",l.screenRes),bo(f,"userConsent",l.userConsent?O4e:null)}var m=o.os;m&&bo(n,go.deviceOS,m[Tf]);var h=o.trace;h&&(bo(n,go.operationParentId,h.parentID),bo(n,go.operationName,yn(t,h[Tf])),bo(n,go.operationId,h[Ux]));for(var g={},v=s[nr]-1;v>=0;v--){var y=s[v];ot(y,function(x,S){g[x]=S}),s.splice(v,1)}ot(s,function(x,S){g[x]=S});var _=pl(pl({},n),g);_[go.internalSdkVersion]||(_[go.internalSdkVersion]=yn(t,"javascript:".concat(Rft.Version),64)),r[vo]=gl(_)}function kb(t,e,r){we(t)||ot(t,function(n,o){ta(o)?r[n]=o:Vt(o)?e[n]=o:rf()&&(e[n]=ks()[Ib](o))})}function qx(t,e){we(t)||ot(t,function(r,n){t[r]=n||e})}function jx(t,e,r,n){var o=new eq(t,n,e);bo(o,"sampleRate",r[Hw]),(r[oi]||{}).startTime&&(o.time=tu(r[oi].startTime)),o.iKey=r.iKey;var s=r.iKey.replace(/-/g,"");return o[Tf]=o[Tf].replace("{0}",s),wft(t,r,o),r[vo]=r[vo]||[],gl(o)}function Hx(t,e){we(e[oi])&&je(t,1,46,"telemetryItem.baseData cannot be null.")}function M4e(t,e,r){Hx(t,e);var n=e[oi][Cb]||{},o=e[oi][ss]||{};kb(e[Ds],o,n),we(r)||qx(o,r);var s=e[oi];if(we(s))return Fa(t,"Invalid input for dependency data"),null;var a=s[ss]&&s[ss][CN]?s[ss][CN]:"GET",c=new vb(t,s.id,s.target,s[Tf],s[Sb],s.success,s.responseCode,a,s.type,s.correlationContext,o,n),u=new Cf(vb[Sl],c);return jx(t,vb[Tb],e,u)}function $ie(t,e,r){Hx(t,e);var n={},o={};e[zie]!==Sf[Sl]&&(n.baseTypeSource=e[zie]),e[zie]===Sf[Sl]?(n=e[oi][ss]||{},o=e[oi][Cb]||{}):e[oi]&&kb(e[oi],n,o),kb(e[Ds],n,o),we(r)||qx(n,r);var s=e[oi][Tf],a=new Sf(t,s,n,o),c=new Cf(Sf[Sl],a);return jx(t,Sf[Tb],e,c)}function F4e(t,e,r){Hx(t,e);var n=e[oi][Cb]||{},o=e[oi][ss]||{};kb(e[Ds],o,n),we(r)||qx(o,r);var s=e[oi],a=hb.CreateFromInterface(t,s,o,n),c=new Cf(hb[Sl],a);return jx(t,hb[Tb],e,c)}function U4e(t,e,r){Hx(t,e);var n=e[oi],o=n[ss]||{},s=n[Cb]||{};kb(e[Ds],o,s),we(r)||qx(o,r);var a=new If(t,n[Tf],n.average,n.sampleCount,n.min,n.max,n.stdDev,o,s),c=new Cf(If[Sl],a);return jx(t,If[Tb],e,c)}function B4e(t,e,r){Hx(t,e);var n,o=e[oi];!we(o)&&!we(o[ss])&&!we(o[ss][Sb])?(n=o[ss][Sb],delete o[ss][Sb]):!we(e[Ds])&&!we(e[Ds][Sb])&&(n=e[Ds][Sb],delete e[Ds][Sb]);var s=e[oi],a;((e.ext||{}).trace||{})[Ux]&&(a=e.ext.trace[Ux]);var c=s.id||a,u=s[Tf],l=s.uri,d=s[ss]||{},p=s[Cb]||{};if(we(s.refUri)||(d.refUri=s.refUri),we(s.pageType)||(d.pageType=s.pageType),we(s.isLoggedIn)||(d.isLoggedIn=s.isLoggedIn[Ih]()),!we(s[ss])){var f=s[ss];ot(f,function(g,v){d[g]=v})}kb(e[Ds],d,p),we(r)||qx(d,r);var m=new gb(t,u,l,n,d,p,c),h=new Cf(gb[Sl],m);return jx(t,gb[Tb],e,h)}function q4e(t,e,r){Hx(t,e);var n=e[oi],o=n[Tf],s=n.uri||n.url,a=n[ss]||{},c=n[Cb]||{};kb(e[Ds],a,c),we(r)||qx(a,r);var u=new yb(t,o,s,void 0,a,c,n),l=new Cf(yb[Sl],u);return jx(t,yb[Tb],e,l)}function j4e(t,e,r){Hx(t,e);var n=e[oi].message,o=e[oi].severityLevel,s=e[oi][ss]||{},a=e[oi][Cb]||{};kb(e[Ds],s,a),we(r)||qx(s,r);var c=new bb(t,n,o,s,a),u=new Cf(bb[Sl],c);return jx(t,bb[Tb],e,u)}var zie,oi,ss,O4e,Rft,H4e=A(()=>{hc();Sh();un();D4e();Rb();zie="baseType",oi="baseData",ss="properties",O4e="true";Rft={Version:"3.1.1"}});var V4e,yq,Wie,G4e=A(()=>{hc();ns();Sh();un();Rb();V4e=function(){function t(e,r){var n=[],o=!1;this[Zw]=function(){return n},this._set=function(s){return n=s,n},mr(t,this,function(s){s[Ch]=function(a){if(s[Th]()>=r[aq]){o||(je(e,2,105,"Maximum in-memory buffer size reached: "+s[Th](),!0),o=!0);return}n[Eh](a)},s[Th]=function(){return n[nr]},s.size=function(){for(var a=n[nr],c=0;c<n[nr];c++)a+=n[c][nr];return r[LN]||(a+=2),a},s[Eb]=function(){n=[],o=!1},s.getItems=function(){return n.slice(0)},s.batchPayloads=function(a){if(a&&a[nr]>0){var c=r[LN]?a.join(`
`):"["+a.join(",")+"]";return c}return null},s[ON]=function(a,c,u){var l=n.slice(0);a=a||e,c=c||{};var d=u?new Wie(a,c):new yq(a,c);return _e(l,function(p){d[Ch](p)}),d}})}return t.__ieDyn=1,t}(),yq=function(t){mc(e,t);function e(r,n){var o=t.call(this,r,n)||this;return mr(e,o,function(s,a){s[eR]=function(c){a[Eb]()},s[Bx]=function(c){}}),o}return e.__ieDyn=1,e}(V4e),Wie=function(t){mc(e,t);function e(r,n){var o=t.call(this,r,n)||this,s=!1,a=n?.namePrefix,c=n[MN]||{getItem:JB,setItem:ZB},u=c.getItem,l=c.setItem;return mr(e,o,function(d,p){var f=v(e[cq]),m=v(e[wh]),h=d._set(f.concat(m));h[nr]>e[tR]&&(h[nr]=e[tR]),y(e[wh],[]),y(e[cq],h),d[Ch]=function(_){if(d[Th]()>=e[tR]){s||(je(r,2,67,"Maximum buffer size reached: "+d[Th](),!0),s=!0);return}p[Ch](_),y(e.BUFFER_KEY,d[Zw]())},d[Eb]=function(){p[Eb](),y(e.BUFFER_KEY,d[Zw]()),y(e[wh],[]),s=!1},d[eR]=function(_){y(e[cq],d._set(g(_,d[Zw]())));var x=v(e[wh]);x instanceof Array&&_ instanceof Array&&(x=x.concat(_),x[nr]>e[tR]&&(je(r,1,67,"Sent buffer reached its maximum size: "+x[nr],!0),x[nr]=e[tR]),y(e[wh],x))},d[Bx]=function(_){var x=v(e[wh]);x=g(_,x),y(e[wh],x)},d[ON]=function(_,x,S){S=!!S;var I=d[Zw]().slice(0),E=v(e[wh]).slice(0);_=_||r,x=x||{},d[Eb]();var R=S?new e(_,x):new yq(_,x);return _e(I,function(B){R[Ch](B)}),S&&R[eR](E),R};function g(_,x){var S=[];return _e(x,function(I){!Et(I)&&Hr(_,I)===-1&&S[Eh](I)}),S}function v(_){var x=_;try{x=a?a+"_"+x:x;var S=u(r,x);if(S){var I=ks().parse(S);if(Vt(I)&&(I=ks().parse(I)),I&&mt(I))return I}}catch(E){je(r,1,42," storage key: "+x+", "+qn(E),{exception:tt(E)})}return[]}function y(_,x){var S=_;try{S=a?a+"_"+S:S;var I=JSON[Ib](x);l(r,S,I)}catch(E){l(r,S,JSON[Ib]([])),je(r,2,41," storage key: "+S+", "+qn(E)+". Buffer cleared",{exception:tt(E)})}}}),o}return e.BUFFER_KEY="AI_buffer",e.SENT_BUFFER_KEY="AI_sentBuffer",e.MAX_BUFFER_SIZE=2e3,e}(V4e)});var z4e,$4e=A(()=>{ns();un();Rb();z4e=function(){function t(e){mr(t,this,function(r){r[iR]=function(a){var c=n(a,"root");try{return ks()[Ib](c)}catch(u){je(e,1,48,u&&Et(u[Ih])?u[Ih]():"Error serializing object",null,!0)}};function n(a,c){var u="__aiCircularRefCheck",l={};if(!a)return je(e,1,48,"cannot serialize object because it is null or undefined",{name:c},!0),l;if(a[u])return je(e,2,50,"Circular reference detected while serializing object",{name:c},!0),l;if(!a.aiDataContract){if(c==="measurements")l=s(a,"number",c);else if(c==="properties")l=s(a,"string",c);else if(c==="tags")l=s(a,"string",c);else if(mt(a))l=o(a,c);else{je(e,2,49,"Attempting to serialize an object which does not implement ISerializable",{name:c},!0);try{ks()[Ib](a),l=a}catch(d){je(e,1,48,d&&Et(d[Ih])?d[Ih]():"Error serializing object",null,!0)}}return l}return a[u]=!0,ot(a.aiDataContract,function(d,p){var f=Et(p)?p()&1:p&1,m=Et(p)?p()&4:p&4,h=p&2,g=a[d]!==void 0,v=Bn(a[d])&&a[d]!==null;if(f&&!g&&!h)je(e,1,24,"Missing required field specification. The field is required but not present on source",{field:d,name:c});else if(!m){var y=void 0;v?h?y=o(a[d],d):y=n(a[d],d):y=a[d],y!==void 0&&(l[d]=y)}}),delete a[u],l}function o(a,c){var u;if(a)if(!mt(a))je(e,1,54,`This field was specified as an array in the contract but the item is not an array.\r
`,{name:c},!0);else{u=[];for(var l=0;l<a[nr];l++){var d=a[l],p=n(d,c+"["+l+"]");u[Eh](p)}}return u}function s(a,c,u){var l;return a&&(l={},ot(a,function(d,p){if(c==="string")p===void 0?l[d]="undefined":p===null?l[d]="null":p[Ih]?l[d]=p[Ih]():l[d]="invalid field: toString() is not defined.";else if(c==="number")if(p===void 0)l[d]="undefined";else if(p===null)l[d]="null";else{var f=parseFloat(p);l[d]=f}else l[d]="invalid field: "+u+" is of unknown type.",je(e,1,l[d],null,!0)})),l}})}return t.__ieDyn=1,t}()});var kft,W4e,K4e=A(()=>{Rb();kft=8,W4e=function(){function t(){}return t.prototype.getHashCodeScore=function(e){var r=this.getHashCode(e)/t.INT_MAX_VALUE;return r*100},t.prototype.getHashCode=function(e){if(e==="")return 0;for(;e[nr]<kft;)e=e.concat(e);for(var r=5381,n=0;n<e[nr];++n)r=(r<<5)+r+e.charCodeAt(n),r=r&r;return Math.abs(r)},t.INT_MAX_VALUE=2147483647,t}()});var Y4e,Q4e=A(()=>{Sh();Rb();K4e();Y4e=function(){function t(){var e=this,r=new W4e,n=new Jw;e[bq]=function(o){var s=0;return o[vo]&&o[vo][n.userId]?s=r.getHashCodeScore(o[vo][n.userId]):o.ext&&o.ext.user&&o.ext.user.id?s=r[L4e](o.ext.user.id):o[vo]&&o[vo][n.operationId]?s=r.getHashCodeScore(o[vo][n.operationId]):o.ext&&o.ext.telemetryTrace&&o.ext.telemetryTrace[Ux]?s=r.getHashCodeScore(o.ext.telemetryTrace[Ux]):s=Math.random()*100,s}}return t}()});var X4e,J4e=A(()=>{Sh();un();Rb();Q4e();X4e=function(){function t(e,r){this.INT_MAX_VALUE=2147483647;var n=r||yd(null);(e>100||e<0)&&(n.throwInternal(2,58,"Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.",{samplingRate:e},!0),e=100),this[oR]=e,this.samplingScoreGenerator=new Y4e}return t.prototype.isSampledIn=function(e){var r=this[oR],n=!1;return r==null||r>=100||e.baseType===If[Sl]?!0:(n=this.samplingScoreGenerator[bq](e)<r,n)},t}()});function eOe(t){try{return t.responseText}catch{}return null}function Aft(t){return t&&t.sendPOST}function Dft(t){return!isNaN(t)&&t>0&&t<=100}var si,kh,Ef,Z4e,Pft,tOe,Nft,BN,rOe=A(()=>{hc();ns();Sh();un();At();H4e();G4e();$4e();J4e();Rb();Ef=void 0,Z4e="",Pft=65e3;tOe=La((si={endpointUrl:Sw(al,cb+yf)},si[LN]=vl(),si[Vie]=15e3,si[Lie]=102400,si.disableTelemetry=vl(),si[Mie]=vl(!0),si.isRetryDisabled=vl(),si[pq]=vl(!0),si[Uie]=vl(!0),si[fq]=vl(),si[Fie]=vl(),si[dq]=vl(),si[Bie]=Ef,si.namePrefix=Ef,si.samplingPercentage=Sw(Dft,100),si[lq]=Ef,si[Hie]=Ef,si[aq]=1e4,si[MN]=!1,si.httpXHROverride={isVal:Aft,v:Ef},si[Oie]=vl(),si.transports=Ef,si.retryCodes=Ef,si));Nft=(kh={},kh[Sf.dataType]=$ie,kh[bb.dataType]=j4e,kh[gb.dataType]=B4e,kh[yb.dataType]=q4e,kh[hb.dataType]=F4e,kh[If.dataType]=U4e,kh[vb.dataType]=M4e,kh),BN=function(t){mc(e,t);function e(){var r=t.call(this)||this;r.priority=1001,r.identifier=Nie;var n,o,s,a,c,u,l,d,p=0,f,m,h,g,v,y,_,x,S,I,E,R,B,V,M,le,ne,q,P,k,U,F,$,ce,Y,j,xe;return mr(e,r,function(ee,vt){xt(),ee.pause=function(){Ke(),a=!0},ee.resume=function(){a&&(a=!1,o=null,ai(),Cl())},ee.flush=function(Q,ue,ve){if(Q===void 0&&(Q=!0),!a){Ke();try{return ee[rR](Q,null,ve||1)}catch(Ee){je(ee[Ns](),1,22,"flush failed, telemetry will not be collected: "+qn(Ee),{exception:tt(Ee)})}}},ee.onunloadFlush=function(){if(!a)if(_||k)try{return ee[rR](!0,Db,2)}catch(Q){je(ee[Ns](),1,20,"failed to flush with beacon sender on page unload, telemetry will not be collected: "+qn(Q),{exception:tt(Q)})}else ee.flush(!1)},ee.addHeader=function(Q,ue){d[Q]=ue},ee[uq]=function(Q,ue,ve,Ee){ee.isInitialized()&&je(ee[Ns](),1,28,"Sender is already initialized"),vt[uq](Q,ue,ve,Ee);var W=ee.identifier;u=new z4e(ue.logger),n=0,o=null,s=0,ee[nR]=null,l=0;var re=ee[Ns]();h=nu(Ps("Sender"),ue.evtNamespace&&ue.evtNamespace()),m=oq(h),ee._addHook(mo(Q,function(fe){var Re=fe.cfg;Re.storagePrefix&&YB(Re.storagePrefix);var ct=Ua(null,Re,ue),Oe=ct.getExtCfg(W,tOe);en(ee,"_senderConfig",{g:function(){return Oe}}),v!==Oe.endpointUrl&&(g=v=Oe.endpointUrl),I&&I!==Oe[lq]&&_e(I,function(cs){delete d[cs.header]}),y=Oe[Lie],_=(Oe[dq]===!1||Oe[pq]===!1)&&Sc(),x=Oe[dq]===!1&&Sc(),S=Oe[pq]===!1&&Sc(),k=Oe[Oie],U=!!Oe[fq],xe=Oe.retryCodes;var Er=Oe[MN],Ur=!!Oe[Mie]&&(!!Er||Ox()),Zi=Oe.namePrefix,Ec=Ur!==le||Ur&&q!==Zi||Ur&&ne!==Er;if(ee[Rh]){if(Ec)try{ee._buffer=ee._buffer[ON](re,Oe,Ur)}catch(cs){je(ee[Ns](),1,12,"failed to transfer telemetry to different buffer storage, telemetry will be lost: "+qn(cs),{exception:tt(cs)})}ai()}else ee[Rh]=Ur?new Wie(re,Oe):new yq(re,Oe);q=Zi,le=Ur,ne=Er,F=!Oe[Fie]&&ih(!0),Y=!!Oe[Uie],ee._sample=new X4e(Oe.samplingPercentage,re),R=Oe[Bie],ze(R,Re)||je(re,1,100,"Invalid Instrumentation key "+R),I=Oe[lq],!kN(g)&&I&&I[nr]>0?_e(I,function(cs){r.addHeader(cs.header,cs.value)}):I=null,P=Oe[qie];var Lh=Lt();j?j.SetConfig(Lh):(j=new mx,j[uq](Lh,re));var ua=Oe.httpXHROverride,Oh=null,Lb=null,NOe=ah([3,1,2],Oe.transports);Oh=j&&j[FN](NOe,!1);var jq=j&&j.getFallbackInst();$=function(cs,Ob){return Dt(jq,cs,Ob)},ce=function(cs,Ob){return Dt(jq,cs,Ob,!1)},Oh=k?ua:Oh||ua||jq,ee[nR]=function(cs,Ob){return Dt(Oh,cs,Ob)},F&&(f=Nb);var Hq=ah([3,1],Oe[jie]);F||(Hq=Hq.filter(function(cs){return cs!==2})),Lb=j&&j[FN](Hq,!0),Lb=k?ua:Lb||ua,(k||Oe[jie]||!f)&&Lb&&(f=function(cs,Ob){return Dt(Lb,cs,Ob)}),f||(f=$),E=Oe.disableTelemetry,B=Oe[Hie]||Ef,V=Oe.isRetryDisabled,M=Oe[Vie]}))},ee.processTelemetry=function(Q,ue){ue=ee._getTelCtx(ue);var ve=ue[Ns]();try{var Ee=lt(Q,ve);if(!Ee)return;var W=G(Q,ve);if(!W)return;var re=u[iR](W),fe=ee[Rh];ai(re),fe[Ch](re),Cl()}catch(Re){je(ve,2,12,"Failed adding telemetry to the sender's buffer, some telemetry will be lost: "+qn(Re),{exception:tt(Re)})}ee.processNext(Q,ue)},ee.isCompletelyIdle=function(){return!a&&p===0&&ee._buffer[Th]()===0},ee._xhrReadyStateChange=function(Q,ue,ve){return br(Q,ue,ve)},ee[rR]=function(Q,ue,ve){Q===void 0&&(Q=!0);var Ee;if(!a)try{var W=ee[Rh];if(E)W[Eb]();else{if(W[Th]()>0){var re=W.getItems();Ne(ve||0,Q),ue?Ee=ue.call(ee,re,Q):Ee=ee[nR](re,Q)}s=+new Date}Ke()}catch(Re){var fe=MD();(!fe||fe>9)&&je(ee[Ns](),1,40,"Telemetry transmission failed, some telemetry will be lost: "+qn(Re),{exception:tt(Re)})}return Ee},ee.getOfflineSupport=function(){var Q;return Q={getUrl:function(){return g},createPayload:Pe},Q[iR]=pe,Q.batch=me,Q.shouldProcess=function(ue){return!!lt(ue)},Q},ee._doTeardown=function(Q,ue){ee.onunloadFlush(),lh(m,!1),xt()},ee[wb]=function(Q,ue,ve){je(ee[Ns](),2,26,"Failed to send telemetry.",{message:ue}),ee._buffer&&ee._buffer[Bx](Q)},ee[mq]=function(Q,ue){for(var ve=[],Ee=[],W=ue.errors.reverse(),re=0,fe=W;re<fe.length;re++){var Re=fe[re],ct=Q.splice(Re.index,1)[0];Nh(Re.statusCode)?Ee[Eh](ct):ve[Eh](ct)}Q[nr]>0&&ee[UN](Q,ue[hq]),ve[nr]>0&&ee[wb](ve,sh(null,["partial success",ue[hq],"of",ue.itemsReceived].join(" "))),Ee[nr]>0&&(Td(Ee),je(ee[Ns](),2,40,"Partial success. Delivered: "+Q[nr]+", Failed: "+ve[nr]+". Will retry to send "+Ee[nr]+" our of "+ue[N4e]+" items"))},ee[UN]=function(Q,ue){ee._buffer&&ee._buffer[Bx](Q)},ee._xdrOnLoad=function(Q,ue){return We(Q,ue)};function We(Q,ue){var ve=eOe(Q);if(Q&&(ve+""=="200"||ve===""))n=0,ee[UN](ue,0);else{var Ee=cx(ve);Ee&&Ee.itemsReceived&&Ee.itemsReceived>Ee[hq]&&!V?ee[mq](ue,Ee):ee[wb](ue,ax(Q))}}function Lt(){var Q;try{var ue={xdrOnComplete:function(Ee,W,re){var fe=ye(re);if(fe)return We(Ee,fe)},fetchOnComplete:function(Ee,W,re,fe){var Re=ye(fe);if(Re)return Ls(Ee.status,Re,Ee.url,Re[nr],Ee.statusText,re||"")},xhrOnComplete:function(Ee,W,re){var fe=ye(re);if(fe)return br(Ee,fe,fe[nr])},beaconOnRetry:function(Ee,W,re){return Dh(Ee,W,re)}},ve=(Q={},Q[qie]=P,Q.isOneDs=!1,Q.disableCredentials=!1,Q[fq]=U,Q.disableBeacon=!S,Q.disableBeaconSync=!x,Q.senderOnCompleteCallBack=ue,Q);return ve}catch{}return null}function br(Q,ue,ve){Q.readyState===4&&Ls(Q.status,ue,Q.responseURL,ve,sh(Q),eOe(Q)||Q.response)}function ye(Q){try{if(Q){var ue=Q,ve=ue[gq];return ve&&ve[nr]?ve:null}}catch{}return null}function lt(Q,ue){if(E)return!1;if(!Q)return ue&&je(ue,1,7,"Cannot send empty telemetry"),!1;if(Q.baseData&&!Q[vq])return ue&&je(ue,1,70,"Cannot send telemetry without baseData and baseType"),!1;if(Q[vq]||(Q[vq]="EventData"),!ee[nR])return ue&&je(ue,1,28,"Sender was not initialized"),!1;if(Ie(Q))Q[Hw]=ee._sample[oR];else return ue&&je(ue,2,33,"Telemetry item was sampled out and not sent",{SampleRate:ee._sample[oR]}),!1;return!0}function G(Q,ue){var ve=Q.iKey||R,Ee=e.constructEnvelope(Q,ve,ue,B);if(!Ee){je(ue,1,47,"Unable to create an AppInsights envelope");return}var W=!1;if(Q[vo]&&Q[vo][Vw]&&(_e(Q[vo][Vw],function(re){try{re&&re(Ee)===!1&&(W=!0,Fa(ue,"Telemetry processor check returns false"))}catch(fe){je(ue,1,64,"One of telemetry initializers failed, telemetry item will not be sent: "+qn(fe),{exception:tt(fe)},!0)}}),delete Q[vo][Vw]),!W)return Ee}function pe(Q){var ue=Z4e,ve=ee[Ns]();try{var Ee=lt(Q,ve),W=null;Ee&&(W=G(Q,ve)),W&&(ue=u[iR](W))}catch{}return ue}function me(Q){var ue=Z4e;return Q&&Q[nr]&&(ue="["+Q.join(",")+"]"),ue}function Pe(Q){var ue,ve=Pn();return ue={urlString:g},ue[Ds]=Q,ue.headers=ve,ue}function Ie(Q){return ee._sample.isSampledIn(Q)}function bt(Q,ue,ve,Ee){ue===200&&Q?ee._onSuccess(Q,Q[nr]):Ee&&ee[wb](Q,Ee)}function Dt(Q,ue,ve,Ee){Ee===void 0&&(Ee=!0);var W=function(Re,ct,Oe){return bt(ue,Re,ct,Oe)},re=ln(ue),fe=Q&&Q.sendPOST;return fe&&re?(Ee&&ee._buffer[eR](ue),fe(re,W,!ve)):null}function ln(Q){var ue;if(mt(Q)&&Q[nr]>0){var ve=ee[Rh].batchPayloads(Q),Ee=Pn(),W=(ue={},ue[Ds]=ve,ue.urlString=g,ue.headers=Ee,ue.disableXhrSync=U,ue.disableFetchKeepAlive=!F,ue[gq]=Q,ue);return W}return null}function Pn(){try{var Q=d||{};return kN(g)&&(Q[Ex[6]]=Ex[7]),Q}catch{}return null}function ai(Q){var ue=Q?Q[nr]:0;return ee[Rh].size()+ue>y?((!m||m.isOnline())&&ee[rR](!0,null,10),!0):!1}function Ls(Q,ue,ve,Ee,W,re){var fe=null;if(ee._appId||(fe=cx(re),fe&&fe.appId&&(ee._appId=fe.appId)),(Q<200||Q>=300)&&Q!==0){if((Q===301||Q===307||Q===308)&&!Cd(ve)){ee[wb](ue,W);return}!V&&Nh(Q)?(Td(ue),je(ee[Ns](),2,40,". Response code "+Q+". Will retry to send "+ue[nr]+" items.")):ee[wb](ue,W)}else if(m&&!m.isOnline()){if(!V){var Re=10;Td(ue,Re),je(ee[Ns](),2,40,". Offline - Response Code: ".concat(Q,". Offline status: ").concat(!m.isOnline(),". Will retry to send ").concat(ue.length," items."))}}else Cd(ve),Q===206?(fe||(fe=cx(re)),fe&&!V?ee[mq](ue,fe):ee[wb](ue,W)):(n=0,ee[UN](ue,Ee))}function Cd(Q){return l>=10?!1:!we(Q)&&Q!==""&&Q!==g?(g=Q,++l,!0):!1}function Db(Q,ue){if(f)f(Q,!1);else{var ve=j&&j[FN]([3],!0);return Dt(ve,Q,ue)}}function Dh(Q,ue,ve){var Ee=Q,W=Ee&&Ee[gq];if(Y)ce&&ce(W,!0),je(ee[Ns](),2,40,". Failed to send telemetry with Beacon API, retried with normal sender.");else{for(var re=[],fe=0;fe<W[nr];fe++){var Re=W[fe],ct=[Re],Oe=ln(ct);ve(Oe,ue)?ee._onSuccess(ct,ct[nr]):re[Eh](Re)}re[nr]>0&&(ce&&ce(re,!0),je(ee[Ns](),2,40,". Failed to send telemetry with Beacon API, retried with normal sender."))}}function Nb(Q,ue){var ve=null;if(mt(Q)){for(var Ee=Q[nr],W=0;W<Q[nr];W++)Ee+=Q[W][nr];var re=j.getSyncFetchPayload();re+Ee<=Pft?ve=2:Sc()?ve=3:(ve=1,je(ee[Ns](),2,40,". Failed to send telemetry with Beacon API, retried with xhrSender."));var fe=j&&j[FN]([ve],!0);return Dt(fe,Q,ue)}return null}function Td(Q,ue){if(ue===void 0&&(ue=1),!(!Q||Q[nr]===0)){var ve=ee[Rh];ve[Bx](Q),n++;for(var Ee=0,W=Q;Ee<W.length;Ee++){var re=W[Ee];ve[Ch](re)}Gx(ue),Cl()}}function Gx(Q){var ue=10,ve;if(n<=1)ve=ue;else{var Ee=(Math.pow(2,n)-1)/2,W=Math.floor(Math.random()*Ee*ue)+1;W=Q*W,ve=Math.max(Math.min(W,3600),ue)}var re=xi()+ve*1e3;o=re}function Cl(){if(!c&&!a){var Q=o?Math.max(0,o-xi()):0,ue=Math.max(M,Q);c=fc(function(){c=null,ee[rR](!0,null,1)},ue)}}function Ke(){c&&c.cancel(),c=null,o=null}function Nh(Q){return we(xe)?Q===401||Q===408||Q===429||Q===500||Q===502||Q===503||Q===504:xe[nr]&&xe.indexOf(Q)>-1}function te(){var Q="getNotifyMgr";return ee.core[Q]?ee.core[Q]():ee.core._notificationManager}function Ne(Q,ue){var ve=te();if(ve&&ve[Gie])try{ve[Gie](Q,ue)}catch(Ee){je(ee[Ns](),1,74,"send request notification failed: "+qn(Ee),{exception:tt(Ee)})}}function ze(Q,ue){var ve=ue.disableInstrumentationKeyValidation,Ee=we(ve)?!1:ve;if(Ee)return!0;var W="^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",re=new RegExp(W);return re.test(Q)}function xt(){ee[nR]=null,ee[Rh]=null,ee._appId=null,ee._sample=null,d={},m=null,n=0,o=null,s=null,a=!1,c=null,u=null,l=0,p=0,f=null,h=null,g=null,v=null,y=0,_=!1,I=null,E=!1,R=null,B=Ef,V=!1,le=null,q=Ef,U=!1,F=!1,Y=!1,$=null,ce=null,j=null,en(ee,"_senderConfig",{g:function(){return yU({},tOe)}})}}),r}return e.constructEnvelope=function(r,n,o,s){var a;n!==r.iKey&&!we(n)?a=pl(pl({},r),{iKey:n}):a=r;var c=Nft[a.baseType]||$ie;return c(o,a,s)},e}(mh)});var Kie=A(()=>{rOe()});var _q,xq,Sq,qN,nOe=A(()=>{_q="instrumentationKey",xq="connectionString",Sq="endpointUrl",qN="userOverrideEndpointUrl"});var iOe={};_n(iOe,{AppInsightsCore:()=>hh,ApplicationInsights:()=>Mft,Sender:()=>BN,SeverityLevel:()=>nq,arrForEach:()=>_e,isNullOrUndefined:()=>we,proxyFunctions:()=>ru,throwError:()=>bi});function Oft(t){return t&&t>0}var Lft,Mft,oOe=A(()=>{ns();Kie();Sh();un();At();nOe();un();Sh();Kie();Lft={diagnosticLogInterval:Sw(Oft,1e4)};Mft=function(){function t(e){var r=new hh,n;(we(e)||we(e[_q])&&we(e[xq]))&&bi("Invalid input configuration"),mr(t,this,function(s){en(s,"config",{g:function(){return n}}),a(),s.initialize=a,s.track=o,ru(s,r,["flush","pollInternalLogs","stopPollingInternalLogs","unload","getPlugin","addPlugin","evtNamespace","addUnloadCb","onCfgChange"]);function a(){var c=ni(e||{},Lft);n=c.cfg,r.addUnloadHook(mo(c,function(){if(n[xq]){var u=PN(n[xq]),l=u.ingestionendpoint;n[Sq]=n[qN]?n[qN]:l+yf,n[_q]=u.instrumentationkey||n[_q]}n[Sq]=n[qN]?n[qN]:n[Sq]})),r.initialize(n,[new BN])}});function o(s){s&&(s.baseData=s.baseData||{},s.baseType=s.baseType||"EventData"),r.track(s)}}return t.__ieDyn=1,t}()});var sOe=O(wf=>{"use strict";var Fft=wf&&wf.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(e,r);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,o)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Uft=wf&&wf.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Bft=wf&&wf.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Fft(e,t,r);return Uft(e,t),e};Object.defineProperty(wf,"__esModule",{value:!0});wf.appInsightsClientFactory=void 0;var qft=(Sh(),eo(A4e)),jft=ste(),Hft=async(t,e,r)=>{let n;try{let s=await Promise.resolve().then(()=>Bft((oOe(),eo(iOe)))),a={};if(e){let c={alwaysUseXhrOverride:!0,httpXHROverride:e};a[qft.BreezeChannelIdentifier]=c}n=new s.ApplicationInsights({instrumentationKey:t,disableAjaxTracking:!0,disableExceptionTracking:!0,disableFetchTracking:!0,disableCorrelationHeaders:!0,disableCookiesUsage:!0,autoTrackPageVisitTime:!1,emitLineDelimitedJson:!1,disableInstrumentationKeyValidation:!0,extensionConfig:a})}catch(s){return Promise.reject(s)}return{logEvent:(s,a)=>{let c={...a?.properties,...a?.measurements};r?.length&&jft.TelemetryUtil.applyReplacements(c,r),n?.track({name:s,data:c,baseType:"EventData",baseData:{name:s,properties:a?.properties,measurements:a?.measurements}})},flush:async()=>{n?.flush(!1)},dispose:async()=>new Promise(a=>{n?.unload(!0,()=>{a(),n=void 0},1e3)})}};wf.appInsightsClientFactory=Hft});var lOe=O(Ph=>{"use strict";var Vft=Ph&&Ph.__createBinding||(Object.create?function(t,e,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(e,r);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,o)}:function(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}),Gft=Ph&&Ph.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),Xie=Ph&&Ph.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&Vft(e,t,r);return Gft(e,t),e};Object.defineProperty(Ph,"__esModule",{value:!0});var Yie=Xie(require("os")),aOe=Xie(require("vscode")),zft=Xie(require("https")),$ft=T2e(),Wft=E2e(),cOe=ste(),Kft=wLe(),Yft=sOe();function uOe(){return{sendPOST:(e,r)=>{let n={method:"POST",headers:{...e.headers,"Content-Type":"application/json","Content-Length":Buffer.byteLength(e.data)}};try{let o=zft.request(e.urlString,n,s=>{s.on("data",function(a){r(s.statusCode??200,s.headers,a.toString())}),s.on("error",function(){r(0,{})})});o.write(e.data,s=>{s&&r(0,{})}),o.end()}catch{r(0,{})}}}}var Qie=class extends $ft.BaseTelemetryReporter{constructor(e,r){let n=a=>(0,Yft.appInsightsClientFactory)(a,uOe(),r);cOe.TelemetryUtil.shouldUseOneDataSystemSDK(e)&&(n=a=>(0,Kft.oneDataSystemClientFactory)(a,aOe,uOe()));let o={release:Yie.release(),platform:Yie.platform(),architecture:Yie.arch()},s=new Wft.BaseTelemetrySender(e,n);if(e&&e.indexOf("AIF-")===0)throw new Error("AIF keys are no longer supported. Please switch to 1DS keys for 1st party extensions");super(s,aOe,{additionalCommonProperties:cOe.TelemetryUtil.getAdditionalCommonProperties(o)})}};Ph.default=Qie});var gmt={};_n(gmt,{activate:()=>fmt,createExtensionContext:()=>DOe});module.exports=eo(gmt);var POe=H(Gt()),AOe=H(require("path")),bR=require("vscode");var Tl;(o=>{o.serviceIds=new Map,o.DI_TARGET="$di$target",o.DI_DEPENDENCIES="$di$dependencies";function n(s){return s[o.DI_DEPENDENCIES]||[]}o.getServiceDependencies=n})(Tl||={});var K=ie("instantiationService");function QOe(t,e,r){e[Tl.DI_TARGET]===e?e[Tl.DI_DEPENDENCIES].push({id:t,index:r}):(e[Tl.DI_DEPENDENCIES]=[{id:t,index:r}],e[Tl.DI_TARGET]=e)}function ie(t){if(Tl.serviceIds.has(t))return Tl.serviceIds.get(t);let e=function(r,n,o){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");QOe(e,r,o)};return e.toString=()=>t,Tl.serviceIds.set(t,e),e}var Gq=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?GN.isErrorNoTelemetry(e)?new GN(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(r=>{r(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},JOe=new Gq;function Mh(t){Af(t)||JOe.onUnexpectedError(t)}var zq="Canceled";function Af(t){return t instanceof Hi?!0:t instanceof Error&&t.name===zq&&t.message===zq}var Hi=class extends Error{constructor(){super(zq),this.name=this.message}};function dn(t){return t?new Error(`Illegal argument: ${t}`):new Error("Illegal argument")}function poe(t){return t?new Error(`Illegal state: ${t}`):new Error("Illegal state")}function zN(t){return t?t.message?t.message:t.stack?t.stack.split(`
`)[0]:String(t):"Error"}var GN=class t extends Error{constructor(e){super(e),this.name="CodeExpectedError"}static fromError(e){if(e instanceof t)return e;let r=new t;return r.message=e.message,r.stack=e.stack,r}static isErrorNoTelemetry(e){return e.name==="CodeExpectedError"}},Qr=class t extends Error{constructor(e){super(e||"An unexpected bug occurred."),Object.setPrototypeOf(this,t.prototype)}};function $q(t,e){let r=this,n=!1,o;return function(){if(n)return o;if(n=!0,e)try{o=t.apply(r,arguments)}finally{e()}else o=t.apply(r,arguments);return o}}function moe(t,e){let r=Wq(t,e);if(r!==-1)return t[r]}function Wq(t,e,r=t.length-1){for(let n=r;n>=0;n--){let o=t[n];if(e(o))return n}return-1}function Kq(t,e){let r=Fh(t,e);return r===-1?void 0:t[r]}function Fh(t,e,r=0,n=t.length){let o=r,s=n;for(;o<s;){let a=Math.floor((o+s)/2);e(t[a])?o=a+1:s=a}return o-1}function zx(t,e,r=0,n=t.length){let o=r,s=n;for(;o<s;){let a=Math.floor((o+s)/2);e(t[a])?s=a:o=a+1}return o}var foe=class t{constructor(e){this._array=e;this._findLastMonotonousLastIdx=0}static{this.assertInvariants=!1}findLastMonotonous(e){if(t.assertInvariants){if(this._prevFindLastPredicate){for(let n of this._array)if(this._prevFindLastPredicate(n)&&!e(n))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=e}let r=Fh(this._array,e,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=r+1,r===-1?void 0:this._array[r]}};function $N(t,e){for(let r of t){let n=e(r);if(n!==void 0)return n}}function xR(t,e,r=(n,o)=>n===o){if(t===e)return!0;if(!t||!e||t.length!==e.length)return!1;for(let n=0,o=t.length;n<o;n++)if(!r(t[n],e[n]))return!1;return!0}function goe(t,e,r){return Yq(t.length,n=>r(t[n],e))}function Yq(t,e){let r=0,n=t-1;for(;r<=n;){let o=(r+n)/2|0,s=e(o);if(s<0)r=o+1;else if(s>0)n=o-1;else return o}return-(r+1)}function Nr(t){return t.filter(e=>!!e)}function voe(t,e=r=>r){let r=new Set;return t.filter(n=>{let o=e(n);return r.has(o)?!1:(r.add(o),!0)})}function boe(t){let e=new Set;return r=>{let n=t(r);return e.has(n)?!1:(e.add(n),!0)}}function yoe(t,e){let r=typeof e=="number"?t:0;typeof e=="number"?r=t:(r=0,e=t);let n=[];if(r<=e)for(let o=r;o<e;o++)n.push(o);else for(let o=r;o>e;o--)n.push(o);return n}function _oe(t,e){let r;if(typeof e=="number"){let n=e;r=()=>{let o=Math.sin(n++)*179426549;return o-Math.floor(o)}}else r=Math.random;for(let n=t.length-1;n>0;n-=1){let o=Math.floor(r()*(n+1)),s=t[n];t[n]=t[o],t[o]=s}}var xoe;(c=>{function t(u){return u<0}c.isLessThan=t;function e(u){return u<=0}c.isLessThanOrEqual=e;function r(u){return u>0}c.isGreaterThan=r;function n(u){return u===0}c.isNeitherLessOrGreaterThan=n,c.greaterThan=1,c.lessThan=-1,c.neitherLessOrGreaterThan=0})(xoe||={});function WN(t,e){return(r,n)=>e(t(r),t(n))}var KN=(t,e)=>t-e;var hoe=class t{constructor(e){this.iterate=e}static{this.empty=new t(e=>{})}forEach(e){this.iterate(r=>(e(r),!0))}toArray(){let e=[];return this.iterate(r=>(e.push(r),!0)),e}filter(e){return new t(r=>this.iterate(n=>e(n)?r(n):!0))}map(e){return new t(r=>this.iterate(n=>r(e(n))))}some(e){let r=!1;return this.iterate(n=>(r=e(n),!r)),r}findFirst(e){let r;return this.iterate(n=>e(n)?(r=n,!1):!0),r}findLast(e){let r;return this.iterate(n=>(e(n)&&(r=n),!0)),r}findLastMaxBy(e){let r,n=!0;return this.iterate(o=>((n||xoe.isGreaterThan(e(o,r)))&&(n=!1,r=o),!0)),r}};function Ioe(t,e){let r=Object.create(null);for(let n of t){let o=e(n),s=r[o];s||(s=r[o]=[]),s.push(n)}return r}var e3e,Soe=class{constructor(e,r){this.toKey=r;this._map=new Map;this[e3e]="SetWithKey";for(let n of e)this.add(n)}static{e3e=Symbol.toStringTag}get size(){return this._map.size}add(e){let r=this.toKey(e);return this._map.set(r,e),this}delete(e){return this._map.delete(this.toKey(e))}has(e){return this._map.has(this.toKey(e))}*entries(){for(let e of this._map.values())yield[e,e]}keys(){return this.values()}*values(){for(let e of this._map.values())yield e}clear(){this._map.clear()}forEach(e,r){this._map.forEach(n=>e.call(r,n,n,this))}[Symbol.iterator](){return this.values()}};var Xq=class{constructor(e,r){this.uri=e;this.value=r}};function t3e(t){return Array.isArray(t)}var r3e,tn=class t{constructor(e,r){this[r3e]="ResourceMap";if(e instanceof t)this.map=new Map(e.map),this.toKey=r??t.defaultToKey;else if(t3e(e)){this.map=new Map,this.toKey=r??t.defaultToKey;for(let[n,o]of e)this.set(n,o)}else this.map=new Map,this.toKey=e??t.defaultToKey}static{this.defaultToKey=e=>e.toString()}set(e,r){return this.map.set(this.toKey(e),new Xq(e,r)),this}get(e){return this.map.get(this.toKey(e))?.value}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,r){typeof r<"u"&&(e=e.bind(r));for(let[n,o]of this.map)e(o.value,o.uri,this)}*values(){for(let e of this.map.values())yield e.value}*keys(){for(let e of this.map.values())yield e.uri}*entries(){for(let e of this.map.values())yield[e.uri,e.value]}*[(r3e=Symbol.toStringTag,Symbol.iterator)](){for(let[,e]of this.map)yield[e.uri,e.value]}},n3e,Coe=class{constructor(e,r){this[n3e]="ResourceSet";!e||typeof e=="function"?this._map=new tn(e):(this._map=new tn(r),e.forEach(this.add,this))}get size(){return this._map.size}add(e){return this._map.set(e,e),this}clear(){this._map.clear()}delete(e){return this._map.delete(e)}forEach(e,r){this._map.forEach((n,o)=>e.call(r,o,o,this))}has(e){return this._map.has(e)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[(n3e=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}};var i3e,Jq=class{constructor(){this[i3e]="LinkedMap";this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,r=0){let n=this._map.get(e);if(n)return r!==0&&this.touch(n,r),n.value}set(e,r,n=0){let o=this._map.get(e);if(o)o.value=r,n!==0&&this.touch(o,n);else{switch(o={key:e,value:r,next:void 0,previous:void 0},n){case 0:this.addItemLast(o);break;case 1:this.addItemFirst(o);break;case 2:this.addItemLast(o);break;default:this.addItemLast(o);break}this._map.set(e,o),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let r=this._map.get(e);if(r)return this._map.delete(e),this.removeItem(r),this._size--,r.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,r){let n=this._state,o=this._head;for(;o;){if(r?e.bind(r)(o.value,o.key,this):e(o.value,o.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");o=o.next}}keys(){let e=this,r=this._state,n=this._head,o={[Symbol.iterator](){return o},next(){if(e._state!==r)throw new Error("LinkedMap got modified during iteration.");if(n){let s={value:n.key,done:!1};return n=n.next,s}else return{value:void 0,done:!0}}};return o}values(){let e=this,r=this._state,n=this._head,o={[Symbol.iterator](){return o},next(){if(e._state!==r)throw new Error("LinkedMap got modified during iteration.");if(n){let s={value:n.value,done:!1};return n=n.next,s}else return{value:void 0,done:!0}}};return o}entries(){let e=this,r=this._state,n=this._head,o={[Symbol.iterator](){return o},next(){if(e._state!==r)throw new Error("LinkedMap got modified during iteration.");if(n){let s={value:[n.key,n.value],done:!1};return n=n.next,s}else return{value:void 0,done:!0}}};return o}[(i3e=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let r=this._head,n=this.size;for(;r&&n>e;)this._map.delete(r.key),r=r.next,n--;this._head=r,this._size=n,r&&(r.previous=void 0),this._state++}trimNew(e){if(e>=this.size)return;if(e===0){this.clear();return}let r=this._tail,n=this.size;for(;r&&n>e;)this._map.delete(r.key),r=r.previous,n--;this._tail=r,this._size=n,r&&(r.next=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let r=e.next,n=e.previous;if(!r||!n)throw new Error("Invalid list");r.previous=n,n.next=r}e.next=void 0,e.previous=void 0,this._state++}touch(e,r){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(r!==1&&r!==2)){if(r===1){if(e===this._head)return;let n=e.next,o=e.previous;e===this._tail?(o.next=void 0,this._tail=o):(n.previous=o,o.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(r===2){if(e===this._tail)return;let n=e.next,o=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=o,o.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((r,n)=>{e.push([n,r])}),e}fromJSON(e){this.clear();for(let[r,n]of e)this.set(r,n)}},Zq=class extends Jq{constructor(e,r=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,r),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,r=2){return super.get(e,r)}peek(e){return super.get(e,0)}set(e,r){return super.set(e,r,2),this}checkTrim(){this.size>this._limit&&this.trim(Math.round(this._limit*this._ratio))}},Uh=class extends Zq{constructor(e,r=1){super(e,r)}trim(e){this.trimOld(e)}set(e,r){return super.set(e,r),this.checkTrim(),this}};var YN=class{constructor(){this.map=new Map}add(e,r){let n=this.map.get(e);n||(n=new Set,this.map.set(e,n)),n.add(r)}delete(e,r){let n=this.map.get(e);n&&(n.delete(r),n.size===0&&this.map.delete(e))}forEach(e,r){let n=this.map.get(e);n&&n.forEach(r)}get(e){let r=this.map.get(e);return r||new Set}};var Os;(x=>{function t(S){return S&&typeof S=="object"&&typeof S[Symbol.iterator]=="function"}x.is=t;let e=Object.freeze([]);function r(){return e}x.empty=r;function*n(S){yield S}x.single=n;function o(S){return t(S)?S:n(S)}x.wrap=o;function s(S){return S||e}x.from=s;function*a(S){for(let I=S.length-1;I>=0;I--)yield S[I]}x.reverse=a;function c(S){return!S||S[Symbol.iterator]().next().done===!0}x.isEmpty=c;function u(S){return S[Symbol.iterator]().next().value}x.first=u;function l(S,I){let E=0;for(let R of S)if(I(R,E++))return!0;return!1}x.some=l;function d(S,I){for(let E of S)if(I(E))return E}x.find=d;function*p(S,I){for(let E of S)I(E)&&(yield E)}x.filter=p;function*f(S,I){let E=0;for(let R of S)yield I(R,E++)}x.map=f;function*m(S,I){let E=0;for(let R of S)yield*I(R,E++)}x.flatMap=m;function*h(...S){for(let I of S)yield*I}x.concat=h;function g(S,I,E){let R=E;for(let B of S)R=I(R,B);return R}x.reduce=g;function*v(S,I,E=S.length){for(I<0&&(I+=S.length),E<0?E+=S.length:E>S.length&&(E=S.length);I<E;I++)yield S[I]}x.slice=v;function y(S,I=Number.POSITIVE_INFINITY){let E=[];if(I===0)return[E,S];let R=S[Symbol.iterator]();for(let B=0;B<I;B++){let V=R.next();if(V.done)return[E,x.empty()];E.push(V.value)}return[E,{[Symbol.iterator](){return R}}]}x.consume=y;async function _(S){let I=[];for await(let E of S)I.push(E);return Promise.resolve(I)}x.asyncToArray=_})(Os||={});var o3e=!1,$x=null,Toe=class t{constructor(){this.livingDisposables=new Map}static{this.idx=0}getDisposableData(e){let r=this.livingDisposables.get(e);return r||(r={parent:null,source:null,isSingleton:!1,value:e,idx:t.idx++},this.livingDisposables.set(e,r)),r}trackDisposable(e){let r=this.getDisposableData(e);r.source||(r.source=new Error().stack)}setParent(e,r){let n=this.getDisposableData(e);n.parent=r}markAsDisposed(e){this.livingDisposables.delete(e)}markAsSingleton(e){this.getDisposableData(e).isSingleton=!0}getRootParent(e,r){let n=r.get(e);if(n)return n;let o=e.parent?this.getRootParent(this.getDisposableData(e.parent),r):e;return r.set(e,o),o}getTrackedDisposables(){let e=new Map;return[...this.livingDisposables.entries()].filter(([,n])=>n.source!==null&&!this.getRootParent(n,e).isSingleton).flatMap(([n])=>n)}computeLeakingDisposables(e=10,r){let n;if(r)n=r;else{let u=new Map,l=[...this.livingDisposables.values()].filter(p=>p.source!==null&&!this.getRootParent(p,u).isSingleton);if(l.length===0)return;let d=new Set(l.map(p=>p.value));if(n=l.filter(p=>!(p.parent&&d.has(p.parent))),n.length===0)throw new Error("There are cyclic diposable chains!")}if(!n)return;function o(u){function l(p,f){for(;p.length>0&&f.some(m=>typeof m=="string"?m===p[0]:p[0].match(m));)p.shift()}let d=u.source.split(`
`).map(p=>p.trim().replace("at ","")).filter(p=>p!=="");return l(d,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),d.reverse()}let s=new YN;for(let u of n){let l=o(u);for(let d=0;d<=l.length;d++)s.add(l.slice(0,d).join(`
`),u)}n.sort(WN(u=>u.idx,KN));let a="",c=0;for(let u of n.slice(0,e)){c++;let l=o(u),d=[];for(let p=0;p<l.length;p++){let f=l[p];f=`(shared with ${s.get(l.slice(0,p+1).join(`
`)).size}/${n.length} leaks) at ${f}`;let h=s.get(l.slice(0,p).join(`
`)),g=Ioe([...h].map(v=>o(v)[p]),v=>v);delete g[l[p]];for(let[v,y]of Object.entries(g))d.unshift(`    - stacktraces of ${y.length} other leaks continue with ${v}`);d.unshift(f)}a+=`


==================== Leaking disposable ${c}/${n.length}: ${u.value.constructor.name} ====================
${d.join(`
`)}
============================================================

`}return n.length>e&&(a+=`


... and ${n.length-e} more leaking disposables

`),{leaks:n,details:a}}};function s3e(t){$x=t}if(o3e){let t="__is_disposable_tracked__";s3e(new class{trackDisposable(e){let r=new Error("Potentially leaked disposable").stack;setTimeout(()=>{e[t]||console.log(r)},3e3)}setParent(e,r){if(e&&e!==dt.None)try{e[t]=!0}catch{}}markAsDisposed(e){if(e&&e!==dt.None)try{e[t]=!0}catch{}}markAsSingleton(e){}})}function Fb(t){return $x?.trackDisposable(t),t}function Ub(t){$x?.markAsDisposed(t)}function SR(t,e){$x?.setParent(t,e)}function a3e(t,e){if($x)for(let r of t)$x.setParent(r,e)}function Kx(t){return typeof t=="object"&&t!==null&&typeof t.dispose=="function"&&t.dispose.length===0}function Bh(t){if(Os.is(t)){let e=[];for(let r of t)if(r)try{r.dispose()}catch(n){e.push(n)}if(e.length===1)throw e[0];if(e.length>1)throw new AggregateError(e,"Encountered errors while disposing of store");return Array.isArray(t)?[]:t}else if(t)return t.dispose(),t}function Yx(...t){let e=qa(()=>Bh(t));return a3e(t,e),e}function qa(t){let e=Fb({dispose:$q(()=>{Ub(e),t()})});return e}var ht=class t{constructor(){this._toDispose=new Set;this._isDisposed=!1;Fb(this)}static{this.DISABLE_DISPOSED_WARNING=!1}dispose(){this._isDisposed||(Ub(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{Bh(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return SR(e,this),this._isDisposed?t.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}delete(e){if(e){if(e===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(e),e.dispose()}}deleteAndLeak(e){e&&this._toDispose.has(e)&&(this._toDispose.delete(e),SR(e,null))}},dt=class{constructor(){this._store=new ht;Fb(this),SR(this._store,this)}static{this.None=Object.freeze({dispose(){}})}dispose(){Ub(this),this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}},Mb=class{constructor(){this._isDisposed=!1;Fb(this)}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),e&&SR(e,this),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,Ub(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e&&SR(e,null),e}};var Wx=class{constructor(){this._store=new Map;this._isDisposed=!1;Fb(this)}dispose(){Ub(this),this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{Bh(this._store.values())}finally{this._store.clear()}}has(e){return this._store.has(e)}get size(){return this._store.size}get(e){return this._store.get(e)}set(e,r,n=!1){this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),n||this._store.get(e)?.dispose(),this._store.set(e,r)}deleteAndDispose(e){this._store.get(e)?.dispose(),this._store.delete(e)}deleteAndLeak(e){let r=this._store.get(e);return this._store.delete(e),r}keys(){return this._store.keys()}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}};var jn=class t{static{this.Undefined=new t(void 0)}constructor(e){this.element=e,this.next=t.Undefined,this.prev=t.Undefined}},IR=class{constructor(){this._first=jn.Undefined;this._last=jn.Undefined;this._size=0}get size(){return this._size}isEmpty(){return this._first===jn.Undefined}clear(){let e=this._first;for(;e!==jn.Undefined;){let r=e.next;e.prev=jn.Undefined,e.next=jn.Undefined,e=r}this._first=jn.Undefined,this._last=jn.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,r){let n=new jn(e);if(this._first===jn.Undefined)this._first=n,this._last=n;else if(r){let s=this._last;this._last=n,n.prev=s,s.next=n}else{let s=this._first;this._first=n,n.next=s,s.prev=n}this._size+=1;let o=!1;return()=>{o||(o=!0,this._remove(n))}}shift(){if(this._first!==jn.Undefined){let e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==jn.Undefined){let e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==jn.Undefined&&e.next!==jn.Undefined){let r=e.prev;r.next=e.next,e.next.prev=r}else e.prev===jn.Undefined&&e.next===jn.Undefined?(this._first=jn.Undefined,this._last=jn.Undefined):e.next===jn.Undefined?(this._last=this._last.prev,this._last.next=jn.Undefined):e.prev===jn.Undefined&&(this._first=this._first.next,this._first.prev=jn.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==jn.Undefined;)yield e.element,e=e.next}};var c3e=globalThis.performance&&typeof globalThis.performance.now=="function",yo=class t{static create(e){return new t(e)}constructor(e){this._now=c3e&&e===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}};var u3e=!1,Eoe=!1,l3e=!1,Ed;(P=>{P.None=()=>dt.None;function e(k){if(l3e){let{onDidAddListener:U}=k,F=CR.create(),$=0;k.onDidAddListener=()=>{++$===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),F.print()),U?.()}}}function r(k,U){return m(k,()=>{},0,void 0,!0,void 0,U)}P.defer=r;function n(k){return(U,F=null,$)=>{let ce=!1,Y;return Y=k(j=>{if(!ce)return Y?Y.dispose():ce=!0,U.call(F,j)},null,$),ce&&Y.dispose(),Y}}P.once=n;function o(k,U){return P.once(P.filter(k,U))}P.onceIf=o;function s(k,U,F){return p(($,ce=null,Y)=>k(j=>$.call(ce,U(j)),null,Y),F)}P.map=s;function a(k,U,F){return p(($,ce=null,Y)=>k(j=>{U(j),$.call(ce,j)},null,Y),F)}P.forEach=a;function c(k,U,F){return p(($,ce=null,Y)=>k(j=>U(j)&&$.call(ce,j),null,Y),F)}P.filter=c;function u(k){return k}P.signal=u;function l(...k){return(U,F=null,$)=>{let ce=Yx(...k.map(Y=>Y(j=>U.call(F,j))));return f(ce,$)}}P.any=l;function d(k,U,F,$){let ce=F;return s(k,Y=>(ce=U(ce,Y),ce),$)}P.reduce=d;function p(k,U){let F,$={onWillAddFirstListener(){F=k(ce.fire,ce)},onDidRemoveLastListener(){F?.dispose()}};U||e($);let ce=new Yt($);return U?.add(ce),ce.event}function f(k,U){return U instanceof Array?U.push(k):U&&U.add(k),k}function m(k,U,F=100,$=!1,ce=!1,Y,j){let xe,ee,vt,We=0,Lt,br={leakWarningThreshold:Y,onWillAddFirstListener(){xe=k(lt=>{We++,ee=U(ee,lt),$&&!vt&&(ye.fire(ee),ee=void 0),Lt=()=>{let G=ee;ee=void 0,vt=void 0,(!$||We>1)&&ye.fire(G),We=0},typeof F=="number"?(clearTimeout(vt),vt=setTimeout(Lt,F)):vt===void 0&&(vt=0,queueMicrotask(Lt))})},onWillRemoveListener(){ce&&We>0&&Lt?.()},onDidRemoveLastListener(){Lt=void 0,xe.dispose()}};j||e(br);let ye=new Yt(br);return j?.add(ye),ye.event}P.debounce=m;function h(k,U=0,F){return P.debounce(k,($,ce)=>$?($.push(ce),$):[ce],U,void 0,!0,void 0,F)}P.accumulate=h;function g(k,U=($,ce)=>$===ce,F){let $=!0,ce;return c(k,Y=>{let j=$||!U(Y,ce);return $=!1,ce=Y,j},F)}P.latch=g;function v(k,U,F){return[P.filter(k,U,F),P.filter(k,$=>!U($),F)]}P.split=v;function y(k,U=!1,F=[],$){let ce=F.slice(),Y=k(ee=>{ce?ce.push(ee):xe.fire(ee)});$&&$.add(Y);let j=()=>{ce?.forEach(ee=>xe.fire(ee)),ce=null},xe=new Yt({onWillAddFirstListener(){Y||(Y=k(ee=>xe.fire(ee)),$&&$.add(Y))},onDidAddFirstListener(){ce&&(U?setTimeout(j):j())},onDidRemoveLastListener(){Y&&Y.dispose(),Y=null}});return $&&$.add(xe),xe.event}P.buffer=y;function _(k,U){return($,ce,Y)=>{let j=U(new S);return k(function(xe){let ee=j.evaluate(xe);ee!==x&&$.call(ce,ee)},void 0,Y)}}P.chain=_;let x=Symbol("HaltChainable");class S{constructor(){this.steps=[]}map(U){return this.steps.push(U),this}forEach(U){return this.steps.push(F=>(U(F),F)),this}filter(U){return this.steps.push(F=>U(F)?F:x),this}reduce(U,F){let $=F;return this.steps.push(ce=>($=U($,ce),$)),this}latch(U=(F,$)=>F===$){let F=!0,$;return this.steps.push(ce=>{let Y=F||!U(ce,$);return F=!1,$=ce,Y?ce:x}),this}evaluate(U){for(let F of this.steps)if(U=F(U),U===x)break;return U}}function I(k,U,F=$=>$){let $=(...xe)=>j.fire(F(...xe)),ce=()=>k.on(U,$),Y=()=>k.removeListener(U,$),j=new Yt({onWillAddFirstListener:ce,onDidRemoveLastListener:Y});return j.event}P.fromNodeEventEmitter=I;function E(k,U,F=$=>$){let $=(...xe)=>j.fire(F(...xe)),ce=()=>k.addEventListener(U,$),Y=()=>k.removeEventListener(U,$),j=new Yt({onWillAddFirstListener:ce,onDidRemoveLastListener:Y});return j.event}P.fromDOMEventEmitter=E;function R(k){return new Promise(U=>n(k)(U))}P.toPromise=R;function B(k){let U=new Yt;return k.then(F=>{U.fire(F)},()=>{U.fire(void 0)}).finally(()=>{U.dispose()}),U.event}P.fromPromise=B;function V(k,U){return k(F=>U.fire(F))}P.forward=V;function M(k,U,F){return U(F),k($=>U($))}P.runAndSubscribe=M;class le{constructor(U,F){this._observable=U;this._counter=0;this._hasChanged=!1;let $={onWillAddFirstListener:()=>{U.addObserver(this),this._observable.reportChanges()},onDidRemoveLastListener:()=>{U.removeObserver(this)}};F||e($),this.emitter=new Yt($),F&&F.add(this.emitter)}beginUpdate(U){this._counter++}handlePossibleChange(U){}handleChange(U,F){this._hasChanged=!0}endUpdate(U){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function ne(k,U){return new le(k,U).emitter.event}P.fromObservable=ne;function q(k){return(U,F,$)=>{let ce=0,Y=!1,j={beginUpdate(){ce++},endUpdate(){ce--,ce===0&&(k.reportChanges(),Y&&(Y=!1,U.call(F)))},handlePossibleChange(){},handleChange(){Y=!0}};k.addObserver(j),k.reportChanges();let xe={dispose(){k.removeObserver(j)}};return $ instanceof ht?$.add(xe):Array.isArray($)&&$.push(xe),xe}}P.fromObservableLight=q})(Ed||={});var ej=class t{constructor(e){this.listenerCount=0;this.invocationCount=0;this.elapsedOverall=0;this.durations=[];this.name=`${e}_${t._idPool++}`,t.all.add(this)}static{this.all=new Set}static{this._idPool=0}start(e){this._stopWatch=new yo,this.listenerCount=e}stop(){if(this._stopWatch){let e=this._stopWatch.elapsed();this.durations.push(e),this.elapsedOverall+=e,this.invocationCount+=1,this._stopWatch=void 0}}},woe=-1;var tj=class t{constructor(e,r,n=(t._idPool++).toString(16).padStart(3,"0")){this._errorHandler=e;this.threshold=r;this.name=n;this._warnCountdown=0}static{this._idPool=1}dispose(){this._stacks?.clear()}check(e,r){let n=this.threshold;if(n<=0||r<n)return;this._stacks||(this._stacks=new Map);let o=this._stacks.get(e.value)||0;if(this._stacks.set(e.value,o+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=n*.5;let[s,a]=this.getMostFrequentStack(),c=`[${this.name}] potential listener LEAK detected, having ${r} listeners already. MOST frequent listener (${a}):`;console.warn(c),console.warn(s);let u=new rj(c,s);this._errorHandler(u)}return()=>{let s=this._stacks.get(e.value)||0;this._stacks.set(e.value,s-1)}}getMostFrequentStack(){if(!this._stacks)return;let e,r=0;for(let[n,o]of this._stacks)(!e||r<o)&&(e=[n,o],r=o);return e}},CR=class t{constructor(e){this.value=e}static create(){let e=new Error;return new t(e.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},rj=class extends Error{constructor(e,r){super(e),this.name="ListenerLeakError",this.stack=r}},nj=class extends Error{constructor(e,r){super(e),this.name="ListenerRefusalError",this.stack=r}},d3e=0,Qx=class{constructor(e){this.value=e;this.id=d3e++}},p3e=2,f3e=(t,e)=>{if(t instanceof Qx)e(t);else for(let r=0;r<t.length;r++){let n=t[r];n&&e(n)}},QN;if(u3e){let t=[];setInterval(()=>{t.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(t.join(`
`)),t.length=0)},3e3),QN=new FinalizationRegistry(e=>{typeof e=="string"&&t.push(e)})}var Yt=class{constructor(e){this._size=0;this._options=e,this._leakageMon=woe>0||this._options?.leakWarningThreshold?new tj(e?.onListenerError??Mh,this._options?.leakWarningThreshold??woe):void 0,this._perfMon=this._options?._profName?new ej(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(Eoe){let e=this._listeners;queueMicrotask(()=>{f3e(e,r=>r.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(e,r,n)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let u=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(u);let l=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],d=new nj(`${u}. HINT: Stack shows most frequent listener (${l[1]}-times)`,l[0]);return(this._options?.onListenerError||Mh)(d),dt.None}if(this._disposed)return dt.None;r&&(e=e.bind(r));let o=new Qx(e),s,a;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(o.stack=CR.create(),s=this._leakageMon.check(o.stack,this._size+1)),Eoe&&(o.stack=a??CR.create()),this._listeners?this._listeners instanceof Qx?(this._deliveryQueue??=new ij,this._listeners=[this._listeners,o]):this._listeners.push(o):(this._options?.onWillAddFirstListener?.(this),this._listeners=o,this._options?.onDidAddFirstListener?.(this)),this._size++;let c=qa(()=>{QN?.unregister(c),s?.(),this._removeListener(o)});if(n instanceof ht?n.add(c):Array.isArray(n)&&n.push(c),QN){let u=new Error().stack.split(`
`).slice(2,3).join(`
`).trim(),l=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(u);QN.register(c,l?.[2]??u,c)}return c},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let r=this._listeners,n=r.indexOf(e);if(n===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,r[n]=void 0;let o=this._deliveryQueue.current===this;if(this._size*p3e<=r.length){let s=0;for(let a=0;a<r.length;a++)r[a]?r[s++]=r[a]:o&&(this._deliveryQueue.end--,s<this._deliveryQueue.i&&this._deliveryQueue.i--);r.length=s}}_deliver(e,r){if(!e)return;let n=this._options?.onListenerError||Mh;if(!n){e.value(r);return}try{e.value(r)}catch(o){n(o)}}_deliverQueue(e){let r=e.current._listeners;for(;e.i<e.end;)this._deliver(r[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof Qx)this._deliver(this._listeners,e);else{let r=this._deliveryQueue;r.enqueue(this,e,this._listeners.length),this._deliverQueue(r)}this._perfMon?.stop()}hasListeners(){return this._size>0}};var ij=class{constructor(){this.i=-1;this.end=0}enqueue(e,r,n){this.i=0,this.end=n,this.current=e,this.value=r}reset(){this.i=this.end,this.current=void 0,this.value=void 0}};var Roe=Object.freeze(function(t,e){let r=setTimeout(t.bind(e),0);return{dispose(){clearTimeout(r)}}}),Lr;(n=>{function t(o){return o===n.None||o===n.Cancelled||o instanceof Xx?!0:!o||typeof o!="object"?!1:typeof o.isCancellationRequested=="boolean"&&typeof o.onCancellationRequested=="function"}n.isCancellationToken=t,n.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Ed.None}),n.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Roe})})(Lr||={});var Xx=class{constructor(){this._isCancelled=!1;this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?Roe:(this._emitter||(this._emitter=new Yt),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},la=class{constructor(e){this._token=void 0;this._parentListener=void 0;this._parentListener=e&&e.onCancellationRequested(this.cancel,this)}get token(){return this._token||(this._token=new Xx),this._token}cancel(){this._token?this._token instanceof Xx&&this._token.cancel():this._token=Lr.Cancelled}dispose(e=!1){e&&this.cancel(),this._parentListener?.dispose(),this._token?this._token instanceof Xx&&this._token.dispose():this._token=Lr.None}};var Jx="en",eL=!1,tL=!1,TR=!1,m3e=!1,Poe=!1,oj=!1,h3e=!1,g3e=!1,v3e=!1,b3e=!1,XN,JN=Jx,koe=Jx,y3e,Df,Nf=globalThis,wc;typeof Nf.vscode<"u"&&typeof Nf.vscode.process<"u"?wc=Nf.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(wc=process);var Aoe=typeof wc?.versions?.electron=="string",_3e=Aoe&&wc?.type==="renderer";if(typeof wc=="object"){eL=wc.platform==="win32",tL=wc.platform==="darwin",TR=wc.platform==="linux",m3e=TR&&!!wc.env.SNAP&&!!wc.env.SNAP_REVISION,h3e=Aoe,v3e=!!wc.env.CI||!!wc.env.BUILD_ARTIFACTSTAGINGDIRECTORY,XN=Jx,JN=Jx;let t=wc.env.VSCODE_NLS_CONFIG;if(t)try{let e=JSON.parse(t);XN=e.userLocale,koe=e.osLocale,JN=e.resolvedLanguage||Jx,y3e=e.languagePack?.translationsConfigFile}catch{}Poe=!0}else typeof navigator=="object"&&!_3e?(Df=navigator.userAgent,eL=Df.indexOf("Windows")>=0,tL=Df.indexOf("Macintosh")>=0,g3e=(Df.indexOf("Macintosh")>=0||Df.indexOf("iPad")>=0||Df.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,TR=Df.indexOf("Linux")>=0,b3e=Df?.indexOf("Mobi")>=0,oj=!0,JN=globalThis._VSCODE_NLS_LANGUAGE||Jx,XN=navigator.language.toLowerCase(),koe=XN):console.error("Unable to resolve platform.");var ZN=0;tL?ZN=1:eL?ZN=3:TR&&(ZN=2);var Rd=eL,Doe=tL,Noe=TR;var Loe=Poe;var Ooe=oj,x3e=oj&&typeof Nf.importScripts=="function",Moe=x3e?Nf.origin:void 0;var Foe=ZN,wd=Df,qh=JN,S3e;(n=>{function t(){return qh}n.value=t;function e(){return qh.length===2?qh==="en":qh.length>=3?qh[0]==="e"&&qh[1]==="n"&&qh[2]==="-":!1}n.isDefaultVariant=e;function r(){return qh==="en"}n.isDefault=r})(S3e||={});var I3e=typeof Nf.postMessage=="function"&&!Nf.importScripts,Uoe=(()=>{if(I3e){let t=[];Nf.addEventListener("message",r=>{if(r.data&&r.data.vscodeScheduleAsyncWork)for(let n=0,o=t.length;n<o;n++){let s=t[n];if(s.id===r.data.vscodeScheduleAsyncWork){t.splice(n,1),s.callback();return}}});let e=0;return r=>{let n=++e;t.push({id:n,callback:r}),Nf.postMessage({vscodeScheduleAsyncWork:n},"*")}}return t=>setTimeout(t)})();var C3e=!!(wd&&wd.indexOf("Chrome")>=0),zmt=!!(wd&&wd.indexOf("Firefox")>=0),$mt=!!(!C3e&&wd&&wd.indexOf("Safari")>=0),Wmt=!!(wd&&wd.indexOf("Edg/")>=0),Kmt=!!(wd&&wd.indexOf("Android")>=0);var Bb,sj=globalThis.vscode;if(typeof sj<"u"&&typeof sj.process<"u"){let t=sj.process;Bb={get platform(){return t.platform},get arch(){return t.arch},get env(){return t.env},cwd(){return t.cwd()}}}else typeof process<"u"&&typeof process?.versions?.node=="string"?Bb={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:Bb={get platform(){return Rd?"win32":Doe?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var ER=Bb.cwd,Boe=Bb.env,qoe=Bb.platform,Xmt=Bb.arch;var w3e=65,R3e=97,k3e=90,P3e=122,Vh=46,Bo=47,ja=92,jh=58,A3e=63,rL=class extends Error{constructor(e,r,n){let o;typeof r=="string"&&r.indexOf("not ")===0?(o="must not be",r=r.replace(/^not /,"")):o="must be";let s=e.indexOf(".")!==-1?"property":"argument",a=`The "${e}" ${s} ${o} of type ${r}`;a+=`. Received type ${typeof n}`,super(a),this.code="ERR_INVALID_ARG_TYPE"}};function D3e(t,e){if(t===null||typeof t!="object")throw new rL(e,"Object",t)}function Ii(t,e){if(typeof t!="string")throw new rL(e,"string",t)}var Ha=qoe==="win32";function ir(t){return t===Bo||t===ja}function aj(t){return t===Bo}function Hh(t){return t>=w3e&&t<=k3e||t>=R3e&&t<=P3e}function nL(t,e,r,n){let o="",s=0,a=-1,c=0,u=0;for(let l=0;l<=t.length;++l){if(l<t.length)u=t.charCodeAt(l);else{if(n(u))break;u=Bo}if(n(u)){if(!(a===l-1||c===1))if(c===2){if(o.length<2||s!==2||o.charCodeAt(o.length-1)!==Vh||o.charCodeAt(o.length-2)!==Vh){if(o.length>2){let d=o.lastIndexOf(r);d===-1?(o="",s=0):(o=o.slice(0,d),s=o.length-1-o.lastIndexOf(r)),a=l,c=0;continue}else if(o.length!==0){o="",s=0,a=l,c=0;continue}}e&&(o+=o.length>0?`${r}..`:"..",s=2)}else o.length>0?o+=`${r}${t.slice(a+1,l)}`:o=t.slice(a+1,l),s=l-a-1;a=l,c=0}else u===Vh&&c!==-1?++c:c=-1}return o}function N3e(t){return t?`${t[0]==="."?"":"."}${t}`:""}function joe(t,e){D3e(e,"pathObject");let r=e.dir||e.root,n=e.base||`${e.name||""}${N3e(e.ext)}`;return r?r===e.root?`${r}${n}`:`${r}${t}${n}`:n}var Ci={resolve(...t){let e="",r="",n=!1;for(let o=t.length-1;o>=-1;o--){let s;if(o>=0){if(s=t[o],Ii(s,`paths[${o}]`),s.length===0)continue}else e.length===0?s=ER():(s=Boe[`=${e}`]||ER(),(s===void 0||s.slice(0,2).toLowerCase()!==e.toLowerCase()&&s.charCodeAt(2)===ja)&&(s=`${e}\\`));let a=s.length,c=0,u="",l=!1,d=s.charCodeAt(0);if(a===1)ir(d)&&(c=1,l=!0);else if(ir(d))if(l=!0,ir(s.charCodeAt(1))){let p=2,f=p;for(;p<a&&!ir(s.charCodeAt(p));)p++;if(p<a&&p!==f){let m=s.slice(f,p);for(f=p;p<a&&ir(s.charCodeAt(p));)p++;if(p<a&&p!==f){for(f=p;p<a&&!ir(s.charCodeAt(p));)p++;(p===a||p!==f)&&(u=`\\\\${m}\\${s.slice(f,p)}`,c=p)}}}else c=1;else Hh(d)&&s.charCodeAt(1)===jh&&(u=s.slice(0,2),c=2,a>2&&ir(s.charCodeAt(2))&&(l=!0,c=3));if(u.length>0)if(e.length>0){if(u.toLowerCase()!==e.toLowerCase())continue}else e=u;if(n){if(e.length>0)break}else if(r=`${s.slice(c)}\\${r}`,n=l,l&&e.length>0)break}return r=nL(r,!n,"\\",ir),n?`${e}\\${r}`:`${e}${r}`||"."},normalize(t){Ii(t,"path");let e=t.length;if(e===0)return".";let r=0,n,o=!1,s=t.charCodeAt(0);if(e===1)return aj(s)?"\\":t;if(ir(s))if(o=!0,ir(t.charCodeAt(1))){let c=2,u=c;for(;c<e&&!ir(t.charCodeAt(c));)c++;if(c<e&&c!==u){let l=t.slice(u,c);for(u=c;c<e&&ir(t.charCodeAt(c));)c++;if(c<e&&c!==u){for(u=c;c<e&&!ir(t.charCodeAt(c));)c++;if(c===e)return`\\\\${l}\\${t.slice(u)}\\`;c!==u&&(n=`\\\\${l}\\${t.slice(u,c)}`,r=c)}}}else r=1;else Hh(s)&&t.charCodeAt(1)===jh&&(n=t.slice(0,2),r=2,e>2&&ir(t.charCodeAt(2))&&(o=!0,r=3));let a=r<e?nL(t.slice(r),!o,"\\",ir):"";return a.length===0&&!o&&(a="."),a.length>0&&ir(t.charCodeAt(e-1))&&(a+="\\"),n===void 0?o?`\\${a}`:a:o?`${n}\\${a}`:`${n}${a}`},isAbsolute(t){Ii(t,"path");let e=t.length;if(e===0)return!1;let r=t.charCodeAt(0);return ir(r)||e>2&&Hh(r)&&t.charCodeAt(1)===jh&&ir(t.charCodeAt(2))},join(...t){if(t.length===0)return".";let e,r;for(let s=0;s<t.length;++s){let a=t[s];Ii(a,"path"),a.length>0&&(e===void 0?e=r=a:e+=`\\${a}`)}if(e===void 0)return".";let n=!0,o=0;if(typeof r=="string"&&ir(r.charCodeAt(0))){++o;let s=r.length;s>1&&ir(r.charCodeAt(1))&&(++o,s>2&&(ir(r.charCodeAt(2))?++o:n=!1))}if(n){for(;o<e.length&&ir(e.charCodeAt(o));)o++;o>=2&&(e=`\\${e.slice(o)}`)}return Ci.normalize(e)},relative(t,e){if(Ii(t,"from"),Ii(e,"to"),t===e)return"";let r=Ci.resolve(t),n=Ci.resolve(e);if(r===n||(t=r.toLowerCase(),e=n.toLowerCase(),t===e))return"";let o=0;for(;o<t.length&&t.charCodeAt(o)===ja;)o++;let s=t.length;for(;s-1>o&&t.charCodeAt(s-1)===ja;)s--;let a=s-o,c=0;for(;c<e.length&&e.charCodeAt(c)===ja;)c++;let u=e.length;for(;u-1>c&&e.charCodeAt(u-1)===ja;)u--;let l=u-c,d=a<l?a:l,p=-1,f=0;for(;f<d;f++){let h=t.charCodeAt(o+f);if(h!==e.charCodeAt(c+f))break;h===ja&&(p=f)}if(f!==d){if(p===-1)return n}else{if(l>d){if(e.charCodeAt(c+f)===ja)return n.slice(c+f+1);if(f===2)return n.slice(c+f)}a>d&&(t.charCodeAt(o+f)===ja?p=f:f===2&&(p=3)),p===-1&&(p=0)}let m="";for(f=o+p+1;f<=s;++f)(f===s||t.charCodeAt(f)===ja)&&(m+=m.length===0?"..":"\\..");return c+=p,m.length>0?`${m}${n.slice(c,u)}`:(n.charCodeAt(c)===ja&&++c,n.slice(c,u))},toNamespacedPath(t){if(typeof t!="string"||t.length===0)return t;let e=Ci.resolve(t);if(e.length<=2)return t;if(e.charCodeAt(0)===ja){if(e.charCodeAt(1)===ja){let r=e.charCodeAt(2);if(r!==A3e&&r!==Vh)return`\\\\?\\UNC\\${e.slice(2)}`}}else if(Hh(e.charCodeAt(0))&&e.charCodeAt(1)===jh&&e.charCodeAt(2)===ja)return`\\\\?\\${e}`;return t},dirname(t){Ii(t,"path");let e=t.length;if(e===0)return".";let r=-1,n=0,o=t.charCodeAt(0);if(e===1)return ir(o)?t:".";if(ir(o)){if(r=n=1,ir(t.charCodeAt(1))){let c=2,u=c;for(;c<e&&!ir(t.charCodeAt(c));)c++;if(c<e&&c!==u){for(u=c;c<e&&ir(t.charCodeAt(c));)c++;if(c<e&&c!==u){for(u=c;c<e&&!ir(t.charCodeAt(c));)c++;if(c===e)return t;c!==u&&(r=n=c+1)}}}}else Hh(o)&&t.charCodeAt(1)===jh&&(r=e>2&&ir(t.charCodeAt(2))?3:2,n=r);let s=-1,a=!0;for(let c=e-1;c>=n;--c)if(ir(t.charCodeAt(c))){if(!a){s=c;break}}else a=!1;if(s===-1){if(r===-1)return".";s=r}return t.slice(0,s)},basename(t,e){e!==void 0&&Ii(e,"suffix"),Ii(t,"path");let r=0,n=-1,o=!0,s;if(t.length>=2&&Hh(t.charCodeAt(0))&&t.charCodeAt(1)===jh&&(r=2),e!==void 0&&e.length>0&&e.length<=t.length){if(e===t)return"";let a=e.length-1,c=-1;for(s=t.length-1;s>=r;--s){let u=t.charCodeAt(s);if(ir(u)){if(!o){r=s+1;break}}else c===-1&&(o=!1,c=s+1),a>=0&&(u===e.charCodeAt(a)?--a===-1&&(n=s):(a=-1,n=c))}return r===n?n=c:n===-1&&(n=t.length),t.slice(r,n)}for(s=t.length-1;s>=r;--s)if(ir(t.charCodeAt(s))){if(!o){r=s+1;break}}else n===-1&&(o=!1,n=s+1);return n===-1?"":t.slice(r,n)},extname(t){Ii(t,"path");let e=0,r=-1,n=0,o=-1,s=!0,a=0;t.length>=2&&t.charCodeAt(1)===jh&&Hh(t.charCodeAt(0))&&(e=n=2);for(let c=t.length-1;c>=e;--c){let u=t.charCodeAt(c);if(ir(u)){if(!s){n=c+1;break}continue}o===-1&&(s=!1,o=c+1),u===Vh?r===-1?r=c:a!==1&&(a=1):r!==-1&&(a=-1)}return r===-1||o===-1||a===0||a===1&&r===o-1&&r===n+1?"":t.slice(r,o)},format:joe.bind(null,"\\"),parse(t){Ii(t,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;let r=t.length,n=0,o=t.charCodeAt(0);if(r===1)return ir(o)?(e.root=e.dir=t,e):(e.base=e.name=t,e);if(ir(o)){if(n=1,ir(t.charCodeAt(1))){let p=2,f=p;for(;p<r&&!ir(t.charCodeAt(p));)p++;if(p<r&&p!==f){for(f=p;p<r&&ir(t.charCodeAt(p));)p++;if(p<r&&p!==f){for(f=p;p<r&&!ir(t.charCodeAt(p));)p++;p===r?n=p:p!==f&&(n=p+1)}}}}else if(Hh(o)&&t.charCodeAt(1)===jh){if(r<=2)return e.root=e.dir=t,e;if(n=2,ir(t.charCodeAt(2))){if(r===3)return e.root=e.dir=t,e;n=3}}n>0&&(e.root=t.slice(0,n));let s=-1,a=n,c=-1,u=!0,l=t.length-1,d=0;for(;l>=n;--l){if(o=t.charCodeAt(l),ir(o)){if(!u){a=l+1;break}continue}c===-1&&(u=!1,c=l+1),o===Vh?s===-1?s=l:d!==1&&(d=1):s!==-1&&(d=-1)}return c!==-1&&(s===-1||d===0||d===1&&s===c-1&&s===a+1?e.base=e.name=t.slice(a,c):(e.name=t.slice(a,s),e.base=t.slice(a,c),e.ext=t.slice(s,c))),a>0&&a!==n?e.dir=t.slice(0,a-1):e.dir=e.root,e},sep:"\\",delimiter:";",win32:null,posix:null},L3e=(()=>{if(Ha){let t=/\\/g;return()=>{let e=ER().replace(t,"/");return e.slice(e.indexOf("/"))}}return()=>ER()})(),wr={resolve(...t){let e="",r=!1;for(let n=t.length-1;n>=-1&&!r;n--){let o=n>=0?t[n]:L3e();Ii(o,`paths[${n}]`),o.length!==0&&(e=`${o}/${e}`,r=o.charCodeAt(0)===Bo)}return e=nL(e,!r,"/",aj),r?`/${e}`:e.length>0?e:"."},normalize(t){if(Ii(t,"path"),t.length===0)return".";let e=t.charCodeAt(0)===Bo,r=t.charCodeAt(t.length-1)===Bo;return t=nL(t,!e,"/",aj),t.length===0?e?"/":r?"./":".":(r&&(t+="/"),e?`/${t}`:t)},isAbsolute(t){return Ii(t,"path"),t.length>0&&t.charCodeAt(0)===Bo},join(...t){if(t.length===0)return".";let e;for(let r=0;r<t.length;++r){let n=t[r];Ii(n,"path"),n.length>0&&(e===void 0?e=n:e+=`/${n}`)}return e===void 0?".":wr.normalize(e)},relative(t,e){if(Ii(t,"from"),Ii(e,"to"),t===e||(t=wr.resolve(t),e=wr.resolve(e),t===e))return"";let r=1,n=t.length,o=n-r,s=1,a=e.length-s,c=o<a?o:a,u=-1,l=0;for(;l<c;l++){let p=t.charCodeAt(r+l);if(p!==e.charCodeAt(s+l))break;p===Bo&&(u=l)}if(l===c)if(a>c){if(e.charCodeAt(s+l)===Bo)return e.slice(s+l+1);if(l===0)return e.slice(s+l)}else o>c&&(t.charCodeAt(r+l)===Bo?u=l:l===0&&(u=0));let d="";for(l=r+u+1;l<=n;++l)(l===n||t.charCodeAt(l)===Bo)&&(d+=d.length===0?"..":"/..");return`${d}${e.slice(s+u)}`},toNamespacedPath(t){return t},dirname(t){if(Ii(t,"path"),t.length===0)return".";let e=t.charCodeAt(0)===Bo,r=-1,n=!0;for(let o=t.length-1;o>=1;--o)if(t.charCodeAt(o)===Bo){if(!n){r=o;break}}else n=!1;return r===-1?e?"/":".":e&&r===1?"//":t.slice(0,r)},basename(t,e){e!==void 0&&Ii(e,"ext"),Ii(t,"path");let r=0,n=-1,o=!0,s;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e===t)return"";let a=e.length-1,c=-1;for(s=t.length-1;s>=0;--s){let u=t.charCodeAt(s);if(u===Bo){if(!o){r=s+1;break}}else c===-1&&(o=!1,c=s+1),a>=0&&(u===e.charCodeAt(a)?--a===-1&&(n=s):(a=-1,n=c))}return r===n?n=c:n===-1&&(n=t.length),t.slice(r,n)}for(s=t.length-1;s>=0;--s)if(t.charCodeAt(s)===Bo){if(!o){r=s+1;break}}else n===-1&&(o=!1,n=s+1);return n===-1?"":t.slice(r,n)},extname(t){Ii(t,"path");let e=-1,r=0,n=-1,o=!0,s=0;for(let a=t.length-1;a>=0;--a){let c=t.charCodeAt(a);if(c===Bo){if(!o){r=a+1;break}continue}n===-1&&(o=!1,n=a+1),c===Vh?e===-1?e=a:s!==1&&(s=1):e!==-1&&(s=-1)}return e===-1||n===-1||s===0||s===1&&e===n-1&&e===r+1?"":t.slice(e,n)},format:joe.bind(null,"/"),parse(t){Ii(t,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;let r=t.charCodeAt(0)===Bo,n;r?(e.root="/",n=1):n=0;let o=-1,s=0,a=-1,c=!0,u=t.length-1,l=0;for(;u>=n;--u){let d=t.charCodeAt(u);if(d===Bo){if(!c){s=u+1;break}continue}a===-1&&(c=!1,a=u+1),d===Vh?o===-1?o=u:l!==1&&(l=1):o!==-1&&(l=-1)}if(a!==-1){let d=s===0&&r?1:s;o===-1||l===0||l===1&&o===a-1&&o===s+1?e.base=e.name=t.slice(d,a):(e.name=t.slice(d,o),e.base=t.slice(d,a),e.ext=t.slice(o,a))}return s>0?e.dir=t.slice(0,s-1):r&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};wr.win32=Ci.win32=Ci;wr.posix=Ci.posix=wr;var cj=Ha?Ci.normalize:wr.normalize,O3e=Ha?Ci.isAbsolute:wr.isAbsolute,M3e=Ha?Ci.join:wr.join,Hoe=Ha?Ci.resolve:wr.resolve,Voe=Ha?Ci.relative:wr.relative,iL=Ha?Ci.dirname:wr.dirname,oL=Ha?Ci.basename:wr.basename,Jmt=Ha?Ci.extname:wr.extname,Zmt=Ha?Ci.format:wr.format,eht=Ha?Ci.parse:wr.parse,tht=Ha?Ci.toNamespacedPath:wr.toNamespacedPath,Zx=Ha?Ci.sep:wr.sep,rht=Ha?Ci.delimiter:wr.delimiter;function Goe(t){return t}var aL=class{constructor(e,r){this.lastCache=void 0;this.lastArgKey=void 0;typeof e=="function"?(this._fn=e,this._computeKey=Goe):(this._fn=r,this._computeKey=e.getCacheKey)}get(e){let r=this._computeKey(e);return this.lastArgKey!==r&&(this.lastArgKey=r,this.lastCache=this._fn(e)),this.lastCache}},qb=class{constructor(e,r){this._map=new Map;this._map2=new Map;typeof e=="function"?(this._fn=e,this._computeKey=Goe):(this._fn=r,this._computeKey=e.getCacheKey)}get cachedValues(){return this._map}get(e){let r=this._computeKey(e);if(this._map2.has(r))return this._map2.get(r);let n=this._fn(e);return this._map.set(e,n),this._map2.set(r,n),n}};var Ti=class{constructor(e){this.executor=e;this._didRun=!1}get hasValue(){return this._didRun}get value(){if(!this._didRun)try{this._value=this.executor()}catch(e){this._error=e}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}};function jb(t){return t<0?0:t>4294967295?4294967295:t|0}function Yoe(t){return!t||typeof t!="string"?!0:t.trim().length===0}function Vb(t){return t.replace(/[\\\{\}\*\+\?\|\^\$\.\[\]\(\)]/g,"\\$&")}function eS(t,e){let r=0,n=t.indexOf(e);for(;n!==-1;)r++,n=t.indexOf(e,n+e.length);return r}function Gb(t){return t.split(/\r\n|\r|\n/)}function Qoe(t){for(let e=0,r=t.length;e<r;e++){let n=t.charCodeAt(e);if(n!==32&&n!==9)return e}return-1}function zb(t,e,r){let n=[],o=0;for(let s of t.matchAll(e)){if(n.push(t.slice(o,s.index)),s.index===void 0)throw new Error("match.index should be defined");o=s.index+s[0].length,n.push(r(s[0],...s.slice(1),s.index,t,s.groups))}return n.push(t.slice(o)),Promise.all(n).then(s=>s.join(""))}function Xoe(t,e){return t<e?-1:t>e?1:0}function U3e(t,e,r=0,n=t.length,o=0,s=e.length){for(;r<n&&o<s;r++,o++){let u=t.charCodeAt(r),l=e.charCodeAt(o);if(u<l)return-1;if(u>l)return 1}let a=n-r,c=s-o;return a<c?-1:a>c?1:0}function Joe(t,e,r=0,n=t.length,o=0,s=e.length){for(;r<n&&o<s;r++,o++){let u=t.charCodeAt(r),l=e.charCodeAt(o);if(u===l)continue;if(u>=128||l>=128)return U3e(t.toLowerCase(),e.toLowerCase(),r,n,o,s);zoe(u)&&(u-=32),zoe(l)&&(l-=32);let d=u-l;if(d!==0)return d}let a=n-r,c=s-o;return a<c?-1:a>c?1:0}function zoe(t){return t>=97&&t<=122}function cL(t,e){return t.length===e.length&&Joe(t,e)===0}function uj(t,e){let r=e.length;return e.length>t.length?!1:Joe(t,e,0,r)===0}function uL(t,e){let r=Math.min(t.length,e.length),n;for(n=0;n<r;n++)if(t.charCodeAt(n)!==e.charCodeAt(n))return n;return r}function Zoe(t,e){let r=Math.min(t.length,e.length),n,o=t.length-1,s=e.length-1;for(n=0;n<r;n++)if(t.charCodeAt(o-n)!==e.charCodeAt(s-n))return n;return r}var B3e=/^[\t\n\r\x20-\x7E]*$/;function lj(t){return B3e.test(t)}var pht=String.fromCharCode(65279);var $oe=class t{static{this._INSTANCE=null}static getInstance(){return t._INSTANCE||(t._INSTANCE=new t),t._INSTANCE}constructor(){this._data=q3e()}getGraphemeBreakType(e){if(e<32)return e===10?3:e===13?2:4;if(e<127)return 0;let r=this._data,n=r.length/3,o=1;for(;o<=n;)if(e<r[3*o])o=2*o;else if(e>r[3*o+1])o=2*o+1;else return r[3*o+2];return 0}};function q3e(){return JSON.parse("[0,0,0,51229,51255,12,44061,44087,12,127462,127487,6,7083,7085,5,47645,47671,12,54813,54839,12,128678,128678,14,3270,3270,5,9919,9923,14,45853,45879,12,49437,49463,12,53021,53047,12,71216,71218,7,128398,128399,14,129360,129374,14,2519,2519,5,4448,4519,9,9742,9742,14,12336,12336,14,44957,44983,12,46749,46775,12,48541,48567,12,50333,50359,12,52125,52151,12,53917,53943,12,69888,69890,5,73018,73018,5,127990,127990,14,128558,128559,14,128759,128760,14,129653,129655,14,2027,2035,5,2891,2892,7,3761,3761,5,6683,6683,5,8293,8293,4,9825,9826,14,9999,9999,14,43452,43453,5,44509,44535,12,45405,45431,12,46301,46327,12,47197,47223,12,48093,48119,12,48989,49015,12,49885,49911,12,50781,50807,12,51677,51703,12,52573,52599,12,53469,53495,12,54365,54391,12,65279,65279,4,70471,70472,7,72145,72147,7,119173,119179,5,127799,127818,14,128240,128244,14,128512,128512,14,128652,128652,14,128721,128722,14,129292,129292,14,129445,129450,14,129734,129743,14,1476,1477,5,2366,2368,7,2750,2752,7,3076,3076,5,3415,3415,5,4141,4144,5,6109,6109,5,6964,6964,5,7394,7400,5,9197,9198,14,9770,9770,14,9877,9877,14,9968,9969,14,10084,10084,14,43052,43052,5,43713,43713,5,44285,44311,12,44733,44759,12,45181,45207,12,45629,45655,12,46077,46103,12,46525,46551,12,46973,46999,12,47421,47447,12,47869,47895,12,48317,48343,12,48765,48791,12,49213,49239,12,49661,49687,12,50109,50135,12,50557,50583,12,51005,51031,12,51453,51479,12,51901,51927,12,52349,52375,12,52797,52823,12,53245,53271,12,53693,53719,12,54141,54167,12,54589,54615,12,55037,55063,12,69506,69509,5,70191,70193,5,70841,70841,7,71463,71467,5,72330,72342,5,94031,94031,5,123628,123631,5,127763,127765,14,127941,127941,14,128043,128062,14,128302,128317,14,128465,128467,14,128539,128539,14,128640,128640,14,128662,128662,14,128703,128703,14,128745,128745,14,129004,129007,14,129329,129330,14,129402,129402,14,129483,129483,14,129686,129704,14,130048,131069,14,173,173,4,1757,1757,1,2200,2207,5,2434,2435,7,2631,2632,5,2817,2817,5,3008,3008,5,3201,3201,5,3387,3388,5,3542,3542,5,3902,3903,7,4190,4192,5,6002,6003,5,6439,6440,5,6765,6770,7,7019,7027,5,7154,7155,7,8205,8205,13,8505,8505,14,9654,9654,14,9757,9757,14,9792,9792,14,9852,9853,14,9890,9894,14,9937,9937,14,9981,9981,14,10035,10036,14,11035,11036,14,42654,42655,5,43346,43347,7,43587,43587,5,44006,44007,7,44173,44199,12,44397,44423,12,44621,44647,12,44845,44871,12,45069,45095,12,45293,45319,12,45517,45543,12,45741,45767,12,45965,45991,12,46189,46215,12,46413,46439,12,46637,46663,12,46861,46887,12,47085,47111,12,47309,47335,12,47533,47559,12,47757,47783,12,47981,48007,12,48205,48231,12,48429,48455,12,48653,48679,12,48877,48903,12,49101,49127,12,49325,49351,12,49549,49575,12,49773,49799,12,49997,50023,12,50221,50247,12,50445,50471,12,50669,50695,12,50893,50919,12,51117,51143,12,51341,51367,12,51565,51591,12,51789,51815,12,52013,52039,12,52237,52263,12,52461,52487,12,52685,52711,12,52909,52935,12,53133,53159,12,53357,53383,12,53581,53607,12,53805,53831,12,54029,54055,12,54253,54279,12,54477,54503,12,54701,54727,12,54925,54951,12,55149,55175,12,68101,68102,5,69762,69762,7,70067,70069,7,70371,70378,5,70720,70721,7,71087,71087,5,71341,71341,5,71995,71996,5,72249,72249,7,72850,72871,5,73109,73109,5,118576,118598,5,121505,121519,5,127245,127247,14,127568,127569,14,127777,127777,14,127872,127891,14,127956,127967,14,128015,128016,14,128110,128172,14,128259,128259,14,128367,128368,14,128424,128424,14,128488,128488,14,128530,128532,14,128550,128551,14,128566,128566,14,128647,128647,14,128656,128656,14,128667,128673,14,128691,128693,14,128715,128715,14,128728,128732,14,128752,128752,14,128765,128767,14,129096,129103,14,129311,129311,14,129344,129349,14,129394,129394,14,129413,129425,14,129466,129471,14,129511,129535,14,129664,129666,14,129719,129722,14,129760,129767,14,917536,917631,5,13,13,2,1160,1161,5,1564,1564,4,1807,1807,1,2085,2087,5,2307,2307,7,2382,2383,7,2497,2500,5,2563,2563,7,2677,2677,5,2763,2764,7,2879,2879,5,2914,2915,5,3021,3021,5,3142,3144,5,3263,3263,5,3285,3286,5,3398,3400,7,3530,3530,5,3633,3633,5,3864,3865,5,3974,3975,5,4155,4156,7,4229,4230,5,5909,5909,7,6078,6085,7,6277,6278,5,6451,6456,7,6744,6750,5,6846,6846,5,6972,6972,5,7074,7077,5,7146,7148,7,7222,7223,5,7416,7417,5,8234,8238,4,8417,8417,5,9000,9000,14,9203,9203,14,9730,9731,14,9748,9749,14,9762,9763,14,9776,9783,14,9800,9811,14,9831,9831,14,9872,9873,14,9882,9882,14,9900,9903,14,9929,9933,14,9941,9960,14,9974,9974,14,9989,9989,14,10006,10006,14,10062,10062,14,10160,10160,14,11647,11647,5,12953,12953,14,43019,43019,5,43232,43249,5,43443,43443,5,43567,43568,7,43696,43696,5,43765,43765,7,44013,44013,5,44117,44143,12,44229,44255,12,44341,44367,12,44453,44479,12,44565,44591,12,44677,44703,12,44789,44815,12,44901,44927,12,45013,45039,12,45125,45151,12,45237,45263,12,45349,45375,12,45461,45487,12,45573,45599,12,45685,45711,12,45797,45823,12,45909,45935,12,46021,46047,12,46133,46159,12,46245,46271,12,46357,46383,12,46469,46495,12,46581,46607,12,46693,46719,12,46805,46831,12,46917,46943,12,47029,47055,12,47141,47167,12,47253,47279,12,47365,47391,12,47477,47503,12,47589,47615,12,47701,47727,12,47813,47839,12,47925,47951,12,48037,48063,12,48149,48175,12,48261,48287,12,48373,48399,12,48485,48511,12,48597,48623,12,48709,48735,12,48821,48847,12,48933,48959,12,49045,49071,12,49157,49183,12,49269,49295,12,49381,49407,12,49493,49519,12,49605,49631,12,49717,49743,12,49829,49855,12,49941,49967,12,50053,50079,12,50165,50191,12,50277,50303,12,50389,50415,12,50501,50527,12,50613,50639,12,50725,50751,12,50837,50863,12,50949,50975,12,51061,51087,12,51173,51199,12,51285,51311,12,51397,51423,12,51509,51535,12,51621,51647,12,51733,51759,12,51845,51871,12,51957,51983,12,52069,52095,12,52181,52207,12,52293,52319,12,52405,52431,12,52517,52543,12,52629,52655,12,52741,52767,12,52853,52879,12,52965,52991,12,53077,53103,12,53189,53215,12,53301,53327,12,53413,53439,12,53525,53551,12,53637,53663,12,53749,53775,12,53861,53887,12,53973,53999,12,54085,54111,12,54197,54223,12,54309,54335,12,54421,54447,12,54533,54559,12,54645,54671,12,54757,54783,12,54869,54895,12,54981,55007,12,55093,55119,12,55243,55291,10,66045,66045,5,68325,68326,5,69688,69702,5,69817,69818,5,69957,69958,7,70089,70092,5,70198,70199,5,70462,70462,5,70502,70508,5,70750,70750,5,70846,70846,7,71100,71101,5,71230,71230,7,71351,71351,5,71737,71738,5,72000,72000,7,72160,72160,5,72273,72278,5,72752,72758,5,72882,72883,5,73031,73031,5,73461,73462,7,94192,94193,7,119149,119149,7,121403,121452,5,122915,122916,5,126980,126980,14,127358,127359,14,127535,127535,14,127759,127759,14,127771,127771,14,127792,127793,14,127825,127867,14,127897,127899,14,127945,127945,14,127985,127986,14,128000,128007,14,128021,128021,14,128066,128100,14,128184,128235,14,128249,128252,14,128266,128276,14,128335,128335,14,128379,128390,14,128407,128419,14,128444,128444,14,128481,128481,14,128499,128499,14,128526,128526,14,128536,128536,14,128543,128543,14,128556,128556,14,128564,128564,14,128577,128580,14,128643,128645,14,128649,128649,14,128654,128654,14,128660,128660,14,128664,128664,14,128675,128675,14,128686,128689,14,128695,128696,14,128705,128709,14,128717,128719,14,128725,128725,14,128736,128741,14,128747,128748,14,128755,128755,14,128762,128762,14,128981,128991,14,129009,129023,14,129160,129167,14,129296,129304,14,129320,129327,14,129340,129342,14,129356,129356,14,129388,129392,14,129399,129400,14,129404,129407,14,129432,129442,14,129454,129455,14,129473,129474,14,129485,129487,14,129648,129651,14,129659,129660,14,129671,129679,14,129709,129711,14,129728,129730,14,129751,129753,14,129776,129782,14,917505,917505,4,917760,917999,5,10,10,3,127,159,4,768,879,5,1471,1471,5,1536,1541,1,1648,1648,5,1767,1768,5,1840,1866,5,2070,2073,5,2137,2139,5,2274,2274,1,2363,2363,7,2377,2380,7,2402,2403,5,2494,2494,5,2507,2508,7,2558,2558,5,2622,2624,7,2641,2641,5,2691,2691,7,2759,2760,5,2786,2787,5,2876,2876,5,2881,2884,5,2901,2902,5,3006,3006,5,3014,3016,7,3072,3072,5,3134,3136,5,3157,3158,5,3260,3260,5,3266,3266,5,3274,3275,7,3328,3329,5,3391,3392,7,3405,3405,5,3457,3457,5,3536,3537,7,3551,3551,5,3636,3642,5,3764,3772,5,3895,3895,5,3967,3967,7,3993,4028,5,4146,4151,5,4182,4183,7,4226,4226,5,4253,4253,5,4957,4959,5,5940,5940,7,6070,6070,7,6087,6088,7,6158,6158,4,6432,6434,5,6448,6449,7,6679,6680,5,6742,6742,5,6754,6754,5,6783,6783,5,6912,6915,5,6966,6970,5,6978,6978,5,7042,7042,7,7080,7081,5,7143,7143,7,7150,7150,7,7212,7219,5,7380,7392,5,7412,7412,5,8203,8203,4,8232,8232,4,8265,8265,14,8400,8412,5,8421,8432,5,8617,8618,14,9167,9167,14,9200,9200,14,9410,9410,14,9723,9726,14,9733,9733,14,9745,9745,14,9752,9752,14,9760,9760,14,9766,9766,14,9774,9774,14,9786,9786,14,9794,9794,14,9823,9823,14,9828,9828,14,9833,9850,14,9855,9855,14,9875,9875,14,9880,9880,14,9885,9887,14,9896,9897,14,9906,9916,14,9926,9927,14,9935,9935,14,9939,9939,14,9962,9962,14,9972,9972,14,9978,9978,14,9986,9986,14,9997,9997,14,10002,10002,14,10017,10017,14,10055,10055,14,10071,10071,14,10133,10135,14,10548,10549,14,11093,11093,14,12330,12333,5,12441,12442,5,42608,42610,5,43010,43010,5,43045,43046,5,43188,43203,7,43302,43309,5,43392,43394,5,43446,43449,5,43493,43493,5,43571,43572,7,43597,43597,7,43703,43704,5,43756,43757,5,44003,44004,7,44009,44010,7,44033,44059,12,44089,44115,12,44145,44171,12,44201,44227,12,44257,44283,12,44313,44339,12,44369,44395,12,44425,44451,12,44481,44507,12,44537,44563,12,44593,44619,12,44649,44675,12,44705,44731,12,44761,44787,12,44817,44843,12,44873,44899,12,44929,44955,12,44985,45011,12,45041,45067,12,45097,45123,12,45153,45179,12,45209,45235,12,45265,45291,12,45321,45347,12,45377,45403,12,45433,45459,12,45489,45515,12,45545,45571,12,45601,45627,12,45657,45683,12,45713,45739,12,45769,45795,12,45825,45851,12,45881,45907,12,45937,45963,12,45993,46019,12,46049,46075,12,46105,46131,12,46161,46187,12,46217,46243,12,46273,46299,12,46329,46355,12,46385,46411,12,46441,46467,12,46497,46523,12,46553,46579,12,46609,46635,12,46665,46691,12,46721,46747,12,46777,46803,12,46833,46859,12,46889,46915,12,46945,46971,12,47001,47027,12,47057,47083,12,47113,47139,12,47169,47195,12,47225,47251,12,47281,47307,12,47337,47363,12,47393,47419,12,47449,47475,12,47505,47531,12,47561,47587,12,47617,47643,12,47673,47699,12,47729,47755,12,47785,47811,12,47841,47867,12,47897,47923,12,47953,47979,12,48009,48035,12,48065,48091,12,48121,48147,12,48177,48203,12,48233,48259,12,48289,48315,12,48345,48371,12,48401,48427,12,48457,48483,12,48513,48539,12,48569,48595,12,48625,48651,12,48681,48707,12,48737,48763,12,48793,48819,12,48849,48875,12,48905,48931,12,48961,48987,12,49017,49043,12,49073,49099,12,49129,49155,12,49185,49211,12,49241,49267,12,49297,49323,12,49353,49379,12,49409,49435,12,49465,49491,12,49521,49547,12,49577,49603,12,49633,49659,12,49689,49715,12,49745,49771,12,49801,49827,12,49857,49883,12,49913,49939,12,49969,49995,12,50025,50051,12,50081,50107,12,50137,50163,12,50193,50219,12,50249,50275,12,50305,50331,12,50361,50387,12,50417,50443,12,50473,50499,12,50529,50555,12,50585,50611,12,50641,50667,12,50697,50723,12,50753,50779,12,50809,50835,12,50865,50891,12,50921,50947,12,50977,51003,12,51033,51059,12,51089,51115,12,51145,51171,12,51201,51227,12,51257,51283,12,51313,51339,12,51369,51395,12,51425,51451,12,51481,51507,12,51537,51563,12,51593,51619,12,51649,51675,12,51705,51731,12,51761,51787,12,51817,51843,12,51873,51899,12,51929,51955,12,51985,52011,12,52041,52067,12,52097,52123,12,52153,52179,12,52209,52235,12,52265,52291,12,52321,52347,12,52377,52403,12,52433,52459,12,52489,52515,12,52545,52571,12,52601,52627,12,52657,52683,12,52713,52739,12,52769,52795,12,52825,52851,12,52881,52907,12,52937,52963,12,52993,53019,12,53049,53075,12,53105,53131,12,53161,53187,12,53217,53243,12,53273,53299,12,53329,53355,12,53385,53411,12,53441,53467,12,53497,53523,12,53553,53579,12,53609,53635,12,53665,53691,12,53721,53747,12,53777,53803,12,53833,53859,12,53889,53915,12,53945,53971,12,54001,54027,12,54057,54083,12,54113,54139,12,54169,54195,12,54225,54251,12,54281,54307,12,54337,54363,12,54393,54419,12,54449,54475,12,54505,54531,12,54561,54587,12,54617,54643,12,54673,54699,12,54729,54755,12,54785,54811,12,54841,54867,12,54897,54923,12,54953,54979,12,55009,55035,12,55065,55091,12,55121,55147,12,55177,55203,12,65024,65039,5,65520,65528,4,66422,66426,5,68152,68154,5,69291,69292,5,69633,69633,5,69747,69748,5,69811,69814,5,69826,69826,5,69932,69932,7,70016,70017,5,70079,70080,7,70095,70095,5,70196,70196,5,70367,70367,5,70402,70403,7,70464,70464,5,70487,70487,5,70709,70711,7,70725,70725,7,70833,70834,7,70843,70844,7,70849,70849,7,71090,71093,5,71103,71104,5,71227,71228,7,71339,71339,5,71344,71349,5,71458,71461,5,71727,71735,5,71985,71989,7,71998,71998,5,72002,72002,7,72154,72155,5,72193,72202,5,72251,72254,5,72281,72283,5,72344,72345,5,72766,72766,7,72874,72880,5,72885,72886,5,73023,73029,5,73104,73105,5,73111,73111,5,92912,92916,5,94095,94098,5,113824,113827,4,119142,119142,7,119155,119162,4,119362,119364,5,121476,121476,5,122888,122904,5,123184,123190,5,125252,125258,5,127183,127183,14,127340,127343,14,127377,127386,14,127491,127503,14,127548,127551,14,127744,127756,14,127761,127761,14,127769,127769,14,127773,127774,14,127780,127788,14,127796,127797,14,127820,127823,14,127869,127869,14,127894,127895,14,127902,127903,14,127943,127943,14,127947,127950,14,127972,127972,14,127988,127988,14,127992,127994,14,128009,128011,14,128019,128019,14,128023,128041,14,128064,128064,14,128102,128107,14,128174,128181,14,128238,128238,14,128246,128247,14,128254,128254,14,128264,128264,14,128278,128299,14,128329,128330,14,128348,128359,14,128371,128377,14,128392,128393,14,128401,128404,14,128421,128421,14,128433,128434,14,128450,128452,14,128476,128478,14,128483,128483,14,128495,128495,14,128506,128506,14,128519,128520,14,128528,128528,14,128534,128534,14,128538,128538,14,128540,128542,14,128544,128549,14,128552,128555,14,128557,128557,14,128560,128563,14,128565,128565,14,128567,128576,14,128581,128591,14,128641,128642,14,128646,128646,14,128648,128648,14,128650,128651,14,128653,128653,14,128655,128655,14,128657,128659,14,128661,128661,14,128663,128663,14,128665,128666,14,128674,128674,14,128676,128677,14,128679,128685,14,128690,128690,14,128694,128694,14,128697,128702,14,128704,128704,14,128710,128714,14,128716,128716,14,128720,128720,14,128723,128724,14,128726,128727,14,128733,128735,14,128742,128744,14,128746,128746,14,128749,128751,14,128753,128754,14,128756,128758,14,128761,128761,14,128763,128764,14,128884,128895,14,128992,129003,14,129008,129008,14,129036,129039,14,129114,129119,14,129198,129279,14,129293,129295,14,129305,129310,14,129312,129319,14,129328,129328,14,129331,129338,14,129343,129343,14,129351,129355,14,129357,129359,14,129375,129387,14,129393,129393,14,129395,129398,14,129401,129401,14,129403,129403,14,129408,129412,14,129426,129431,14,129443,129444,14,129451,129453,14,129456,129465,14,129472,129472,14,129475,129482,14,129484,129484,14,129488,129510,14,129536,129647,14,129652,129652,14,129656,129658,14,129661,129663,14,129667,129670,14,129680,129685,14,129705,129708,14,129712,129718,14,129723,129727,14,129731,129733,14,129744,129750,14,129754,129759,14,129768,129775,14,129783,129791,14,917504,917504,4,917506,917535,4,917632,917759,4,918000,921599,4,0,9,4,11,12,4,14,31,4,169,169,14,174,174,14,1155,1159,5,1425,1469,5,1473,1474,5,1479,1479,5,1552,1562,5,1611,1631,5,1750,1756,5,1759,1764,5,1770,1773,5,1809,1809,5,1958,1968,5,2045,2045,5,2075,2083,5,2089,2093,5,2192,2193,1,2250,2273,5,2275,2306,5,2362,2362,5,2364,2364,5,2369,2376,5,2381,2381,5,2385,2391,5,2433,2433,5,2492,2492,5,2495,2496,7,2503,2504,7,2509,2509,5,2530,2531,5,2561,2562,5,2620,2620,5,2625,2626,5,2635,2637,5,2672,2673,5,2689,2690,5,2748,2748,5,2753,2757,5,2761,2761,7,2765,2765,5,2810,2815,5,2818,2819,7,2878,2878,5,2880,2880,7,2887,2888,7,2893,2893,5,2903,2903,5,2946,2946,5,3007,3007,7,3009,3010,7,3018,3020,7,3031,3031,5,3073,3075,7,3132,3132,5,3137,3140,7,3146,3149,5,3170,3171,5,3202,3203,7,3262,3262,7,3264,3265,7,3267,3268,7,3271,3272,7,3276,3277,5,3298,3299,5,3330,3331,7,3390,3390,5,3393,3396,5,3402,3404,7,3406,3406,1,3426,3427,5,3458,3459,7,3535,3535,5,3538,3540,5,3544,3550,7,3570,3571,7,3635,3635,7,3655,3662,5,3763,3763,7,3784,3789,5,3893,3893,5,3897,3897,5,3953,3966,5,3968,3972,5,3981,3991,5,4038,4038,5,4145,4145,7,4153,4154,5,4157,4158,5,4184,4185,5,4209,4212,5,4228,4228,7,4237,4237,5,4352,4447,8,4520,4607,10,5906,5908,5,5938,5939,5,5970,5971,5,6068,6069,5,6071,6077,5,6086,6086,5,6089,6099,5,6155,6157,5,6159,6159,5,6313,6313,5,6435,6438,7,6441,6443,7,6450,6450,5,6457,6459,5,6681,6682,7,6741,6741,7,6743,6743,7,6752,6752,5,6757,6764,5,6771,6780,5,6832,6845,5,6847,6862,5,6916,6916,7,6965,6965,5,6971,6971,7,6973,6977,7,6979,6980,7,7040,7041,5,7073,7073,7,7078,7079,7,7082,7082,7,7142,7142,5,7144,7145,5,7149,7149,5,7151,7153,5,7204,7211,7,7220,7221,7,7376,7378,5,7393,7393,7,7405,7405,5,7415,7415,7,7616,7679,5,8204,8204,5,8206,8207,4,8233,8233,4,8252,8252,14,8288,8292,4,8294,8303,4,8413,8416,5,8418,8420,5,8482,8482,14,8596,8601,14,8986,8987,14,9096,9096,14,9193,9196,14,9199,9199,14,9201,9202,14,9208,9210,14,9642,9643,14,9664,9664,14,9728,9729,14,9732,9732,14,9735,9741,14,9743,9744,14,9746,9746,14,9750,9751,14,9753,9756,14,9758,9759,14,9761,9761,14,9764,9765,14,9767,9769,14,9771,9773,14,9775,9775,14,9784,9785,14,9787,9791,14,9793,9793,14,9795,9799,14,9812,9822,14,9824,9824,14,9827,9827,14,9829,9830,14,9832,9832,14,9851,9851,14,9854,9854,14,9856,9861,14,9874,9874,14,9876,9876,14,9878,9879,14,9881,9881,14,9883,9884,14,9888,9889,14,9895,9895,14,9898,9899,14,9904,9905,14,9917,9918,14,9924,9925,14,9928,9928,14,9934,9934,14,9936,9936,14,9938,9938,14,9940,9940,14,9961,9961,14,9963,9967,14,9970,9971,14,9973,9973,14,9975,9977,14,9979,9980,14,9982,9985,14,9987,9988,14,9992,9996,14,9998,9998,14,10000,10001,14,10004,10004,14,10013,10013,14,10024,10024,14,10052,10052,14,10060,10060,14,10067,10069,14,10083,10083,14,10085,10087,14,10145,10145,14,10175,10175,14,11013,11015,14,11088,11088,14,11503,11505,5,11744,11775,5,12334,12335,5,12349,12349,14,12951,12951,14,42607,42607,5,42612,42621,5,42736,42737,5,43014,43014,5,43043,43044,7,43047,43047,7,43136,43137,7,43204,43205,5,43263,43263,5,43335,43345,5,43360,43388,8,43395,43395,7,43444,43445,7,43450,43451,7,43454,43456,7,43561,43566,5,43569,43570,5,43573,43574,5,43596,43596,5,43644,43644,5,43698,43700,5,43710,43711,5,43755,43755,7,43758,43759,7,43766,43766,5,44005,44005,5,44008,44008,5,44012,44012,7,44032,44032,11,44060,44060,11,44088,44088,11,44116,44116,11,44144,44144,11,44172,44172,11,44200,44200,11,44228,44228,11,44256,44256,11,44284,44284,11,44312,44312,11,44340,44340,11,44368,44368,11,44396,44396,11,44424,44424,11,44452,44452,11,44480,44480,11,44508,44508,11,44536,44536,11,44564,44564,11,44592,44592,11,44620,44620,11,44648,44648,11,44676,44676,11,44704,44704,11,44732,44732,11,44760,44760,11,44788,44788,11,44816,44816,11,44844,44844,11,44872,44872,11,44900,44900,11,44928,44928,11,44956,44956,11,44984,44984,11,45012,45012,11,45040,45040,11,45068,45068,11,45096,45096,11,45124,45124,11,45152,45152,11,45180,45180,11,45208,45208,11,45236,45236,11,45264,45264,11,45292,45292,11,45320,45320,11,45348,45348,11,45376,45376,11,45404,45404,11,45432,45432,11,45460,45460,11,45488,45488,11,45516,45516,11,45544,45544,11,45572,45572,11,45600,45600,11,45628,45628,11,45656,45656,11,45684,45684,11,45712,45712,11,45740,45740,11,45768,45768,11,45796,45796,11,45824,45824,11,45852,45852,11,45880,45880,11,45908,45908,11,45936,45936,11,45964,45964,11,45992,45992,11,46020,46020,11,46048,46048,11,46076,46076,11,46104,46104,11,46132,46132,11,46160,46160,11,46188,46188,11,46216,46216,11,46244,46244,11,46272,46272,11,46300,46300,11,46328,46328,11,46356,46356,11,46384,46384,11,46412,46412,11,46440,46440,11,46468,46468,11,46496,46496,11,46524,46524,11,46552,46552,11,46580,46580,11,46608,46608,11,46636,46636,11,46664,46664,11,46692,46692,11,46720,46720,11,46748,46748,11,46776,46776,11,46804,46804,11,46832,46832,11,46860,46860,11,46888,46888,11,46916,46916,11,46944,46944,11,46972,46972,11,47000,47000,11,47028,47028,11,47056,47056,11,47084,47084,11,47112,47112,11,47140,47140,11,47168,47168,11,47196,47196,11,47224,47224,11,47252,47252,11,47280,47280,11,47308,47308,11,47336,47336,11,47364,47364,11,47392,47392,11,47420,47420,11,47448,47448,11,47476,47476,11,47504,47504,11,47532,47532,11,47560,47560,11,47588,47588,11,47616,47616,11,47644,47644,11,47672,47672,11,47700,47700,11,47728,47728,11,47756,47756,11,47784,47784,11,47812,47812,11,47840,47840,11,47868,47868,11,47896,47896,11,47924,47924,11,47952,47952,11,47980,47980,11,48008,48008,11,48036,48036,11,48064,48064,11,48092,48092,11,48120,48120,11,48148,48148,11,48176,48176,11,48204,48204,11,48232,48232,11,48260,48260,11,48288,48288,11,48316,48316,11,48344,48344,11,48372,48372,11,48400,48400,11,48428,48428,11,48456,48456,11,48484,48484,11,48512,48512,11,48540,48540,11,48568,48568,11,48596,48596,11,48624,48624,11,48652,48652,11,48680,48680,11,48708,48708,11,48736,48736,11,48764,48764,11,48792,48792,11,48820,48820,11,48848,48848,11,48876,48876,11,48904,48904,11,48932,48932,11,48960,48960,11,48988,48988,11,49016,49016,11,49044,49044,11,49072,49072,11,49100,49100,11,49128,49128,11,49156,49156,11,49184,49184,11,49212,49212,11,49240,49240,11,49268,49268,11,49296,49296,11,49324,49324,11,49352,49352,11,49380,49380,11,49408,49408,11,49436,49436,11,49464,49464,11,49492,49492,11,49520,49520,11,49548,49548,11,49576,49576,11,49604,49604,11,49632,49632,11,49660,49660,11,49688,49688,11,49716,49716,11,49744,49744,11,49772,49772,11,49800,49800,11,49828,49828,11,49856,49856,11,49884,49884,11,49912,49912,11,49940,49940,11,49968,49968,11,49996,49996,11,50024,50024,11,50052,50052,11,50080,50080,11,50108,50108,11,50136,50136,11,50164,50164,11,50192,50192,11,50220,50220,11,50248,50248,11,50276,50276,11,50304,50304,11,50332,50332,11,50360,50360,11,50388,50388,11,50416,50416,11,50444,50444,11,50472,50472,11,50500,50500,11,50528,50528,11,50556,50556,11,50584,50584,11,50612,50612,11,50640,50640,11,50668,50668,11,50696,50696,11,50724,50724,11,50752,50752,11,50780,50780,11,50808,50808,11,50836,50836,11,50864,50864,11,50892,50892,11,50920,50920,11,50948,50948,11,50976,50976,11,51004,51004,11,51032,51032,11,51060,51060,11,51088,51088,11,51116,51116,11,51144,51144,11,51172,51172,11,51200,51200,11,51228,51228,11,51256,51256,11,51284,51284,11,51312,51312,11,51340,51340,11,51368,51368,11,51396,51396,11,51424,51424,11,51452,51452,11,51480,51480,11,51508,51508,11,51536,51536,11,51564,51564,11,51592,51592,11,51620,51620,11,51648,51648,11,51676,51676,11,51704,51704,11,51732,51732,11,51760,51760,11,51788,51788,11,51816,51816,11,51844,51844,11,51872,51872,11,51900,51900,11,51928,51928,11,51956,51956,11,51984,51984,11,52012,52012,11,52040,52040,11,52068,52068,11,52096,52096,11,52124,52124,11,52152,52152,11,52180,52180,11,52208,52208,11,52236,52236,11,52264,52264,11,52292,52292,11,52320,52320,11,52348,52348,11,52376,52376,11,52404,52404,11,52432,52432,11,52460,52460,11,52488,52488,11,52516,52516,11,52544,52544,11,52572,52572,11,52600,52600,11,52628,52628,11,52656,52656,11,52684,52684,11,52712,52712,11,52740,52740,11,52768,52768,11,52796,52796,11,52824,52824,11,52852,52852,11,52880,52880,11,52908,52908,11,52936,52936,11,52964,52964,11,52992,52992,11,53020,53020,11,53048,53048,11,53076,53076,11,53104,53104,11,53132,53132,11,53160,53160,11,53188,53188,11,53216,53216,11,53244,53244,11,53272,53272,11,53300,53300,11,53328,53328,11,53356,53356,11,53384,53384,11,53412,53412,11,53440,53440,11,53468,53468,11,53496,53496,11,53524,53524,11,53552,53552,11,53580,53580,11,53608,53608,11,53636,53636,11,53664,53664,11,53692,53692,11,53720,53720,11,53748,53748,11,53776,53776,11,53804,53804,11,53832,53832,11,53860,53860,11,53888,53888,11,53916,53916,11,53944,53944,11,53972,53972,11,54000,54000,11,54028,54028,11,54056,54056,11,54084,54084,11,54112,54112,11,54140,54140,11,54168,54168,11,54196,54196,11,54224,54224,11,54252,54252,11,54280,54280,11,54308,54308,11,54336,54336,11,54364,54364,11,54392,54392,11,54420,54420,11,54448,54448,11,54476,54476,11,54504,54504,11,54532,54532,11,54560,54560,11,54588,54588,11,54616,54616,11,54644,54644,11,54672,54672,11,54700,54700,11,54728,54728,11,54756,54756,11,54784,54784,11,54812,54812,11,54840,54840,11,54868,54868,11,54896,54896,11,54924,54924,11,54952,54952,11,54980,54980,11,55008,55008,11,55036,55036,11,55064,55064,11,55092,55092,11,55120,55120,11,55148,55148,11,55176,55176,11,55216,55238,9,64286,64286,5,65056,65071,5,65438,65439,5,65529,65531,4,66272,66272,5,68097,68099,5,68108,68111,5,68159,68159,5,68900,68903,5,69446,69456,5,69632,69632,7,69634,69634,7,69744,69744,5,69759,69761,5,69808,69810,7,69815,69816,7,69821,69821,1,69837,69837,1,69927,69931,5,69933,69940,5,70003,70003,5,70018,70018,7,70070,70078,5,70082,70083,1,70094,70094,7,70188,70190,7,70194,70195,7,70197,70197,7,70206,70206,5,70368,70370,7,70400,70401,5,70459,70460,5,70463,70463,7,70465,70468,7,70475,70477,7,70498,70499,7,70512,70516,5,70712,70719,5,70722,70724,5,70726,70726,5,70832,70832,5,70835,70840,5,70842,70842,5,70845,70845,5,70847,70848,5,70850,70851,5,71088,71089,7,71096,71099,7,71102,71102,7,71132,71133,5,71219,71226,5,71229,71229,5,71231,71232,5,71340,71340,7,71342,71343,7,71350,71350,7,71453,71455,5,71462,71462,7,71724,71726,7,71736,71736,7,71984,71984,5,71991,71992,7,71997,71997,7,71999,71999,1,72001,72001,1,72003,72003,5,72148,72151,5,72156,72159,7,72164,72164,7,72243,72248,5,72250,72250,1,72263,72263,5,72279,72280,7,72324,72329,1,72343,72343,7,72751,72751,7,72760,72765,5,72767,72767,5,72873,72873,7,72881,72881,7,72884,72884,7,73009,73014,5,73020,73021,5,73030,73030,1,73098,73102,7,73107,73108,7,73110,73110,7,73459,73460,5,78896,78904,4,92976,92982,5,94033,94087,7,94180,94180,5,113821,113822,5,118528,118573,5,119141,119141,5,119143,119145,5,119150,119154,5,119163,119170,5,119210,119213,5,121344,121398,5,121461,121461,5,121499,121503,5,122880,122886,5,122907,122913,5,122918,122922,5,123566,123566,5,125136,125142,5,126976,126979,14,126981,127182,14,127184,127231,14,127279,127279,14,127344,127345,14,127374,127374,14,127405,127461,14,127489,127490,14,127514,127514,14,127538,127546,14,127561,127567,14,127570,127743,14,127757,127758,14,127760,127760,14,127762,127762,14,127766,127768,14,127770,127770,14,127772,127772,14,127775,127776,14,127778,127779,14,127789,127791,14,127794,127795,14,127798,127798,14,127819,127819,14,127824,127824,14,127868,127868,14,127870,127871,14,127892,127893,14,127896,127896,14,127900,127901,14,127904,127940,14,127942,127942,14,127944,127944,14,127946,127946,14,127951,127955,14,127968,127971,14,127973,127984,14,127987,127987,14,127989,127989,14,127991,127991,14,127995,127999,5,128008,128008,14,128012,128014,14,128017,128018,14,128020,128020,14,128022,128022,14,128042,128042,14,128063,128063,14,128065,128065,14,128101,128101,14,128108,128109,14,128173,128173,14,128182,128183,14,128236,128237,14,128239,128239,14,128245,128245,14,128248,128248,14,128253,128253,14,128255,128258,14,128260,128263,14,128265,128265,14,128277,128277,14,128300,128301,14,128326,128328,14,128331,128334,14,128336,128347,14,128360,128366,14,128369,128370,14,128378,128378,14,128391,128391,14,128394,128397,14,128400,128400,14,128405,128406,14,128420,128420,14,128422,128423,14,128425,128432,14,128435,128443,14,128445,128449,14,128453,128464,14,128468,128475,14,128479,128480,14,128482,128482,14,128484,128487,14,128489,128494,14,128496,128498,14,128500,128505,14,128507,128511,14,128513,128518,14,128521,128525,14,128527,128527,14,128529,128529,14,128533,128533,14,128535,128535,14,128537,128537,14]")}var Woe=class t{constructor(e){this.confusableDictionary=e}static{this.ambiguousCharacterData=new Ti(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,8218,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,8242,96,1370,96,1523,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71922,67,71913,67,65315,67,8557,67,8450,67,8493,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71919,87,71910,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,66293,90,71909,90,65338,90,8484,90,8488,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65297,49,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125,119846,109],"_default":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"cs":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"es":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"fr":[65374,126,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"it":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ja":[8211,45,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65292,44,65307,59],"ko":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pt-BR":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ru":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"zh-hans":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41],"zh-hant":[8211,45,65374,126,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65307,59]}'))}static{this.cache=new aL({getCacheKey:JSON.stringify},e=>{function r(d){let p=new Map;for(let f=0;f<d.length;f+=2)p.set(d[f],d[f+1]);return p}function n(d,p){let f=new Map(d);for(let[m,h]of p)f.set(m,h);return f}function o(d,p){if(!d)return p;let f=new Map;for(let[m,h]of d)p.has(m)&&f.set(m,h);return f}let s=this.ambiguousCharacterData.value,a=e.filter(d=>!d.startsWith("_")&&d in s);a.length===0&&(a=["_default"]);let c;for(let d of a){let p=r(s[d]);c=o(c,p)}let u=r(s._common),l=n(u,c);return new t(l)})}static getInstance(e){return t.cache.get(Array.from(e))}static{this._locales=new Ti(()=>Object.keys(t.ambiguousCharacterData.value).filter(e=>!e.startsWith("_")))}static getLocales(){return t._locales.value}isAmbiguous(e){return this.confusableDictionary.has(e)}containsAmbiguousCharacter(e){for(let r=0;r<e.length;r++){let n=e.codePointAt(r);if(typeof n=="number"&&this.isAmbiguous(n))return!0}return!1}getPrimaryConfusable(e){return this.confusableDictionary.get(e)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}},Koe=class t{static getRawData(){return JSON.parse("[9,10,11,12,13,32,127,160,173,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12288,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999]")}static{this._data=void 0}static getData(){return this._data||(this._data=new Set(t.getRawData())),this._data}static isInvisibleCharacter(e){return t.getData().has(e)}static containsInvisibleCharacter(e){for(let r=0;r<e.length;r++){let n=e.codePointAt(r);if(typeof n=="number"&&t.isInvisibleCharacter(n))return!0}return!1}static get codePoints(){return t.getData()}};function wR(t){return typeof t=="string"}function lL(t){return Array.isArray(t)&&t.every(e=>wR(e))}function RR(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&!(t instanceof RegExp)&&!(t instanceof Date)}function tS(t){return typeof t=="number"&&!isNaN(t)}function H3e(t){return typeof t>"u"}function rS(t){return!dj(t)}function dj(t){return H3e(t)||t===null}function iu(t,e){if(!t)throw new Error(e?`Unexpected type, expected '${e}'`:"Unexpected type")}function Gh(t){return t===47||t===92}function nS(t){return t.replace(/[\\/]/g,wr.sep)}function ese(t){return t.indexOf("/")===-1&&(t=nS(t)),/^[a-zA-Z]:(\/|$)/.test(t)&&(t="/"+t),t}function pj(t,e=wr.sep){if(!t)return"";let r=t.length,n=t.charCodeAt(0);if(Gh(n)){if(Gh(t.charCodeAt(1))&&!Gh(t.charCodeAt(2))){let s=3,a=s;for(;s<r&&!Gh(t.charCodeAt(s));s++);if(a!==s&&!Gh(t.charCodeAt(s+1))){for(s+=1;s<r;s++)if(Gh(t.charCodeAt(s)))return t.slice(0,s+1).replace(/[\\/]/g,e)}}return e}else if(G3e(n)&&t.charCodeAt(1)===58)return Gh(t.charCodeAt(2))?t.slice(0,2)+e:t.slice(0,2);let o=t.indexOf("://");if(o!==-1){for(o+=3;o<r;o++)if(Gh(t.charCodeAt(o)))return t.slice(0,o+1)}return""}function fj(t,e,r,n=Zx){if(t===e)return!0;if(!t||!e||e.length>t.length)return!1;if(r){if(!uj(t,e))return!1;if(e.length===t.length)return!0;let s=e.length;return e.charAt(e.length-1)===n&&s--,t.charAt(s)===n}return e.charAt(e.length-1)!==n&&(e+=n),t.indexOf(e)===0}function G3e(t){return t>=65&&t<=90||t>=97&&t<=122}var $3e=/^\w[\w\d+.-]*$/,W3e=/^\//,K3e=/^\/\//;function Y3e(t,e){if(!t.scheme&&e)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${t.authority}", path: "${t.path}", query: "${t.query}", fragment: "${t.fragment}"}`);if(t.scheme&&!$3e.test(t.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(t.path){if(t.authority){if(!W3e.test(t.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(K3e.test(t.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}function Q3e(t,e){return!t&&!e?"file":t}function X3e(t,e){switch(t){case"https":case"http":case"file":e?e[0]!==El&&(e=El+e):e=El;break}return e}var Tn="",El="/",J3e=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,Ye=class t{static isUri(e){return e instanceof t?!0:e?typeof e.authority=="string"&&typeof e.fragment=="string"&&typeof e.path=="string"&&typeof e.query=="string"&&typeof e.scheme=="string"&&typeof e.fsPath=="string"&&typeof e.with=="function"&&typeof e.toString=="function":!1}constructor(e,r,n,o,s,a=!1){typeof e=="object"?(this.scheme=e.scheme||Tn,this.authority=e.authority||Tn,this.path=e.path||Tn,this.query=e.query||Tn,this.fragment=e.fragment||Tn):(this.scheme=Q3e(e,a),this.authority=r||Tn,this.path=X3e(this.scheme,n||Tn),this.query=o||Tn,this.fragment=s||Tn,Y3e(this,a))}get fsPath(){return kR(this,!1)}with(e){if(!e)return this;let{scheme:r,authority:n,path:o,query:s,fragment:a}=e;return r===void 0?r=this.scheme:r===null&&(r=Tn),n===void 0?n=this.authority:n===null&&(n=Tn),o===void 0?o=this.path:o===null&&(o=Tn),s===void 0?s=this.query:s===null&&(s=Tn),a===void 0?a=this.fragment:a===null&&(a=Tn),r===this.scheme&&n===this.authority&&o===this.path&&s===this.query&&a===this.fragment?this:new zh(r,n,o,s,a)}static parse(e,r=!1){let n=J3e.exec(e);return n?new zh(n[2]||Tn,dL(n[4]||Tn),dL(n[5]||Tn),dL(n[7]||Tn),dL(n[9]||Tn),r):new zh(Tn,Tn,Tn,Tn,Tn)}static file(e){let r=Tn;if(Rd&&(e=e.replace(/\\/g,El)),e[0]===El&&e[1]===El){let n=e.indexOf(El,2);n===-1?(r=e.substring(2),e=El):(r=e.substring(2,n),e=e.substring(n)||El)}return new zh("file",r,e,Tn,Tn)}static from(e,r){return new zh(e.scheme,e.authority,e.path,e.query,e.fragment,r)}static joinPath(e,...r){if(!e.path)throw new Error("[UriError]: cannot call joinPath on URI without path");let n;return Rd&&e.scheme==="file"?n=t.file(Ci.join(kR(e,!0),...r)).path:n=wr.join(e.path,...r),e.with({path:n})}toString(e=!1){return mj(this,e)}toJSON(){return this}static revive(e){if(e){if(e instanceof t)return e;{let r=new zh(e);return r._formatted=e.external??null,r._fsPath=e._sep===nse?e.fsPath??null:null,r}}else return e}[Symbol.for("debug.description")](){return`URI(${this.toString()})`}};function PR(t){return!t||typeof t!="object"?!1:typeof t.scheme=="string"&&(typeof t.authority=="string"||typeof t.authority>"u")&&(typeof t.path=="string"||typeof t.path>"u")&&(typeof t.query=="string"||typeof t.query>"u")&&(typeof t.fragment=="string"||typeof t.fragment>"u")}var nse=Rd?1:void 0,zh=class extends Ye{constructor(){super(...arguments);this._formatted=null;this._fsPath=null}get fsPath(){return this._fsPath||(this._fsPath=kR(this,!1)),this._fsPath}toString(r=!1){return r?mj(this,!0):(this._formatted||(this._formatted=mj(this,!1)),this._formatted)}toJSON(){let r={$mid:1};return this._fsPath&&(r.fsPath=this._fsPath,r._sep=nse),this._formatted&&(r.external=this._formatted),this.path&&(r.path=this.path),this.scheme&&(r.scheme=this.scheme),this.authority&&(r.authority=this.authority),this.query&&(r.query=this.query),this.fragment&&(r.fragment=this.fragment),r}},ise={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function tse(t,e,r){let n,o=-1;for(let s=0;s<t.length;s++){let a=t.charCodeAt(s);if(a>=97&&a<=122||a>=65&&a<=90||a>=48&&a<=57||a===45||a===46||a===95||a===126||e&&a===47||r&&a===91||r&&a===93||r&&a===58)o!==-1&&(n+=encodeURIComponent(t.substring(o,s)),o=-1),n!==void 0&&(n+=t.charAt(s));else{n===void 0&&(n=t.substr(0,s));let c=ise[a];c!==void 0?(o!==-1&&(n+=encodeURIComponent(t.substring(o,s)),o=-1),n+=c):o===-1&&(o=s)}}return o!==-1&&(n+=encodeURIComponent(t.substring(o))),n!==void 0?n:t}function Z3e(t){let e;for(let r=0;r<t.length;r++){let n=t.charCodeAt(r);n===35||n===63?(e===void 0&&(e=t.substr(0,r)),e+=ise[n]):e!==void 0&&(e+=t[r])}return e!==void 0?e:t}function kR(t,e){let r;return t.authority&&t.path.length>1&&t.scheme==="file"?r=`//${t.authority}${t.path}`:t.path.charCodeAt(0)===47&&(t.path.charCodeAt(1)>=65&&t.path.charCodeAt(1)<=90||t.path.charCodeAt(1)>=97&&t.path.charCodeAt(1)<=122)&&t.path.charCodeAt(2)===58?e?r=t.path.substr(1):r=t.path[1].toLowerCase()+t.path.substr(2):r=t.path,Rd&&(r=r.replace(/\//g,"\\")),r}function mj(t,e){let r=e?Z3e:tse,n="",{scheme:o,authority:s,path:a,query:c,fragment:u}=t;if(o&&(n+=o,n+=":"),(s||o==="file")&&(n+=El,n+=El),s){let l=s.indexOf("@");if(l!==-1){let d=s.substr(0,l);s=s.substr(l+1),l=d.lastIndexOf(":"),l===-1?n+=r(d,!1,!1):(n+=r(d.substr(0,l),!1,!1),n+=":",n+=r(d.substr(l+1),!1,!0)),n+="@"}s=s.toLowerCase(),l=s.lastIndexOf(":"),l===-1?n+=r(s,!1,!0):(n+=r(s.substr(0,l),!1,!0),n+=s.substr(l))}if(a){if(a.length>=3&&a.charCodeAt(0)===47&&a.charCodeAt(2)===58){let l=a.charCodeAt(1);l>=65&&l<=90&&(a=`/${String.fromCharCode(l+32)}:${a.substr(3)}`)}else if(a.length>=2&&a.charCodeAt(1)===58){let l=a.charCodeAt(0);l>=65&&l<=90&&(a=`${String.fromCharCode(l+32)}:${a.substr(2)}`)}n+=r(a,!0,!1)}return c&&(n+="?",n+=r(c,!1,!1)),u&&(n+="#",n+=e?u:tse(u,!1,!1)),n}function ose(t){try{return decodeURIComponent(t)}catch{return t.length>3?t.substr(0,3)+ose(t.substr(3)):t}}var rse=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function dL(t){return t.match(rse)?t.replace(rse,e=>ose(e)):t}var xn;(j=>(j.inMemory="inmemory",j.vscode="vscode",j.internal="private",j.walkThrough="walkThrough",j.walkThroughSnippet="walkThroughSnippet",j.http="http",j.https="https",j.file="file",j.mailto="mailto",j.untitled="untitled",j.data="data",j.command="command",j.vscodeRemote="vscode-remote",j.vscodeRemoteResource="vscode-remote-resource",j.vscodeManagedRemoteResource="vscode-managed-remote-resource",j.vscodeUserData="vscode-userdata",j.vscodeCustomEditor="vscode-custom-editor",j.vscodeNotebookCell="vscode-notebook-cell",j.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",j.vscodeNotebookCellOutput="vscode-notebook-cell-output",j.vscodeInteractiveInput="vscode-interactive-input",j.vscodeSettings="vscode-settings",j.vscodeWorkspaceTrust="vscode-workspace-trust",j.vscodeTerminal="vscode-terminal",j.vscodeChatCodeBlock="vscode-chat-code-block",j.vscodeChatCodeCompareBlock="vscode-chat-code-compare-block",j.vscodeChatSesssion="vscode-chat-editor",j.webviewPanel="webview-panel",j.vscodeWebview="vscode-webview",j.extension="extension",j.vscodeFileResource="vscode-file",j.tmp="tmp",j.vsls="vsls",j.vscodeSourceControl="vscode-scm",j.commentsInput="comment",j.codeSetting="code-setting",j.outputChannel="output"))(xn||={});var e5e="tkn",hj=class{constructor(){this._hosts=Object.create(null);this._ports=Object.create(null);this._connectionTokens=Object.create(null);this._preferredWebSchema="http";this._delegate=null;this._serverRootPath="/"}setPreferredWebSchema(e){this._preferredWebSchema=e}setDelegate(e){this._delegate=e}setServerRootPath(e,r){this._serverRootPath=r5e(e,r)}getServerRootPath(){return this._serverRootPath}get _remoteResourcesPath(){return wr.join(this._serverRootPath,xn.vscodeRemoteResource)}set(e,r,n){this._hosts[e]=r,this._ports[e]=n}setConnectionToken(e,r){this._connectionTokens[e]=r}getPreferredWebSchema(){return this._preferredWebSchema}rewrite(e){if(this._delegate)try{return this._delegate(e)}catch(c){return Mh(c),e}let r=e.authority,n=this._hosts[r];n&&n.indexOf(":")!==-1&&n.indexOf("[")===-1&&(n=`[${n}]`);let o=this._ports[r],s=this._connectionTokens[r],a=`path=${encodeURIComponent(e.path)}`;return typeof s=="string"&&(a+=`&${e5e}=${encodeURIComponent(s)}`),Ye.from({scheme:Ooe?this._preferredWebSchema:xn.vscodeRemoteResource,authority:`${n}:${o}`,path:this._remoteResourcesPath,query:a})}},t5e=new hj;function r5e(t,e){return wr.join(e??"/",`${t.quality??"oss"}-${t.commit??"dev"}`)}var n5e="vscode-app",gj=class t{static{this.FALLBACK_AUTHORITY=n5e}asBrowserUri(e){let r=this.toUri(e,require);return this.uriToBrowserUri(r)}uriToBrowserUri(e){return e.scheme===xn.vscodeRemote?t5e.rewrite(e):e.scheme===xn.file&&(Loe||Moe===`${xn.vscodeFileResource}://${t.FALLBACK_AUTHORITY}`)?e.with({scheme:xn.vscodeFileResource,authority:e.authority||t.FALLBACK_AUTHORITY,query:null,fragment:null}):e}asFileUri(e){let r=this.toUri(e,require);return this.uriToFileUri(r)}uriToFileUri(e){return e.scheme===xn.vscodeFileResource?e.with({scheme:xn.file,authority:e.authority!==t.FALLBACK_AUTHORITY?e.authority:null,query:null,fragment:null}):e}toUri(e,r){return Ye.isUri(e)?e:Ye.parse(r.toUrl(e))}},wht=new gj,i5e;(s=>{let t=new Map([["1",{"Cross-Origin-Opener-Policy":"same-origin"}],["2",{"Cross-Origin-Embedder-Policy":"require-corp"}],["3",{"Cross-Origin-Opener-Policy":"same-origin","Cross-Origin-Embedder-Policy":"require-corp"}]]);s.CoopAndCoep=Object.freeze(t.get("3"));let r="vscode-coi";function n(a){let c;typeof a=="string"?c=new URL(a).searchParams:a instanceof URL?c=a.searchParams:Ye.isUri(a)&&(c=new URL(a.toString(!0)).searchParams);let u=c?.get(r);if(u)return t.get(u)}s.getHeadersFromQuery=n;function o(a,c,u){if(!globalThis.crossOriginIsolated)return;let l=c&&u?"3":u?"2":"1";a instanceof URLSearchParams?a.set(r,l):a[r]=l}s.addSearchParam=o})(i5e||={});function Lf(t){return kR(t,!0)}var AR=class{constructor(e){this._ignorePathCasing=e}compare(e,r,n=!1){return e===r?0:Xoe(this.getComparisonKey(e,n),this.getComparisonKey(r,n))}isEqual(e,r,n=!1){return e===r?!0:!e||!r?!1:this.getComparisonKey(e,n)===this.getComparisonKey(r,n)}getComparisonKey(e,r=!1){return e.with({path:this._ignorePathCasing(e)?e.path.toLowerCase():void 0,fragment:r?null:void 0}).toString()}ignorePathCasing(e){return this._ignorePathCasing(e)}isEqualOrParent(e,r,n=!1){if(e.scheme===r.scheme){if(e.scheme===xn.file)return fj(Lf(e),Lf(r),this._ignorePathCasing(e))&&e.query===r.query&&(n||e.fragment===r.fragment);if(sse(e.authority,r.authority))return fj(e.path,r.path,this._ignorePathCasing(e),"/")&&e.query===r.query&&(n||e.fragment===r.fragment)}return!1}joinPath(e,...r){return Ye.joinPath(e,...r)}basenameOrAuthority(e){return ou(e)||e.authority}basename(e){return wr.basename(e.path)}extname(e){return wr.extname(e.path)}dirname(e){if(e.path.length===0)return e;let r;return e.scheme===xn.file?r=Ye.file(iL(Lf(e))).path:(r=wr.dirname(e.path),e.authority&&r.length&&r.charCodeAt(0)!==47&&(console.error(`dirname("${e.toString})) resulted in a relative path`),r="/")),e.with({path:r})}normalizePath(e){if(!e.path.length)return e;let r;return e.scheme===xn.file?r=Ye.file(cj(Lf(e))).path:r=wr.normalize(e.path),e.with({path:r})}relativePath(e,r){if(e.scheme!==r.scheme||!sse(e.authority,r.authority))return;if(e.scheme===xn.file){let s=Voe(Lf(e),Lf(r));return Rd?nS(s):s}let n=e.path||"/",o=r.path||"/";if(this._ignorePathCasing(e)){let s=0;for(let a=Math.min(n.length,o.length);s<a&&!(n.charCodeAt(s)!==o.charCodeAt(s)&&n.charAt(s).toLowerCase()!==o.charAt(s).toLowerCase());s++);n=o.substr(0,s)+n.substr(s)}return wr.relative(n,o)}resolvePath(e,r){if(e.scheme===xn.file){let n=Ye.file(Hoe(Lf(e),r));return e.with({authority:n.authority,path:n.path})}return r=ese(r),e.with({path:wr.resolve(e.path,r)})}isAbsolutePath(e){return!!e.path&&e.path[0]==="/"}isEqualAuthority(e,r){return e===r||e!==void 0&&r!==void 0&&cL(e,r)}hasTrailingPathSeparator(e,r=Zx){if(e.scheme===xn.file){let n=Lf(e);return n.length>pj(n).length&&n[n.length-1]===r}else{let n=e.path;return n.length>1&&n.charCodeAt(n.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(e.fsPath)}}removeTrailingPathSeparator(e,r=Zx){return ase(e,r)?e.with({path:e.path.substr(0,e.path.length-1)}):e}addTrailingPathSeparator(e,r=Zx){let n=!1;if(e.scheme===xn.file){let o=Lf(e);n=o!==void 0&&o.length===pj(o).length&&o[o.length-1]===r}else{r="/";let o=e.path;n=o.length===1&&o.charCodeAt(o.length-1)===47}return!n&&!ase(e,r)?e.with({path:e.path+"/"}):e}},Vr=new AR(()=>!1),Lht=new AR(t=>t.scheme===xn.file?!Noe:!0),Oht=new AR(t=>!0),DR=Vr.isEqual.bind(Vr),Mht=Vr.isEqualOrParent.bind(Vr),Fht=Vr.getComparisonKey.bind(Vr),Uht=Vr.basenameOrAuthority.bind(Vr),ou=Vr.basename.bind(Vr),Rc=Vr.extname.bind(Vr),Bht=Vr.dirname.bind(Vr),cse=Vr.joinPath.bind(Vr),qht=Vr.normalizePath.bind(Vr),jht=Vr.relativePath.bind(Vr),Hht=Vr.resolvePath.bind(Vr),Vht=Vr.isAbsolutePath.bind(Vr),sse=Vr.isEqualAuthority.bind(Vr),ase=Vr.hasTrailingPathSeparator.bind(Vr),Ght=Vr.removeTrailingPathSeparator.bind(Vr),zht=Vr.addTrailingPathSeparator.bind(Vr);var o5e;(s=>{s.META_DATA_LABEL="label",s.META_DATA_DESCRIPTION="description",s.META_DATA_SIZE="size",s.META_DATA_MIME="mime";function o(a){let c=new Map;a.path.substring(a.path.indexOf(";")+1,a.path.lastIndexOf(";")).split(";").forEach(d=>{let[p,f]=d.split(":");p&&f&&c.set(p,f)});let l=a.path.substring(0,a.path.indexOf(";"));return l&&c.set(s.META_DATA_MIME,l),c}s.parseMetaData=o})(o5e||={});var lse=Symbol("MicrotaskDelay");function _j(t){let e=new la,r=t(e.token),n=new Promise((o,s)=>{let a=e.token.onCancellationRequested(()=>{a.dispose(),s(new Hi)});Promise.resolve(r).then(c=>{a.dispose(),e.dispose(),o(c)},c=>{a.dispose(),e.dispose(),s(c)})});return new class{cancel(){e.cancel(),e.dispose()}then(o,s){return n.then(o,s)}catch(o){return this.then(void 0,o)}finally(o){return n.finally(o)}}}function su(t,e,r){return new Promise((n,o)=>{let s=e.onCancellationRequested(()=>{s.dispose(),n(r)});t.then(n,o).finally(()=>s.dispose())})}function NR(t,e,r){let n,o=setTimeout(()=>{n?.(void 0),r?.()},e);return Promise.race([t.finally(()=>clearTimeout(o)),new Promise(s=>n=s)])}var vj=class{constructor(){this.isDisposed=!1;this.activePromise=null,this.queuedPromise=null,this.queuedPromiseFactory=null}queue(e){if(this.isDisposed)return Promise.reject(new Error("Throttler is disposed"));if(this.activePromise){if(this.queuedPromiseFactory=e,!this.queuedPromise){let r=()=>{if(this.queuedPromise=null,this.isDisposed)return;let n=this.queue(this.queuedPromiseFactory);return this.queuedPromiseFactory=null,n};this.queuedPromise=new Promise(n=>{this.activePromise.then(r,r).then(n)})}return new Promise((r,n)=>{this.queuedPromise.then(r,n)})}return this.activePromise=e(),new Promise((r,n)=>{this.activePromise.then(o=>{this.activePromise=null,r(o)},o=>{this.activePromise=null,n(o)})})}dispose(){this.isDisposed=!0}};var s5e=(t,e)=>{let r=!0,n=setTimeout(()=>{r=!1,e()},t);return{isTriggered:()=>r,dispose:()=>{clearTimeout(n),r=!1}}},a5e=t=>{let e=!0;return queueMicrotask(()=>{e&&(e=!1,t())}),{isTriggered:()=>e,dispose:()=>{e=!1}}},bj=class{constructor(e){this.defaultDelay=e;this.deferred=null,this.completionPromise=null,this.doResolve=null,this.doReject=null,this.task=null}trigger(e,r=this.defaultDelay){this.task=e,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((o,s)=>{this.doResolve=o,this.doReject=s}).then(()=>{if(this.completionPromise=null,this.doResolve=null,this.task){let o=this.task;return this.task=null,o()}}));let n=()=>{this.deferred=null,this.doResolve?.(null)};return this.deferred=r===lse?a5e(n):s5e(r,n),this.completionPromise}isTriggered(){return!!this.deferred?.isTriggered()}cancel(){this.cancelTimeout(),this.completionPromise&&(this.doReject?.(new Hi),this.completionPromise=null)}cancelTimeout(){this.deferred?.dispose(),this.deferred=null}dispose(){this.cancel()}},$h=class{constructor(e){this.delayer=new bj(e),this.throttler=new vj}trigger(e,r){return this.delayer.trigger(()=>this.throttler.queue(e),r)}isTriggered(){return this.delayer.isTriggered()}cancel(){this.delayer.cancel()}dispose(){this.delayer.dispose(),this.throttler.dispose()}};function iS(t,e){return e?new Promise((r,n)=>{let o=setTimeout(()=>{s.dispose(),r()},t),s=e.onCancellationRequested(()=>{clearTimeout(o),s.dispose(),n(new Hi)})}):_j(r=>iS(t,r))}var kd=class{constructor(e){this._size=0;this._isDisposed=!1;this.maxDegreeOfParalellism=e,this.outstandingPromises=[],this.runningPromises=0,this._onDrained=new Yt}whenIdle(){return this.size>0?Ed.toPromise(this.onDrained):Promise.resolve()}get onDrained(){return this._onDrained.event}get size(){return this._size}queue(e){if(this._isDisposed)throw new Error("Object has been disposed");return this._size++,new Promise((r,n)=>{this.outstandingPromises.push({factory:e,c:r,e:n}),this.consume()})}consume(){for(;this.outstandingPromises.length&&this.runningPromises<this.maxDegreeOfParalellism;){let e=this.outstandingPromises.shift();this.runningPromises++;let r=e.factory();r.then(e.c,e.e),r.then(()=>this.consumed(),()=>this.consumed())}}consumed(){this._isDisposed||(this.runningPromises--,--this._size===0&&this._onDrained.fire(),this.outstandingPromises.length>0&&this.consume())}clear(){if(this._isDisposed)throw new Error("Object has been disposed");this.outstandingPromises.length=0,this._size=this.runningPromises}dispose(){this._isDisposed=!0,this.outstandingPromises.length=0,this._size=0,this._onDrained.dispose()}};var fL=class{constructor(e,r){this._isDisposed=!1;this._token=-1,typeof e=="function"&&typeof r=="number"&&this.setIfNotSet(e,r)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet(e,r){if(this._isDisposed)throw new Qr("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,e()},r)}setIfNotSet(e,r){if(this._isDisposed)throw new Qr("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,e()},r))}};var c5e,pL;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?pL=(t,e)=>{Uoe(()=>{if(r)return;let n=Date.now()+15;e(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,n-Date.now())}}))});let r=!1;return{dispose(){r||(r=!0)}}}:pL=(t,e,r)=>{let n=t.requestIdleCallback(e,typeof r=="number"?{timeout:r}:void 0),o=!1;return{dispose(){o||(o=!0,t.cancelIdleCallback(n))}}},c5e=t=>pL(globalThis,t)})();var yj=class{constructor(e,r){this._didRun=!1;this._executor=()=>{try{this._value=r()}catch(n){this._error=n}finally{this._didRun=!0}},this._handle=pL(e,()=>this._executor())}dispose(){this._handle.dispose()}get value(){if(this._didRun||(this._handle.dispose(),this._executor()),this._error)throw this._error;return this._value}get isInitialized(){return this._didRun}},mL=class extends yj{constructor(e){super(globalThis,e)}};var Of=class{get isRejected(){return this.outcome?.outcome===1}get isResolved(){return this.outcome?.outcome===0}get isSettled(){return!!this.outcome}get value(){return this.outcome?.outcome===0?this.outcome?.value:void 0}constructor(){this.p=new Promise((e,r)=>{this.completeCallback=e,this.errorCallback=r})}complete(e){return new Promise(r=>{this.completeCallback(e),this.outcome={outcome:0,value:e},r()})}error(e){return new Promise(r=>{this.errorCallback(e),this.outcome={outcome:1,value:e},r()})}cancel(){return this.error(new Hi)}},u5e;(r=>{async function t(n){let o,s=await Promise.all(n.map(a=>a.then(c=>c,c=>{o||(o=c)})));if(typeof o<"u")throw o;return s}r.settled=t;function e(n){return new Promise(async(o,s)=>{try{await n(o,s)}catch(a){s(a)}})}r.withAsyncBody=e})(u5e||={});var qo=class t{static fromArray(e){return new t(r=>{r.emitMany(e)})}static fromPromise(e){return new t(async r=>{r.emitMany(await e)})}static fromPromises(e){return new t(async r=>{await Promise.all(e.map(async n=>r.emitOne(await n)))})}static merge(e){return new t(async r=>{await Promise.all(e.map(async n=>{for await(let o of n)r.emitOne(o)}))})}static{this.EMPTY=t.fromArray([])}constructor(e,r){this._state=0,this._results=[],this._error=null,this._onReturn=r,this._onStateChanged=new Yt,queueMicrotask(async()=>{let n={emitOne:o=>this.emitOne(o),emitMany:o=>this.emitMany(o),reject:o=>this.reject(o)};try{await Promise.resolve(e(n)),this.resolve()}catch(o){this.reject(o)}finally{n.emitOne=void 0,n.emitMany=void 0,n.reject=void 0}})}[Symbol.asyncIterator](){let e=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(e<this._results.length)return{done:!1,value:this._results[e++]};if(this._state===1)return{done:!0,value:void 0};await Ed.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(e,r){return new t(async n=>{for await(let o of e)n.emitOne(r(o))})}map(e){return t.map(this,e)}static filter(e,r){return new t(async n=>{for await(let o of e)r(o)&&n.emitOne(o)})}filter(e){return t.filter(this,e)}static coalesce(e){return t.filter(e,r=>!!r)}coalesce(){return t.coalesce(this)}static async toPromise(e){let r=[];for await(let n of e)r.push(n);return r}toPromise(){return t.toPromise(this)}emitOne(e){this._state===0&&(this._results.push(e),this._onStateChanged.fire())}emitMany(e){this._state===0&&(this._results=this._results.concat(e),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(e){this._state===0&&(this._state=2,this._error=e,this._onStateChanged.fire())}};var Wh=class{constructor(e){this._deferred=new Of;this._asyncIterable=new qo(o=>{if(r){o.reject(r);return}return n&&o.emitMany(n),this._errorFn=s=>o.reject(s),this._emitFn=s=>o.emitOne(s),this._deferred.p},e);let r,n;this._emitFn=o=>{n||(n=[]),n.push(o)},this._errorFn=o=>{r||(r=o)}}get asyncIterable(){return this._asyncIterable}resolve(){this._deferred.complete()}reject(e){this._errorFn(e),this._deferred.complete()}emitOne(e){this._emitFn(e)}};var Me=class{constructor(e,r=[],n=!1){this.ctor=e,this.staticArguments=r,this.supportsDelayedInstantiation=n}};var xj=class{constructor(e,r){this.key=e;this.data=r;this.incoming=new Map;this.outgoing=new Map}},LR=class{constructor(e){this._hashFn=e;this._nodes=new Map}roots(){let e=[];for(let r of this._nodes.values())r.outgoing.size===0&&e.push(r);return e}insertEdge(e,r){let n=this.lookupOrInsertNode(e),o=this.lookupOrInsertNode(r);n.outgoing.set(o.key,o),o.incoming.set(n.key,n)}removeNode(e){let r=this._hashFn(e);this._nodes.delete(r);for(let n of this._nodes.values())n.outgoing.delete(r),n.incoming.delete(r)}lookupOrInsertNode(e){let r=this._hashFn(e),n=this._nodes.get(r);return n||(n=new xj(r,e),this._nodes.set(r,n)),n}lookup(e){return this._nodes.get(this._hashFn(e))}isEmpty(){return this._nodes.size===0}toString(){let e=[];for(let[r,n]of this._nodes)e.push(`${r}
	(-> incoming)[${[...n.incoming.keys()].join(", ")}]
	(outgoing ->)[${[...n.outgoing.keys()].join(",")}]
`);return e.join(`
`)}findCycleSlow(){for(let[e,r]of this._nodes){let n=new Set([e]),o=this._findCycle(r,n);if(o)return o}}_findCycle(e,r){for(let[n,o]of e.outgoing){if(r.has(n))return[...r,n].join(" -> ");r.add(n);let s=this._findCycle(o,r);if(s)return s;r.delete(n)}}};var $b=class{constructor(...e){this._entries=new Map;for(let[r,n]of e)this.set(r,n)}set(e,r){let n=this._entries.get(e);return this._entries.set(e,r),n}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}};var l5e=!1,hL=class extends Error{constructor(e){super("cyclic dependency between services"),this.message=e.findCycleSlow()??`UNABLE to detect cycle, dumping graph: 
${e.toString()}`}},gL=class t{constructor(e=new $b,r=!1,n,o=l5e){this._services=e;this._strict=r;this._parent=n;this._enableTracing=o;this._isDisposed=!1;this._servicesToMaybeDispose=new Set;this._children=new Set;this._activeInstantiations=new Set;this._services.set(K,this),this._globalGraph=o?n?._globalGraph??new LR(s=>s):void 0}dispose(){if(!this._isDisposed){this._isDisposed=!0,Bh(this._children),this._children.clear();for(let e of this._servicesToMaybeDispose)Kx(e)&&e.dispose();this._servicesToMaybeDispose.clear()}}_throwIfDisposed(){if(this._isDisposed)throw new Error("InstantiationService has been disposed")}createChild(e,r){this._throwIfDisposed();let n=this,o=new class extends t{dispose(){n._children.delete(o),super.dispose()}}(e,this._strict,this,this._enableTracing);return this._children.add(o),r?.add(o),o}invokeFunction(e,...r){this._throwIfDisposed();let n=OR.traceInvocation(this._enableTracing,e),o=!1;try{return e({get:a=>{if(o)throw poe("service accessor is only valid during the invocation of its target method");let c=this._getOrCreateServiceInstance(a,n);if(!c)throw new Error(`[invokeFunction] unknown service '${a}'`);return c}},...r)}finally{o=!0,n.stop()}}createInstance(e,...r){this._throwIfDisposed();let n,o;return e instanceof Me?(n=OR.traceCreation(this._enableTracing,e.ctor),o=this._createInstance(e.ctor,e.staticArguments.concat(r),n)):(n=OR.traceCreation(this._enableTracing,e),o=this._createInstance(e,r,n)),n.stop(),o}_createInstance(e,r=[],n){let o=Tl.getServiceDependencies(e).sort((c,u)=>c.index-u.index),s=[];for(let c of o){let u=this._getOrCreateServiceInstance(c.id,n);u||this._throwIfStrict(`[createInstance] ${e.name} depends on UNKNOWN service ${c.id}.`,!1),s.push(u)}let a=o.length>0?o[0].index:r.length;if(r.length!==a){console.trace(`[createInstance] First service dependency of ${e.name} at position ${a+1} conflicts with ${r.length} static arguments`);let c=a-r.length;c>0?r=r.concat(new Array(c)):r=r.slice(0,a)}return Reflect.construct(e,r.concat(s))}_setCreatedServiceInstance(e,r){if(this._services.get(e)instanceof Me)this._services.set(e,r);else if(this._parent)this._parent._setCreatedServiceInstance(e,r);else throw new Error("illegalState - setting UNKNOWN service instance")}_getServiceInstanceOrDescriptor(e){let r=this._services.get(e);return!r&&this._parent?this._parent._getServiceInstanceOrDescriptor(e):r}_getOrCreateServiceInstance(e,r){this._globalGraph&&this._globalGraphImplicitDependency&&this._globalGraph.insertEdge(this._globalGraphImplicitDependency,String(e));let n=this._getServiceInstanceOrDescriptor(e);return n instanceof Me?this._safeCreateAndCacheServiceInstance(e,n,r.branch(e,!0)):(r.branch(e,!1),n)}_safeCreateAndCacheServiceInstance(e,r,n){if(this._activeInstantiations.has(e))throw new Error(`illegal state - RECURSIVELY instantiating service '${e}'`);this._activeInstantiations.add(e);try{return this._createAndCacheServiceInstance(e,r,n)}finally{this._activeInstantiations.delete(e)}}_createAndCacheServiceInstance(e,r,n){let o=new LR(u=>u.id.toString()),s=0,a=[{id:e,desc:r,_trace:n}],c=new Set;for(;a.length;){let u=a.pop();if(!c.has(String(u.id))){if(c.add(String(u.id)),o.lookupOrInsertNode(u),s++>1e3)throw new hL(o);for(let l of Tl.getServiceDependencies(u.desc.ctor)){let d=this._getServiceInstanceOrDescriptor(l.id);if(d||this._throwIfStrict(`[createInstance] ${e} depends on ${l.id} which is NOT registered.`,!0),this._globalGraph?.insertEdge(String(u.id),String(l.id)),d instanceof Me){let p={id:l.id,desc:d,_trace:u._trace.branch(l.id,!0)};o.insertEdge(u,p),a.push(p)}}}}for(;;){let u=o.roots();if(u.length===0){if(!o.isEmpty())throw new hL(o);break}for(let{data:l}of u){if(this._getServiceInstanceOrDescriptor(l.id)instanceof Me){let p=this._createServiceInstanceWithOwner(l.id,l.desc.ctor,l.desc.staticArguments,l.desc.supportsDelayedInstantiation,l._trace);this._setCreatedServiceInstance(l.id,p)}o.removeNode(l)}}return this._getServiceInstanceOrDescriptor(e)}_createServiceInstanceWithOwner(e,r,n=[],o,s){if(this._services.get(e)instanceof Me)return this._createServiceInstance(e,r,n,o,s,this._servicesToMaybeDispose);if(this._parent)return this._parent._createServiceInstanceWithOwner(e,r,n,o,s);throw new Error(`illegalState - creating UNKNOWN service instance ${r.name}`)}_createServiceInstance(e,r,n=[],o,s,a){if(o){let c=new t(void 0,this._strict,this,this._enableTracing);c._globalGraphImplicitDependency=String(e);let u=new Map,l=new mL(()=>{let d=c._createInstance(r,n,s);for(let[p,f]of u){let m=d[p];if(typeof m=="function")for(let h of f)h.disposable=m.apply(d,h.listener)}return u.clear(),a.add(d),d});return new Proxy(Object.create(null),{get(d,p){if(!l.isInitialized&&typeof p=="string"&&(p.startsWith("onDid")||p.startsWith("onWill"))){let h=u.get(p);return h||(h=new IR,u.set(p,h)),(v,y,_)=>{if(l.isInitialized)return l.value[p](v,y,_);{let x={listener:[v,y,_],disposable:void 0},S=h.push(x);return qa(()=>{S(),x.disposable?.dispose()})}}}if(p in d)return d[p];let f=l.value,m=f[p];return typeof m!="function"||(m=m.bind(f),d[p]=m),m},set(d,p,f){return l.value[p]=f,!0},getPrototypeOf(d){return r.prototype}})}else{let c=this._createInstance(r,n,s);return a.add(c),c}}_throwIfStrict(e,r){if(r&&console.warn(e),this._strict)throw new Error(e)}};var OR=class t{constructor(e,r){this.type=e;this.name=r;this._start=Date.now();this._dep=[]}static{this.all=new Set}static{this._None=new class extends t{constructor(){super(0,null)}stop(){}branch(){return this}}}static traceInvocation(e,r){return e?new t(2,r.name||new Error().stack.split(`
`).slice(3,4).join(`
`)):t._None}static traceCreation(e,r){return e?new t(1,r.name):t._None}static{this._totals=0}branch(e,r){let n=new t(3,e.toString());return this._dep.push([e,r,n]),n}stop(){let e=Date.now()-this._start;t._totals+=e;let r=!1;function n(s,a){let c=[],u=new Array(s+1).join("	");for(let[l,d,p]of a._dep)if(d&&p){r=!0,c.push(`${u}CREATES -> ${l}`);let f=n(s+1,p);f&&c.push(f)}else c.push(`${u}uses -> ${l}`);return c.join(`
`)}let o=[`${this.type===1?"CREATE":"CALL"} ${this.name}`,`${n(1,this)}`,`DONE, took ${e.toFixed(2)}ms (grand total ${t._totals.toFixed(2)}ms)`];(e>2||r)&&t.all.add(o.join(`
`))}};var st=ie("IServicesAccessor"),vL=class{constructor(e,r){this._isSealed=!1;let n=Array.isArray(e)?new $b(...e):e??new $b;n.set(st,this);let o=r?r._pair.insta.createChild(n):new gL(n,!0);this._pair={services:n,insta:o}}dispose(){this._pair.insta.dispose()}get(e){return this._pair.insta.invokeFunction(r=>r.get(e))}safeGet(e){try{return this.get(e)}catch{return}}define(e,r){if(this._isSealed)throw new Error("This accessor is sealed and cannot be modified anymore.");this._pair.services.set(e,r)}defineIfNotDefined(e,r){this.safeGet(e)===void 0&&this.define(e,r())}seal(){this._isSealed=!0}toString(){return""}};var Va=require("../package.json"),bL=Va.buildType!=="dev",da=Va.isPreRelease||!bL,Dgt=Va.engines.vscode;var MR=class{constructor(e,r){this.name=e;this.version=r}format(){return`${this.name}/${this.version}`}},St=ie("IEnvService");var yL=class{constructor(e,r){this.document=e;this.offsets=r}},oS=ie("heatmapService");var _L=`

**Note:** Some files were excluded from the context due to content exclusion rules. Click [here](https://docs.github.com/en/copilot/managing-github-copilot-in-your-organization/configuring-content-exclusions-for-github-copilot) to learn more.`,ke=ie("IIgnoreService"),dse=class t{static{this.Instance=new t}dispose(){}get isEnabled(){return!1}get isRegexExclusionsEnabled(){return!1}async init(){}async isCopilotIgnored(e){return!1}async asMinimatchPattern(){}async sessionInfo(){return""}};async function Sj(t,e){let r=[];for(let n of e)await t.isCopilotIgnored(n)||r.push(n);return r}var Ga=ie("ICopilotTokenStore"),xL=class extends dt{constructor(){super(...arguments);this._onDidStoreUpdate=this._register(new Yt);this.onDidStoreUpdate=this._onDidStoreUpdate.event}get copilotToken(){return this._copilotToken}set copilotToken(r){let n=this._copilotToken?.token;this._copilotToken=r,n!==r?.token&&this._onDidStoreUpdate.fire()}};var d5e=Object.prototype.hasOwnProperty;function pse(t,e){return Ij(t,e,new Set)}function Ij(t,e,r){if(dj(t))return t;let n=e(t);if(typeof n<"u")return n;if(Array.isArray(t)){let o=[];for(let s of t)o.push(Ij(s,e,r));return o}if(RR(t)){if(r.has(t))throw new Error("Cannot clone recursive data-structure");r.add(t);let o={};for(let s in t)d5e.call(t,s)&&(o[s]=Ij(t[s],e,r));return r.delete(t),o}return t}function FR(t,e){if(t===e)return!0;if(t==null||e===null||e===void 0||typeof t!=typeof e||typeof t!="object"||Array.isArray(t)!==Array.isArray(e))return!1;let r,n;if(Array.isArray(t)){if(t.length!==e.length)return!1;for(r=0;r<t.length;r++)if(!FR(t[r],e[r]))return!1}else{let o=[];for(n in t)o.push(n);o.sort();let s=[];for(n in e)s.push(n);if(s.sort(),!FR(o,s))return!1;for(r=0;r<o.length;r++)if(!FR(t[o[r]],e[o[r]]))return!1}return!0}var Pd="github.copilot",be=ie("IConfigurationService"),IL=class{getConfigMixedWithDefaults(e){let r=this.getConfig(e);return r===void 0?e.defaultValue:RR(r)&&RR(e.defaultValue)?{...e.defaultValue,...r}:r}};var SL;function f5e(){if(!SL){SL=new Map;let t=Va.contributes.configuration.properties;for(let e of Object.keys(t))typeof t[e].default<"u"&&SL.set(e,t[e].default)}return SL}function fse(t,e){let r=`${Pd}.${t}`,n=f5e().get(r);if(typeof n<"u"&&!FR(e,n))throw new Error(`The default value for setting ${t} is different in package.json and in code`);let o=t.indexOf("."),s=t.substring(0,o);if(s!=="editor"&&s!=="chat"&&s!=="advanced"&&s!=="notebook"&&s!=="renameSuggestions")throw new Error(`Unexpected setting section ${s} in setting ${t}`);let a=t.substring(o+1);return{id:t,fullyQualifiedId:r,firstPart:s,secondPart:a,defaultValue:e}}function Ft(t,e){return{...fse(t,e),configType:0}}function pa(t,e){return{...fse(t,e),configType:1}}var de;(Ke=>(Ke.EnableCodeActions=Ft("editor.enableCodeActions",!0),Ke.LocaleOverride=Ft("chat.localeOverride","auto"),Ke.WelcomeMessage=Ft("chat.welcomeMessage","first"),Ke.TerminalChatLocation=Ft("chat.terminalChatLocation","chatView"),Ke.AuthProvider=Ft("advanced.authProvider","github"),Ke.NotebookIterativeImproving=Ft("notebook.iterativeImproving",!1),Ke.AutomaticRenameSuggestions=Ft("renameSuggestions.triggerAutomatically",!0),Ke.CodeGenerationInstructions=Ft("chat.experimental.codeGeneration.instructions",[]),Ke.DeprecatedCustomUserInstructions=Ft("chat.customUserInstructions",[]),Ke.GenerateTestsCodeLens=Ft("chat.experimental.generateTests.codeLens",!1),Ke.DebugOverrideCAPIUrl=Ft("advanced.debug.overrideCAPIUrl","https://api.githubcopilot.com"),Ke.DebugOverrideChatEngine=Ft("advanced.debug.overrideChatEngine",void 0),Ke.DebugOverrideEmbeddingsModel=Ft("advanced.debug.overrideEmbeddingsModel",void 0),Ke.DebugOverrideChatMaxTokenNum=Ft("advanced.debug.overrideChatMaxTokenNum",0),Ke.DebugOverrideChatOffTopicModel=Ft("advanced.debug.overrideChatOffTopicModel",""),Ke.DebugOverrideChatOffTopicModelTokenizer=Ft("advanced.debug.overrideChatOffTopicModelTokenizer",""),Ke.DebugOverrideChatOffTopicModelThreshold=Ft("advanced.debug.overrideChatOffTopicModelThreshold",0),Ke.DebugOverrideLogLevels=Ft("advanced.debug.overrideLogLevels",{}),Ke.DebugFilterLogCategories=Ft("advanced.debug.filterLogCategories",[]),Ke.DebugReportFeedback=Ft("advanced.debug.reportFeedback",!1),Ke.DebugUseNodeFetcher=Ft("advanced.debug.useNodeFetcher",!1),Ke.DebugUseElectronFetcher=Ft("advanced.debug.useElectronFetcher",!0),Ke.EnableImplicitContext=Ft("chat.experimental.githubAgents.enableImplicitContext",!1),Ke.ConversationSlashCommandEnablements=Ft("advanced.slashCommands",{"*":!1}),Ke.ConversationVariablesEnablements=Ft("advanced.variables",{"*":da}),Ke.ConversationAdditionalPromptContext=Ft("advanced.conversationAdditionalPromptContext","firstTurn"),Ke.InternalLoggingEnabled=Ft("advanced.internalLogging",void 0),Ke.ConversationPromptEval=pa("advanced.promptEval",!1),Ke.ConversationPromptEvalRequestContext=pa("advanced.promptEval.requestContext",0),Ke.KerberosServicePrincipal=Ft("advanced.kerberosServicePrincipal",void 0),Ke.ExplainIntentRefer=Ft("advanced.explain.refer",!0),Ke.InlineChatEndpoint=pa("advanced.inlineChatEndpoint",void 0),Ke.InlineChatCompletionsTrigger=Ft("chat.experimental.inlineChatCompletionTrigger.enabled",!1),Ke.FixInlineChatEndpoint=pa("advanced.fix.inlineChatEndpoint",void 0),Ke.FixUseWorkspaceChunksFromSelection=pa("advanced.fix.useWorkspaceChunksFromSelection",!1),Ke.FixUseWorkspaceChunksFromDiagnostics=pa("advanced.fix.useWorkspaceChunksFromDiagnostics",!1),Ke.usePythonCookbookLineTooLong=pa("advanced.fix.usePythonCookbookLineTooLong",!1),Ke.CodeMapperChatEndpoint=pa("advanced.codeMapper.chatEndpoint",void 0),Ke.ProjectLabelsExpanded=pa("advanced.projectLabels.expanded",!1),Ke.ProjectLabelsChat=pa("advanced.projectLabels.chat",!1),Ke.ProjectLabelsInline=pa("advanced.projectLabels.inline",!1),Ke.TemporalContextEnabled=pa("chat.experimental.temporalContext.enabled",!1),Ke.WorkspaceCodeSearchEnabled=Ft("advanced.workspace.codeSearchEnabled",void 0),Ke.WorkspaceRerankStrategy=Ft("advanced.workspace.rerankStrategy",void 0),Ke.WorkspaceUseChunksEndpoint=Ft("advanced.workspace.useChunksEndpoint",!1),Ke.WorkspaceCodeSearchReturnRawChunks=Ft("advanced.workspace.codeSearchReturnRawChunks",void 0),Ke.WorkspaceUseFilesVariable=Ft("advanced.workspace.useFilesVariable",!1),Ke.WorkspacePreInitEmbeddings=pa("advanced.workspace.preInitEmbeddings",!1),Ke.UseProjectTemplates=Ft("chat.useProjectTemplates",!0),Ke.ExplainScopeSelection=Ft("chat.scopeSelection",!1),Ke.UseMessageNames=Ft("advanced.useMessageNames",!0),Ke.FeedbackOnChange=Ft("advanced.feedback.onChange",!1),Ke.ReviewContextMenu=Ft("advanced.review.contextMenu",da),Ke.ReviewSCMViewlet=Ft("advanced.review.scmViewlet",da),Ke.ReviewIntent=Ft("advanced.review.intent",!1),Ke.NotebookAdditionalCodeGenerationRuleEnabled=Ft("advanced.notebook.additionalCodeGenerationRule",!1),Ke.NotebookSummaryExperimentEnabled=Ft("advanced.notebook.summaryExperimentEnabled",!1),Ke.NotebookVariableFilteringEnabled=Ft("advanced.notebook.variableFilteringEnabled",!1),Ke.TerminalToDebuggerEnabled=Ft("chat.debugTerminalCommands",!1),Ke.TerminalToDebuggerPatterns=Ft("chat.debugTerminalCommandPatterns",[]),Ke.RunCommandEnabled=Ft("chat.runCommand.enabled",!0),Ke.ShowCodeMatches=pa("advanced.showCodeMatches",!1),Ke.StartDebuggingIntent=Ft("chat.experimental.startDebugging.enabled",!1),Ke.FollowUpsEnabled=pa("advanced.followUps.enabled",!0)))(de||={});var oe=ie("ILogService"),TL=(a=>(a[a.Off=0]="Off",a[a.Trace=1]="Trace",a[a.Debug=2]="Debug",a[a.Info=3]="Info",a[a.Warning=4]="Warning",a[a.Error=5]="Error",a))(TL||{});var sS=class{constructor(e,r,n){this.public=new CL(r,n,e,!1),this.internal=new CL(r,n,e,!0)}};sS=w([b(1,Ga),b(2,be)],sS);var CL=class{constructor(e,r,n,o){this._tokenStore=e;this._configService=r;this._logTargets=n;this._isInternalOnlyLogger=o}get shouldLog(){if(this._isInternalOnlyLogger){let e=this._configService.getConfig(de.InternalLoggingEnabled),r=!!this._tokenStore.copilotToken?.isVscodeTeamMember;return e===void 0?r:e===!1?!1:!!this._tokenStore.copilotToken?.isInternal}return!0}_logIt(e,r){this.shouldLog&&(this._isInternalOnlyLogger&&(r=`[\u{1F92B}] ${r}`),this._logTargets.map(n=>n.logIt(e,r)))}trace(e){this._logIt(1,e)}debug(e){this._logIt(2,e)}info(e){this._logIt(3,e)}warn(e){this._logIt(4,e)}error(e,r){let n=e instanceof Error?e.stack??"Empty error":e;this._logIt(5,n+(r?`: ${r}`:""))}};var wt=ie("IExperimentationService"),EL=class{constructor(){this.initializePromise=Promise.resolve();this.initialFetch=Promise.resolve()}isFlightEnabled(e){return!1}isCachedFlightEnabled(e){return Promise.resolve(!1)}isFlightEnabledAsync(e){return Promise.resolve(!1)}getTreatmentVariable(e,r){}getTreatmentVariableAsync(e,r){return Promise.resolve(void 0)}};var mse=require("vscode");var Kh=ie("IScopeSelector");var UR=class{static{this.version=1}#t;constructor(e){this.#t=e}async selectScope(e,r){if(e??=mse.window.activeTextEditor,!!e)return this.#t.get(Kh).selectEnclosingScope(e,r)}};var Cj=class extends dt{constructor(){super(...arguments);this._contextCtors=[];this._contextResolvers=new Map;this._initialized=!1}get contextResolvers(){return this._contextResolvers.values()}getContextResolver(r){return this._contextResolvers.get(r)}register(r){if(typeof r=="function"){this._handleCtor(r);return}else return this._contextResolvers.set(r.kind,r),Kx(r)&&this._register(r),r}initialize(r){if(this._initialized)return dt.None;for(this._initialized=!0,this._accessor=r;this._contextCtors.length;){let n=this._contextCtors.pop();this._handleCtor(n)}return this}_handleCtor(r){if(!this._accessor){this._contextCtors.push(r);return}try{let n=this._accessor.createInstance(r);this.register(n)}catch(n){console.error(n)}}},pn=new Cj;var Oae=H(Gt()),Mae=H(nt());var pS=H(vae()),JR=require("path");var XR=class{constructor(e,r){this.prev=null;this.next=null;this.key=e,this.value=r}},Od=class{constructor(e=10){if(e<1)throw new Error("Cache size must be at least 1");this._capacity=e,this._cache=new Map,this._head=new XR("",null),this._tail=new XR("",null),this._head.next=this._tail,this._tail.prev=this._head}_addNode(e){e.prev=this._head,e.next=this._head.next,this._head.next.prev=e,this._head.next=e}_removeNode(e){let r=e.prev,n=e.next;r.next=n,n.prev=r}_moveToHead(e){this._removeNode(e),this._addNode(e)}_popTail(){let e=this._tail.prev;return this._removeNode(e),e}clear(){this._cache.clear(),this._head.next=this._tail,this._tail.prev=this._head}deleteKey(e){let r=this._cache.get(e);if(r)return this._removeNode(r),this._cache.delete(e),r.value}get(e){let r=this._cache.get(e);if(r)return this._moveToHead(r),r.value}keys(){let e=[],r=this._head.next;for(;r!==this._tail;)e.push(r.key),r=r.next;return e}getValues(){let e=[],r=this._head.next;for(;r!==this._tail;)e.push(r.value),r=r.next;return e}put(e,r){let n=this._cache.get(e);if(n)n.value=r,this._moveToHead(n);else if(n=new XR(e,r),this._cache.set(e,n),this._addNode(n),this._cache.size>this._capacity){let o=this._popTail();return this._cache.delete(o.key),[o.key,o.value]}}},JL=class{constructor(e){this.actual=new Od(e)}dispose(){this.clear()}clear(){let e=this.actual.getValues();for(let r of e)r.dispose();this.actual.clear()}deleteKey(e){let r=this.actual.deleteKey(e);r&&r.dispose()}get(e){return this.actual.get(e)}keys(){return this.actual.keys()}getValues(){return this.actual.getValues()}put(e,r){let n=this.actual.put(e,r);n&&n[1].dispose()}};var yae=require("fs");function bae(t,e){let r=0,n=0,o;do o=t.readUInt8(e+n),r|=(o&127)<<n*7,n++;while(o&128);return{value:r,consumed:n}}var _ae=t=>{let e=(0,yae.readFileSync)(t),r=new Map;for(let n=0;n<e.length;){let o=bae(e,n);n+=o.consumed,r.set(e.subarray(n,n+o.value),r.size),n+=o.value}return r};var yr=ie("ITokenizerProvider"),xae=3,mMe=3,hMe=1,ZL=class{constructor(){let e=(0,JR.basename)(__dirname)==="dist"?_ae:r=>r;this._cl100kTokenizer=new e4((0,JR.join)(__dirname,"./cl100k_base.tiktoken"),"cl100k_base",e),this._o200kTokenizer=new e4((0,JR.join)(__dirname,"./o200k_base.tiktoken"),"o200k_base",e)}acquireTokenizer(e){let r=e.family;return r==="gpt-4o"||r==="gpt-4o-mini"?this._o200kTokenizer:this._cl100kTokenizer}},e4=class{constructor(e,r,n){this._tokenFilePath=e;this._encoderName=r;this._parser=n;this._cache=new Od(5e3);this.baseTokensPerMessage=mMe;this.baseTokensPerName=hMe}tokenize(e){return this._tokenizer||(this._tokenizer=this.initTokenizer()),this._tokenizer.encode(e)}tokenLength(e){if(!e)return 0;let r=this._cache.get(e);return r||(r=this.tokenize(e).length,this._cache.put(e,r)),r}countMessageTokens(e){return this.baseTokensPerMessage+this.countObjectTokens(e)}countObjectTokens(e){let r=0;for(let[n,o]of Object.entries(e))o&&(typeof o=="string"?r+=this.tokenLength(o):o&&(r+=this.countObjectTokens(o)),n==="name"&&o!==void 0&&(r+=this.baseTokensPerName));return r}initTokenizer(){return(0,pS.createTokenizer)(this._parser(this._tokenFilePath),(0,pS.getSpecialTokensByEncoder)(this._encoderName),(0,pS.getRegexByEncoder)(this._encoderName),64e3)}};var t4=class t{static getIfVisualizationTestIsRunning(){if(ZR.instance)return new t}decorateAndRegister(e,r){let n=!1;return e.render=async function(...o){let s=await Object.getPrototypeOf(e).render.apply(this,...o);return n||(n=!0,new uH(e,r),ZR.instance?.reload()),s},e}},uH=class{constructor(e,r){this._renderer=e;ZR.instance?.addData(`Prompt ${r}`,()=>this.getData())}getData(){class e{constructor(u,l,d){this.label=u;this.children=l;this.range=d;if(!d){let p=l.map(f=>f.range).filter(f=>!!f);if(p.length>0){d=[Number.MAX_SAFE_INTEGER,0];for(let f of p)d[0]=Math.min(d[0],f[0]),d[1]=Math.max(d[1],f[1]);this.range=d}}}toObj(){return{label:this.label,codicon:this.label==="Text"||this.label==="LineBreak"?"text-size":"symbol-class",range:this.range,children:this.children.map(u=>u.toObj())}}}let r=this._renderer,n="";function o(c){if(c.kind===0){let u=["SystemMessage","UserMessage","AssistantMessage"],l=c._obj.constructor.name;u.some(p=>l.indexOf(p)!==-1)&&(n+=`
======== ${l} ========
`);let d=c._children.map(p=>o(p)).filter(p=>p.label!=="LineBreak");return new e(l,d,void 0)}else if(c.kind===1){let u=n.length;return n=n+c.text,new e("Text",[],[u,n.length])}else if(c.kind===2){let u=n.length;return n=n+`
`,new e("LineBreak",[],[u,n.length])}throw new Error}return{root:o(r._root).toObj(),source:n,$fileExtension:"ast.w"}}},ZR=class t{constructor(){this.g=globalThis;this._data=[];this.g.$$debugValueEditor_properties=[]}static{this._instance=void 0}static get instance(){return this._instance}static startRun(){this._instance=new t}addData(e,r){let n="debugValueProperty###"+e;globalThis[n]=r,this._data=[...this._data,{label:e,expression:`globalThis[${JSON.stringify(n)}]()`}],this.g.$$debugValueEditor_properties=this._data}reload(){this.g.$$debugValueEditor_refresh?.("{}")}};var nk=H(Gt());var Ze=H(require("vscode")),rn=Ze.Position,Qe=Ze.Range,fS=Ze.Selection;var ci=Ze.TextEdit,ek=Ze.WorkspaceEdit,Gr=Ze.Uri,us=Ze.MarkdownString;var mS=Ze.DiagnosticSeverity,au=Ze.ExtensionMode,Ri=Ze.Location;var ls=Ze.ChatResponseMarkdownPart,og=Ze.ChatResponseFileTreePart,Sae=Ze.ChatResponseAnchorPart,ui=Ze.ChatResponseProgressPart,Iae=Ze.ChatResponseProgressPart2,r4=Ze.ChatResponseReferencePart,n4=Ze.ChatResponseReferencePart2,Cae=Ze.ChatResponseCodeCitationPart,tk=Ze.ChatResponseCommandButtonPart,Tae=Ze.ChatResponseWarningPart,Eae=Ze.ChatResponseMovePart,wae=Ze.ChatResponseMarkdownWithVulnerabilitiesPart,Uf=Ze.ChatResponseTextEditPart,Rae=Ze.ChatResponseConfirmationPart,kae=Ze.ChatResponseDetectedParticipantPart;var Pae=Ze.ChatRequestTurn;var Aae=Ze.NewSymbolName,Dae=Ze.NewSymbolNameTag,rk=Ze.NewSymbolNameTriggerKind;var Yvt={t:Ze.l10n.t};var lH=H(nt()),Ms=H(nt());var cu=class{toString(){return Object.getPrototypeOf(this).constructor.name}},Bf=class{constructor(e,r){this.request=e;this.sessionId=r;this.status="in-progress";this.contextParts=[];this.references=[]}addReferences(e){this.references=i4([...this.references,...e])}},Md=class{constructor(e=[]){this.turns=e}getLatestTurn(){return this.turns[this.turns.length-1]}addTurn(e){this.turns.forEach(r=>r.chatMessages=[]),this.turns.push(e)}removeTurn(e){let r=this.turns.findIndex(n=>n.requestId===e);if(r!==-1)return this.turns.splice(r,1)[0]}insertBeforeLatestTurn(e){this.turns.splice(this.turns.length-1,0,...e)}getState(){return{turns:this.turns}}};function i4(t){let e=new tn,r=[],n=(s,a)=>{if(s.contains(a))return s;if(a.contains(s))return a;let[c,u]=s.start.line<a.start.line?[s,a]:[a,s];if(c.end.line>=u.start.line-1)return new Qe(c.start,u.end)};return t.forEach(s=>{let a=s.anchor;if("variableName"in a)r.push(s);else if(!Nae(a))e.set(a,s);else{let c=e.get(a.uri);if(!c)e.set(a.uri,[s]);else if(!(c instanceof lH.PromptReference)){let u=[],l=a.range;c.forEach(p=>{if("variableName"in p.anchor||!Nae(p.anchor))return;let f=n(l,p.anchor.range);f?l=f:u.push(p.anchor)});let d={uri:a.uri,range:l};e.set(a.uri,[...u,d].sort((p,f)=>p.range.start.line-f.range.start.line||p.range.end.line-f.range.end.line).map(p=>new lH.PromptReference(p)))}}}),[...Array.from(e.keys()).sort((s,a)=>s.fsPath.localeCompare(a.fsPath)).map(s=>{let a=e.get(s);return a||[]}).flat(),...r]}function Nae(t){return"uri"in t&&"range"in t}function o4(t,e=!0){switch(t){case"snippy":return e?nk.t({message:"Sorry, the response matched public code so it was blocked. Please rephrase your prompt. [Learn more](https://aka.ms/copilot-chat-filtered-docs).",comment:["{Locked='](https://aka.ms/copilot-chat-filtered-docs)'}"]}):nk.t("Sorry, the response matched public code so it was blocked. Please rephrase your prompt.");default:return e?nk.t({message:"Sorry, the response was filtered by the Responsible AI Service. Please rephrase your prompt and try again. [Learn more](https://aka.ms/copilot-chat-filtered-docs).",comment:["{Locked='](https://aka.ms/copilot-chat-filtered-docs)'}"]}):nk.t("Sorry, the response was filtered by the Responsible AI Service. Please rephrase your prompt and try again.")}}var Ho=class{constructor(e,r,n){this.intent=e;this.location=r;this.endpoint=n}async buildPrompt(e,r,n){return await(await this.createRenderer(e,this.endpoint,r,n)).render(r,n)}},Be=class extends Mae.PromptRenderer{constructor(r,n,o,s={validate:!0},a,c){let u=a.acquireTokenizer(r);super(r,n,o,u);this.options=s;this._instantiationService=c}static create(r,n,o,s,a={}){return r.invokeFunction(c=>{let u=c.get(yr),l=new Be(n,o,s,a,u,r),d=t4.getIfVisualizationTestIsRunning();return d&&(l=d.decorateAndRegister(l,o.name)),l})}createElement(r,...n){return this._instantiationService.createInstance(r.ctor,r.props,...n)}async render(r,n){let o=await super.render(r,n),s=o.messages[o.messages.length-1];if(this.options.validate&&s&&s.role!=="user"&&s.role!=="function")throw new Error(Oae.t("Sorry, this message is too long. Please try a shorter question."));return{...o,references:i4(o.references)}}async countTokens(r){return(await super.render(void 0,r)).tokenCount}};Be=w([b(4,yr),b(5,K)],Be);async function ki(t,e,r,n,o,s,a){let c=Be.create(t,e,r,n,a),{messages:u,tokenCount:l,references:d}=await c.render(o,s),p=c.getAllMeta(),f=c.getUsedContext();return{messages:u,tokenCount:l,metadatas:p,usedContext:f,references:i4(d)}}var jae=H(nt());var Bae=require("util");var hr=ie("IFileSystemService");async function Fae(t,e,r){let n=e.textDocuments.find(s=>s.uri.toString()===r.toString());if(n)return n.getText();let o=await t.readFile(r);return new TextDecoder().decode(o)}var Uae=new class{constructor(){this._cache=null}enable(){this._cache=new Od(10)}async readJSON(t,e){if(!this._cache)return this._readJSON(t,e);let r=this._cache.get(e.toString());if(r!==void 0)return r;let n=await this._readJSON(t,e);return this._cache.put(e.toString(),n),n}async _readJSON(t,e){let r=await t.readFile(e);return JSON.parse(r.toString())}};var a4=ie("ITelemetryUserConfig"),hS=class{constructor(e,r,n){this._tokenStore=e;this.trackingId=r,this.optedIn=n??!1,this.setupUpdateOnToken()}setupUpdateOnToken(){this._tokenStore.onDidStoreUpdate(()=>{let e=this._tokenStore.copilotToken;if(!e)return;let r=e.getTokenValue("rt")==="1",n=e.getTokenValue("tid");n!==void 0&&(this.trackingId=n,this.organizationsList=e.organizationList.toString(),this.optedIn=r)})}};hS=w([b(0,Ga)],hS);var he=ie("ITelemetryService"),s4=class{constructor(e){this.value=e;this.isTrustedTelemetryValue=!0}};var Ve=ie("IWorkspaceService"),c4=class{getWorkspaceFolder(e){return this.getWorkspaceFolders().find(r=>r.scheme===e.scheme&&r.authority===e.authority&&e.fsPath.startsWith(r.fsPath))}};function gS(t,e){let r=t.getWorkspaceFolder(e);return r?wr.relative(r.path,e.path):e.path}var u4=ie("IPromptWorkspaceLabels");var vS=class{constructor(e,r,n,o){this._experimentationService=e;this._configurationService=r;this._telemetryService=n;this._instantiationService=o;this.strategy=0;this.basicWorkspaceLabels=this._instantiationService.createInstance(bS),this.expandedWorkspaceLabels=this._instantiationService.createInstance(ik)}get workspaceLabels(){return this.strategy===0?this.basicWorkspaceLabels:this.expandedWorkspaceLabels}get labels(){return[...new Set(this.workspaceLabels.labels)].sort()}async collectContext(){let e=this._configurationService.getExperimentBasedConfig(de.ProjectLabelsExpanded,this._experimentationService);this.strategy=e?1:0,await this.workspaceLabels.collectContext();let r=[...new Set(this.labels)].sort();this._telemetryService.sendMSFTTelemetryEvent("projectLabels",{labels:r.join(",").replaceAll("@"," ")},{count:r.length})}};vS=w([b(0,wt),b(1,be),b(2,he),b(3,K)],vS);var bS=class{constructor(e,r,n){this._workspaceService=e;this._fileSystemService=r;this._ignoreService=n;this.indicators=new Map;this.contentIndicators=new Map;this._labels=[];this.initIndicators()}get labels(){if(this._labels.includes("javascript")&&this._labels.includes("typescript")){let e=this._labels.indexOf("javascript");this._labels.splice(e,1)}return this._labels}async collectContext(){let e=this._workspaceService.getWorkspaceFolders();if(e)for(let r=0;r<e.length;r++)await this.addContextForFolders(e[r])}async addContextForFolders(e){for(let[r,n]of this.indicators.entries())await this.addLabelIfApplicable(e,r,n)}async addLabelIfApplicable(e,r,n){let o=Gr.joinPath(e,r);if(!await this._ignoreService.isCopilotIgnored(o))try{await this._fileSystemService.stat(o),n.forEach(a=>this._labels.push(a));let s=this.contentIndicators.get(r);if(s){let a=await this._fileSystemService.readFile(o);try{s(new Bae.TextDecoder().decode(a)).forEach(u=>this._labels.push(u))}catch{}}}catch{}}initIndicators(){this.addIndicator("package.json","javascript","npm"),this.addIndicator("tsconfig.json","typescript"),this.addIndicator("pom.xml","java","maven"),this.addIndicator("build.gradle","java","gradle"),this.addIndicator("requirements.txt","python","pip"),this.addIndicator("Pipfile","python","pip"),this.addIndicator("Cargo.toml","rust","cargo"),this.addIndicator("go.mod","go","go.mod"),this.addIndicator("pubspec.yaml","dart","pub"),this.addIndicator("build.sbt","scala","sbt"),this.addIndicator("build.boot","clojure","boot"),this.addIndicator("project.clj","clojure","lein"),this.addIndicator("mix.exs","elixir","mix"),this.addIndicator("composer.json","php","composer"),this.addIndicator("Gemfile","ruby","bundler"),this.addIndicator("build.xml","java","ant"),this.addIndicator("build.gradle.kts","java","gradle"),this.addIndicator("yarn.lock","yarn"),this.addIndicator("CMakeLists.txt","c++","cmake"),this.addIndicator("vcpkg.json","c++"),this.addIndicator("Makefile","c++","makefile"),this.addContentIndicator("CMakeLists.txt",this.collectCMakeListsTxtIndicators),this.addContentIndicator("package.json",this.collectPackageJsonIndicators)}addIndicator(e,...r){this.indicators.set(e,r)}addContentIndicator(e,r){this.contentIndicators.set(e,r)}collectCMakeListsTxtIndicators(e){function r(a,c,u){try{let l=Array.from(a.matchAll(c));if(l&&l[0]&&l[0][1]){let d=parseInt(l[0][1]);if(u.includes(d))return d}}catch{}}let n=[],o=r(e,/set\s*\(\s*CMAKE_CXX_STANDARD\s*(\d+)/gmi,[98,11,14,17,20,23,26]);o&&n.push(`C++${o}`);let s=r(e,/set\s*\(\s*CMAKE_C_STANDARD\s*(\d+)/gmi,[90,99,11,17,23]);return s&&n.push(`C${s}`),n}collectPackageJsonIndicators(e){let r=[],n=JSON.parse(e),o=n.dependencies,s=n.devDependencies;o&&(o["@angular/core"]&&r.push("angular"),o.react&&r.push("react"),o.vue&&r.push("vue")),s&&s.typescript&&r.push("typescript");let a=n.engines;return a&&(a.node&&r.push("node"),a.vscode&&r.push("vscode extension")),r}};bS=w([b(0,Ve),b(1,hr),b(2,ke)],bS);var ik=class extends bS{constructor(r,n,o){super(r,n,o);this.popularPackages=["numpy","pandas","scipy","scikit-learn","matplotlib","tensorflow","keras","torch","seaborn","plotly","dash","jupyter","notebook","ipython","openai","pyspark","airflow","nltk","sympy","spacy","langchain","Flask","Django","fastapi","pydantic","requests","beautifulsoup4","gunicorn","uvicorn","httpx","Jinja2","aiohttp","pytest","tox","nox","selenium","playwright","coverage","hypothesis","Sphinx","celery","asyncio","boto3","google-cloud-storage","azure-storage-blob","docker","kubernetes","azure","google","ansible","cryptography","paramiko","PyJWT","xlrd","xlrd-2024","openpyxl","pywin32","pywin","psycopg2","mysqlclient","SQLite4","Werkzeug","pymongo","redis","PyMySQL","Pillow","SQLAlchemy","lxml","html5lib","Markdown","pytz","Click","attrs","PyYAML","configparser","loguru","structlog","pygame","discord"];this.addContentIndicator("package.json",this.collectPackageJsonIndicatorsExpanded),this.addContentIndicator("requirements.txt",this.collectPythonRequirementsIndicators),this.addContentIndicator("pyproject.toml",this.collectPythonTomlIndicators)}collectPackageJsonIndicatorsExpanded(r){let n=[],o=d=>{let[p,f]=d.split(".");return`${p.replace(/[^0-9]/g,"")}.${f.replace(/[^0-9]/g,"")}`},s=(d,p)=>{d&&p.forEach(({dependency:f,prefix:m})=>{if(d[f]){let h=o(d[f]);n.push(`${m||f}@${h}`)}})},a;try{a=JSON.parse(r)}catch{return n}let c=[a.dependencies,a.devDependencies,a.peerDependencies,a.optionalDependencies],u=[{dependency:"react"},{dependency:"vue"},{dependency:"@angular/core"},{dependency:"svelte"},{dependency:"solid-js"},{dependency:"alpinejs"},{dependency:"redux"},{dependency:"mobx"},{dependency:"vuex"},{dependency:"ngrx"},{dependency:"antd"},{dependency:"bootstrap"},{dependency:"bulma"},{dependency:"@mui/material"},{dependency:"semantic-ui-react"},{dependency:"next"},{dependency:"gatsby"},{dependency:"remix"},{dependency:"astro"},{dependency:"sveltekit"},{dependency:"nuxt"},{dependency:"jest"},{dependency:"mocha"},{dependency:"cypress"},{dependency:"@testing-library/react"},{dependency:"@playwright/test"},{dependency:"vitest"},{dependency:"@storybook/react"},{dependency:"tailwindcss"},{dependency:"sass"},{dependency:"styled-components"},{dependency:"css-modules"},{dependency:"postcss"},{dependency:"@emotion/react"},{dependency:"vite"},{dependency:"webpack"},{dependency:"parcel"},{dependency:"rollup"},{dependency:"snowpack"},{dependency:"esbuild"},{dependency:"@swc/core"},{dependency:"socket.io"},{dependency:"d3"},{dependency:"graphql"},{dependency:"lodash"},{dependency:"moment"},{dependency:"rxjs"},{dependency:"underscore"},{dependency:"gulp"},{dependency:"backbone"},{dependency:"ember-source"},{dependency:"handlebars"},{dependency:"jquery"},{dependency:"knockout"},{dependency:"aws-sdk"},{dependency:"cloudinary"},{dependency:"firebase"},{dependency:"@azure/storage-blob"},{dependency:"@google-cloud/storage"},{dependency:"@aws-lambda"},{dependency:"@azure/functions"},{dependency:"@google-cloud/functions"},{dependency:"firebase-functions"},{dependency:"@azure/cosmos"},{dependency:"@google-cloud/firestore"},{dependency:"mongoose"},{dependency:"dockerode"},{dependency:"kubernetes-client"},{dependency:"@elastic/elasticsearch"},{dependency:"@sentry/node"},{dependency:"log4js"},{dependency:"winston"},{dependency:"bcrypt"},{dependency:"helmet"},{dependency:"jsonwebtoken"},{dependency:"passport"},{dependency:"@azure/identity"},{dependency:"@azure/keyvault-certificates"},{dependency:"@azure/keyvault-keys"},{dependency:"@azure/keyvault-secrets"},{dependency:"@azure/service-bus"},{dependency:"@azure/event-hubs"},{dependency:"@azure/data-tables"},{dependency:"@azure/monitor-query"},{dependency:"@azure/app-configuration"},{dependency:"babel"},{dependency:"eslint"},{dependency:"parcel"},{dependency:"prettier"},{dependency:"rollup"},{dependency:"typescript"},{dependency:"webpack"},{dependency:"vite"}],l=[{dependency:"node"},{dependency:"vscode",prefix:"vscode extension"}];return c.forEach(d=>s(d,u)),s(a.engines,l),n}collectPythonRequirementsIndicators(r){let n=[];return r.split(`
`).forEach(s=>{let[a,c]=s.split("==");this.popularPackages.includes(a)&&n.push(`${a}-${c||"latest"}`)}),n}collectPythonTomlIndicators(r){let n=[],o=r.split(`
`),s=!1;return o.forEach(a=>{if(a=a.trim(),a==="[tool.poetry.dependencies]")s=!0;else if(a.startsWith("[")&&a.endsWith("]"))s=!1;else if(s&&a){let[c,u]=a.split("=").map(l=>l.trim().replace(/"|'/g,""));this.popularPackages.includes(c)&&n.push(`${c}-${u||"latest"}`)}}),n}};ik=w([b(0,Ve),b(1,hr),b(2,ke)],ik);var qae=H(nt()),X=class extends qae.PromptElement{constructor(e){super(e)}};var Vo=class extends X{constructor(r,n){super(r);this.workspaceLabels=n}async prepare(){return await this.workspaceLabels.collectContext(),{labels:this.workspaceLabels.labels}}render(r,n){if(r.labels.length!==0)return vscpp(vscppf,null,vscpp(jae.UserMessage,{priority:this.props.priority},"I am working on a project of the following nature:",vscpp("br",null),r.labels.reduce((o,s)=>`${o}
- ${s}`,"").trim()))}};Vo=w([b(1,u4)],Vo);var dH=class{constructor(){this.kind="project-labels"}async resolveContext(e,r){let{messages:n}=await ki(e.get(K),r.endpoint,Vo,{});if(n.length>0)return{kind:this.kind,userMessages:n.map(o=>o.content)}}},ebt=pn.register(new dH);var qe=H(require("vscode"));var l4="https://aka.ms/microsoft/vscode-copilot-release",Xr=ie("IDomainService");var uu=ie("IGithubRepositoryService"),d4=ie("IOctoKitService"),Hae=1682102,ag=class{constructor(e,r){this._domainService=e;this._fetcherService=r}async getCurrentAuthedUserWithToken(e){return this._makeGHAPIRequest("user","GET",e)}async getTeamMembershipWithToken(e,r,n){return this._makeGHAPIRequest(`teams/${e}/memberships/${n}`,"GET",r)}async _makeGHAPIRequest(e,r,n,o){let s=await this._fetcherService.fetch(`${this._domainService.dotComAPIURL}/${e}`,{method:r,headers:{Accept:"application/vnd.github+json","X-GitHub-Api-Version":"2022-11-28",Authorization:`Bearer ${n}`},body:o?JSON.stringify(o):void 0});if(s.ok)try{return await s.json()}catch{return}}};var ok=class extends ag{async getCurrentAuthedUserWithToken(e){return{avatar_url:"",login:"NullUser",name:"Null User"}}async getTeamMembershipWithToken(e,r,n){}async _makeGHAPIRequest(e,r,n,o){}};var nn=ie("IFetcherService"),cg=class{constructor(e,r,n,o,s,a){this.status=e;this.statusText=r;this.headers=n;this.getText=o;this.getJson=s;this.getBody=a;this.ok=this.status>=200&&this.status<300}async text(){return this.getText()}async json(){return this.getJson()}async body(){return this.getBody()}};var _r=function(){if(typeof crypto=="object"&&typeof crypto.randomUUID=="function")return crypto.randomUUID.bind(crypto);let t;typeof crypto=="object"&&typeof crypto.getRandomValues=="function"?t=crypto.getRandomValues.bind(crypto):t=function(n){for(let o=0;o<n.length;o++)n[o]=Math.floor(Math.random()*256);return n};let e=new Uint8Array(16),r=[];for(let n=0;n<256;n++)r.push(n.toString(16).padStart(2,"0"));return function(){t(e),e[6]=e[6]&15|64,e[8]=e[8]&63|128;let o=0,s="";return s+=r[e[o++]],s+=r[e[o++]],s+=r[e[o++]],s+=r[e[o++]],s+="-",s+=r[e[o++]],s+=r[e[o++]],s+="-",s+=r[e[o++]],s+=r[e[o++]],s+="-",s+=r[e[o++]],s+=r[e[o++]],s+="-",s+=r[e[o++]],s+=r[e[o++]],s+=r[e[o++]],s+=r[e[o++]],s+=r[e[o++]],s+=r[e[o++]],s}}();var Jn=class t{static{this.keysExemptedFromSanitization=["VSCode.ABExp.Features","abexp.assignmentcontext"]}constructor(e,r,n){this.properties=e,this.measurements=r,this.issuedTime=n}static createAndMarkAsIssued(e,r){return new t(e||{},r||{},Date.now())}extendedBy(e,r){let n={...this.properties,...e},o={...this.measurements,...r},s=new t(n,o,this.issuedTime);return s.displayedTime=this.displayedTime,s}markAsDisplayed(){this.displayedTime===void 0&&(this.displayedTime=Date.now())}extendWithEditorAgnosticFields(e){this.properties.editor_version=e.getEditorInfo().format(),this.properties.editor_plugin_version=e.getEditorPluginInfo().format(),this.properties.client_machineid=e.machineId,this.properties.client_sessionid=e.sessionId,this.properties.copilot_version=`copilot/${e.getVersion()}`,this.properties.common_extname=e.getEditorPluginInfo().name,this.properties.common_extversion=e.getEditorPluginInfo().version,this.properties.common_vscodeversion=e.getEditorInfo().format()}extendWithConfigProperties(e,r,n){let o=e.dumpConfig();o["copilot.build"]=r.getBuild(),o["copilot.buildType"]=r.getBuildType(),n.trackingId&&(o["copilot.trackingId"]=n.trackingId),n.organizationsList&&(o.organizations_list=n.organizationsList),this.properties={...this.properties,...o}}extendWithRequestId(e){let r={completionId:e.completionId,created:e.created.toString(),headerRequestId:e.headerRequestId,serverExperiments:e.serverExperiments,deploymentId:e.deploymentId};this.properties={...this.properties,...r}}static{this.keysToRemoveFromStandardTelemetryHack=["gitRepoHost","gitRepoName","gitRepoOwner","gitRepoUrl","gitRepoPath","repo","request_option_nwo","userKind"]}static maybeRemoveRepoInfoFromPropertiesHack(e,r){if(e)return r;let n={};for(let o in r)t.keysToRemoveFromStandardTelemetryHack.includes(o)||(n[o]=r[o]);return n}sanitizeKeys(){this.properties=t.sanitizeKeys(this.properties),this.measurements=t.sanitizeKeys(this.measurements)}static sanitizeKeys(e){e=e||{};let r={};for(let n in e){let o=t.keysExemptedFromSanitization.includes(n)?n:n.replace(/\./g,"_");r[o]=e[n]}return r}updateTimeSinceIssuedAndDisplayed(){let e=Date.now()-this.issuedTime;if(this.measurements.timeSinceIssuedMs=e,this.displayedTime!==void 0){let r=Date.now()-this.displayedTime;this.measurements.timeSinceDisplayedMs=r}}makeReadyForSending(e,r,n){this.extendWithConfigProperties(e,r,n),this.extendWithEditorAgnosticFields(r),this.sanitizeKeys(),this.updateTimeSinceIssuedAndDisplayed();for(let o in this.properties)this.properties[o]===void 0&&delete this.properties[o];gMe(r,this.properties)}};function Vae(t){if(!t)return;let e={};for(let r in t){let n=t[r];n&&(n.value?e[r]=n.value:e[r]=n)}return e}function gMe(t,e){e.unique_id=_r(),e.common_extname=t.getEditorPluginInfo().name,e.common_extversion=t.getEditorPluginInfo().version,e.common_vscodeversion=t.getEditorInfo().format()}var Kb=class{constructor(e){this._info=e;this.tokenMap=this.parseToken(e.token)}parseToken(e){let r=new Map,o=e?.split(":")[0]?.split(";");for(let s of o){let[a,c]=s.split("=");r.set(a,c)}return r}get token(){return this._info.token}get sku(){return this._info.sku}get organizationList(){return this._info.organization_list||[]}get enterpriseList(){return this._info.enterprise_list||[]}get endpoints(){return this._info.endpoints||{api:"https://api.githubcopilot.com",telemetry:"https://copilot-telemetry.githubusercontent.com"}}get isInternal(){let e=["4535c7beffc844b46bb1ed4aa04d759a","a5db0bcaae94032fe715fb34a5e4bce2","7184f66dfcee98cb5f08a1cb936d5225","1cb18ac6eedd49b43d74a1c5beb0b955"];for(let r of this.organizationList)if(e.includes(r))return!0;return!1}get isVscodeTeamMember(){return this._info.isVscodeTeamMember}get username(){return this._info.username}isTelemetryEnabled(){return this._isTelemetryEnabled===void 0&&(this._isTelemetryEnabled=this._info.telemetry==="enabled"),this._isTelemetryEnabled}isPublicSuggestionsEnabled(){return this._isPublicSuggestionsEnabled===void 0&&(this._isPublicSuggestionsEnabled=this._info.public_suggestions==="enabled"),this._isPublicSuggestionsEnabled}isChatEnabled(){return this._info.chat_enabled??!1}isCopilotIgnoreEnabled(){return this._info.copilotignore_enabled??!1}getTokenValue(e){return this.tokenMap.get(e)}};var Qb=ie("ICopilotTokenManager");function ug(){return Math.floor(Date.now()/1e3)}var _S=class extends dt{constructor(r,n,o,s,a,c){super();this._baseOctokitservice=r;this._logService=n;this._telemetryService=o;this._domainService=s;this._fetcherService=a;this._envService=c;this._refreshDelayer=this._register(new $h(1e3));this._isDisposed=!1;this._copilotTokenRefreshEmitter=this._register(new Yt);this.onDidCopilotTokenRefresh=this._copilotTokenRefreshEmitter.event;this._register(qa(()=>this._isDisposed=!0))}get copilotToken(){return this._copilotToken}set copilotToken(r){r!==this._copilotToken&&(this._copilotToken=r,this._copilotTokenRefreshEmitter.fire(),r&&this._refreshToken(r.refresh_in))}resetCopilotToken(r){r!==void 0&&this._telemetryService.sendGHTelemetryEvent("auth.reset_token_"+r),this._logService.public.debug(`Resetting copilot token on HTTP error ${r||"unknown"}`),this.copilotToken=void 0}async authFromGitHubToken(r){this._telemetryService.sendGHTelemetryEvent("auth.new_login");let n=await this.fetchCopilotToken(r);if(!n)return this._logService.public.warn("Failed to get copilot token"),this._telemetryService.sendGHTelemetryErrorEvent("auth.request_failed"),{kind:"failure",reason:"FailedToGetToken"};let o=await n.json();if(!o)return this._logService.public.warn("Failed to get copilot token"),this._telemetryService.sendGHTelemetryErrorEvent("auth.request_read_failed"),{kind:"failure",reason:"FailedToGetToken"};if(n.status===401)return this._logService.public.warn("Failed to get copilot token due to 401 status"),this._telemetryService.sendGHTelemetryErrorEvent("auth.unknown_401"),{kind:"failure",reason:"HTTP401"};if(n.status===403&&o.message?.startsWith("API rate limit exceeded"))return this._logService.public.warn("Failed to get copilot token due to exceeding API rate limit"),this._telemetryService.sendGHTelemetryErrorEvent("auth.rate_limited"),{kind:"failure",reason:"RateLimited"};if(!n.ok||!o.token){this._logService.public.warn(`Invalid copilot token: missing token: ${n.status} ${n.statusText}`);let p=Jn.createAndMarkAsIssued({status:n.status.toString(),status_text:n.statusText});return this._telemetryService.sendGHTelemetryErrorEvent("auth.invalid_token",p.properties,p.measurements),{kind:"failure",reason:"NotAuthorized",...o.error_details}}let s=o.expires_at;o.expires_at=ug()+o.refresh_in+60;let c=(await this._baseOctokitservice.getCurrentAuthedUserWithToken(r))?.login??"unknown",u=await this._baseOctokitservice.getTeamMembershipWithToken(Hae,r,c),l={...o,username:c,isVscodeTeamMember:!!u},d=Jn.createAndMarkAsIssued({},{adjusted_expires_at:o.expires_at,expires_at:s,current_time:ug()});return this._telemetryService.sendGHTelemetryEvent("auth.new_token",d.properties,d.measurements),{kind:"success",...l}}async _refreshToken(r){if(this._isDisposed)return;let n=ug();try{await this._refreshDelayer.trigger(async()=>{if(this._isDisposed)return;let o,s="";try{await this.getCopilotToken(!0),o="success"}catch(c){o="failure",s=c.toString()}let a=Jn.createAndMarkAsIssued({result:o},{time_taken:ug()-n});s&&(a.properties.reason=s),this._telemetryService.sendGHTelemetryEvent("auth.token_refresh",a.properties,a.measurements)},r*1e3)}catch(o){if(o instanceof Hi)return;throw o}}async fetchCopilotToken(r){let n=this._domainService.tokenURL;return await this._fetcherService.fetch(n,{headers:{Authorization:`token ${r}`,...this._envService.getEditorVersionHeaders()}})}},yS=class extends _S{constructor(r,n,o,s,a,c){super(new ok(s,a),n,o,s,a,c);this._completionsToken=r;this.copilotToken={token:r,expires_at:0,refresh_in:0,username:"fixedTokenManager",isVscodeTeamMember:!1}}set completionsToken(r){this._completionsToken=r,this.copilotToken={token:r,expires_at:0,refresh_in:0,username:"fixedTokenManager",isVscodeTeamMember:!1}}get completionsToken(){return this._completionsToken}async getCopilotToken(){return new Kb(this.copilotToken)}async checkCopilotToken(){return{status:"OK"}}};yS=w([b(1,oe),b(2,he),b(3,Xr),b(4,nn),b(5,St)],yS);var Yb=class extends _S{constructor(r,n,o,s,a,c,u){super(new ok(s,a),n,o,s,a,c);this.githubToken=r;this.configurationService=u}async getCopilotToken(r){if(!this.copilotToken||this.copilotToken.expires_at<ug()||r){let n=await this.authFromGitHubToken(this.githubToken);if(n.kind==="failure")throw Error(`Failed to get copilot token: ${n.reason.toString()} ${n.message??""}`);this.copilotToken={...n}}return new Kb(this.copilotToken)}async checkCopilotToken(){if(!this.copilotToken||this.copilotToken.expires_at<ug()){let n=await this.authFromGitHubToken(this.githubToken);if(n.kind==="failure")return n;this.copilotToken={...n}}return{status:"OK"}}};Yb=w([b(1,oe),b(2,he),b(3,Xr),b(4,nn),b(5,St),b(6,be)],Yb);var pH=["user:email"],Gae=["read:user"],p4=["read:user","user:email","repo","workflow"],Nt=ie("IAuthenticationService"),xS=class extends dt{constructor(r,n,o){super();this._logService=r;this._tokenStore=n;this._tokenManager=o;this._onDidAuthenticationChange=this._register(new Yt);this.onDidAuthenticationChange=this._onDidAuthenticationChange.event;this._onDidAccessTokenChange=this._register(new Yt);this.onDidAccessTokenChange=this._onDidAccessTokenChange.event;this._register(o.onDidCopilotTokenRefresh(()=>{this._logService.internal.debug("Handling CopilotToken refresh."),this._handleAuthChangeEvent()}))}get anyGitHubSession(){return this._anyGitHubSession}get permissiveGitHubSession(){return this._permissiveGitHubSession}get copilotToken(){return this._tokenStore.copilotToken}async getCopilotToken(r){try{await this.getAnyGitHubSession({silent:!0});let n=await this._tokenManager.getCopilotToken(r);return this._tokenStore.copilotToken=n,this._copilotTokenError=void 0,n}catch(n){this._tokenStore.copilotToken=void 0;let o=this._copilotTokenError;throw this._copilotTokenError=n,o&&n&&o.message!==n.message&&this._onDidAuthenticationChange.fire(),n}}resetCopilotToken(r){this._tokenStore.copilotToken=void 0,this._tokenManager.resetCopilotToken(r)}async _handleAuthChangeEvent(){let r=this._anyGitHubSession,n=this._permissiveGitHubSession,o=this._tokenStore.copilotToken,s=this._copilotTokenError,a=await Promise.allSettled([this.getAnyGitHubSession({silent:!0}),this.getPermissiveGitHubSession({silent:!0})]);for(let c of a)c.status==="rejected"&&this._logService.public.error(`Error getting a session: ${c.reason}`);if(r?.accessToken!==this._anyGitHubSession?.accessToken||n?.accessToken!==this._permissiveGitHubSession?.accessToken){this._onDidAccessTokenChange.fire(),this._logService.internal.debug("Auth state changed, minting a new CopilotToken...");try{await this.getCopilotToken(!0)}catch{}this._logService.internal.debug("Minted a new CopilotToken.");return}try{await this.getCopilotToken()}catch{}(o?.token!==this._tokenStore.copilotToken?.token||s?.message!==this._copilotTokenError?.message)&&(this._logService.internal.debug("CopilotToken state changed, firing event."),this._onDidAuthenticationChange.fire()),this._logService.internal.debug("Finished handling auth change event.")}};xS=w([b(0,oe),b(1,Ga),b(2,Qb)],xS);var SS=ie("IChatAgentService"),fH="default",sk="editor",qf="workspace",ak="vscode",Xb="terminal",zae=[fH,sk,qf,ak,Xb],mH="github.copilot.";function lg(t){return`${mH}${t}`}function $ae(t){return t.replace(/^github\.copilot\./,"")}var gt=(n=>(n[n.InlineChat=1]="InlineChat",n[n.PanelChat=2]="PanelChat",n[n.Other=3]="Other",n))(gt||{});(e=>{function t(r){switch(r){case 1:return"conversationInline";case 2:return"conversationPanel";default:return"none"}}e.toString=t})(gt||={});var Rr=ie("ConversationOptions");var f4=ie("IDevContainerConfigurationService");function hH(t){return t.capabilities.type==="chat"}function Wae(t){return t.capabilities.type==="embeddings"}var Se=ie("IEndpointProvider");var jf=ie("IWorkbenchService");var Go=ie("IEmbeddingsComputer"),Kae=.72;function gH(t,e,r,n){return e.map(([o,s])=>{let a=0;for(let c=0;c<s.length;c++)a+=s[c]*t[c];return{score:a,item:o}}).filter(o=>o.score>n).sort((o,s)=>s.score-o.score).slice(0,r).map(o=>o.item)}function dg(t,e){let r=t.reduce((s,a,c)=>s+a*e[c],0),n=Math.sqrt(t.reduce((s,a)=>s+a*a,0)),o=Math.sqrt(e.reduce((s,a)=>s+a*a,0));return r/(n*o)}var jt=ie("IVSCodeExtensionContext");function bMe(t){switch(t.model){case"text-embedding-3-small":return"text-3-small";default:return"text-ada-002"}}var IS=class{constructor(e,r,n,o,s){this.cacheType=e;this.cacheKey=r;this.cacheVersion=n;this.fileSystemService=o;this.extensionContext=s;this.cacheVersionKey=`${r}-version`}get cacheStorageUri(){return this.cacheType===2?this.extensionContext.storageUri:this.extensionContext.globalStorageUri}get cacheVersionMementoStorage(){return this.cacheType===2?this.extensionContext.workspaceState:this.extensionContext.globalState}async updateCache(e){if(!this.cacheStorageUri||!this.fileSystemService.isWritableFileSystem(this.cacheStorageUri.scheme))return;try{await this.fileSystemService.stat(this.cacheStorageUri)}catch{await this.fileSystemService.createDirectory(this.cacheStorageUri)}await this.cacheVersionMementoStorage.update(this.cacheVersionKey,this.cacheVersion),this.cacheVersionMementoStorage.get(this.cacheKey)&&await this.cacheVersionMementoStorage.update(this.cacheKey,void 0);let n=Ye.joinPath(this.cacheStorageUri,`${this.cacheKey}.json`);try{await(e===void 0?this.fileSystemService.delete(n,{useTrash:!1}):this.fileSystemService.writeFile(n,Buffer.from(JSON.stringify(e))))}catch{e!==void 0&&console.error(`Failed to write embeddings cache to ${n}`)}}async getCache(){if(!(!this.cacheStorageUri||this.cacheVersionMementoStorage.get(this.cacheVersionKey)!==this.cacheVersion))try{return await Uae.readJSON(this.fileSystemService,Ye.joinPath(this.cacheStorageUri,`${this.cacheKey}.json`))}catch{return}}async clearCache(){return this.updateCache(void 0)}};IS=w([b(3,hr),b(4,jt)],IS);var Ac=class extends IS{constructor(r,n,o,s,a,c,u,l){super(r,n,o,u,l);this.remoteCacheType=s;this.endpointProvider=a;this.fetcherService=c;this.remoteCacheVersionKey=`${n}-version-remote`}async getRemoteContainer(){let r=await this.endpointProvider.getEmbeddingsEndpoint("text3small");return bMe(r)}async getRemoteCacheURL(){if(!this._remoteCacheURL){let r=await this.getRemoteContainer();this._remoteCacheURL=Ac.calculateRemoteCDNURL(r,this.remoteCacheType,this.cacheVersion)}return this._remoteCacheURL}async getRemoteCacheLatestUpdateURL(){if(!this._remoteCacheLatestUpdateURL){let r=await this.getRemoteContainer();this._remoteCacheLatestUpdateURL=Ac.calculateRemoteCDNLatestURL(r,this.remoteCacheType,this.cacheVersion)}return this._remoteCacheLatestUpdateURL}async fetchRemoteCache(){if(this._remoteCache)return this._remoteCache;let r=await this.getRemoteCacheURL();try{let n=await this.getRemoteCacheURL(),o=await this.fetcherService.fetch(n,{method:"GET"});if(o.ok)return this._remoteCache=await o.json(),this._remoteCache;console.error(`Failed to fetch remote embeddings cache from ${n}`),console.error(`Response status: ${o.status}, status text: ${o.statusText}`);return}catch(n){console.error(`Failed to fetch remote embeddings cache from ${r}`),console.error(n);return}}async fetchRemoteCacheLatest(){let r=await this.getRemoteCacheLatestUpdateURL();try{let n=await this.fetcherService.fetch(r,{method:"GET"});if(n.ok)return n.text();console.error(`Failed to fetch remote embeddings cache from ${r}`),console.error(`Response status: ${n.status}, status text: ${n.statusText}`);return}catch(n){console.error(`Failed to fetch remote embeddings cache from ${r}`),console.error(n);return}}async getCache(){let r=await this.fetchRemoteCacheLatest(),n=await super.getCache();if(n&&r===this.cacheVersionMementoStorage.get(this.remoteCacheVersionKey))return n;let o=await this.fetchRemoteCache();return await this.cacheVersionMementoStorage.update(this.remoteCacheVersionKey,r),await this.updateCache(o),o}async updateCache(r,n){if(r===void 0)return super.updateCache(r);if(!await super.getCache()||n)return super.updateCache(r)}static calculateRemoteCDNURL(r,n,o){return`https://embeddings.vscode-cdn.net/${r}/v${o}/${n}/core.json`}static calculateRemoteCDNLatestURL(r,n,o){return`https://embeddings.vscode-cdn.net/${r}/v${o}/${n}/latest.txt`}};Ac=w([b(4,Se),b(5,nn),b(6,hr),b(7,jt)],Ac);var Hf=class extends Ac{constructor(r,n,o,s,a,c,u,l,d){super(r,n,o,s,a,c,u,l);this.workbenchService=d;this._wasRemoteExtensionCacheUpdated=!1}async getBaseExtensionCDNURL(){if(!this._baseExtensionCDNURL){let r=await this.getRemoteContainer();this._baseExtensionCDNURL=Hf.calculateBaseRemoteExtensionCDNURL(r,this.remoteCacheType,this.cacheVersion)}return this._baseExtensionCDNURL}constructExposedCache(){if(!this._remoteExtensionCache)return;let r={...this._remoteExtensionCache.core};for(let n in this._remoteExtensionCache.extensions){let o=this._remoteExtensionCache.extensions[n];for(let s in o)r[s]=o[s]}return r}async fetchRemoteExtensionCache(r){let o=`${await this.getBaseExtensionCDNURL()}/${r}.json`;try{let s=await this.fetcherService.fetch(o,{method:"GET"});if(s.ok)return await s.json();if(s.status===404)return{};console.error(`Failed to fetch remote embeddings cache from ${o}`),console.error(`Response status: ${s.status}, status text: ${s.statusText}`);return}catch(s){console.error(`Failed to fetch remote embeddings cache from ${o}`),console.error(s);return}}async getCache(){let r=await super.getCache();if(r===void 0)return;let n={core:{},extensions:{}};r&&Hf.isEmbeddingsCacheEntriesWithExtensions(r)?n=r:n={core:r,extensions:{}};let o=Hf.getInstalledExtensionIds(this.workbenchService),s=!1;for(let c in n.extensions)o.includes(c)||(delete n.extensions[c],s=!0);let a=o.filter(c=>!(c in n.extensions)||n.extensions[c]===void 0);for(let c of a){let u=await this.fetchRemoteExtensionCache(c);u&&(n.extensions[c]=u)}return this._remoteExtensionCache=n,this._wasRemoteExtensionCacheUpdated=a.length>0||s,this.constructExposedCache()}async updateCache(r,n){let o=r?super.updateCache(this._remoteExtensionCache,n||this._wasRemoteExtensionCacheUpdated):super.updateCache(r,n||this._wasRemoteExtensionCacheUpdated);return this._wasRemoteExtensionCacheUpdated=!1,o}static isEmbeddingsCacheEntriesWithExtensions(r){return"core"in r&&"extensions"in r}static getInstalledExtensionIds(r){return r.getAllExtensions().filter(n=>!n.id.startsWith("vscode")).map(n=>n.id)}static calculateBaseRemoteExtensionCDNURL(r,n,o){return`https://embeddings.vscode-cdn.net/${r}/v${o}/${n}`}};Hf=w([b(4,Se),b(5,nn),b(6,hr),b(7,jt),b(8,jf)],Hf);var m4=class{constructor(e,r,n,o,s,a,c,u,l){this._endpointProvider=r;this.cacheKey=o;this.embeddingsComputer=a;this.logService=l;this._isIndexLoaded=!1;this._items=new Map,c?.type&&!c.supportsExtensions?this._embeddingsCache=u.createInstance(Ac,n,o,s,c.type):c?.type&&c.supportsExtensions?this._embeddingsCache=u.createInstance(Hf,n,o,s,c.type):this._embeddingsCache=u.createInstance(IS,n,o,s)}get isIndexLoaded(){return this._isIndexLoaded}set isIndexLoaded(e){this._isIndexLoaded=e}async rebuildCache(){return await this._embeddingsCache.clearCache(),this._items.clear(),this.calculateEmbeddings()}nClosestValues(e,r){let n=Array.from(this._items.values()).map(o=>{if(!o.embedding)return{item:o,similarity:0};let s=dg(e,o.embedding);return{item:o,similarity:s}});return n=n.filter(o=>o.similarity>0),n.sort((o,s)=>s.similarity-o.similarity),n.slice(0,r).map(o=>o.item)}hasItem(e){return this._items.has(e)}getItem(e){return this._items.get(e)}async calculateEmbeddings(){return this._calculationPromise?this._calculationPromise:(this._calculationPromise=this._calculateEmbeddings(),this._calculationPromise.then(()=>this._calculationPromise=void 0))}async _calculateEmbeddings(){let e=Date.now(),r=await this.getLatestItems(),n=await this._embeddingsCache.getCache(),o=new Map;for(let s of r){let a=s,c=this._items.get(s.key),u=s.key;c?.embedding?a=c:n&&n[u]&&(a={...s,...n[u]}),o.set(u,a)}this._items=o,await this._embeddingsCache.updateCache(n),this.logService.internal.debug(`Embeddings for ${this.cacheKey} calculated in ${Date.now()-e}ms`),this.isIndexLoaded=!0}};function Jb(t){let e=t.split(".");return`${e[0]}.${e[1]}`}function vH(t){let e=`Setting Id: ${t.key}
`;if(e+=`Type: ${t.type}
`,e+=`Description: ${t.description??t.markdownDescription??""}
`,t.enum){e+=`Possible values:
`;for(let r=0;r<t.enum.length;r++)e+=` - ${t.enum[r]} - ${t.enumDescriptions?.[r]??""}
`}return e+=`
`,e}var h4=class extends m4{constructor(r,n,o,s,a,c,u,l,d,p,f){super(r,l,n,o,s,a,u,d,p);this.relatedInformationConfig=c;this._logService=p;this.telemetryService=f;this.isIndexLoaded=!1}async provideRelatedInformation(r,n){let o=Date.now();if(!this.isIndexLoaded)return this.calculateEmbeddings(),this._logService.internal.debug(`Related Information: Index not loaded yet triggering background calculation, returning ${Date.now()-o}ms`),[];if(n.isCancellationRequested)return this._logService.internal.debug(`Related Information: Request cancelled, returning ${Date.now()-o}ms`),[];let s=Date.now(),a=await this._endpointProvider.getEmbeddingsEndpoint("text3small"),c=await this.embeddingsComputer.computeEmbeddings(a,[r],{},n);if(this._logService.internal.debug(`Related Information: Remote similarly request took ${Date.now()-s}ms`),n.isCancellationRequested||!c||!c.embeddings[0])return this._logService.internal.debug(`Related Information: Request cancelled or no embeddings computed, returning ${Date.now()-o}ms`),[];let u=[];for(let d of this._items.values()){if(n.isCancellationRequested){this._logService.internal.debug(`Related Information: Request cancelled, returning ${Date.now()-o}ms`);break}if(d.embedding){let p=dg(c.embeddings[0],d.embedding);p>this.relatedInformationConfig.threshold&&u.push(this.toRelatedInformation(d,p))}}return this.logService.internal.debug(`Related Information: Successfully Calculated, returning ${Date.now()-o}ms`),this.relatedInformationConfig.type===4&&this.telemetryService.sendInternalMSFTTelemetryEvent("relatedInformationSettings",{query:r}),u.sort((d,p)=>p.weight-d.weight).slice(0,this.relatedInformationConfig.maxResults)}},ck=class extends h4{constructor(r,n,o,s,a,c,u){super("CommandIdIndex",1,"commandEmbeddings",Jb(o.getEditorInfo().version),r,{type:2,threshold:.7,maxResults:100},{type:"commands",supportsExtensions:!0},n,s,a,c);this.workbenchService=u}async getLatestItems(){let r=await this.workbenchService.getAllCommands();return r.push({label:"Extensions: Search the marketplace for extensions",command:"workbench.extensions.search",keybinding:"Not set"}),r.push({label:"Extensions: Install extension from marketplace",command:"workbench.extensions.installExtension",keybinding:"Not set"}),r.map(n=>({key:n.command,label:n.label.replace("View: Toggle","View: Toggle or Show or Hide"),originalLabel:n.label,keybinding:n.keybinding??"Not set"}))}getEmbeddingQueryString(r){return`${r.label} - ${r.key}`}toRelatedInformation(r,n){return{type:2,weight:n,command:r.key}}};ck=w([b(0,Go),b(1,Se),b(2,St),b(3,K),b(4,oe),b(5,he),b(6,jf)],ck);var uk=class extends h4{constructor(r,n,o,s,a,c,u){super("SettingsIndex",1,"settingEmbeddings",Jb(o.getEditorInfo().version),r,{type:4,threshold:.7,maxResults:100},{type:"settings",supportsExtensions:!0},n,s,a,c);this.workbenchService=u}async getLatestItems(){let r=await this.workbenchService.getAllSettings(),n=[];for(let o of Object.keys(r)){let s=r[o];s.deprecationMessage||s.markdownDeprecationMessage||n.push({...s,key:o})}return n}getEmbeddingQueryString(r){return vH(r)}toRelatedInformation(r,n){return{type:4,weight:n,setting:r.key}}};uk=w([b(0,Go),b(1,Se),b(2,St),b(3,K),b(4,oe),b(5,he),b(6,jf)],uk);var Rl=ie("ICombinedEmbeddingIndex"),CS=class{constructor(e){this.commandIdIndex=e.createInstance(ck),this.settingsIndex=e.createInstance(uk)}async loadIndexes(){await Promise.all([this.commandIdIndex.isIndexLoaded?Promise.resolve():this.commandIdIndex.calculateEmbeddings(),this.settingsIndex.isIndexLoaded?Promise.resolve():this.settingsIndex.calculateEmbeddings()])}async nClosestValues(e,r){return await this.loadIndexes(),{commands:this.commandIdIndex.nClosestValues(e,r),settings:this.settingsIndex.nClosestValues(e,r)}}hasSetting(e){return this.settingsIndex.hasItem(e)}hasCommand(e){return this.commandIdIndex.hasItem(e)}getSetting(e){return this.settingsIndex.getItem(e)}getCommand(e){return this.commandIdIndex.getItem(e)}};CS=w([b(0,K)],CS);var g4=ie("IGitCommitMessageService");var zo=require("vscode");var kl=H(require("vscode")),TS=class{async stat(e){return kl.workspace.fs.stat(e)}async readDirectory(e){return kl.workspace.fs.readDirectory(e)}async createDirectory(e){return kl.workspace.fs.createDirectory(e)}async readFile(e){return kl.workspace.fs.readFile(e)}async writeFile(e,r){return kl.workspace.fs.writeFile(e,r)}async delete(e,r){return kl.workspace.fs.delete(e,r)}async rename(e,r,n){return kl.workspace.fs.rename(e,r,n)}async copy(e,r,n){return kl.workspace.fs.copy(e,r,n)}isWritableFileSystem(e){return!!kl.workspace.fs.isWritableFileSystem(e)}createFileSystemWatcher(e){return kl.workspace.createFileSystemWatcher(e)}};var _o=ie("IGitExtensionService");var xo=ie("IGitService");function ES(t){if(!t)return;if(t.remoteFetchUrls?.length===1)return bH(t.remoteFetchUrls[0]);let e=t.remotes.findIndex(n=>n===t.upstreamRemote);if(e!==-1){let n=t.remoteFetchUrls?.[e];if(n){let o=bH(n);if(o)return o}}let r=t.remotes.findIndex(n=>n==="origin");if(r!==-1){let n=t.remoteFetchUrls?.[r];if(n){let o=bH(n);if(o)return o}}}function bH(t){t=t.replace(/^git@/,"").replace(/\.git$/,"");try{let e=Ye.parse(t);if(e.authority!=="github.com"&&e.scheme!=="github.com")return;let r=e.path.replace(/^\//,"").trim(),[n,o,s]=r.split("/");return n&&o?`${n}/${o}`:void 0}catch{return}}function Xae(t){if(t.includes("@")&&t.includes(":")){let e="https://"+t.substring(t.indexOf("@")+1).replace(":","/"),r=new URL(e);return r.username="",r.password="",r.search="",r.toString()}else{let e=new URL(t);return e.protocol="https",e.username="",e.password="",e.search="",e.toString()}}var yH=H(require("vscode"));var Fd=ie("ISearchService"),v4=class{async findFilesWithDefaultExcludes(e,r,n){return this._findFilesWithDefaultExcludesAndExcludes(e,void 0,r,n)}async findFilesWithExcludes(e,r,n,o){return this._findFilesWithDefaultExcludesAndExcludes(e,r,n,o)}async _findFilesWithDefaultExcludesAndExcludes(e,r,n,o){let s={maxResults:n,exclude:r,useDefaultExcludes:!0,useDefaultSearchExcludes:!0},a=await this.findFiles(e,s,o);return n===1?a[0]:a}};var wS=class extends v4{findTextInFiles(e,r,n,o){return Promise.resolve(yH.workspace.findTextInFiles(e,r,s=>n.report(s),o))}findFiles(e,r,n){return yH.workspace.findFiles2(e,r,n)}};var RS=class{constructor(e,r){this.baseUri=e;this.pattern=r}get base(){throw new Error("Not implemented")}};function Jae(t){if(typeof t!="string")throw new TypeError("Argument must be a string.");if(!t)return t;let e=t.startsWith("!"),r=e?t.slice(1):t,n=r,o=!1;switch(r[0]==="/"&&(o=!0,n=r.slice(1)),n[0]){case"*":r[1]!=="*"&&(n="**/"+n);break;default:if((!o&&!n.includes("/")||n.endsWith("/"))&&(n="**/"+n),n.endsWith("*")||n.endsWith("?"))break;/\.[a-z\d_-]+$/.test(n)||(n.endsWith("/")||(n+="/"),n+="**")}return e?"!"+n:n}var lce=H(cce()),ma=require("path");var y4=class{constructor(){this._ignoreMap=new Map;this._ignoreCache=new Map;this._searchRankCache=null}setIgnoreFile(e,r,n){let o="";e&&(o=(0,ma.relative)(e.fsPath,(0,ma.dirname)(r.fsPath)),o.startsWith("..")&&(o="")),this._ignoreMap.set(r.fsPath,{ignore:(0,lce.default)().add(n),patterns:Gb(n).filter(s=>s.trim()&&!s.startsWith("#")).map(Jae).map(s=>o?ma.posix.join(o,s):s)}),this._searchRankCache=null,this._ignoreCache.clear()}removeIgnoreFile(e){this._ignoreMap.delete(e.fsPath),this._searchRankCache=null,this._ignoreCache.clear()}removeWorkspace(e){let r=0;for(let n of this._ignoreMap.keys())uce(e.fsPath,n)&&(this._ignoreMap.delete(n),r+=1);r>0&&(this._searchRankCache=null,this._ignoreCache.clear())}asMinimatchPatterns(){return[...this._ignoreMap.values()].flatMap(e=>e.patterns)}isIgnored(e){if(this._ignoreMap.size===0)return!1;let r=e.fsPath;if(this._ignoreCache.has(r))return this._ignoreCache.get(r);let n=0,o={ignored:!1,unignored:!1};try{let s=this._searchRank;for(let a of s){n+=1;let c=(0,ma.dirname)(a),u=(0,ma.relative)(c,r);if(!u.startsWith("..")&&c!==r&&uce(c,r)){let l=this._ignoreMap.get(a);if(!l)throw new Error(`No ignore patterns found for ${a}`);if(o=l.ignore.test(u),o.ignored||o.unignored)break}}return this._ignoreCache.set(r,o.ignored),o.ignored}catch{return!1}}get _searchRank(){if(this._searchRankCache!==null)return this._searchRankCache;let e={},r=n=>n.split(ma.sep).length;return this._searchRankCache=[...this._ignoreMap.keys()].sort((n,o)=>(e[o]||=r(o))-(e[n]||=r(n)))}};function uce(t,e){return t===e?!0:(t.charAt(t.length-1)!==ma.sep&&(t+=ma.sep),(0,ma.normalize)(e).startsWith((0,ma.normalize)(t)))}var Ace=H(Ice(),1);var dk=t=>{if(typeof t!="string")throw new TypeError("invalid pattern");if(t.length>65536)throw new TypeError("pattern is too long")};var VMe={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},pk=t=>t.replace(/[[\]\\-]/g,"\\$&"),GMe=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),Cce=t=>t.join(""),Tce=(t,e)=>{let r=e;if(t.charAt(r)!=="[")throw new Error("not in a brace expression");let n=[],o=[],s=r+1,a=!1,c=!1,u=!1,l=!1,d=r,p="";e:for(;s<t.length;){let g=t.charAt(s);if((g==="!"||g==="^")&&s===r+1){l=!0,s++;continue}if(g==="]"&&a&&!u){d=s+1;break}if(a=!0,g==="\\"&&!u){u=!0,s++;continue}if(g==="["&&!u){for(let[v,[y,_,x]]of Object.entries(VMe))if(t.startsWith(v,s)){if(p)return["$.",!1,t.length-r,!0];s+=v.length,x?o.push(y):n.push(y),c=c||_;continue e}}if(u=!1,p){g>p?n.push(pk(p)+"-"+pk(g)):g===p&&n.push(pk(g)),p="",s++;continue}if(t.startsWith("-]",s+1)){n.push(pk(g+"-")),s+=2;continue}if(t.startsWith("-",s+1)){p=g,s+=2;continue}n.push(pk(g)),s++}if(d<s)return["",!1,0,!1];if(!n.length&&!o.length)return["$.",!1,t.length-r,!0];if(o.length===0&&n.length===1&&/^\\?.$/.test(n[0])&&!l){let g=n[0].length===2?n[0].slice(-1):n[0];return[GMe(g),!1,d-r,!1]}let f="["+(l?"^":"")+Cce(n)+"]",m="["+(l?"":"^")+Cce(o)+"]";return[n.length&&o.length?"("+f+"|"+m+")":n.length?f:m,c,d-r,!0]};var pg=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/\[([^\/\\])\]/g,"$1"):t.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var zMe=new Set(["!","?","+","*","@"]),Ece=t=>zMe.has(t),$Me="(?!(?:^|/)\\.\\.?(?:$|/))",_4="(?!\\.)",WMe=new Set(["[","."]),KMe=new Set(["..","."]),YMe=new Set("().*{}+?[]^$\\!"),QMe=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),wH="[^/]",wce=wH+"*?",Rce=wH+"+?",kS=class t{type;#t;#i;#d=!1;#r=[];#c;#a;#m;#s=!1;#n;#e;#p=!1;constructor(e,r,n={}){this.type=e,e&&(this.#i=!0),this.#c=r,this.#t=this.#c?this.#c.#t:this,this.#n=this.#t===this?n:this.#t.#n,this.#m=this.#t===this?[]:this.#t.#m,e==="!"&&!this.#t.#s&&this.#m.push(this),this.#a=this.#c?this.#c.#r.length:0}get hasMagic(){if(this.#i!==void 0)return this.#i;for(let e of this.#r)if(typeof e!="string"&&(e.type||e.hasMagic))return this.#i=!0;return this.#i}toString(){return this.#e!==void 0?this.#e:this.type?this.#e=this.type+"("+this.#r.map(e=>String(e)).join("|")+")":this.#e=this.#r.map(e=>String(e)).join("")}#h(){if(this!==this.#t)throw new Error("should only call on root");if(this.#s)return this;this.toString(),this.#s=!0;let e;for(;e=this.#m.pop();){if(e.type!=="!")continue;let r=e,n=r.#c;for(;n;){for(let o=r.#a+1;!n.type&&o<n.#r.length;o++)for(let s of e.#r){if(typeof s=="string")throw new Error("string part in extglob AST??");s.copyIn(n.#r[o])}r=n,n=r.#c}}return this}push(...e){for(let r of e)if(r!==""){if(typeof r!="string"&&!(r instanceof t&&r.#c===this))throw new Error("invalid part: "+r);this.#r.push(r)}}toJSON(){let e=this.type===null?this.#r.slice().map(r=>typeof r=="string"?r:r.toJSON()):[this.type,...this.#r.map(r=>r.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===this.#t||this.#t.#s&&this.#c?.type==="!")&&e.push({}),e}isStart(){if(this.#t===this)return!0;if(!this.#c?.isStart())return!1;if(this.#a===0)return!0;let e=this.#c;for(let r=0;r<this.#a;r++){let n=e.#r[r];if(!(n instanceof t&&n.type==="!"))return!1}return!0}isEnd(){if(this.#t===this||this.#c?.type==="!")return!0;if(!this.#c?.isEnd())return!1;if(!this.type)return this.#c?.isEnd();let e=this.#c?this.#c.#r.length:0;return this.#a===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){let r=new t(this.type,e);for(let n of this.#r)r.copyIn(n);return r}static#l(e,r,n,o){let s=!1,a=!1,c=-1,u=!1;if(r.type===null){let m=n,h="";for(;m<e.length;){let g=e.charAt(m++);if(s||g==="\\"){s=!s,h+=g;continue}if(a){m===c+1?(g==="^"||g==="!")&&(u=!0):g==="]"&&!(m===c+2&&u)&&(a=!1),h+=g;continue}else if(g==="["){a=!0,c=m,u=!1,h+=g;continue}if(!o.noext&&Ece(g)&&e.charAt(m)==="("){r.push(h),h="";let v=new t(g,r);m=t.#l(e,v,m,o),r.push(v);continue}h+=g}return r.push(h),m}let l=n+1,d=new t(null,r),p=[],f="";for(;l<e.length;){let m=e.charAt(l++);if(s||m==="\\"){s=!s,f+=m;continue}if(a){l===c+1?(m==="^"||m==="!")&&(u=!0):m==="]"&&!(l===c+2&&u)&&(a=!1),f+=m;continue}else if(m==="["){a=!0,c=l,u=!1,f+=m;continue}if(Ece(m)&&e.charAt(l)==="("){d.push(f),f="";let h=new t(m,d);d.push(h),l=t.#l(e,h,l,o);continue}if(m==="|"){d.push(f),f="",p.push(d),d=new t(null,r);continue}if(m===")")return f===""&&r.#r.length===0&&(r.#p=!0),d.push(f),f="",r.push(...p,d),l;f+=m}return r.type=null,r.#i=void 0,r.#r=[e.substring(n-1)],l}static fromGlob(e,r={}){let n=new t(null,void 0,r);return t.#l(e,n,0,r),n}toMMPattern(){if(this!==this.#t)return this.#t.toMMPattern();let e=this.toString(),[r,n,o,s]=this.toRegExpSource();if(!(o||this.#i||this.#n.nocase&&!this.#n.nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return n;let c=(this.#n.nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${r}$`,c),{_src:r,_glob:e})}get options(){return this.#n}toRegExpSource(e){let r=e??!!this.#n.dot;if(this.#t===this&&this.#h(),!this.type){let u=this.isStart()&&this.isEnd(),l=this.#r.map(m=>{let[h,g,v,y]=typeof m=="string"?t.#v(m,this.#i,u):m.toRegExpSource(e);return this.#i=this.#i||v,this.#d=this.#d||y,h}).join(""),d="";if(this.isStart()&&typeof this.#r[0]=="string"&&!(this.#r.length===1&&KMe.has(this.#r[0]))){let h=WMe,g=r&&h.has(l.charAt(0))||l.startsWith("\\.")&&h.has(l.charAt(2))||l.startsWith("\\.\\.")&&h.has(l.charAt(4)),v=!r&&!e&&h.has(l.charAt(0));d=g?$Me:v?_4:""}let p="";return this.isEnd()&&this.#t.#s&&this.#c?.type==="!"&&(p="(?:$|\\/)"),[d+l+p,pg(l),this.#i=!!this.#i,this.#d]}let n=this.type==="*"||this.type==="+",o=this.type==="!"?"(?:(?!(?:":"(?:",s=this.#u(r);if(this.isStart()&&this.isEnd()&&!s&&this.type!=="!"){let u=this.toString();return this.#r=[u],this.type=null,this.#i=void 0,[u,pg(this.toString()),!1,!1]}let a=!n||e||r||!_4?"":this.#u(!0);a===s&&(a=""),a&&(s=`(?:${s})(?:${a})*?`);let c="";if(this.type==="!"&&this.#p)c=(this.isStart()&&!r?_4:"")+Rce;else{let u=this.type==="!"?"))"+(this.isStart()&&!r&&!e?_4:"")+wce+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&a?")":this.type==="*"&&a?")?":`)${this.type}`;c=o+s+u}return[c,pg(s),this.#i=!!this.#i,this.#d]}#u(e){return this.#r.map(r=>{if(typeof r=="string")throw new Error("string type in extglob ast??");let[n,o,s,a]=r.toRegExpSource(e);return this.#d=this.#d||a,n}).filter(r=>!(this.isStart()&&this.isEnd())||!!r).join("|")}static#v(e,r,n=!1){let o=!1,s="",a=!1;for(let c=0;c<e.length;c++){let u=e.charAt(c);if(o){o=!1,s+=(YMe.has(u)?"\\":"")+u;continue}if(u==="\\"){c===e.length-1?s+="\\\\":o=!0;continue}if(u==="["){let[l,d,p,f]=Tce(e,c);if(p){s+=l,a=a||d,c+=p-1,r=r||f;continue}}if(u==="*"){n&&e==="*"?s+=Rce:s+=wce,r=!0;continue}if(u==="?"){s+=wH,r=!0;continue}s+=QMe(u)}return[s,pg(e),!!r,a]}};var RH=(t,{windowsPathsNoEscape:e=!1}={})=>e?t.replace(/[?*()[\]]/g,"[$&]"):t.replace(/[?*()[\]\\]/g,"\\$&");var ds=(t,e,r={})=>(dk(e),!r.nocomment&&e.charAt(0)==="#"?!1:new PS(e,r).match(t)),XMe=/^\*+([^+@!?\*\[\(]*)$/,JMe=t=>e=>!e.startsWith(".")&&e.endsWith(t),ZMe=t=>e=>e.endsWith(t),eFe=t=>(t=t.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(t)),tFe=t=>(t=t.toLowerCase(),e=>e.toLowerCase().endsWith(t)),rFe=/^\*+\.\*+$/,nFe=t=>!t.startsWith(".")&&t.includes("."),iFe=t=>t!=="."&&t!==".."&&t.includes("."),oFe=/^\.\*+$/,sFe=t=>t!=="."&&t!==".."&&t.startsWith("."),aFe=/^\*+$/,cFe=t=>t.length!==0&&!t.startsWith("."),uFe=t=>t.length!==0&&t!=="."&&t!=="..",lFe=/^\?+([^+@!?\*\[\(]*)?$/,dFe=([t,e=""])=>{let r=Dce([t]);return e?(e=e.toLowerCase(),n=>r(n)&&n.toLowerCase().endsWith(e)):r},pFe=([t,e=""])=>{let r=Nce([t]);return e?(e=e.toLowerCase(),n=>r(n)&&n.toLowerCase().endsWith(e)):r},fFe=([t,e=""])=>{let r=Nce([t]);return e?n=>r(n)&&n.endsWith(e):r},mFe=([t,e=""])=>{let r=Dce([t]);return e?n=>r(n)&&n.endsWith(e):r},Dce=([t])=>{let e=t.length;return r=>r.length===e&&!r.startsWith(".")},Nce=([t])=>{let e=t.length;return r=>r.length===e&&r!=="."&&r!==".."},Lce=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",kce={win32:{sep:"\\"},posix:{sep:"/"}},hFe=Lce==="win32"?kce.win32.sep:kce.posix.sep;ds.sep=hFe;var du=Symbol("globstar **");ds.GLOBSTAR=du;var gFe="[^/]",vFe=gFe+"*?",bFe="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",yFe="(?:(?!(?:\\/|^)\\.).)*?",_Fe=(t,e={})=>r=>ds(r,t,e);ds.filter=_Fe;var lu=(t,e={})=>Object.assign({},t,e),xFe=t=>{if(!t||typeof t!="object"||!Object.keys(t).length)return ds;let e=ds;return Object.assign((n,o,s={})=>e(n,o,lu(t,s)),{Minimatch:class extends e.Minimatch{constructor(o,s={}){super(o,lu(t,s))}static defaults(o){return e.defaults(lu(t,o)).Minimatch}},AST:class extends e.AST{constructor(o,s,a={}){super(o,s,lu(t,a))}static fromGlob(o,s={}){return e.AST.fromGlob(o,lu(t,s))}},unescape:(n,o={})=>e.unescape(n,lu(t,o)),escape:(n,o={})=>e.escape(n,lu(t,o)),filter:(n,o={})=>e.filter(n,lu(t,o)),defaults:n=>e.defaults(lu(t,n)),makeRe:(n,o={})=>e.makeRe(n,lu(t,o)),braceExpand:(n,o={})=>e.braceExpand(n,lu(t,o)),match:(n,o,s={})=>e.match(n,o,lu(t,s)),sep:e.sep,GLOBSTAR:du})};ds.defaults=xFe;var Oce=(t,e={})=>(dk(t),e.nobrace||!/\{(?:(?!\{).)*\}/.test(t)?[t]:(0,Ace.default)(t));ds.braceExpand=Oce;var SFe=(t,e={})=>new PS(t,e).makeRe();ds.makeRe=SFe;var IFe=(t,e,r={})=>{let n=new PS(e,r);return t=t.filter(o=>n.match(o)),n.options.nonull&&!t.length&&t.push(e),t};ds.match=IFe;var Pce=/[?*]|[+@!]\(.*?\)|\[|\]/,CFe=t=>t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),PS=class{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(e,r={}){dk(e),r=r||{},this.options=r,this.pattern=e,this.platform=r.platform||Lce,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!r.windowsPathsNoEscape||r.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!r.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!r.nonegate,this.comment=!1,this.empty=!1,this.partial=!!r.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=r.windowsNoMagicRoot!==void 0?r.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let e of this.set)for(let r of e)if(typeof r!="string")return!0;return!1}debug(...e){}make(){let e=this.pattern,r=this.options;if(!r.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],r.debug&&(this.debug=(...s)=>console.error(...s)),this.debug(this.pattern,this.globSet);let n=this.globSet.map(s=>this.slashSplit(s));this.globParts=this.preprocess(n),this.debug(this.pattern,this.globParts);let o=this.globParts.map((s,a,c)=>{if(this.isWindows&&this.windowsNoMagicRoot){let u=s[0]===""&&s[1]===""&&(s[2]==="?"||!Pce.test(s[2]))&&!Pce.test(s[3]),l=/^[a-z]:/i.test(s[0]);if(u)return[...s.slice(0,4),...s.slice(4).map(d=>this.parse(d))];if(l)return[s[0],...s.slice(1).map(d=>this.parse(d))]}return s.map(u=>this.parse(u))});if(this.debug(this.pattern,o),this.set=o.filter(s=>s.indexOf(!1)===-1),this.isWindows)for(let s=0;s<this.set.length;s++){let a=this.set[s];a[0]===""&&a[1]===""&&this.globParts[s][2]==="?"&&typeof a[3]=="string"&&/^[a-z]:$/i.test(a[3])&&(a[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let n=0;n<e.length;n++)for(let o=0;o<e[n].length;o++)e[n][o]==="**"&&(e[n][o]="*");let{optimizationLevel:r=1}=this.options;return r>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):r>=1?e=this.levelOneOptimize(e):e=this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(r=>{let n=-1;for(;(n=r.indexOf("**",n+1))!==-1;){let o=n;for(;r[o+1]==="**";)o++;o!==n&&r.splice(n,o-n)}return r})}levelOneOptimize(e){return e.map(r=>(r=r.reduce((n,o)=>{let s=n[n.length-1];return o==="**"&&s==="**"?n:o===".."&&s&&s!==".."&&s!=="."&&s!=="**"?(n.pop(),n):(n.push(o),n)},[]),r.length===0?[""]:r))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let r=!1;do{if(r=!1,!this.preserveMultipleSlashes){for(let o=1;o<e.length-1;o++){let s=e[o];o===1&&s===""&&e[0]===""||(s==="."||s==="")&&(r=!0,e.splice(o,1),o--)}e[0]==="."&&e.length===2&&(e[1]==="."||e[1]==="")&&(r=!0,e.pop())}let n=0;for(;(n=e.indexOf("..",n+1))!==-1;){let o=e[n-1];o&&o!=="."&&o!==".."&&o!=="**"&&(r=!0,e.splice(n-1,2),n-=2)}}while(r);return e.length===0?[""]:e}firstPhasePreProcess(e){let r=!1;do{r=!1;for(let n of e){let o=-1;for(;(o=n.indexOf("**",o+1))!==-1;){let a=o;for(;n[a+1]==="**";)a++;a>o&&n.splice(o+1,a-o);let c=n[o+1],u=n[o+2],l=n[o+3];if(c!==".."||!u||u==="."||u===".."||!l||l==="."||l==="..")continue;r=!0,n.splice(o,1);let d=n.slice(0);d[o]="**",e.push(d),o--}if(!this.preserveMultipleSlashes){for(let a=1;a<n.length-1;a++){let c=n[a];a===1&&c===""&&n[0]===""||(c==="."||c==="")&&(r=!0,n.splice(a,1),a--)}n[0]==="."&&n.length===2&&(n[1]==="."||n[1]==="")&&(r=!0,n.pop())}let s=0;for(;(s=n.indexOf("..",s+1))!==-1;){let a=n[s-1];if(a&&a!=="."&&a!==".."&&a!=="**"){r=!0;let u=s===1&&n[s+1]==="**"?["."]:[];n.splice(s-1,2,...u),n.length===0&&n.push(""),s-=2}}}}while(r);return e}secondPhasePreProcess(e){for(let r=0;r<e.length-1;r++)for(let n=r+1;n<e.length;n++){let o=this.partsMatch(e[r],e[n],!this.preserveMultipleSlashes);if(o){e[r]=[],e[n]=o;break}}return e.filter(r=>r.length)}partsMatch(e,r,n=!1){let o=0,s=0,a=[],c="";for(;o<e.length&&s<r.length;)if(e[o]===r[s])a.push(c==="b"?r[s]:e[o]),o++,s++;else if(n&&e[o]==="**"&&r[s]===e[o+1])a.push(e[o]),o++;else if(n&&r[s]==="**"&&e[o]===r[s+1])a.push(r[s]),s++;else if(e[o]==="*"&&r[s]&&(this.options.dot||!r[s].startsWith("."))&&r[s]!=="**"){if(c==="b")return!1;c="a",a.push(e[o]),o++,s++}else if(r[s]==="*"&&e[o]&&(this.options.dot||!e[o].startsWith("."))&&e[o]!=="**"){if(c==="a")return!1;c="b",a.push(r[s]),o++,s++}else return!1;return e.length===r.length&&a}parseNegate(){if(this.nonegate)return;let e=this.pattern,r=!1,n=0;for(let o=0;o<e.length&&e.charAt(o)==="!";o++)r=!r,n++;n&&(this.pattern=e.slice(n)),this.negate=r}matchOne(e,r,n=!1){let o=this.options;if(this.isWindows){let g=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),v=!g&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),y=typeof r[0]=="string"&&/^[a-z]:$/i.test(r[0]),_=!y&&r[0]===""&&r[1]===""&&r[2]==="?"&&typeof r[3]=="string"&&/^[a-z]:$/i.test(r[3]),x=v?3:g?0:void 0,S=_?3:y?0:void 0;if(typeof x=="number"&&typeof S=="number"){let[I,E]=[e[x],r[S]];I.toLowerCase()===E.toLowerCase()&&(r[S]=I,S>x?r=r.slice(S):x>S&&(e=e.slice(x)))}}let{optimizationLevel:s=1}=this.options;s>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:r}),this.debug("matchOne",e.length,r.length);for(var a=0,c=0,u=e.length,l=r.length;a<u&&c<l;a++,c++){this.debug("matchOne loop");var d=r[c],p=e[a];if(this.debug(r,d,p),d===!1)return!1;if(d===du){this.debug("GLOBSTAR",[r,d,p]);var f=a,m=c+1;if(m===l){for(this.debug("** at the end");a<u;a++)if(e[a]==="."||e[a]===".."||!o.dot&&e[a].charAt(0)===".")return!1;return!0}for(;f<u;){var h=e[f];if(this.debug(`
globstar while`,e,f,r,m,h),this.matchOne(e.slice(f),r.slice(m),n))return this.debug("globstar found match!",f,u,h),!0;if(h==="."||h===".."||!o.dot&&h.charAt(0)==="."){this.debug("dot detected!",e,f,r,m);break}this.debug("globstar swallow a segment, and continue"),f++}return!!(n&&(this.debug(`
>>> no match, partial?`,e,f,r,m),f===u))}let g;if(typeof d=="string"?(g=p===d,this.debug("string match",d,p,g)):(g=d.test(p),this.debug("pattern match",d,p,g)),!g)return!1}if(a===u&&c===l)return!0;if(a===u)return n;if(c===l)return a===u-1&&e[a]==="";throw new Error("wtf?")}braceExpand(){return Oce(this.pattern,this.options)}parse(e){dk(e);let r=this.options;if(e==="**")return du;if(e==="")return"";let n,o=null;(n=e.match(aFe))?o=r.dot?uFe:cFe:(n=e.match(XMe))?o=(r.nocase?r.dot?tFe:eFe:r.dot?ZMe:JMe)(n[1]):(n=e.match(lFe))?o=(r.nocase?r.dot?pFe:dFe:r.dot?fFe:mFe)(n):(n=e.match(rFe))?o=r.dot?iFe:nFe:(n=e.match(oFe))&&(o=sFe);let s=kS.fromGlob(e,this.options).toMMPattern();return o&&typeof s=="object"&&Reflect.defineProperty(s,"test",{value:o}),s}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let r=this.options,n=r.noglobstar?vFe:r.dot?bFe:yFe,o=new Set(r.nocase?["i"]:[]),s=e.map(u=>{let l=u.map(d=>{if(d instanceof RegExp)for(let p of d.flags.split(""))o.add(p);return typeof d=="string"?CFe(d):d===du?du:d._src});return l.forEach((d,p)=>{let f=l[p+1],m=l[p-1];d!==du||m===du||(m===void 0?f!==void 0&&f!==du?l[p+1]="(?:\\/|"+n+"\\/)?"+f:l[p]=n:f===void 0?l[p-1]=m+"(?:\\/|"+n+")?":f!==du&&(l[p-1]=m+"(?:\\/|\\/"+n+"\\/)"+f,l[p+1]=du))}),l.filter(d=>d!==du).join("/")}).join("|"),[a,c]=e.length>1?["(?:",")"]:["",""];s="^"+a+s+c+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...o].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,r=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&r)return!0;let n=this.options;this.isWindows&&(e=e.split("\\").join("/"));let o=this.slashSplit(e);this.debug(this.pattern,"split",o);let s=this.set;this.debug(this.pattern,"set",s);let a=o[o.length-1];if(!a)for(let c=o.length-2;!a&&c>=0;c--)a=o[c];for(let c=0;c<s.length;c++){let u=s[c],l=o;if(n.matchBase&&u.length===1&&(l=[a]),this.matchOne(l,u,r))return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate}static defaults(e){return ds.defaults(e).Minimatch}};ds.AST=kS;ds.Minimatch=PS;ds.escape=RH;ds.unescape=pg;async function Pl(t){if(!t)return;let e=await crypto.subtle.importKey("raw",new TextEncoder().encode(t),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),r=Math.floor(Date.now()/1e3).toString(),o=new TextEncoder().encode(r),s=await crypto.subtle.sign("HMAC",e,o),c=Array.from(new Uint8Array(s)).map(u=>u.toString(16).padStart(2,"0")).join("");return`${r}.${c}`}async function AS(t){let e=typeof t=="string"?new TextEncoder().encode(t):t,r=await crypto.subtle.digest("SHA-256",e),n=new Uint8Array(r),o="";for(let s of n)o+=s.toString(16).padStart(2,"0");return o}var Mce="non-git-file",x4=class{constructor(e,r,n,o,s,a,c){this._gitService=e;this._logService=r;this._fetcherService=n;this._authService=o;this._domainService=s;this._fileSystemService=a;this._workspaceService=c;this._contentExclusionCache=new Map;this._contentExclusionFetchPromise=null;this._ignoreGlobResultCache=new tn;this._ignoreRegexResultCache=new Map;this._lastRuleFetch=0;this._disposables=[];this._contentExclusionCache.set(Mce,{patterns:[],ifAnyMatch:[],ifNoneMatch:[],repoRootPath:""}),this._disposables.push(this._gitService.onDidCloseRepository(u=>{let l=this.getRepositoryInfo(u);if(l)for(let d of l.fetchUrls)this._contentExclusionCache.delete(d)}))}async isIgnored(e){if(this._ignoreGlobResultCache.has(e)&&!this.isRegexContextExclusionsEnabled||this._ignoreGlobResultCache.get(e))return this._ignoreGlobResultCache.get(e)??!1;this._contentExclusionFetchPromise&&await this._contentExclusionFetchPromise;let r=this._gitService.getRepository(e)??await this._gitService.openRepository(e),n=this.getRepositoryInfo(r);Date.now()-this._lastRuleFetch>30*60*1e3&&await this.makeContentExclusionRequest(),n||(n={repoRootPath:"",fetchUrls:[Mce]});let o=e.path.replace(n.repoRootPath,"");this.shouldFetchContentExclusionRules(n)&&await this.makeContentExclusionRequest();for(let{patterns:c}of this._contentExclusionCache.values())for(let u of c)if(ds(o,u,{nocase:!0,matchBase:!0,nonegate:!0,dot:!0}))return this._logService.public.debug(`File ${e.path} is ignored by content exclusion rule ${u}`),this._ignoreGlobResultCache.set(e,!0),!0;let s="",a="";for(let c of n.fetchUrls){let{ifAnyMatch:u,ifNoneMatch:l}=this._contentExclusionCache.get(c)??{ifAnyMatch:[],ifNoneMatch:[]};if((u.length>0||l.length>0)&&!s)try{if(s=await Fae(this._fileSystemService,this._workspaceService,e),a=await AS(s),this._ignoreRegexResultCache.has(a))return this._ignoreRegexResultCache.get(a)??!1}catch{return!0}if(u.length>0&&s&&u.some(d=>d.test(s)))return this._logService.public.debug(`File ${e.path} is ignored by content exclusion rule ifAnyMatch`),this._ignoreRegexResultCache.set(a,!0),!0;if(l.length>0&&s&&!l.some(d=>d.test(s)))return this._logService.public.debug(`File ${e.path} is ignored by content exclusion rule ifNoneMatch`),this._ignoreRegexResultCache.set(a,!0),!0}return this._ignoreGlobResultCache.set(e,!1),this._ignoreRegexResultCache.set(a,!1),!1}get isRegexContextExclusionsEnabled(){return[...this._contentExclusionCache.values()].some(({ifAnyMatch:e,ifNoneMatch:r})=>e.length>0||r.length>0)}async loadRepos(e){(await Promise.all(e.map(o=>this._gitService.openRepository(o)))).map(o=>this.shouldFetchContentExclusionRules(this.getRepositoryInfo(o))).some(o=>o)&&await this.makeContentExclusionRequest()}async asMinimatchPatterns(){return await this._contentExclusionFetchPromise,Array.from(this._contentExclusionCache.values()).flatMap(({patterns:r})=>r)}dispose(){this._disposables.forEach(e=>e.dispose()),this._disposables=[],this._contentExclusionCache.clear()}shouldFetchContentExclusionRules(e){if(!e)return!1;let r=!1;for(let n of e?.fetchUrls??[])this._contentExclusionCache.has(n)||(r=!0,this._contentExclusionCache.set(n,{patterns:[],ifAnyMatch:[],ifNoneMatch:[],repoRootPath:e.repoRootPath}));return r}async makeContentExclusionRequest(){this._contentExclusionFetchPromise&&await this._contentExclusionFetchPromise;try{this._contentExclusionFetchPromise=this._contentExclusionRequest(),await this._contentExclusionFetchPromise}catch{this._contentExclusionFetchPromise=null}}async _contentExclusionRequest(){this._ignoreGlobResultCache.clear();let e=Date.now(),r=this._fetcherService,n=(await this._authService.getAnyGitHubSession({silent:!0}))?.accessToken,o=Array.from(this._contentExclusionCache.keys()),s=async a=>{let c=a.join(","),u=new URL(this._domainService.contentExclusionURL);a.length!==0&&u.searchParams.set("repos",c),u.searchParams.set("scope","repo");let l=await r.fetch(u.toString(),{headers:{Authorization:`token ${n}`}});if(!l.ok){this._logService.public.error(`Failed to fetch content exclusion rules: ${l?.statusText}`);return}let d=await l.json();for(let p=0;p<d.length;p++){let f=d[p].rules.map(_=>_.paths).flat(),m=Nr(d[p].rules.map(_=>_.ifAnyMatch).flat()).map(_=>Fce(_)),h=Nr(d[p].rules.map(_=>_.ifNoneMatch).flat()).map(_=>Fce(_)),g=a[p],v=this._contentExclusionCache.get(g)?.repoRootPath;if(v===void 0){this._logService.public.error(`Failed to find repo root for ${g}, skipping exclusion rules`);continue}let y={patterns:TFe(f,v),ifAnyMatch:m,ifNoneMatch:h,repoRootPath:v};this._contentExclusionCache.set(g,y),this._logService.public.trace(`Fetched content exclusion rules for ${g}: ${JSON.stringify(y)}`)}};o.length===0&&await s([]);for(let a=0;a<o.length;a+=10){let c=o.slice(a,a+10);await s(c)}this._lastRuleFetch=Date.now(),this._logService.public.info(`Fetched content exclusion rules in ${Date.now()-e}ms`),this._contentExclusionFetchPromise=null}getRepositoryInfo(e){if(!e||!e.remoteFetchUrls)return;let r=Nr(e.remoteFetchUrls.map(n=>{if(n)try{return Xae(n)}catch{return}}));return{repoRootPath:e.rootUri.path,fetchUrls:r}}};function TFe(t,e){return t.map(r=>r.startsWith("/")?`${e}${r}`:r)}function Fce(t){if(!t.startsWith("/")&&!t.endsWith("/"))return new RegExp(t);let e=t.slice(1,t.lastIndexOf("/")),r=t.slice(t.lastIndexOf("/")+1);return new RegExp(e,r)}var S4=".copilotignore";var I4=class{constructor(e,r,n,o,s,a,c,u){this._gitService=e;this._logService=r;this._fetcherService=n;this._authService=o;this._workspaceService=s;this._domainService=a;this.searchService=c;this.fs=u;this._copilotIgnoreFiles=new y4;this._copilotIgnoreEnabled=!1;this._onDidChangeCopilotIgnoreEnablement=new Yt;this._disposables=[];this.onDidChangeCopilotIgnoreEnablement=this._onDidChangeCopilotIgnoreEnablement.event;this._filesIgnoredThisSession={"Remote Content Exclusions":new Set,"Copilot Ignore File":new Set},this._disposables.push(this._onDidChangeCopilotIgnoreEnablement),this._disposables.push(this._authService.onDidAuthenticationChange(()=>{let l=this._authService.copilotToken?.isCopilotIgnoreEnabled()??!1;this._copilotIgnoreEnabled!==l&&this._onDidChangeCopilotIgnoreEnablement.fire(l),this._copilotIgnoreEnabled=l,this._copilotIgnoreEnabled===!1&&this._remoteContentExclusions&&(this._remoteContentExclusions.dispose(),this._remoteContentExclusions=void 0),this._copilotIgnoreEnabled===!0&&!this._remoteContentExclusions&&(this._remoteContentExclusions=new x4(this._gitService,this._logService,this._fetcherService,this._authService,this._domainService,this.fs,this._workspaceService))}))}dispose(){this._disposables.forEach(e=>e.dispose()),this._remoteContentExclusions&&(this._remoteContentExclusions.dispose(),this._remoteContentExclusions=void 0),this._disposables=[]}get isEnabled(){return this._copilotIgnoreEnabled}get isRegexExclusionsEnabled(){return this._remoteContentExclusions?.isRegexContextExclusionsEnabled??!1}async isCopilotIgnored(e){let r=!1;if(this._copilotIgnoreEnabled){let n=this._copilotIgnoreFiles.isIgnored(e);r=n||await(this._remoteContentExclusions?.isIgnored(e)??!1),r&&(n?this._filesIgnoredThisSession["Copilot Ignore File"].add(e.toString()):this._filesIgnoredThisSession["Remote Content Exclusions"].add(e.toString()))}return r}async asMinimatchPattern(){if(!this._copilotIgnoreEnabled)return;let e=[],r=(await this.searchService.findFiles("**/.git/HEAD",{useDefaultExcludes:!1,useDefaultSearchExcludes:!1})).map(o=>Ye.joinPath(o,"..",".."));await this._remoteContentExclusions?.loadRepos(r),e.push(await this._remoteContentExclusions?.asMinimatchPatterns()??[]),e.push(this._copilotIgnoreFiles.asMinimatchPatterns());let n=e.flat();if(n.length!==0)return n.length===1?n[0]:`{${n.join(",")}}`}init(){return this._init??=(async()=>{for(let e of this._workspaceService.getWorkspaceFolders())await this.addWorkspace(e)})(),this._init}async sessionInfo(){let e=`# Content Exclusion Session Info

`;for(let n in this._filesIgnoredThisSession){let o=this._filesIgnoredThisSession[n];o.size>0&&(e+=`## Files ignored this session from ${n}:

${Array.from(o).join(`
`)}`,e+=`

`)}let r=await this.asMinimatchPattern();return r&&(e+=`## Exclude glob used during search:
`+r),e}trackIgnoreFile(e,r,n){r.path.endsWith(S4)&&this._copilotIgnoreFiles.setIgnoreFile(e,r,n)}removeIgnoreFile(e){e.path.endsWith(S4)&&this._copilotIgnoreFiles.removeIgnoreFile(e)}removeWorkspace(e){this._copilotIgnoreFiles.removeWorkspace(e)}isIgnoreFile(e){return!!e.path.endsWith(S4)}async addWorkspace(e){if(e.scheme!=="file")return;let r=await this.searchService.findFilesWithDefaultExcludes(new RS(e,`${S4}`),void 0,Lr.None);for(let n of r){let o=(await this.fs.readFile(n)).toString();this.trackIgnoreFile(e,n,o)}}};var C4=class{constructor(e){this.contentProvider=e}async provideTextDocumentContent(e,r){return this.contentProvider()}};var Uce="copilot-ignore",Zb=class extends I4{constructor(e,r,n,o,s,a,c){super(e,n,o,s,a,c,new wS,new TS),this.installListeners(),this._disposables.push(zo.workspace.registerTextDocumentContentProvider(Uce,new C4(this.sessionInfo.bind(this))))}installListeners(){this._disposables.push(zo.workspace.onDidChangeWorkspaceFolders(e=>{for(let r of e.removed)this.removeWorkspace(r.uri);for(let r of e.added)this.addWorkspace(r.uri)})),this._disposables.push(zo.workspace.onDidSaveTextDocument(async e=>{if(this.isIgnoreFile(e.uri)){let r=(await zo.workspace.fs.readFile(e.uri)).toString(),n=zo.workspace.getWorkspaceFolder(e.uri);this.trackIgnoreFile(n?.uri,e.uri,r)}}),zo.workspace.onDidDeleteFiles(e=>{for(let r of e.files)this.removeIgnoreFile(r)}),zo.workspace.onDidRenameFiles(async e=>{for(let r of e.files)if(this.isIgnoreFile(r.newUri)){let n=(await zo.workspace.fs.readFile(r.newUri)).toString();this.removeIgnoreFile(r.oldUri);let o=zo.workspace.getWorkspaceFolder(r.newUri);this.trackIgnoreFile(o?.uri,r.newUri,n)}})),this._disposables.push(this.onDidChangeCopilotIgnoreEnablement(e=>{zo.commands.executeCommand("setContext","github.copilot.copilotIgnoreEnabled",e)}))}async dispalyContentExclusionSessionInfo(){let e=Ye.from({scheme:Uce,authority:_r(),path:"/Content Exclusion Session Info"}),r=await zo.workspace.openTextDocument(e);await zo.languages.setTextDocumentLanguage(r,"markdown"),await zo.window.showTextDocument(r)}};Zb=w([b(0,xo),b(1,_o),b(2,oe),b(3,nn),b(4,Nt),b(5,Ve),b(6,Xr)],Zb);function Bce(t){let e=t.get(ke);return e instanceof Zb?zo.commands.registerCommand("github.copilot.debug.contentExclusions",e.dispalyContentExclusionSessionInfo.bind(e)):{dispose:()=>{}}}var Yde=H(require("path")),It=H(require("vscode"));var So=ie("IReviewService");var zt=ie("ITabsAndEditorsService");var Al=class t{constructor(e){this._push=e}static spy(e,r){return new t(n=>{r(n),e.push(n)})}markdown(e){this._push(new ls(e))}anchor(e,r){this._push(new Sae(e,r))}button(e){this._push(new tk(e))}filetree(e,r){this._push(new og(e,r))}progress(e,r){typeof r>"u"?this._push(new ui(e)):this._push(new Iae(e,r))}reference(e,r){this._push(new r4(e,r))}reference2(e,r,n){this._push(new n4(e,r,n))}codeCitation(e,r,n){this._push(new Cae(e,r,n))}push(e){this._push(e)}textEdit(e,r){this._push(new Uf(e,r))}markdownWithVulnerabilities(e,r){this._push(new wae(e,r))}detectedParticipant(e,r){this._push(new kae(e,r))}confirmation(e,r,n){this._push(new Rae(e,r,n))}warning(e){this._push(new Tae(e))}};var kH="github.copilot-dynamic.platform",DS={workspace:{explain:"explain",review:"review",tests:"tests",fix:"fix",new:"new",newNotebook:"newNotebook",semanticSearch:"semanticSearch",fixTestFailure:"fixTestFailure"},vscode:{search:"search",runCommand:"runCommand",startDebugging:"startDebugging"},terminal:{explain:"terminalExplain"}};function T4(t){if(Object.keys(DS).includes(t))return{agent:t};for(let[e,r]of Object.entries(DS))if(Object.values(r).includes(t))return{agent:e,command:t}}var Ud="GitHub.copilot-chat";var Jue=H(require("path"));var tr=class t{constructor(e,r){this.lineNumber=e,this.column=r}with(e=this.lineNumber,r=this.column){return e===this.lineNumber&&r===this.column?this:new t(e,r)}delta(e=0,r=0){return this.with(this.lineNumber+e,this.column+r)}equals(e){return t.equals(this,e)}static equals(e,r){return!e&&!r?!0:!!e&&!!r&&e.lineNumber===r.lineNumber&&e.column===r.column}isBefore(e){return t.isBefore(this,e)}static isBefore(e,r){return e.lineNumber<r.lineNumber?!0:r.lineNumber<e.lineNumber?!1:e.column<r.column}isBeforeOrEqual(e){return t.isBeforeOrEqual(this,e)}static isBeforeOrEqual(e,r){return e.lineNumber<r.lineNumber?!0:r.lineNumber<e.lineNumber?!1:e.column<=r.column}static compare(e,r){let n=e.lineNumber|0,o=r.lineNumber|0;if(n===o){let s=e.column|0,a=r.column|0;return s-a}return n-o}clone(){return new t(this.lineNumber,this.column)}toString(){return"("+this.lineNumber+","+this.column+")"}static lift(e){return new t(e.lineNumber,e.column)}static isIPosition(e){return e&&typeof e.lineNumber=="number"&&typeof e.column=="number"}toJSON(){return{lineNumber:this.lineNumber,column:this.column}}};var Xe=class t{constructor(e,r,n,o){e>n||e===n&&r>o?(this.startLineNumber=n,this.startColumn=o,this.endLineNumber=e,this.endColumn=r):(this.startLineNumber=e,this.startColumn=r,this.endLineNumber=n,this.endColumn=o)}isEmpty(){return t.isEmpty(this)}static isEmpty(e){return e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn}containsPosition(e){return t.containsPosition(this,e)}static containsPosition(e,r){return!(r.lineNumber<e.startLineNumber||r.lineNumber>e.endLineNumber||r.lineNumber===e.startLineNumber&&r.column<e.startColumn||r.lineNumber===e.endLineNumber&&r.column>e.endColumn)}static strictContainsPosition(e,r){return!(r.lineNumber<e.startLineNumber||r.lineNumber>e.endLineNumber||r.lineNumber===e.startLineNumber&&r.column<=e.startColumn||r.lineNumber===e.endLineNumber&&r.column>=e.endColumn)}containsRange(e){return t.containsRange(this,e)}static containsRange(e,r){return!(r.startLineNumber<e.startLineNumber||r.endLineNumber<e.startLineNumber||r.startLineNumber>e.endLineNumber||r.endLineNumber>e.endLineNumber||r.startLineNumber===e.startLineNumber&&r.startColumn<e.startColumn||r.endLineNumber===e.endLineNumber&&r.endColumn>e.endColumn)}strictContainsRange(e){return t.strictContainsRange(this,e)}static strictContainsRange(e,r){return!(r.startLineNumber<e.startLineNumber||r.endLineNumber<e.startLineNumber||r.startLineNumber>e.endLineNumber||r.endLineNumber>e.endLineNumber||r.startLineNumber===e.startLineNumber&&r.startColumn<=e.startColumn||r.endLineNumber===e.endLineNumber&&r.endColumn>=e.endColumn)}plusRange(e){return t.plusRange(this,e)}static plusRange(e,r){let n,o,s,a;return r.startLineNumber<e.startLineNumber?(n=r.startLineNumber,o=r.startColumn):r.startLineNumber===e.startLineNumber?(n=r.startLineNumber,o=Math.min(r.startColumn,e.startColumn)):(n=e.startLineNumber,o=e.startColumn),r.endLineNumber>e.endLineNumber?(s=r.endLineNumber,a=r.endColumn):r.endLineNumber===e.endLineNumber?(s=r.endLineNumber,a=Math.max(r.endColumn,e.endColumn)):(s=e.endLineNumber,a=e.endColumn),new t(n,o,s,a)}intersectRanges(e){return t.intersectRanges(this,e)}static intersectRanges(e,r){let n=e.startLineNumber,o=e.startColumn,s=e.endLineNumber,a=e.endColumn,c=r.startLineNumber,u=r.startColumn,l=r.endLineNumber,d=r.endColumn;return n<c?(n=c,o=u):n===c&&(o=Math.max(o,u)),s>l?(s=l,a=d):s===l&&(a=Math.min(a,d)),n>s||n===s&&o>a?null:new t(n,o,s,a)}equalsRange(e){return t.equalsRange(this,e)}static equalsRange(e,r){return!e&&!r?!0:!!e&&!!r&&e.startLineNumber===r.startLineNumber&&e.startColumn===r.startColumn&&e.endLineNumber===r.endLineNumber&&e.endColumn===r.endColumn}getEndPosition(){return t.getEndPosition(this)}static getEndPosition(e){return new tr(e.endLineNumber,e.endColumn)}getStartPosition(){return t.getStartPosition(this)}static getStartPosition(e){return new tr(e.startLineNumber,e.startColumn)}toString(){return"["+this.startLineNumber+","+this.startColumn+" -> "+this.endLineNumber+","+this.endColumn+"]"}setEndPosition(e,r){return new t(this.startLineNumber,this.startColumn,e,r)}setStartPosition(e,r){return new t(e,r,this.endLineNumber,this.endColumn)}collapseToStart(){return t.collapseToStart(this)}static collapseToStart(e){return new t(e.startLineNumber,e.startColumn,e.startLineNumber,e.startColumn)}collapseToEnd(){return t.collapseToEnd(this)}static collapseToEnd(e){return new t(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn)}delta(e){return new t(this.startLineNumber+e,this.startColumn,this.endLineNumber+e,this.endColumn)}static fromPositions(e,r=e){return new t(e.lineNumber,e.column,r.lineNumber,r.column)}static lift(e){return e?new t(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn):null}static isIRange(e){return e&&typeof e.startLineNumber=="number"&&typeof e.startColumn=="number"&&typeof e.endLineNumber=="number"&&typeof e.endColumn=="number"}static areIntersectingOrTouching(e,r){return!(e.endLineNumber<r.startLineNumber||e.endLineNumber===r.startLineNumber&&e.endColumn<r.startColumn||r.endLineNumber<e.startLineNumber||r.endLineNumber===e.startLineNumber&&r.endColumn<e.startColumn)}static areIntersecting(e,r){return!(e.endLineNumber<r.startLineNumber||e.endLineNumber===r.startLineNumber&&e.endColumn<=r.startColumn||r.endLineNumber<e.startLineNumber||r.endLineNumber===e.startLineNumber&&r.endColumn<=e.startColumn)}static compareRangesUsingStarts(e,r){if(e&&r){let s=e.startLineNumber|0,a=r.startLineNumber|0;if(s===a){let c=e.startColumn|0,u=r.startColumn|0;if(c===u){let l=e.endLineNumber|0,d=r.endLineNumber|0;if(l===d){let p=e.endColumn|0,f=r.endColumn|0;return p-f}return l-d}return c-u}return s-a}return(e?1:0)-(r?1:0)}static compareRangesUsingEnds(e,r){return e.endLineNumber===r.endLineNumber?e.endColumn===r.endColumn?e.startLineNumber===r.startLineNumber?e.startColumn-r.startColumn:e.startLineNumber-r.startLineNumber:e.endColumn-r.endColumn:e.endLineNumber-r.endLineNumber}static spansMultipleLines(e){return e.endLineNumber>e.startLineNumber}toJSON(){return this}};function Dc(t,e,r){if(t===0)return{text:e,range:r};let n=typeof t=="number"?{0:e.slice(0,t),index:t}:e.match(t);if(!n)return{text:e,range:r};let o=n[0],s=eS(o,`
`);return{text:e.slice(o.length),range:{startLineNumber:r.startLineNumber+s,startColumn:s>0?o.length-(o.lastIndexOf(`
`)+1):r.startColumn+o.length,endColumn:r.endColumn,endLineNumber:r.endLineNumber}}}function pu(t,e,r){if(t===0)return{text:e,range:r};let n=typeof t=="number"?{0:e.slice(-t),index:e.length-t}:e.match(t);if(!n)return{text:e,range:r};let o=n[0],s=eS(o,`
`),a=r.endLineNumber-s;return{text:e.slice(0,n.index),range:{startColumn:r.startColumn,startLineNumber:r.startLineNumber,endLineNumber:a,endColumn:s>0?(a===r.startLineNumber?r.startColumn:0)+n.index-(e.lastIndexOf(`
`,n.index-1)+1):Math.max(0,r.endColumn-o.length)}}}function qce(t){let e=t.lastIndexOf(`
`);return e===-1?{lineNumber:0,column:t.length}:{lineNumber:eS(t.slice(0,e),`
`)+1,column:t.length-(e+1)}}function jce(t,e,r,n){let o=r?EFe(r,t,e):{text:t,range:e};return n?wFe(n,o.text,o.range):o}function EFe(t,e,r){let n=Xe.lift(r),o=tr.lift(t);if(o.equals(n.getStartPosition()))return{text:e,range:r};if(o.isBefore(n.getStartPosition()))return{text:e,range:r};let s=0;if(o.lineNumber===n.getStartPosition().lineNumber)s=o.column-n.getStartPosition().column;else{let a=e.split(`
`);for(let[c,u]of a.entries())if(n.getStartPosition().lineNumber+c===o.lineNumber){s+=o.column;break}else s+=u.length+1}return{text:e.substring(s),range:{startLineNumber:o.lineNumber,startColumn:o.column,endColumn:r.endColumn,endLineNumber:r.endLineNumber}}}function wFe(t,e,r){let n=Xe.lift(r),o=tr.lift(t);if(o.equals(n.getEndPosition()))return{text:e,range:r};if(n.getEndPosition().isBefore(o))return{text:e,range:r};let s="";if(o.lineNumber===n.getStartPosition().lineNumber)s=e.substring(0,o.column-n.getStartPosition().column);else{let a=e.split(`
`),c=[];for(let[u,l]of a.entries())if(n.getStartPosition().lineNumber+u===o.lineNumber){c.push(l.substring(0,o.column));break}else c.push(l+`
`);s=c.join("")}return{text:s,range:{startLineNumber:r.startLineNumber,startColumn:r.startColumn,endColumn:o.column,endLineNumber:o.lineNumber}}}function fg(t,e=0,r=0){let n=t.row+e,o=t.column+r;return{lineNumber:n<0?0:n,column:o<0?0:o}}function no(t){return{startLineNumber:t.range.startPosition.row,startColumn:t.range.startPosition.column,endLineNumber:t.range.endPosition.row,endColumn:t.range.endPosition.column}}var ey=/\s+$/;function Hce(t){return t.replace(ey,"")}function fu(t,e){return{startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:e.lineNumber,endColumn:e.column}}function Vce(t,e,r){if(t===0)return{text:e,sources:r};let n=typeof t=="number"?{0:e.slice(-t),index:e.length-t}:e.match(t);if(!n)return{text:e,sources:r};let o=n.index;return{text:e.slice(0,o),sources:r.filter(s=>s.start<o).map(s=>({start:s.start,end:Math.min(s.end,o),range:pu(Math.max(0,s.end-o),e.slice(0,s.end),s.range).range}))}}var E4=class{constructor(e){this.tokenizer=e.acquireTokenizer({family:"gpt4"})}canSpiralChunk(e,r,n,o){let s=Math.max(e.startLineNumber-r,0),a=e.endLineNumber-r;if(n.length<s)return!1;let c=n.slice(s,a);return this.tokenizer.tokenLength(c.map(l=>l.text).join(`
`))<=o}processLinesIntoChunkUsingSprial(e,r,n,o,s,a,c=0,u=!1,l){let d=o-c-(u?0:c),p=0,f=e.split(`
`),m=[];for(let U=0;U<f.length;U++){let F=f[U],$=p;if(p+=F.length+1,a&&F.length===0)continue;let ce=F.slice(0,o*4);m.push({text:ce,lineNumber:U+r,originalStart:$,originalEnd:$+ce.length,tokens:this.tokenizer.tokenLength(ce)})}if(l&&l.endLineNumber<r)return;let h=l?Math.max(l.startLineNumber-r,0):0,g=Math.min(l?l.endLineNumber+1-r:m.length,m.length),v=this.tokenizer.tokenLength(m.map(U=>U.text).slice(h,g).join(`
`)),y=()=>{if(h<=0)return;let U=m[h-1];return{index:h-1,line:U,isBefore:!0}},_=()=>{if(g>=m.length-1)return;let U=m[g+1];return{index:g+1,line:U,isBefore:!1}},x=!0,S=()=>{let U;if(x){if(U=y(),!U)return _()}else if(U=_(),!U)return y();return g===m.length?x=!0:h<=0?x=!1:x=!x,U},I=S();if(I&&I.line.tokens+v<d)for(h=I.isBefore?I.index:h,g=I.isBefore?g:I.index,I=S();I;){let U=I.isBefore?I.index:h,F=I.isBefore?g:I.index,$=m.map(Y=>Y.text).slice(U,F).join(`
`);if(this.tokenizer.tokenLength($)>d)break;h=U,g=F,I=S()}let E=m.slice(h,g),R=E[E.length-1];if(E.length===0)return;for(;E.length;){let U=E[E.length-1],F=U.text.trimEnd();if(F==="")E.pop();else if(F!==U.text){U.text=F,U.originalEnd=F.length;break}else break}if(E.length===0)return;let B=[];n.sort((U,F)=>U.start-F.start);let V=0,M=0,le=0,ne=E[0]?.originalStart||0,q=(U,F)=>{if(M===U){M=F;return}for(;V<n.length&&n[V].start<M;){let $=n[V++];if($.end<ne)continue;let ce=Math.max(0,$.end-M),Y=Math.max(0,ne-$.start),j=pu(ce,e.slice($.start,$.end),$.range),xe=Dc(Y,j.text,j.range);B.push({start:$.start+Y-le,end:$.end-ce-le,range:xe.range})}M=F,ne=U},P="";for(let U=0;U<E.length;U++){let F=E[U];q(F.originalStart,F.originalEnd),P+=F.text,le=F.originalEnd-P.length,U<E.length-1&&(P+=`
`,e[F.originalEnd]===`
`&&q(F.originalEnd,F.originalEnd+1))}return q(1/0,1/0),{text:P,range:{startLineNumber:E[0].lineNumber,startColumn:0,endLineNumber:R.lineNumber,endColumn:R.text.length},sources:B}}};var RFe=!1,mk=t=>{let e=no(t);return{sources:[{start:0,end:t.text.length,range:e}],text:t.text,range:e}},Bd=class{constructor(e){this.tokenizer=e.acquireTokenizer({family:"gpt4"}),this.spiralChunker=RFe?new E4(e):void 0}genericWholeFileChunking(e,{maxTokenLength:r=w4,removeEmptyLines:n=!0,rangeLimit:o=void 0,rangeLimitStrategy:s=void 0}){e=e.replace(/\r\n/g,`
`);let a=e,c=qce(e),u={startLineNumber:0,startColumn:0,endLineNumber:c.lineNumber,endColumn:c.column};if(o&&s!==1){let d=gk(Xe.lift(o),e,Xe.lift(u));a=d.newTextRange.text,u=d.newTextRange.range}let l=this._processLinesIntoChunks(a,u.startLineNumber,[{start:u.startLineNumber,end:e.length,range:u}],r,!0,n);return o&&s===1&&Gce(l,Xe.lift(o)),l.filter(d=>!n||d.text.length&&/[\w\d]{2}/.test(d.text))}genericChunking({lineRangeText:e,maxTokenLength:r=w4,removeEmptyLines:n=!0,extraLineRangeSeparator:o="",numTokensInEllipsis:s=0,removeChunksOutsideOfRange:a=void 0}){if(r<0)throw Error("Cannot chunk text, not enough chunk room");if(e.length===0)return[];let c=this.tokenizer.tokenLength(o),u=[],l,d=!1;for(let p=0;p<e.length;p++){let f=e[p];if(l){let h=r-this.tokenizer.tokenLength(l.text)-c;if(h>0&&f.text.length<2e4&&this.tokenizer.tokenLength(f.text)<=h){let g=o||(d?`
`:""),v=l.text.length+g.length,y=l.text+g+f.text,_={startLineNumber:l.range.startLineNumber,startColumn:l.range.startColumn,endColumn:f.range.endColumn,endLineNumber:f.range.endLineNumber},x=f.sources.map(S=>({start:S.start+v,end:S.end+v,range:S.range}));for(let S of l.sources)x.push(S);d=!1,l={sources:x,text:y,range:_};continue}(!a||Xe.lift(a).intersectRanges(l.range))&&u.push(l),l=void 0}if(a&&a.endLineNumber<f.range.startLineNumber)break;let m=this._processLinesIntoChunks(f.text,f.range.startLineNumber,f.sources,r,!1,n,s,p===0,a?Xe.areIntersecting(a,f.range):void 0,a);l=m.pop(),d=!0,a&&Gce(m,a),u.push(...m)}return l&&(!a||Xe.lift(a).intersectRanges(l.range))&&u.push(l),u.filter(p=>!n||p.text.length&&/[^\s]/.test(p.text)).map(p=>{let{text:f,sources:m}=Vce(ey,p.text,p.sources);return{range:p.range,text:f,sources:m}})}_processLinesIntoChunks(e,r,n,o,s,a,c=0,u=!1,l=!1,d){let p=0,f=0,m=e.split(`
`),h=[];for(let v=0;v<m.length;v++){let y=m[v],_=f;if(f+=y.length+1,a&&y.length===0)continue;let x=y.slice(0,o*4);h.push({text:x,lineNumber:v+r,originalStart:_,originalEnd:_+x.length,tokens:this.tokenizer.tokenLength(x)})}let g=[];if(this.spiralChunker&&l&&d&&this.spiralChunker.canSpiralChunk(d,r,h,o)){let v=this.spiralChunker.processLinesIntoChunkUsingSprial(e,r,n,o,s,a,c,u,d);if(v)return g.push(v),g}for(;p<h.length;){let v=o-c-(u?0:c),y=p+1,_="";for(let q=h[p].tokens;y<h.length;y++){let P=q+h[y].tokens;if(P>v){_=h.slice(p,y+1).map(U=>U.text).join(`
`);let k=this.tokenizer.tokenLength(_);for(;k<=v&&y<h.length-1;)y++,_+=`
`+h[y].text,k=this.tokenizer.tokenLength(_);break}q=P}let x=h.slice(p,y),S=y;if(s){let{chunks:q,usedFromRemaining:P}=this._dedentAndAddLinesToChunk(x,h.slice(y),v);x=q,p=S+P}else for(p=S;p<h.length&&h[p].text.length===0;)p++;if(x.length===0)continue;for(;x.length;){let q=x[x.length-1],P=q.text.trimEnd();if(P==="")x.pop();else if(P!==q.text){q.text=P,q.originalEnd=P.length;break}else break}if(x.length===0)continue;let I=[];n.sort((q,P)=>q.start-P.start);let E=0,R=0,B=0,V=x[0]?.originalStart||0,M=(q,P)=>{if(R===q){R=P;return}for(;E<n.length&&n[E].start<R;){let k=n[E++];if(k.end<V)continue;let U=Math.max(0,k.end-R),F=Math.max(0,V-k.start),$=pu(U,e.slice(k.start,k.end),k.range),ce=Dc(F,$.text,$.range);I.push({start:k.start+F-B,end:k.end-U-B,range:ce.range})}R=P,V=q},le="";for(let q=0;q<x.length;q++){let P=x[q];M(P.originalStart,P.originalEnd),le+=P.text,B=P.originalEnd-le.length,q<x.length-1&&(le+=`
`,e[P.originalEnd]===`
`&&M(P.originalEnd,P.originalEnd+1))}M(1/0,1/0);let ne=x[x.length-1];g.push({text:le,range:{startLineNumber:x[0].lineNumber,startColumn:0,endLineNumber:ne.lineNumber,endColumn:ne.text.length},sources:I})}return g}_dedentAndAddLinesToChunk(e,r,n){let o=hk(e.map(d=>d.text)),s=o.shortestLeadingCommonWhitespace;if(!s)return{chunks:e,usedFromRemaining:0};let a=e;for(let d=0;d<a.length;d++)a[d].originalStart+=s.length,a[d].text=o.trimmedLines[d]||"";let c=0,u=this.tokenizer.tokenLength(a.map(d=>d.text).join(`
`)),l=r[c];for(u+=l?.tokens||0;l&&u<n&&(l.text.length===0||l.text.startsWith(s));)a.push({...l,text:l.text.slice(s.length),originalStart:l.originalEnd+s.length}),c++,l=r[c],u+=l?.tokens||0;return{chunks:a,usedFromRemaining:c}}};Bd=w([b(0,yr)],Bd);function hk(t){let e=t.map(s=>{if(!s)return;let a=s.match(/^\s+/),c=a?a[0]:"",u=s.substring(c?.length);return[c,u]}),r=Nr(e),n=kFe(r)??"",o=n.length;return{trimmedLines:e.map(s=>s?s[0].substring(o)+s[1]:void 0),shortestLeadingCommonWhitespace:n}}function kFe(t){let e;for(let r of t){if(e===void 0){e=r[0];continue}e=PFe(e,r[0])}return e??""}function PFe(t,e){let r=uL(t,e);return t.substring(0,r)}var w4=250;function gk(t,e,r){let n=r.getStartPosition().isBefore(t.getStartPosition()),o=t.getEndPosition().isBefore(r.getEndPosition());return{newTextRange:jce(e,r,t.getStartPosition(),t.getEndPosition()),trimmedLeft:n,trimmedRight:o}}function Gce(t,e){if(t.length>0&&e.startLineNumber>t[0].range.startLineNumber)for(;t.length>0&&Xe.lift(t[0].range).getEndPosition().isBefore(e.getStartPosition());)t.shift();if(t.length>0&&e.endLineNumber<t[t.length-1].range.endLineNumber)for(;t.length>0;){let r=Xe.lift(t[t.length-1].range).getStartPosition();if(e.getEndPosition().isBefore(r))t.pop();else break}}var UH={};_n(UH,{arrayReplaceAt:()=>FH,assign:()=>OS,escapeHtml:()=>Gf,escapeRE:()=>f6e,fromCodePoint:()=>yk,has:()=>r6e,isMdAsciiPunct:()=>ny,isPunctChar:()=>ry,isSpace:()=>xr,isString:()=>U4,isValidEntityCode:()=>B4,isWhiteSpace:()=>ty,lib:()=>m6e,normalizeReference:()=>iy,unescapeAll:()=>gg,unescapeMd:()=>a6e});var D4={};_n(D4,{decode:()=>vk,encode:()=>P4,format:()=>NS,parse:()=>bk});var zce={};function AFe(t){let e=zce[t];if(e)return e;e=zce[t]=[];for(let r=0;r<128;r++){let n=String.fromCharCode(r);e.push(n)}for(let r=0;r<t.length;r++){let n=t.charCodeAt(r);e[n]="%"+("0"+n.toString(16).toUpperCase()).slice(-2)}return e}function R4(t,e){typeof e!="string"&&(e=R4.defaultChars);let r=AFe(e);return t.replace(/(%[a-f0-9]{2})+/gi,function(n){let o="";for(let s=0,a=n.length;s<a;s+=3){let c=parseInt(n.slice(s+1,s+3),16);if(c<128){o+=r[c];continue}if((c&224)===192&&s+3<a){let u=parseInt(n.slice(s+4,s+6),16);if((u&192)===128){let l=c<<6&1984|u&63;l<128?o+="\uFFFD\uFFFD":o+=String.fromCharCode(l),s+=3;continue}}if((c&240)===224&&s+6<a){let u=parseInt(n.slice(s+4,s+6),16),l=parseInt(n.slice(s+7,s+9),16);if((u&192)===128&&(l&192)===128){let d=c<<12&61440|u<<6&4032|l&63;d<2048||d>=55296&&d<=57343?o+="\uFFFD\uFFFD\uFFFD":o+=String.fromCharCode(d),s+=6;continue}}if((c&248)===240&&s+9<a){let u=parseInt(n.slice(s+4,s+6),16),l=parseInt(n.slice(s+7,s+9),16),d=parseInt(n.slice(s+10,s+12),16);if((u&192)===128&&(l&192)===128&&(d&192)===128){let p=c<<18&1835008|u<<12&258048|l<<6&4032|d&63;p<65536||p>1114111?o+="\uFFFD\uFFFD\uFFFD\uFFFD":(p-=65536,o+=String.fromCharCode(55296+(p>>10),56320+(p&1023))),s+=9;continue}}o+="\uFFFD"}return o})}R4.defaultChars=";/?:@&=+$,#";R4.componentChars="";var vk=R4;var $ce={};function DFe(t){let e=$ce[t];if(e)return e;e=$ce[t]=[];for(let r=0;r<128;r++){let n=String.fromCharCode(r);/^[0-9a-z]$/i.test(n)?e.push(n):e.push("%"+("0"+r.toString(16).toUpperCase()).slice(-2))}for(let r=0;r<t.length;r++)e[t.charCodeAt(r)]=t[r];return e}function k4(t,e,r){typeof e!="string"&&(r=e,e=k4.defaultChars),typeof r>"u"&&(r=!0);let n=DFe(e),o="";for(let s=0,a=t.length;s<a;s++){let c=t.charCodeAt(s);if(r&&c===37&&s+2<a&&/^[0-9a-f]{2}$/i.test(t.slice(s+1,s+3))){o+=t.slice(s,s+3),s+=2;continue}if(c<128){o+=n[c];continue}if(c>=55296&&c<=57343){if(c>=55296&&c<=56319&&s+1<a){let u=t.charCodeAt(s+1);if(u>=56320&&u<=57343){o+=encodeURIComponent(t[s]+t[s+1]),s++;continue}}o+="%EF%BF%BD";continue}o+=encodeURIComponent(t[s])}return o}k4.defaultChars=";/?:@&=+$,-_.!~*'()#";k4.componentChars="-_.!~*'()";var P4=k4;function NS(t){let e="";return e+=t.protocol||"",e+=t.slashes?"//":"",e+=t.auth?t.auth+"@":"",t.hostname&&t.hostname.indexOf(":")!==-1?e+="["+t.hostname+"]":e+=t.hostname||"",e+=t.port?":"+t.port:"",e+=t.pathname||"",e+=t.search||"",e+=t.hash||"",e}function A4(){this.protocol=null,this.slashes=null,this.auth=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.pathname=null}var NFe=/^([a-z0-9.+-]+:)/i,LFe=/:[0-9]*$/,OFe=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,MFe=["<",">",'"',"`"," ","\r",`
`,"	"],FFe=["{","}","|","\\","^","`"].concat(MFe),UFe=["'"].concat(FFe),Wce=["%","/","?",";","#"].concat(UFe),Kce=["/","?","#"],BFe=255,Yce=/^[+a-z0-9A-Z_-]{0,63}$/,qFe=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Qce={javascript:!0,"javascript:":!0},Xce={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function jFe(t,e){if(t&&t instanceof A4)return t;let r=new A4;return r.parse(t,e),r}A4.prototype.parse=function(t,e){let r,n,o,s=t;if(s=s.trim(),!e&&t.split("#").length===1){let l=OFe.exec(s);if(l)return this.pathname=l[1],l[2]&&(this.search=l[2]),this}let a=NFe.exec(s);if(a&&(a=a[0],r=a.toLowerCase(),this.protocol=a,s=s.substr(a.length)),(e||a||s.match(/^\/\/[^@\/]+@[^@\/]+/))&&(o=s.substr(0,2)==="//",o&&!(a&&Qce[a])&&(s=s.substr(2),this.slashes=!0)),!Qce[a]&&(o||a&&!Xce[a])){let l=-1;for(let h=0;h<Kce.length;h++)n=s.indexOf(Kce[h]),n!==-1&&(l===-1||n<l)&&(l=n);let d,p;l===-1?p=s.lastIndexOf("@"):p=s.lastIndexOf("@",l),p!==-1&&(d=s.slice(0,p),s=s.slice(p+1),this.auth=d),l=-1;for(let h=0;h<Wce.length;h++)n=s.indexOf(Wce[h]),n!==-1&&(l===-1||n<l)&&(l=n);l===-1&&(l=s.length),s[l-1]===":"&&l--;let f=s.slice(0,l);s=s.slice(l),this.parseHost(f),this.hostname=this.hostname||"";let m=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!m){let h=this.hostname.split(/\./);for(let g=0,v=h.length;g<v;g++){let y=h[g];if(y&&!y.match(Yce)){let _="";for(let x=0,S=y.length;x<S;x++)y.charCodeAt(x)>127?_+="x":_+=y[x];if(!_.match(Yce)){let x=h.slice(0,g),S=h.slice(g+1),I=y.match(qFe);I&&(x.push(I[1]),S.unshift(I[2])),S.length&&(s=S.join(".")+s),this.hostname=x.join(".");break}}}}this.hostname.length>BFe&&(this.hostname=""),m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2))}let c=s.indexOf("#");c!==-1&&(this.hash=s.substr(c),s=s.slice(0,c));let u=s.indexOf("?");return u!==-1&&(this.search=s.substr(u),s=s.slice(0,u)),s&&(this.pathname=s),Xce[r]&&this.hostname&&!this.pathname&&(this.pathname=""),this};A4.prototype.parseHost=function(t){let e=LFe.exec(t);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var bk=jFe;var PH={};_n(PH,{Any:()=>N4,Cc:()=>L4,Cf:()=>Jce,P:()=>LS,Z:()=>O4});var N4=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/;var L4=/[\0-\x1F\x7F-\x9F]/;var Jce=/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u0890\u0891\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD80D[\uDC30-\uDC3F]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/;var LS=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/;var O4=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/;var Zce=new Uint16Array('\u1D41<\xD5\u0131\u028A\u049D\u057B\u05D0\u0675\u06DE\u07A2\u07D6\u080F\u0A4A\u0A91\u0DA1\u0E6D\u0F09\u0F26\u10CA\u1228\u12E1\u1415\u149D\u14C3\u14DF\u1525\0\0\0\0\0\0\u156B\u16CD\u198D\u1C12\u1DDD\u1F7E\u2060\u21B0\u228D\u23C0\u23FB\u2442\u2824\u2912\u2D08\u2E48\u2FCE\u3016\u32BA\u3639\u37AC\u38FE\u3A28\u3A71\u3AE0\u3B2E\u0800EMabcfglmnoprstu\\bfms\x7F\x84\x8B\x90\x95\x98\xA6\xB3\xB9\xC8\xCFlig\u803B\xC6\u40C6P\u803B&\u4026cute\u803B\xC1\u40C1reve;\u4102\u0100iyx}rc\u803B\xC2\u40C2;\u4410r;\uC000\u{1D504}rave\u803B\xC0\u40C0pha;\u4391acr;\u4100d;\u6A53\u0100gp\x9D\xA1on;\u4104f;\uC000\u{1D538}plyFunction;\u6061ing\u803B\xC5\u40C5\u0100cs\xBE\xC3r;\uC000\u{1D49C}ign;\u6254ilde\u803B\xC3\u40C3ml\u803B\xC4\u40C4\u0400aceforsu\xE5\xFB\xFE\u0117\u011C\u0122\u0127\u012A\u0100cr\xEA\xF2kslash;\u6216\u0176\xF6\xF8;\u6AE7ed;\u6306y;\u4411\u0180crt\u0105\u010B\u0114ause;\u6235noullis;\u612Ca;\u4392r;\uC000\u{1D505}pf;\uC000\u{1D539}eve;\u42D8c\xF2\u0113mpeq;\u624E\u0700HOacdefhilorsu\u014D\u0151\u0156\u0180\u019E\u01A2\u01B5\u01B7\u01BA\u01DC\u0215\u0273\u0278\u027Ecy;\u4427PY\u803B\xA9\u40A9\u0180cpy\u015D\u0162\u017Aute;\u4106\u0100;i\u0167\u0168\u62D2talDifferentialD;\u6145leys;\u612D\u0200aeio\u0189\u018E\u0194\u0198ron;\u410Cdil\u803B\xC7\u40C7rc;\u4108nint;\u6230ot;\u410A\u0100dn\u01A7\u01ADilla;\u40B8terDot;\u40B7\xF2\u017Fi;\u43A7rcle\u0200DMPT\u01C7\u01CB\u01D1\u01D6ot;\u6299inus;\u6296lus;\u6295imes;\u6297o\u0100cs\u01E2\u01F8kwiseContourIntegral;\u6232eCurly\u0100DQ\u0203\u020FoubleQuote;\u601Duote;\u6019\u0200lnpu\u021E\u0228\u0247\u0255on\u0100;e\u0225\u0226\u6237;\u6A74\u0180git\u022F\u0236\u023Aruent;\u6261nt;\u622FourIntegral;\u622E\u0100fr\u024C\u024E;\u6102oduct;\u6210nterClockwiseContourIntegral;\u6233oss;\u6A2Fcr;\uC000\u{1D49E}p\u0100;C\u0284\u0285\u62D3ap;\u624D\u0580DJSZacefios\u02A0\u02AC\u02B0\u02B4\u02B8\u02CB\u02D7\u02E1\u02E6\u0333\u048D\u0100;o\u0179\u02A5trahd;\u6911cy;\u4402cy;\u4405cy;\u440F\u0180grs\u02BF\u02C4\u02C7ger;\u6021r;\u61A1hv;\u6AE4\u0100ay\u02D0\u02D5ron;\u410E;\u4414l\u0100;t\u02DD\u02DE\u6207a;\u4394r;\uC000\u{1D507}\u0100af\u02EB\u0327\u0100cm\u02F0\u0322ritical\u0200ADGT\u0300\u0306\u0316\u031Ccute;\u40B4o\u0174\u030B\u030D;\u42D9bleAcute;\u42DDrave;\u4060ilde;\u42DCond;\u62C4ferentialD;\u6146\u0470\u033D\0\0\0\u0342\u0354\0\u0405f;\uC000\u{1D53B}\u0180;DE\u0348\u0349\u034D\u40A8ot;\u60DCqual;\u6250ble\u0300CDLRUV\u0363\u0372\u0382\u03CF\u03E2\u03F8ontourIntegra\xEC\u0239o\u0274\u0379\0\0\u037B\xBB\u0349nArrow;\u61D3\u0100eo\u0387\u03A4ft\u0180ART\u0390\u0396\u03A1rrow;\u61D0ightArrow;\u61D4e\xE5\u02CAng\u0100LR\u03AB\u03C4eft\u0100AR\u03B3\u03B9rrow;\u67F8ightArrow;\u67FAightArrow;\u67F9ight\u0100AT\u03D8\u03DErrow;\u61D2ee;\u62A8p\u0241\u03E9\0\0\u03EFrrow;\u61D1ownArrow;\u61D5erticalBar;\u6225n\u0300ABLRTa\u0412\u042A\u0430\u045E\u047F\u037Crrow\u0180;BU\u041D\u041E\u0422\u6193ar;\u6913pArrow;\u61F5reve;\u4311eft\u02D2\u043A\0\u0446\0\u0450ightVector;\u6950eeVector;\u695Eector\u0100;B\u0459\u045A\u61BDar;\u6956ight\u01D4\u0467\0\u0471eeVector;\u695Fector\u0100;B\u047A\u047B\u61C1ar;\u6957ee\u0100;A\u0486\u0487\u62A4rrow;\u61A7\u0100ct\u0492\u0497r;\uC000\u{1D49F}rok;\u4110\u0800NTacdfglmopqstux\u04BD\u04C0\u04C4\u04CB\u04DE\u04E2\u04E7\u04EE\u04F5\u0521\u052F\u0536\u0552\u055D\u0560\u0565G;\u414AH\u803B\xD0\u40D0cute\u803B\xC9\u40C9\u0180aiy\u04D2\u04D7\u04DCron;\u411Arc\u803B\xCA\u40CA;\u442Dot;\u4116r;\uC000\u{1D508}rave\u803B\xC8\u40C8ement;\u6208\u0100ap\u04FA\u04FEcr;\u4112ty\u0253\u0506\0\0\u0512mallSquare;\u65FBerySmallSquare;\u65AB\u0100gp\u0526\u052Aon;\u4118f;\uC000\u{1D53C}silon;\u4395u\u0100ai\u053C\u0549l\u0100;T\u0542\u0543\u6A75ilde;\u6242librium;\u61CC\u0100ci\u0557\u055Ar;\u6130m;\u6A73a;\u4397ml\u803B\xCB\u40CB\u0100ip\u056A\u056Fsts;\u6203onentialE;\u6147\u0280cfios\u0585\u0588\u058D\u05B2\u05CCy;\u4424r;\uC000\u{1D509}lled\u0253\u0597\0\0\u05A3mallSquare;\u65FCerySmallSquare;\u65AA\u0370\u05BA\0\u05BF\0\0\u05C4f;\uC000\u{1D53D}All;\u6200riertrf;\u6131c\xF2\u05CB\u0600JTabcdfgorst\u05E8\u05EC\u05EF\u05FA\u0600\u0612\u0616\u061B\u061D\u0623\u066C\u0672cy;\u4403\u803B>\u403Emma\u0100;d\u05F7\u05F8\u4393;\u43DCreve;\u411E\u0180eiy\u0607\u060C\u0610dil;\u4122rc;\u411C;\u4413ot;\u4120r;\uC000\u{1D50A};\u62D9pf;\uC000\u{1D53E}eater\u0300EFGLST\u0635\u0644\u064E\u0656\u065B\u0666qual\u0100;L\u063E\u063F\u6265ess;\u62DBullEqual;\u6267reater;\u6AA2ess;\u6277lantEqual;\u6A7Eilde;\u6273cr;\uC000\u{1D4A2};\u626B\u0400Aacfiosu\u0685\u068B\u0696\u069B\u069E\u06AA\u06BE\u06CARDcy;\u442A\u0100ct\u0690\u0694ek;\u42C7;\u405Eirc;\u4124r;\u610ClbertSpace;\u610B\u01F0\u06AF\0\u06B2f;\u610DizontalLine;\u6500\u0100ct\u06C3\u06C5\xF2\u06A9rok;\u4126mp\u0144\u06D0\u06D8ownHum\xF0\u012Fqual;\u624F\u0700EJOacdfgmnostu\u06FA\u06FE\u0703\u0707\u070E\u071A\u071E\u0721\u0728\u0744\u0778\u078B\u078F\u0795cy;\u4415lig;\u4132cy;\u4401cute\u803B\xCD\u40CD\u0100iy\u0713\u0718rc\u803B\xCE\u40CE;\u4418ot;\u4130r;\u6111rave\u803B\xCC\u40CC\u0180;ap\u0720\u072F\u073F\u0100cg\u0734\u0737r;\u412AinaryI;\u6148lie\xF3\u03DD\u01F4\u0749\0\u0762\u0100;e\u074D\u074E\u622C\u0100gr\u0753\u0758ral;\u622Bsection;\u62C2isible\u0100CT\u076C\u0772omma;\u6063imes;\u6062\u0180gpt\u077F\u0783\u0788on;\u412Ef;\uC000\u{1D540}a;\u4399cr;\u6110ilde;\u4128\u01EB\u079A\0\u079Ecy;\u4406l\u803B\xCF\u40CF\u0280cfosu\u07AC\u07B7\u07BC\u07C2\u07D0\u0100iy\u07B1\u07B5rc;\u4134;\u4419r;\uC000\u{1D50D}pf;\uC000\u{1D541}\u01E3\u07C7\0\u07CCr;\uC000\u{1D4A5}rcy;\u4408kcy;\u4404\u0380HJacfos\u07E4\u07E8\u07EC\u07F1\u07FD\u0802\u0808cy;\u4425cy;\u440Cppa;\u439A\u0100ey\u07F6\u07FBdil;\u4136;\u441Ar;\uC000\u{1D50E}pf;\uC000\u{1D542}cr;\uC000\u{1D4A6}\u0580JTaceflmost\u0825\u0829\u082C\u0850\u0863\u09B3\u09B8\u09C7\u09CD\u0A37\u0A47cy;\u4409\u803B<\u403C\u0280cmnpr\u0837\u083C\u0841\u0844\u084Dute;\u4139bda;\u439Bg;\u67EAlacetrf;\u6112r;\u619E\u0180aey\u0857\u085C\u0861ron;\u413Ddil;\u413B;\u441B\u0100fs\u0868\u0970t\u0500ACDFRTUVar\u087E\u08A9\u08B1\u08E0\u08E6\u08FC\u092F\u095B\u0390\u096A\u0100nr\u0883\u088FgleBracket;\u67E8row\u0180;BR\u0899\u089A\u089E\u6190ar;\u61E4ightArrow;\u61C6eiling;\u6308o\u01F5\u08B7\0\u08C3bleBracket;\u67E6n\u01D4\u08C8\0\u08D2eeVector;\u6961ector\u0100;B\u08DB\u08DC\u61C3ar;\u6959loor;\u630Aight\u0100AV\u08EF\u08F5rrow;\u6194ector;\u694E\u0100er\u0901\u0917e\u0180;AV\u0909\u090A\u0910\u62A3rrow;\u61A4ector;\u695Aiangle\u0180;BE\u0924\u0925\u0929\u62B2ar;\u69CFqual;\u62B4p\u0180DTV\u0937\u0942\u094CownVector;\u6951eeVector;\u6960ector\u0100;B\u0956\u0957\u61BFar;\u6958ector\u0100;B\u0965\u0966\u61BCar;\u6952ight\xE1\u039Cs\u0300EFGLST\u097E\u098B\u0995\u099D\u09A2\u09ADqualGreater;\u62DAullEqual;\u6266reater;\u6276ess;\u6AA1lantEqual;\u6A7Dilde;\u6272r;\uC000\u{1D50F}\u0100;e\u09BD\u09BE\u62D8ftarrow;\u61DAidot;\u413F\u0180npw\u09D4\u0A16\u0A1Bg\u0200LRlr\u09DE\u09F7\u0A02\u0A10eft\u0100AR\u09E6\u09ECrrow;\u67F5ightArrow;\u67F7ightArrow;\u67F6eft\u0100ar\u03B3\u0A0Aight\xE1\u03BFight\xE1\u03CAf;\uC000\u{1D543}er\u0100LR\u0A22\u0A2CeftArrow;\u6199ightArrow;\u6198\u0180cht\u0A3E\u0A40\u0A42\xF2\u084C;\u61B0rok;\u4141;\u626A\u0400acefiosu\u0A5A\u0A5D\u0A60\u0A77\u0A7C\u0A85\u0A8B\u0A8Ep;\u6905y;\u441C\u0100dl\u0A65\u0A6FiumSpace;\u605Flintrf;\u6133r;\uC000\u{1D510}nusPlus;\u6213pf;\uC000\u{1D544}c\xF2\u0A76;\u439C\u0480Jacefostu\u0AA3\u0AA7\u0AAD\u0AC0\u0B14\u0B19\u0D91\u0D97\u0D9Ecy;\u440Acute;\u4143\u0180aey\u0AB4\u0AB9\u0ABEron;\u4147dil;\u4145;\u441D\u0180gsw\u0AC7\u0AF0\u0B0Eative\u0180MTV\u0AD3\u0ADF\u0AE8ediumSpace;\u600Bhi\u0100cn\u0AE6\u0AD8\xEB\u0AD9eryThi\xEE\u0AD9ted\u0100GL\u0AF8\u0B06reaterGreate\xF2\u0673essLes\xF3\u0A48Line;\u400Ar;\uC000\u{1D511}\u0200Bnpt\u0B22\u0B28\u0B37\u0B3Areak;\u6060BreakingSpace;\u40A0f;\u6115\u0680;CDEGHLNPRSTV\u0B55\u0B56\u0B6A\u0B7C\u0BA1\u0BEB\u0C04\u0C5E\u0C84\u0CA6\u0CD8\u0D61\u0D85\u6AEC\u0100ou\u0B5B\u0B64ngruent;\u6262pCap;\u626DoubleVerticalBar;\u6226\u0180lqx\u0B83\u0B8A\u0B9Bement;\u6209ual\u0100;T\u0B92\u0B93\u6260ilde;\uC000\u2242\u0338ists;\u6204reater\u0380;EFGLST\u0BB6\u0BB7\u0BBD\u0BC9\u0BD3\u0BD8\u0BE5\u626Fqual;\u6271ullEqual;\uC000\u2267\u0338reater;\uC000\u226B\u0338ess;\u6279lantEqual;\uC000\u2A7E\u0338ilde;\u6275ump\u0144\u0BF2\u0BFDownHump;\uC000\u224E\u0338qual;\uC000\u224F\u0338e\u0100fs\u0C0A\u0C27tTriangle\u0180;BE\u0C1A\u0C1B\u0C21\u62EAar;\uC000\u29CF\u0338qual;\u62ECs\u0300;EGLST\u0C35\u0C36\u0C3C\u0C44\u0C4B\u0C58\u626Equal;\u6270reater;\u6278ess;\uC000\u226A\u0338lantEqual;\uC000\u2A7D\u0338ilde;\u6274ested\u0100GL\u0C68\u0C79reaterGreater;\uC000\u2AA2\u0338essLess;\uC000\u2AA1\u0338recedes\u0180;ES\u0C92\u0C93\u0C9B\u6280qual;\uC000\u2AAF\u0338lantEqual;\u62E0\u0100ei\u0CAB\u0CB9verseElement;\u620CghtTriangle\u0180;BE\u0CCB\u0CCC\u0CD2\u62EBar;\uC000\u29D0\u0338qual;\u62ED\u0100qu\u0CDD\u0D0CuareSu\u0100bp\u0CE8\u0CF9set\u0100;E\u0CF0\u0CF3\uC000\u228F\u0338qual;\u62E2erset\u0100;E\u0D03\u0D06\uC000\u2290\u0338qual;\u62E3\u0180bcp\u0D13\u0D24\u0D4Eset\u0100;E\u0D1B\u0D1E\uC000\u2282\u20D2qual;\u6288ceeds\u0200;EST\u0D32\u0D33\u0D3B\u0D46\u6281qual;\uC000\u2AB0\u0338lantEqual;\u62E1ilde;\uC000\u227F\u0338erset\u0100;E\u0D58\u0D5B\uC000\u2283\u20D2qual;\u6289ilde\u0200;EFT\u0D6E\u0D6F\u0D75\u0D7F\u6241qual;\u6244ullEqual;\u6247ilde;\u6249erticalBar;\u6224cr;\uC000\u{1D4A9}ilde\u803B\xD1\u40D1;\u439D\u0700Eacdfgmoprstuv\u0DBD\u0DC2\u0DC9\u0DD5\u0DDB\u0DE0\u0DE7\u0DFC\u0E02\u0E20\u0E22\u0E32\u0E3F\u0E44lig;\u4152cute\u803B\xD3\u40D3\u0100iy\u0DCE\u0DD3rc\u803B\xD4\u40D4;\u441Eblac;\u4150r;\uC000\u{1D512}rave\u803B\xD2\u40D2\u0180aei\u0DEE\u0DF2\u0DF6cr;\u414Cga;\u43A9cron;\u439Fpf;\uC000\u{1D546}enCurly\u0100DQ\u0E0E\u0E1AoubleQuote;\u601Cuote;\u6018;\u6A54\u0100cl\u0E27\u0E2Cr;\uC000\u{1D4AA}ash\u803B\xD8\u40D8i\u016C\u0E37\u0E3Cde\u803B\xD5\u40D5es;\u6A37ml\u803B\xD6\u40D6er\u0100BP\u0E4B\u0E60\u0100ar\u0E50\u0E53r;\u603Eac\u0100ek\u0E5A\u0E5C;\u63DEet;\u63B4arenthesis;\u63DC\u0480acfhilors\u0E7F\u0E87\u0E8A\u0E8F\u0E92\u0E94\u0E9D\u0EB0\u0EFCrtialD;\u6202y;\u441Fr;\uC000\u{1D513}i;\u43A6;\u43A0usMinus;\u40B1\u0100ip\u0EA2\u0EADncareplan\xE5\u069Df;\u6119\u0200;eio\u0EB9\u0EBA\u0EE0\u0EE4\u6ABBcedes\u0200;EST\u0EC8\u0EC9\u0ECF\u0EDA\u627Aqual;\u6AAFlantEqual;\u627Cilde;\u627Eme;\u6033\u0100dp\u0EE9\u0EEEuct;\u620Fortion\u0100;a\u0225\u0EF9l;\u621D\u0100ci\u0F01\u0F06r;\uC000\u{1D4AB};\u43A8\u0200Ufos\u0F11\u0F16\u0F1B\u0F1FOT\u803B"\u4022r;\uC000\u{1D514}pf;\u611Acr;\uC000\u{1D4AC}\u0600BEacefhiorsu\u0F3E\u0F43\u0F47\u0F60\u0F73\u0FA7\u0FAA\u0FAD\u1096\u10A9\u10B4\u10BEarr;\u6910G\u803B\xAE\u40AE\u0180cnr\u0F4E\u0F53\u0F56ute;\u4154g;\u67EBr\u0100;t\u0F5C\u0F5D\u61A0l;\u6916\u0180aey\u0F67\u0F6C\u0F71ron;\u4158dil;\u4156;\u4420\u0100;v\u0F78\u0F79\u611Cerse\u0100EU\u0F82\u0F99\u0100lq\u0F87\u0F8Eement;\u620Builibrium;\u61CBpEquilibrium;\u696Fr\xBB\u0F79o;\u43A1ght\u0400ACDFTUVa\u0FC1\u0FEB\u0FF3\u1022\u1028\u105B\u1087\u03D8\u0100nr\u0FC6\u0FD2gleBracket;\u67E9row\u0180;BL\u0FDC\u0FDD\u0FE1\u6192ar;\u61E5eftArrow;\u61C4eiling;\u6309o\u01F5\u0FF9\0\u1005bleBracket;\u67E7n\u01D4\u100A\0\u1014eeVector;\u695Dector\u0100;B\u101D\u101E\u61C2ar;\u6955loor;\u630B\u0100er\u102D\u1043e\u0180;AV\u1035\u1036\u103C\u62A2rrow;\u61A6ector;\u695Biangle\u0180;BE\u1050\u1051\u1055\u62B3ar;\u69D0qual;\u62B5p\u0180DTV\u1063\u106E\u1078ownVector;\u694FeeVector;\u695Cector\u0100;B\u1082\u1083\u61BEar;\u6954ector\u0100;B\u1091\u1092\u61C0ar;\u6953\u0100pu\u109B\u109Ef;\u611DndImplies;\u6970ightarrow;\u61DB\u0100ch\u10B9\u10BCr;\u611B;\u61B1leDelayed;\u69F4\u0680HOacfhimoqstu\u10E4\u10F1\u10F7\u10FD\u1119\u111E\u1151\u1156\u1161\u1167\u11B5\u11BB\u11BF\u0100Cc\u10E9\u10EEHcy;\u4429y;\u4428FTcy;\u442Ccute;\u415A\u0280;aeiy\u1108\u1109\u110E\u1113\u1117\u6ABCron;\u4160dil;\u415Erc;\u415C;\u4421r;\uC000\u{1D516}ort\u0200DLRU\u112A\u1134\u113E\u1149ownArrow\xBB\u041EeftArrow\xBB\u089AightArrow\xBB\u0FDDpArrow;\u6191gma;\u43A3allCircle;\u6218pf;\uC000\u{1D54A}\u0272\u116D\0\0\u1170t;\u621Aare\u0200;ISU\u117B\u117C\u1189\u11AF\u65A1ntersection;\u6293u\u0100bp\u118F\u119Eset\u0100;E\u1197\u1198\u628Fqual;\u6291erset\u0100;E\u11A8\u11A9\u6290qual;\u6292nion;\u6294cr;\uC000\u{1D4AE}ar;\u62C6\u0200bcmp\u11C8\u11DB\u1209\u120B\u0100;s\u11CD\u11CE\u62D0et\u0100;E\u11CD\u11D5qual;\u6286\u0100ch\u11E0\u1205eeds\u0200;EST\u11ED\u11EE\u11F4\u11FF\u627Bqual;\u6AB0lantEqual;\u627Dilde;\u627FTh\xE1\u0F8C;\u6211\u0180;es\u1212\u1213\u1223\u62D1rset\u0100;E\u121C\u121D\u6283qual;\u6287et\xBB\u1213\u0580HRSacfhiors\u123E\u1244\u1249\u1255\u125E\u1271\u1276\u129F\u12C2\u12C8\u12D1ORN\u803B\xDE\u40DEADE;\u6122\u0100Hc\u124E\u1252cy;\u440By;\u4426\u0100bu\u125A\u125C;\u4009;\u43A4\u0180aey\u1265\u126A\u126Fron;\u4164dil;\u4162;\u4422r;\uC000\u{1D517}\u0100ei\u127B\u1289\u01F2\u1280\0\u1287efore;\u6234a;\u4398\u0100cn\u128E\u1298kSpace;\uC000\u205F\u200ASpace;\u6009lde\u0200;EFT\u12AB\u12AC\u12B2\u12BC\u623Cqual;\u6243ullEqual;\u6245ilde;\u6248pf;\uC000\u{1D54B}ipleDot;\u60DB\u0100ct\u12D6\u12DBr;\uC000\u{1D4AF}rok;\u4166\u0AE1\u12F7\u130E\u131A\u1326\0\u132C\u1331\0\0\0\0\0\u1338\u133D\u1377\u1385\0\u13FF\u1404\u140A\u1410\u0100cr\u12FB\u1301ute\u803B\xDA\u40DAr\u0100;o\u1307\u1308\u619Fcir;\u6949r\u01E3\u1313\0\u1316y;\u440Eve;\u416C\u0100iy\u131E\u1323rc\u803B\xDB\u40DB;\u4423blac;\u4170r;\uC000\u{1D518}rave\u803B\xD9\u40D9acr;\u416A\u0100di\u1341\u1369er\u0100BP\u1348\u135D\u0100ar\u134D\u1350r;\u405Fac\u0100ek\u1357\u1359;\u63DFet;\u63B5arenthesis;\u63DDon\u0100;P\u1370\u1371\u62C3lus;\u628E\u0100gp\u137B\u137Fon;\u4172f;\uC000\u{1D54C}\u0400ADETadps\u1395\u13AE\u13B8\u13C4\u03E8\u13D2\u13D7\u13F3rrow\u0180;BD\u1150\u13A0\u13A4ar;\u6912ownArrow;\u61C5ownArrow;\u6195quilibrium;\u696Eee\u0100;A\u13CB\u13CC\u62A5rrow;\u61A5own\xE1\u03F3er\u0100LR\u13DE\u13E8eftArrow;\u6196ightArrow;\u6197i\u0100;l\u13F9\u13FA\u43D2on;\u43A5ing;\u416Ecr;\uC000\u{1D4B0}ilde;\u4168ml\u803B\xDC\u40DC\u0480Dbcdefosv\u1427\u142C\u1430\u1433\u143E\u1485\u148A\u1490\u1496ash;\u62ABar;\u6AEBy;\u4412ash\u0100;l\u143B\u143C\u62A9;\u6AE6\u0100er\u1443\u1445;\u62C1\u0180bty\u144C\u1450\u147Aar;\u6016\u0100;i\u144F\u1455cal\u0200BLST\u1461\u1465\u146A\u1474ar;\u6223ine;\u407Ceparator;\u6758ilde;\u6240ThinSpace;\u600Ar;\uC000\u{1D519}pf;\uC000\u{1D54D}cr;\uC000\u{1D4B1}dash;\u62AA\u0280cefos\u14A7\u14AC\u14B1\u14B6\u14BCirc;\u4174dge;\u62C0r;\uC000\u{1D51A}pf;\uC000\u{1D54E}cr;\uC000\u{1D4B2}\u0200fios\u14CB\u14D0\u14D2\u14D8r;\uC000\u{1D51B};\u439Epf;\uC000\u{1D54F}cr;\uC000\u{1D4B3}\u0480AIUacfosu\u14F1\u14F5\u14F9\u14FD\u1504\u150F\u1514\u151A\u1520cy;\u442Fcy;\u4407cy;\u442Ecute\u803B\xDD\u40DD\u0100iy\u1509\u150Drc;\u4176;\u442Br;\uC000\u{1D51C}pf;\uC000\u{1D550}cr;\uC000\u{1D4B4}ml;\u4178\u0400Hacdefos\u1535\u1539\u153F\u154B\u154F\u155D\u1560\u1564cy;\u4416cute;\u4179\u0100ay\u1544\u1549ron;\u417D;\u4417ot;\u417B\u01F2\u1554\0\u155BoWidt\xE8\u0AD9a;\u4396r;\u6128pf;\u6124cr;\uC000\u{1D4B5}\u0BE1\u1583\u158A\u1590\0\u15B0\u15B6\u15BF\0\0\0\0\u15C6\u15DB\u15EB\u165F\u166D\0\u1695\u169B\u16B2\u16B9\0\u16BEcute\u803B\xE1\u40E1reve;\u4103\u0300;Ediuy\u159C\u159D\u15A1\u15A3\u15A8\u15AD\u623E;\uC000\u223E\u0333;\u623Frc\u803B\xE2\u40E2te\u80BB\xB4\u0306;\u4430lig\u803B\xE6\u40E6\u0100;r\xB2\u15BA;\uC000\u{1D51E}rave\u803B\xE0\u40E0\u0100ep\u15CA\u15D6\u0100fp\u15CF\u15D4sym;\u6135\xE8\u15D3ha;\u43B1\u0100ap\u15DFc\u0100cl\u15E4\u15E7r;\u4101g;\u6A3F\u0264\u15F0\0\0\u160A\u0280;adsv\u15FA\u15FB\u15FF\u1601\u1607\u6227nd;\u6A55;\u6A5Clope;\u6A58;\u6A5A\u0380;elmrsz\u1618\u1619\u161B\u161E\u163F\u164F\u1659\u6220;\u69A4e\xBB\u1619sd\u0100;a\u1625\u1626\u6221\u0461\u1630\u1632\u1634\u1636\u1638\u163A\u163C\u163E;\u69A8;\u69A9;\u69AA;\u69AB;\u69AC;\u69AD;\u69AE;\u69AFt\u0100;v\u1645\u1646\u621Fb\u0100;d\u164C\u164D\u62BE;\u699D\u0100pt\u1654\u1657h;\u6222\xBB\xB9arr;\u637C\u0100gp\u1663\u1667on;\u4105f;\uC000\u{1D552}\u0380;Eaeiop\u12C1\u167B\u167D\u1682\u1684\u1687\u168A;\u6A70cir;\u6A6F;\u624Ad;\u624Bs;\u4027rox\u0100;e\u12C1\u1692\xF1\u1683ing\u803B\xE5\u40E5\u0180cty\u16A1\u16A6\u16A8r;\uC000\u{1D4B6};\u402Amp\u0100;e\u12C1\u16AF\xF1\u0288ilde\u803B\xE3\u40E3ml\u803B\xE4\u40E4\u0100ci\u16C2\u16C8onin\xF4\u0272nt;\u6A11\u0800Nabcdefiklnoprsu\u16ED\u16F1\u1730\u173C\u1743\u1748\u1778\u177D\u17E0\u17E6\u1839\u1850\u170D\u193D\u1948\u1970ot;\u6AED\u0100cr\u16F6\u171Ek\u0200ceps\u1700\u1705\u170D\u1713ong;\u624Cpsilon;\u43F6rime;\u6035im\u0100;e\u171A\u171B\u623Dq;\u62CD\u0176\u1722\u1726ee;\u62BDed\u0100;g\u172C\u172D\u6305e\xBB\u172Drk\u0100;t\u135C\u1737brk;\u63B6\u0100oy\u1701\u1741;\u4431quo;\u601E\u0280cmprt\u1753\u175B\u1761\u1764\u1768aus\u0100;e\u010A\u0109ptyv;\u69B0s\xE9\u170Cno\xF5\u0113\u0180ahw\u176F\u1771\u1773;\u43B2;\u6136een;\u626Cr;\uC000\u{1D51F}g\u0380costuvw\u178D\u179D\u17B3\u17C1\u17D5\u17DB\u17DE\u0180aiu\u1794\u1796\u179A\xF0\u0760rc;\u65EFp\xBB\u1371\u0180dpt\u17A4\u17A8\u17ADot;\u6A00lus;\u6A01imes;\u6A02\u0271\u17B9\0\0\u17BEcup;\u6A06ar;\u6605riangle\u0100du\u17CD\u17D2own;\u65BDp;\u65B3plus;\u6A04e\xE5\u1444\xE5\u14ADarow;\u690D\u0180ako\u17ED\u1826\u1835\u0100cn\u17F2\u1823k\u0180lst\u17FA\u05AB\u1802ozenge;\u69EBriangle\u0200;dlr\u1812\u1813\u1818\u181D\u65B4own;\u65BEeft;\u65C2ight;\u65B8k;\u6423\u01B1\u182B\0\u1833\u01B2\u182F\0\u1831;\u6592;\u65914;\u6593ck;\u6588\u0100eo\u183E\u184D\u0100;q\u1843\u1846\uC000=\u20E5uiv;\uC000\u2261\u20E5t;\u6310\u0200ptwx\u1859\u185E\u1867\u186Cf;\uC000\u{1D553}\u0100;t\u13CB\u1863om\xBB\u13CCtie;\u62C8\u0600DHUVbdhmptuv\u1885\u1896\u18AA\u18BB\u18D7\u18DB\u18EC\u18FF\u1905\u190A\u1910\u1921\u0200LRlr\u188E\u1890\u1892\u1894;\u6557;\u6554;\u6556;\u6553\u0280;DUdu\u18A1\u18A2\u18A4\u18A6\u18A8\u6550;\u6566;\u6569;\u6564;\u6567\u0200LRlr\u18B3\u18B5\u18B7\u18B9;\u655D;\u655A;\u655C;\u6559\u0380;HLRhlr\u18CA\u18CB\u18CD\u18CF\u18D1\u18D3\u18D5\u6551;\u656C;\u6563;\u6560;\u656B;\u6562;\u655Fox;\u69C9\u0200LRlr\u18E4\u18E6\u18E8\u18EA;\u6555;\u6552;\u6510;\u650C\u0280;DUdu\u06BD\u18F7\u18F9\u18FB\u18FD;\u6565;\u6568;\u652C;\u6534inus;\u629Flus;\u629Eimes;\u62A0\u0200LRlr\u1919\u191B\u191D\u191F;\u655B;\u6558;\u6518;\u6514\u0380;HLRhlr\u1930\u1931\u1933\u1935\u1937\u1939\u193B\u6502;\u656A;\u6561;\u655E;\u653C;\u6524;\u651C\u0100ev\u0123\u1942bar\u803B\xA6\u40A6\u0200ceio\u1951\u1956\u195A\u1960r;\uC000\u{1D4B7}mi;\u604Fm\u0100;e\u171A\u171Cl\u0180;bh\u1968\u1969\u196B\u405C;\u69C5sub;\u67C8\u016C\u1974\u197El\u0100;e\u1979\u197A\u6022t\xBB\u197Ap\u0180;Ee\u012F\u1985\u1987;\u6AAE\u0100;q\u06DC\u06DB\u0CE1\u19A7\0\u19E8\u1A11\u1A15\u1A32\0\u1A37\u1A50\0\0\u1AB4\0\0\u1AC1\0\0\u1B21\u1B2E\u1B4D\u1B52\0\u1BFD\0\u1C0C\u0180cpr\u19AD\u19B2\u19DDute;\u4107\u0300;abcds\u19BF\u19C0\u19C4\u19CA\u19D5\u19D9\u6229nd;\u6A44rcup;\u6A49\u0100au\u19CF\u19D2p;\u6A4Bp;\u6A47ot;\u6A40;\uC000\u2229\uFE00\u0100eo\u19E2\u19E5t;\u6041\xEE\u0693\u0200aeiu\u19F0\u19FB\u1A01\u1A05\u01F0\u19F5\0\u19F8s;\u6A4Don;\u410Ddil\u803B\xE7\u40E7rc;\u4109ps\u0100;s\u1A0C\u1A0D\u6A4Cm;\u6A50ot;\u410B\u0180dmn\u1A1B\u1A20\u1A26il\u80BB\xB8\u01ADptyv;\u69B2t\u8100\xA2;e\u1A2D\u1A2E\u40A2r\xE4\u01B2r;\uC000\u{1D520}\u0180cei\u1A3D\u1A40\u1A4Dy;\u4447ck\u0100;m\u1A47\u1A48\u6713ark\xBB\u1A48;\u43C7r\u0380;Ecefms\u1A5F\u1A60\u1A62\u1A6B\u1AA4\u1AAA\u1AAE\u65CB;\u69C3\u0180;el\u1A69\u1A6A\u1A6D\u42C6q;\u6257e\u0261\u1A74\0\0\u1A88rrow\u0100lr\u1A7C\u1A81eft;\u61BAight;\u61BB\u0280RSacd\u1A92\u1A94\u1A96\u1A9A\u1A9F\xBB\u0F47;\u64C8st;\u629Birc;\u629Aash;\u629Dnint;\u6A10id;\u6AEFcir;\u69C2ubs\u0100;u\u1ABB\u1ABC\u6663it\xBB\u1ABC\u02EC\u1AC7\u1AD4\u1AFA\0\u1B0Aon\u0100;e\u1ACD\u1ACE\u403A\u0100;q\xC7\xC6\u026D\u1AD9\0\0\u1AE2a\u0100;t\u1ADE\u1ADF\u402C;\u4040\u0180;fl\u1AE8\u1AE9\u1AEB\u6201\xEE\u1160e\u0100mx\u1AF1\u1AF6ent\xBB\u1AE9e\xF3\u024D\u01E7\u1AFE\0\u1B07\u0100;d\u12BB\u1B02ot;\u6A6Dn\xF4\u0246\u0180fry\u1B10\u1B14\u1B17;\uC000\u{1D554}o\xE4\u0254\u8100\xA9;s\u0155\u1B1Dr;\u6117\u0100ao\u1B25\u1B29rr;\u61B5ss;\u6717\u0100cu\u1B32\u1B37r;\uC000\u{1D4B8}\u0100bp\u1B3C\u1B44\u0100;e\u1B41\u1B42\u6ACF;\u6AD1\u0100;e\u1B49\u1B4A\u6AD0;\u6AD2dot;\u62EF\u0380delprvw\u1B60\u1B6C\u1B77\u1B82\u1BAC\u1BD4\u1BF9arr\u0100lr\u1B68\u1B6A;\u6938;\u6935\u0270\u1B72\0\0\u1B75r;\u62DEc;\u62DFarr\u0100;p\u1B7F\u1B80\u61B6;\u693D\u0300;bcdos\u1B8F\u1B90\u1B96\u1BA1\u1BA5\u1BA8\u622Arcap;\u6A48\u0100au\u1B9B\u1B9Ep;\u6A46p;\u6A4Aot;\u628Dr;\u6A45;\uC000\u222A\uFE00\u0200alrv\u1BB5\u1BBF\u1BDE\u1BE3rr\u0100;m\u1BBC\u1BBD\u61B7;\u693Cy\u0180evw\u1BC7\u1BD4\u1BD8q\u0270\u1BCE\0\0\u1BD2re\xE3\u1B73u\xE3\u1B75ee;\u62CEedge;\u62CFen\u803B\xA4\u40A4earrow\u0100lr\u1BEE\u1BF3eft\xBB\u1B80ight\xBB\u1BBDe\xE4\u1BDD\u0100ci\u1C01\u1C07onin\xF4\u01F7nt;\u6231lcty;\u632D\u0980AHabcdefhijlorstuwz\u1C38\u1C3B\u1C3F\u1C5D\u1C69\u1C75\u1C8A\u1C9E\u1CAC\u1CB7\u1CFB\u1CFF\u1D0D\u1D7B\u1D91\u1DAB\u1DBB\u1DC6\u1DCDr\xF2\u0381ar;\u6965\u0200glrs\u1C48\u1C4D\u1C52\u1C54ger;\u6020eth;\u6138\xF2\u1133h\u0100;v\u1C5A\u1C5B\u6010\xBB\u090A\u016B\u1C61\u1C67arow;\u690Fa\xE3\u0315\u0100ay\u1C6E\u1C73ron;\u410F;\u4434\u0180;ao\u0332\u1C7C\u1C84\u0100gr\u02BF\u1C81r;\u61CAtseq;\u6A77\u0180glm\u1C91\u1C94\u1C98\u803B\xB0\u40B0ta;\u43B4ptyv;\u69B1\u0100ir\u1CA3\u1CA8sht;\u697F;\uC000\u{1D521}ar\u0100lr\u1CB3\u1CB5\xBB\u08DC\xBB\u101E\u0280aegsv\u1CC2\u0378\u1CD6\u1CDC\u1CE0m\u0180;os\u0326\u1CCA\u1CD4nd\u0100;s\u0326\u1CD1uit;\u6666amma;\u43DDin;\u62F2\u0180;io\u1CE7\u1CE8\u1CF8\u40F7de\u8100\xF7;o\u1CE7\u1CF0ntimes;\u62C7n\xF8\u1CF7cy;\u4452c\u026F\u1D06\0\0\u1D0Arn;\u631Eop;\u630D\u0280lptuw\u1D18\u1D1D\u1D22\u1D49\u1D55lar;\u4024f;\uC000\u{1D555}\u0280;emps\u030B\u1D2D\u1D37\u1D3D\u1D42q\u0100;d\u0352\u1D33ot;\u6251inus;\u6238lus;\u6214quare;\u62A1blebarwedg\xE5\xFAn\u0180adh\u112E\u1D5D\u1D67ownarrow\xF3\u1C83arpoon\u0100lr\u1D72\u1D76ef\xF4\u1CB4igh\xF4\u1CB6\u0162\u1D7F\u1D85karo\xF7\u0F42\u026F\u1D8A\0\0\u1D8Ern;\u631Fop;\u630C\u0180cot\u1D98\u1DA3\u1DA6\u0100ry\u1D9D\u1DA1;\uC000\u{1D4B9};\u4455l;\u69F6rok;\u4111\u0100dr\u1DB0\u1DB4ot;\u62F1i\u0100;f\u1DBA\u1816\u65BF\u0100ah\u1DC0\u1DC3r\xF2\u0429a\xF2\u0FA6angle;\u69A6\u0100ci\u1DD2\u1DD5y;\u445Fgrarr;\u67FF\u0900Dacdefglmnopqrstux\u1E01\u1E09\u1E19\u1E38\u0578\u1E3C\u1E49\u1E61\u1E7E\u1EA5\u1EAF\u1EBD\u1EE1\u1F2A\u1F37\u1F44\u1F4E\u1F5A\u0100Do\u1E06\u1D34o\xF4\u1C89\u0100cs\u1E0E\u1E14ute\u803B\xE9\u40E9ter;\u6A6E\u0200aioy\u1E22\u1E27\u1E31\u1E36ron;\u411Br\u0100;c\u1E2D\u1E2E\u6256\u803B\xEA\u40EAlon;\u6255;\u444Dot;\u4117\u0100Dr\u1E41\u1E45ot;\u6252;\uC000\u{1D522}\u0180;rs\u1E50\u1E51\u1E57\u6A9Aave\u803B\xE8\u40E8\u0100;d\u1E5C\u1E5D\u6A96ot;\u6A98\u0200;ils\u1E6A\u1E6B\u1E72\u1E74\u6A99nters;\u63E7;\u6113\u0100;d\u1E79\u1E7A\u6A95ot;\u6A97\u0180aps\u1E85\u1E89\u1E97cr;\u4113ty\u0180;sv\u1E92\u1E93\u1E95\u6205et\xBB\u1E93p\u01001;\u1E9D\u1EA4\u0133\u1EA1\u1EA3;\u6004;\u6005\u6003\u0100gs\u1EAA\u1EAC;\u414Bp;\u6002\u0100gp\u1EB4\u1EB8on;\u4119f;\uC000\u{1D556}\u0180als\u1EC4\u1ECE\u1ED2r\u0100;s\u1ECA\u1ECB\u62D5l;\u69E3us;\u6A71i\u0180;lv\u1EDA\u1EDB\u1EDF\u43B5on\xBB\u1EDB;\u43F5\u0200csuv\u1EEA\u1EF3\u1F0B\u1F23\u0100io\u1EEF\u1E31rc\xBB\u1E2E\u0269\u1EF9\0\0\u1EFB\xED\u0548ant\u0100gl\u1F02\u1F06tr\xBB\u1E5Dess\xBB\u1E7A\u0180aei\u1F12\u1F16\u1F1Als;\u403Dst;\u625Fv\u0100;D\u0235\u1F20D;\u6A78parsl;\u69E5\u0100Da\u1F2F\u1F33ot;\u6253rr;\u6971\u0180cdi\u1F3E\u1F41\u1EF8r;\u612Fo\xF4\u0352\u0100ah\u1F49\u1F4B;\u43B7\u803B\xF0\u40F0\u0100mr\u1F53\u1F57l\u803B\xEB\u40EBo;\u60AC\u0180cip\u1F61\u1F64\u1F67l;\u4021s\xF4\u056E\u0100eo\u1F6C\u1F74ctatio\xEE\u0559nential\xE5\u0579\u09E1\u1F92\0\u1F9E\0\u1FA1\u1FA7\0\0\u1FC6\u1FCC\0\u1FD3\0\u1FE6\u1FEA\u2000\0\u2008\u205Allingdotse\xF1\u1E44y;\u4444male;\u6640\u0180ilr\u1FAD\u1FB3\u1FC1lig;\u8000\uFB03\u0269\u1FB9\0\0\u1FBDg;\u8000\uFB00ig;\u8000\uFB04;\uC000\u{1D523}lig;\u8000\uFB01lig;\uC000fj\u0180alt\u1FD9\u1FDC\u1FE1t;\u666Dig;\u8000\uFB02ns;\u65B1of;\u4192\u01F0\u1FEE\0\u1FF3f;\uC000\u{1D557}\u0100ak\u05BF\u1FF7\u0100;v\u1FFC\u1FFD\u62D4;\u6AD9artint;\u6A0D\u0100ao\u200C\u2055\u0100cs\u2011\u2052\u03B1\u201A\u2030\u2038\u2045\u2048\0\u2050\u03B2\u2022\u2025\u2027\u202A\u202C\0\u202E\u803B\xBD\u40BD;\u6153\u803B\xBC\u40BC;\u6155;\u6159;\u615B\u01B3\u2034\0\u2036;\u6154;\u6156\u02B4\u203E\u2041\0\0\u2043\u803B\xBE\u40BE;\u6157;\u615C5;\u6158\u01B6\u204C\0\u204E;\u615A;\u615D8;\u615El;\u6044wn;\u6322cr;\uC000\u{1D4BB}\u0880Eabcdefgijlnorstv\u2082\u2089\u209F\u20A5\u20B0\u20B4\u20F0\u20F5\u20FA\u20FF\u2103\u2112\u2138\u0317\u213E\u2152\u219E\u0100;l\u064D\u2087;\u6A8C\u0180cmp\u2090\u2095\u209Dute;\u41F5ma\u0100;d\u209C\u1CDA\u43B3;\u6A86reve;\u411F\u0100iy\u20AA\u20AErc;\u411D;\u4433ot;\u4121\u0200;lqs\u063E\u0642\u20BD\u20C9\u0180;qs\u063E\u064C\u20C4lan\xF4\u0665\u0200;cdl\u0665\u20D2\u20D5\u20E5c;\u6AA9ot\u0100;o\u20DC\u20DD\u6A80\u0100;l\u20E2\u20E3\u6A82;\u6A84\u0100;e\u20EA\u20ED\uC000\u22DB\uFE00s;\u6A94r;\uC000\u{1D524}\u0100;g\u0673\u061Bmel;\u6137cy;\u4453\u0200;Eaj\u065A\u210C\u210E\u2110;\u6A92;\u6AA5;\u6AA4\u0200Eaes\u211B\u211D\u2129\u2134;\u6269p\u0100;p\u2123\u2124\u6A8Arox\xBB\u2124\u0100;q\u212E\u212F\u6A88\u0100;q\u212E\u211Bim;\u62E7pf;\uC000\u{1D558}\u0100ci\u2143\u2146r;\u610Am\u0180;el\u066B\u214E\u2150;\u6A8E;\u6A90\u8300>;cdlqr\u05EE\u2160\u216A\u216E\u2173\u2179\u0100ci\u2165\u2167;\u6AA7r;\u6A7Aot;\u62D7Par;\u6995uest;\u6A7C\u0280adels\u2184\u216A\u2190\u0656\u219B\u01F0\u2189\0\u218Epro\xF8\u209Er;\u6978q\u0100lq\u063F\u2196les\xF3\u2088i\xED\u066B\u0100en\u21A3\u21ADrtneqq;\uC000\u2269\uFE00\xC5\u21AA\u0500Aabcefkosy\u21C4\u21C7\u21F1\u21F5\u21FA\u2218\u221D\u222F\u2268\u227Dr\xF2\u03A0\u0200ilmr\u21D0\u21D4\u21D7\u21DBrs\xF0\u1484f\xBB\u2024il\xF4\u06A9\u0100dr\u21E0\u21E4cy;\u444A\u0180;cw\u08F4\u21EB\u21EFir;\u6948;\u61ADar;\u610Firc;\u4125\u0180alr\u2201\u220E\u2213rts\u0100;u\u2209\u220A\u6665it\xBB\u220Alip;\u6026con;\u62B9r;\uC000\u{1D525}s\u0100ew\u2223\u2229arow;\u6925arow;\u6926\u0280amopr\u223A\u223E\u2243\u225E\u2263rr;\u61FFtht;\u623Bk\u0100lr\u2249\u2253eftarrow;\u61A9ightarrow;\u61AAf;\uC000\u{1D559}bar;\u6015\u0180clt\u226F\u2274\u2278r;\uC000\u{1D4BD}as\xE8\u21F4rok;\u4127\u0100bp\u2282\u2287ull;\u6043hen\xBB\u1C5B\u0AE1\u22A3\0\u22AA\0\u22B8\u22C5\u22CE\0\u22D5\u22F3\0\0\u22F8\u2322\u2367\u2362\u237F\0\u2386\u23AA\u23B4cute\u803B\xED\u40ED\u0180;iy\u0771\u22B0\u22B5rc\u803B\xEE\u40EE;\u4438\u0100cx\u22BC\u22BFy;\u4435cl\u803B\xA1\u40A1\u0100fr\u039F\u22C9;\uC000\u{1D526}rave\u803B\xEC\u40EC\u0200;ino\u073E\u22DD\u22E9\u22EE\u0100in\u22E2\u22E6nt;\u6A0Ct;\u622Dfin;\u69DCta;\u6129lig;\u4133\u0180aop\u22FE\u231A\u231D\u0180cgt\u2305\u2308\u2317r;\u412B\u0180elp\u071F\u230F\u2313in\xE5\u078Ear\xF4\u0720h;\u4131f;\u62B7ed;\u41B5\u0280;cfot\u04F4\u232C\u2331\u233D\u2341are;\u6105in\u0100;t\u2338\u2339\u621Eie;\u69DDdo\xF4\u2319\u0280;celp\u0757\u234C\u2350\u235B\u2361al;\u62BA\u0100gr\u2355\u2359er\xF3\u1563\xE3\u234Darhk;\u6A17rod;\u6A3C\u0200cgpt\u236F\u2372\u2376\u237By;\u4451on;\u412Ff;\uC000\u{1D55A}a;\u43B9uest\u803B\xBF\u40BF\u0100ci\u238A\u238Fr;\uC000\u{1D4BE}n\u0280;Edsv\u04F4\u239B\u239D\u23A1\u04F3;\u62F9ot;\u62F5\u0100;v\u23A6\u23A7\u62F4;\u62F3\u0100;i\u0777\u23AElde;\u4129\u01EB\u23B8\0\u23BCcy;\u4456l\u803B\xEF\u40EF\u0300cfmosu\u23CC\u23D7\u23DC\u23E1\u23E7\u23F5\u0100iy\u23D1\u23D5rc;\u4135;\u4439r;\uC000\u{1D527}ath;\u4237pf;\uC000\u{1D55B}\u01E3\u23EC\0\u23F1r;\uC000\u{1D4BF}rcy;\u4458kcy;\u4454\u0400acfghjos\u240B\u2416\u2422\u2427\u242D\u2431\u2435\u243Bppa\u0100;v\u2413\u2414\u43BA;\u43F0\u0100ey\u241B\u2420dil;\u4137;\u443Ar;\uC000\u{1D528}reen;\u4138cy;\u4445cy;\u445Cpf;\uC000\u{1D55C}cr;\uC000\u{1D4C0}\u0B80ABEHabcdefghjlmnoprstuv\u2470\u2481\u2486\u248D\u2491\u250E\u253D\u255A\u2580\u264E\u265E\u2665\u2679\u267D\u269A\u26B2\u26D8\u275D\u2768\u278B\u27C0\u2801\u2812\u0180art\u2477\u247A\u247Cr\xF2\u09C6\xF2\u0395ail;\u691Barr;\u690E\u0100;g\u0994\u248B;\u6A8Bar;\u6962\u0963\u24A5\0\u24AA\0\u24B1\0\0\0\0\0\u24B5\u24BA\0\u24C6\u24C8\u24CD\0\u24F9ute;\u413Amptyv;\u69B4ra\xEE\u084Cbda;\u43BBg\u0180;dl\u088E\u24C1\u24C3;\u6991\xE5\u088E;\u6A85uo\u803B\xAB\u40ABr\u0400;bfhlpst\u0899\u24DE\u24E6\u24E9\u24EB\u24EE\u24F1\u24F5\u0100;f\u089D\u24E3s;\u691Fs;\u691D\xEB\u2252p;\u61ABl;\u6939im;\u6973l;\u61A2\u0180;ae\u24FF\u2500\u2504\u6AABil;\u6919\u0100;s\u2509\u250A\u6AAD;\uC000\u2AAD\uFE00\u0180abr\u2515\u2519\u251Drr;\u690Crk;\u6772\u0100ak\u2522\u252Cc\u0100ek\u2528\u252A;\u407B;\u405B\u0100es\u2531\u2533;\u698Bl\u0100du\u2539\u253B;\u698F;\u698D\u0200aeuy\u2546\u254B\u2556\u2558ron;\u413E\u0100di\u2550\u2554il;\u413C\xEC\u08B0\xE2\u2529;\u443B\u0200cqrs\u2563\u2566\u256D\u257Da;\u6936uo\u0100;r\u0E19\u1746\u0100du\u2572\u2577har;\u6967shar;\u694Bh;\u61B2\u0280;fgqs\u258B\u258C\u0989\u25F3\u25FF\u6264t\u0280ahlrt\u2598\u25A4\u25B7\u25C2\u25E8rrow\u0100;t\u0899\u25A1a\xE9\u24F6arpoon\u0100du\u25AF\u25B4own\xBB\u045Ap\xBB\u0966eftarrows;\u61C7ight\u0180ahs\u25CD\u25D6\u25DErrow\u0100;s\u08F4\u08A7arpoon\xF3\u0F98quigarro\xF7\u21F0hreetimes;\u62CB\u0180;qs\u258B\u0993\u25FAlan\xF4\u09AC\u0280;cdgs\u09AC\u260A\u260D\u261D\u2628c;\u6AA8ot\u0100;o\u2614\u2615\u6A7F\u0100;r\u261A\u261B\u6A81;\u6A83\u0100;e\u2622\u2625\uC000\u22DA\uFE00s;\u6A93\u0280adegs\u2633\u2639\u263D\u2649\u264Bppro\xF8\u24C6ot;\u62D6q\u0100gq\u2643\u2645\xF4\u0989gt\xF2\u248C\xF4\u099Bi\xED\u09B2\u0180ilr\u2655\u08E1\u265Asht;\u697C;\uC000\u{1D529}\u0100;E\u099C\u2663;\u6A91\u0161\u2669\u2676r\u0100du\u25B2\u266E\u0100;l\u0965\u2673;\u696Alk;\u6584cy;\u4459\u0280;acht\u0A48\u2688\u268B\u2691\u2696r\xF2\u25C1orne\xF2\u1D08ard;\u696Bri;\u65FA\u0100io\u269F\u26A4dot;\u4140ust\u0100;a\u26AC\u26AD\u63B0che\xBB\u26AD\u0200Eaes\u26BB\u26BD\u26C9\u26D4;\u6268p\u0100;p\u26C3\u26C4\u6A89rox\xBB\u26C4\u0100;q\u26CE\u26CF\u6A87\u0100;q\u26CE\u26BBim;\u62E6\u0400abnoptwz\u26E9\u26F4\u26F7\u271A\u272F\u2741\u2747\u2750\u0100nr\u26EE\u26F1g;\u67ECr;\u61FDr\xEB\u08C1g\u0180lmr\u26FF\u270D\u2714eft\u0100ar\u09E6\u2707ight\xE1\u09F2apsto;\u67FCight\xE1\u09FDparrow\u0100lr\u2725\u2729ef\xF4\u24EDight;\u61AC\u0180afl\u2736\u2739\u273Dr;\u6985;\uC000\u{1D55D}us;\u6A2Dimes;\u6A34\u0161\u274B\u274Fst;\u6217\xE1\u134E\u0180;ef\u2757\u2758\u1800\u65CAnge\xBB\u2758ar\u0100;l\u2764\u2765\u4028t;\u6993\u0280achmt\u2773\u2776\u277C\u2785\u2787r\xF2\u08A8orne\xF2\u1D8Car\u0100;d\u0F98\u2783;\u696D;\u600Eri;\u62BF\u0300achiqt\u2798\u279D\u0A40\u27A2\u27AE\u27BBquo;\u6039r;\uC000\u{1D4C1}m\u0180;eg\u09B2\u27AA\u27AC;\u6A8D;\u6A8F\u0100bu\u252A\u27B3o\u0100;r\u0E1F\u27B9;\u601Arok;\u4142\u8400<;cdhilqr\u082B\u27D2\u2639\u27DC\u27E0\u27E5\u27EA\u27F0\u0100ci\u27D7\u27D9;\u6AA6r;\u6A79re\xE5\u25F2mes;\u62C9arr;\u6976uest;\u6A7B\u0100Pi\u27F5\u27F9ar;\u6996\u0180;ef\u2800\u092D\u181B\u65C3r\u0100du\u2807\u280Dshar;\u694Ahar;\u6966\u0100en\u2817\u2821rtneqq;\uC000\u2268\uFE00\xC5\u281E\u0700Dacdefhilnopsu\u2840\u2845\u2882\u288E\u2893\u28A0\u28A5\u28A8\u28DA\u28E2\u28E4\u0A83\u28F3\u2902Dot;\u623A\u0200clpr\u284E\u2852\u2863\u287Dr\u803B\xAF\u40AF\u0100et\u2857\u2859;\u6642\u0100;e\u285E\u285F\u6720se\xBB\u285F\u0100;s\u103B\u2868to\u0200;dlu\u103B\u2873\u2877\u287Bow\xEE\u048Cef\xF4\u090F\xF0\u13D1ker;\u65AE\u0100oy\u2887\u288Cmma;\u6A29;\u443Cash;\u6014asuredangle\xBB\u1626r;\uC000\u{1D52A}o;\u6127\u0180cdn\u28AF\u28B4\u28C9ro\u803B\xB5\u40B5\u0200;acd\u1464\u28BD\u28C0\u28C4s\xF4\u16A7ir;\u6AF0ot\u80BB\xB7\u01B5us\u0180;bd\u28D2\u1903\u28D3\u6212\u0100;u\u1D3C\u28D8;\u6A2A\u0163\u28DE\u28E1p;\u6ADB\xF2\u2212\xF0\u0A81\u0100dp\u28E9\u28EEels;\u62A7f;\uC000\u{1D55E}\u0100ct\u28F8\u28FDr;\uC000\u{1D4C2}pos\xBB\u159D\u0180;lm\u2909\u290A\u290D\u43BCtimap;\u62B8\u0C00GLRVabcdefghijlmoprstuvw\u2942\u2953\u297E\u2989\u2998\u29DA\u29E9\u2A15\u2A1A\u2A58\u2A5D\u2A83\u2A95\u2AA4\u2AA8\u2B04\u2B07\u2B44\u2B7F\u2BAE\u2C34\u2C67\u2C7C\u2CE9\u0100gt\u2947\u294B;\uC000\u22D9\u0338\u0100;v\u2950\u0BCF\uC000\u226B\u20D2\u0180elt\u295A\u2972\u2976ft\u0100ar\u2961\u2967rrow;\u61CDightarrow;\u61CE;\uC000\u22D8\u0338\u0100;v\u297B\u0C47\uC000\u226A\u20D2ightarrow;\u61CF\u0100Dd\u298E\u2993ash;\u62AFash;\u62AE\u0280bcnpt\u29A3\u29A7\u29AC\u29B1\u29CCla\xBB\u02DEute;\u4144g;\uC000\u2220\u20D2\u0280;Eiop\u0D84\u29BC\u29C0\u29C5\u29C8;\uC000\u2A70\u0338d;\uC000\u224B\u0338s;\u4149ro\xF8\u0D84ur\u0100;a\u29D3\u29D4\u666El\u0100;s\u29D3\u0B38\u01F3\u29DF\0\u29E3p\u80BB\xA0\u0B37mp\u0100;e\u0BF9\u0C00\u0280aeouy\u29F4\u29FE\u2A03\u2A10\u2A13\u01F0\u29F9\0\u29FB;\u6A43on;\u4148dil;\u4146ng\u0100;d\u0D7E\u2A0Aot;\uC000\u2A6D\u0338p;\u6A42;\u443Dash;\u6013\u0380;Aadqsx\u0B92\u2A29\u2A2D\u2A3B\u2A41\u2A45\u2A50rr;\u61D7r\u0100hr\u2A33\u2A36k;\u6924\u0100;o\u13F2\u13F0ot;\uC000\u2250\u0338ui\xF6\u0B63\u0100ei\u2A4A\u2A4Ear;\u6928\xED\u0B98ist\u0100;s\u0BA0\u0B9Fr;\uC000\u{1D52B}\u0200Eest\u0BC5\u2A66\u2A79\u2A7C\u0180;qs\u0BBC\u2A6D\u0BE1\u0180;qs\u0BBC\u0BC5\u2A74lan\xF4\u0BE2i\xED\u0BEA\u0100;r\u0BB6\u2A81\xBB\u0BB7\u0180Aap\u2A8A\u2A8D\u2A91r\xF2\u2971rr;\u61AEar;\u6AF2\u0180;sv\u0F8D\u2A9C\u0F8C\u0100;d\u2AA1\u2AA2\u62FC;\u62FAcy;\u445A\u0380AEadest\u2AB7\u2ABA\u2ABE\u2AC2\u2AC5\u2AF6\u2AF9r\xF2\u2966;\uC000\u2266\u0338rr;\u619Ar;\u6025\u0200;fqs\u0C3B\u2ACE\u2AE3\u2AEFt\u0100ar\u2AD4\u2AD9rro\xF7\u2AC1ightarro\xF7\u2A90\u0180;qs\u0C3B\u2ABA\u2AEAlan\xF4\u0C55\u0100;s\u0C55\u2AF4\xBB\u0C36i\xED\u0C5D\u0100;r\u0C35\u2AFEi\u0100;e\u0C1A\u0C25i\xE4\u0D90\u0100pt\u2B0C\u2B11f;\uC000\u{1D55F}\u8180\xAC;in\u2B19\u2B1A\u2B36\u40ACn\u0200;Edv\u0B89\u2B24\u2B28\u2B2E;\uC000\u22F9\u0338ot;\uC000\u22F5\u0338\u01E1\u0B89\u2B33\u2B35;\u62F7;\u62F6i\u0100;v\u0CB8\u2B3C\u01E1\u0CB8\u2B41\u2B43;\u62FE;\u62FD\u0180aor\u2B4B\u2B63\u2B69r\u0200;ast\u0B7B\u2B55\u2B5A\u2B5Flle\xEC\u0B7Bl;\uC000\u2AFD\u20E5;\uC000\u2202\u0338lint;\u6A14\u0180;ce\u0C92\u2B70\u2B73u\xE5\u0CA5\u0100;c\u0C98\u2B78\u0100;e\u0C92\u2B7D\xF1\u0C98\u0200Aait\u2B88\u2B8B\u2B9D\u2BA7r\xF2\u2988rr\u0180;cw\u2B94\u2B95\u2B99\u619B;\uC000\u2933\u0338;\uC000\u219D\u0338ghtarrow\xBB\u2B95ri\u0100;e\u0CCB\u0CD6\u0380chimpqu\u2BBD\u2BCD\u2BD9\u2B04\u0B78\u2BE4\u2BEF\u0200;cer\u0D32\u2BC6\u0D37\u2BC9u\xE5\u0D45;\uC000\u{1D4C3}ort\u026D\u2B05\0\0\u2BD6ar\xE1\u2B56m\u0100;e\u0D6E\u2BDF\u0100;q\u0D74\u0D73su\u0100bp\u2BEB\u2BED\xE5\u0CF8\xE5\u0D0B\u0180bcp\u2BF6\u2C11\u2C19\u0200;Ees\u2BFF\u2C00\u0D22\u2C04\u6284;\uC000\u2AC5\u0338et\u0100;e\u0D1B\u2C0Bq\u0100;q\u0D23\u2C00c\u0100;e\u0D32\u2C17\xF1\u0D38\u0200;Ees\u2C22\u2C23\u0D5F\u2C27\u6285;\uC000\u2AC6\u0338et\u0100;e\u0D58\u2C2Eq\u0100;q\u0D60\u2C23\u0200gilr\u2C3D\u2C3F\u2C45\u2C47\xEC\u0BD7lde\u803B\xF1\u40F1\xE7\u0C43iangle\u0100lr\u2C52\u2C5Ceft\u0100;e\u0C1A\u2C5A\xF1\u0C26ight\u0100;e\u0CCB\u2C65\xF1\u0CD7\u0100;m\u2C6C\u2C6D\u43BD\u0180;es\u2C74\u2C75\u2C79\u4023ro;\u6116p;\u6007\u0480DHadgilrs\u2C8F\u2C94\u2C99\u2C9E\u2CA3\u2CB0\u2CB6\u2CD3\u2CE3ash;\u62ADarr;\u6904p;\uC000\u224D\u20D2ash;\u62AC\u0100et\u2CA8\u2CAC;\uC000\u2265\u20D2;\uC000>\u20D2nfin;\u69DE\u0180Aet\u2CBD\u2CC1\u2CC5rr;\u6902;\uC000\u2264\u20D2\u0100;r\u2CCA\u2CCD\uC000<\u20D2ie;\uC000\u22B4\u20D2\u0100At\u2CD8\u2CDCrr;\u6903rie;\uC000\u22B5\u20D2im;\uC000\u223C\u20D2\u0180Aan\u2CF0\u2CF4\u2D02rr;\u61D6r\u0100hr\u2CFA\u2CFDk;\u6923\u0100;o\u13E7\u13E5ear;\u6927\u1253\u1A95\0\0\0\0\0\0\0\0\0\0\0\0\0\u2D2D\0\u2D38\u2D48\u2D60\u2D65\u2D72\u2D84\u1B07\0\0\u2D8D\u2DAB\0\u2DC8\u2DCE\0\u2DDC\u2E19\u2E2B\u2E3E\u2E43\u0100cs\u2D31\u1A97ute\u803B\xF3\u40F3\u0100iy\u2D3C\u2D45r\u0100;c\u1A9E\u2D42\u803B\xF4\u40F4;\u443E\u0280abios\u1AA0\u2D52\u2D57\u01C8\u2D5Alac;\u4151v;\u6A38old;\u69BClig;\u4153\u0100cr\u2D69\u2D6Dir;\u69BF;\uC000\u{1D52C}\u036F\u2D79\0\0\u2D7C\0\u2D82n;\u42DBave\u803B\xF2\u40F2;\u69C1\u0100bm\u2D88\u0DF4ar;\u69B5\u0200acit\u2D95\u2D98\u2DA5\u2DA8r\xF2\u1A80\u0100ir\u2D9D\u2DA0r;\u69BEoss;\u69BBn\xE5\u0E52;\u69C0\u0180aei\u2DB1\u2DB5\u2DB9cr;\u414Dga;\u43C9\u0180cdn\u2DC0\u2DC5\u01CDron;\u43BF;\u69B6pf;\uC000\u{1D560}\u0180ael\u2DD4\u2DD7\u01D2r;\u69B7rp;\u69B9\u0380;adiosv\u2DEA\u2DEB\u2DEE\u2E08\u2E0D\u2E10\u2E16\u6228r\xF2\u1A86\u0200;efm\u2DF7\u2DF8\u2E02\u2E05\u6A5Dr\u0100;o\u2DFE\u2DFF\u6134f\xBB\u2DFF\u803B\xAA\u40AA\u803B\xBA\u40BAgof;\u62B6r;\u6A56lope;\u6A57;\u6A5B\u0180clo\u2E1F\u2E21\u2E27\xF2\u2E01ash\u803B\xF8\u40F8l;\u6298i\u016C\u2E2F\u2E34de\u803B\xF5\u40F5es\u0100;a\u01DB\u2E3As;\u6A36ml\u803B\xF6\u40F6bar;\u633D\u0AE1\u2E5E\0\u2E7D\0\u2E80\u2E9D\0\u2EA2\u2EB9\0\0\u2ECB\u0E9C\0\u2F13\0\0\u2F2B\u2FBC\0\u2FC8r\u0200;ast\u0403\u2E67\u2E72\u0E85\u8100\xB6;l\u2E6D\u2E6E\u40B6le\xEC\u0403\u0269\u2E78\0\0\u2E7Bm;\u6AF3;\u6AFDy;\u443Fr\u0280cimpt\u2E8B\u2E8F\u2E93\u1865\u2E97nt;\u4025od;\u402Eil;\u6030enk;\u6031r;\uC000\u{1D52D}\u0180imo\u2EA8\u2EB0\u2EB4\u0100;v\u2EAD\u2EAE\u43C6;\u43D5ma\xF4\u0A76ne;\u660E\u0180;tv\u2EBF\u2EC0\u2EC8\u43C0chfork\xBB\u1FFD;\u43D6\u0100au\u2ECF\u2EDFn\u0100ck\u2ED5\u2EDDk\u0100;h\u21F4\u2EDB;\u610E\xF6\u21F4s\u0480;abcdemst\u2EF3\u2EF4\u1908\u2EF9\u2EFD\u2F04\u2F06\u2F0A\u2F0E\u402Bcir;\u6A23ir;\u6A22\u0100ou\u1D40\u2F02;\u6A25;\u6A72n\u80BB\xB1\u0E9Dim;\u6A26wo;\u6A27\u0180ipu\u2F19\u2F20\u2F25ntint;\u6A15f;\uC000\u{1D561}nd\u803B\xA3\u40A3\u0500;Eaceinosu\u0EC8\u2F3F\u2F41\u2F44\u2F47\u2F81\u2F89\u2F92\u2F7E\u2FB6;\u6AB3p;\u6AB7u\xE5\u0ED9\u0100;c\u0ECE\u2F4C\u0300;acens\u0EC8\u2F59\u2F5F\u2F66\u2F68\u2F7Eppro\xF8\u2F43urlye\xF1\u0ED9\xF1\u0ECE\u0180aes\u2F6F\u2F76\u2F7Approx;\u6AB9qq;\u6AB5im;\u62E8i\xED\u0EDFme\u0100;s\u2F88\u0EAE\u6032\u0180Eas\u2F78\u2F90\u2F7A\xF0\u2F75\u0180dfp\u0EEC\u2F99\u2FAF\u0180als\u2FA0\u2FA5\u2FAAlar;\u632Eine;\u6312urf;\u6313\u0100;t\u0EFB\u2FB4\xEF\u0EFBrel;\u62B0\u0100ci\u2FC0\u2FC5r;\uC000\u{1D4C5};\u43C8ncsp;\u6008\u0300fiopsu\u2FDA\u22E2\u2FDF\u2FE5\u2FEB\u2FF1r;\uC000\u{1D52E}pf;\uC000\u{1D562}rime;\u6057cr;\uC000\u{1D4C6}\u0180aeo\u2FF8\u3009\u3013t\u0100ei\u2FFE\u3005rnion\xF3\u06B0nt;\u6A16st\u0100;e\u3010\u3011\u403F\xF1\u1F19\xF4\u0F14\u0A80ABHabcdefhilmnoprstux\u3040\u3051\u3055\u3059\u30E0\u310E\u312B\u3147\u3162\u3172\u318E\u3206\u3215\u3224\u3229\u3258\u326E\u3272\u3290\u32B0\u32B7\u0180art\u3047\u304A\u304Cr\xF2\u10B3\xF2\u03DDail;\u691Car\xF2\u1C65ar;\u6964\u0380cdenqrt\u3068\u3075\u3078\u307F\u308F\u3094\u30CC\u0100eu\u306D\u3071;\uC000\u223D\u0331te;\u4155i\xE3\u116Emptyv;\u69B3g\u0200;del\u0FD1\u3089\u308B\u308D;\u6992;\u69A5\xE5\u0FD1uo\u803B\xBB\u40BBr\u0580;abcfhlpstw\u0FDC\u30AC\u30AF\u30B7\u30B9\u30BC\u30BE\u30C0\u30C3\u30C7\u30CAp;\u6975\u0100;f\u0FE0\u30B4s;\u6920;\u6933s;\u691E\xEB\u225D\xF0\u272El;\u6945im;\u6974l;\u61A3;\u619D\u0100ai\u30D1\u30D5il;\u691Ao\u0100;n\u30DB\u30DC\u6236al\xF3\u0F1E\u0180abr\u30E7\u30EA\u30EEr\xF2\u17E5rk;\u6773\u0100ak\u30F3\u30FDc\u0100ek\u30F9\u30FB;\u407D;\u405D\u0100es\u3102\u3104;\u698Cl\u0100du\u310A\u310C;\u698E;\u6990\u0200aeuy\u3117\u311C\u3127\u3129ron;\u4159\u0100di\u3121\u3125il;\u4157\xEC\u0FF2\xE2\u30FA;\u4440\u0200clqs\u3134\u3137\u313D\u3144a;\u6937dhar;\u6969uo\u0100;r\u020E\u020Dh;\u61B3\u0180acg\u314E\u315F\u0F44l\u0200;ips\u0F78\u3158\u315B\u109Cn\xE5\u10BBar\xF4\u0FA9t;\u65AD\u0180ilr\u3169\u1023\u316Esht;\u697D;\uC000\u{1D52F}\u0100ao\u3177\u3186r\u0100du\u317D\u317F\xBB\u047B\u0100;l\u1091\u3184;\u696C\u0100;v\u318B\u318C\u43C1;\u43F1\u0180gns\u3195\u31F9\u31FCht\u0300ahlrst\u31A4\u31B0\u31C2\u31D8\u31E4\u31EErrow\u0100;t\u0FDC\u31ADa\xE9\u30C8arpoon\u0100du\u31BB\u31BFow\xEE\u317Ep\xBB\u1092eft\u0100ah\u31CA\u31D0rrow\xF3\u0FEAarpoon\xF3\u0551ightarrows;\u61C9quigarro\xF7\u30CBhreetimes;\u62CCg;\u42DAingdotse\xF1\u1F32\u0180ahm\u320D\u3210\u3213r\xF2\u0FEAa\xF2\u0551;\u600Foust\u0100;a\u321E\u321F\u63B1che\xBB\u321Fmid;\u6AEE\u0200abpt\u3232\u323D\u3240\u3252\u0100nr\u3237\u323Ag;\u67EDr;\u61FEr\xEB\u1003\u0180afl\u3247\u324A\u324Er;\u6986;\uC000\u{1D563}us;\u6A2Eimes;\u6A35\u0100ap\u325D\u3267r\u0100;g\u3263\u3264\u4029t;\u6994olint;\u6A12ar\xF2\u31E3\u0200achq\u327B\u3280\u10BC\u3285quo;\u603Ar;\uC000\u{1D4C7}\u0100bu\u30FB\u328Ao\u0100;r\u0214\u0213\u0180hir\u3297\u329B\u32A0re\xE5\u31F8mes;\u62CAi\u0200;efl\u32AA\u1059\u1821\u32AB\u65B9tri;\u69CEluhar;\u6968;\u611E\u0D61\u32D5\u32DB\u32DF\u332C\u3338\u3371\0\u337A\u33A4\0\0\u33EC\u33F0\0\u3428\u3448\u345A\u34AD\u34B1\u34CA\u34F1\0\u3616\0\0\u3633cute;\u415Bqu\xEF\u27BA\u0500;Eaceinpsy\u11ED\u32F3\u32F5\u32FF\u3302\u330B\u330F\u331F\u3326\u3329;\u6AB4\u01F0\u32FA\0\u32FC;\u6AB8on;\u4161u\xE5\u11FE\u0100;d\u11F3\u3307il;\u415Frc;\u415D\u0180Eas\u3316\u3318\u331B;\u6AB6p;\u6ABAim;\u62E9olint;\u6A13i\xED\u1204;\u4441ot\u0180;be\u3334\u1D47\u3335\u62C5;\u6A66\u0380Aacmstx\u3346\u334A\u3357\u335B\u335E\u3363\u336Drr;\u61D8r\u0100hr\u3350\u3352\xEB\u2228\u0100;o\u0A36\u0A34t\u803B\xA7\u40A7i;\u403Bwar;\u6929m\u0100in\u3369\xF0nu\xF3\xF1t;\u6736r\u0100;o\u3376\u2055\uC000\u{1D530}\u0200acoy\u3382\u3386\u3391\u33A0rp;\u666F\u0100hy\u338B\u338Fcy;\u4449;\u4448rt\u026D\u3399\0\0\u339Ci\xE4\u1464ara\xEC\u2E6F\u803B\xAD\u40AD\u0100gm\u33A8\u33B4ma\u0180;fv\u33B1\u33B2\u33B2\u43C3;\u43C2\u0400;deglnpr\u12AB\u33C5\u33C9\u33CE\u33D6\u33DE\u33E1\u33E6ot;\u6A6A\u0100;q\u12B1\u12B0\u0100;E\u33D3\u33D4\u6A9E;\u6AA0\u0100;E\u33DB\u33DC\u6A9D;\u6A9Fe;\u6246lus;\u6A24arr;\u6972ar\xF2\u113D\u0200aeit\u33F8\u3408\u340F\u3417\u0100ls\u33FD\u3404lsetm\xE9\u336Ahp;\u6A33parsl;\u69E4\u0100dl\u1463\u3414e;\u6323\u0100;e\u341C\u341D\u6AAA\u0100;s\u3422\u3423\u6AAC;\uC000\u2AAC\uFE00\u0180flp\u342E\u3433\u3442tcy;\u444C\u0100;b\u3438\u3439\u402F\u0100;a\u343E\u343F\u69C4r;\u633Ff;\uC000\u{1D564}a\u0100dr\u344D\u0402es\u0100;u\u3454\u3455\u6660it\xBB\u3455\u0180csu\u3460\u3479\u349F\u0100au\u3465\u346Fp\u0100;s\u1188\u346B;\uC000\u2293\uFE00p\u0100;s\u11B4\u3475;\uC000\u2294\uFE00u\u0100bp\u347F\u348F\u0180;es\u1197\u119C\u3486et\u0100;e\u1197\u348D\xF1\u119D\u0180;es\u11A8\u11AD\u3496et\u0100;e\u11A8\u349D\xF1\u11AE\u0180;af\u117B\u34A6\u05B0r\u0165\u34AB\u05B1\xBB\u117Car\xF2\u1148\u0200cemt\u34B9\u34BE\u34C2\u34C5r;\uC000\u{1D4C8}tm\xEE\xF1i\xEC\u3415ar\xE6\u11BE\u0100ar\u34CE\u34D5r\u0100;f\u34D4\u17BF\u6606\u0100an\u34DA\u34EDight\u0100ep\u34E3\u34EApsilo\xEE\u1EE0h\xE9\u2EAFs\xBB\u2852\u0280bcmnp\u34FB\u355E\u1209\u358B\u358E\u0480;Edemnprs\u350E\u350F\u3511\u3515\u351E\u3523\u352C\u3531\u3536\u6282;\u6AC5ot;\u6ABD\u0100;d\u11DA\u351Aot;\u6AC3ult;\u6AC1\u0100Ee\u3528\u352A;\u6ACB;\u628Alus;\u6ABFarr;\u6979\u0180eiu\u353D\u3552\u3555t\u0180;en\u350E\u3545\u354Bq\u0100;q\u11DA\u350Feq\u0100;q\u352B\u3528m;\u6AC7\u0100bp\u355A\u355C;\u6AD5;\u6AD3c\u0300;acens\u11ED\u356C\u3572\u3579\u357B\u3326ppro\xF8\u32FAurlye\xF1\u11FE\xF1\u11F3\u0180aes\u3582\u3588\u331Bppro\xF8\u331Aq\xF1\u3317g;\u666A\u0680123;Edehlmnps\u35A9\u35AC\u35AF\u121C\u35B2\u35B4\u35C0\u35C9\u35D5\u35DA\u35DF\u35E8\u35ED\u803B\xB9\u40B9\u803B\xB2\u40B2\u803B\xB3\u40B3;\u6AC6\u0100os\u35B9\u35BCt;\u6ABEub;\u6AD8\u0100;d\u1222\u35C5ot;\u6AC4s\u0100ou\u35CF\u35D2l;\u67C9b;\u6AD7arr;\u697Bult;\u6AC2\u0100Ee\u35E4\u35E6;\u6ACC;\u628Blus;\u6AC0\u0180eiu\u35F4\u3609\u360Ct\u0180;en\u121C\u35FC\u3602q\u0100;q\u1222\u35B2eq\u0100;q\u35E7\u35E4m;\u6AC8\u0100bp\u3611\u3613;\u6AD4;\u6AD6\u0180Aan\u361C\u3620\u362Drr;\u61D9r\u0100hr\u3626\u3628\xEB\u222E\u0100;o\u0A2B\u0A29war;\u692Alig\u803B\xDF\u40DF\u0BE1\u3651\u365D\u3660\u12CE\u3673\u3679\0\u367E\u36C2\0\0\0\0\0\u36DB\u3703\0\u3709\u376C\0\0\0\u3787\u0272\u3656\0\0\u365Bget;\u6316;\u43C4r\xEB\u0E5F\u0180aey\u3666\u366B\u3670ron;\u4165dil;\u4163;\u4442lrec;\u6315r;\uC000\u{1D531}\u0200eiko\u3686\u369D\u36B5\u36BC\u01F2\u368B\0\u3691e\u01004f\u1284\u1281a\u0180;sv\u3698\u3699\u369B\u43B8ym;\u43D1\u0100cn\u36A2\u36B2k\u0100as\u36A8\u36AEppro\xF8\u12C1im\xBB\u12ACs\xF0\u129E\u0100as\u36BA\u36AE\xF0\u12C1rn\u803B\xFE\u40FE\u01EC\u031F\u36C6\u22E7es\u8180\xD7;bd\u36CF\u36D0\u36D8\u40D7\u0100;a\u190F\u36D5r;\u6A31;\u6A30\u0180eps\u36E1\u36E3\u3700\xE1\u2A4D\u0200;bcf\u0486\u36EC\u36F0\u36F4ot;\u6336ir;\u6AF1\u0100;o\u36F9\u36FC\uC000\u{1D565}rk;\u6ADA\xE1\u3362rime;\u6034\u0180aip\u370F\u3712\u3764d\xE5\u1248\u0380adempst\u3721\u374D\u3740\u3751\u3757\u375C\u375Fngle\u0280;dlqr\u3730\u3731\u3736\u3740\u3742\u65B5own\xBB\u1DBBeft\u0100;e\u2800\u373E\xF1\u092E;\u625Cight\u0100;e\u32AA\u374B\xF1\u105Aot;\u65ECinus;\u6A3Alus;\u6A39b;\u69CDime;\u6A3Bezium;\u63E2\u0180cht\u3772\u377D\u3781\u0100ry\u3777\u377B;\uC000\u{1D4C9};\u4446cy;\u445Brok;\u4167\u0100io\u378B\u378Ex\xF4\u1777head\u0100lr\u3797\u37A0eftarro\xF7\u084Fightarrow\xBB\u0F5D\u0900AHabcdfghlmoprstuw\u37D0\u37D3\u37D7\u37E4\u37F0\u37FC\u380E\u381C\u3823\u3834\u3851\u385D\u386B\u38A9\u38CC\u38D2\u38EA\u38F6r\xF2\u03EDar;\u6963\u0100cr\u37DC\u37E2ute\u803B\xFA\u40FA\xF2\u1150r\u01E3\u37EA\0\u37EDy;\u445Eve;\u416D\u0100iy\u37F5\u37FArc\u803B\xFB\u40FB;\u4443\u0180abh\u3803\u3806\u380Br\xF2\u13ADlac;\u4171a\xF2\u13C3\u0100ir\u3813\u3818sht;\u697E;\uC000\u{1D532}rave\u803B\xF9\u40F9\u0161\u3827\u3831r\u0100lr\u382C\u382E\xBB\u0957\xBB\u1083lk;\u6580\u0100ct\u3839\u384D\u026F\u383F\0\0\u384Arn\u0100;e\u3845\u3846\u631Cr\xBB\u3846op;\u630Fri;\u65F8\u0100al\u3856\u385Acr;\u416B\u80BB\xA8\u0349\u0100gp\u3862\u3866on;\u4173f;\uC000\u{1D566}\u0300adhlsu\u114B\u3878\u387D\u1372\u3891\u38A0own\xE1\u13B3arpoon\u0100lr\u3888\u388Cef\xF4\u382Digh\xF4\u382Fi\u0180;hl\u3899\u389A\u389C\u43C5\xBB\u13FAon\xBB\u389Aparrows;\u61C8\u0180cit\u38B0\u38C4\u38C8\u026F\u38B6\0\0\u38C1rn\u0100;e\u38BC\u38BD\u631Dr\xBB\u38BDop;\u630Eng;\u416Fri;\u65F9cr;\uC000\u{1D4CA}\u0180dir\u38D9\u38DD\u38E2ot;\u62F0lde;\u4169i\u0100;f\u3730\u38E8\xBB\u1813\u0100am\u38EF\u38F2r\xF2\u38A8l\u803B\xFC\u40FCangle;\u69A7\u0780ABDacdeflnoprsz\u391C\u391F\u3929\u392D\u39B5\u39B8\u39BD\u39DF\u39E4\u39E8\u39F3\u39F9\u39FD\u3A01\u3A20r\xF2\u03F7ar\u0100;v\u3926\u3927\u6AE8;\u6AE9as\xE8\u03E1\u0100nr\u3932\u3937grt;\u699C\u0380eknprst\u34E3\u3946\u394B\u3952\u395D\u3964\u3996app\xE1\u2415othin\xE7\u1E96\u0180hir\u34EB\u2EC8\u3959op\xF4\u2FB5\u0100;h\u13B7\u3962\xEF\u318D\u0100iu\u3969\u396Dgm\xE1\u33B3\u0100bp\u3972\u3984setneq\u0100;q\u397D\u3980\uC000\u228A\uFE00;\uC000\u2ACB\uFE00setneq\u0100;q\u398F\u3992\uC000\u228B\uFE00;\uC000\u2ACC\uFE00\u0100hr\u399B\u399Fet\xE1\u369Ciangle\u0100lr\u39AA\u39AFeft\xBB\u0925ight\xBB\u1051y;\u4432ash\xBB\u1036\u0180elr\u39C4\u39D2\u39D7\u0180;be\u2DEA\u39CB\u39CFar;\u62BBq;\u625Alip;\u62EE\u0100bt\u39DC\u1468a\xF2\u1469r;\uC000\u{1D533}tr\xE9\u39AEsu\u0100bp\u39EF\u39F1\xBB\u0D1C\xBB\u0D59pf;\uC000\u{1D567}ro\xF0\u0EFBtr\xE9\u39B4\u0100cu\u3A06\u3A0Br;\uC000\u{1D4CB}\u0100bp\u3A10\u3A18n\u0100Ee\u3980\u3A16\xBB\u397En\u0100Ee\u3992\u3A1E\xBB\u3990igzag;\u699A\u0380cefoprs\u3A36\u3A3B\u3A56\u3A5B\u3A54\u3A61\u3A6Airc;\u4175\u0100di\u3A40\u3A51\u0100bg\u3A45\u3A49ar;\u6A5Fe\u0100;q\u15FA\u3A4F;\u6259erp;\u6118r;\uC000\u{1D534}pf;\uC000\u{1D568}\u0100;e\u1479\u3A66at\xE8\u1479cr;\uC000\u{1D4CC}\u0AE3\u178E\u3A87\0\u3A8B\0\u3A90\u3A9B\0\0\u3A9D\u3AA8\u3AAB\u3AAF\0\0\u3AC3\u3ACE\0\u3AD8\u17DC\u17DFtr\xE9\u17D1r;\uC000\u{1D535}\u0100Aa\u3A94\u3A97r\xF2\u03C3r\xF2\u09F6;\u43BE\u0100Aa\u3AA1\u3AA4r\xF2\u03B8r\xF2\u09EBa\xF0\u2713is;\u62FB\u0180dpt\u17A4\u3AB5\u3ABE\u0100fl\u3ABA\u17A9;\uC000\u{1D569}im\xE5\u17B2\u0100Aa\u3AC7\u3ACAr\xF2\u03CEr\xF2\u0A01\u0100cq\u3AD2\u17B8r;\uC000\u{1D4CD}\u0100pt\u17D6\u3ADCr\xE9\u17D4\u0400acefiosu\u3AF0\u3AFD\u3B08\u3B0C\u3B11\u3B15\u3B1B\u3B21c\u0100uy\u3AF6\u3AFBte\u803B\xFD\u40FD;\u444F\u0100iy\u3B02\u3B06rc;\u4177;\u444Bn\u803B\xA5\u40A5r;\uC000\u{1D536}cy;\u4457pf;\uC000\u{1D56A}cr;\uC000\u{1D4CE}\u0100cm\u3B26\u3B29y;\u444El\u803B\xFF\u40FF\u0500acdefhiosw\u3B42\u3B48\u3B54\u3B58\u3B64\u3B69\u3B6D\u3B74\u3B7A\u3B80cute;\u417A\u0100ay\u3B4D\u3B52ron;\u417E;\u4437ot;\u417C\u0100et\u3B5D\u3B61tr\xE6\u155Fa;\u43B6r;\uC000\u{1D537}cy;\u4436grarr;\u61DDpf;\uC000\u{1D56B}cr;\uC000\u{1D4CF}\u0100jn\u3B85\u3B87;\u600Dj;\u600C'.split("").map(t=>t.charCodeAt(0)));var eue=new Uint16Array("\u0200aglq	\x1B\u026D\0\0p;\u4026os;\u4027t;\u403Et;\u403Cuot;\u4022".split("").map(t=>t.charCodeAt(0)));var AH,HFe=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]),DH=(AH=String.fromCodePoint)!==null&&AH!==void 0?AH:function(t){let e="";return t>65535&&(t-=65536,e+=String.fromCharCode(t>>>10&1023|55296),t=56320|t&1023),e+=String.fromCharCode(t),e};function NH(t){var e;return t>=55296&&t<=57343||t>1114111?65533:(e=HFe.get(t))!==null&&e!==void 0?e:t}var Wo;(function(t){t[t.NUM=35]="NUM",t[t.SEMI=59]="SEMI",t[t.EQUALS=61]="EQUALS",t[t.ZERO=48]="ZERO",t[t.NINE=57]="NINE",t[t.LOWER_A=97]="LOWER_A",t[t.LOWER_F=102]="LOWER_F",t[t.LOWER_X=120]="LOWER_X",t[t.LOWER_Z=122]="LOWER_Z",t[t.UPPER_A=65]="UPPER_A",t[t.UPPER_F=70]="UPPER_F",t[t.UPPER_Z=90]="UPPER_Z"})(Wo||(Wo={}));var VFe=32,mg;(function(t){t[t.VALUE_LENGTH=49152]="VALUE_LENGTH",t[t.BRANCH_LENGTH=16256]="BRANCH_LENGTH",t[t.JUMP_TABLE=127]="JUMP_TABLE"})(mg||(mg={}));function LH(t){return t>=Wo.ZERO&&t<=Wo.NINE}function GFe(t){return t>=Wo.UPPER_A&&t<=Wo.UPPER_F||t>=Wo.LOWER_A&&t<=Wo.LOWER_F}function zFe(t){return t>=Wo.UPPER_A&&t<=Wo.UPPER_Z||t>=Wo.LOWER_A&&t<=Wo.LOWER_Z||LH(t)}function $Fe(t){return t===Wo.EQUALS||zFe(t)}var $o;(function(t){t[t.EntityStart=0]="EntityStart",t[t.NumericStart=1]="NumericStart",t[t.NumericDecimal=2]="NumericDecimal",t[t.NumericHex=3]="NumericHex",t[t.NamedEntity=4]="NamedEntity"})($o||($o={}));var qd;(function(t){t[t.Legacy=0]="Legacy",t[t.Strict=1]="Strict",t[t.Attribute=2]="Attribute"})(qd||(qd={}));var M4=class{constructor(e,r,n){this.decodeTree=e,this.emitCodePoint=r,this.errors=n,this.state=$o.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=qd.Strict}startEntity(e){this.decodeMode=e,this.state=$o.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1}write(e,r){switch(this.state){case $o.EntityStart:return e.charCodeAt(r)===Wo.NUM?(this.state=$o.NumericStart,this.consumed+=1,this.stateNumericStart(e,r+1)):(this.state=$o.NamedEntity,this.stateNamedEntity(e,r));case $o.NumericStart:return this.stateNumericStart(e,r);case $o.NumericDecimal:return this.stateNumericDecimal(e,r);case $o.NumericHex:return this.stateNumericHex(e,r);case $o.NamedEntity:return this.stateNamedEntity(e,r)}}stateNumericStart(e,r){return r>=e.length?-1:(e.charCodeAt(r)|VFe)===Wo.LOWER_X?(this.state=$o.NumericHex,this.consumed+=1,this.stateNumericHex(e,r+1)):(this.state=$o.NumericDecimal,this.stateNumericDecimal(e,r))}addToNumericResult(e,r,n,o){if(r!==n){let s=n-r;this.result=this.result*Math.pow(o,s)+parseInt(e.substr(r,s),o),this.consumed+=s}}stateNumericHex(e,r){let n=r;for(;r<e.length;){let o=e.charCodeAt(r);if(LH(o)||GFe(o))r+=1;else return this.addToNumericResult(e,n,r,16),this.emitNumericEntity(o,3)}return this.addToNumericResult(e,n,r,16),-1}stateNumericDecimal(e,r){let n=r;for(;r<e.length;){let o=e.charCodeAt(r);if(LH(o))r+=1;else return this.addToNumericResult(e,n,r,10),this.emitNumericEntity(o,2)}return this.addToNumericResult(e,n,r,10),-1}emitNumericEntity(e,r){var n;if(this.consumed<=r)return(n=this.errors)===null||n===void 0||n.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(e===Wo.SEMI)this.consumed+=1;else if(this.decodeMode===qd.Strict)return 0;return this.emitCodePoint(NH(this.result),this.consumed),this.errors&&(e!==Wo.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed}stateNamedEntity(e,r){let{decodeTree:n}=this,o=n[this.treeIndex],s=(o&mg.VALUE_LENGTH)>>14;for(;r<e.length;r++,this.excess++){let a=e.charCodeAt(r);if(this.treeIndex=WFe(n,o,this.treeIndex+Math.max(1,s),a),this.treeIndex<0)return this.result===0||this.decodeMode===qd.Attribute&&(s===0||$Fe(a))?0:this.emitNotTerminatedNamedEntity();if(o=n[this.treeIndex],s=(o&mg.VALUE_LENGTH)>>14,s!==0){if(a===Wo.SEMI)return this.emitNamedEntityData(this.treeIndex,s,this.consumed+this.excess);this.decodeMode!==qd.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1}emitNotTerminatedNamedEntity(){var e;let{result:r,decodeTree:n}=this,o=(n[r]&mg.VALUE_LENGTH)>>14;return this.emitNamedEntityData(r,o,this.consumed),(e=this.errors)===null||e===void 0||e.missingSemicolonAfterCharacterReference(),this.consumed}emitNamedEntityData(e,r,n){let{decodeTree:o}=this;return this.emitCodePoint(r===1?o[e]&~mg.VALUE_LENGTH:o[e+1],n),r===3&&this.emitCodePoint(o[e+2],n),n}end(){var e;switch(this.state){case $o.NamedEntity:return this.result!==0&&(this.decodeMode!==qd.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case $o.NumericDecimal:return this.emitNumericEntity(0,2);case $o.NumericHex:return this.emitNumericEntity(0,3);case $o.NumericStart:return(e=this.errors)===null||e===void 0||e.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case $o.EntityStart:return 0}}};function tue(t){let e="",r=new M4(t,n=>e+=DH(n));return function(o,s){let a=0,c=0;for(;(c=o.indexOf("&",c))>=0;){e+=o.slice(a,c),r.startEntity(s);let l=r.write(o,c+1);if(l<0){a=c+r.end();break}a=c+l,c=l===0?a+1:a}let u=e+o.slice(a);return e="",u}}function WFe(t,e,r,n){let o=(e&mg.BRANCH_LENGTH)>>7,s=e&mg.JUMP_TABLE;if(o===0)return s!==0&&n===s?r:-1;if(s){let u=n-s;return u<0||u>=o?-1:t[r+u]-1}let a=r,c=a+o-1;for(;a<=c;){let u=a+c>>>1,l=t[u];if(l<n)a=u+1;else if(l>n)c=u-1;else return t[u+o]}return-1}var KFe=tue(Zce),sSt=tue(eue);function hg(t,e=qd.Legacy){return KFe(t,e)}function F4(t){for(let e=1;e<t.length;e++)t[e][0]+=t[e-1][0]+1;return t}var YFe=new Map(F4([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(F4([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(F4([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(F4([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]]));var QFe=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]),XFe=String.prototype.codePointAt!=null?(t,e)=>t.codePointAt(e):(t,e)=>(t.charCodeAt(e)&64512)===55296?(t.charCodeAt(e)-55296)*1024+t.charCodeAt(e+1)-56320+65536:t.charCodeAt(e);function OH(t,e){return function(n){let o,s=0,a="";for(;o=t.exec(n);)s!==o.index&&(a+=n.substring(s,o.index)),a+=e.get(o[0].charCodeAt(0)),s=o.index+1;return a+n.substring(s)}}var rue=OH(/[&<>'"]/g,QFe),nue=OH(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),iue=OH(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]));var oue;(function(t){t[t.XML=0]="XML",t[t.HTML=1]="HTML"})(oue||(oue={}));var sue;(function(t){t[t.UTF8=0]="UTF8",t[t.ASCII=1]="ASCII",t[t.Extensive=2]="Extensive",t[t.Attribute=3]="Attribute",t[t.Text=4]="Text"})(sue||(sue={}));function e6e(t){return Object.prototype.toString.call(t)}function U4(t){return e6e(t)==="[object String]"}var t6e=Object.prototype.hasOwnProperty;function r6e(t,e){return t6e.call(t,e)}function OS(t){return Array.prototype.slice.call(arguments,1).forEach(function(r){if(r){if(typeof r!="object")throw new TypeError(r+"must be object");Object.keys(r).forEach(function(n){t[n]=r[n]})}}),t}function FH(t,e,r){return[].concat(t.slice(0,e),r,t.slice(e+1))}function B4(t){return!(t>=55296&&t<=57343||t>=64976&&t<=65007||(t&65535)===65535||(t&65535)===65534||t>=0&&t<=8||t===11||t>=14&&t<=31||t>=127&&t<=159||t>1114111)}function yk(t){if(t>65535){t-=65536;let e=55296+(t>>10),r=56320+(t&1023);return String.fromCharCode(e,r)}return String.fromCharCode(t)}var uue=/\\([!"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~])/g,n6e=/&([a-z#][a-z0-9]{1,31});/gi,i6e=new RegExp(uue.source+"|"+n6e.source,"gi"),o6e=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))$/i;function s6e(t,e){if(e.charCodeAt(0)===35&&o6e.test(e)){let n=e[1].toLowerCase()==="x"?parseInt(e.slice(2),16):parseInt(e.slice(1),10);return B4(n)?yk(n):t}let r=hg(t);return r!==t?r:t}function a6e(t){return t.indexOf("\\")<0?t:t.replace(uue,"$1")}function gg(t){return t.indexOf("\\")<0&&t.indexOf("&")<0?t:t.replace(i6e,function(e,r,n){return r||s6e(e,n)})}var c6e=/[&<>"]/,u6e=/[&<>"]/g,l6e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function d6e(t){return l6e[t]}function Gf(t){return c6e.test(t)?t.replace(u6e,d6e):t}var p6e=/[.?*+^$[\]\\(){}|-]/g;function f6e(t){return t.replace(p6e,"\\$&")}function xr(t){switch(t){case 9:case 32:return!0}return!1}function ty(t){if(t>=8192&&t<=8202)return!0;switch(t){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return!0}return!1}function ry(t){return LS.test(t)}function ny(t){switch(t){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return!0;default:return!1}}function iy(t){return t=t.trim().replace(/\s+/g," "),"\u1E9E".toLowerCase()==="\u1E7E"&&(t=t.replace(//g,"\xDF")),t.toLowerCase().toUpperCase()}var m6e={mdurl:D4,ucmicro:PH};var HH={};_n(HH,{parseLinkDestination:()=>qH,parseLinkLabel:()=>BH,parseLinkTitle:()=>jH});function BH(t,e,r){let n,o,s,a,c=t.posMax,u=t.pos;for(t.pos=e+1,n=1;t.pos<c;){if(s=t.src.charCodeAt(t.pos),s===93&&(n--,n===0)){o=!0;break}if(a=t.pos,t.md.inline.skipToken(t),s===91){if(a===t.pos-1)n++;else if(r)return t.pos=u,-1}}let l=-1;return o&&(l=t.pos),t.pos=u,l}function qH(t,e,r){let n,o=e,s={ok:!1,pos:0,lines:0,str:""};if(t.charCodeAt(o)===60){for(o++;o<r;){if(n=t.charCodeAt(o),n===10||n===60)return s;if(n===62)return s.pos=o+1,s.str=gg(t.slice(e+1,o)),s.ok=!0,s;if(n===92&&o+1<r){o+=2;continue}o++}return s}let a=0;for(;o<r&&(n=t.charCodeAt(o),!(n===32||n<32||n===127));){if(n===92&&o+1<r){if(t.charCodeAt(o+1)===32)break;o+=2;continue}if(n===40&&(a++,a>32))return s;if(n===41){if(a===0)break;a--}o++}return e===o||a!==0||(s.str=gg(t.slice(e,o)),s.pos=o,s.ok=!0),s}function jH(t,e,r){let n,o,s=0,a=e,c={ok:!1,pos:0,lines:0,str:""};if(a>=r||(o=t.charCodeAt(a),o!==34&&o!==39&&o!==40))return c;for(a++,o===40&&(o=41);a<r;){if(n=t.charCodeAt(a),n===o)return c.pos=a+1,c.lines=s,c.str=gg(t.slice(e+1,a)),c.ok=!0,c;if(n===40&&o===41)return c;n===10?s++:n===92&&a+1<r&&(a++,t.charCodeAt(a)===10&&s++),a++}return c}var jd={};jd.code_inline=function(t,e,r,n,o){let s=t[e];return"<code"+o.renderAttrs(s)+">"+Gf(s.content)+"</code>"};jd.code_block=function(t,e,r,n,o){let s=t[e];return"<pre"+o.renderAttrs(s)+"><code>"+Gf(t[e].content)+`</code></pre>
`};jd.fence=function(t,e,r,n,o){let s=t[e],a=s.info?gg(s.info).trim():"",c="",u="";if(a){let d=a.split(/(\s+)/g);c=d[0],u=d.slice(2).join("")}let l;if(r.highlight?l=r.highlight(s.content,c,u)||Gf(s.content):l=Gf(s.content),l.indexOf("<pre")===0)return l+`
`;if(a){let d=s.attrIndex("class"),p=s.attrs?s.attrs.slice():[];d<0?p.push(["class",r.langPrefix+c]):(p[d]=p[d].slice(),p[d][1]+=" "+r.langPrefix+c);let f={attrs:p};return`<pre><code${o.renderAttrs(f)}>${l}</code></pre>
`}return`<pre><code${o.renderAttrs(s)}>${l}</code></pre>
`};jd.image=function(t,e,r,n,o){let s=t[e];return s.attrs[s.attrIndex("alt")][1]=o.renderInlineAsText(s.children,r,n),o.renderToken(t,e,r)};jd.hardbreak=function(t,e,r){return r.xhtmlOut?`<br />
`:`<br>
`};jd.softbreak=function(t,e,r){return r.breaks?r.xhtmlOut?`<br />
`:`<br>
`:`
`};jd.text=function(t,e){return Gf(t[e].content)};jd.html_block=function(t,e){return t[e].content};jd.html_inline=function(t,e){return t[e].content};function MS(){this.rules=OS({},jd)}MS.prototype.renderAttrs=function(e){let r,n,o;if(!e.attrs)return"";for(o="",r=0,n=e.attrs.length;r<n;r++)o+=" "+Gf(e.attrs[r][0])+'="'+Gf(e.attrs[r][1])+'"';return o};MS.prototype.renderToken=function(e,r,n){let o=e[r],s="";if(o.hidden)return"";o.block&&o.nesting!==-1&&r&&e[r-1].hidden&&(s+=`
`),s+=(o.nesting===-1?"</":"<")+o.tag,s+=this.renderAttrs(o),o.nesting===0&&n.xhtmlOut&&(s+=" /");let a=!1;if(o.block&&(a=!0,o.nesting===1&&r+1<e.length)){let c=e[r+1];(c.type==="inline"||c.hidden||c.nesting===-1&&c.tag===o.tag)&&(a=!1)}return s+=a?`>
`:">",s};MS.prototype.renderInline=function(t,e,r){let n="",o=this.rules;for(let s=0,a=t.length;s<a;s++){let c=t[s].type;typeof o[c]<"u"?n+=o[c](t,s,e,r,this):n+=this.renderToken(t,s,e)}return n};MS.prototype.renderInlineAsText=function(t,e,r){let n="";for(let o=0,s=t.length;o<s;o++)switch(t[o].type){case"text":n+=t[o].content;break;case"image":n+=this.renderInlineAsText(t[o].children,e,r);break;case"html_inline":case"html_block":n+=t[o].content;break;case"softbreak":case"hardbreak":n+=`
`;break;default:}return n};MS.prototype.render=function(t,e,r){let n="",o=this.rules;for(let s=0,a=t.length;s<a;s++){let c=t[s].type;c==="inline"?n+=this.renderInline(t[s].children,e,r):typeof o[c]<"u"?n+=o[c](t,s,e,r,this):n+=this.renderToken(t,s,e,r)}return n};var lue=MS;function Dl(){this.__rules__=[],this.__cache__=null}Dl.prototype.__find__=function(t){for(let e=0;e<this.__rules__.length;e++)if(this.__rules__[e].name===t)return e;return-1};Dl.prototype.__compile__=function(){let t=this,e=[""];t.__rules__.forEach(function(r){r.enabled&&r.alt.forEach(function(n){e.indexOf(n)<0&&e.push(n)})}),t.__cache__={},e.forEach(function(r){t.__cache__[r]=[],t.__rules__.forEach(function(n){n.enabled&&(r&&n.alt.indexOf(r)<0||t.__cache__[r].push(n.fn))})})};Dl.prototype.at=function(t,e,r){let n=this.__find__(t),o=r||{};if(n===-1)throw new Error("Parser rule not found: "+t);this.__rules__[n].fn=e,this.__rules__[n].alt=o.alt||[],this.__cache__=null};Dl.prototype.before=function(t,e,r,n){let o=this.__find__(t),s=n||{};if(o===-1)throw new Error("Parser rule not found: "+t);this.__rules__.splice(o,0,{name:e,enabled:!0,fn:r,alt:s.alt||[]}),this.__cache__=null};Dl.prototype.after=function(t,e,r,n){let o=this.__find__(t),s=n||{};if(o===-1)throw new Error("Parser rule not found: "+t);this.__rules__.splice(o+1,0,{name:e,enabled:!0,fn:r,alt:s.alt||[]}),this.__cache__=null};Dl.prototype.push=function(t,e,r){let n=r||{};this.__rules__.push({name:t,enabled:!0,fn:e,alt:n.alt||[]}),this.__cache__=null};Dl.prototype.enable=function(t,e){Array.isArray(t)||(t=[t]);let r=[];return t.forEach(function(n){let o=this.__find__(n);if(o<0){if(e)return;throw new Error("Rules manager: invalid rule name "+n)}this.__rules__[o].enabled=!0,r.push(n)},this),this.__cache__=null,r};Dl.prototype.enableOnly=function(t,e){Array.isArray(t)||(t=[t]),this.__rules__.forEach(function(r){r.enabled=!1}),this.enable(t,e)};Dl.prototype.disable=function(t,e){Array.isArray(t)||(t=[t]);let r=[];return t.forEach(function(n){let o=this.__find__(n);if(o<0){if(e)return;throw new Error("Rules manager: invalid rule name "+n)}this.__rules__[o].enabled=!1,r.push(n)},this),this.__cache__=null,r};Dl.prototype.getRules=function(t){return this.__cache__===null&&this.__compile__(),this.__cache__[t]||[]};var oy=Dl;function FS(t,e,r){this.type=t,this.tag=e,this.attrs=null,this.map=null,this.nesting=r,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}FS.prototype.attrIndex=function(e){if(!this.attrs)return-1;let r=this.attrs;for(let n=0,o=r.length;n<o;n++)if(r[n][0]===e)return n;return-1};FS.prototype.attrPush=function(e){this.attrs?this.attrs.push(e):this.attrs=[e]};FS.prototype.attrSet=function(e,r){let n=this.attrIndex(e),o=[e,r];n<0?this.attrPush(o):this.attrs[n]=o};FS.prototype.attrGet=function(e){let r=this.attrIndex(e),n=null;return r>=0&&(n=this.attrs[r][1]),n};FS.prototype.attrJoin=function(e,r){let n=this.attrIndex(e);n<0?this.attrPush([e,r]):this.attrs[n][1]=this.attrs[n][1]+" "+r};var zf=FS;function due(t,e,r){this.src=t,this.env=r,this.tokens=[],this.inlineMode=!1,this.md=e}due.prototype.Token=zf;var pue=due;var h6e=/\r\n?|\n/g,g6e=/\0/g;function VH(t){let e;e=t.src.replace(h6e,`
`),e=e.replace(g6e,"\uFFFD"),t.src=e}function GH(t){let e;t.inlineMode?(e=new t.Token("inline","",0),e.content=t.src,e.map=[0,1],e.children=[],t.tokens.push(e)):t.md.block.parse(t.src,t.md,t.env,t.tokens)}function zH(t){let e=t.tokens;for(let r=0,n=e.length;r<n;r++){let o=e[r];o.type==="inline"&&t.md.inline.parse(o.content,t.md,t.env,o.children)}}function v6e(t){return/^<a[>\s]/i.test(t)}function b6e(t){return/^<\/a\s*>/i.test(t)}function $H(t){let e=t.tokens;if(t.md.options.linkify)for(let r=0,n=e.length;r<n;r++){if(e[r].type!=="inline"||!t.md.linkify.pretest(e[r].content))continue;let o=e[r].children,s=0;for(let a=o.length-1;a>=0;a--){let c=o[a];if(c.type==="link_close"){for(a--;o[a].level!==c.level&&o[a].type!=="link_open";)a--;continue}if(c.type==="html_inline"&&(v6e(c.content)&&s>0&&s--,b6e(c.content)&&s++),!(s>0)&&c.type==="text"&&t.md.linkify.test(c.content)){let u=c.content,l=t.md.linkify.match(u),d=[],p=c.level,f=0;l.length>0&&l[0].index===0&&a>0&&o[a-1].type==="text_special"&&(l=l.slice(1));for(let m=0;m<l.length;m++){let h=l[m].url,g=t.md.normalizeLink(h);if(!t.md.validateLink(g))continue;let v=l[m].text;l[m].schema?l[m].schema==="mailto:"&&!/^mailto:/i.test(v)?v=t.md.normalizeLinkText("mailto:"+v).replace(/^mailto:/,""):v=t.md.normalizeLinkText(v):v=t.md.normalizeLinkText("http://"+v).replace(/^http:\/\//,"");let y=l[m].index;if(y>f){let I=new t.Token("text","",0);I.content=u.slice(f,y),I.level=p,d.push(I)}let _=new t.Token("link_open","a",1);_.attrs=[["href",g]],_.level=p++,_.markup="linkify",_.info="auto",d.push(_);let x=new t.Token("text","",0);x.content=v,x.level=p,d.push(x);let S=new t.Token("link_close","a",-1);S.level=--p,S.markup="linkify",S.info="auto",d.push(S),f=l[m].lastIndex}if(f<u.length){let m=new t.Token("text","",0);m.content=u.slice(f),m.level=p,d.push(m)}e[r].children=o=FH(o,a,d)}}}}var fue=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,y6e=/\((c|tm|r)\)/i,_6e=/\((c|tm|r)\)/ig,x6e={c:"\xA9",r:"\xAE",tm:"\u2122"};function S6e(t,e){return x6e[e.toLowerCase()]}function I6e(t){let e=0;for(let r=t.length-1;r>=0;r--){let n=t[r];n.type==="text"&&!e&&(n.content=n.content.replace(_6e,S6e)),n.type==="link_open"&&n.info==="auto"&&e--,n.type==="link_close"&&n.info==="auto"&&e++}}function C6e(t){let e=0;for(let r=t.length-1;r>=0;r--){let n=t[r];n.type==="text"&&!e&&fue.test(n.content)&&(n.content=n.content.replace(/\+-/g,"\xB1").replace(/\.{2,}/g,"\u2026").replace(/([?!])/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---(?=[^-]|$)/mg,"$1\u2014").replace(/(^|\s)--(?=\s|$)/mg,"$1\u2013").replace(/(^|[^-\s])--(?=[^-\s]|$)/mg,"$1\u2013")),n.type==="link_open"&&n.info==="auto"&&e--,n.type==="link_close"&&n.info==="auto"&&e++}}function WH(t){let e;if(t.md.options.typographer)for(e=t.tokens.length-1;e>=0;e--)t.tokens[e].type==="inline"&&(y6e.test(t.tokens[e].content)&&I6e(t.tokens[e].children),fue.test(t.tokens[e].content)&&C6e(t.tokens[e].children))}var T6e=/['"]/,mue=/['"]/g,hue="\u2019";function q4(t,e,r){return t.slice(0,e)+r+t.slice(e+1)}function E6e(t,e){let r,n=[];for(let o=0;o<t.length;o++){let s=t[o],a=t[o].level;for(r=n.length-1;r>=0&&!(n[r].level<=a);r--);if(n.length=r+1,s.type!=="text")continue;let c=s.content,u=0,l=c.length;e:for(;u<l;){mue.lastIndex=u;let d=mue.exec(c);if(!d)break;let p=!0,f=!0;u=d.index+1;let m=d[0]==="'",h=32;if(d.index-1>=0)h=c.charCodeAt(d.index-1);else for(r=o-1;r>=0&&!(t[r].type==="softbreak"||t[r].type==="hardbreak");r--)if(t[r].content){h=t[r].content.charCodeAt(t[r].content.length-1);break}let g=32;if(u<l)g=c.charCodeAt(u);else for(r=o+1;r<t.length&&!(t[r].type==="softbreak"||t[r].type==="hardbreak");r++)if(t[r].content){g=t[r].content.charCodeAt(0);break}let v=ny(h)||ry(String.fromCharCode(h)),y=ny(g)||ry(String.fromCharCode(g)),_=ty(h),x=ty(g);if(x?p=!1:y&&(_||v||(p=!1)),_?f=!1:v&&(x||y||(f=!1)),g===34&&d[0]==='"'&&h>=48&&h<=57&&(f=p=!1),p&&f&&(p=v,f=y),!p&&!f){m&&(s.content=q4(s.content,d.index,hue));continue}if(f)for(r=n.length-1;r>=0;r--){let S=n[r];if(n[r].level<a)break;if(S.single===m&&n[r].level===a){S=n[r];let I,E;m?(I=e.md.options.quotes[2],E=e.md.options.quotes[3]):(I=e.md.options.quotes[0],E=e.md.options.quotes[1]),s.content=q4(s.content,d.index,E),t[S.token].content=q4(t[S.token].content,S.pos,I),u+=E.length-1,S.token===o&&(u+=I.length-1),c=s.content,l=c.length,n.length=r;continue e}}p?n.push({token:o,pos:d.index,single:m,level:a}):f&&m&&(s.content=q4(s.content,d.index,hue))}}}function KH(t){if(t.md.options.typographer)for(let e=t.tokens.length-1;e>=0;e--)t.tokens[e].type!=="inline"||!T6e.test(t.tokens[e].content)||E6e(t.tokens[e].children,t)}function YH(t){let e,r,n=t.tokens,o=n.length;for(let s=0;s<o;s++){if(n[s].type!=="inline")continue;let a=n[s].children,c=a.length;for(e=0;e<c;e++)a[e].type==="text_special"&&(a[e].type="text");for(e=r=0;e<c;e++)a[e].type==="text"&&e+1<c&&a[e+1].type==="text"?a[e+1].content=a[e].content+a[e+1].content:(e!==r&&(a[r]=a[e]),r++);e!==r&&(a.length=r)}}var QH=[["normalize",VH],["block",GH],["inline",zH],["linkify",$H],["replacements",WH],["smartquotes",KH],["text_join",YH]];function XH(){this.ruler=new oy;for(let t=0;t<QH.length;t++)this.ruler.push(QH[t][0],QH[t][1])}XH.prototype.process=function(t){let e=this.ruler.getRules("");for(let r=0,n=e.length;r<n;r++)e[r](t)};XH.prototype.State=pue;var gue=XH;function Hd(t,e,r,n){this.src=t,this.md=e,this.env=r,this.tokens=n,this.bMarks=[],this.eMarks=[],this.tShift=[],this.sCount=[],this.bsCount=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.ddIndent=-1,this.listIndent=-1,this.parentType="root",this.level=0;let o=this.src;for(let s=0,a=0,c=0,u=0,l=o.length,d=!1;a<l;a++){let p=o.charCodeAt(a);if(!d)if(xr(p)){c++,p===9?u+=4-u%4:u++;continue}else d=!0;(p===10||a===l-1)&&(p!==10&&a++,this.bMarks.push(s),this.eMarks.push(a),this.tShift.push(c),this.sCount.push(u),this.bsCount.push(0),d=!1,c=0,u=0,s=a+1)}this.bMarks.push(o.length),this.eMarks.push(o.length),this.tShift.push(0),this.sCount.push(0),this.bsCount.push(0),this.lineMax=this.bMarks.length-1}Hd.prototype.push=function(t,e,r){let n=new zf(t,e,r);return n.block=!0,r<0&&this.level--,n.level=this.level,r>0&&this.level++,this.tokens.push(n),n};Hd.prototype.isEmpty=function(e){return this.bMarks[e]+this.tShift[e]>=this.eMarks[e]};Hd.prototype.skipEmptyLines=function(e){for(let r=this.lineMax;e<r&&!(this.bMarks[e]+this.tShift[e]<this.eMarks[e]);e++);return e};Hd.prototype.skipSpaces=function(e){for(let r=this.src.length;e<r;e++){let n=this.src.charCodeAt(e);if(!xr(n))break}return e};Hd.prototype.skipSpacesBack=function(e,r){if(e<=r)return e;for(;e>r;)if(!xr(this.src.charCodeAt(--e)))return e+1;return e};Hd.prototype.skipChars=function(e,r){for(let n=this.src.length;e<n&&this.src.charCodeAt(e)===r;e++);return e};Hd.prototype.skipCharsBack=function(e,r,n){if(e<=n)return e;for(;e>n;)if(r!==this.src.charCodeAt(--e))return e+1;return e};Hd.prototype.getLines=function(e,r,n,o){if(e>=r)return"";let s=new Array(r-e);for(let a=0,c=e;c<r;c++,a++){let u=0,l=this.bMarks[c],d=l,p;for(c+1<r||o?p=this.eMarks[c]+1:p=this.eMarks[c];d<p&&u<n;){let f=this.src.charCodeAt(d);if(xr(f))f===9?u+=4-(u+this.bsCount[c])%4:u++;else if(d-l<this.tShift[c])u++;else break;d++}u>n?s[a]=new Array(u-n+1).join(" ")+this.src.slice(d,p):s[a]=this.src.slice(d,p)}return s.join("")};Hd.prototype.Token=zf;var vue=Hd;function JH(t,e){let r=t.bMarks[e]+t.tShift[e],n=t.eMarks[e];return t.src.slice(r,n)}function bue(t){let e=[],r=t.length,n=0,o=t.charCodeAt(n),s=!1,a=0,c="";for(;n<r;)o===124&&(s?(c+=t.substring(a,n-1),a=n):(e.push(c+t.substring(a,n)),c="",a=n+1)),s=o===92,n++,o=t.charCodeAt(n);return e.push(c+t.substring(a)),e}function ZH(t,e,r,n){if(e+2>r)return!1;let o=e+1;if(t.sCount[o]<t.blkIndent||t.sCount[o]-t.blkIndent>=4)return!1;let s=t.bMarks[o]+t.tShift[o];if(s>=t.eMarks[o])return!1;let a=t.src.charCodeAt(s++);if(a!==124&&a!==45&&a!==58||s>=t.eMarks[o])return!1;let c=t.src.charCodeAt(s++);if(c!==124&&c!==45&&c!==58&&!xr(c)||a===45&&xr(c))return!1;for(;s<t.eMarks[o];){let x=t.src.charCodeAt(s);if(x!==124&&x!==45&&x!==58&&!xr(x))return!1;s++}let u=JH(t,e+1),l=u.split("|"),d=[];for(let x=0;x<l.length;x++){let S=l[x].trim();if(!S){if(x===0||x===l.length-1)continue;return!1}if(!/^:?-+:?$/.test(S))return!1;S.charCodeAt(S.length-1)===58?d.push(S.charCodeAt(0)===58?"center":"right"):S.charCodeAt(0)===58?d.push("left"):d.push("")}if(u=JH(t,e).trim(),u.indexOf("|")===-1||t.sCount[e]-t.blkIndent>=4)return!1;l=bue(u),l.length&&l[0]===""&&l.shift(),l.length&&l[l.length-1]===""&&l.pop();let p=l.length;if(p===0||p!==d.length)return!1;if(n)return!0;let f=t.parentType;t.parentType="table";let m=t.md.block.ruler.getRules("blockquote"),h=t.push("table_open","table",1),g=[e,0];h.map=g;let v=t.push("thead_open","thead",1);v.map=[e,e+1];let y=t.push("tr_open","tr",1);y.map=[e,e+1];for(let x=0;x<l.length;x++){let S=t.push("th_open","th",1);d[x]&&(S.attrs=[["style","text-align:"+d[x]]]);let I=t.push("inline","",0);I.content=l[x].trim(),I.children=[],t.push("th_close","th",-1)}t.push("tr_close","tr",-1),t.push("thead_close","thead",-1);let _;for(o=e+2;o<r&&!(t.sCount[o]<t.blkIndent);o++){let x=!1;for(let I=0,E=m.length;I<E;I++)if(m[I](t,o,r,!0)){x=!0;break}if(x||(u=JH(t,o).trim(),!u)||t.sCount[o]-t.blkIndent>=4)break;if(l=bue(u),l.length&&l[0]===""&&l.shift(),l.length&&l[l.length-1]===""&&l.pop(),o===e+2){let I=t.push("tbody_open","tbody",1);I.map=_=[e+2,0]}let S=t.push("tr_open","tr",1);S.map=[o,o+1];for(let I=0;I<p;I++){let E=t.push("td_open","td",1);d[I]&&(E.attrs=[["style","text-align:"+d[I]]]);let R=t.push("inline","",0);R.content=l[I]?l[I].trim():"",R.children=[],t.push("td_close","td",-1)}t.push("tr_close","tr",-1)}return _&&(t.push("tbody_close","tbody",-1),_[1]=o),t.push("table_close","table",-1),g[1]=o,t.parentType=f,t.line=o,!0}function eV(t,e,r){if(t.sCount[e]-t.blkIndent<4)return!1;let n=e+1,o=n;for(;n<r;){if(t.isEmpty(n)){n++;continue}if(t.sCount[n]-t.blkIndent>=4){n++,o=n;continue}break}t.line=o;let s=t.push("code_block","code",0);return s.content=t.getLines(e,o,4+t.blkIndent,!1)+`
`,s.map=[e,t.line],!0}function tV(t,e,r,n){let o=t.bMarks[e]+t.tShift[e],s=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4||o+3>s)return!1;let a=t.src.charCodeAt(o);if(a!==126&&a!==96)return!1;let c=o;o=t.skipChars(o,a);let u=o-c;if(u<3)return!1;let l=t.src.slice(c,o),d=t.src.slice(o,s);if(a===96&&d.indexOf(String.fromCharCode(a))>=0)return!1;if(n)return!0;let p=e,f=!1;for(;p++,!(p>=r||(o=c=t.bMarks[p]+t.tShift[p],s=t.eMarks[p],o<s&&t.sCount[p]<t.blkIndent));)if(t.src.charCodeAt(o)===a&&!(t.sCount[p]-t.blkIndent>=4)&&(o=t.skipChars(o,a),!(o-c<u)&&(o=t.skipSpaces(o),!(o<s)))){f=!0;break}u=t.sCount[e],t.line=p+(f?1:0);let m=t.push("fence","code",0);return m.info=d,m.content=t.getLines(e+1,p,u,!0),m.markup=l,m.map=[e,t.line],!0}function rV(t,e,r,n){let o=t.bMarks[e]+t.tShift[e],s=t.eMarks[e],a=t.lineMax;if(t.sCount[e]-t.blkIndent>=4||t.src.charCodeAt(o)!==62)return!1;if(n)return!0;let c=[],u=[],l=[],d=[],p=t.md.block.ruler.getRules("blockquote"),f=t.parentType;t.parentType="blockquote";let m=!1,h;for(h=e;h<r;h++){let x=t.sCount[h]<t.blkIndent;if(o=t.bMarks[h]+t.tShift[h],s=t.eMarks[h],o>=s)break;if(t.src.charCodeAt(o++)===62&&!x){let I=t.sCount[h]+1,E,R;t.src.charCodeAt(o)===32?(o++,I++,R=!1,E=!0):t.src.charCodeAt(o)===9?(E=!0,(t.bsCount[h]+I)%4===3?(o++,I++,R=!1):R=!0):E=!1;let B=I;for(c.push(t.bMarks[h]),t.bMarks[h]=o;o<s;){let V=t.src.charCodeAt(o);if(xr(V))V===9?B+=4-(B+t.bsCount[h]+(R?1:0))%4:B++;else break;o++}m=o>=s,u.push(t.bsCount[h]),t.bsCount[h]=t.sCount[h]+1+(E?1:0),l.push(t.sCount[h]),t.sCount[h]=B-I,d.push(t.tShift[h]),t.tShift[h]=o-t.bMarks[h];continue}if(m)break;let S=!1;for(let I=0,E=p.length;I<E;I++)if(p[I](t,h,r,!0)){S=!0;break}if(S){t.lineMax=h,t.blkIndent!==0&&(c.push(t.bMarks[h]),u.push(t.bsCount[h]),d.push(t.tShift[h]),l.push(t.sCount[h]),t.sCount[h]-=t.blkIndent);break}c.push(t.bMarks[h]),u.push(t.bsCount[h]),d.push(t.tShift[h]),l.push(t.sCount[h]),t.sCount[h]=-1}let g=t.blkIndent;t.blkIndent=0;let v=t.push("blockquote_open","blockquote",1);v.markup=">";let y=[e,0];v.map=y,t.md.block.tokenize(t,e,h);let _=t.push("blockquote_close","blockquote",-1);_.markup=">",t.lineMax=a,t.parentType=f,y[1]=t.line;for(let x=0;x<d.length;x++)t.bMarks[x+e]=c[x],t.tShift[x+e]=d[x],t.sCount[x+e]=l[x],t.bsCount[x+e]=u[x];return t.blkIndent=g,!0}function nV(t,e,r,n){let o=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4)return!1;let s=t.bMarks[e]+t.tShift[e],a=t.src.charCodeAt(s++);if(a!==42&&a!==45&&a!==95)return!1;let c=1;for(;s<o;){let l=t.src.charCodeAt(s++);if(l!==a&&!xr(l))return!1;l===a&&c++}if(c<3)return!1;if(n)return!0;t.line=e+1;let u=t.push("hr","hr",0);return u.map=[e,t.line],u.markup=Array(c+1).join(String.fromCharCode(a)),!0}function yue(t,e){let r=t.eMarks[e],n=t.bMarks[e]+t.tShift[e],o=t.src.charCodeAt(n++);if(o!==42&&o!==45&&o!==43)return-1;if(n<r){let s=t.src.charCodeAt(n);if(!xr(s))return-1}return n}function _ue(t,e){let r=t.bMarks[e]+t.tShift[e],n=t.eMarks[e],o=r;if(o+1>=n)return-1;let s=t.src.charCodeAt(o++);if(s<48||s>57)return-1;for(;;){if(o>=n)return-1;if(s=t.src.charCodeAt(o++),s>=48&&s<=57){if(o-r>=10)return-1;continue}if(s===41||s===46)break;return-1}return o<n&&(s=t.src.charCodeAt(o),!xr(s))?-1:o}function w6e(t,e){let r=t.level+2;for(let n=e+2,o=t.tokens.length-2;n<o;n++)t.tokens[n].level===r&&t.tokens[n].type==="paragraph_open"&&(t.tokens[n+2].hidden=!0,t.tokens[n].hidden=!0,n+=2)}function iV(t,e,r,n){let o,s,a,c,u=e,l=!0;if(t.sCount[u]-t.blkIndent>=4||t.listIndent>=0&&t.sCount[u]-t.listIndent>=4&&t.sCount[u]<t.blkIndent)return!1;let d=!1;n&&t.parentType==="paragraph"&&t.sCount[u]>=t.blkIndent&&(d=!0);let p,f,m;if((m=_ue(t,u))>=0){if(p=!0,a=t.bMarks[u]+t.tShift[u],f=Number(t.src.slice(a,m-1)),d&&f!==1)return!1}else if((m=yue(t,u))>=0)p=!1;else return!1;if(d&&t.skipSpaces(m)>=t.eMarks[u])return!1;if(n)return!0;let h=t.src.charCodeAt(m-1),g=t.tokens.length;p?(c=t.push("ordered_list_open","ol",1),f!==1&&(c.attrs=[["start",f]])):c=t.push("bullet_list_open","ul",1);let v=[u,0];c.map=v,c.markup=String.fromCharCode(h);let y=!1,_=t.md.block.ruler.getRules("list"),x=t.parentType;for(t.parentType="list";u<r;){s=m,o=t.eMarks[u];let S=t.sCount[u]+m-(t.bMarks[u]+t.tShift[u]),I=S;for(;s<o;){let k=t.src.charCodeAt(s);if(k===9)I+=4-(I+t.bsCount[u])%4;else if(k===32)I++;else break;s++}let E=s,R;E>=o?R=1:R=I-S,R>4&&(R=1);let B=S+R;c=t.push("list_item_open","li",1),c.markup=String.fromCharCode(h);let V=[u,0];c.map=V,p&&(c.info=t.src.slice(a,m-1));let M=t.tight,le=t.tShift[u],ne=t.sCount[u],q=t.listIndent;if(t.listIndent=t.blkIndent,t.blkIndent=B,t.tight=!0,t.tShift[u]=E-t.bMarks[u],t.sCount[u]=I,E>=o&&t.isEmpty(u+1)?t.line=Math.min(t.line+2,r):t.md.block.tokenize(t,u,r,!0),(!t.tight||y)&&(l=!1),y=t.line-u>1&&t.isEmpty(t.line-1),t.blkIndent=t.listIndent,t.listIndent=q,t.tShift[u]=le,t.sCount[u]=ne,t.tight=M,c=t.push("list_item_close","li",-1),c.markup=String.fromCharCode(h),u=t.line,V[1]=u,u>=r||t.sCount[u]<t.blkIndent||t.sCount[u]-t.blkIndent>=4)break;let P=!1;for(let k=0,U=_.length;k<U;k++)if(_[k](t,u,r,!0)){P=!0;break}if(P)break;if(p){if(m=_ue(t,u),m<0)break;a=t.bMarks[u]+t.tShift[u]}else if(m=yue(t,u),m<0)break;if(h!==t.src.charCodeAt(m-1))break}return p?c=t.push("ordered_list_close","ol",-1):c=t.push("bullet_list_close","ul",-1),c.markup=String.fromCharCode(h),v[1]=u,t.line=u,t.parentType=x,l&&w6e(t,g),!0}function oV(t,e,r,n){let o=0,s=t.bMarks[e]+t.tShift[e],a=t.eMarks[e],c=e+1;if(t.sCount[e]-t.blkIndent>=4||t.src.charCodeAt(s)!==91)return!1;for(;++s<a;)if(t.src.charCodeAt(s)===93&&t.src.charCodeAt(s-1)!==92){if(s+1===a||t.src.charCodeAt(s+1)!==58)return!1;break}let u=t.lineMax,l=t.md.block.ruler.getRules("reference"),d=t.parentType;for(t.parentType="reference";c<u&&!t.isEmpty(c);c++){if(t.sCount[c]-t.blkIndent>3||t.sCount[c]<0)continue;let I=!1;for(let E=0,R=l.length;E<R;E++)if(l[E](t,c,u,!0)){I=!0;break}if(I)break}let p=t.getLines(e,c,t.blkIndent,!1).trim();a=p.length;let f=-1;for(s=1;s<a;s++){let I=p.charCodeAt(s);if(I===91)return!1;if(I===93){f=s;break}else I===10?o++:I===92&&(s++,s<a&&p.charCodeAt(s)===10&&o++)}if(f<0||p.charCodeAt(f+1)!==58)return!1;for(s=f+2;s<a;s++){let I=p.charCodeAt(s);if(I===10)o++;else if(!xr(I))break}let m=t.md.helpers.parseLinkDestination(p,s,a);if(!m.ok)return!1;let h=t.md.normalizeLink(m.str);if(!t.md.validateLink(h))return!1;s=m.pos,o+=m.lines;let g=s,v=o,y=s;for(;s<a;s++){let I=p.charCodeAt(s);if(I===10)o++;else if(!xr(I))break}let _=t.md.helpers.parseLinkTitle(p,s,a),x;for(s<a&&y!==s&&_.ok?(x=_.str,s=_.pos,o+=_.lines):(x="",s=g,o=v);s<a;){let I=p.charCodeAt(s);if(!xr(I))break;s++}if(s<a&&p.charCodeAt(s)!==10&&x)for(x="",s=g,o=v;s<a;){let I=p.charCodeAt(s);if(!xr(I))break;s++}if(s<a&&p.charCodeAt(s)!==10)return!1;let S=iy(p.slice(1,f));return S?(n||(typeof t.env.references>"u"&&(t.env.references={}),typeof t.env.references[S]>"u"&&(t.env.references[S]={title:x,href:h}),t.parentType=d,t.line=e+o+1),!0):!1}var xue=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","section","source","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"];var R6e="[a-zA-Z_:][a-zA-Z0-9:._-]*",k6e="[^\"'=<>`\\x00-\\x20]+",P6e="'[^']*'",A6e='"[^"]*"',D6e="(?:"+k6e+"|"+P6e+"|"+A6e+")",N6e="(?:\\s+"+R6e+"(?:\\s*=\\s*"+D6e+")?)",Sue="<[A-Za-z][A-Za-z0-9\\-]*"+N6e+"*\\s*\\/?>",Iue="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",L6e="<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->",O6e="<[?][\\s\\S]*?[?]>",M6e="<![A-Z]+\\s+[^>]*>",F6e="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",Cue=new RegExp("^(?:"+Sue+"|"+Iue+"|"+L6e+"|"+O6e+"|"+M6e+"|"+F6e+")"),Tue=new RegExp("^(?:"+Sue+"|"+Iue+")");var US=[[/^<(script|pre|style|textarea)(?=(\s|>|$))/i,/<\/(script|pre|style|textarea)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[new RegExp("^</?("+xue.join("|")+")(?=(\\s|/?>|$))","i"),/^$/,!0],[new RegExp(Tue.source+"\\s*$"),/^$/,!1]];function sV(t,e,r,n){let o=t.bMarks[e]+t.tShift[e],s=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4||!t.md.options.html||t.src.charCodeAt(o)!==60)return!1;let a=t.src.slice(o,s),c=0;for(;c<US.length&&!US[c][0].test(a);c++);if(c===US.length)return!1;if(n)return US[c][2];let u=e+1;if(!US[c][1].test(a)){for(;u<r&&!(t.sCount[u]<t.blkIndent);u++)if(o=t.bMarks[u]+t.tShift[u],s=t.eMarks[u],a=t.src.slice(o,s),US[c][1].test(a)){a.length!==0&&u++;break}}t.line=u;let l=t.push("html_block","",0);return l.map=[e,u],l.content=t.getLines(e,u,t.blkIndent,!0),!0}function aV(t,e,r,n){let o=t.bMarks[e]+t.tShift[e],s=t.eMarks[e];if(t.sCount[e]-t.blkIndent>=4)return!1;let a=t.src.charCodeAt(o);if(a!==35||o>=s)return!1;let c=1;for(a=t.src.charCodeAt(++o);a===35&&o<s&&c<=6;)c++,a=t.src.charCodeAt(++o);if(c>6||o<s&&!xr(a))return!1;if(n)return!0;s=t.skipSpacesBack(s,o);let u=t.skipCharsBack(s,35,o);u>o&&xr(t.src.charCodeAt(u-1))&&(s=u),t.line=e+1;let l=t.push("heading_open","h"+String(c),1);l.markup="########".slice(0,c),l.map=[e,t.line];let d=t.push("inline","",0);d.content=t.src.slice(o,s).trim(),d.map=[e,t.line],d.children=[];let p=t.push("heading_close","h"+String(c),-1);return p.markup="########".slice(0,c),!0}function cV(t,e,r){let n=t.md.block.ruler.getRules("paragraph");if(t.sCount[e]-t.blkIndent>=4)return!1;let o=t.parentType;t.parentType="paragraph";let s=0,a,c=e+1;for(;c<r&&!t.isEmpty(c);c++){if(t.sCount[c]-t.blkIndent>3)continue;if(t.sCount[c]>=t.blkIndent){let m=t.bMarks[c]+t.tShift[c],h=t.eMarks[c];if(m<h&&(a=t.src.charCodeAt(m),(a===45||a===61)&&(m=t.skipChars(m,a),m=t.skipSpaces(m),m>=h))){s=a===61?1:2;break}}if(t.sCount[c]<0)continue;let f=!1;for(let m=0,h=n.length;m<h;m++)if(n[m](t,c,r,!0)){f=!0;break}if(f)break}if(!s)return!1;let u=t.getLines(e,c,t.blkIndent,!1).trim();t.line=c+1;let l=t.push("heading_open","h"+String(s),1);l.markup=String.fromCharCode(a),l.map=[e,t.line];let d=t.push("inline","",0);d.content=u,d.map=[e,t.line-1],d.children=[];let p=t.push("heading_close","h"+String(s),-1);return p.markup=String.fromCharCode(a),t.parentType=o,!0}function uV(t,e,r){let n=t.md.block.ruler.getRules("paragraph"),o=t.parentType,s=e+1;for(t.parentType="paragraph";s<r&&!t.isEmpty(s);s++){if(t.sCount[s]-t.blkIndent>3||t.sCount[s]<0)continue;let l=!1;for(let d=0,p=n.length;d<p;d++)if(n[d](t,s,r,!0)){l=!0;break}if(l)break}let a=t.getLines(e,s,t.blkIndent,!1).trim();t.line=s;let c=t.push("paragraph_open","p",1);c.map=[e,t.line];let u=t.push("inline","",0);return u.content=a,u.map=[e,t.line],u.children=[],t.push("paragraph_close","p",-1),t.parentType=o,!0}var j4=[["table",ZH,["paragraph","reference"]],["code",eV],["fence",tV,["paragraph","reference","blockquote","list"]],["blockquote",rV,["paragraph","reference","blockquote","list"]],["hr",nV,["paragraph","reference","blockquote","list"]],["list",iV,["paragraph","reference","blockquote"]],["reference",oV],["html_block",sV,["paragraph","reference","blockquote"]],["heading",aV,["paragraph","reference","blockquote"]],["lheading",cV],["paragraph",uV]];function H4(){this.ruler=new oy;for(let t=0;t<j4.length;t++)this.ruler.push(j4[t][0],j4[t][1],{alt:(j4[t][2]||[]).slice()})}H4.prototype.tokenize=function(t,e,r){let n=this.ruler.getRules(""),o=n.length,s=t.md.options.maxNesting,a=e,c=!1;for(;a<r&&(t.line=a=t.skipEmptyLines(a),!(a>=r||t.sCount[a]<t.blkIndent));){if(t.level>=s){t.line=r;break}let u=t.line,l=!1;for(let d=0;d<o;d++)if(l=n[d](t,a,r,!1),l){if(u>=t.line)throw new Error("block rule didn't increment state.line");break}if(!l)throw new Error("none of the block rules matched");t.tight=!c,t.isEmpty(t.line-1)&&(c=!0),a=t.line,a<r&&t.isEmpty(a)&&(c=!0,a++,t.line=a)}};H4.prototype.parse=function(t,e,r,n){if(!t)return;let o=new this.State(t,e,r,n);this.tokenize(o,o.line,o.lineMax)};H4.prototype.State=vue;var Eue=H4;function _k(t,e,r,n){this.src=t,this.env=r,this.md=e,this.tokens=n,this.tokens_meta=Array(n.length),this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache={},this.delimiters=[],this._prev_delimiters=[],this.backticks={},this.backticksScanned=!1,this.linkLevel=0}_k.prototype.pushPending=function(){let t=new zf("text","",0);return t.content=this.pending,t.level=this.pendingLevel,this.tokens.push(t),this.pending="",t};_k.prototype.push=function(t,e,r){this.pending&&this.pushPending();let n=new zf(t,e,r),o=null;return r<0&&(this.level--,this.delimiters=this._prev_delimiters.pop()),n.level=this.level,r>0&&(this.level++,this._prev_delimiters.push(this.delimiters),this.delimiters=[],o={delimiters:this.delimiters}),this.pendingLevel=this.level,this.tokens.push(n),this.tokens_meta.push(o),n};_k.prototype.scanDelims=function(t,e){let r,n,o=!0,s=!0,a=this.posMax,c=this.src.charCodeAt(t),u=t>0?this.src.charCodeAt(t-1):32,l=t;for(;l<a&&this.src.charCodeAt(l)===c;)l++;let d=l-t,p=l<a?this.src.charCodeAt(l):32,f=ny(u)||ry(String.fromCharCode(u)),m=ny(p)||ry(String.fromCharCode(p)),h=ty(u),g=ty(p);return g?o=!1:m&&(h||f||(o=!1)),h?s=!1:f&&(g||m||(s=!1)),e?(r=o,n=s):(r=o&&(!s||f),n=s&&(!o||m)),{can_open:r,can_close:n,length:d}};_k.prototype.Token=zf;var wue=_k;function U6e(t){switch(t){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return!0;default:return!1}}function lV(t,e){let r=t.pos;for(;r<t.posMax&&!U6e(t.src.charCodeAt(r));)r++;return r===t.pos?!1:(e||(t.pending+=t.src.slice(t.pos,r)),t.pos=r,!0)}var B6e=/(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i;function dV(t,e){if(!t.md.options.linkify||t.linkLevel>0)return!1;let r=t.pos,n=t.posMax;if(r+3>n||t.src.charCodeAt(r)!==58||t.src.charCodeAt(r+1)!==47||t.src.charCodeAt(r+2)!==47)return!1;let o=t.pending.match(B6e);if(!o)return!1;let s=o[1],a=t.md.linkify.matchAtStart(t.src.slice(r-s.length));if(!a)return!1;let c=a.url;if(c.length<=s.length)return!1;c=c.replace(/\*+$/,"");let u=t.md.normalizeLink(c);if(!t.md.validateLink(u))return!1;if(!e){t.pending=t.pending.slice(0,-s.length);let l=t.push("link_open","a",1);l.attrs=[["href",u]],l.markup="linkify",l.info="auto";let d=t.push("text","",0);d.content=t.md.normalizeLinkText(c);let p=t.push("link_close","a",-1);p.markup="linkify",p.info="auto"}return t.pos+=c.length-s.length,!0}function pV(t,e){let r=t.pos;if(t.src.charCodeAt(r)!==10)return!1;let n=t.pending.length-1,o=t.posMax;if(!e)if(n>=0&&t.pending.charCodeAt(n)===32)if(n>=1&&t.pending.charCodeAt(n-1)===32){let s=n-1;for(;s>=1&&t.pending.charCodeAt(s-1)===32;)s--;t.pending=t.pending.slice(0,s),t.push("hardbreak","br",0)}else t.pending=t.pending.slice(0,-1),t.push("softbreak","br",0);else t.push("softbreak","br",0);for(r++;r<o&&xr(t.src.charCodeAt(r));)r++;return t.pos=r,!0}var fV=[];for(let t=0;t<256;t++)fV.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(t){fV[t.charCodeAt(0)]=1});function mV(t,e){let r=t.pos,n=t.posMax;if(t.src.charCodeAt(r)!==92||(r++,r>=n))return!1;let o=t.src.charCodeAt(r);if(o===10){for(e||t.push("hardbreak","br",0),r++;r<n&&(o=t.src.charCodeAt(r),!!xr(o));)r++;return t.pos=r,!0}let s=t.src[r];if(o>=55296&&o<=56319&&r+1<n){let c=t.src.charCodeAt(r+1);c>=56320&&c<=57343&&(s+=t.src[r+1],r++)}let a="\\"+s;if(!e){let c=t.push("text_special","",0);o<256&&fV[o]!==0?c.content=s:c.content=a,c.markup=a,c.info="escape"}return t.pos=r+1,!0}function hV(t,e){let r=t.pos;if(t.src.charCodeAt(r)!==96)return!1;let o=r;r++;let s=t.posMax;for(;r<s&&t.src.charCodeAt(r)===96;)r++;let a=t.src.slice(o,r),c=a.length;if(t.backticksScanned&&(t.backticks[c]||0)<=o)return e||(t.pending+=a),t.pos+=c,!0;let u=r,l;for(;(l=t.src.indexOf("`",u))!==-1;){for(u=l+1;u<s&&t.src.charCodeAt(u)===96;)u++;let d=u-l;if(d===c){if(!e){let p=t.push("code_inline","code",0);p.markup=a,p.content=t.src.slice(r,l).replace(/\n/g," ").replace(/^ (.+) $/,"$1")}return t.pos=u,!0}t.backticks[d]=l}return t.backticksScanned=!0,e||(t.pending+=a),t.pos+=c,!0}function q6e(t,e){let r=t.pos,n=t.src.charCodeAt(r);if(e||n!==126)return!1;let o=t.scanDelims(t.pos,!0),s=o.length,a=String.fromCharCode(n);if(s<2)return!1;let c;s%2&&(c=t.push("text","",0),c.content=a,s--);for(let u=0;u<s;u+=2)c=t.push("text","",0),c.content=a+a,t.delimiters.push({marker:n,length:0,token:t.tokens.length-1,end:-1,open:o.can_open,close:o.can_close});return t.pos+=o.length,!0}function Rue(t,e){let r,n=[],o=e.length;for(let s=0;s<o;s++){let a=e[s];if(a.marker!==126||a.end===-1)continue;let c=e[a.end];r=t.tokens[a.token],r.type="s_open",r.tag="s",r.nesting=1,r.markup="~~",r.content="",r=t.tokens[c.token],r.type="s_close",r.tag="s",r.nesting=-1,r.markup="~~",r.content="",t.tokens[c.token-1].type==="text"&&t.tokens[c.token-1].content==="~"&&n.push(c.token-1)}for(;n.length;){let s=n.pop(),a=s+1;for(;a<t.tokens.length&&t.tokens[a].type==="s_close";)a++;a--,s!==a&&(r=t.tokens[a],t.tokens[a]=t.tokens[s],t.tokens[s]=r)}}function j6e(t){let e=t.tokens_meta,r=t.tokens_meta.length;Rue(t,t.delimiters);for(let n=0;n<r;n++)e[n]&&e[n].delimiters&&Rue(t,e[n].delimiters)}var gV={tokenize:q6e,postProcess:j6e};function H6e(t,e){let r=t.pos,n=t.src.charCodeAt(r);if(e||n!==95&&n!==42)return!1;let o=t.scanDelims(t.pos,n===42);for(let s=0;s<o.length;s++){let a=t.push("text","",0);a.content=String.fromCharCode(n),t.delimiters.push({marker:n,length:o.length,token:t.tokens.length-1,end:-1,open:o.can_open,close:o.can_close})}return t.pos+=o.length,!0}function kue(t,e){let r=e.length;for(let n=r-1;n>=0;n--){let o=e[n];if(o.marker!==95&&o.marker!==42||o.end===-1)continue;let s=e[o.end],a=n>0&&e[n-1].end===o.end+1&&e[n-1].marker===o.marker&&e[n-1].token===o.token-1&&e[o.end+1].token===s.token+1,c=String.fromCharCode(o.marker),u=t.tokens[o.token];u.type=a?"strong_open":"em_open",u.tag=a?"strong":"em",u.nesting=1,u.markup=a?c+c:c,u.content="";let l=t.tokens[s.token];l.type=a?"strong_close":"em_close",l.tag=a?"strong":"em",l.nesting=-1,l.markup=a?c+c:c,l.content="",a&&(t.tokens[e[n-1].token].content="",t.tokens[e[o.end+1].token].content="",n--)}}function V6e(t){let e=t.tokens_meta,r=t.tokens_meta.length;kue(t,t.delimiters);for(let n=0;n<r;n++)e[n]&&e[n].delimiters&&kue(t,e[n].delimiters)}var vV={tokenize:H6e,postProcess:V6e};function bV(t,e){let r,n,o,s,a="",c="",u=t.pos,l=!0;if(t.src.charCodeAt(t.pos)!==91)return!1;let d=t.pos,p=t.posMax,f=t.pos+1,m=t.md.helpers.parseLinkLabel(t,t.pos,!0);if(m<0)return!1;let h=m+1;if(h<p&&t.src.charCodeAt(h)===40){for(l=!1,h++;h<p&&(r=t.src.charCodeAt(h),!(!xr(r)&&r!==10));h++);if(h>=p)return!1;if(u=h,o=t.md.helpers.parseLinkDestination(t.src,h,t.posMax),o.ok){for(a=t.md.normalizeLink(o.str),t.md.validateLink(a)?h=o.pos:a="",u=h;h<p&&(r=t.src.charCodeAt(h),!(!xr(r)&&r!==10));h++);if(o=t.md.helpers.parseLinkTitle(t.src,h,t.posMax),h<p&&u!==h&&o.ok)for(c=o.str,h=o.pos;h<p&&(r=t.src.charCodeAt(h),!(!xr(r)&&r!==10));h++);}(h>=p||t.src.charCodeAt(h)!==41)&&(l=!0),h++}if(l){if(typeof t.env.references>"u")return!1;if(h<p&&t.src.charCodeAt(h)===91?(u=h+1,h=t.md.helpers.parseLinkLabel(t,h),h>=0?n=t.src.slice(u,h++):h=m+1):h=m+1,n||(n=t.src.slice(f,m)),s=t.env.references[iy(n)],!s)return t.pos=d,!1;a=s.href,c=s.title}if(!e){t.pos=f,t.posMax=m;let g=t.push("link_open","a",1),v=[["href",a]];g.attrs=v,c&&v.push(["title",c]),t.linkLevel++,t.md.inline.tokenize(t),t.linkLevel--,t.push("link_close","a",-1)}return t.pos=h,t.posMax=p,!0}function yV(t,e){let r,n,o,s,a,c,u,l,d="",p=t.pos,f=t.posMax;if(t.src.charCodeAt(t.pos)!==33||t.src.charCodeAt(t.pos+1)!==91)return!1;let m=t.pos+2,h=t.md.helpers.parseLinkLabel(t,t.pos+1,!1);if(h<0)return!1;if(s=h+1,s<f&&t.src.charCodeAt(s)===40){for(s++;s<f&&(r=t.src.charCodeAt(s),!(!xr(r)&&r!==10));s++);if(s>=f)return!1;for(l=s,c=t.md.helpers.parseLinkDestination(t.src,s,t.posMax),c.ok&&(d=t.md.normalizeLink(c.str),t.md.validateLink(d)?s=c.pos:d=""),l=s;s<f&&(r=t.src.charCodeAt(s),!(!xr(r)&&r!==10));s++);if(c=t.md.helpers.parseLinkTitle(t.src,s,t.posMax),s<f&&l!==s&&c.ok)for(u=c.str,s=c.pos;s<f&&(r=t.src.charCodeAt(s),!(!xr(r)&&r!==10));s++);else u="";if(s>=f||t.src.charCodeAt(s)!==41)return t.pos=p,!1;s++}else{if(typeof t.env.references>"u")return!1;if(s<f&&t.src.charCodeAt(s)===91?(l=s+1,s=t.md.helpers.parseLinkLabel(t,s),s>=0?o=t.src.slice(l,s++):s=h+1):s=h+1,o||(o=t.src.slice(m,h)),a=t.env.references[iy(o)],!a)return t.pos=p,!1;d=a.href,u=a.title}if(!e){n=t.src.slice(m,h);let g=[];t.md.inline.parse(n,t.md,t.env,g);let v=t.push("image","img",0),y=[["src",d],["alt",""]];v.attrs=y,v.children=g,v.content=n,u&&y.push(["title",u])}return t.pos=s,t.posMax=f,!0}var G6e=/^([a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/,z6e=/^([a-zA-Z][a-zA-Z0-9+.-]{1,31}):([^<>\x00-\x20]*)$/;function _V(t,e){let r=t.pos;if(t.src.charCodeAt(r)!==60)return!1;let n=t.pos,o=t.posMax;for(;;){if(++r>=o)return!1;let a=t.src.charCodeAt(r);if(a===60)return!1;if(a===62)break}let s=t.src.slice(n+1,r);if(z6e.test(s)){let a=t.md.normalizeLink(s);if(!t.md.validateLink(a))return!1;if(!e){let c=t.push("link_open","a",1);c.attrs=[["href",a]],c.markup="autolink",c.info="auto";let u=t.push("text","",0);u.content=t.md.normalizeLinkText(s);let l=t.push("link_close","a",-1);l.markup="autolink",l.info="auto"}return t.pos+=s.length+2,!0}if(G6e.test(s)){let a=t.md.normalizeLink("mailto:"+s);if(!t.md.validateLink(a))return!1;if(!e){let c=t.push("link_open","a",1);c.attrs=[["href",a]],c.markup="autolink",c.info="auto";let u=t.push("text","",0);u.content=t.md.normalizeLinkText(s);let l=t.push("link_close","a",-1);l.markup="autolink",l.info="auto"}return t.pos+=s.length+2,!0}return!1}function $6e(t){return/^<a[>\s]/i.test(t)}function W6e(t){return/^<\/a\s*>/i.test(t)}function K6e(t){let e=t|32;return e>=97&&e<=122}function xV(t,e){if(!t.md.options.html)return!1;let r=t.posMax,n=t.pos;if(t.src.charCodeAt(n)!==60||n+2>=r)return!1;let o=t.src.charCodeAt(n+1);if(o!==33&&o!==63&&o!==47&&!K6e(o))return!1;let s=t.src.slice(n).match(Cue);if(!s)return!1;if(!e){let a=t.push("html_inline","",0);a.content=s[0],$6e(a.content)&&t.linkLevel++,W6e(a.content)&&t.linkLevel--}return t.pos+=s[0].length,!0}var Y6e=/^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i,Q6e=/^&([a-z][a-z0-9]{1,31});/i;function SV(t,e){let r=t.pos,n=t.posMax;if(t.src.charCodeAt(r)!==38||r+1>=n)return!1;if(t.src.charCodeAt(r+1)===35){let s=t.src.slice(r).match(Y6e);if(s){if(!e){let a=s[1][0].toLowerCase()==="x"?parseInt(s[1].slice(1),16):parseInt(s[1],10),c=t.push("text_special","",0);c.content=B4(a)?yk(a):yk(65533),c.markup=s[0],c.info="entity"}return t.pos+=s[0].length,!0}}else{let s=t.src.slice(r).match(Q6e);if(s){let a=hg(s[0]);if(a!==s[0]){if(!e){let c=t.push("text_special","",0);c.content=a,c.markup=s[0],c.info="entity"}return t.pos+=s[0].length,!0}}}return!1}function Pue(t){let e={},r=t.length;if(!r)return;let n=0,o=-2,s=[];for(let a=0;a<r;a++){let c=t[a];if(s.push(0),(t[n].marker!==c.marker||o!==c.token-1)&&(n=a),o=c.token,c.length=c.length||0,!c.close)continue;e.hasOwnProperty(c.marker)||(e[c.marker]=[-1,-1,-1,-1,-1,-1]);let u=e[c.marker][(c.open?3:0)+c.length%3],l=n-s[n]-1,d=l;for(;l>u;l-=s[l]+1){let p=t[l];if(p.marker===c.marker&&p.open&&p.end<0){let f=!1;if((p.close||c.open)&&(p.length+c.length)%3===0&&(p.length%3!==0||c.length%3!==0)&&(f=!0),!f){let m=l>0&&!t[l-1].open?s[l-1]+1:0;s[a]=a-l+m,s[l]=m,c.open=!1,p.end=a,p.close=!1,d=-1,o=-2;break}}}d!==-1&&(e[c.marker][(c.open?3:0)+(c.length||0)%3]=d)}}function IV(t){let e=t.tokens_meta,r=t.tokens_meta.length;Pue(t.delimiters);for(let n=0;n<r;n++)e[n]&&e[n].delimiters&&Pue(e[n].delimiters)}function CV(t){let e,r,n=0,o=t.tokens,s=t.tokens.length;for(e=r=0;e<s;e++)o[e].nesting<0&&n--,o[e].level=n,o[e].nesting>0&&n++,o[e].type==="text"&&e+1<s&&o[e+1].type==="text"?o[e+1].content=o[e].content+o[e+1].content:(e!==r&&(o[r]=o[e]),r++);e!==r&&(o.length=r)}var TV=[["text",lV],["linkify",dV],["newline",pV],["escape",mV],["backticks",hV],["strikethrough",gV.tokenize],["emphasis",vV.tokenize],["link",bV],["image",yV],["autolink",_V],["html_inline",xV],["entity",SV]],EV=[["balance_pairs",IV],["strikethrough",gV.postProcess],["emphasis",vV.postProcess],["fragments_join",CV]];function xk(){this.ruler=new oy;for(let t=0;t<TV.length;t++)this.ruler.push(TV[t][0],TV[t][1]);this.ruler2=new oy;for(let t=0;t<EV.length;t++)this.ruler2.push(EV[t][0],EV[t][1])}xk.prototype.skipToken=function(t){let e=t.pos,r=this.ruler.getRules(""),n=r.length,o=t.md.options.maxNesting,s=t.cache;if(typeof s[e]<"u"){t.pos=s[e];return}let a=!1;if(t.level<o){for(let c=0;c<n;c++)if(t.level++,a=r[c](t,!0),t.level--,a){if(e>=t.pos)throw new Error("inline rule didn't increment state.pos");break}}else t.pos=t.posMax;a||t.pos++,s[e]=t.pos};xk.prototype.tokenize=function(t){let e=this.ruler.getRules(""),r=e.length,n=t.posMax,o=t.md.options.maxNesting;for(;t.pos<n;){let s=t.pos,a=!1;if(t.level<o){for(let c=0;c<r;c++)if(a=e[c](t,!1),a){if(s>=t.pos)throw new Error("inline rule didn't increment state.pos");break}}if(a){if(t.pos>=n)break;continue}t.pending+=t.src[t.pos++]}t.pending&&t.pushPending()};xk.prototype.parse=function(t,e,r,n){let o=new this.State(t,e,r,n);this.tokenize(o);let s=this.ruler2.getRules(""),a=s.length;for(let c=0;c<a;c++)s[c](o)};xk.prototype.State=wue;var Aue=xk;function Due(t){let e={};t=t||{},e.src_Any=N4.source,e.src_Cc=L4.source,e.src_Z=O4.source,e.src_P=LS.source,e.src_ZPCc=[e.src_Z,e.src_P,e.src_Cc].join("|"),e.src_ZCc=[e.src_Z,e.src_Cc].join("|");let r="[><\uFF5C]";return e.src_pseudo_letter="(?:(?!"+r+"|"+e.src_ZPCc+")"+e.src_Any+")",e.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",e.src_auth="(?:(?:(?!"+e.src_ZCc+"|[@/\\[\\]()]).)+@)?",e.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",e.src_host_terminator="(?=$|"+r+"|"+e.src_ZPCc+")(?!"+(t["---"]?"-(?!--)|":"-|")+"_|:\\d|\\.-|\\.(?!$|"+e.src_ZPCc+"))",e.src_path="(?:[/?#](?:(?!"+e.src_ZCc+"|"+r+`|[()[\\]{}.,"'?!\\-;]).|\\[(?:(?!`+e.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+e.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+e.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+e.src_ZCc+`|["]).)+\\"|\\'(?:(?!`+e.src_ZCc+"|[']).)+\\'|\\'(?="+e.src_pseudo_letter+"|[-])|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!"+e.src_ZCc+"|[.]|$)|"+(t["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+",(?!"+e.src_ZCc+"|$)|;(?!"+e.src_ZCc+"|$)|\\!+(?!"+e.src_ZCc+"|[!]|$)|\\?(?!"+e.src_ZCc+"|[?]|$))+|\\/)?",e.src_email_name='[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*',e.src_xn="xn--[a-z0-9\\-]{1,59}",e.src_domain_root="(?:"+e.src_xn+"|"+e.src_pseudo_letter+"{1,63})",e.src_domain="(?:"+e.src_xn+"|(?:"+e.src_pseudo_letter+")|(?:"+e.src_pseudo_letter+"(?:-|"+e.src_pseudo_letter+"){0,61}"+e.src_pseudo_letter+"))",e.src_host="(?:(?:(?:(?:"+e.src_domain+")\\.)*"+e.src_domain+"))",e.tpl_host_fuzzy="(?:"+e.src_ip4+"|(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%)))",e.tpl_host_no_ip_fuzzy="(?:(?:(?:"+e.src_domain+")\\.)+(?:%TLDS%))",e.src_host_strict=e.src_host+e.src_host_terminator,e.tpl_host_fuzzy_strict=e.tpl_host_fuzzy+e.src_host_terminator,e.src_host_port_strict=e.src_host+e.src_port+e.src_host_terminator,e.tpl_host_port_fuzzy_strict=e.tpl_host_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_port_no_ip_fuzzy_strict=e.tpl_host_no_ip_fuzzy+e.src_port+e.src_host_terminator,e.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+e.src_ZPCc+"|>|$))",e.tpl_email_fuzzy="(^|"+r+'|"|\\(|'+e.src_ZCc+")("+e.src_email_name+"@"+e.tpl_host_fuzzy_strict+")",e.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|\uFF5C]|"+e.src_ZPCc+"))((?![$+<=>^`|\uFF5C])"+e.tpl_host_port_fuzzy_strict+e.src_path+")",e.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|\uFF5C]|"+e.src_ZPCc+"))((?![$+<=>^`|\uFF5C])"+e.tpl_host_port_no_ip_fuzzy_strict+e.src_path+")",e}function wV(t){return Array.prototype.slice.call(arguments,1).forEach(function(r){r&&Object.keys(r).forEach(function(n){t[n]=r[n]})}),t}function G4(t){return Object.prototype.toString.call(t)}function X6e(t){return G4(t)==="[object String]"}function J6e(t){return G4(t)==="[object Object]"}function Z6e(t){return G4(t)==="[object RegExp]"}function Nue(t){return G4(t)==="[object Function]"}function e8e(t){return t.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}var Oue={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1};function t8e(t){return Object.keys(t||{}).reduce(function(e,r){return e||Oue.hasOwnProperty(r)},!1)}var r8e={"http:":{validate:function(t,e,r){let n=t.slice(e);return r.re.http||(r.re.http=new RegExp("^\\/\\/"+r.re.src_auth+r.re.src_host_port_strict+r.re.src_path,"i")),r.re.http.test(n)?n.match(r.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(t,e,r){let n=t.slice(e);return r.re.no_http||(r.re.no_http=new RegExp("^"+r.re.src_auth+"(?:localhost|(?:(?:"+r.re.src_domain+")\\.)+"+r.re.src_domain_root+")"+r.re.src_port+r.re.src_host_terminator+r.re.src_path,"i")),r.re.no_http.test(n)?e>=3&&t[e-3]===":"||e>=3&&t[e-3]==="/"?0:n.match(r.re.no_http)[0].length:0}},"mailto:":{validate:function(t,e,r){let n=t.slice(e);return r.re.mailto||(r.re.mailto=new RegExp("^"+r.re.src_email_name+"@"+r.re.src_host_strict,"i")),r.re.mailto.test(n)?n.match(r.re.mailto)[0].length:0}}},n8e="a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]",i8e="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|\u0440\u0444".split("|");function o8e(t){t.__index__=-1,t.__text_cache__=""}function s8e(t){return function(e,r){let n=e.slice(r);return t.test(n)?n.match(t)[0].length:0}}function Lue(){return function(t,e){e.normalize(t)}}function V4(t){let e=t.re=Due(t.__opts__),r=t.__tlds__.slice();t.onCompile(),t.__tlds_replaced__||r.push(n8e),r.push(e.src_xn),e.src_tlds=r.join("|");function n(c){return c.replace("%TLDS%",e.src_tlds)}e.email_fuzzy=RegExp(n(e.tpl_email_fuzzy),"i"),e.link_fuzzy=RegExp(n(e.tpl_link_fuzzy),"i"),e.link_no_ip_fuzzy=RegExp(n(e.tpl_link_no_ip_fuzzy),"i"),e.host_fuzzy_test=RegExp(n(e.tpl_host_fuzzy_test),"i");let o=[];t.__compiled__={};function s(c,u){throw new Error('(LinkifyIt) Invalid schema "'+c+'": '+u)}Object.keys(t.__schemas__).forEach(function(c){let u=t.__schemas__[c];if(u===null)return;let l={validate:null,link:null};if(t.__compiled__[c]=l,J6e(u)){Z6e(u.validate)?l.validate=s8e(u.validate):Nue(u.validate)?l.validate=u.validate:s(c,u),Nue(u.normalize)?l.normalize=u.normalize:u.normalize?s(c,u):l.normalize=Lue();return}if(X6e(u)){o.push(c);return}s(c,u)}),o.forEach(function(c){t.__compiled__[t.__schemas__[c]]&&(t.__compiled__[c].validate=t.__compiled__[t.__schemas__[c]].validate,t.__compiled__[c].normalize=t.__compiled__[t.__schemas__[c]].normalize)}),t.__compiled__[""]={validate:null,normalize:Lue()};let a=Object.keys(t.__compiled__).filter(function(c){return c.length>0&&t.__compiled__[c]}).map(e8e).join("|");t.re.schema_test=RegExp("(^|(?!_)(?:[><\uFF5C]|"+e.src_ZPCc+"))("+a+")","i"),t.re.schema_search=RegExp("(^|(?!_)(?:[><\uFF5C]|"+e.src_ZPCc+"))("+a+")","ig"),t.re.schema_at_start=RegExp("^"+t.re.schema_search.source,"i"),t.re.pretest=RegExp("("+t.re.schema_test.source+")|("+t.re.host_fuzzy_test.source+")|@","i"),o8e(t)}function a8e(t,e){let r=t.__index__,n=t.__last_index__,o=t.__text_cache__.slice(r,n);this.schema=t.__schema__.toLowerCase(),this.index=r+e,this.lastIndex=n+e,this.raw=o,this.text=o,this.url=o}function RV(t,e){let r=new a8e(t,e);return t.__compiled__[r.schema].normalize(r,t),r}function Nc(t,e){if(!(this instanceof Nc))return new Nc(t,e);e||t8e(t)&&(e=t,t={}),this.__opts__=wV({},Oue,e),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=wV({},r8e,t),this.__compiled__={},this.__tlds__=i8e,this.__tlds_replaced__=!1,this.re={},V4(this)}Nc.prototype.add=function(e,r){return this.__schemas__[e]=r,V4(this),this};Nc.prototype.set=function(e){return this.__opts__=wV(this.__opts__,e),this};Nc.prototype.test=function(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return!1;let r,n,o,s,a,c,u,l,d;if(this.re.schema_test.test(e)){for(u=this.re.schema_search,u.lastIndex=0;(r=u.exec(e))!==null;)if(s=this.testSchemaAt(e,r[2],u.lastIndex),s){this.__schema__=r[2],this.__index__=r.index+r[1].length,this.__last_index__=r.index+r[0].length+s;break}}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(l=e.search(this.re.host_fuzzy_test),l>=0&&(this.__index__<0||l<this.__index__)&&(n=e.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))!==null&&(a=n.index+n[1].length,(this.__index__<0||a<this.__index__)&&(this.__schema__="",this.__index__=a,this.__last_index__=n.index+n[0].length))),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&(d=e.indexOf("@"),d>=0&&(o=e.match(this.re.email_fuzzy))!==null&&(a=o.index+o[1].length,c=o.index+o[0].length,(this.__index__<0||a<this.__index__||a===this.__index__&&c>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=a,this.__last_index__=c))),this.__index__>=0};Nc.prototype.pretest=function(e){return this.re.pretest.test(e)};Nc.prototype.testSchemaAt=function(e,r,n){return this.__compiled__[r.toLowerCase()]?this.__compiled__[r.toLowerCase()].validate(e,n,this):0};Nc.prototype.match=function(e){let r=[],n=0;this.__index__>=0&&this.__text_cache__===e&&(r.push(RV(this,n)),n=this.__last_index__);let o=n?e.slice(n):e;for(;this.test(o);)r.push(RV(this,n)),o=o.slice(this.__last_index__),n+=this.__last_index__;return r.length?r:null};Nc.prototype.matchAtStart=function(e){if(this.__text_cache__=e,this.__index__=-1,!e.length)return null;let r=this.re.schema_at_start.exec(e);if(!r)return null;let n=this.testSchemaAt(e,r[2],r[0].length);return n?(this.__schema__=r[2],this.__index__=r.index+r[1].length,this.__last_index__=r.index+r[0].length+n,RV(this,0)):null};Nc.prototype.tlds=function(e,r){return e=Array.isArray(e)?e:[e],r?(this.__tlds__=this.__tlds__.concat(e).sort().filter(function(n,o,s){return n!==s[o-1]}).reverse(),V4(this),this):(this.__tlds__=e.slice(),this.__tlds_replaced__=!0,V4(this),this)};Nc.prototype.normalize=function(e){e.schema||(e.url="http://"+e.url),e.schema==="mailto:"&&!/^mailto:/i.test(e.url)&&(e.url="mailto:"+e.url)};Nc.prototype.onCompile=function(){};var Mue=Nc;var Uue="-",c8e=/^xn--/,u8e=/[^\0-\x7F]/,l8e=/[\x2E\u3002\uFF0E\uFF61]/g,d8e={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},kV=35,Vd=Math.floor,PV=String.fromCharCode;function vg(t){throw new RangeError(d8e[t])}function p8e(t,e){let r=[],n=t.length;for(;n--;)r[n]=e(t[n]);return r}function Bue(t,e){let r=t.split("@"),n="";r.length>1&&(n=r[0]+"@",t=r[1]),t=t.replace(l8e,".");let o=t.split("."),s=p8e(o,e).join(".");return n+s}function que(t){let e=[],r=0,n=t.length;for(;r<n;){let o=t.charCodeAt(r++);if(o>=55296&&o<=56319&&r<n){let s=t.charCodeAt(r++);(s&64512)==56320?e.push(((o&1023)<<10)+(s&1023)+65536):(e.push(o),r--)}else e.push(o)}return e}var f8e=t=>String.fromCodePoint(...t),m8e=function(t){return t>=48&&t<58?26+(t-48):t>=65&&t<91?t-65:t>=97&&t<123?t-97:36},Fue=function(t,e){return t+22+75*(t<26)-((e!=0)<<5)},jue=function(t,e,r){let n=0;for(t=r?Vd(t/700):t>>1,t+=Vd(t/e);t>kV*26>>1;n+=36)t=Vd(t/kV);return Vd(n+(kV+1)*t/(t+38))},Hue=function(t){let e=[],r=t.length,n=0,o=128,s=72,a=t.lastIndexOf(Uue);a<0&&(a=0);for(let c=0;c<a;++c)t.charCodeAt(c)>=128&&vg("not-basic"),e.push(t.charCodeAt(c));for(let c=a>0?a+1:0;c<r;){let u=n;for(let d=1,p=36;;p+=36){c>=r&&vg("invalid-input");let f=m8e(t.charCodeAt(c++));f>=36&&vg("invalid-input"),f>Vd((2147483647-n)/d)&&vg("overflow"),n+=f*d;let m=p<=s?1:p>=s+26?26:p-s;if(f<m)break;let h=36-m;d>Vd(2147483647/h)&&vg("overflow"),d*=h}let l=e.length+1;s=jue(n-u,l,u==0),Vd(n/l)>2147483647-o&&vg("overflow"),o+=Vd(n/l),n%=l,e.splice(n++,0,o)}return String.fromCodePoint(...e)},Vue=function(t){let e=[];t=que(t);let r=t.length,n=128,o=0,s=72;for(let u of t)u<128&&e.push(PV(u));let a=e.length,c=a;for(a&&e.push(Uue);c<r;){let u=2147483647;for(let d of t)d>=n&&d<u&&(u=d);let l=c+1;u-n>Vd((2147483647-o)/l)&&vg("overflow"),o+=(u-n)*l,n=u;for(let d of t)if(d<n&&++o>2147483647&&vg("overflow"),d===n){let p=o;for(let f=36;;f+=36){let m=f<=s?1:f>=s+26?26:f-s;if(p<m)break;let h=p-m,g=36-m;e.push(PV(Fue(m+h%g,0))),p=Vd(h/g)}e.push(PV(Fue(p,0))),s=jue(o,l,c===a),o=0,++c}++o,++n}return e.join("")},h8e=function(t){return Bue(t,function(e){return c8e.test(e)?Hue(e.slice(4).toLowerCase()):e})},g8e=function(t){return Bue(t,function(e){return u8e.test(e)?"xn--"+Vue(e):e})},v8e={version:"2.3.1",ucs2:{decode:que,encode:f8e},decode:Hue,encode:Vue,toASCII:g8e,toUnicode:h8e};var AV=v8e;var Gue={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}};var zue={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","fragments_join"]}}};var $ue={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","fragments_join"]}}};var b8e={default:Gue,zero:zue,commonmark:$ue},y8e=/^(vbscript|javascript|file|data):/,_8e=/^data:image\/(gif|png|jpeg|webp);/;function x8e(t){let e=t.trim().toLowerCase();return y8e.test(e)?_8e.test(e):!0}var Wue=["http:","https:","mailto:"];function S8e(t){let e=bk(t,!0);if(e.hostname&&(!e.protocol||Wue.indexOf(e.protocol)>=0))try{e.hostname=AV.toASCII(e.hostname)}catch{}return P4(NS(e))}function I8e(t){let e=bk(t,!0);if(e.hostname&&(!e.protocol||Wue.indexOf(e.protocol)>=0))try{e.hostname=AV.toUnicode(e.hostname)}catch{}return vk(NS(e),vk.defaultChars+"%")}function mu(t,e){if(!(this instanceof mu))return new mu(t,e);e||U4(t)||(e=t||{},t="default"),this.inline=new Aue,this.block=new Eue,this.core=new gue,this.renderer=new lue,this.linkify=new Mue,this.validateLink=x8e,this.normalizeLink=S8e,this.normalizeLinkText=I8e,this.utils=UH,this.helpers=OS({},HH),this.options={},this.configure(t),e&&this.set(e)}mu.prototype.set=function(t){return OS(this.options,t),this};mu.prototype.configure=function(t){let e=this;if(U4(t)){let r=t;if(t=b8e[r],!t)throw new Error('Wrong `markdown-it` preset "'+r+'", check name')}if(!t)throw new Error("Wrong `markdown-it` preset, can't be empty");return t.options&&e.set(t.options),t.components&&Object.keys(t.components).forEach(function(r){t.components[r].rules&&e[r].ruler.enableOnly(t.components[r].rules),t.components[r].rules2&&e[r].ruler2.enableOnly(t.components[r].rules2)}),this};mu.prototype.enable=function(t,e){let r=[];Array.isArray(t)||(t=[t]),["core","block","inline"].forEach(function(o){r=r.concat(this[o].ruler.enable(t,!0))},this),r=r.concat(this.inline.ruler2.enable(t,!0));let n=t.filter(function(o){return r.indexOf(o)<0});if(n.length&&!e)throw new Error("MarkdownIt. Failed to enable unknown rule(s): "+n);return this};mu.prototype.disable=function(t,e){let r=[];Array.isArray(t)||(t=[t]),["core","block","inline"].forEach(function(o){r=r.concat(this[o].ruler.disable(t,!0))},this),r=r.concat(this.inline.ruler2.disable(t,!0));let n=t.filter(function(o){return r.indexOf(o)<0});if(n.length&&!e)throw new Error("MarkdownIt. Failed to disable unknown rule(s): "+n);return this};mu.prototype.use=function(t){let e=[this].concat(Array.prototype.slice.call(arguments,1));return t.apply(t,e),this};mu.prototype.parse=function(t,e){if(typeof t!="string")throw new Error("Input data should be a String");let r=new this.core.State(t,this,e);return this.core.process(r),r.tokens};mu.prototype.render=function(t,e){return e=e||{},this.renderer.render(this.parse(t,e),this.options,e)};mu.prototype.parseInline=function(t,e){let r=new this.core.State(t,this,e);return r.inlineMode=!0,this.core.process(r),r.tokens};mu.prototype.renderInline=function(t,e){return e=e||{},this.renderer.render(this.parseInline(t,e),this.options,e)};var DV=mu;var C8e=Object.freeze({abap:{lineComment:{start:"'"}},bat:{lineComment:{start:"REM"},aliases:["Batch","bat"],extensions:[".bat",".cmd"]},bibtex:{lineComment:{start:"%"},aliases:["BibTeX","bibtex"],extensions:[".bib"]},blade:{lineComment:{start:"#"}},c:{lineComment:{start:"//"},aliases:["C","c"],extensions:[".c",".i"]},clojure:{lineComment:{start:";"},aliases:["Clojure","clojure"],extensions:[".clj",".cljs",".cljc",".cljx",".clojure",".edn"]},coffeescript:{lineComment:{start:"//"},aliases:["CoffeeScript","coffeescript","coffee"],extensions:[".coffee",".cson",".iced"]},cpp:{lineComment:{start:"//"},aliases:["C++","Cpp","cpp"],extensions:[".cpp",".cc",".cxx",".c++",".hpp",".hh",".hxx",".h++",".h",".ii",".ino",".inl",".ipp",".ixx",".tpp",".txx",".hpp.in",".h.in"]},csharp:{lineComment:{start:"//"},aliases:["C#","csharp"],extensions:[".cs",".csx",".cake"]},css:{lineComment:{start:"/*",end:"*/"},aliases:["CSS","css"],extensions:[".css"]},dart:{lineComment:{start:"//"},aliases:["Dart"],extensions:[".dart"]},dockerfile:{lineComment:{start:"#"},aliases:["Docker","Dockerfile","Containerfile"],extensions:[".dockerfile",".containerfile"]},elixir:{lineComment:{start:"#"}},erb:{lineComment:{start:"<%#",end:"%>"}},erlang:{lineComment:{start:"%"}},fsharp:{lineComment:{start:"//"},aliases:["F#","FSharp","fsharp"],extensions:[".fs",".fsi",".fsx",".fsscript"]},go:{lineComment:{start:"//"},aliases:["Go"],extensions:[".go"]},groovy:{lineComment:{start:"//"},aliases:["Groovy","groovy"],extensions:[".groovy",".gvy",".gradle",".jenkinsfile",".nf"]},haml:{lineComment:{start:"-#"}},handlebars:{lineComment:{start:"{{!",end:"}}"},extensions:[".hbs",".handlebars"]},haskell:{lineComment:{start:"--"}},html:{lineComment:{start:"<!--",end:"-->"},aliases:["HTML","htm","html","xhtml"],extensions:[".html",".htm",".shtml",".xhtml",".xht",".mdoc",".jsp",".asp",".aspx",".jshtm",".volt",".ejs",".rhtml"]},ini:{lineComment:{start:";"}},java:{lineComment:{start:"//"},extensions:[".java",".class"]},javascript:{lineComment:{start:"//"},aliases:["JavaScript","javascript","js"],extensions:[".js",".es6",".mjs",".cjs",".pac"]},javascriptreact:{lineComment:{start:"//"},aliases:["JavaScript JSX","JavaScript React","jsx"],extensions:[".jsx"]},json:{extensions:[".json"],lineComment:{start:"//"}},jsonc:{lineComment:{start:"//"}},jsx:{lineComment:{start:"//"}},julia:{lineComment:{start:"#"},aliases:["Julia","julia"],extensions:[".jl"]},kotlin:{lineComment:{start:"//"}},latex:{lineComment:{start:"%"},aliases:["LaTeX","latex"],extensions:[".tex",".ltx",".ctx"]},less:{lineComment:{start:"//"},aliases:["Less","less"],extensions:[".less"]},lua:{lineComment:{start:"--"},aliases:["Lua","lua"],extensions:[".lua"]},makefile:{lineComment:{start:"#"},aliases:["Makefile","makefile"],extensions:[".mak",".mk"]},markdown:{lineComment:{start:"[]: #"},aliases:["Markdown","markdown"],extensions:[".md",".mkd",".mdwn",".mdown",".markdown",".markdn",".mdtxt",".mdtext",".workbook"]},"objective-c":{lineComment:{start:"//"},aliases:["Objective-C"],extensions:[".m"]},"objective-cpp":{lineComment:{start:"//"},aliases:["Objective-C++"],extensions:[".mm"]},perl:{lineComment:{start:"#"},aliases:["Perl","perl"],extensions:[".pl",".pm",".pod",".t",".PL",".psgi"]},php:{lineComment:{start:"//"},aliases:["PHP","php"],extensions:[".php",".php4",".php5",".phtml",".ctp"]},powershell:{lineComment:{start:"#"},aliases:["PowerShell","powershell","ps","ps1"],extensions:[".ps1",".psm1",".psd1",".pssc",".psrc"]},pug:{lineComment:{start:"//"}},python:{lineComment:{start:"#"},aliases:["Python","py"],extensions:[".py",".rpy",".pyw",".cpy",".gyp",".gypi",".pyi",".ipy",".pyt"]},ql:{lineComment:{start:"//"}},r:{lineComment:{start:"#"},aliases:["R","r"],extensions:[".r",".rhistory",".rprofile",".rt"]},razor:{lineComment:{start:"<!--",end:"-->"},aliases:["Razor","razor"],extensions:[".cshtml",".razor"]},ruby:{lineComment:{start:"#"},aliases:["Ruby","rb"],extensions:[".rb",".rbx",".rjs",".gemspec",".rake",".ru",".erb",".podspec",".rbi"]},rust:{lineComment:{start:"//"},aliases:["Rust","rust"],extensions:[".rs"]},sass:{lineComment:{start:"//"}},scala:{lineComment:{start:"//"}},scss:{lineComment:{start:"//"},aliases:["SCSS","scss"],extensions:[".scss"]},shellscript:{lineComment:{start:"#"},aliases:["Shell Script","shellscript","bash","fish","sh","zsh","ksh","csh"],extensions:[".sh",".bash",".bashrc",".bash_aliases",".bash_profile",".bash_login",".ebuild",".profile",".bash_logout",".xprofile",".xsession",".xsessionrc",".Xsession",".zsh",".zshrc",".zprofile",".zlogin",".zlogout",".zshenv",".zsh-theme",".fish",".ksh",".csh",".cshrc",".tcshrc",".yashrc",".yash_profile"]},slim:{lineComment:{start:"/"}},solidity:{lineComment:{start:"//"}},sql:{lineComment:{start:"--"},aliases:["SQL"],extensions:[".sql",".dsql"]},stylus:{lineComment:{start:"//"}},svelte:{lineComment:{start:"<!--",end:"-->"}},swift:{lineComment:{start:"//"},aliases:["Swift","swift"],extensions:[".swift"]},terraform:{lineComment:{start:"#"}},tex:{lineComment:{start:"%"},aliases:["TeX","tex"],extensions:[".sty",".cls",".bbx",".cbx"]},typescript:{lineComment:{start:"//"},aliases:["TypeScript","ts","typescript"],extensions:[".ts",".cts",".mts"]},typescriptreact:{lineComment:{start:"//"},aliases:["TypeScript JSX","TypeScript React","tsx"],extensions:[".tsx"]},vb:{lineComment:{start:"'"},aliases:["Visual Basic","vb"],extensions:[".vb",".brs",".vbs",".bas",".vba"]},verilog:{lineComment:{start:"//"}},"vue-html":{lineComment:{start:"<!--",end:"-->"}},vue:{lineComment:{start:"//"},extensions:[".vue"]},xml:{lineComment:{start:"<!--",end:"-->"},aliases:["XML","xml"],extensions:[".xml",".xsd",".ascx",".atom",".axml",".axaml",".bpmn",".cpt",".csl",".csproj",".csproj.user",".dita",".ditamap",".dtd",".ent",".mod",".dtml",".fsproj",".fxml",".iml",".isml",".jmx",".launch",".menu",".mxml",".nuspec",".opml",".owl",".proj",".props",".pt",".publishsettings",".pubxml",".pubxml.user",".rbxlx",".rbxmx",".rdf",".rng",".rss",".shproj",".storyboard",".svg",".targets",".tld",".tmx",".vbproj",".vbproj.user",".vcxproj",".vcxproj.filters",".wsdl",".wxi",".wxl",".wxs",".xaml",".xbl",".xib",".xlf",".xliff",".xpdl",".xul",".xoml"]},xsl:{lineComment:{start:"<!--",end:"-->"},aliases:["XSL","xsl"],extensions:[".xsl",".xslt"]},yaml:{lineComment:{start:"#"}}}),sy=new Map(Object.entries(C8e).map(([t,e])=>[t,{languageId:t,...e}]));function Ko(t){let e=typeof t=="string"?t:t.languageId,r=sy.get(e.toLowerCase());return r||{languageId:e,lineComment:{start:"//"}}}function ha(t){let e=Rc(t).toLowerCase();for(let r of sy.values())if(r.extensions?.includes(e))return r;return Ko("plaintext")}function Pi(t,e,r=!0){let n=e.matchAll(/^\s*(```+)/gm),o=Math.max(3,...Array.from(n,a=>a[1].length+1)),s="`".repeat(o);return`${s}${z4(t)}
${r?e.trim():e}
${s}`}function z4(t){switch(t.trim().toLowerCase()){case"typescriptreact":return"tsx";case"javascriptreact":return"jsx";default:return t}}function $4(t){let e=Rc(t).toLowerCase(),r=Object.keys(sy).find(n=>sy.get(n)?.extensions?.includes(e))||e.replace(/^\./,"");return z4(r)}function Fs(t){let e=[],n=new DV().parse(t,{});for(let o of Kue(n))o.map&&o.type==="fence"&&e.push({startMarkup:o.markup,code:o.content.replace(/\n$/,""),language:o.info.trim(),startLine:o.map[0],endLine:o.map[1]});return e}function*Kue(t){for(let e of t)e.children&&(yield*Kue(e.children)),yield e}var W4=H(nt()),NV=H(require("path"));var Que=H(nt()),Xue=H(require("path"));var Yue=H(Gt()),BS=H(nt());var $f=class extends X{constructor(r,n,o,s,a){super(r);this._contextService=n;this._telemetryService=o;this._logService=s;this._ignoreService=a}_handleFoulPrompt(){let r=new Error("BAD PROMPT");if(this._logService.internal.error(r),this._contextService.extensionMode!==au.Production)throw r;this._telemetryService.sendMSFTTelemetryErrorEvent("prompt.invalidreference",{stack:r.stack})}};$f=w([b(1,jt),b(2,he),b(3,oe),b(4,ke)],$f);var Fe=class extends $f{async render(){if(this.props.uri?await this._ignoreService.isCopilotIgnored(this.props.uri):!1)return this._handleFoulPrompt();let r=Pi(this.props.languageId??"",this.props.code,this.props.shouldTrim??!0);return vscpp(BS.TextChunk,null,this.props.references&&vscpp("references",{value:this.props.references}),r)}},ay=class extends $f{async render(){if(this.props.uri?await this._ignoreService.isCopilotIgnored(this.props.uri):!1)return this._handleFoulPrompt();let r=Pi(this.props.languageId??"",this.props.code,this.props.shouldTrim??!0);if(!this.props.uri)return vscpp(BS.TextChunk,null,r);let n=this.props.range?new Ri(this.props.uri,this.props.range):this.props.uri;return vscpp(BS.TextChunk,null,vscpp("references",{value:[new BS.PromptReference(this.props.variableName?{variableName:this.props.variableName,value:n}:n,void 0,this.props.isSummarized?{status:{description:Yue.t("Part of this file was not sent to the model due to context window limitations. Try attaching specific selections from your file instead."),kind:2}}:void 0)]}),r)}};var ps=class extends $f{get insertLineBreakBefore(){return!1}async render(){if(await this._ignoreService.isCopilotIgnored(this.props.value))return this._handleFoulPrompt();let r;return this.props.mode===1?r=this.props.value.path:r=ou(this.props.value),vscpp(vscppf,null,r)}};var qS=class extends X{constructor(r,n,o){super(r);this._ignoreService=n;this._tabsAndEditorsService=o}async render(r,n){let o=this._tabsAndEditorsService.activeTextEditor;if(!o||o.visibleRanges.length===0)return;let s=o.visibleRanges,a=o.document;if(await this._ignoreService.isCopilotIgnored(a.uri))return vscpp("ignoredFiles",{value:[a.uri]});let u=s.map(d=>({uri:a.uri,version:a.version,ranges:[d]})),l=s.map(d=>new Ms.PromptReference({uri:a.uri,range:d}));return vscpp(vscppf,null,vscpp("usedContext",{value:u}),vscpp("references",{value:l}),vscpp(Que.UserMessage,{priority:this.props.priority},s.map(d=>vscpp(vscppf,null,"Excerpt from active file ",Xue.basename(a.uri.path),", lines ",d.start.line+1," to ",d.end.line+1,":",vscpp("br",null),vscpp(Fe,{code:a.getText(d),languageId:a.languageId,uri:a.uri}),vscpp("br",null),vscpp("br",null)))))}};qS=w([b(1,ke),b(2,zt)],qS);var zr=class extends X{constructor(r,n,o,s){super(r);this.ignoreService=n;this._tabsAndEditorsService=o;this._tokenizerProvider=s}static{this.variableInfo={name:"selection",fullName:"Selection",icon:"selection",description:"The current selection in the active editor",defaultEnablement:!0,registerTool:!0}}async prepare(r){if(!this.props.document)return{isIgnored:!1,exceedsTokenBudget:!1};let n=await this.ignoreService.isCopilotIgnored(this.props.document.uri),o=!1,s=zr.getCurrentSelection(this._tabsAndEditorsService);return s&&this._tokenizerProvider.acquireTokenizer(r.endpoint).tokenLength(s?.selectedText)*1.1>r.tokenBudget&&(o=!0),{isIgnored:n,exceedsTokenBudget:o}}render(r,n){let o=zr.getCurrentSelection(this._tabsAndEditorsService);if(!o)return vscpp(qS,null);let s=[{uri:o.activeDocument.uri,version:o.activeDocument.version,ranges:[o.range]}],a=[new Ms.PromptReference(new Ri(o.activeDocument.uri,o.range))],c=[o.activeDocument.uri];return r.isIgnored?vscpp("ignoredFiles",{value:c}):r.exceedsTokenBudget?vscpp(vscppf,null,vscpp(W4.AssistantMessage,{priority:this.props.priority,name:"selection-too-large"},"Your active selection (",o.fileName&&vscpp(vscppf,null,o.selectedText.split(`
`).length," lines from ",NV.basename(o.fileName)),") exceeded my maximum context size and was dropped. Please reduce the selection to the most relevant part.")):vscpp(vscppf,null,vscpp("usedContext",{value:s}),vscpp(W4.UserMessage,{priority:this.props.priority},"Active selection:",vscpp("br",null),vscpp("br",null),vscpp("br",null),o.fileName&&vscpp(vscppf,null,"From the file: ",NV.basename(o.fileName),vscpp("br",null)),vscpp(Fe,{code:o.selectedText,languageId:o.languageId,uri:o.activeDocument.uri,references:a}),vscpp("br",null),vscpp("br",null)))}static getCurrentSelection(r,n=!1){let o=r.activeTextEditor,s=o?.document;if(s){let a=o.selection;if(a&&(!a.isEmpty||a.isEmpty&&n)){let c=s.languageId,u=s.getText(a);return{languageId:c,selectedText:u,activeDocument:s,range:a,fileName:s.fileName}}}}};zr=w([b(1,ke),b(2,zt),b(3,yr)],zr);var jS=class{constructor(){this.kind="current-selection";this.variableInfo=zr.variableInfo}async resolveContext(e,r){let{messages:n,references:o,usedContext:s}=await ki(e.get(K),r.endpoint,zr,{});if(n.length>0&&o.length>0)return{kind:this.kind,userMessages:n.map(a=>a.content),usedContext:s,references:o}}static formatSelection(e){let r=e.fileName?`From the file: ${Jue.basename(e.fileName)}
`:"",{trimmedLines:n}=hk(e.selectedText.split(/\r?\n/g));return`

${r}${Pi(e.languageId,Nr(n).join(`
`))}

`}},VCt=pn.register(new jS);var kO=H(Gt()),Ok=H(nt());var Qt=class t{constructor(e,r){this.start=e;this.endExclusive=r;if(e>r)throw new Qr(`Invalid range: ${this.toString()}`)}static addRange(e,r){let n=0;for(;n<r.length&&r[n].endExclusive<e.start;)n++;let o=n;for(;o<r.length&&r[o].start<=e.endExclusive;)o++;if(n===o)r.splice(n,0,e);else{let s=Math.min(e.start,r[n].start),a=Math.max(e.endExclusive,r[o-1].endExclusive);r.splice(n,o-n,new t(s,a))}}static tryCreate(e,r){if(!(e>r))return new t(e,r)}static ofLength(e){return new t(0,e)}static ofStartAndLength(e,r){return new t(e,e+r)}get isEmpty(){return this.start===this.endExclusive}delta(e){return new t(this.start+e,this.endExclusive+e)}deltaStart(e){return new t(this.start+e,this.endExclusive)}deltaEnd(e){return new t(this.start,this.endExclusive+e)}get length(){return this.endExclusive-this.start}toString(){return`[${this.start}, ${this.endExclusive})`}equals(e){return this.start===e.start&&this.endExclusive===e.endExclusive}containsRange(e){return this.start<=e.start&&e.endExclusive<=this.endExclusive}contains(e){return this.start<=e&&e<this.endExclusive}join(e){return new t(Math.min(this.start,e.start),Math.max(this.endExclusive,e.endExclusive))}intersect(e){let r=Math.max(this.start,e.start),n=Math.min(this.endExclusive,e.endExclusive);if(r<=n)return new t(r,n)}intersects(e){let r=Math.max(this.start,e.start),n=Math.min(this.endExclusive,e.endExclusive);return r<n}intersectsOrTouches(e){let r=Math.max(this.start,e.start),n=Math.min(this.endExclusive,e.endExclusive);return r<=n}isBefore(e){return this.endExclusive<=e.start}isAfter(e){return this.start>=e.endExclusive}slice(e){return e.slice(this.start,this.endExclusive)}substring(e){return e.substring(this.start,this.endExclusive)}clip(e){if(this.isEmpty)throw new Qr(`Invalid clipping range: ${this.toString()}`);return Math.max(this.start,Math.min(this.endExclusive-1,e))}clipCyclic(e){if(this.isEmpty)throw new Qr(`Invalid clipping range: ${this.toString()}`);return e<this.start?this.endExclusive-(this.start-e)%this.length:e>=this.endExclusive?this.start+(e-this.start)%this.length:e}map(e){let r=[];for(let n=this.start;n<this.endExclusive;n++)r.push(e(n));return r}forEach(e){for(let r=this.start;r<this.endExclusive;r++)e(r)}};var Wa=class{get lines(){return this._lineStartOffsets.length}constructor(e){this._lineStartOffsets=[0];let r=0;for(;;){let n=e.indexOf(`
`,r);if(n===-1)break;this._lineStartOffsets.push(n+1),r=n+1}}lineLength(e){return this._lineStartOffsets[e]-this._lineStartOffsets[e-1]-1}offsetToPosition(e){let r=1;for(;r<this._lineStartOffsets.length&&!(this._lineStartOffsets[r]>e);r++);let n=e-this._lineStartOffsets[r-1];return new tr(r,n+1)}startOffsetOfLineContaining(e){let r=1;for(;r<this._lineStartOffsets.length&&!(this._lineStartOffsets[r]>e);r++);return this._lineStartOffsets[r-1]}positionToOffset(e){return e.lineNumber>=this._lineStartOffsets.length?this._lineStartOffsets[this._lineStartOffsets.length-1]+e.column-1:this._lineStartOffsets[e.lineNumber-1]+e.column-1}};var on=class t{constructor(e){this.edits=e;let r=-1;for(let n of e){if(!(n.replaceRange.start>=r))throw new Error(`Edits must be disjoint and sorted. Found ${n} after ${r}`);r=n.replaceRange.endExclusive}}static{this.empty=new t([])}static fromJson(e){return new t(e.map(Io.fromJson))}static from(e){let r=e.map(o=>new Io(Qt.ofStartAndLength(o.rangeOffset,o.rangeLength),o.text));return r.reverse(),new t(r)}static single(e,r){return new t([new Io(e,r)])}static async fromDiff(e,r,n){let o=await n.computeDiff(e,r,{maxComputationTimeMs:5e3,computeMoves:!1,ignoreTrimWhitespace:!1}),s=new Wa(e),a=new Wa(r),c=[];for(let u of o.changes)for(let l of u.innerChanges??[]){let d=a.positionToOffset(l.modifiedRange.getStartPosition()),p=a.positionToOffset(l.modifiedRange.getEndPosition()),f=r.substring(d,p),m=s.positionToOffset(l.originalRange.getStartPosition()),h=s.positionToOffset(l.originalRange.getEndPosition()),g=new Qt(m,h);c.push(new Io(g,f))}return new t(c)}normalize(){let e=[],r;for(let n of this.edits)n.newText.length===0&&n.replaceRange.length===0||(r&&r.replaceRange.endExclusive===n.replaceRange.start?r=new Io(r.replaceRange.join(n.replaceRange),r.newText+n.newText):(r&&e.push(r),r=n));return r&&e.push(r),new t(e)}normalizeEOL(e){return new t(this.edits.map(r=>r.normalizeEOL(e)))}toString(){return`[${this.edits.map(r=>r.toString()).join(", ")}]`}apply(e){let r=[],n=0;for(let o of this.edits)r.push(e.substring(n,o.replaceRange.start)),r.push(o.newText),n=o.replaceRange.endExclusive;return r.push(e.substring(n)),r.join("")}compose(e){return T8e(this,e)}inverse(e){let r=[],n=0;for(let o of this.edits)r.push(new Io(Qt.ofStartAndLength(o.replaceRange.start+n,o.newText.length),e.substring(o.replaceRange.start,o.replaceRange.endExclusive))),n+=o.newText.length-o.replaceRange.length;return new t(r)}getNewTextRanges(){let e=[],r=0;for(let n of this.edits)e.push(Qt.ofStartAndLength(n.replaceRange.start+r,n.newText.length)),r+=n.newText.length-n.replaceRange.length;return e}get isEmpty(){return this.edits.length===0}tryRebase(e){let r=[],n=0,o=0,s=0;for(;o<this.edits.length||n<e.edits.length;){let a=e.edits[n],c=this.edits[o];if(c)a?c.replaceRange.intersects(a.replaceRange)?o++:c.replaceRange.start<a.replaceRange.start?(r.push(new Io(c.replaceRange.delta(s),c.newText)),o++):(n++,s+=a.newText.length-a.replaceRange.length):(r.push(new Io(c.replaceRange.delta(s),c.newText)),o++);else break}return new t(r)}removeCommonSuffixPrefix(e){let r=[];for(let n of this.edits){let o=n.removeCommonSuffixPrefix(e);o.isEmpty||r.push(o)}return new t(r)}applyToOffset(e){let r=0;for(let n of this.edits)if(n.replaceRange.start<=e){if(e<n.replaceRange.endExclusive)return n.replaceRange.start+r;r+=n.newText.length-n.replaceRange.length}else break;return e+r}applyToOffsetRange(e){return new Qt(this.applyToOffset(e.start),this.applyToOffset(e.endExclusive))}applyInverseToOffset(e){let r=0;for(let n of this.edits){let o=n.newText.length;if(n.replaceRange.start<=e-r){if(e-r<n.replaceRange.start+o)return n.replaceRange.start;r+=o-n.replaceRange.length}else break}return e-r}},Io=class t{constructor(e,r){this.replaceRange=e;this.newText=r}static fromJson(e){return new t(Qt.ofStartAndLength(e.pos,e.len),e.txt)}toString(){return`${this.replaceRange} -> "${this.newText}"`}removeCommonSuffixPrefix(e){let r=e.substring(this.replaceRange.start,this.replaceRange.endExclusive),n=uL(r,this.newText),o=Math.min(r.length-n,this.newText.length-n,Zoe(r,this.newText)),s=new Qt(this.replaceRange.start+n,this.replaceRange.endExclusive-o),a=this.newText.substring(n,this.newText.length-o);return new t(s,a)}normalizeEOL(e){let r=this.newText.replace(/\r\n|\n/g,e);return new t(this.replaceRange,r)}get isEmpty(){return this.newText.length===0&&this.replaceRange.length===0}};function T8e(t,e){if(t=t.normalize(),e=e.normalize(),t.isEmpty)return e;if(e.isEmpty)return t;let r=[...t.edits],n=[],o=0;for(let s of e.edits){for(;;){let l=r[0];if(!l||l.replaceRange.start+o+l.newText.length>=s.replaceRange.start)break;r.shift(),n.push(l),o+=l.newText.length-l.replaceRange.length}let a=o,c,u;for(;;){let l=r[0];if(!l||l.replaceRange.start+o>s.replaceRange.endExclusive)break;c||(c=l),u=l,r.shift(),o+=l.newText.length-l.replaceRange.length}if(!c)n.push(new Io(s.replaceRange.delta(-o),s.newText));else{let l="",d=s.replaceRange.start-(c.replaceRange.start+a);d>0&&(l=c.newText.slice(0,d));let p=u.replaceRange.endExclusive+o-s.replaceRange.endExclusive;if(p>0){let h=new Io(Qt.ofStartAndLength(u.replaceRange.endExclusive,0),u.newText.slice(-p));r.unshift(h),o-=h.newText.length-h.replaceRange.length}let f=l+s.newText,m=new Qt(Math.min(c.replaceRange.start,s.replaceRange.start-a),s.replaceRange.endExclusive-o);n.push(new Io(m,f))}}for(;;){let s=r.shift();if(!s)break;n.push(s)}return new on(n).normalize()}var _t=ie("IParserService");function K4(t){return{startPosition:{row:t.start.line,column:t.start.character},endPosition:{row:t.end.line,column:t.end.character}}}function Y4(t){return new Qe(t.startPosition.row,t.startPosition.column,t.endPosition.row,t.endPosition.column)}function io(t,e){return{startIndex:e.offsetAt(t.start),endIndex:e.offsetAt(t.end)}}function ms(t,e){return new Qe(t.positionAt(e.startIndex),t.positionAt(e.endIndex))}var J4=H(nt());var Co=ie("ILanguageFeaturesService");function Wf(t){return typeof t=="object"&&t!==null&&"targetUri"in t}var Sn={doesContain:(t,e)=>t.startIndex<=e.startIndex&&e.endIndex<=t.endIndex,ofSyntaxNode:t=>({startIndex:t.startIndex,endIndex:t.endIndex}),compare:(t,e)=>t.startIndex-e.startIndex||e.endIndex-t.endIndex,isEqual:(t,e)=>Sn.compare(t,e)===0,doIntersect:(t,e)=>{let r=Math.max(t.startIndex,e.startIndex),n=Math.min(t.endIndex,e.endIndex);return r<n},len:t=>t.endIndex-t.startIndex,intersectionSize:(t,e)=>{let r=Math.max(t.startIndex,e.startIndex),n=Math.min(t.endIndex,e.endIndex);return Math.max(n-r,0)},isTreeSitterOffsetRange(t){return typeof t.startIndex=="number"&&typeof t.endIndex=="number"}},Nl={isEqual(t,e){return t.row===e.row&&t.column===e.column},isBefore(t,e){return t.row<e.row||t.row===e.row&&t.column<e.column},isAfter(t,e){return Nl.isBefore(e,t)},isBeforeOrEqual(t,e){let r=Nl.isBefore(t,e),n=Nl.isEqual(t,e);return!!(r||n)},equals(t,e){return t.column===e.column&&t.row===e.row},isAfterOrEqual(t,e){return Nl.isBeforeOrEqual(e,t)},ofPoint:t=>({row:t.row,column:t.column})},bg={doesContain:(t,e)=>Nl.isBeforeOrEqual(t.startPosition,e.startPosition)&&Nl.isAfterOrEqual(t.endPosition,e.endPosition),equals:(t,e)=>Nl.equals(t.startPosition,e.startPosition)&&Nl.equals(t.endPosition,e.endPosition),ofSyntaxNode:t=>({startPosition:t.startPosition,endPosition:t.endPosition})},yg={ofSyntaxNode:t=>({type:t.type,startIndex:t.startIndex,endIndex:t.endIndex})},Ll={ofSyntaxNode:t=>({range:bg.ofSyntaxNode(t),startIndex:t.startIndex,text:t.text,endIndex:t.endIndex})},Gd=class{constructor(e,r,n,o){this.startIndex=e;this.endIndex=r;this.kind=n;this.children=o;if(e>r)throw new Qr("startIndex must be less than endIndex");let s=e;for(let a of o){if(a.startIndex<s)throw new Qr("Invalid child startIndex");if(a.endIndex>r)throw new Qr("Invalid child endIndex");s=Math.max(a.endIndex,s)}}toString(){let e=[];function r(n,o=""){e.push(`${o}${n.kind} [${n.startIndex}, ${n.endIndex}]`),n.children.forEach(s=>r(s,o+"    "))}return r(this),e.join(`
`)}};function tle(t,e){let r=t.getText().split(/\r|\n|\r\n/g),n=e||{tabSize:4},o={getLineCount:()=>r.length,getLineContent:s=>r[s-1],getOptions:()=>n};try{let s=w8e(o,t.languageId),[a]=rle(t,s,void 0);return a.adjust(t,nle(t.languageId)),a.toOverlayNode(t,!0)}catch{return new Q4(1,t.lineCount,[]).toOverlayNode(t,!0)}}function rle(t,e,r){if(typeof r<"u"&&r>=e.length)throw new Error(`Invalid region index ${r}`);let n=typeof r>"u"?1:e.getStartLineNumber(r),o=typeof r>"u"?t.lineCount:e.getEndLineNumber(r),s=[],a=null;for(r=typeof r>"u"?0:r+1;r<e.length;){let c=e.getStartLineNumber(r),u=e.getEndLineNumber(r);if(c>o||u>o)break;let l=a;if([a,r]=rle(t,e,r),l&&a.startLineNumber<=l.endLineNumber)throw new Qr("Invalid Folding Ranges: overlapping children");if(a.startLineNumber<n)throw new Qr("Invalid Folding Ranges: child starts before parent");s.push(a)}return[new Q4(n,o,s),r]}var Q4=class{constructor(e,r,n){this.startLineNumber=e;this.endLineNumber=r;this.children=n;if(e>r)throw new Qr("Invalid Folding Ranges: startLineNumber > endLineNumber")}adjust(e,r){r?this._adjustOffside():this._adjustRegular(e,e.lineCount)}_adjustOffside(){this.startLineNumber++;for(let e of this.children)e._adjustOffside()}_adjustRegular(e,r){if(this.endLineNumber<r){let n=e.lineAt(this.endLineNumber).text.trim(),o=/^[\}\]\)];?$/.test(n),s=/^<\/\w/.test(n);(o||s)&&this.endLineNumber++}for(let n=this.children.length-1;n>=0;n--){let o=this.children[n],s=n+1<this.children.length?this.children[n+1].startLineNumber-1:r;o._adjustRegular(e,s)}}toOverlayNode(e,r){let n=[],o=r&&this.startLineNumber===1?1:this.startLineNumber+1;for(let s of this.children){for(let a=o;a<s.startLineNumber;a++){let c=Zue(e,a);c&&n.push(c)}n.push(s.toOverlayNode(e,!1)),o=s.endLineNumber+1}for(let s=o;s<this.endLineNumber;s++){let a=Zue(e,s);a&&n.push(a)}return E8e(e,this.startLineNumber,this.endLineNumber,n)}};function Zue(t,e){let r=t.lineAt(e-1);if(r.isEmptyOrWhitespace)return null;let n=t.offsetAt(r.range.start),o=t.offsetAt(r.range.end);return new Gd(n,o,"LINE",[])}function E8e(t,e,r,n){let o=t.offsetAt(new rn(e-1,0)),s=t.offsetAt(new rn(r-1,t.lineAt(r-1).text.length));return new Gd(o,s,"FOLD",n)}function w8e(t,e){return R8e(t,nle(e))}function nle(t){return["clojure","coffeescript","fsharp","latex","markdown","pug","python","sql","yaml"].includes(t)}function R8e(t,e){let r=t.getOptions().tabSize,n=new LV,o=[],s=t.getLineCount()+1;o.push({indent:-1,endAbove:s,line:s});for(let a=t.getLineCount();a>0;a--){let c=t.getLineContent(a),u=P8e(c,r),l=o[o.length-1];if(u===-1){e&&(l.endAbove=a);continue}if(l.indent>u){do o.pop(),l=o[o.length-1];while(l.indent>u);let d=l.endAbove-1;d-a>=1&&n.insertFirst(a,d,u)}l.indent===u?l.endAbove=a:o.push({indent:u,endAbove:a,line:a})}return n.toIndentRanges()}var k8e=65535,cy=16777215,ele=4278190080,LV=class{constructor(){this._startIndexes=[],this._endIndexes=[],this._indentOccurrences=[],this._length=0}insertFirst(e,r,n){if(e>cy||r>cy)return;let o=this._length;this._startIndexes[o]=e,this._endIndexes[o]=r,this._length++,n<1e3&&(this._indentOccurrences[n]=(this._indentOccurrences[n]||0)+1)}toIndentRanges(){let e=new Uint32Array(this._length),r=new Uint32Array(this._length);for(let n=this._length-1,o=0;n>=0;n--,o++)e[o]=this._startIndexes[n],r[o]=this._endIndexes[n];return new OV(e,r)}};function P8e(t,e){let r=0,n=0,o=t.length;for(;n<o;){let s=t.charCodeAt(n);if(s===32)r++;else if(s===9)r=r-r%e+e;else break;n++}return n===o?-1:r}var OV=class{constructor(e,r){this._startIndexes=e,this._endIndexes=r,this._parentsComputed=!1}ensureParentIndices(){if(!this._parentsComputed){this._parentsComputed=!0;let e=[],r=(n,o)=>{let s=e[e.length-1];return this.getStartLineNumber(s)<=n&&this.getEndLineNumber(s)>=o};for(let n=0,o=this._startIndexes.length;n<o;n++){let s=this._startIndexes[n],a=this._endIndexes[n];if(s>cy||a>cy)throw new Error("startLineNumber or endLineNumber must not exceed "+cy);for(;e.length>0&&!r(s,a);)e.pop();let c=e.length>0?e[e.length-1]:-1;e.push(n),this._startIndexes[n]=s+((c&255)<<24),this._endIndexes[n]=a+((c&65280)<<16)}}}get length(){return this._startIndexes.length}getStartLineNumber(e){return this._startIndexes[e]&cy}getEndLineNumber(e){return this._endIndexes[e]&cy}getParentIndex(e){this.ensureParentIndices();let r=((this._startIndexes[e]&ele)>>>24)+((this._endIndexes[e]&ele)>>>16);return r===k8e?-1:r}contains(e,r){return this.getStartLineNumber(e)<=r&&this.getEndLineNumber(e)>=r}findIndex(e){let r=0,n=this._startIndexes.length;if(n===0)return-1;for(;r<n;){let o=Math.floor((r+n)/2);e<this.getStartLineNumber(o)?n=o:r=o+1}return r-1}findRange(e){let r=this.findIndex(e);if(r>=0){if(this.getEndLineNumber(r)>=e)return r;for(r=this.getParentIndex(r);r!==-1;){if(this.contains(r,e))return r;r=this.getParentIndex(r)}}return-1}};var X4=class extends Error{constructor(e){super(`Unrecognized language: ${e}`)}},ile={python:"python",javascript:"javascript",javascriptreact:"javascript",jsx:"javascript",typescript:"typescript",typescriptreact:"tsx",tsx:"tsx",go:"go",ruby:"ruby",csharp:"csharp",cpp:"cpp",java:"java",rust:"rust"};function Ol(t){if(t in ile)return ile[t]}async function ole(t,e,r,n){let o=t.get(_t),s=t.get(oe),a=t.get(he),c=t.get(Co),u=o.getTreeSitterAST(e);if(!u)return[];let l=io(r,e),d=await Ka(s,a,e,n,()=>u.getCallExpressions(l),[]);async function p(v){let y=e.positionAt(v.startIndex);try{let _=await c.getImplementations(e.uri,y);return _.length?_:await c.getDefinitions(e.uri,y)}catch{return[]}}let f=await Ka(s,a,e,n*3,()=>Promise.all(d.map(p)),[]),m=[];for(let v=0;v<f.length;v++){let y=d[v],_=f[v];for(let x of _){let{uri:S,range:I}=Wf(x)?{uri:x.targetUri,range:x.targetRange}:x,E=await t.get(Ve).openTextDocument(S),R=o.getTreeSitterAST(E);if(R){let V=(await R.getFunctionDefinitions()).find(M=>M.identifier===y.identifier);if(V){let M=io(I,E);m.push({uri:S,range:I,version:E.version,identifier:y.identifier,startIndex:M.startIndex,endIndex:M.endIndex,text:V.text})}}}}if(m.length!==0)return m;let h=await Ka(s,a,e,n,()=>u.getFunctionDefinitions(),[]),g=[];for(let v of h)for(let y of d)v.identifier===y.identifier&&g.push(v);return g.sort((v,y)=>v.startIndex-y.startIndex)}async function sle(t,e,r,n){let o=t.get(oe),s=t.get(he),a=t.get(_t),c=a.getTreeSitterAST(e);if(!c)return[];let u=t.get(Co),l=io(r,e),d=await Ka(o,s,e,n,()=>c.getClassReferences(l),[]),p=await Ka(o,s,e,n*3,async()=>await Promise.all(d.map(async g=>{try{let v=e.positionAt(g.startIndex),y=await u.getImplementations(e.uri,v);return y.length?y:await u.getDefinitions(e.uri,v)}catch{return[]}})),[]),f=[];for(let g=0;g<p.length;g++){let v=d[g],y=p[g];for(let _ of y){let{uri:x,range:S}=Wf(_)?{uri:_.targetUri,range:_.targetRange}:_,I=await t.get(Ve).openTextDocument(x),E=a.getTreeSitterAST(I);if(E){let R=(await E.getClassDeclarations()).find(B=>B.identifier===v.identifier);if(R){let B=io(S,I);f.push({uri:x,range:S,version:I.version,identifier:v.identifier,startIndex:B.startIndex,endIndex:B.endIndex,text:R.text})}}}}if(f.length!==0)return f;let m=await Ka(o,s,e,n,()=>c.getClassDeclarations(),[]),h=[];for(let g of m)for(let v of d)g.identifier===v.identifier&&h.push(g);return h.sort((g,v)=>g.startIndex-v.startIndex)}async function ale(t,e,r,n){let o=t.get(oe),s=t.get(he),c=t.get(_t).getTreeSitterAST(e);if(!c)return[];let u=io(r,e),l=await Ka(o,s,e,n,()=>c.getTypeReferences(u),[]),d=await Ka(o,s,e,n,()=>c.getTypeDeclarations(),[]),p=[];for(let f of d)for(let m of l)f.identifier===m.identifier&&p.push(f);return p.sort((f,m)=>f.startIndex-m.startIndex)}function A8e(t,e){return e===0?t.then(r=>({type:"success",value:r})):new Promise((r,n)=>{let o=setTimeout(()=>r({type:"timeout"}),e);t.then(s=>{clearTimeout(o),r({type:"success",value:s})}).catch(s=>{clearTimeout(o),n(s)})})}async function Ka(t,e,r,n,o,s){try{let a=await A8e(cle(r,o,s),n);return a.type==="success"?a.value:(t.public.warn(`Computing async parser based result took longer than ${n}ms`),s)}catch(a){return a instanceof X4||(t.public.error(a,"Failed to compute async parser based result"),e.sendGHTelemetryException(a,"Failed to compute async parser based result")),s}}async function cle(t,e,r,n=0){let o=t.version,s=await e();return t.version!==o?n<3?cle(t,e,r,n+1):r:s}var hu=class t{static forDocument(e,r){return this.forUri(e,r.uri)}static forUri(e,r){return`${this.forLanguage(e)}: ${r.path}`}static forLanguage(e){return`${e.lineComment.start} FILEPATH`}static testLine(e,r){let n=t.forLanguage(e);return r.trimStart().startsWith(n)}};var Ya=class{static begin(e,r){return typeof r>"u"?`${e.lineComment.start} BEGIN:`:`${e.lineComment.start} BEGIN: ${r}`}static end(e,r){return typeof r>"u"?`${e.lineComment.start} END:`:`${e.lineComment.start} END: ${r}`}};function MV(t){return/(^|\n)```[\s\S]+\n```/m.test(t)}function ule(t){return t.split("```",1)[0].match(/^.+/)?.[0]??""}async function uy(t,e,r){let o=await t.getTreeSitterAST(e)?.getStructure();return o||tle(e,r)}var Kf=class extends cu{constructor(r,n){super();this.wholeRange=r;this.contextInfo=n}};(e=>{function t(r){return r instanceof e}e.is=t})(Kf||={});var zd=class{constructor(e){this.charLimit=e;this._totalChars=0}get totalChars(){return this._totalChars}addLine(e){this._totalChars+=e.length+1}lineWouldFit(e){return this._totalChars+e.length+1<this.charLimit}},Us=class t{constructor(e,r,n,o){this.tracker=e;this.document=r;this.language=n;this.kindOrUniqueStr=o;this.lines=[];this.firstLineIndex=this.document.lineCount;this.lastLineIndex=-1;this.isComplete=!1;this.nonTrimWhitespaceCharCount=0;this._startMarker=Ya.begin(n,o),this._endMarker=Ya.end(n,o),this.lines=[],this.firstLineIndex=r.lineCount,this.lastLineIndex=-1}get startMarker(){return this._startMarker}get endMarker(){return this._endMarker}get lineCount(){return this.lines.length}get isVerySmallOrEmpty(){return this.nonTrimWhitespaceCharCount<10}get hasContent(){return this.lines.length===0||this.nonTrimWhitespaceCharCount===0?!1:this.lines.length>0}clone(){let e=new t(this.tracker,this.document,this.language,this.kindOrUniqueStr);return e._startMarker=this.startMarker,e._endMarker=this.endMarker,e.lines.push(...this.lines),e.firstLineIndex=this.firstLineIndex,e.lastLineIndex=this.lastLineIndex,e.nonTrimWhitespaceCharCount=this.nonTrimWhitespaceCharCount,e}clear(){this.lines.length=0,this.firstLineIndex=this.document.lineCount,this.lastLineIndex=-1,this.nonTrimWhitespaceCharCount=0}generatePrompt(e){if(!this.hasContent)return[];let r=[];return r.push("```"+this.language.languageId),r.push(hu.forDocument(this.language,this.document)),e&&r.push(`${this.startMarker}`),r.push(...this.lines),e&&r.push(`${this.endMarker}`),r.push("```"),r}prependLine(e){let n=this.document.lineAt(e).text;return this.tracker.lineWouldFit(n)?(this.firstLineIndex=Math.min(this.firstLineIndex,e),this.lastLineIndex=Math.max(this.lastLineIndex,e),this.lines.unshift(n),this.tracker.addLine(n),this.nonTrimWhitespaceCharCount+=n.trim().length,!0):!1}appendLine(e){let n=this.document.lineAt(e).text;return this.tracker.lineWouldFit(n)?(this.firstLineIndex=Math.min(this.firstLineIndex,e),this.lastLineIndex=Math.max(this.lastLineIndex,e),this.lines.push(n),this.tracker.addLine(n),this.nonTrimWhitespaceCharCount+=n.trim().length,!0):!1}trim(e){let r=e?Math.min(this.lastLineIndex,e.start.line):this.lastLineIndex;for(;this.firstLineIndex<r&&this.lines.length>0&&this.lines[0].trim().length===0;)this.firstLineIndex++,this.lines.shift();let n=e?Math.max(this.firstLineIndex,e.end.line):this.firstLineIndex;for(;n<this.lastLineIndex&&this.lines.length>0&&this.lines[this.lines.length-1].trim().length===0;)this.lastLineIndex--,this.lines.pop()}removeFirstNLines(e){if(e>=this.lineCount){let o=this.lines.slice(0),s=this.nonTrimWhitespaceCharCount;return this.clear(),{lines:o,nonTrimWhitespaceCharCount:s}}let r=this.lines.splice(0,e),n=0;for(let o of r)n+=o.trim().length;return this.firstLineIndex+=e,this.nonTrimWhitespaceCharCount-=n,{lines:r,nonTrimWhitespaceCharCount:n}}removeLastNLines(e){if(e>=this.lineCount){let o=this.lines.slice(0),s=this.nonTrimWhitespaceCharCount;return this.clear(),{lines:o,nonTrimWhitespaceCharCount:s}}let r=this.lines.splice(this.lines.length-e,e),n=0;for(let o of r)n+=o.trim().length;return this.lastLineIndex-=e,this.nonTrimWhitespaceCharCount-=n,{lines:r,nonTrimWhitespaceCharCount:n}}takeFromAbove(e,r){let{lines:n,nonTrimWhitespaceCharCount:o}=e.removeLastNLines(r);this.lines.unshift(...n),this.firstLineIndex-=n.length,this.nonTrimWhitespaceCharCount+=o}takeFromBelow(e,r){let{lines:n,nonTrimWhitespaceCharCount:o}=e.removeFirstNLines(r);this.lines.push(...n),this.lastLineIndex+=n.length,this.nonTrimWhitespaceCharCount+=o}mergeFromAbove(e){e.hasContent&&(this.lines.unshift(...e.lines),this.firstLineIndex=e.firstLineIndex,this.nonTrimWhitespaceCharCount+=e.nonTrimWhitespaceCharCount,e.clear())}mergeFromBelow(e){e.hasContent&&(this.lines.push(...e.lines),this.lastLineIndex=e.lastLineIndex,this.nonTrimWhitespaceCharCount+=e.nonTrimWhitespaceCharCount,e.clear())}toRange(){try{let e=this.lastLineIndex===-1?this.document.lineCount-1:this.lastLineIndex,r=new Qe(this.firstLineIndex,0,e,this.document.lineAt(e).text.length);if(this.document.validateRange(r)===r)return r}catch{return}}toString(){return`{${this.firstLineIndex} -> ${this.lastLineIndex}}`}};var _g=class extends J4.PromptElement{constructor(r,n,o,s){super(r);this._telemetryService=n;this._parserService=o;this._ignoreService=s}async prepare(r,n,o){if(await this._ignoreService.isCopilotIgnored(this.props.documentContext.document.uri))return{k:"ignored"};let s=this.props.nodeToDocument??await xg(this._parserService,this._telemetryService,this.props.documentContext),a=D8e(this.props.endpointInfo,this.props.documentContext,s.range);return{k:"found",nodeToDocument:s,codeExcerptToDocument:a.range,metadata:new Kf(this.props.documentContext.wholeRange,a)}}render(r,n){if(r.k==="ignored")return vscpp("ignoredFiles",{value:[this.props.documentContext.document.uri]});let o=r.codeExcerptToDocument.generatePrompt(!1).join(`
`);return vscpp(J4.UserMessage,null,vscpp("meta",{value:r.metadata}),"I have the following code in the selection:",o!==""?vscpp("br",null):"",r.codeExcerptToDocument.generatePrompt(!1).join(`
`))}};_g=w([b(1,he),b(2,_t),b(3,ke)],_g);async function xg(t,e,r){let n=io(r.selection,r.document),o=t.getTreeSitterAST(r.document);if(o===void 0)return{range:r.wholeRange};let s=Date.now(),a=await o.getNodeToDocument(n),c=Date.now()-s,u=io(r.wholeRange,r.document);N8e(e,n,u,a,r.document.languageId,c);let l=ms(r.document,a.nodeToDocument);return{identifier:a.nodeIdentifier,range:l}}function D8e(t,e,r){let n=new zd(t.modelMaxPromptTokens*4/3),o=new Us(n,e.document,e.language,"ed8c6549bwf9"),s=new Us(new zd(0),e.document,e.language,"abpxx6d04wxr"),a=new Us(new zd(0),e.document,e.language,"be15d9bcejpp");for(let c=r.start.line,u=r.end.line;c<=u&&!(c===u&&r.end.character===0||!o.appendLine(c));++c);return o.trim(e.selection),{language:e.language,above:s,range:o,below:a}}function N8e(t,e,r,n,o,s){t.sendMSFTTelemetryEvent("getNodeToDocument",{languageId:o,typeOfNodeToDocument:n.nodeToDocument.type,nodeToDocumentStart:n.nodeToDocument.startIndex.toString(),nodeToDocumentEnd:n.nodeToDocument.endIndex.toString(),selectionOffsetRangeStart:e.startIndex.toString(),selectionOffsetRangeEnd:e.endIndex.toString(),wholeRangeOffsetRangeStart:r.startIndex.toString(),wholeRangeOffsetRangeEnd:r.endIndex.toString()},{timeSpentMs:s})}var HS=class{constructor(e,r,n,o){this.originalStart=e,this.originalLength=r,this.modifiedStart=n,this.modifiedLength=o}getOriginalEnd(){return this.originalStart+this.originalLength}getModifiedEnd(){return this.modifiedStart+this.modifiedLength}},Sk=class{constructor(e){this.lines=e}getElements(){let e=[];for(let r=0,n=this.lines.length;r<n;r++)e[r]=this.lines[r].trim();return e}getCharCount(){let e=0;for(let r of this.lines)e+=r.length;return e}},Sg=class{static Assert(e,r){if(!e)throw new Error(r)}},Ig=class{static Copy(e,r,n,o,s){for(let a=0;a<s;a++)n[o+a]=e[r+a]}static Copy2(e,r,n,o,s){for(let a=0;a<s;a++)n[o+a]=e[r+a]}};var Z4=class{constructor(){this.m_changes=[],this.m_originalStart=1073741824,this.m_modifiedStart=1073741824,this.m_originalCount=0,this.m_modifiedCount=0}MarkNextChange(){(this.m_originalCount>0||this.m_modifiedCount>0)&&this.m_changes.push(new HS(this.m_originalStart,this.m_originalCount,this.m_modifiedStart,this.m_modifiedCount)),this.m_originalCount=0,this.m_modifiedCount=0,this.m_originalStart=1073741824,this.m_modifiedStart=1073741824}AddOriginalElement(e,r){this.m_originalStart=Math.min(this.m_originalStart,e),this.m_modifiedStart=Math.min(this.m_modifiedStart,r),this.m_originalCount++}AddModifiedElement(e,r){this.m_originalStart=Math.min(this.m_originalStart,e),this.m_modifiedStart=Math.min(this.m_modifiedStart,r),this.m_modifiedCount++}getChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes}getReverseChanges(){return(this.m_originalCount>0||this.m_modifiedCount>0)&&this.MarkNextChange(),this.m_changes.reverse(),this.m_changes}},eO=class t{constructor(e,r){let[n,o]=t._getElements(e),[s,a]=t._getElements(r);this._originalStringElements=n,this._originalElementsOrHash=o,this._modifiedStringElements=s,this._modifiedElementsOrHash=a,this.m_forwardHistory=[],this.m_reverseHistory=[]}static _getElements(e){let r=e.getElements(),n=new Int32Array(r.length);for(let o=0,s=r.length;o<s;o++)n[o]=this._stringHash(r[o],0);return[r,n]}static _numberHash(e,r){return(r<<5)-r+e|0}static _stringHash(e,r){r=this._numberHash(149417,r);for(let n=0,o=e.length;n<o;n++)r=this._numberHash(e.charCodeAt(n),r);return r}ElementsAreEqual(e,r){return this._originalElementsOrHash[e]!==this._modifiedElementsOrHash[r]?!1:this._originalStringElements[e]===this._modifiedStringElements[r]}ComputeDiff(){return this._ComputeDiff(0,this._originalElementsOrHash.length-1,0,this._modifiedElementsOrHash.length-1)}_ComputeDiff(e,r,n,o){return this.ComputeDiffRecursive(e,r,n,o)}ComputeDiffRecursive(e,r,n,o){for(;e<=r&&n<=o&&this.ElementsAreEqual(e,n);)e++,n++;for(;r>=e&&o>=n&&this.ElementsAreEqual(r,o);)r--,o--;if(e>r||n>o){let d;return n<=o?(Sg.Assert(e===r+1,"originalStart should only be one more than originalEnd"),d=[new HS(e,0,n,o-n+1)]):e<=r?(Sg.Assert(n===o+1,"modifiedStart should only be one more than modifiedEnd"),d=[new HS(e,r-e+1,n,0)]):(Sg.Assert(e===r+1,"originalStart should only be one more than originalEnd"),Sg.Assert(n===o+1,"modifiedStart should only be one more than modifiedEnd"),d=[]),d}let s=[0],a=[0],c=this.ComputeRecursionPoint(e,r,n,o,s,a),u=s[0],l=a[0];if(c!==null)return c;{let d=this.ComputeDiffRecursive(e,u,n,l),p=this.ComputeDiffRecursive(u+1,r,l+1,o);return this.ConcatenateChanges(d,p)}}WALKTRACE(e,r,n,o,s,a,c,u,l,d,p,f,m,h,g,v,y){let _=null,x=null,S=new Z4,I=r,E=n,R=m[0]-v[0]-o,B=-1073741824,V=this.m_forwardHistory.length-1;do{let M=R+e;M===I||M<E&&l[M-1]<l[M+1]?(p=l[M+1],h=p-R-o,p<B&&S.MarkNextChange(),B=p,S.AddModifiedElement(p+1,h),R=M+1-e):(p=l[M-1]+1,h=p-R-o,p<B&&S.MarkNextChange(),B=p-1,S.AddOriginalElement(p,h+1),R=M-1-e),V>=0&&(l=this.m_forwardHistory[V],e=l[0],I=1,E=l.length-1)}while(--V>=-1);_=S.getReverseChanges(),S=new Z4,I=a,E=c,R=m[0]-v[0]-u,B=1073741824,V=y?this.m_reverseHistory.length-1:this.m_reverseHistory.length-2;do{let M=R+s;M===I||M<E&&d[M-1]>=d[M+1]?(p=d[M+1]-1,h=p-R-u,p>B&&S.MarkNextChange(),B=p+1,S.AddOriginalElement(p+1,h+1),R=M+1-s):(p=d[M-1],h=p-R-u,p>B&&S.MarkNextChange(),B=p,S.AddModifiedElement(p+1,h+1),R=M-1-s),V>=0&&(d=this.m_reverseHistory[V],s=d[0],I=1,E=d.length-1)}while(--V>=-1);return x=S.getChanges(),this.ConcatenateChanges(_,x)}ComputeRecursionPoint(e,r,n,o,s,a){let c=0,u=0,l=0,d=0,p=0,f=0;e--,n--,s[0]=0,a[0]=0,this.m_forwardHistory=[],this.m_reverseHistory=[];let m=r-e+(o-n),h=m+1,g=new Int32Array(h),v=new Int32Array(h),y=o-n,_=r-e,x=e-n,S=r-o,E=(_-y)%2===0;g[y]=e,v[_]=r;for(let R=1;R<=m/2+1;R++){let B=0,V=0;l=this.ClipDiagonalBound(y-R,R,y,h),d=this.ClipDiagonalBound(y+R,R,y,h);for(let M=l;M<=d;M+=2){M===l||M<d&&g[M-1]<g[M+1]?c=g[M+1]:c=g[M-1]+1,u=c-(M-y)-x;let le=c;for(;c<r&&u<o&&this.ElementsAreEqual(c+1,u+1);)c++,u++;if(g[M]=c,c+u>B+V&&(B=c,V=u),!E&&Math.abs(M-_)<=R-1&&c>=v[M])return s[0]=c,a[0]=u,le<=v[M]&&1447>0&&R<=1448?this.WALKTRACE(y,l,d,x,_,p,f,S,g,v,c,r,s,u,o,a,E):null}p=this.ClipDiagonalBound(_-R,R,_,h),f=this.ClipDiagonalBound(_+R,R,_,h);for(let M=p;M<=f;M+=2){M===p||M<f&&v[M-1]>=v[M+1]?c=v[M+1]-1:c=v[M-1],u=c-(M-_)-S;let le=c;for(;c>e&&u>n&&this.ElementsAreEqual(c,u);)c--,u--;if(v[M]=c,E&&Math.abs(M-y)<=R&&c<=g[M])return s[0]=c,a[0]=u,le>=g[M]&&1447>0&&R<=1448?this.WALKTRACE(y,l,d,x,_,p,f,S,g,v,c,r,s,u,o,a,E):null}if(R<=1447){let M=new Int32Array(d-l+2);M[0]=y-l+1,Ig.Copy2(g,l,M,1,d-l+1),this.m_forwardHistory.push(M),M=new Int32Array(f-p+2),M[0]=_-p+1,Ig.Copy2(v,p,M,1,f-p+1),this.m_reverseHistory.push(M)}}return this.WALKTRACE(y,l,d,x,_,p,f,S,g,v,c,r,s,u,o,a,E)}ConcatenateChanges(e,r){let n=[];if(e.length===0||r.length===0)return r.length>0?r:e;if(this.ChangesOverlap(e[e.length-1],r[0],n)){let o=new Array(e.length+r.length-1);return Ig.Copy(e,0,o,0,e.length-1),o[e.length-1]=n[0],Ig.Copy(r,1,o,e.length,r.length-1),o}else{let o=new Array(e.length+r.length);return Ig.Copy(e,0,o,0,e.length),Ig.Copy(r,0,o,e.length,r.length),o}}ChangesOverlap(e,r,n){if(Sg.Assert(e.originalStart<=r.originalStart,"Left change is not less than or equal to right change"),Sg.Assert(e.modifiedStart<=r.modifiedStart,"Left change is not less than or equal to right change"),e.originalStart+e.originalLength>=r.originalStart||e.modifiedStart+e.modifiedLength>=r.modifiedStart){let o=e.originalStart,s=e.originalLength,a=e.modifiedStart,c=e.modifiedLength;return e.originalStart+e.originalLength>=r.originalStart&&(s=r.originalStart+r.originalLength-e.originalStart),e.modifiedStart+e.modifiedLength>=r.modifiedStart&&(c=r.modifiedStart+r.modifiedLength-e.modifiedStart),n[0]=new HS(o,s,a,c),!0}else return n[0]=null,!1}ClipDiagonalBound(e,r,n,o){if(e>=0&&e<o)return e;let s=n,a=o-n-1,c=r%2===0;if(e<0){let u=s%2===0;return c===u?0:1}else{let u=a%2===0;return c===u?o-1:o-2}}};var FV=class{constructor(){this.spacesDiff=0;this.looksLikeAlignment=!1}};function L8e(t,e,r,n,o){o.spacesDiff=0,o.looksLikeAlignment=!1;let s;for(s=0;s<e&&s<n;s++){let f=t.charCodeAt(s),m=r.charCodeAt(s);if(f!==m)break}let a=0,c=0;for(let f=s;f<e;f++)t.charCodeAt(f)===32?a++:c++;let u=0,l=0;for(let f=s;f<n;f++)r.charCodeAt(f)===32?u++:l++;if(a>0&&c>0||u>0&&l>0)return;let d=Math.abs(c-l),p=Math.abs(a-u);if(d===0){o.spacesDiff=p,p>0&&0<=u-1&&u-1<t.length&&u<r.length&&r.charCodeAt(u)!==32&&t.charCodeAt(u-1)===32&&t.charCodeAt(t.length-1)===44&&(o.looksLikeAlignment=!0);return}if(p%d===0){o.spacesDiff=p/d;return}}function Cg(t,e,r){let n=Math.min(t.length,1e4),o=0,s=0,a="",c=0,u=[2,4,6,8,3,5,7],l=8,d=[0,0,0,0,0,0,0,0,0],p=new FV;for(let h=0;h<n;h++){let g=t[h],v=g.length,y=!1,_=0,x=0,S=0;for(let E=0,R=v;E<R;E++){let B=g.charCodeAt(E);if(B===9)S++;else if(B===32)x++;else{y=!0,_=E;break}}if(!y||(S>0?o++:x>1&&s++,L8e(a,c,g,_,p),p.looksLikeAlignment&&!(r&&e===p.spacesDiff)))continue;let I=p.spacesDiff;I<=l&&d[I]++,a=g,c=_}let f=r;o!==s&&(f=o<s);let m=e;if(f){let h=f?0:.1*n;u.forEach(g=>{let v=d[g];v>h&&(h=v,m=g)}),m===4&&d[4]>0&&d[2]>0&&d[2]>=d[4]/2&&(m=2)}return{insertSpaces:f,tabSize:m}}function O8e(t,e){let r=0,n=0,o=t.length;for(;n<o;){let s=t.charCodeAt(n);if(s===32)r++;else if(s===9)r=r-r%e+e;else break;n++}return n===o?~r:r}function tO(t,e){let r=O8e(t,e);return r<0?Math.floor(~r/e):Math.floor(r/e)}function M8e(t,e){return t+e-t%e}function F8e(t,e,r){let n=0;for(let s=0;s<t.length;s++)t.charAt(s)==="	"?n=M8e(n,e):n++;let o="";if(!r){let s=Math.floor(n/e);n=n%e;for(let a=0;a<s;a++)o+="	"}for(let s=0;s<n;s++)o+=" ";return o}function UV(t,e,r){let n=Qoe(t);return n===-1&&(n=t.length),F8e(t.substring(0,n),e,r)+t.substring(n)}var gu=class{constructor(e,r,n,o="",s=`
`){this.firstLineIndex=e;this.endLineIndex=r;this.lines=n;this.prefix=o;this.suffix=s}toTextEdit(){let e=this.lines.length>0?this.prefix+this.lines.join(`
`)+this.suffix:"";return ci.replace(new Qe(this.firstLineIndex,0,this.endLineIndex,0),e)}},VS;(r=>{function t(n){return n.length===0?[]:n.split(/\r\n|\r|\n/g)}r.fromString=t;function e(n){if(n.lineCount===0)return[];let o=[];for(let s=0;s<n.lineCount;s++)o.push(n.lineAt(s).text);return o}r.fromDocument=e})(VS||={});var Ik=class t{constructor(e,r){this.text=e;this.languageId=r}static fromDocumentContext(e){return new t(e.document.getText(),e.language.languageId)}};function qV(t,e,r,n,o,s){let a=VS.fromString(r);if(a.length===e.range.lines.length&&e.range.lines.every((p,f)=>p===a[f]))return[];let c=[],u=!1;for(let p of a){let f=rO(e,p);f===null?c.push(p):(f.type==="fakestart"||f.type==="fakend")&&(u=!0)}let l;if(n===4)l=new gu(e.range.lastLineIndex,e.range.lastLineIndex,a);else{let p=q8e(e,a,o),f=W8e(t,e,c,o);if(!p)l=f;else if(!f)l=p;else{let m=dle(p);dle(f)<m?l=f:l=p}l||(l=B8e(t,e,n,o,u,c))}s&&(l=U8e(s,l,o));let d=[l];return s&&(d=j8e(s,d)),d.map(p=>p.toTextEdit())}function U8e(t,e,r){let n=t.text.split(/\r\n|\r|\n/g),o=n.slice(0,e.firstLineIndex),s=n.slice(e.endLineIndex),a=e.lines.slice(0),[,c]=fle(o,a);c>0&&a.splice(0,c),c>0&&(a=Eg(a,{whichLine:"bottomMost",lines:o.slice(o.length-c)},r).slice(0));let[u]=fle(a,s);return u>0&&a.splice(a.length-u,u),new gu(e.firstLineIndex,e.endLineIndex,a)}function B8e(t,e,r,n,o,s){return o?(t.public.trace("(case 6) Appending to selected code"),mle(e.range,s,n)):r===3?(t.public.trace("(case 7) Appending to selected code"),mle(e.range,s,n)):r===1?(t.public.trace("(case 8) Prepending to selected code"),X8e(e.range,Eg(s,e.range.lines.filter(a=>a.trim()!=="").length>0?{whichLine:"topMost",lines:e.range.lines}:{whichLine:"bottomMost",lines:e.above.lines},n))):(t.public.trace("(Default) Replacing selected code"),$d(e.range,s,n))}function dle(t){let e=t.endLineIndex-t.firstLineIndex,r=t.lines.length;return e+r}function q8e(t,e,r){let n=null,o=[];for(let s of e){let a=rO(t,s);if(a===null){o.push(s);continue}if(n){if(a.type==="end"&&a.endMarker===n)return $d(n,o,r);if(a.type==="end"&&n===t.above&&a.endMarker===t.range){let c=t.range.clone();return c.mergeFromAbove(t.above.clone()),$d(c,o,r)}if(a.type==="end"&&n===t.above&&a.endMarker===t.below){let c=t.range.clone();return c.mergeFromAbove(t.above.clone()),c.mergeFromBelow(t.below.clone()),$d(c,o,r)}}else a.type==="start"&&(n=a.startMarker,o=[])}if(o.length>0&&n)return $d(n,o,r)}function j8e(t,e){let r=[],n=t.text.split(/\r\n|\r|\n/g),o=H8e(n,c=>Tg(c,t.languageId)),s=[];for(let c of e){if(c.endLineIndex<=o+1)return e;let u=!1,l=[],d=c.lines;for(let p of d)Tg(p,t.languageId)?(s.push(Ck(p)),u=!0):u&&p.length===0||(l.push(p),u=!1);if(!u&&l.length>0){if(c.firstLineIndex<o+1)return e;r.push(new gu(c.firstLineIndex,c.endLineIndex,l))}}if(s.length===0)return e;let a=o+1;return r.unshift(new gu(a,a,s)),r}function H8e(t,e){for(let r=t.length-1;r>=0;r--)if(e(t[r]))return r;return-1}function Ck(t){return t.replace(/^\s+/g,"")}function Tg(t,e){switch(e){case"java":return!!t.match(/^\s*import\s/);case"typescript":case"javascript":return!!t.match(/^\s*import[\s{*]|^\s*[var|const|let].*=\s*require\(/);case"php":return!!t.match(/^\s*use/);case"rust":return!!t.match(/^\s*use\s+[\w:{}, ]+\s*(as\s+\w+)?;/);case"python":return!!t.match(/^\s*from\s+[\w.]+\s+import\s+[\w, *]+$/)||!!t.match(/^\s*import\s+[\w, ]+$/);default:return!1}}var V8e=/^(\t+)/,BV=new Map;function G8e(t){return BV.has(t)||BV.set(t,new RegExp(`^(( {${t}})+)`)),BV.get(t)}function jV(t,e,r){let n=e?G8e(r):V8e,o=t.match(n);return o?[o[0],o[0].length/(e?r:1)]:["",0]}function z8e(t){let{insertSpaces:e,tabSize:r}=Cg(t,4,!1),n=Number.MAX_VALUE;for(let o of t){if(/^\s*$/.test(o))continue;let[,s]=jV(o,e,r);n=Math.min(n,s)}return{insertSpaces:e,tabSize:r,minIndentLevel:n}}function ple(t,e){if(e===0)return"";if(t===" ")switch(e){case 2:return"  ";case 4:return"    ";case 8:return"        ";case 12:return"            "}if(t==="	")switch(e){case 1:return"	";case 2:return"		";case 3:return"			"}return new Array(e).fill(t).join("")}function $8e(t,e){let r=t.lines,n;if(t.whichLine==="topMost")n=r.find(o=>o!=="");else for(let o=r.length-1;o>=0;--o)if(r[o]!==""){n=r[o];break}return n===void 0?0:jV(n,e.insertSpaces,e.tabSize)[1]}function Eg(t,e,r){if(r===void 0)return t;let n=$8e(e,r),o=z8e(t),s=r.insertSpaces?ple(" ",r.tabSize):"	";return t.map(a=>{if(a==="")return"";{let[c,u]=jV(a,o.insertSpaces,o.tabSize),l=a.substring(c.length);return ple(s,n+(u-o.minIndentLevel))+l}})}function rO(t,e){switch(e){case t.above.startMarker:return{type:"start",startMarker:t.above};case t.above.endMarker:return{type:"end",endMarker:t.above};case t.range.startMarker:return{type:"start",startMarker:t.range};case t.range.endMarker:return{type:"end",endMarker:t.range};case t.below.startMarker:return{type:"start",startMarker:t.below};case t.below.endMarker:return{type:"end",endMarker:t.below}}return e.trimStart().startsWith(Ya.begin(t.language))?{type:"fakestart"}:e.trimStart().startsWith(Ya.end(t.language))?{type:"fakend"}:null}function W8e(t,e,r,n){let o=(f,m,h)=>{let g=0;for(let x of f)for(let S=x.originalStart;S<x.originalStart+x.originalLength;S++){let I=m.lines[S];g+=I.length}let v=m.getCharCount(),y=h.getCharCount(),_=v-g;return{equalCharCount:_,originalCharCount:v,modifiedCharCount:y,originalCharRatio:v>0?_/v:0,modifiedCharRatio:y>0?_/y:0}},s=f=>{let m=new Sk(f.lines),h=new Sk(r),v=new eO(m,h).ComputeDiff();return o(v,m,h)},a=e.range.clone();a.mergeFromAbove(e.above.clone()),a.mergeFromBelow(e.below.clone());let c=s(a),u=s(e.range),l={diffToEntireScore:c,diffToRangeScore:u};if(t.internal.debug(`Diff metrics: ${JSON.stringify(l,null,"	")}`),c.originalCharCount>30&&c.originalCharRatio>.7)return t.public.trace("(case 1) Replacing entire code"),$d(a,r,n);if(u.originalCharCount>20&&u.originalCharRatio>.7)return t.public.trace("(case 2) Replacing selected code"),$d(e.range,r,n);let d=Math.min(c.originalCharRatio,c.modifiedCharRatio),p=Math.min(u.originalCharRatio,u.modifiedCharRatio);if(d>.2&&d>p)return t.public.trace("(case 3) Replacing entire code"),$d(a,r,n);if(p>.2)return t.public.trace("(case 4) Replacing selected code"),$d(e.range,r,n);if(!e.range.hasContent)return t.public.trace("(case 5) Replacing empty selected code"),$d(e.range,r,n,{whichLine:"bottomMost",lines:e.above.lines})}function $d(t,e,r,n){let s=Eg(e,n??{whichLine:"topMost",lines:t.lines},r).slice(0),a=t.lines.slice(0),c=t.firstLineIndex,u=t.lastLineIndex;if(a.length===1&&a[0]==="")return new gu(u,u,s);let l=K8e(a,s);if(c+=l,a.splice(0,l),s.splice(0,l),a.length===0)return new gu(u+1,u+1,s);let d=Y8e(a,s);return u-=d,a.splice(a.length-d,d),s.splice(s.length-d,d),a.length===0?new gu(c,c,s):new gu(c,u+1,s)}function K8e(t,e){let r=Math.min(t.length,e.length);for(let n=0;n<r;n++)if(t[n]!==e[n])return n;return r}function Y8e(t,e){let r=Math.min(t.length,e.length);for(let n=0;n<r;n++)if(t[t.length-1-n]!==e[e.length-1-n])return n;return r}function fle(t,e){let r=t.filter(c=>!/^\s*$/.test(c)),n=e.filter(c=>!/^\s*$/.test(c)),o=Q8e(r,n);if(o===0)return[0,0];let s=0;for(let c=0;c<o;c++)for(s++;/^\s*$/.test(t[t.length-s]);)s++;let a=0;for(let c=0;c<o;c++)for(a++;/^\s*$/.test(e[a]);)a++;return[s,a]}function Q8e(t,e){for(let r=Math.min(t.length,e.length);r>0;r--){let n=t.length-r,o=!0;for(let s=0;s<r;s++)if(t[n+s]!==e[s]){o=!1;break}if(o)return r}return 0}function X8e(t,e){return new gu(t.firstLineIndex,t.firstLineIndex,e)}function mle(t,e,r){let n=Eg(e,{whichLine:"bottomMost",lines:t.lines},r),o=t.lastLineIndex+1;return new gu(o,o,n)}async function*HV(t,e,r){let n="",o=J8e(e);o.reverse();for await(let s of t){n+=s;let a,c=0,u="";for(;(a=n.indexOf(e,c))!==-1;)u+=n.slice(c,a)+r,c=a+e.length;c!==0&&(n=n.slice(c));for(let l of o)if(n.endsWith(l)){let d=n.length-l.length;u+=n.slice(0,d),n=n.slice(d);break}u.length>0&&(yield u)}n.length>0&&(yield n)}function J8e(t){let e=[];for(let r=0;r<=t.length;r++)e.push(t.substring(0,r));return e}var GS;(n=>{function t(){return o=>o}n.identity=t;function e(){return o=>qo.EMPTY}n.discard=e;function r(...o){return s=>o.reduce((a,c)=>c(a),s)}n.chain=r})(GS||={});function hle(t,e){return(async()=>{for await(let r of t)e(r)})()}var nO=class{constructor(e){this.values=e,this.prefixSum=new Uint32Array(e.length),this.prefixSumValidIndex=new Int32Array(1),this.prefixSumValidIndex[0]=-1}getCount(){return this.values.length}insertValues(e,r){e=jb(e);let n=this.values,o=this.prefixSum,s=r.length;return s===0?!1:(this.values=new Uint32Array(n.length+s),this.values.set(n.subarray(0,e),0),this.values.set(n.subarray(e),e+s),this.values.set(r,e),e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),this.prefixSum=new Uint32Array(this.values.length),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(o.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}setValue(e,r){return e=jb(e),r=jb(r),this.values[e]===r?!1:(this.values[e]=r,e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),!0)}removeValues(e,r){e=jb(e),r=jb(r);let n=this.values,o=this.prefixSum;if(e>=n.length)return!1;let s=n.length-e;return r>=s&&(r=s),r===0?!1:(this.values=new Uint32Array(n.length-r),this.values.set(n.subarray(0,e),0),this.values.set(n.subarray(e+r),e),this.prefixSum=new Uint32Array(this.values.length),e-1<this.prefixSumValidIndex[0]&&(this.prefixSumValidIndex[0]=e-1),this.prefixSumValidIndex[0]>=0&&this.prefixSum.set(o.subarray(0,this.prefixSumValidIndex[0]+1)),!0)}getTotalSum(){return this.values.length===0?0:this._getPrefixSum(this.values.length-1)}getPrefixSum(e){return e<0?0:(e=jb(e),this._getPrefixSum(e))}_getPrefixSum(e){if(e<=this.prefixSumValidIndex[0])return this.prefixSum[e];let r=this.prefixSumValidIndex[0]+1;r===0&&(this.prefixSum[0]=this.values[0],r++),e>=this.values.length&&(e=this.values.length-1);for(let n=r;n<=e;n++)this.prefixSum[n]=this.prefixSum[n-1]+this.values[n];return this.prefixSumValidIndex[0]=Math.max(this.prefixSumValidIndex[0],e),this.prefixSum[e]}getIndexOf(e){e=Math.floor(e),this.getTotalSum();let r=0,n=this.values.length-1,o=0,s=0,a=0;for(;r<=n;)if(o=r+(n-r)/2|0,s=this.prefixSum[o],a=s-this.values[o],e<a)n=o-1;else if(e>=s)r=o+1;else break;return new VV(o,e-a)}};var VV=class{constructor(e,r){this.index=e;this.remainder=r;this._prefixSumIndexOfResultBrand=void 0;this.index=e,this.remainder=r}};var Yf=class{constructor(e){this._lines=Gb(e),this._eol=e.charAt(this._lines[0].length)==="\r"?`\r
`:`
`;let r=new Uint32Array(this._lines.length);for(let n=0;n<this._lines.length;n++)r[n]=this._lines[n].length+this._eol.length;this._lineStarts=new nO(r)}_getText(){return this._lines.join(this._eol)}applyOffsetEdits(e){let{edits:r}=e;for(let n=r.length-1;n>=0;n--){let o=r[n],s=this.toRange(o.replaceRange);this._acceptDeleteRange(s),this._acceptInsertText(s.start,o.newText)}}_acceptDeleteRange(e){if(e.start.line===e.end.line){if(e.start.character===e.end.character)return;this._setLineText(e.start.line,this._lines[e.start.line].substring(0,e.start.character)+this._lines[e.start.line].substring(e.end.character));return}this._setLineText(e.start.line,this._lines[e.start.line].substring(0,e.start.character)+this._lines[e.end.line].substring(e.end.character)),this._lines.splice(e.start.line+1,e.end.line+1-e.start.line+1),this._lineStarts.removeValues(e.start.line+1,e.end.line+1-e.start.line+1)}_acceptInsertText(e,r){if(r.length===0)return;let n=Gb(r);if(n.length===1){this._setLineText(e.line,this._lines[e.line].substring(0,e.character)+n[0]+this._lines[e.line].substring(e.character));return}n[n.length-1]+=this._lines[e.line].substring(e.character),this._setLineText(e.line,this._lines[e.line].substring(0,e.character)+n[0]);let o=new Uint32Array(n.length-1);for(let s=1;s<n.length;s++)this._lines.splice(e.line+1+s-1,0,n[s]),o[s-1]=n[s].length+this._eol.length;this._lineStarts.insertValues(e.line+1,o)}_setLineText(e,r){this._lines[e]=r,this._lineStarts.setValue(e,this._lines[e].length+this._eol.length)}getLineCount(){return this._lines.length}getOffset(e){return e=this.validatePosition(e),this._lineStarts.getPrefixSum(e.line-1)+e.character}getPosition(e){e=Math.floor(e),e=Math.max(0,e);let r=this._lineStarts.getIndexOf(e),n=this._lines[r.index].length;return new rn(r.index,Math.min(r.remainder,n))}toRange(e){return new Qe(this.getPosition(e.start),this.getPosition(e.endExclusive))}toOffsetRange(e){return new Qt(this.getOffset(e.start),this.getOffset(e.end))}toOffsetEdit(e){let r=e.map(n=>new ci(this.validateRange(n.range),n.newText));return new on(r.map(n=>new Io(this.toOffsetRange(n.range),n.newText)))}toTextEdits(e){return e.edits.map(r=>new ci(this.toRange(r.replaceRange),r.newText))}validatePosition(e){if(!(e instanceof rn))throw new Error("Invalid argument");if(this._lines.length===0)return e.with(0,0);let{line:r,character:n}=e,o=!1;if(r<0)r=0,n=0,o=!0;else if(r>=this._lines.length)r=this._lines.length-1,n=this._lines[r].length,o=!0;else{let s=this._lines[r].length;n<0?(n=0,o=!0):n>s&&(n=s,o=!0)}return o?new rn(r,n):e}validateRange(e){return new Qe(this.validatePosition(e.start),this.validatePosition(e.end))}};function gle(t){let r=t.split(/\r?\n/).map(Z8e),n=r.filter(s=>s===1).length,o=r.filter(s=>s===2).length;return n>o}function Z8e(t){if(t.length===0)return 0;let e=0,r=0;if(["==","!=","===","!==",">=","<=","&&","||",">>",">>>","<<","<<<","+=","-=","*=","/=","%=","<<=","<<<=",">>=",">>>=","++","--","=>","->","...","??","??="].some(o=>t.includes(o))||t.match(/^\s/)||t.match(/^[;{}()\[\]`~?]/))return 1;t.charAt(0).match(/[A-Z]/)&&(e+=1),t[t.length-1]==="."&&(e+=1),lj(t)||(e+=1);{lj(t.charAt(0))&&!t.charAt(0).match(/[A-Z]/)&&(r+=1),t.match(/^\s/)&&(r+=1);let s=[";","{","}","(",")","[","]","`","~","#","$","%","^","&","*","_","=","+","\\","|","<",">"].map(a=>t.includes(a)?1:0).filter(a=>a).length;r+=s}return e>r?2:r>e?1:0}var $S=class{constructor(e,r,n,o,s=!0,a=Ek.noop){this.myDocument=e;this.initialSelection=r;this.adjustedSelection=n;this.editStrategy=o;this.collectImports=s;this.lineFilter=a;this.replyIndentationTracker=null}async processStream(e){let r=qo.filter(e,this.lineFilter);this.collectImports&&(r=zV(r,this.myDocument,this.adjustedSelection));let n=this.myDocument.firstSentLineIndex;for await(let o of this.findInitialAnchor(r))o instanceof oO?n=this.handleFirstReplyLine(o.anchor,o.line):n=this.handleSubsequentReplyLine(n,o.value);return this.myDocument.didReplaceEdits&&n<=this.adjustedSelection.end.line&&this.myDocument.deleteLines(n,this.adjustedSelection.end.line),new Tk(this.myDocument.didNoopEdits,this.myDocument.didEdits,this.myDocument.additionalImports)}handleFirstReplyLine(e,r){if(e){this.replyIndentationTracker=new WS(this.myDocument,e.lineIndex,r);let s=this.replyIndentationTracker.reindent(r,this.myDocument.indentStyle);return this.myDocument.getLine(e.lineIndex).sentInCodeBlock===2?this.myDocument.replaceLines(this.adjustedSelection.start.line,e.lineIndex,s):this.myDocument.replaceLine(e.lineIndex,s)}let n=this.adjustedSelection.start.line;this.replyIndentationTracker=new WS(this.myDocument,n,r);let o=this.replyIndentationTracker.reindent(r,this.myDocument.indentStyle);if(this.initialSelection.isEmpty){let s=this.myDocument.getLine(n).content;if(/^\s*$/.test(s)||o.adjustedContent.startsWith(s))return this.myDocument.replaceLine(n,o,!0)}return this.editStrategy===1?this.myDocument.insertLineBefore(n,o):this.editStrategy===3||this.editStrategy===4?this.myDocument.insertLineAfter(n,o):this.myDocument.replaceLine(n,o)}handleSubsequentReplyLine(e,r){let n=this.replyIndentationTracker.reindent(r,this.myDocument.indentStyle);if(n.trimmedContent!==""||this.myDocument.didReplaceEdits){let s=this.matchReplyLine(n,e);if(s)return this.myDocument.replaceLines(e,s.lineIndex,n)}if(e>=this.myDocument.getLineCount())return this.myDocument.appendLineAtEndOfDocument(n);let o=this.myDocument.getLine(e);return!o.isSent||o.content===""||n.trimmedContent===""?this.myDocument.insertLineBefore(e,n):o.indentLevel<n.adjustedIndentLevel?this.myDocument.insertLineBefore(e,n):o.indentLevel===n.adjustedIndentLevel&&!this.myDocument.didReplaceEdits?this.myDocument.insertLineBefore(e,n):this.myDocument.replaceLine(e,n)}matchReplyLine(e,r){let n=e.trimmedContent.length<=3;for(let o=r;o<this.myDocument.getLineCount();o++){let s=this.myDocument.getLine(o);if(s.isSent){if(s.normalizedContent===e.adjustedContent)return new lO(o);if(s.trimmedContent.length>0&&s.indentLevel<e.adjustedIndentLevel||n&&s.trimmedContent.length>0)return null}}return null}findInitialAnchor(e){return new qo(async r=>{let n=[],o=0,s=!1;for await(let a of e)if(s)r.emitOne(a);else if(n.push(a),o+=a.value.trim().length,o>10){let c=this.searchForEqualSentLines(n);s=!0,r.emitOne(new oO(n[0].value,c)),r.emitMany(n.slice(1))}})}searchForEqualSentLines(e){let r=e.map(n=>n.value.trim());for(let n=this.myDocument.firstSentLineIndex,o=this.myDocument.getLineCount()-e.length;n<=o;n++){if(!this.myDocument.getLine(n).isSent)continue;let s=!0;for(let a=0;a<r.length;a++){let c=this.myDocument.getLine(n+a);if(!c.isSent||c.trimmedContent!==r[a]){s=!1;break}}if(s)return new lO(n)}return null}},kg=class{constructor(e,r,n=Ek.noop){this._myDocument=e;this._cursorPosition=r;this._lineFilter=n;this.replyIndentationTracker=null}async processStream(e){let r=qo.filter(e,this._lineFilter);r=zV(r,this._myDocument,new Qe(this._cursorPosition,this._cursorPosition));let n=0;for await(let o of r)this.replyIndentationTracker?n=this.handleSubsequentReplyLine(n,o.value):n=this.handleFirstReplyLine(o.value);return new Tk(this._myDocument.didNoopEdits,this._myDocument.didEdits,this._myDocument.additionalImports)}handleFirstReplyLine(e){let r=this._cursorPosition.line,n=this._myDocument.getLine(r).content,o=/^\s*$/.test(n)||e.trimStart().startsWith(n.trimStart()),s=o||this._myDocument.getLineCount()<=r+1?r:r+1;this.replyIndentationTracker=new WS(this._myDocument,s,e);let a=this.replyIndentationTracker.reindent(e,this._myDocument.indentStyle);return o?this._myDocument.replaceLine(r,a,!0):this._myDocument.insertLineAfter(r,a)}handleSubsequentReplyLine(e,r){let n=this.replyIndentationTracker.reindent(r,this._myDocument.indentStyle);return this._myDocument.insertLineBefore(e,n)}},iO=class{constructor(e,r,n=Ek.noop){this._myDocument=e;this._selection=r;this._lineFilter=n;this.replyIndentationTracker=null}async processStream(e){let r=qo.filter(e,this._lineFilter);r=zV(r,this._myDocument,this._selection);let n=0,o,s="";this._selection.end.line>this._selection.start.line&&this._selection.end.character===0?o=this._selection.end.line-this._selection.start.line:(o=this._selection.end.line-this._selection.start.line+1,s=this._myDocument.getLine(this._selection.end.line).content.substring(this._selection.end.character));for await(let a of r)if(this.replyIndentationTracker){let c=this.replyIndentationTracker.reindent(a.value,this._myDocument.indentStyle);o>0?(n=this._myDocument.replaceLine(n,c),o--):n=this._myDocument.insertLineAfter(n-1,c)}else{let c=this._selection.start.line;this.replyIndentationTracker=new WS(this._myDocument,c,a.value);let u=this.replyIndentationTracker.reindent(a.value,this._myDocument.indentStyle);n=this._myDocument.replaceLine(c,u),o--}return this._myDocument.didEdits&&o>0&&this._myDocument.deleteLines(n,n+o-1),this._myDocument.didEdits&&s.length>0&&this._myDocument.replaceLine(n-1,this._myDocument.getLine(n-1).content+s),new Tk(this._myDocument.didNoopEdits,this._myDocument.didEdits,this._myDocument.additionalImports)}},Tk=class{constructor(e,r,n){this.didNoopEdits=e;this.didEdits=r;this.additionalImports=n}},WS=class{constructor(e,r,n){let o=0;for(let a=r;a>=0;a--){let c=e.getLine(a);if(c.content.length>0){o=c.indentLevel,a!==r&&(c.content.endsWith("{")||e.languageId==="python"&&c.content.endsWith(":"))&&(o+=1);break}}this._replyIndentStyle=zS.guessIndentStyleFromLine(n);let s=tO(n,this._replyIndentStyle?.tabSize??4);this.indentDelta=s-o}reindent(e,r){if(e==="")return new uO("",0,"",0);this._replyIndentStyle||(this._replyIndentStyle=zS.guessIndentStyleFromLine(e));let n=0,o=0,s=c=>(n=c,o=Math.max(n-this.indentDelta,0),o),a=zS.reindentLine(e,this._replyIndentStyle??{insertSpaces:!0,tabSize:4},r,s);return new uO(e,n,a,o)}},oO=class{constructor(e,r){this.line=e;this.anchor=r}},sO=class{constructor(e,r){this.lineIndex=e;this.sentInCodeBlock=r}},aO=class{constructor(e,r){this.startLineIndex=e;this.endLineIndex=r}},cO=class{constructor(e,r,n,o,s,a,c){this.outputStream=e;this.uri=r;this.languageId=a;this._originalLines=[];this.lines=[];this._didNoopEdits=!1;this._didEdits=!1;this._didReplaceEdits=!1;this._additionalImports=[];this.indentStyle=zS.getDocumentIndentStyle(n,c),this._originalLines=n.split(/\r\n|\r|\n/g);for(let u=0;u<this._originalLines.length;u++)this.lines[u]=new wg(this._originalLines[u],this.indentStyle);this.firstSentLineIndex=Number.MAX_SAFE_INTEGER;for(let u of o)this.lines[u.lineIndex].markSent(u.sentInCodeBlock),this.firstSentLineIndex=Math.min(this.firstSentLineIndex,u.lineIndex);this.firstSentLineIndex=Math.min(this.firstSentLineIndex,s.startLineIndex)}get didNoopEdits(){return this._didNoopEdits}get didEdits(){return this._didEdits}get didReplaceEdits(){return this._didReplaceEdits}get additionalImports(){return this._additionalImports}getText(){return this.lines.map(e=>e.content).join(`
`)}getLineCount(){return this.lines.length}getLine(e){if(e<0||e>=this.lines.length)throw new Error("Invalid index");return this.lines[e]}addAdditionalImport(e){this._additionalImports.push(e)}replaceLine(e,r,n=!1){let o=typeof r=="string"?r:r.adjustedContent;return this.lines[e].content===o?(this._didNoopEdits=!0,e+1):(this.lines[e]=new wg(o,this.indentStyle),this.outputStream.textEdit(this.uri,[new ci(new Qe(e,0,e,1073741824),o)]),this._didEdits=!0,this._didReplaceEdits=this._didReplaceEdits||!n,e+1)}replaceLines(e,r,n){if(e>r)throw new Error("Invalid range");return e===r?this.replaceLine(e,n):(this.lines.splice(e,r-e+1,new wg(n.adjustedContent,this.indentStyle)),this.outputStream.textEdit(this.uri,[new ci(new Qe(e,0,r,1073741824),n.adjustedContent)]),this._didEdits=!0,this._didReplaceEdits=!0,e+1)}appendLineAtEndOfDocument(e){return this.lines.push(new wg(e.adjustedContent,this.indentStyle)),this.outputStream.textEdit(this.uri,[new ci(new Qe(this.lines.length-1,1073741824,this.lines.length-1,1073741824),`
`+e.adjustedContent)]),this._didEdits=!0,this.lines.length}insertLineAfter(e,r){return this.lines.splice(e+1,0,new wg(r.adjustedContent,this.indentStyle)),this.outputStream.textEdit(this.uri,[new ci(new Qe(e,1073741824,e,1073741824),`
`+r.adjustedContent)]),this._didEdits=!0,e+2}insertLineBefore(e,r){return e===this.lines.length?this.insertLineAfter(e-1,r):(this.lines.splice(e,0,new wg(r.adjustedContent,this.indentStyle)),this.outputStream.textEdit(this.uri,[new ci(new Qe(e,0,e,0),r.adjustedContent+`
`)]),this._didEdits=!0,e+1)}deleteLines(e,r){return this.lines.splice(e,r-e+1),this.outputStream.textEdit(this.uri,[new ci(new Qe(e,0,r+1,0),"")]),this._didEdits=!0,this._didReplaceEdits=!0,e+1}},uO=class{constructor(e,r,n,o){this.originalContent=e;this.originalIndentLevel=r;this.adjustedContent=n;this.adjustedIndentLevel=o;this.trimmedContent=this.originalContent.trim()}},lO=class{constructor(e){this.lineIndex=e}};var wg=class{constructor(e,r){this.content=e;this._indentStyle=r;this._sentInCodeBlock=0;this._trimmedContent=null;this._normalizedContent=null;this._indentLevel=-1}get isSent(){return this._sentInCodeBlock!==0}get sentInCodeBlock(){return this._sentInCodeBlock}get trimmedContent(){return this._trimmedContent===null&&(this._trimmedContent=this.content.trim()),this._trimmedContent}get normalizedContent(){return this._normalizedContent===null&&(this._normalizedContent=UV(this.content,this._indentStyle.tabSize,this._indentStyle.insertSpaces)),this._normalizedContent}get indentLevel(){return this._indentLevel===-1&&(this._indentLevel=tO(this.content,this._indentStyle.tabSize)),this._indentLevel}markSent(e){this._sentInCodeBlock=e}},zS=class t{static getDocumentIndentStyle(e,r){return r||Cg(VS.fromString(e),4,!1)}static guessIndentStyleFromLine(e){let r=t._getLeadingWhitespace(e);if(!(r===""||r===" "))return Cg([e],4,!1)}static reindentLine(e,r,n,o=s=>s){let s=tO(e,r.tabSize),a=o(s);for(;s>0;)e=this._outdent(e,r),s--;for(;s<a;)e="	"+e,s++;return UV(e,n.tabSize,n.insertSpaces)}static _outdent(e,r){let n=0;for(;n<e.length;){let o=e.charCodeAt(n);if(o===9){n++;break}if(o!==32||n===r.tabSize)break;n++}return e.substring(n)}static _getLeadingWhitespace(e){for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);if(n!==32&&n!==9)return e.substring(0,r)}return e}};var Ek=class{static combine(...e){return r=>e.every(n=>n?n(r):!0)}static{this.noop=()=>!0}static createCodeBlockFilter(){let e;(a=>(a[a.BeforeCodeBlock=0]="BeforeCodeBlock",a[a.InCodeBlock=1]="InCodeBlock",a[a.AfterCodeBlock=2]="AfterCodeBlock"))(e||={});let r=0;return n=>r===0?(/^```/.test(n.value)&&(r=1),!1):r===1?/^```/.test(n.value)?(r=2,!1):!0:!1}static createCodeMarkerRemovingFilter(e){let r=Ya.begin(e),n=Ya.end(e),o=!0,s=!1;return a=>o&&hu.testLine(e,a.value)?(o=!1,!1):!s&&/^\s*$/.test(a.value)||a.value.startsWith(r)||a.value.startsWith(n)?!1:(s=!0,!0)}},dO=class{constructor(e){this.value=e;this.__lineOfTextBrand=void 0}};var Rg=class{constructor(e,r){this.value=e;this.kind=r}},Ai=class t{static createCodeBlockClassifier(){return t.attemptToRecoverFromMissingCodeBlock(t.createFencedBlockClassifier("```"))}static attemptToRecoverFromMissingCodeBlock(e){return r=>new qo(async n=>{let o=[],s=!0;for await(let a of e(r))if(!s)n.emitOne(a);else if(a.kind===0)o.push(a);else{s=!1;for(let c of o)n.emitOne(c);o.length=0,n.emitOne(a)}if(s){let a=o.map(c=>c.value).join("");gle(a)?n.emitOne(new Rg(a,1)):n.emitOne(new Rg(a,0))}})}static createAlwaysInsideCodeBlockClassifier(){return e=>qo.map(e,r=>new Rg(r,1))}static createFencedBlockClassifier(e){return r=>new qo(async n=>{let o=new GV(r[Symbol.asyncIterator]()),s=0;for(;!o.endOfStream;)if(await o.peek(e.length)!==e)for(;!o.endOfStream;){let c=o.readImmediateExcept(`
`);if(c.length>0&&n.emitOne(new Rg(c,s)),await o.peek(1)===`
`){o.readImmediate(1),n.emitOne(new Rg(`
`,s));break}}else{let c="";for(;!o.endOfStream;){let u=o.readImmediateExcept(`
`);if(c+=u,await o.peek(1)===`
`){o.readImmediate(1),c+=`
`,s=s===1?0:1,n.emitOne(new Rg(c,2));break}}}})}},GV=class{constructor(e){this._source=e;this._buffer="";this._atEnd=!1}get endOfStream(){return this._buffer.length===0&&this._atEnd}async extendBuffer(){if(this._atEnd)return;let{value:e,done:r}=await this._source.next();r?this._atEnd=!0:this._buffer+=e}async waitForLength(e){for(;this._buffer.length<e&&!this._atEnd;)await this.extendBuffer()}async peek(e){return await this.waitForLength(e),this._buffer.substring(0,e)}async read(e){await this.waitForLength(e);let r=this._buffer.substring(0,e);return this._buffer=this._buffer.substring(e),r}readImmediateExcept(e){let r=this._buffer.indexOf(e);return this.readImmediate(r===-1?this._buffer.length:r)}readImmediate(e){let r=this._buffer.substring(0,e);return this._buffer=this._buffer.substring(e),r}},pO=class{},fO=class t{constructor(e){this._source=e;this._buffer=[];this._atEnd=!1}static{this.EOS=new pO}get endOfStream(){return this._buffer.length===0&&this._atEnd}async extendBuffer(){if(this._atEnd)return;let{value:e,done:r}=await this._source.next();r?this._atEnd=!0:this._buffer.push(e)}async peek(){return this._buffer.length===0&&!this._atEnd&&await this.extendBuffer(),this._buffer.length===0?t.EOS:this._buffer[0]}async read(){return this._buffer.length===0&&!this._atEnd&&await this.extendBuffer(),this._buffer.length===0?t.EOS:this._buffer.shift()}async readWhile(e,r){do{let n=await this.peek();if(n instanceof pO||!e(n))break;await this.read(),await r(n)}while(!0)}async consumeToEnd(){for(;!this.endOfStream;)await this.read()}};function vle(t){return new qo(async e=>{let r="";for await(let n of t){r+=n;do{let o=r.indexOf(`
`);if(o===-1)break;let s=r.substring(0,o);r=r.substring(o+1),e.emitOne(new dO(s))}while(!0)}r.length>0&&e.emitOne(new dO(r))})}function e9e(t,e){let r=e.start.character===0?e.start.line:e.start.line+1,n=t.getLine(e.end.line).content.length===e.end.character?e.end.line:e.end.line-1;for(let o=r;o<=n;o++)if(Tg(t.getLine(o).content,t.languageId))return!0;return!1}function zV(t,e,r){if(e9e(e,r))return t;let n=!1,o=!1;return t.filter(s=>Tg(s.value,e.languageId)?(e.addAdditionalImport(Ck(s.value)),n=!0,!1):s.value.trim().length===0&&n?o:(o=!0,!0))}var wk=class extends Error{constructor(e){super(typeof e=="string"?e:e.message),this.errorDetails=typeof e=="string"?{message:e}:e}},Hn=class extends cu{constructor(r){super();this.replyInterpreter=r}},KS=class extends cu{constructor(r){super();this.followUps=r}};var mO=class{async processResponse(e,r,n){for await(let o of e)r.markdown(o.delta.text);return{type:"conversational"}}};var Yo={Mute:GS.discard(),Emit:GS.identity()};var hO=class{constructor(e,r,n,o,s){this._outputStream=e;this._leadingMarkdownStreamPipe=r;this._earlyStopping=n;this._responseStream=new Wh;this._lastLength=0;this._leftFirstCodeBlock=!1;let a=o(this._responseStream.asyncIterable);this._streamingPromise=this._process(a,s)}async _process(e,r){let n=new Wh,o=this._leadingMarkdownStreamPipe(n.asyncIterable);hle(o,d=>this._outputStream.markdown(d));let s=new Wh,a=vle(s.asyncIterable),c=r.processStream(a),u=e.filter(d=>d.kind!==2),l=new fO(u[Symbol.asyncIterator]());return await l.readWhile(d=>d.kind===0,d=>n.emitOne(d.value)),n.resolve(),await l.readWhile(d=>d.kind===1,d=>s.emitOne(d.value)),this._leftFirstCodeBlock=!0,await l.consumeToEnd(),s.resolve(),c}update(e){if(this._earlyStopping===1&&this._leftFirstCodeBlock)return{shouldFinish:!0};let r=e.slice(this._lastLength);return this._lastLength=e.length,this._responseStream.emitOne(r),{shouldFinish:!1}}async finish(){return this._responseStream.resolve(),await this._streamingPromise}};function _le(t,e,r){let n=e.getText(),o=Rk.convertToLinkedTree(n,xle(t,n)),s=e.offsetAt(r.start),a=e.offsetAt(r.end);return{adjusted:n9e(o,s,a),original:new Qt(s,a)}}function xle(t,e){let r=t9e(t.startIndex,e),n=Math.max(r,r9e(t.endIndex,e)),o=t.children.map(s=>xle(s,e));return r===t.startIndex&&n===t.endIndex&&xR(o,t.children)?t:new Gd(r,n,t.kind,o)}function t9e(t,e){for(;t<e.length;){let r=e.charCodeAt(t);if(r!==32&&r!==9&&r!==10&&r!==13)return t;t++}return t}function r9e(t,e){for(;t>0;){let r=e.charCodeAt(t-1);if(r!==32&&r!==9&&r!==10&&r!==13)return t;t--}return t}function n9e(t,e,r){return[e,r]=i9e(t,e,r),o9e(t,e,r)}function i9e(t,e,r){let n=t.text.substring(e,r);if(!/^\s*$/.test(n))return[e,r];let s=e,a=r,c=!0,u=!0;do{if(u&&a>=t.text.length&&(u=!1),u){let l=t.text.charCodeAt(a);if(l===13||l===10)u=!1;else{if(l!==32&&l!==9)return[a,a+1];a++}}if(c&&s===0&&(c=!1),c){let l=t.text.charCodeAt(s-1);if(l===13||l===10)c=!1;else{if(l!==32&&l!==9)return[s-1,s];s--}}}while(c||u);return[e,r]}function o9e(t,e,r){e>0&&e<r&&t.text.charCodeAt(e-1)!==10&&t.text.charCodeAt(e)===10&&e++,e=ble(t,e),r=yle(t,r);let n=t.findLeaf2(e),o=t.findLeaf2(r),s=!1,a=u=>{u<e&&(e=ble(t,u),s=!0,n=t.findLeaf2(e))},c=u=>{u>r&&(r=yle(t,u),s=!0,o=t.findLeaf2(r))};do{if(s=!1,n instanceof kk){let u=n.isFirstGapInParent?n.parent.lastGap:null,l=n.hasSelectedContent(e,r),d=u&&u.hasSelectedContent(e,r),p=l||d;p&&a(n.firstNonWhitespaceIndex),p&&u&&c(u.lastNonWhitespaceIndex+1)}if(o instanceof kk){let u=o.isLastGapInParent?o.parent.firstGap:null,l=o.hasSelectedContent(e,r),d=u&&u.hasSelectedContent(e,r),p=l||d;p&&o.lastNonWhitespaceIndex+1>r&&c(o.lastNonWhitespaceIndex+1),p&&u&&a(u.firstNonWhitespaceIndex)}n instanceof Rk&&t.hasContentInRange(new Qt(e,r))&&n.startIndex<e&&a(n.startIndex),o instanceof Rk&&t.hasContentInRange(new Qt(e,r))&&o.endIndex>r&&c(o.endIndex)}while(s);return new Qt(e,r)}function ble(t,e){for(;e>0;){let r=t.text.charCodeAt(e-1);if(r!==32&&r!==9)break;e--}return e}function yle(t,e){if((e>0?t.text.charCodeAt(e-1):0)===10)return e;for(;e<t.text.length;){let n=t.text.charCodeAt(e);if(n!==32&&n!==9)break;e++}return e}function Sle(t){return t.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")}var Rk=class t{constructor(e,r,n,o,s,a,c){this._originalText=e;this.parent=r;this.startIndex=n;this.endIndex=o;this.kind=s;this.children=a;this.myIndex=c}static convertToLinkedTree(e,r){let n=new t(e,null,r.startIndex,r.endIndex,r.kind,[],0);return t._convertChildrenToLinkedTree(e,r,n),n}static _convertChildrenToLinkedTree(e,r,n){for(let o=0;o<r.children.length;o++){let s=r.children[o],a=new t(e,n,s.startIndex,s.endIndex,s.kind,[],o);n.children.push(a),t._convertChildrenToLinkedTree(e,s,a)}}get text(){return this._originalText.substring(this.startIndex,this.endIndex)}textAt(e){return e.substring(this._originalText)}hasContentInRange(e){let r=this.textAt(e);return!/^\s*$/s.test(r)}toString(){return`Node (${this.startIndex}-${this.endIndex}) ${Sle(this._originalText.substring(this.startIndex,this.endIndex))}`}gapBeforeChild(e){let r=e===0?this.startIndex:this.children[e-1].endIndex,n=e===this.children.length?this.endIndex:this.children[e].startIndex;return new kk(this._originalText,this,r,n,e)}childAt(e){return this.children[e]??null}get firstGap(){return this.children.length===0?null:this.gapBeforeChild(0)}get lastGap(){return this.children.length===0?null:this.gapBeforeChild(this.children.length)}findLeaf(e){if(this.children.length===0)return[this,0];let r=Yq(this.children.length,n=>{let o=this.children[n];return e>=o.startIndex&&e<=o.endIndex?0:e<o.startIndex?1:-1});return r<0?[this,r]:this.children[r].findLeaf(e)}findLeaf2(e){let[r,n]=this.findLeaf(e);return n<0?r.gapBeforeChild(~n):r}get nextLeaf(){let e=this;do{let r=e.nextSibling;if(r)return r.leftMostLeafChild;e=e.parent}while(e);return null}get leftMostLeafChild(){let e=this;for(;e.children.length>0;)e=e.children[0];return e}get prevSibling(){let e=this.parent,r=this.myIndex-1;return e&&r>=0?e.children[r]:null}get nextSibling(){let e=this.parent,r=this.myIndex+1;return e&&r<e.children.length?e.children[r]:null}},kk=class{constructor(e,r,n,o,s){this._originalText=e;this.parent=r;this.startIndex=n;this.endIndex=o;this.gapIndex=s;if(this.startIndex>this.endIndex)throw new Qr("Invalid gap")}get range(){return new Qt(this.startIndex,this.endIndex)}get isFirstGapInParent(){return this.gapIndex===0}get isLastGapInParent(){return this.gapIndex===this.parent.children.length}toString(){return`NodeGap (${this.startIndex}-${this.endIndex}) ${Sle(this._originalText.substring(this.startIndex,this.endIndex))}`}get text(){return this._originalText.substring(this.startIndex,this.endIndex)}hasSelectedContent(e,r){let n=this.range.intersect(new Qt(e,r)),o=n?this._originalText.substring(n.start,n.endExclusive):"";return!/^\s*$/s.test(o)}get firstNonWhitespaceIndex(){let e=this.startIndex;for(;e<this.endIndex;){let r=this._originalText.charCodeAt(e);if(r!==9&&r!==32&&r!==10)return e;e++}return this.endIndex}get lastNonWhitespaceIndex(){let e=this.endIndex-1;for(;e>=this.startIndex;){let r=this._originalText.charCodeAt(e);if(r!==9&&r!==32&&r!==10)return e;e--}return this.startIndex-1}get nextLeaf(){let e=this.parent.childAt(this.gapIndex);return e?e.leftMostLeafChild:this.parent.nextLeaf}};function $V(t,e){let r=e(t);return{...r,range:[r.range.start,r.range.endExclusive],children:r.children?.map(n=>$V(n,e))}}function Ile(t,e){let r=zx(e,a=>a.endExclusive>=t.start),n=Fh(e,a=>a.start<=t.endExclusive)+1;if(r===n)return[t];let o=[],s=t.start;for(let a=r;a<n;a++){let c=e[a];c.start>s&&o.push(new Qt(s,c.start)),s=c.endExclusive}return s<t.endExclusive&&o.push(new Qt(s,t.endExclusive)),o}var Lc=class{constructor(e,r,n){this.originalText=e;this.edits=r;this.languageId=n;this._positionOffsetTransformer=new Ti(()=>new Yf(this.text));this._originalPositionOffsetTransformer=new Ti(()=>new Yf(this.originalText));this._text=new Ti(()=>this.edits.apply(this.originalText))}get positionOffsetTransformer(){return this._positionOffsetTransformer.value}get originalPositionOffsetTransformer(){return this._originalPositionOffsetTransformer.value}get text(){return this._text.value}get lineCount(){return this.positionOffsetTransformer.getLineCount()}project(e){return this.edits.applyToOffset(e)}projectOffsetRange(e){return this.edits.applyToOffsetRange(e)}projectRange(e){let r=this.originalPositionOffsetTransformer.toOffsetRange(e),n=this.projectOffsetRange(r);return this.positionOffsetTransformer.toRange(n)}projectBack(e){return this.edits.applyInverseToOffset(e)}projectBackOffsetEdit(e){return e.tryRebase(this.edits.inverse(this.originalText))}projectBackTextEdit(e){let r=this.positionOffsetTransformer.toOffsetEdit(e),n=this.projectBackOffsetEdit(r);return this.originalPositionOffsetTransformer.toTextEdits(n)}};function Cle(t){return t*4}async function Tle(t,e,r,n,o,s){let a=await uy(t,e,r),c=_le(a,e,n),u=QS(Cle(o),e,n,a,s);return{document:u,adjustedSelection:u.projectOffsetRange(c.adjusted),selection:u.projectOffsetRange(c.original)}}var Wd=class{constructor(e){this._parserService=e}summarizeDocument(e,r,n,o,s){return Ak(this._parserService,e,r,n,o,s)}};Wd=w([b(0,_t)],Wd);async function Ak(t,e,r,n,o,s){let a=await uy(t,e,r);return QS(Cle(o),e,n,a,s)}function QS(t,e,r,n,o={}){let s=e.getText(),a=new WV(s,e.languageId),c=r?new Qt(e.offsetAt(r.start),e.offsetAt(r.end)):void 0,u=KV.fromNode(n,a),l=YV.fromNode(u,s),d=QV.fromNode(l,!!o.tryPreserveTypeChecking);c&&d.visitAll(E=>E.node.range.intersectsOrTouches(c)?(E.node.children.length===0&&E.markAsSurviving(),!0):!1);let p=d.getTextFragment(),f=E=>c?E.range.endExclusive<c.start?c.start-E.range.endExclusive:E.range.start>c.endExclusive?3*(E.range.start-c.endExclusive):0:0,m=new qb(E=>c?E.children.length===0?E.range.intersectsOrTouches(c)?0:Number.MAX_SAFE_INTEGER:Math.min(...E.children.map(R=>m.get(R)))+1:0),h=new qb(E=>{let R=E.parent?h.get(E.parent):Number.MAX_SAFE_INTEGER,B=m.get(E);return Math.min(R,B)}),g=!!o.tryPreserveTypeChecking,v=E=>g&&E.node?.kind==="import_statement"?0:100*h.get(E)+E.depth+10*(f(E)/s.length),y=typeof o.costFnOverride=="object"?o.costFnOverride.createCostFn(a):o.costFnOverride;if(y!==void 0){let E=v;v=R=>{let B=E(R);return R.node?y(R.node,B):B}}let x=d.getDescendantsAndSelf().map(E=>({node:E,cost:v(E.node)}));x.sort(WN(E=>E.cost,KN));for(let{node:E}of x){E.markAsSurviving();let R=d.getTextFragment();if(R.length>t)break;p=R}let S=new Lc(s,p.toTextEditFromOriginal(s.length),e.languageId),I=S;return I.getVisualization=()=>({$fileExtension:"ast.w",source:{value:S.originalText,decorations:Ile(Qt.ofLength(S.originalText.length),S.edits.edits.map(E=>E.replaceRange)).map(E=>({range:[E.start,E.endExclusive],color:"lime"}))},root:$V(d,E=>({label:(E.node.node?.kind||"unknown")+` (${x.find(R=>R.node===E)?.cost})`,range:E.node.range,children:E.childNodes,isMarked:E._surviving}))}),S}var WV=class{constructor(e,r){this.text=e;this.languageId=r}},KV=class t{constructor(e,r,n,o,s){this.parent=e;this.overlayNode=r;this.range=n;this.children=o;this.document=s}static fromNode(e,r,n=void 0){let o=new Qt(e.startIndex,e.endIndex),s=[],a=new t(n,e,o,s,r);for(let c of e.children)s.push(t.fromNode(c,r,a));return a}get kind(){return this.overlayNode.kind}get text(){return this.range.substring(this.document.text)}},YV=class t{constructor(e,r,n,o,s,a){this.node=e;this.range=r;this.children=n;this.depth=o;this.parent=s;this.document=a}static fromNode(e,r,n=0,o=null){let s=[],a=new t(e,e.range,s,n,o,r);if(e.children.length>0){let c=e.range.start;for(let l of e.children){let d=new Qt(c,l.range.start);d.isEmpty||s.push(new t(void 0,d,[],n,a,r)),s.push(t.fromNode(l,r,n+1,a)),c=l.range.endExclusive}let u=new Qt(c,e.range.endExclusive);u.isEmpty||s.push(new t(void 0,u,[],n,a,r))}return a}},QV=class t{constructor(e,r,n,o){this.node=e;this.parent=r;this.childNodes=n;this._tryPreserveTypeChecking=o;this._surviving=!1;this._textFragment=null}static fromNode(e,r){return t.fromNodeParent(e,null,r)}static fromNodeParent(e,r,n){let o=[],s=new t(e,r,o,n);for(let a of e.children){let c=t.fromNodeParent(a,s,n);o.push(c)}return s}visitAll(e){if(e(this))for(let r of this.childNodes)r.visitAll(e)}markAsSurviving(){this._surviving||(this._surviving=!0,this.parent&&this.parent.markAsSurviving(),this.invalidate())}invalidate(){this._textFragment&&(this._textFragment=null,this.parent&&this.parent.invalidate())}getTextFragment(){return this._textFragment||(this._textFragment=this._computeSummarization()),this._textFragment}_computeSummarization(){if(this.childNodes.length===0&&(this._surviving||!this.node.node))return new Pg(this.node.range,this.node.document);if(!this._surviving)return new YS("");let e=[];for(let r of this.childNodes){let n=r.getTextFragment();if(n.length===0){e.length>0&&e[e.length-1].length===0||e.push(n);continue}s9e(e,n)}for(let r=0;r<=e.length-3;r++){let n=e[r],o=e[r+1],s=e[r+2];if(o.length===0&&n instanceof Pg&&s instanceof Pg){let a=n.trimEnd(),c=s.trimStart();a.endsWith("{")&&c.startsWith("}")&&(e[r]=a,e[r+1]=new YS(this._tryPreserveTypeChecking?"/* ... */":"\u2026"),e[r+2]=c)}}return gO.from(e)}getDescendantsAndSelf(){let e=[];return this._getDescendantsAndSelf(e),e}_getDescendantsAndSelf(e){e.push(this);for(let r of this.childNodes)r._getDescendantsAndSelf(e)}},Pk=class{toTextEditFromOriginal(e){let r=[],n=0,o="";function s(c){(n!==c||o.length>0)&&(r.push(new Io(new Qt(n,c),o)),o="")}function a(c){if(c instanceof gO)for(let u of c.fragments)a(u);else c instanceof YS?o+=c.text:c instanceof Pg&&(s(c.range.start),n=c.range.endExclusive)}return a(this),s(e),new on(r)}},YS=class extends Pk{constructor(r){super();this.text=r}get length(){return this.text.length}},Pg=class t extends Pk{constructor(r,n){super();this.range=r;this.originalText=n}get length(){return this.range.length}get text(){return this.range.substring(this.originalText)}trimStart(){let r=this.text.trimStart();return r.length===this.length?this:new t(new Qt(this.range.endExclusive-r.length,this.range.endExclusive),this.originalText)}trimEnd(){let r=this.text.trimEnd();return r.length===this.length?this:new t(new Qt(this.range.start,this.range.start+r.length),this.originalText)}startsWith(r){return this.text.startsWith(r)}endsWith(r){return this.text.endsWith(r)}tryJoin(r){return this.range.endExclusive===r.range.start?new t(new Qt(this.range.start,r.range.endExclusive),this.originalText):null}},gO=class t extends Pk{constructor(r){super();this.fragments=r;this.length=this.fragments.reduce((r,n)=>r+n.length,0)}static from(r){return r.length===0?new YS(""):r.length===1?r[0]:new t(r)}get text(){return this.fragments.map(r=>r.text).join("")}};function s9e(t,e){if(e.length===0)return;let r=t[t.length-1];if(r&&r instanceof Pg&&e instanceof Pg){let n=r.tryJoin(e);if(n){t[t.length-1]=n;return}}t.push(e)}var vO=class{constructor(e){this._derivedDocument=e;this._workingCopyOriginalDocument=new Dk(this._derivedDocument.originalText)}get originalText(){return this._workingCopyOriginalDocument.text}get text(){return this._derivedDocument.text}get languageId(){return this._derivedDocument.languageId}get derivedDocumentTransformer(){return this._derivedDocument.positionOffsetTransformer}get originalDocumentTransformer(){return this._workingCopyOriginalDocument.transformer}get allReportedEdits(){return this._workingCopyOriginalDocument.appliedEdits}createDerivedDocumentChatResponseStream(e){return new Al(r=>{let n=this.applyAndTransformProgressItem(r);e.push(n)})}applyAndTransformProgressItem(e){if(!(e instanceof Uf))return e;let r=this._workingCopyOriginalDocument,n=this._derivedDocument,o=n.edits,a=Ele(n.positionOffsetTransformer,e.edits).tryRebase(o.inverse(r.text)),c=o.tryRebase(a),u=new Uf(e.uri,wle(r.transformer,a));return this._workingCopyOriginalDocument.applyOffsetEdits(a),this._derivedDocument=new Lc(this._workingCopyOriginalDocument.text,c,this._derivedDocument.languageId),u}rebaseEdits(e){let r=this._workingCopyOriginalDocument,n=this._derivedDocument,o=n.edits,a=Ele(n.positionOffsetTransformer,e).tryRebase(o.inverse(r.text));return wle(r.transformer,a)}convertPostEditsOffsetToOriginalOffset(e){return this._derivedDocument.projectBack(e)}},Dk=class{constructor(e){this._text=e;this._transformer=null;this._appliedEdits=new on([]);this._eol=e.includes(`\r
`)?`\r
`:`
`}get text(){return this._text}get transformer(){return this._transformer||(this._transformer=new Yf(this._text)),this._transformer}get appliedEdits(){return this._appliedEdits}applyOffsetEdits(e){let r=e.normalizeEOL(this._eol),{edits:n}=r,o=this._text;for(let s=n.length-1;s>=0;s--){let a=n[s];o=o.substring(0,a.replaceRange.start)+a.newText+o.substring(a.replaceRange.endExclusive)}this._text=o,this._transformer&&this._transformer.applyOffsetEdits(r),this._appliedEdits=this._appliedEdits.compose(r)}},bO=class{constructor(e){this._text=e;this._transformer=null}get text(){return this._text}get transformer(){return this._transformer||(this._transformer=new Yf(this._text)),this._transformer}};function Ele(t,e){return t.toOffsetEdit(e)}function wle(t,e){return t.toTextEdits(e)}async function ga(t,e,r,n,o){let s=await Tle(t,e,r,n,o);return new XV(s.selection,s.adjustedSelection,s.document,e,r)}var XV=class{constructor(e,r,n,o,s){this._selection=e;this._adjustedSelection=r;this._projectedDocument=n;this._document=o;this._formattingOptions=s}get uri(){return this._document.uri}get languageId(){return this._document.languageId}splitAroundAdjustedSelection(){return new yO(this._projectedDocument,this.uri,this._formattingOptions,this._adjustedSelection)}splitAroundOriginalSelectionEnd(){return new yO(this._projectedDocument,this.uri,this._formattingOptions,new Qt(this._selection.endExclusive,this._selection.endExclusive))}},yO=class{constructor(e,r,n,o){this._projectedDocument=e;this._uri=r;this._formattingOptions=n;this._selection=this._projectedDocument.positionOffsetTransformer.toRange(o),this.codeAbove=this._projectedDocument.text.substring(0,o.start),this.codeSelected=this._projectedDocument.text.substring(o.start,o.endExclusive),this.codeBelow=this._projectedDocument.text.substring(o.endExclusive)}get hasCodeWithoutSelection(){return this.codeAbove.trim().length>0||this.codeBelow.trim().length>0}get hasContent(){return this.codeAbove.trim().length>0||this.codeSelected.trim().length>0||this.codeBelow.trim().length>0}get replaceSelectionStreaming(){return(e,r)=>new iO(r,this._selection,e)}get insertStreaming(){return(e,r)=>new kg(r,this._selection.end,e)}get insertOrReplaceStreaming(){return(e,r)=>new $S(r,this._selection,this._selection,3,!0,e)}createReplyInterpreter(e,r,n,o,s){return new Ag(this._uri,this._projectedDocument,this._formattingOptions,e,r,n,o,s)}},Ag=class{constructor(e,r,n,o,s,a,c,u){this._uri=e;this._fileIndentInfo=n;this._leadingMarkdownStreaming=o;this._earlyStopping=s;this._streamingStrategyFactory=a;this._textPieceClassifier=c;this._lineFilter=u;this._lastText=void 0;this._initialDocumentSnapshot=new bO(r.originalText),this._workingCopySummarizedDoc=new vO(r)}async processResponse(e,r,n){let o=this._workingCopySummarizedDoc.createDerivedDocumentChatResponseStream(r),s=new cO(o,this._uri,this._workingCopySummarizedDoc.text,this._workingCopySummarizedDoc.text.split(`
`).map((d,p)=>new sO(p,4)),new aO(0,0),this._workingCopySummarizedDoc.languageId,this._fileIndentInfo),a=new hO(o,this._leadingMarkdownStreaming,this._earlyStopping,this._textPieceClassifier,this._streamingStrategyFactory(this._lineFilter,s));for await(let d of e){this._lastText=d.text;let{shouldFinish:p}=a.update(d.text);if(p)break}let{didEdits:c,didNoopEdits:u,additionalImports:l}=await a.finish();if(c){let d=this._generateAdditionalImportsEdits(l),p=this._workingCopySummarizedDoc.allReportedEdits.inverse(this._initialDocumentSnapshot.text),f=p.edits.reduce((g,v)=>g.join(v.replaceRange),p.edits[0].replaceRange),m=this._workingCopySummarizedDoc.originalDocumentTransformer.toRange(f),h={lastDocumentContent:this._workingCopySummarizedDoc.originalText,lastWholeRange:m};return r.textEdit(this._uri,d),{type:"inlineEdit",store:h}}if(l.length>0)return r.textEdit(this._uri,this._generateAdditionalImportsEdits(l)),{type:"inlineEdit"};if(u)return{type:"noopEdit"};if(!this._lastText)throw new Error("No text");return o.markdown(this._lastText),{type:"conversational"}}_generateAdditionalImportsEdits(e){if(e.length===0)return[];let r=this._workingCopySummarizedDoc.originalText.split(/\r\n|\r|\n/g),n=Wq(r,a=>Tg(a,this._workingCopySummarizedDoc.languageId));if(n===-1)return[new ci(new Qe(0,0,0,0),e.join(`
`)+`

`)];let o=new Set;for(let a=n;a>=0;a--){let c=r[a];if(c.trim()!=="")if(Tg(c,this._workingCopySummarizedDoc.languageId))o.add(Ck(c));else break}if(e=e.filter(a=>!o.has(a)),e.length===0)return[];let s=r[n].length;return[new ci(new Qe(n,s,n,s),`
`+e.join(`
`))]}};var Ml=H(nt());var Ct=ie("IChatMLFetcher"),XS=class{constructor(){this._stream=new Wh;this._seenAnnotationTypes=new Set}get stream(){return this._stream.asyncIterable}update(e,r){r.codeVulnAnnotations&&(!((e.match(/(^|\n)```/g)?.length??0)%2===1)||e.match(/(^|\n)```\w*\s*$/))&&(r.codeVulnAnnotations=void 0),r.codeVulnAnnotations&&(r.codeVulnAnnotations=r.codeVulnAnnotations.filter(n=>!this._seenAnnotationTypes.has(n.details.type)),r.codeVulnAnnotations.forEach(n=>this._seenAnnotationTypes.add(n.details.type))),this._stream.emitOne({text:e,delta:r})}resolve(){this._stream.resolve()}};var _O=ie("IToolsService");var Rle=H(Gt()),xO=H(nt());var Kd=class extends X{constructor(r,n,o,s,a){super(r);this.workspaceService=n;this.ignoreService=o;this.instantiationService=s;this.logService=a}async render(r,n){let o="uri"in this.props.variableValue?this.props.variableValue.uri:this.props.variableValue;if(await this.ignoreService.isCopilotIgnored(o))return vscpp("ignoredFiles",{value:[o]});let s="range"in this.props.variableValue?this.props.variableValue.range:void 0,a;try{a=await this.workspaceService.openTextDocument(o)}catch(l){this.logService.public.error(l,`Error opening context for ${o}`);let d={status:{description:Rle.t("This file could not be read: {0}",l.message),kind:xO.ChatResponseReferencePartStatusKind.Omitted}};return vscpp(vscppf,null,vscpp("references",{value:[new xO.PromptReference(this.props.variableName?{variableName:this.props.variableName,value:this.props.variableValue}:this.props.variableValue,void 0,d)]}))}if(s)return vscpp(vscppf,null,"# ",this.props.variableName.toUpperCase()," CONTEXT",vscpp("br",null),vscpp(ay,{languageId:a.languageId,uri:o,range:s,code:a.getText(s),variableName:this.props.variableName,isSummarized:!1}));let u=await this.instantiationService.createInstance(Wd).summarizeDocument(a,void 0,s,n.tokenBudget,{costFnOverride:a9e});return vscpp(vscppf,null,"# ",this.props.variableName.toUpperCase()," CONTEXT",vscpp("br",null),vscpp(ay,{languageId:a.languageId,uri:o,range:s,code:u.text,variableName:this.props.variableName,isSummarized:u.text.length<u.originalText.length}))}};Kd=w([b(1,Ve),b(2,ke),b(3,K),b(4,oe)],Kd);var a9e={createCostFn(t){let e=new qb(r=>{if(t.languageId==="typescript"){let n=r.parent?e.get(r.parent):1,o=r.text.trim();if(o.startsWith("private "))return n*1.1;if(o.startsWith("export ")||o.startsWith("public "))return n*.9}return 1});return(r,n)=>{if(r.kind==="import_statement")return 1e3;let o=e.get(r);return n*o}}};var wO=H(nt());var SO=new class{constructor(){this._descriptors=[]}setIntents(t){this._descriptors=this._descriptors.concat(t)}getIntents(){return this._descriptors}};var Qa=ie("IIntentService"),JS=class{constructor(e){this._instantiationService=e;this._intents=null}_getOrCreateIntents(){return this._intents||(this._intents=SO.getIntents().map(e=>this._instantiationService.createInstance(e))),this._intents}get unknownIntent(){let r=this._getOrCreateIntents().find(n=>n.id==="unknown");if(!r)throw new Error("Unknown intent not found");return r}getIntents(e){return this._getOrCreateIntents().filter(n=>n.locations.includes(e))}getIntent(e,r){return this.getIntents(r).find(n=>n.id===e)}getIntentByFunctionName(e,r){return this.getIntents(r).find(n=>n.intentDetectionInput.functionName===e)}};JS=w([b(0,K)],JS);var vu=ie("ICommandService"),ZS=class{constructor(e){this.intentService=e}getCommands(e){return this.intentService.getIntents(e).filter(r=>!r.commandInfo||!r.commandInfo.hiddenFromUser).map(r=>({commandId:r.id,intent:r,details:r.description,locations:r.locations}))}getCommand(e,r){return this.getCommands(r).find(n=>n.commandId===e)}};ZS=w([b(0,Qa)],ZS);var bu=class extends X{constructor(e,r){super(e),this.commandService=r.get(vu)}getIntentDescription(e){let r=this.commandService.getCommand(e,this.props.location)?.intent;return!r||r.isListedCapability===!1?void 0:r.description}async prepare(){let e=Object.entries(DS).reduce((r,[n,o])=>{let s=this.getIntentDescription(n);s&&(r+=`
* ${s}`);for(let a of Object.values(o)){let c=this.getIntentDescription(a);c&&(r+=`
* ${c}`)}return r},"");return{modelName:this.props.endpoint.name,commandDescriptions:e}}render(e){return vscpp(vscppf,null,"You can answer general programming questions and perform the following tasks: ",e.commandDescriptions,vscpp("br",null),"You use the ",e.modelName," version of OpenAI's GPT models.")}};bu=w([b(1,st)],bu);var Br=class extends X{render(){return vscpp(vscppf,null,'When asked for your name, you must respond with "GitHub Copilot".',vscpp("br",null),"Follow the user's requirements carefully & to the letter.")}};var c9e=["auto","en","fr","it","de","es","ru","zh-CN","zh-TW","ja","ko","cs","pt-br","tr","pl"],Xt=class extends X{constructor(r,n,o){super(r);this.configurationService=n;this.envService=o}render(){let r=this.configurationService.getConfig(de.LocaleOverride);if(!c9e.find(o=>r===o))return;let n=r!=="auto"?r:this.envService.language;if(n!=="en")return vscpp(vscppf,null,"Respond in the following locale: ",n)}};Xt=w([b(1,be),b(2,St)],Xt);var Rt=class extends X{render(){return vscpp(vscppf,null,"Follow Microsoft content policies.",vscpp("br",null),"Avoid content that violates copyrights.",vscpp("br",null),`If you are asked to generate content that is harmful, hateful, racist, sexist, lewd, violent, or completely irrelevant to software engineering, only respond with "Sorry, I can't assist with that."`,vscpp("br",null),"Keep your answers short and impersonal.")}};var e1=H(nt());var Ot=class extends X{render(e,r){let n=this.props.history.filter(s=>s.status==="success"||s.status==="in-progress");if(n.length===0)return;let o=[];for(let s of n)s.request.type==="user"&&o.push(vscpp(e1.UserMessage,null,s.request.message)),s.response?.type==="model"&&o.push(vscpp(e1.AssistantMessage,{name:s.response.name},s.response.message));return vscpp(e1.PrioritizedList,{priority:this.props.priority,descending:!1},o)}};var TO=H(nt());var r1=ie("ICustomInstructionsService");function u9e(t){return typeof t=="object"&&t!==null?typeof t.file=="string"&&(t.language===void 0||typeof t.language=="string"):!1}function l9e(t){return typeof t=="object"&&t!==null?typeof t.text=="string"&&(t.language===void 0||typeof t.language=="string"):!1}var t1=class{constructor(e,r,n,o){this.configurationService=e;this.envService=r;this.workspaceService=n;this.fileSystemService=o;this._openSettingsUri=Gr.from({scheme:this.envService.uriScheme,authority:"settings",path:`/${Pd}.${de.CodeGenerationInstructions.id}`})}async _collectUserSettingsInstructions(e){let r=[],n=this.configurationService.inspectConfig(de.CodeGenerationInstructions);n&&await this.collectInstructionsFromSettings([n.workspaceFolderValue,n.workspaceValue,n.globalValue],r,e);let o=this.configurationService.getConfig(de.DeprecatedCustomUserInstructions);if(Array.isArray(o))for(let s of o)typeof s=="string"&&r.push({instruction:s});r.length>0&&e.push({kind:1,content:r,reference:this._openSettingsUri})}async collectInstructionsFromSettings(e,r,n){let o=new Set,s=new Set;for(let a of e)if(Array.isArray(a))for(let c of a)u9e(c)&&!o.has(c.file)&&(o.add(c.file),await this._collectInstructionsFromFile(c.file,c.language,n)),l9e(c)&&!s.has(c.text)&&(s.add(c.text),r.push({instruction:c.text,languageId:c.language}))}async _collectInstructionsFromFile(e,r,n){let o=this.workspaceService.getWorkspaceFolders().map(async s=>{let a=Gr.joinPath(s,e),c=await this.readInstructionsFromFile(a);if(!c)return;let u=[];c.split(/\r\n|\r|\n/).forEach(d=>d9e(d,r,u)),u.length>0&&n.push({kind:0,content:u,reference:a})});await Promise.all(o)}async readInstructionsFromFile(e){try{let r=await this.fileSystemService.readFile(e);return new TextDecoder().decode(r)}catch{return}}async fetchInstructions(){let e=[];return await this._collectUserSettingsInstructions(e),e}};t1=w([b(0,be),b(1,St),b(2,Ve),b(3,hr)],t1);function d9e(t,e,r){t=t.trim(),t&&r.push({instruction:t,languageId:e})}var Or=class extends X{render(e,r){let n=[];for(let o of this.props.customInstructions){let s=this.createInstructionElement(o);s&&n.push(s)}if(n.length>0)return vscpp(vscppf,null,"When generating code, please follow these user provided coding guidelines. You can ignore a guideline if it contradicts a system message.",vscpp("br",null),...n)}createInstructionElement(e){let r=[];for(let n of e.content)n.languageId?n.languageId===this.props.languageId&&r.push(`For ${n.languageId} code: ${n.instruction}`):r.push(n.instruction);if(r.length>0)return vscpp(TO.TextChunk,null,vscpp("references",{value:[new CO(e,r)]}),r.join(`
`)," ",vscpp("br",null))}},CO=class extends TO.PromptReference{constructor(r,n){super(r.reference);this.instructions=r;this.usedInstructions=n}};function EO(t){let e=0,r=0,n=0,o=0,s=0;for(let a of t)a instanceof CO&&(e+=a.usedInstructions.length,n+=a.usedInstructions.reduce((c,u)=>c+u.length,0),r+=Math.max(a.instructions.content.length-a.usedInstructions.length,0),a.instructions.kind===0?o++:s+=a.usedInstructions.length);return{codeGenInstructionsCount:e,codeGenInstructionsLength:n,codeGenInstructionsFilteredCount:r,codeGenInstructionFileCount:o,codeGenInstructionSettingsCount:s}}var Dg=class extends X{constructor(r,n,o,s){super(r);this.envService=n;this.experimentationService=o;this._configurationService=s}async render(r,n){let{query:o,history:s,chatVariables:a,customInstructions:c}=this.props.promptContext,u=this._configurationService.getExperimentBasedConfig(de.ProjectLabelsChat,this.experimentationService),l=this.envService.OS,d=a.find(p=>p.originalName===zr.variableInfo.name);return vscpp(vscppf,null,vscpp(wO.SystemMessage,{priority:1e3},"You are an AI programming assistant.",vscpp("br",null),vscpp(Br,null),vscpp(Rt,null),vscpp("br",null),vscpp(bu,{location:2,endpoint:this.props.endpoint}),vscpp("br",null),"First think step-by-step - describe your plan for what to build in pseudocode, written out in great detail.",vscpp("br",null),"Then output the code in a single code block.",vscpp("br",null),"Minimize any other prose.",vscpp("br",null),"Use Markdown formatting in your answers.",vscpp("br",null),"Make sure to include the programming language name at the start of the Markdown code blocks.",vscpp("br",null),"Avoid wrapping the whole response in triple backticks.",vscpp("br",null),"The user works in an IDE called Visual Studio Code which has a concept for editors with open files, integrated unit test support, an output pane that shows the output of running the code as well as an integrated terminal.",vscpp("br",null),"The user is working on a ",l," machine. Please respond with system specific commands if applicable.",vscpp("br",null),"The active document is the source code the user is looking at right now.",vscpp("br",null),"You can only give one reply for each conversation turn.",vscpp("br",null),vscpp(Xt,null)),u&&vscpp(Vo,{flexGrow:1,priority:600}),vscpp(Ot,{flexGrow:1,priority:700,history:s}),vscpp(wO.UserMessage,{flexGrow:1,priority:750},vscpp(Or,{customInstructions:c,languageId:void 0})),!d&&vscpp(zr,{flexGrow:1,document:this.props.documentContext?.document,range:this.props.documentContext?.selection,priority:800}),vscpp(pr,{priority:899,...this.props,flexGrow:2}),vscpp(Jr,{flexGrow:2,priority:900,chatVariables:a,query:o}))}};Dg=w([b(1,St),b(2,wt),b(3,be)],Dg);var Bs=class extends X{render(e,r){let n=RO(this.props.chatVariables);return vscpp(vscppf,null,...n.map(o=>JV(o,this.props.priority)))}},qs=class extends X{render(e,r){let n=this.props.chatVariables.substituteVariablesWithReferences(this.props.query);return vscpp(vscppf,null,n)}},Jr=class extends X{render(e,r){let n=this.props.maintainOrder?this.props.chatVariables:this.props.chatVariables.reverse(),o=RO(n);return vscpp(vscppf,null,...o.map(s=>JV(s,this.props.priority&&this.props.priority-1)),JV(vscpp(qs,{chatVariables:n,query:this.props.query}),this.props.priority))}};function JV(t,e){return vscpp(Ml.UserMessage,{priority:e},t)}function RO(t){let e=[];for(let{uniqueName:r,value:n}of t)n instanceof Gr||n instanceof Ri?e.push(vscpp(Kd,{variableName:r,variableValue:n})):typeof n=="string"&&e.push(vscpp(Ml.TextChunk,null,vscpp("references",{value:[new Ml.PromptReference({variableName:r})]}),"# ",r.toUpperCase()," CONTEXT",vscpp("br",null),n));return e}var pr=class extends X{constructor(r,n,o,s,a,c){super(r);this.chatFetcher=n;this.instantiationService=o;this.options=s;this.toolsService=a;this.logService=c}async render(r,n){if(!this.props.promptContext.toolReferences?.length)return;let o=[];for(let s of this.props.promptContext.toolReferences){let a=this.toolsService.getTool(s.id);if(!a)throw new Error(`Unknown tool: "${s.id}"`);let c=await this.fetchToolArgs(a,n.endpoint),u=await this.toolsService.invokeTool(a.id,{parameters:c},Lr.None),l=s.range?this.props.promptContext.query.slice(s.range[0],s.range[1]):void 0;o.push({name:l,displayName:a.displayName??a.id,value:u})}return vscpp(vscppf,null,vscpp(Ml.UserMessage,{priority:this.props.priority},...o.map(s=>this.renderChatToolResult(s)),"These attachments may have useful context for the user's query. The user may refer to these attachments directly using a term that starts with #."))}renderChatToolResult(r){let n=r.displayName&&` (${r.displayName})`,o=r.name&&` (${r.name})`;return vscpp(vscppf,null,vscpp(Ml.TextChunk,null,"Attachment",n,o,":",vscpp("br",null),r.value[Ml.contentType]?vscpp("elementJSON",{data:r.value[Ml.contentType]}):r.value.toString(),vscpp("br",null),vscpp("br",null)))}async fetchToolArgs(r,n){let o={...this.props,promptContext:{...this.props.promptContext,toolReferences:void 0}},{messages:s}=await Be.create(this.instantiationService,this.props.endpoint,Dg,o).render(),a,c=await this.chatFetcher.fetchOne("fetchToolArgs",s,async(u,l,d)=>{d.copilotFunctionCalls&&(a=d.copilotFunctionCalls[0])},Lr.None,2,n,void 0,{temperature:this.options.temperature,top_p:this.options.topP,functions:[{name:r.id,description:r.modelDescription,parameters:r.parametersSchema}],function_call:{name:r.id}},{messageSource:`chat.fetchToolArgs.${r.id}`});if(!a)throw new Error(`Failed to compute args for tool: "${r.id}"`);if(c.type!=="success")throw new Error(`Fetching tool args failed: ${c.type} ${c.reason}`);this.logService.internal.trace(`Function Call: ${a.arguments}`);try{return JSON.parse(a.arguments)}catch(u){throw new Error("Invalid tool arguments: "+u.message)}}};pr=w([b(1,Ct),b(2,K),b(3,Rr),b(4,_O),b(5,oe)],pr);var p9e=6e4,f9e=1500,Fl=class{constructor(e,r,n,o,s){this.logService=e;this.parserService=r;this.telemetryService=n;this.endpointProvider=o;this.instaService=s;this.id=Fl.ID;this.description=kO.t("Add documentation comment for this symbol");this.locations=[1];this.commandInfo={}}static{this.ID="doc"}get intentDetectionInput(){let e="generate_documentation_for_code";return{functionName:e,sampleQuestion:"Add jsdoc to this method",functionCallingBlurb:`If the active selection contains a symbol and the user's message is related to documenting code, adding docstrings, adding documentation, or adding comments, you should use the '${e}' function.`}}async asSlashCommand(e){if(e.document.lineCount>f9e||e.document.getText().length>p9e)return new Lk("Add documentation comment for this symbol");let r=await xg(this.parserService,this.telemetryService,e),n=r.identifier?kO.t("Add documentation comment for '{0}'",r.identifier):kO.t("Add documentation comment for this symbol");return new Lk(n,r)}async invoke(e){let{documentContext:r,slashCommand:n,location:o}=e;if(!r)throw new Error("Open a file to add documentation.");let s;n instanceof Lk?s=n.nodeToDocument:this.logService.public.warn("Unexpected: SlashCommand given to intent invocation is not a DocSlashCommand");let a=await this.endpointProvider.getEndpointForLocation(o);return this.instaService.createInstance(Nk,a,r,this,s)}};Fl=w([b(0,oe),b(1,_t),b(2,he),b(3,Se),b(4,K)],Fl);var Lk=class{constructor(e,r=void 0){this.description=e;this.nodeToDocument=r;this.name=Fl.ID}},Nk=class{constructor(e,r,n,o,s,a,c){this.endpoint=e;this.context=r;this.intent=n;this.nodeToDocument=o;this.parserService=s;this.telemetryService=a;this.instantiationService=c;this.location=1}async buildPrompt(e,r,n){let{query:o,history:s,chatVariables:a}=e,c=this.nodeToDocument??await xg(this.parserService,this.telemetryService,this.context);return await Be.create(this.instantiationService,this.endpoint,ZV,{userQuery:o,documentContext:this.context,nodeToDocument:c,endpointInfo:this.endpoint,history:s.at(-1)?.request.message,chatVariables:a,promptContext:e}).render(r,n)}processResponseInline(e,r,n){let o=this.context.document,s=new Lc(o.getText(),on.empty,o.languageId),a=this.nodeToDocument?.range??this.context.selection,c;if(o.languageId==="python"){let u=o.getText(a).split(`
`).filter(d=>d!=="").map(d=>d.trim()),l=new Set(u);c=new Ag(this.context.document.uri,s,this.context.fileIndentInfo,Yo.Mute,1,(d,p)=>new kg(p,a.start,d),Ai.createCodeBlockClassifier(),d=>!d.value.includes("FILEPATH")&&!l.has(d.value.trim()))}else c=new Ag(this.context.document.uri,s,this.context.fileIndentInfo,Yo.Mute,1,(u,l)=>new $S(l,a,a,1,!1,u),Ai.createCodeBlockClassifier(),u=>!u.value.includes("FILEPATH"));return c.processResponse(e,r,n)}};Nk=w([b(4,_t),b(5,he),b(6,K)],Nk);var ZV=class extends X{render(e,r){let n=z4(this.props.documentContext.language.languageId),o=this.props.chatVariables.substituteVariablesWithReferences(this.props.userQuery),s=`${this.getQueryPrefix()} ${o}`.trim();return vscpp(vscppf,null,vscpp(Ok.SystemMessage,null,"You are an AI programming assistant.",vscpp("br",null),'When asked for your name, you must respond with "GitHub Copilot".',vscpp("br",null),"You must follow user's requirements carefully.",vscpp("br",null),"You must follow Microsoft content policies.",vscpp("br",null),"You must avoid content that violates copyrights.",vscpp("br",null),"For questions not related to software development, you should give a reminder that you are an AI programming assistant.",vscpp("br",null),"When user asks you to document something, you must answer in the form of a ",n," markdown code block.",vscpp("br",null)),vscpp(pr,{priority:750,endpoint:this.props.endpointInfo,promptContext:this.props.promptContext,flexGrow:1}),vscpp(Bs,{chatVariables:this.props.chatVariables}),vscpp(_g,{documentContext:this.props.documentContext,nodeToDocument:this.props.nodeToDocument,endpointInfo:this.props.endpointInfo}),this.props.history&&this.props.history.length>0&&vscpp(Ok.UserMessage,null,this.props.history),vscpp(Ok.UserMessage,null,s))}getQueryPrefix(){let e=this.props.nodeToDocument?.identifier,r=e!==void 0&&e!=="",n=r?e:"the selection",o;switch(this.props.documentContext.language.languageId){case"typescript":case"typescriptreact":o=r?"a TSDoc comment":"TSDoc comment";break;case"javascript":case"javascriptreact":o=r?"a JSDoc comment":"JSDoc comment";break;case"python":o="docstring";break;default:o="documentation comment"}return`Please, given ${n}, generate ${o} only. Do not repeat given code, only reply with ${o} in a code block.`}};var Ple=H(Gt());var AO=H(nt());var Vi=class extends X{render(){return vscpp(vscppf,null,"Use Markdown formatting in your answers.",vscpp("br",null),"Make sure to include the programming language name at the start of the Markdown code blocks.",vscpp("br",null),"Avoid wrapping the whole response in triple backticks.",vscpp("br",null),"The user works in an IDE called Visual Studio Code which has a concept for editors with open files, integrated unit test support, an output pane that shows the output of running the code as well as an integrated terminal.",vscpp("br",null),"The active document is the source code the user is looking at right now.",vscpp("br",null),"You can only give one reply for each conversation turn.")}};var PO=H(Gt()),Mk=H(nt());var kle=H(nt());var yu=class extends X{constructor(r,n,o,s,a){super(r);this.ignoreService=n;this.extensionContext=o;this.tabsAndEditorsService=s;this.servicesAccessor=a}static{this.DEFAULT_TIMEOUT_MS=200}async prepare(){let r={implementations:[],activeDocument:void 0,isIgnored:!1},{document:n,range:o}=this.props;if(!n){let u=this.tabsAndEditorsService.activeTextEditor;if(!u)return r;n??=u.document,o??=u.selection}if(!o||o.isEmpty)return r;if(await this.ignoreService.isCopilotIgnored(n.uri))return{...r,isIgnored:!0};let s=this.extensionContext.extensionMode===au.Test?0:this.props.timeoutMs===void 0?yu.DEFAULT_TIMEOUT_MS:this.props.timeoutMs,a=[{header:"Relevant function implementations",findImpls:ole},{header:"Relevant class declarations",findImpls:sle},{header:"Relevant type declarations",findImpls:ale}],c=[];for(let{header:u,findImpls:l}of a){let d=await l(this.servicesAccessor,n,o,s);c.push([u,d])}return{implementations:c,activeDocument:n,isIgnored:!1}}render(r,n){if(!r.implementations.length||!r.activeDocument)return;let o=r.activeDocument.uri;if(r.isIgnored)return vscpp("ignoredFiles",{value:[o]});let s=[],a=[];for(let[c,u]of r.implementations){let{references:l,usedContext:d,text:p,uris:f}=eG(r.activeDocument,u);if(p.length===0)continue;let m=vscpp(kle.UserMessage,{priority:this.props.priority},c,":",vscpp("br",null),vscpp("br",null),p.map((h,g)=>vscpp(vscppf,null,vscpp(Fe,{code:h,languageId:r.activeDocument?.languageId,uri:f[g],references:[l[g]]}),vscpp("br",null))));s.push(m),a.push(...d)}return vscpp(vscppf,null,vscpp("usedContext",{value:a}),...s)}};yu=w([b(1,ke),b(2,jt),b(3,zt),b(4,st)],yu);function eG(t,e){let r=[],n=new Map,o=new Set,s=[],a=[];for(let c of e){let u=c.uri??t.uri,l=c.range??ms(t,c),d=`${u.toString()}-${l.start.line}-${l.start.character}-${l.end.line}-${l.end.character}`;if(o.has(d))continue;o.add(d),r.push(new Ms.PromptReference(new Ri(u,l))),s.push(c.text),a.push(u);let[p,f]=n.get(u)??[c.version??t.version,[]];f.push(l),n.set(u,[p,f])}return{references:r,usedContext:[...n.entries()].map(([c,[u,l]])=>({uri:c,version:u,ranges:l})),text:s,uris:a}}var hs=class extends X{constructor(r,n,o,s){super(r);this.accessor=n;this._languageFeaturesService=o;this._workspaceService=s}static getSymbolAtCursor(r,n){let{selection:o,document:s}=n;if(!o||!s){let u=r.get(zt).activeTextEditor;if(!u)return;({selection:o,document:s}=u)}if(!o.isEmpty)return;let a=s.getWordRangeAtPosition(o.active)??o;return{selectedText:s.getText(a),document:s,range:a}}static async getDefinitionAtRange(r,n,o,s){if(await r.get(ke).isCopilotIgnored(n.uri))return;let c=r.get(_t).getTreeSitterAST(n);if(c===void 0)return;let u=io(o,n),l;s&&(l=await c.getNodeToExplain(u)),l??=await c.getNodeToDocument(u);let{startIndex:d,endIndex:p}="nodeToDocument"in l?l.nodeToDocument:l.nodeToExplain,f=ms(n,{startIndex:d,endIndex:p});return{identifier:l.nodeIdentifier,text:n.getText(f),range:f,uri:n.uri,startIndex:d,endIndex:p}}static async getSelectedScope(r,n){let o=r.get(ke);if(!n.document||await o.isCopilotIgnored(n.document.uri))return;let s=hs.getSymbolAtCursor(r,n),a,c=s?await hs.getDefinitionAtRange(r,s.document,s.range,!1):void 0;if(r.get(be).getConfig(de.ExplainScopeSelection)||s&&(c?.identifier!==s.selectedText||!s.selectedText)){let l=r.get(zt).activeTextEditor;if(!l)return;let d=await r.get(Kh).selectEnclosingScope(l,{reason:PO.t("Select an enclosing range to explain"),includeBlocks:!0});if(d){let p=l.document,f=p.getText(d);if(!f)return;a={codeAtCursor:f,document:p,range:d,definitions:[],references:[]}}}return{symbolAtCursorState:a,definition:c,symbolAtCursor:s}}async prepare(r,n,o){let s=await hs.getSelectedScope(this.accessor,this.props).catch(()=>{});if(!s)return;let{symbolAtCursorState:a,definition:c,symbolAtCursor:u}=s;if(u){c?.identifier===u?.selectedText?a??={codeAtCursor:c.text,document:u.document,range:c.range,definitions:[],references:[]}:a??={codeAtCursor:u.document.lineAt(u.range.start).text,document:u.document,range:u.document.lineAt(u.range.start).range,definitions:[],references:[]},n.report(new ui(PO.t("Searching for relevant definitions...")));try{for(let l of await this._languageFeaturesService.getDefinitions(u.document.uri,u.range.start)){let{uri:d,range:p}=Wf(l)?{uri:l.targetUri,range:l.targetRange}:l;if(p.isEqual(u.range))continue;let f=await this._workspaceService.openTextDocument(d),m=await hs.getDefinitionAtRange(this.accessor,f,p,!0);m&&a.definitions.push(m)}}catch{}n.report(new ui(PO.t("Searching for relevant references...")));try{let l=new Set;for(let d of await this._languageFeaturesService.getReferences(u.document.uri,u.range.start)){let{uri:p,range:f}=Wf(d)?{uri:d.targetUri,range:d.targetRange}:d;if(f.isEqual(u.range))continue;let m=`${p.toString()}-${f.start.line}-${f.start.character}-${f.end.line}-${f.end.character}`;if(l.has(m))continue;l.add(m);let h=await this._workspaceService.openTextDocument(p),g=await hs.getDefinitionAtRange(this.accessor,h,f,!1);g&&a.references.push(g)}}catch{}return a}}render(r,n){if(!r)return;let o=[...r.definitions,...r.references];if(r.codeAtCursor){let{startIndex:c,endIndex:u}=io(r.range,r.document);o.push({version:r.document.version,uri:r.document.uri,range:r.range,text:r.codeAtCursor,startIndex:c,endIndex:u})}let{usedContext:s,references:a}=eG(r.document,o);return vscpp(vscppf,null,vscpp("usedContext",{value:s}),vscpp("references",{value:a}),vscpp(Mk.UserMessage,null,"I have the following  code in the active editor:",vscpp("br",null),vscpp(Fe,{uri:r.document.uri,languageId:r.document.languageId,code:r.codeAtCursor}),vscpp("br",null),!!r.definitions.length&&vscpp(vscppf,null,"Here are some relevant definitions for the symbols in my code:",vscpp("br",null)),!!r.definitions.length&&vscpp(Mk.PrioritizedList,{priority:this.props.priority,descending:!0},r.definitions.map(c=>vscpp(Fe,{uri:r.document.uri,languageId:r.document.languageId,code:c.text}))),!!r.references.length&&vscpp(vscppf,null,vscpp("br",null),"Here are some places where the the symbols in my code are referenced:",vscpp("br",null)),!!r.references.length&&vscpp(Mk.PrioritizedList,{priority:this.props.priority-r.definitions.length,descending:!0},r.references.map(c=>vscpp(vscppf,null,!!c.uri&&vscpp(vscppf,null,"From the file ",oL(c.uri.toString()),":",vscpp("br",null)),vscpp(Fe,{uri:r.document.uri,languageId:r.document.languageId,code:c.text}),vscpp("br",null))))))}};hs=w([b(1,st),b(2,Co),b(3,Ve)],hs);var n1=class extends X{constructor(r,n){super(r);this.languageService=n}async prepare(){let r=!1,{document:n,selection:o}=this.props;return n?.uri&&o&&(r=this.languageService.getDiagnostics(n.uri).filter(u=>!!u.range.intersection(o)).filter(u=>u.severity<=mS.Warning).length>0),{explainingDiagnostic:r}}render(r,n){let{query:o,history:s,chatVariables:a,customInstructions:c}=this.props.promptContext,u=a.find(l=>l.originalName===zr.variableInfo.name);return vscpp(vscppf,null,vscpp(AO.SystemMessage,{priority:1e3},"You are a world-class coding tutor. Your code explanations perfectly balance high-level concepts and granular details. Your approach ensures that students not only understand how to write code, but also grasp the underlying principles that guide effective programming.",vscpp("br",null),vscpp(Br,null),vscpp(Rt,null),vscpp(Vi,null),vscpp(Xt,null),vscpp("br",null),"Additional Rules",vscpp("br",null),"Think step by step:",vscpp("br",null),"1. Examine the provided code selection and any other context like user question, related errors, project details, class definitions, etc.",vscpp("br",null),"2. If you are unsure about the code, concepts, or the user's question, ask clarifying questions.",vscpp("br",null),"3. If the user provided a specific question or error, answer it based on the selected code and additional provided context. Otherwise focus on explaining the selected code.",vscpp("br",null),"4. Provide suggestions if you see opportunities to improve code readability, performance, etc.",vscpp("br",null),vscpp("br",null),"Focus on being clear, helpful, and thorough without assuming extensive prior knowledge.",vscpp("br",null),"Use developer-friendly terms and analogies in your explanations.",vscpp("br",null),"Identify 'gotchas' or less obvious parts of the code that might trip up someone new.",vscpp("br",null),"Provide clear and relevant examples aligned with any provided context."),vscpp(Ot,{priority:600,history:s}),vscpp(Vo,{priority:700}),vscpp(AO.UserMessage,{priority:750},vscpp(Or,{customInstructions:c,languageId:void 0})),!u&&vscpp(zr,{document:this.props.document,range:this.props.selection,priority:900}),vscpp(yu,{document:this.props.document,range:this.props.selection,priority:800}),!r.explainingDiagnostic&&vscpp(hs,{document:this.props.document,selection:this.props.selection,priority:800}),vscpp(pr,{priority:899,...this.props,flexGrow:2}),vscpp(Jr,{priority:900,chatVariables:a,query:o}))}};n1=w([b(1,Co)],n1);var DO="Write an explanation for the active selection as paragraphs of text.",i1=class extends Ho{constructor(r,n,o,s,a){super(r,n,o);this.tabsAndEditorsService=s;this.instantiationService=a}createRenderer(r,n,o,s){let a=this.tabsAndEditorsService.activeTextEditor;return Be.create(this.instantiationService,n,n1,{promptContext:r,document:a?.document,selection:a?.selection,endpoint:n})}};i1=w([b(3,zt),b(4,K)],i1);var tG=class extends i1{async buildPrompt(e,r,n){return e.query===""&&(e={...e,query:DO}),super.buildPrompt(e,r,n)}processResponseInline(e,r,n){return new mO().processResponse(e,r,n)}},o1=class{constructor(e,r){this.endpointProvider=e;this.instantiationService=r;this.id="explain";this.locations=[2,1];this.description=Ple.t("Explain how the code in your active editor works")}static{this.ID="explain"}get intentDetectionInput(){let e="explain_code_or_error";return{functionName:e,sampleQuestion:"Write an explanation for the code above as paragraphs of text.",functionCallingBlurb:`If the user's message asks for an explanation of code blocks or an error message, you should use the '${e}' function.`}}async invoke(e){let r=e.location,n=await this.endpointProvider.getEndpointForLocation(r);return r===1?this.instantiationService.createInstance(tG,this,r,n):this.instantiationService.createInstance(i1,this,r,n)}async asSlashCommand(e){return{name:this.id,description:this.description}}};o1=w([b(0,Se),b(1,K)],o1);var Tde=H(Gt());var e3=H(nt());var XO=H(Gt()),JO=H(nt());function Ale(t,e,r){return Math.min(Math.max(t,e),r)}var rG;function nG(t,e,r){let n=t.replace(/\r\n/g,`
`);return rG=rG?.then(()=>r.getSemanticChunkTree(e,n))??r.getSemanticChunkTree(e,n),rG}function m9e(t){return t&&Array.isArray(t.text)&&(t.needsLeadingElipsis===void 0||typeof t.needsLeadingElipsis=="boolean")&&(t.needsTrailingElipsis===void 0||typeof t.needsTrailingElipsis=="boolean")}function h9e(t){return t&&typeof t.bodyIndent=="string"&&typeof t.fullRange=="object"&&t.body&&Array.isArray(t.body.content)&&(t.body.outline===void 0||m9e(t.body.outline))&&(t.suffix===void 0||typeof t.suffix=="string")&&(t.header===void 0||typeof t.header=="object"&&typeof t.header.original=="string"&&(t.header.outline===void 0||typeof t.header.outline=="string"))}var s1=class t{constructor(e,r){this.lang=r;this._tokenizerProvider=e.get(yr),this._naiveChunker=new Bd(this._tokenizerProvider),this._parserService=e.get(_t);let n=t.getFileChunkingOptions(r);this._inlineComment=n?.blockWrap??{start:"",end:""},this._elipsisPlaceholder=n?.elipsisPlaceholder??"...",this._lookForIndentInHeader=n?.lookForIndentInHeader??!0,this._numTokensInEllipsis=this._tokenizerProvider.acquireTokenizer({family:"gpt4"}).tokenLength(this._elipsisPlaceholder)+1}static getFileChunkingOptions(e){return e!=="python"&&e!=="ruby"?{elipsisPlaceholder:"/*...*/",blockWrap:{start:"{",end:"}"},lookForIndentInHeader:!1}:{}}get _summaryPlaceHolder(){return this._inlineComment.start+this._elipsisPlaceholder+this._inlineComment.end}async parse(e,r,n){let o=await this.createChunkTree(e,r,n);return o?this.createSummaryFromSemanticChunkTree(o,!0):[]}async createChunkTree(e,r,n){let o=typeof e=="string"?await this.provideQueryTree(e):e;if(!n.isCancellationRequested)return this.createChunkTreeFromQueryTree(o,r,n)}async createSummaryFromSemanticChunkTree(e,r=!1){let n=[];if(e.body.content.length!==0&&n.push(this._makeChunksFromStructure(e.bodyIndent,e.body.content,e.fullRange,!r,e.header?.original,e.suffix)),e.body.outline&&e.body.outline.text.length!==0){let o=e.header?.outline??e.header?.original;n.push(this._makeChunksFromStructure(e.bodyIndent,e.body.outline.text,e.fullRange,!0,o,e.suffix,e.body.outline.needsLeadingElipsis,e.body.outline.needsTrailingElipsis).then(s=>(r&&s.length===1&&(s[0]={...s[0],isFullFile:!0}),s)))}return(await Promise.all(n)).flat()}async createChunkTreeFromQueryTree(e,r,n){let o=Xe.lift(r.limitToRange);if(o)for(let d of e.roots){let p=no(d.info.mainBlock);if(o.containsRange(p)){let f=mk(e.syntaxTreeRoot),m=this.chunkWholeText(f.text,f.range,r.maxTokenLength,0,void 0,o,r.rangeLimitStrategy,"");return{header:{original:"",outline:""},bodyIndent:"",body:{content:m.content.text},fullRange:no(e.syntaxTreeRoot)}}}let s=this._parseBlocks(e.roots,"",r.maxTokenLength,r.maxHeaderLengthFactor,o??void 0,r.rangeLimitStrategy),a=s.content.flat(),c=s.outline??[],u=o&&e.roots.some(d=>Xe.containsRange(no(d.info.mainBlock),o))?void 0:this.createOutlineSummaryBody(r.maxTokenLength,mk(e.syntaxTreeRoot),c,"",o??void 0,r.rangeLimitStrategy);return{bodyIndent:"",fullRange:no(e.syntaxTreeRoot),body:{content:a,outline:u}}}provideQueryTree(e){return nG(e,this.lang,this._parserService)}chunkWholeText(e,r,n,o=0,s=r,a,c,u="",l){if(e.trim().length===0)return{content:{text:[],isFull:!0}};let d=[];try{let p={range:r,text:e},f=s,m=p.text;if(a&&c!==1){let h=Xe.lift(s),g=gk(a,e,h);p=g.newTextRange;let v=h.intersectRanges(a);if(!v)throw Error("Invalid Body Text Range");f=v,m=this._constructLimitedRange(g.trimmedRight,g.trimmedLeft,p.text,u)}if(d=this._naiveChunker.genericChunking({lineRangeText:[{range:p.range,text:m,sources:[{start:o,end:m.length,range:f}]}],maxTokenLength:n,numTokensInEllipsis:this._numTokensInEllipsis,removeChunksOutsideOfRange:a&&c===1?a:void 0}),a&&d.length>0&&c===1){l||(l=u+this.findNewIndentFromText(u,p.text));let h=d[0].range.startLineNumber>p.range.startLineNumber,g=d[d.length-1].range.endLineNumber<p.range.endLineNumber;h&&(d[0].text=this._constructLimitedRange(!1,!0,d[0].text,l)),g&&(d[d.length-1].text=this._constructLimitedRange(!0,!1,d[d.length-1].text,l))}}catch{return{content:{text:[],isFull:!1},outline:[]}}return{content:{text:d,isFull:!0}}}_parseBlocks(e,r,n,o,s,a){return this._parseSemanticStructure(e,r,n,o,(c,u,l,d)=>{let p=d+u.text;if(this._tokenizerProvider.acquireTokenizer({family:"gpt4"}).tokenLength(p)<=l){let g=Dc(/^\s*\n/g,p,u.range),v=Dc(/(\n\s*$)/g,g.text,g.range);if(s&&a!==1){let y=gk(s,v.text,Xe.lift(v.range)),_=this._constructLimitedRange(y.trimmedRight,y.trimmedLeft,y.newTextRange.text,d);return{content:{text:[{sources:[{start:0,end:_.length,range:y.newTextRange.range}],range:y.newTextRange.range,text:_}],isFull:!0}}}else return{content:{text:[{sources:[{start:d.length,end:v.text.length,range:v.range}],range:v.range,text:v.text}],isFull:!0}}}if(c.length===0)return this.chunkWholeText(p,u.range,l,s?0:d.length,void 0,s,a,d);let f=this._parseBlocks(c,d,l,o,s,a),m=f.content,h=f.outline;return{content:{text:m,isFull:!1},outline:h}},s,a)}_createOutlineBody(e,r){let n=e.text.split(`
`),o={lineNumber:e.range.startLineNumber,column:e.range.startColumn},s=[],a=o,c=p=>{let f=p.lineNumber-o.lineNumber,m=p.column;return o.lineNumber===p.lineNumber&&(m=p.column-o.column),{lineNumber:f,column:m}},u=p=>{let f=p.lineNumber-o.lineNumber,m=f>=n.length||p.column===n[f].length-1;return{newPosition:{lineNumber:p.lineNumber,column:p.column+1},isNewLine:m}},l=(p,f)=>{if(p.lineNumber>f.lineNumber||p.lineNumber===f.lineNumber&&p.column>f.column)return;let m=[],h=c(p),g=c(f),v=fu(p,f),y=n[h.lineNumber].substring(h.column);if(h.lineNumber===g.lineNumber){let S=y.substring(0,g.column-h.column),I=u(f);a=I.newPosition,I.isNewLine&&(S+=`
`),m.push(S)}else{let S=n[g.lineNumber].substring(0,g.column),I=u(f);a=I.newPosition,I.isNewLine&&(S+=`
`),m.push(y+`
`);for(let E=h.lineNumber+1;E<g.lineNumber;E++)m.push(n[E]+`
`);m.push(S)}let _=m.join(""),x=Dc(/^\s+\n/,_,v);x.text.length>0&&s.push({sources:[{start:0,end:x.text.length,range:x.range}],text:x.text,range:v})},d=p=>{s.push({sources:p.sources,text:p.summary+`

`,range:p.range})};return r.sort((p,f)=>p.range.startLineNumber-f.range.startLineNumber||p.range.endLineNumber-f.range.endLineNumber),r.forEach(p=>{l(a,{lineNumber:p.range.startLineNumber,column:p.range.startColumn}),d(p),a=u({lineNumber:p.range.endLineNumber,column:p.range.endColumn}).newPosition}),l(a,{lineNumber:e.range.endLineNumber,column:e.range.endColumn}),s}createOutlineSummaryBody(e,r,n,o,s,a){let c=r;if(c.range.startColumn>=o.length){let f={startLineNumber:c.range.startLineNumber,startColumn:c.range.startColumn-o.length,endLineNumber:c.range.endLineNumber,endColumn:c.range.endColumn},m=o+c.text;c={text:m,range:f,sources:[{start:0,end:m.length,range:f}]}}let u=!1,l=!1;if(s&&a!==1){if(n.length===1&&Xe.lift(n[0].range).containsRange(s))return{text:[]};let f=gk(s,r.text,Xe.lift(r.range));l=f.trimmedLeft,u=f.trimmedRight,c={text:f.newTextRange.text,range:f.newTextRange.range,sources:[{start:0,end:f.newTextRange.text.length,range:f.newTextRange.range}]}}let d=this._createOutlineBody(c,n.map(f=>({sources:f.sources,summary:Hce(f.summary),range:f.range,needsTrailingElipsis:u,needsLeadingElipsis:l}))),p=[];try{if(p=this._naiveChunker.genericChunking({lineRangeText:d,removeEmptyLines:!1,maxTokenLength:e,numTokensInEllipsis:this._numTokensInEllipsis,removeChunksOutsideOfRange:s&&a===1?s:void 0}),s&&p.length>0&&a===1){let f=p[0].range.startLineNumber<r.range.startLineNumber,m=p[p.length-1].range.endLineNumber>r.range.endLineNumber;f&&(p[0].text=this._constructLimitedRange(!1,!0,p[0].text,o)),m&&(p[p.length-1].text=this._constructLimitedRange(!0,!1,p[p.length-1].text,o))}}catch(f){return console.error(`caught error in naive chunker: ${f}`),{text:[]}}return{text:p,needsLeadingElipsis:l,needsTrailingElipsis:u}}async _makeChunksFromStructure(e,r,n,o,s,a,c,u){return Nr(await Promise.all(r.map(async(l,d)=>{let p=h9e(l)?await this.createSummaryFromSemanticChunkTree(l):l,f=s&&s.length>0?s:"";(c||o&&d!==0)&&(f+=`${e}${this._elipsisPlaceholder}
`);let m="";if((u||o&&d!==r.length-1)&&(m+=`
${e}${this._elipsisPlaceholder}`),a&&a.length>0&&(m+=a),Array.isArray(p))return Nr(p.map(g=>{if(g.text.trim().length!==0)return{range:g.range,text:f+g.text+m,sources:g.sources.map(v=>({start:v.start+f.length,end:v.end+f.length,range:v.range}))}}));if(p.text.trim().length===0)return;let h={startColumn:(d===0?n:p.range).startColumn,startLineNumber:(d===0?n:p.range).startLineNumber,endColumn:n.endColumn,endLineNumber:n.endLineNumber};return{sources:p.sources.map(g=>({start:g.start+f.length,end:g.end+f.length,range:g.range})),range:h,text:f+p.text+m}}))).flat()}findNewIndent(e,r,n){let s=(this._lookForIndentInHeader?r.text.substring(0,n.startIndex-r.startIndex):n.text).match(new RegExp(`\\n+(\\s*)${e}${this._lookForIndentInHeader?"$":""}`));return s&&s.length>1?s[1]:""}findNewIndentFromText(e,r){let n=r.match(new RegExp(`\\n+(\\s*)${e}${this._lookForIndentInHeader?"$":""}`));return n&&n.length>1?n[1]:""}_constructLimitedRange(e,r,n,o){return n.length===0?"":(r?`${o}${this._elipsisPlaceholder}
`:"")+n+(e?`
${o}${this._elipsisPlaceholder}`:"")}};var _u=class extends s1{_parseSemanticStructure(e,r,n,o,s,a,c){let u=[],l=p=>{let f=p.info,m=f.mainBlock,h=f.detailBlocks.comments,g=f.detailBlocks.body,v=no(g),y=this._getInnerLineRangeText(g),_=g.startIndex-m.startIndex+y.prefix.length,x=this.findNewIndent(r,m,g),S="";for(let ce of h)S+=r+ce.text+`
`;let I=r+m.text.substring(0,_),E=S+I,R=no(m),B=fu(fg((h.length>0?h[0]:m).range.startPosition,0,-r.length),{column:R.endColumn,lineNumber:R.endLineNumber});if(a&&c!==1&&!Xe.lift(B).intersectRanges(a))return;let V=o*n,M=E.replace(/(\n*)(\n\s*)$/g,`
`),le=this._tokenizerProvider.acquireTokenizer({family:"gpt4"}).tokenLength(M);if(le>V&&(M=I.replace(/(\n*)(\n\s*)$/g,`
`),le=this._tokenizerProvider.acquireTokenizer({family:"gpt4"}).tokenLength(I),le>V)){M="",le=0;let ce=this.chunkWholeText(S+r+m.text,no(m),n,S.length+r.length,void 0,a,c,r);return{bodyIndent:r,body:{content:ce.content.text},fullRange:B}}let ne=y.suffix+m.text.substring(g.endIndex-m.startIndex),q=this._tokenizerProvider.acquireTokenizer({family:"gpt4"}).tokenLength(M+`
`+ne),P=n-q;B=fu({column:B.startColumn,lineNumber:B.startLineNumber},fg(m.range.endPosition));let k=pu(ey,m.text.substring(0,g.startIndex-m.startIndex),{startColumn:R.startColumn,startLineNumber:R.startLineNumber,endLineNumber:v.startLineNumber,endColumn:v.startColumn}),U,F=S+r;if(u.push({summary:F+k.text+" "+this._summaryPlaceHolder,range:B,sources:[{start:F.length,end:F.length+k.text.length,range:k.range}]}),a&&c===1&&!Xe.lift(B).intersectRanges(a))return;let $;if(a){let ce=!1,Y=!1;for(let j of p.children){let xe=no(j.info.mainBlock);if(a.containsRange(xe)){Y=!0;break}if(a.intersectRanges(xe)!==null){if(ce===!0){Y=!0;break}ce=!0}}Y&&($={content:{text:this.chunkWholeText(y.body.text,y.body.range,n,0,void 0,a,c,r,r+x).content.text,isFull:!1}})}return $||($=s(p.children,y.body,P,r+x)),$.outline!==void 0&&(U=this.createOutlineSummaryBody(P,y.body,$.outline,r+x,a,c)),{header:{original:M},bodyIndent:r+x,body:{content:$.content.text,outline:U},fullRange:B,suffix:ne}},d=Nr(e.map(p=>l(p)));return{outline:u,content:d}}_getInnerLineRangeText(e){let r=no(e),n=e.text,o=Dc(/^\s*\{\s*/,n,r),s=pu(/\s*\}\s*$/,o.text,o.range);return{prefix:n.slice(0,n.length-o.text.length),body:{sources:[{start:0,end:s.text.length,range:s.range}],text:s.text,range:s.range},suffix:o.text.slice(s.text.length)}}};var NO=class{constructor(e){this.accessor=e;this.naiveChunker=new Bd(e.get(yr))}async parse(e,r,n){let o=r.rangeLimitStrategy,s=this._getLineRangeText(e,o!==1?r.limitToRange:void 0);return this.naiveChunker.genericChunking({lineRangeText:s,maxTokenLength:r.maxTokenLength,extraLineRangeSeparator:`

`,removeChunksOutsideOfRange:o===1?Xe.lift(r.limitToRange)??void 0:void 0})}_getLineRangeText(e,r){e=e.replace(/\r\n/g,`
`);let n=e.split(`
`),o=[],s={lineNumber:0,column:0},a=[],c=r?r.startLineNumber:0,u=r?r.startColumn:void 0,l=Math.min(r?r.endLineNumber+1:n.length,n.length),d=r?r.endColumn:void 0;for(let p=c;p<l;p++)if(p===0&&u?n[p]=n[p].substring(u):p===l-1&&d&&(n[p]=n[p].substring(0,d)),n[p].trim().length===0){if(o.length>0){let f=o.join(`
`),m=fu(s,{lineNumber:p-1,column:n[p-1].length});a.push({sources:[{start:0,end:f.length,range:m}],text:f,range:m}),o.length=0}s={lineNumber:p+1,column:0};continue}else o.push(n[p]);if(o.length>0){let p=o.join(`
`),f=fu(s,{lineNumber:n.length-1,column:n[n.length-1].length});a.push({sources:[{start:0,end:p.length,range:f}],text:p,range:f})}return a}};var LO=class extends s1{_parseSemanticStructure(e,r,n,o,s,a,c){let u=[],l=p=>{let f=p.info,m=f.mainBlock,h=f.detailBlocks.decorator,g=f.detailBlocks.docstring,v=f.detailBlocks.body,y={start:0,end:0,range:null};if(g)y.end=g.endIndex-m.startIndex,y.range={startLineNumber:m.range.startPosition.row,startColumn:m.range.startPosition.column,endLineNumber:g.range.endPosition.row,endColumn:g.range.endPosition.column};else if(v)y.end=v.startIndex-m.startIndex,y.range={startLineNumber:m.range.startPosition.row,startColumn:m.range.startPosition.column,endLineNumber:v.range.startPosition.row,endColumn:v.range.startPosition.column};else{let k=pu(1,m.text,y.range);y.end=m.text.length,y.range=k.range}let _=this.findNewIndent(r,m,v),x=[],S="";h&&(S=r+h.text+`
`,x.push({start:r.length,end:h.text.length+r.length,range:no(h)}));let I=pu(ey,m.text.substring(0,y.end),y.range);x.push({start:S.length+r.length,end:S.length+r.length+I.text.length,range:I.range});let E=S+r+I.text+`
`,R=fu(fg(m.range.startPosition,0,-r.length),fg(m.range.endPosition));if(h&&(R=fu(fg(h.range.startPosition,0,-r.length),{column:R.endColumn,lineNumber:R.endLineNumber})),a&&c!==1&&!Xe.lift(R).intersectRanges(a))return;let B=o*n,V=E.replace(/\n+\s*$/g,`
`),M=this._tokenizerProvider.acquireTokenizer({family:"gpt4"}).tokenLength(V);if(M>B&&(V=r+I.text.substring(0,v.startIndex-m.startIndex),M=this._tokenizerProvider.acquireTokenizer({family:"gpt4"}).tokenLength(V),M>B)){V="",M=0;let k=Dc(g?g.endIndex-v.startIndex:0,v.text,no(v)),U=this.chunkWholeText(E+`
`+k.text,no(m),n,E.length+1,k.range,a,c,r);return{fullRange:R,body:{content:U.content.text},bodyIndent:r}}if(R=fu({column:R.startColumn,lineNumber:R.startLineNumber},fg(m.range.endPosition)),u.push({summary:(g?E+_:E.slice(0,-1)+" ")+this._summaryPlaceHolder,sources:x,range:R}),a&&c===1&&!Xe.lift(R).intersectRanges(a))return;let le=mk(v),ne;if(a){let k=!1,U=!1;for(let F of p.children){let $=no(F.info.mainBlock);if(a.containsRange($)){U=!0;break}if(a.intersectRanges($)!==null){if(k===!0){U=!0;break}k=!0}}if(U){let F=Dc(g?g.endIndex-v.startIndex:0,v.text,no(v));ne={content:{text:this.chunkWholeText(F.text,no(m),n,0,F.range,a,c,r,r+_).content.text,isFull:!1}}}}ne||(ne=s(p.children,le,n-M,r+_));let q=r+m.text.substring(0,v.startIndex-m.startIndex).replace(/\n+\s*$/g,`
`);ne.content.isFull&&(V=q);let P;return ne.outline!==void 0&&(P=this.createOutlineSummaryBody(n-M,le,ne.outline,r+_,a,c)),{header:{original:V,outline:q},bodyIndent:r+_,body:{content:ne.content.text,outline:P},fullRange:R}},d=Nr(e.map(p=>l(p)));return{outline:u,content:d}}};var g9e=.6,py=ie("ChunkingService"),Dle=(t,e)=>({file:t,text:e.text,sources:e.sources.map(r=>({start:r.start,end:r.end,range:Xe.lift(r.range)})),range:Xe.lift(e.range),isFullFile:e.isFullFile}),a1=class{constructor(e){this.accessor=e;this.semanticChunkers=new Map;this.tokenizerProvider=this.accessor.get(yr),this.naiveChunker=new Bd(this.tokenizerProvider),this.parserService=this.accessor.get(_t),this.logService=this.accessor.get(oe)}async getQueryMatchTreeForResource(e,r){let n=ha(e),o=Ol(n.languageId);if(o)return await nG(r,o,this.parserService)}canSemanticallyChunk(e){return!!this.getSemanticChunker(e)}async chunkFileNaive(e,r,n,o){let s=o?.maxTokenLength??await Nle(this.accessor);if(n.isCancellationRequested)return[];let a;o&&o.limitToRange&&(o.includeExtraBodyOutsideRange===!0?a=1:o.includeExtraBodyOutsideRange===!1?a=0:a=1);let u=this.naiveChunker.genericWholeFileChunking(r,{maxTokenLength:s,rangeLimit:o?.limitToRange,rangeLimitStrategy:a}).map(l=>Dle(e,l));return o?.validateChunkLengths&&this.validateChunkLengths(u,s),u.filter(l=>l.text)}async chunkFileSemantic(e,r,n,o){let s=o?.maxTokenLength??await Nle(this.accessor);if(n.isCancellationRequested)return[];let a;o&&o.limitToRange&&(o.includeExtraBodyOutsideRange===!0?a=1:o.includeExtraBodyOutsideRange===!1?a=0:a=1);let c=o?.maxHeaderLengthFactor??g9e,u=[];try{let l=await this.getSemanticChunker(e)?.parse(r,{maxTokenLength:s,maxHeaderLengthFactor:c,limitToRange:o?.limitToRange,rangeLimitStrategy:a},n);if(n.isCancellationRequested)return[];u.push(...Array.from(l??[],d=>Dle(e,d)))}catch(l){this.logService.public.error("Error parsing semantic chunks for the following file: "+e.fsPath),this.logService.public.error(l),u=[]}if(!u.length){let l=typeof r=="string"?r:r.syntaxTreeRoot.text;return this.chunkFileNaive(e,l,n,{maxTokenLength:s,validateChunkLengths:o?.validateChunkLengths,limitToRange:o?.limitToRange,includeExtraBodyOutsideRange:o?.includeExtraBodyOutsideRange})}return o?.validateChunkLengths&&this.validateChunkLengths(u,s),u.filter(l=>l.text)}validateChunkLengths(e,r){for(let n of e){let o=this.tokenizerProvider.acquireTokenizer({family:"gpt4"}).tokenLength(n.text);o>r*1.2&&console.warn("Produced chunk that is over length limit",{file:n.file+"",range:n.range,chunkTokenLength:o,maxLength:r})}}getSemanticChunker(e){let r=ha(e),n=this.semanticChunkers.get(r.languageId);if(n)return n;let o;switch(r.languageId){case"typescript":o=new _u(this.accessor,"typescript");break;case"typescriptreact":o=new _u(this.accessor,"tsx");break;case"javascript":case"javascriptreact":o=new _u(this.accessor,"javascript");break;case"python":o=new LO(this.accessor,"python");break;case"java":o=new _u(this.accessor,"java");break;case"cpp":case"c":o=new _u(this.accessor,"cpp");break;case"csharp":o=new _u(this.accessor,"csharp");break;case"go":o=new _u(this.accessor,"go");break;case"markdown":o=new NO(this.accessor);break;case"ruby":o=new _u(this.accessor,"ruby");break;case"rust":o=new _u(this.accessor,"rust");break}return o&&this.semanticChunkers.set(r.languageId,o),o}};a1=w([b(0,st)],a1);async function Nle(t){return Uk(t,{valueFor4096:w4,maxMultiplier:4})}function c1(t){return new Qe(t.startLineNumber,t.startColumn,t.endLineNumber,t.endColumn)}async function Uk(t,e){let n=(await t.get(Se).getChatEndpoint("gpt-3.5-turbo")).modelMaxPromptTokens/4096;return Ale(Math.round(e.valueFor4096*n),e.valueFor4096,e.valueFor4096*e.maxMultiplier)}async function Lle(t,e){let r=new yo;try{let n=await t();return e(r.elapsed(),"success"),n}catch(n){throw e(r.elapsed(),Af(n)?"cancelled":"failed"),n}}async function Yd(t,e,r,n){return Lle(()=>(t.internal.debug(`${e} started`),r()),(o,s)=>{t.internal.debug(`${e} ${s}. Elapsed ${o}`),n?.(o,s)})}function oo(t,e){return function(r,n,o){let s=o.value,a=0;return o.value=async function(...c){let u=a++,l=t(this);return Yd(l,`${n}#${u}`,()=>s.apply(this,c),e?.bind(this))},o}}function Bk(t){return function(e,r,n){let o=n.value;return n.value=function(...s){return Lle(()=>o.apply(this,s),t.bind(this))},n}}var RG=H(Gt());var u1=class extends Error{constructor(r,n){super(n);this.repo=r}},qk=class extends u1{constructor(){super(...arguments);this.name="ERROR_TYPE_MISSING_INACCESSIBLE_REPO_ORG"}},iG=class extends u1{constructor(){super(...arguments);this.name="ERROR_TYPE_DOCS_EMBEDDINGS_UNAVAILABLE"}},jk=class extends u1{constructor(){super(...arguments);this.name="ERROR_TYPE_NOT_INDEXED"}},oG=class extends Error{constructor(){super(...arguments);this.name="ERROR_TYPE_MAX_RETRIES_EXCEEDED"}},sG=class extends Error{constructor(){super(...arguments);this.name="ERROR_TYPE_NO_ACCESS_TO_ENDPOINT"}};function Ole({error:t,message:e,repo:r}){switch(t){case"ERROR_TYPE_MISSING_INACCESSIBLE_REPO_ORG":return new qk(r,e);case"ERROR_TYPE_DOCS_EMBEDDINGS_UNAVAILABLE":return new iG(r,e);case"ERROR_TYPE_NOT_INDEXED":return new jk(r,e);default:return new u1(r,e)}}function aG({error:t,message:e}){switch(t){case"ERROR_TYPE_MAX_RETRIES_EXCEEDED":return new oG(e);case"ERROR_TYPE_NO_ACCESS_TO_ENDPOINT":return new sG(e);default:return new Error(e)}}var Qf=ie("ISimulationTestContext"),OO=class{constructor(){this.isInSimulationTests=!1}async writeFile(e,r,n){return""}};var vG=H(tde());function qO(t,e){return typeof e=="string"?vG.default.isMatch(t.fsPath,e,{dot:!0,windows:process.platform==="win32"}):vG.default.isMatch(t.fsPath,e.pattern,{dot:!0,windows:process.platform==="win32"})}function rde(t,e){return e.exclude?.some(r=>qO(t,r))?!1:e.include?e.include.some(r=>qO(t,r)):!0}function nde(t,e){let r=typeof t=="string"?t:t.baseUri.toString()+t.pattern,n=typeof e=="string"?e:e.baseUri.toString()+e.pattern;return r=r.replace(/\{.*\}/g,""),n=n.replace(/\{.*\}/g,""),`{${r},${n}}`}var jO=ie("codeSearchClient"),d1=ie("docsSearchClient");var cde=H(sde()),ude=require("util");var i7e=1e5,o7e=1*1024*1024,s7e=new Set(["jpg","jpeg","jpe","png","gif","bmp","tif","tiff","tga","ico","webp","svg","eps","heif","heic","pdf","raw","mp4","m4v","mkv","webm","mov","avi","wmv","flv","mp3","wav","m4a","flac","ogg","wma","weba","aac","7z","bz2","gz","gz","rar","tar","xz","zip","vsix","db","bin","dat","hex","map","wasm","pyc","pdb","sym","git"]),a7e=["node_modules","out","dist",".git",".yarn",".npm",".venv","foo.asar",".vscode-test"],c7e=[".DS_Store","Thumbs.db","package-lock.json","yarn.lock"],u7e=[xn.vscode,xn.vscodeUserData,"output",xn.inMemory,xn.internal,"git"];function l7e(t,e){if(u7e.includes(e.scheme))return!1;let r=t.get(Ve);if(![xn.file,xn.untitled].includes(e.scheme)&&!r.getWorkspaceFolders().some(s=>e.scheme===s.scheme))return!1;let n=Rc(e).replace(/\./,"").toLowerCase();return!(s7e.has(n)||c7e.includes(ou(e).toLowerCase())||e.fsPath.toLowerCase().split(/[/\\]/g).some(s=>a7e.includes(s)))}async function fy(t,e){let r=t.get(ke);return l7e(t,e)&&!await r.isCopilotIgnored(e)}async function ade(t,e,r){let n=t.get(Ve),o=t.get(Fd);if(await t.get(ke).init(),r?.isCancellationRequested)return[];let a=new tn;for(let c of n.getWorkspaceFolders()??[]){if(a.size>=e)break;let u=await o.findFilesWithDefaultExcludes(new RS(c,"**/*"),e-a.size,r);if(r.isCancellationRequested)return[];for(let l of u){if(a.size>=e||r.isCancellationRequested)break;await fy(t,l)&&a.set(l)}}return a.keys()}var VO=class{constructor(e,r){this._uri=e;this._chunkingService=r;this._isDisposed=!1;this._disposedCts=new la}dispose(){this._isDisposed=!0,this._disposedCts.cancel(),this._disposedCts.dispose()}get uri(){return this._uri}async getQueryMatchTree(e){return this._queryMatchTree??=this.getText(this._disposedCts.token).then(r=>{if(!this._isDisposed)return this._chunkingService.getQueryMatchTreeForResource(this._uri,r)}),await su(this._queryMatchTree,e)??void 0}async getBasicChunks(e,r){return this._basicChunks??=this.getText(this._disposedCts.token).then(n=>this._isDisposed?[]:this._chunkingService.chunkFileNaive(this._uri,n,this._disposedCts.token,{limitToRange:r})),await su(this._basicChunks,e)??[]}async getSemanticChunks(e,r){return this._chunkingService.canSemanticallyChunk(this.uri)?await su((async()=>{if(ha(this.uri).languageId==="markdown"){let s=await this.getText(this._disposedCts.token);return this._isDisposed?void 0:r?this._chunkingService.chunkFileSemantic(this._uri,s,this._disposedCts.token,{limitToRange:r}):(this._fullFileSemanticChunks??=this._chunkingService.chunkFileSemantic(this._uri,s,this._disposedCts.token),this._fullFileSemanticChunks)}let o=await this.getQueryMatchTree(this._disposedCts.token);return o?this._isDisposed?[]:r?this._chunkingService.chunkFileSemantic(this._uri,o,this._disposedCts.token,{limitToRange:r}):(this._fullFileSemanticChunks??=this._chunkingService.chunkFileSemantic(this._uri,o,this._disposedCts.token),this._fullFileSemanticChunks):this.getBasicChunks(e,r)})(),e)??[]:this.getBasicChunks(e,r)}},xG=class extends VO{constructor(r,n,o){super(r,n);this._fs=o}async getText(r){return this._text??=this._fs.readFile(this.uri).then(async n=>this._isDisposed||n.byteLength>=o7e||await(0,cde.isBinaryFile)(Buffer.from(n))||this._isDisposed?"":new ude.TextDecoder().decode(n),n=>""),await su(this._text,r)??""}},GO=class extends VO{constructor(r,n){super(r.uri,n);this._textDocument=r}async getText(r){return this._textDocument.getText()}},Oc=ie("workspaceFileIndex"),p1=class extends dt{constructor(r,n,o,s,a){super();this._accessor=r;this._chunkingService=n;this._fileSystem=o;this._telemetryService=s;this._workspaceService=a;this._textDocumentFiles=new tn;this._fsFiles=new tn;this._onDidCreateFile=this._register(new Yt);this.onDidCreateFile=this._onDidCreateFile.event;this._onDidChangeFile=this._register(new Yt);this.onDidChangeFile=this._onDidChangeFile.event;this._onDidDeleteFile=this._register(new Yt);this.onDidDeleteFile=this._onDidDeleteFile.event;this._commonInit=new Ti(async()=>{this.registerListeners(),await this._workspaceService.ensureWorkspaceIsFullyLoaded();for(let r of this._workspaceService.textDocuments)await fy(this._accessor,r.uri)&&this._textDocumentFiles.set(r.uri,new GO(r,this._chunkingService))})}get fileSystemFileCount(){return this._fsFiles.size}dispose(){super.dispose(),Bh(this._fsFiles.values()),this._fsFiles.clear(),Bh(this._textDocumentFiles.values()),this._textDocumentFiles.clear()}get(r){return this._textDocumentFiles.get(r)||this._fsFiles.get(r)}*values(){let r=new tn;for(let[n,o]of this._textDocumentFiles.entries())yield o,r.set(n);for(let[n,o]of this._fsFiles.entries())r.has(n)||(r.set(n),yield o)}registerListeners(){let r=async o=>{if(!await fy(this._accessor,o.uri))return;let s=this._textDocumentFiles.get(o.uri),a=this._fsFiles.get(o.uri);s?.dispose(),this._textDocumentFiles.set(o.uri,new GO(o,this._chunkingService)),!s&&!a?this._onDidCreateFile.fire(o.uri):this._onDidChangeFile.fire(o.uri)};this._register(this._workspaceService.onDidOpenTextDocument(r)),this._register(this._workspaceService.onDidChangeTextDocument(o=>r(o.document))),this._register(this._workspaceService.onDidCloseTextDocument(o=>{let s=this._textDocumentFiles.get(o.uri);if(!s)return;this._textDocumentFiles.delete(o.uri),s.dispose(),this._fsFiles.get(o.uri)?this._onDidChangeFile.fire(o.uri):this._onDidDeleteFile.fire(o.uri)}));let n=this._register(this._fileSystem.createFileSystemWatcher("**/*"));this._register(n.onDidChange(async o=>{if(!await fy(this._accessor,o))return;let s=this._fsFiles.has(o);this.createOrUpdateFsEntry(o),s?this._onDidChangeFile.fire(o):this._onDidCreateFile.fire(o)})),this._register(n.onDidCreate(async o=>{await fy(this._accessor,o)&&(this._fsFiles.has(o)||(this.createOrUpdateFsEntry(o),this._onDidCreateFile.fire(o)))})),this._register(n.onDidDelete(o=>{let s=this._fsFiles.get(o);s&&(s.dispose(),this._fsFiles.delete(o),this._onDidDeleteFile.fire(o))}))}async preLoadWorkspaceFiles(r,n){switch(this._preloadWorkspaceFilesState?.type){case"full":return;case"partial":case"pending":if(this._preloadWorkspaceFilesState.count>=r)return;break}let o=(async()=>{await this._commonInit.value;let s=Array.from(await ade(this._accessor,r,n));for(let a of s)this.createOrUpdateFsEntry(a);this._preloadWorkspaceFilesState?.type==="pending"&&this._preloadWorkspaceFilesState.p===o&&(n.isCancellationRequested?this._preloadWorkspaceFilesState=void 0:this._preloadWorkspaceFilesState=s.length<r?{type:"full"}:{type:"partial",count:r})})();return this._preloadWorkspaceFilesState={type:"pending",count:r,p:o},o}initialize(){return this._initialized??=(async()=>{switch(await this._commonInit.value,this._preloadWorkspaceFilesState?.type){case"full":break;case"partial":case"pending":default:{let r=Array.from(await ade(this._accessor,i7e,Lr.None));for(let n of r)this.createOrUpdateFsEntry(n)}}this._telemetryService.sendMSFTTelemetryEvent("workspaceChunkIndex.initialize",{},{totalFileCount:Os.reduce(this.values(),r=>r+1,0)})})(),this._initialized}createOrUpdateFsEntry(r){let n=this._fsFiles.get(r);n&&n.dispose();let o=new xG(r,this._chunkingService,this._fileSystem);this._fsFiles.set(r,o)}};p1=w([b(0,st),b(1,py),b(2,hr),b(3,he),b(4,Ve)],p1);async function zO(t,e,r,n=!1){let o=t.get(Oc),s=t.get(py),a=new tn;for(let u of e){let l=a.get(u.file);l?l.push(u):a.set(u.file,[u])}let c=await Promise.all(Array.from(a,async([u,l])=>{let d=o.get(u);if(d&&s.canSemanticallyChunk(u)){let p=new Set;if(n)for(let f of l){let m=f.range,h=await d.getSemanticChunks(r,m);if(r.isCancellationRequested)return[];h.length===0?p.add(f):h.forEach(g=>p.add(g))}else{let f=await d.getSemanticChunks(r);if(r.isCancellationRequested)return[];for(let m of l){let h=!1;for(let g of f)g.range.intersectRanges(m.range)&&(p.add(g),h=!0);h||p.add(m)}}return Array.from(p)}else return l}));return Array.from(new Set(c.flat()))}var $O=class t{constructor(e,r,n,o){this._uri=e,this._languageId=r,this._version=n,this._content=o,this._lineOffsets=void 0}get uri(){return this._uri}get languageId(){return this._languageId}get version(){return this._version}getText(e){if(e){let r=this.offsetAt(e.start),n=this.offsetAt(e.end);return this._content.substring(r,n)}return this._content}update(e,r){for(let n of e)if(t.isIncremental(n)){let o=dde(n.range),s=this.offsetAt(o.start),a=this.offsetAt(o.end);this._content=this._content.substring(0,s)+n.text+this._content.substring(a,this._content.length);let c=Math.max(o.start.line,0),u=Math.max(o.end.line,0),l=this._lineOffsets,d=lde(n.text,!1,s);if(u-c===d.length)for(let f=0,m=d.length;f<m;f++)l[f+c+1]=d[f];else d.length<1e4?l.splice(c+1,u-c,...d):this._lineOffsets=l=l.slice(0,c+1).concat(d,l.slice(u+1));let p=n.text.length-(a-s);if(p!==0)for(let f=c+1+d.length,m=l.length;f<m;f++)l[f]=l[f]+p}else if(t.isFull(n))this._content=n.text,this._lineOffsets=void 0;else throw new Error("Unknown change event received");this._version=r}getLineOffsets(){return this._lineOffsets===void 0&&(this._lineOffsets=lde(this._content,!0)),this._lineOffsets}positionAt(e){e=Math.max(Math.min(e,this._content.length),0);let r=this.getLineOffsets(),n=0,o=r.length;if(o===0)return{line:0,character:e};for(;n<o;){let a=Math.floor((n+o)/2);r[a]>e?o=a:n=a+1}let s=n-1;return{line:s,character:e-r[s]}}offsetAt(e){let r=this.getLineOffsets();if(e.line>=r.length)return this._content.length;if(e.line<0)return 0;let n=r[e.line],o=e.line+1<r.length?r[e.line+1]:this._content.length;return Math.max(Math.min(n+e.character,o),n)}get lineCount(){return this.getLineOffsets().length}static isIncremental(e){let r=e;return r!=null&&typeof r.text=="string"&&r.range!==void 0&&(r.rangeLength===void 0||typeof r.rangeLength=="number")}static isFull(e){let r=e;return r!=null&&typeof r.text=="string"&&r.range===void 0&&r.rangeLength===void 0}},f1;(function(t){function e(o,s,a,c){return new $O(o,s,a,c)}t.create=e;function r(o,s,a){if(o instanceof $O)return o.update(s,a),o;throw new Error("TextDocument.update: document must be created by TextDocument.create")}t.update=r;function n(o,s){let a=o.getText(),c=SG(s.map(d7e),(d,p)=>{let f=d.range.start.line-p.range.start.line;return f===0?d.range.start.character-p.range.start.character:f}),u=0,l=[];for(let d of c){let p=o.offsetAt(d.range.start);if(p<u)throw new Error("Overlapping edit");p>u&&l.push(a.substring(u,p)),d.newText.length&&l.push(d.newText),u=o.offsetAt(d.range.end)}return l.push(a.substr(u)),l.join("")}t.applyEdits=n})(f1||(f1={}));function SG(t,e){if(t.length<=1)return t;let r=t.length/2|0,n=t.slice(0,r),o=t.slice(r);SG(n,e),SG(o,e);let s=0,a=0,c=0;for(;s<n.length&&a<o.length;)e(n[s],o[a])<=0?t[c++]=n[s++]:t[c++]=o[a++];for(;s<n.length;)t[c++]=n[s++];for(;a<o.length;)t[c++]=o[a++];return t}function lde(t,e,r=0){let n=e?[r]:[];for(let o=0;o<t.length;o++){let s=t.charCodeAt(o);(s===13||s===10)&&(s===13&&o+1<t.length&&t.charCodeAt(o+1)===10&&o++,n.push(r+o+1))}return n}function dde(t){let e=t.start,r=t.end;return e.line>r.line||e.line===r.line&&e.character>r.character?{start:r,end:e}:t}function d7e(t){let e=dde(t.range);return e!==t.range?{newText:t.newText,range:e}:t}var Og=class{},p7e=30*1e3;function pde(t,e,r,n,o,s,a,c,u,l,d,p){let f=typeof s=="string"?{modelMaxPromptTokens:0,url:s,family:"",name:"",version:""}:s,m={Authorization:`Bearer ${a}`,"X-Request-Id":l,"X-GitHub-Api-Version":"2023-07-07","Openai-Organization":"github-copilot","Copilot-Integration-Id":e.isProduction()?"vscode-chat":"vscode-chat-dev","VScode-SessionId":e.sessionId,"VScode-MachineId":e.machineId,...e.getEditorVersionHeaders(),...f.getExtraHeaders?f.getExtraHeaders():{}};if(f.interceptBody&&f.interceptBody(d),u&&(m["OpenAI-Intent"]=u),!e.isProduction()&&f.url.includes(n.capiBaseURL)){if(!c)throw new Error("HMAC must be provided for non-production requests");m["Request-Hmac"]=c}let h={method:o,headers:m,json:d,timeout:p7e},g=t;if(p){let y=g.makeAbortController();p.onCancellationRequested(()=>{r.sendGHTelemetryEvent("networking.cancelRequest",{headerRequestId:l}),y.abort()}),h.signal=y.signal}return g.fetch(f.url,h).catch(y=>{if(y.code==="ECONNRESET"||y.code==="ETIMEDOUT"||y.code==="ERR_HTTP2_INVALID_SESSION"||y.code==="ERR_HTTP2_STREAM_CANCEL"||y.message==="ERR_HTTP2_GOAWAY_SESSION")return r.sendGHTelemetryEvent("networking.disconnectAll"),g.disconnectAll().then(()=>g.fetch(f.url,h));throw g.isAbortError(y)?new Hi:y})}function Mg(t,e,r,n,o,s,a,c,u,l,d){return pde(t,e,r,n,"POST",o,s,a,c,u,l,d)}function IG(t,e,r,n,o,s,a,c,u,l,d){return pde(t,e,r,n,"GET",o,s,a,c,u,l,d)}var fde=ie("headerContributors"),WO=class{constructor(){this.contributors=[]}add(e){this.contributors.push(e)}remove(e){let r=this.contributors.indexOf(e);r!==-1&&this.contributors.splice(r,1)}contributeHeaders(e){for(let r of this.contributors)r.contributeHeaderValues(e)}size(){return this.contributors.length}};var m1=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,hde=new Set,CG=typeof process=="object"&&process?process:{},gde=(t,e,r,n)=>{typeof CG.emitWarning=="function"?CG.emitWarning(t,e,r,n):console.error(`[${r}] ${e}: ${t}`)},KO=globalThis.AbortController,mde=globalThis.AbortSignal;if(typeof KO>"u"){mde=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(n,o){this._onabort.push(o)}},KO=class{constructor(){e()}signal=new mde;abort(n){if(!this.signal.aborted){this.signal.reason=n,this.signal.aborted=!0;for(let o of this.signal._onabort)o(n);this.signal.onabort?.(n)}}};let t=CG.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",e=()=>{t&&(t=!1,gde("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}var f7e=t=>!hde.has(t),vDt=Symbol("type"),Fg=t=>t&&t===Math.floor(t)&&t>0&&isFinite(t),vde=t=>Fg(t)?t<=Math.pow(2,8)?Uint8Array:t<=Math.pow(2,16)?Uint16Array:t<=Math.pow(2,32)?Uint32Array:t<=Number.MAX_SAFE_INTEGER?h1:null:null,h1=class extends Array{constructor(e){super(e),this.fill(0)}},TG=class t{heap;length;static#t=!1;static create(e){let r=vde(e);if(!r)return[];t.#t=!0;let n=new t(e,r);return t.#t=!1,n}constructor(e,r){if(!t.#t)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new r(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}},YO=class t{#t;#i;#d;#r;#c;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#a;#m;#s;#n;#e;#p;#h;#l;#u;#v;#f;#_;#x;#b;#S;#E;#g;static unsafeExposeInternals(e){return{starts:e.#x,ttls:e.#b,sizes:e.#_,keyMap:e.#s,keyList:e.#n,valList:e.#e,next:e.#p,prev:e.#h,get head(){return e.#l},get tail(){return e.#u},free:e.#v,isBackgroundFetch:r=>e.#o(r),backgroundFetch:(r,n,o,s)=>e.#D(r,n,o,s),moveToTail:r=>e.#k(r),indexes:r=>e.#I(r),rindexes:r=>e.#C(r),isStale:r=>e.#y(r)}}get max(){return this.#t}get maxSize(){return this.#i}get calculatedSize(){return this.#m}get size(){return this.#a}get fetchMethod(){return this.#c}get dispose(){return this.#d}get disposeAfter(){return this.#r}constructor(e){let{max:r=0,ttl:n,ttlResolution:o=1,ttlAutopurge:s,updateAgeOnGet:a,updateAgeOnHas:c,allowStale:u,dispose:l,disposeAfter:d,noDisposeOnSet:p,noUpdateTTL:f,maxSize:m=0,maxEntrySize:h=0,sizeCalculation:g,fetchMethod:v,noDeleteOnFetchRejection:y,noDeleteOnStaleGet:_,allowStaleOnFetchRejection:x,allowStaleOnFetchAbort:S,ignoreFetchAbort:I}=e;if(r!==0&&!Fg(r))throw new TypeError("max option must be a nonnegative integer");let E=r?vde(r):Array;if(!E)throw new Error("invalid max value: "+r);if(this.#t=r,this.#i=m,this.maxEntrySize=h||this.#i,this.sizeCalculation=g,this.sizeCalculation){if(!this.#i&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(v!==void 0&&typeof v!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#c=v,this.#E=!!v,this.#s=new Map,this.#n=new Array(r).fill(void 0),this.#e=new Array(r).fill(void 0),this.#p=new E(r),this.#h=new E(r),this.#l=0,this.#u=0,this.#v=TG.create(r),this.#a=0,this.#m=0,typeof l=="function"&&(this.#d=l),typeof d=="function"?(this.#r=d,this.#f=[]):(this.#r=void 0,this.#f=void 0),this.#S=!!this.#d,this.#g=!!this.#r,this.noDisposeOnSet=!!p,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!y,this.allowStaleOnFetchRejection=!!x,this.allowStaleOnFetchAbort=!!S,this.ignoreFetchAbort=!!I,this.maxEntrySize!==0){if(this.#i!==0&&!Fg(this.#i))throw new TypeError("maxSize must be a positive integer if specified");if(!Fg(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#U()}if(this.allowStale=!!u,this.noDeleteOnStaleGet=!!_,this.updateAgeOnGet=!!a,this.updateAgeOnHas=!!c,this.ttlResolution=Fg(o)||o===0?o:1,this.ttlAutopurge=!!s,this.ttl=n||0,this.ttl){if(!Fg(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#N()}if(this.#t===0&&this.ttl===0&&this.#i===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#t&&!this.#i){let R="LRU_CACHE_UNBOUNDED";f7e(R)&&(hde.add(R),gde("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",R,t))}}getRemainingTTL(e){return this.#s.has(e)?1/0:0}#N(){let e=new h1(this.#t),r=new h1(this.#t);this.#b=e,this.#x=r,this.#L=(s,a,c=m1.now())=>{if(r[s]=a!==0?c:0,e[s]=a,a!==0&&this.ttlAutopurge){let u=setTimeout(()=>{this.#y(s)&&this.delete(this.#n[s])},a+1);u.unref&&u.unref()}},this.#w=s=>{r[s]=e[s]!==0?m1.now():0},this.#T=(s,a)=>{if(e[a]){let c=e[a],u=r[a];if(!c||!u)return;s.ttl=c,s.start=u,s.now=n||o();let l=s.now-u;s.remainingTTL=c-l}};let n=0,o=()=>{let s=m1.now();if(this.ttlResolution>0){n=s;let a=setTimeout(()=>n=0,this.ttlResolution);a.unref&&a.unref()}return s};this.getRemainingTTL=s=>{let a=this.#s.get(s);if(a===void 0)return 0;let c=e[a],u=r[a];if(!c||!u)return 1/0;let l=(n||o())-u;return c-l},this.#y=s=>{let a=r[s],c=e[s];return!!c&&!!a&&(n||o())-a>c}}#w=()=>{};#T=()=>{};#L=()=>{};#y=()=>!1;#U(){let e=new h1(this.#t);this.#m=0,this.#_=e,this.#R=r=>{this.#m-=e[r],e[r]=0},this.#O=(r,n,o,s)=>{if(this.#o(n))return 0;if(!Fg(o))if(s){if(typeof s!="function")throw new TypeError("sizeCalculation must be a function");if(o=s(n,r),!Fg(o))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return o},this.#P=(r,n,o)=>{if(e[r]=n,this.#i){let s=this.#i-e[r];for(;this.#m>s;)this.#A(!0)}this.#m+=e[r],o&&(o.entrySize=n,o.totalCalculatedSize=this.#m)}}#R=e=>{};#P=(e,r,n)=>{};#O=(e,r,n,o)=>{if(n||o)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#I({allowStale:e=this.allowStale}={}){if(this.#a)for(let r=this.#u;!(!this.#M(r)||((e||!this.#y(r))&&(yield r),r===this.#l));)r=this.#h[r]}*#C({allowStale:e=this.allowStale}={}){if(this.#a)for(let r=this.#l;!(!this.#M(r)||((e||!this.#y(r))&&(yield r),r===this.#u));)r=this.#p[r]}#M(e){return e!==void 0&&this.#s.get(this.#n[e])===e}*entries(){for(let e of this.#I())this.#e[e]!==void 0&&this.#n[e]!==void 0&&!this.#o(this.#e[e])&&(yield[this.#n[e],this.#e[e]])}*rentries(){for(let e of this.#C())this.#e[e]!==void 0&&this.#n[e]!==void 0&&!this.#o(this.#e[e])&&(yield[this.#n[e],this.#e[e]])}*keys(){for(let e of this.#I()){let r=this.#n[e];r!==void 0&&!this.#o(this.#e[e])&&(yield r)}}*rkeys(){for(let e of this.#C()){let r=this.#n[e];r!==void 0&&!this.#o(this.#e[e])&&(yield r)}}*values(){for(let e of this.#I())this.#e[e]!==void 0&&!this.#o(this.#e[e])&&(yield this.#e[e])}*rvalues(){for(let e of this.#C())this.#e[e]!==void 0&&!this.#o(this.#e[e])&&(yield this.#e[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,r={}){for(let n of this.#I()){let o=this.#e[n],s=this.#o(o)?o.__staleWhileFetching:o;if(s!==void 0&&e(s,this.#n[n],this))return this.get(this.#n[n],r)}}forEach(e,r=this){for(let n of this.#I()){let o=this.#e[n],s=this.#o(o)?o.__staleWhileFetching:o;s!==void 0&&e.call(r,s,this.#n[n],this)}}rforEach(e,r=this){for(let n of this.#C()){let o=this.#e[n],s=this.#o(o)?o.__staleWhileFetching:o;s!==void 0&&e.call(r,s,this.#n[n],this)}}purgeStale(){let e=!1;for(let r of this.#C({allowStale:!0}))this.#y(r)&&(this.delete(this.#n[r]),e=!0);return e}info(e){let r=this.#s.get(e);if(r===void 0)return;let n=this.#e[r],o=this.#o(n)?n.__staleWhileFetching:n;if(o===void 0)return;let s={value:o};if(this.#b&&this.#x){let a=this.#b[r],c=this.#x[r];if(a&&c){let u=a-(m1.now()-c);s.ttl=u,s.start=Date.now()}}return this.#_&&(s.size=this.#_[r]),s}dump(){let e=[];for(let r of this.#I({allowStale:!0})){let n=this.#n[r],o=this.#e[r],s=this.#o(o)?o.__staleWhileFetching:o;if(s===void 0||n===void 0)continue;let a={value:s};if(this.#b&&this.#x){a.ttl=this.#b[r];let c=m1.now()-this.#x[r];a.start=Math.floor(Date.now()-c)}this.#_&&(a.size=this.#_[r]),e.unshift([n,a])}return e}load(e){this.clear();for(let[r,n]of e){if(n.start){let o=Date.now()-n.start;n.start=m1.now()-o}this.set(r,n.value,n)}}set(e,r,n={}){if(r===void 0)return this.delete(e),this;let{ttl:o=this.ttl,start:s,noDisposeOnSet:a=this.noDisposeOnSet,sizeCalculation:c=this.sizeCalculation,status:u}=n,{noUpdateTTL:l=this.noUpdateTTL}=n,d=this.#O(e,r,n.size||0,c);if(this.maxEntrySize&&d>this.maxEntrySize)return u&&(u.set="miss",u.maxEntrySizeExceeded=!0),this.delete(e),this;let p=this.#a===0?void 0:this.#s.get(e);if(p===void 0)p=this.#a===0?this.#u:this.#v.length!==0?this.#v.pop():this.#a===this.#t?this.#A(!1):this.#a,this.#n[p]=e,this.#e[p]=r,this.#s.set(e,p),this.#p[this.#u]=p,this.#h[p]=this.#u,this.#u=p,this.#a++,this.#P(p,d,u),u&&(u.set="add"),l=!1;else{this.#k(p);let f=this.#e[p];if(r!==f){if(this.#E&&this.#o(f)){f.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:m}=f;m!==void 0&&!a&&(this.#S&&this.#d?.(m,e,"set"),this.#g&&this.#f?.push([m,e,"set"]))}else a||(this.#S&&this.#d?.(f,e,"set"),this.#g&&this.#f?.push([f,e,"set"]));if(this.#R(p),this.#P(p,d,u),this.#e[p]=r,u){u.set="replace";let m=f&&this.#o(f)?f.__staleWhileFetching:f;m!==void 0&&(u.oldValue=m)}}else u&&(u.set="update")}if(o!==0&&!this.#b&&this.#N(),this.#b&&(l||this.#L(p,o,s),u&&this.#T(u,p)),!a&&this.#g&&this.#f){let f=this.#f,m;for(;m=f?.shift();)this.#r?.(...m)}return this}pop(){try{for(;this.#a;){let e=this.#e[this.#l];if(this.#A(!0),this.#o(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#g&&this.#f){let e=this.#f,r;for(;r=e?.shift();)this.#r?.(...r)}}}#A(e){let r=this.#l,n=this.#n[r],o=this.#e[r];return this.#E&&this.#o(o)?o.__abortController.abort(new Error("evicted")):(this.#S||this.#g)&&(this.#S&&this.#d?.(o,n,"evict"),this.#g&&this.#f?.push([o,n,"evict"])),this.#R(r),e&&(this.#n[r]=void 0,this.#e[r]=void 0,this.#v.push(r)),this.#a===1?(this.#l=this.#u=0,this.#v.length=0):this.#l=this.#p[r],this.#s.delete(n),this.#a--,r}has(e,r={}){let{updateAgeOnHas:n=this.updateAgeOnHas,status:o}=r,s=this.#s.get(e);if(s!==void 0){let a=this.#e[s];if(this.#o(a)&&a.__staleWhileFetching===void 0)return!1;if(this.#y(s))o&&(o.has="stale",this.#T(o,s));else return n&&this.#w(s),o&&(o.has="hit",this.#T(o,s)),!0}else o&&(o.has="miss");return!1}peek(e,r={}){let{allowStale:n=this.allowStale}=r,o=this.#s.get(e);if(o===void 0||!n&&this.#y(o))return;let s=this.#e[o];return this.#o(s)?s.__staleWhileFetching:s}#D(e,r,n,o){let s=r===void 0?void 0:this.#e[r];if(this.#o(s))return s;let a=new KO,{signal:c}=n;c?.addEventListener("abort",()=>a.abort(c.reason),{signal:a.signal});let u={signal:a.signal,options:n,context:o},l=(g,v=!1)=>{let{aborted:y}=a.signal,_=n.ignoreFetchAbort&&g!==void 0;if(n.status&&(y&&!v?(n.status.fetchAborted=!0,n.status.fetchError=a.signal.reason,_&&(n.status.fetchAbortIgnored=!0)):n.status.fetchResolved=!0),y&&!_&&!v)return p(a.signal.reason);let x=m;return this.#e[r]===m&&(g===void 0?x.__staleWhileFetching?this.#e[r]=x.__staleWhileFetching:this.delete(e):(n.status&&(n.status.fetchUpdated=!0),this.set(e,g,u.options))),g},d=g=>(n.status&&(n.status.fetchRejected=!0,n.status.fetchError=g),p(g)),p=g=>{let{aborted:v}=a.signal,y=v&&n.allowStaleOnFetchAbort,_=y||n.allowStaleOnFetchRejection,x=_||n.noDeleteOnFetchRejection,S=m;if(this.#e[r]===m&&(!x||S.__staleWhileFetching===void 0?this.delete(e):y||(this.#e[r]=S.__staleWhileFetching)),_)return n.status&&S.__staleWhileFetching!==void 0&&(n.status.returnedStale=!0),S.__staleWhileFetching;if(S.__returned===S)throw g},f=(g,v)=>{let y=this.#c?.(e,s,u);y&&y instanceof Promise&&y.then(_=>g(_===void 0?void 0:_),v),a.signal.addEventListener("abort",()=>{(!n.ignoreFetchAbort||n.allowStaleOnFetchAbort)&&(g(void 0),n.allowStaleOnFetchAbort&&(g=_=>l(_,!0)))})};n.status&&(n.status.fetchDispatched=!0);let m=new Promise(f).then(l,d),h=Object.assign(m,{__abortController:a,__staleWhileFetching:s,__returned:void 0});return r===void 0?(this.set(e,h,{...u.options,status:void 0}),r=this.#s.get(e)):this.#e[r]=h,h}#o(e){if(!this.#E)return!1;let r=e;return!!r&&r instanceof Promise&&r.hasOwnProperty("__staleWhileFetching")&&r.__abortController instanceof KO}async fetch(e,r={}){let{allowStale:n=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,ttl:a=this.ttl,noDisposeOnSet:c=this.noDisposeOnSet,size:u=0,sizeCalculation:l=this.sizeCalculation,noUpdateTTL:d=this.noUpdateTTL,noDeleteOnFetchRejection:p=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:f=this.allowStaleOnFetchRejection,ignoreFetchAbort:m=this.ignoreFetchAbort,allowStaleOnFetchAbort:h=this.allowStaleOnFetchAbort,context:g,forceRefresh:v=!1,status:y,signal:_}=r;if(!this.#E)return y&&(y.fetch="get"),this.get(e,{allowStale:n,updateAgeOnGet:o,noDeleteOnStaleGet:s,status:y});let x={allowStale:n,updateAgeOnGet:o,noDeleteOnStaleGet:s,ttl:a,noDisposeOnSet:c,size:u,sizeCalculation:l,noUpdateTTL:d,noDeleteOnFetchRejection:p,allowStaleOnFetchRejection:f,allowStaleOnFetchAbort:h,ignoreFetchAbort:m,status:y,signal:_},S=this.#s.get(e);if(S===void 0){y&&(y.fetch="miss");let I=this.#D(e,S,x,g);return I.__returned=I}else{let I=this.#e[S];if(this.#o(I)){let M=n&&I.__staleWhileFetching!==void 0;return y&&(y.fetch="inflight",M&&(y.returnedStale=!0)),M?I.__staleWhileFetching:I.__returned=I}let E=this.#y(S);if(!v&&!E)return y&&(y.fetch="hit"),this.#k(S),o&&this.#w(S),y&&this.#T(y,S),I;let R=this.#D(e,S,x,g),V=R.__staleWhileFetching!==void 0&&n;return y&&(y.fetch=E?"stale":"refresh",V&&E&&(y.returnedStale=!0)),V?R.__staleWhileFetching:R.__returned=R}}get(e,r={}){let{allowStale:n=this.allowStale,updateAgeOnGet:o=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,status:a}=r,c=this.#s.get(e);if(c!==void 0){let u=this.#e[c],l=this.#o(u);return a&&this.#T(a,c),this.#y(c)?(a&&(a.get="stale"),l?(a&&n&&u.__staleWhileFetching!==void 0&&(a.returnedStale=!0),n?u.__staleWhileFetching:void 0):(s||this.delete(e),a&&n&&(a.returnedStale=!0),n?u:void 0)):(a&&(a.get="hit"),l?u.__staleWhileFetching:(this.#k(c),o&&this.#w(c),u))}else a&&(a.get="miss")}#F(e,r){this.#h[r]=e,this.#p[e]=r}#k(e){e!==this.#u&&(e===this.#l?this.#l=this.#p[e]:this.#F(this.#h[e],this.#p[e]),this.#F(this.#u,e),this.#u=e)}delete(e){let r=!1;if(this.#a!==0){let n=this.#s.get(e);if(n!==void 0)if(r=!0,this.#a===1)this.clear();else{this.#R(n);let o=this.#e[n];if(this.#o(o)?o.__abortController.abort(new Error("deleted")):(this.#S||this.#g)&&(this.#S&&this.#d?.(o,e,"delete"),this.#g&&this.#f?.push([o,e,"delete"])),this.#s.delete(e),this.#n[n]=void 0,this.#e[n]=void 0,n===this.#u)this.#u=this.#h[n];else if(n===this.#l)this.#l=this.#p[n];else{let s=this.#h[n];this.#p[s]=this.#p[n];let a=this.#p[n];this.#h[a]=this.#h[n]}this.#a--,this.#v.push(n)}}if(this.#g&&this.#f?.length){let n=this.#f,o;for(;o=n?.shift();)this.#r?.(...o)}return r}clear(){for(let e of this.#C({allowStale:!0})){let r=this.#e[e];if(this.#o(r))r.__abortController.abort(new Error("deleted"));else{let n=this.#n[e];this.#S&&this.#d?.(r,n,"delete"),this.#g&&this.#f?.push([r,n,"delete"])}}if(this.#s.clear(),this.#e.fill(void 0),this.#n.fill(void 0),this.#b&&this.#x&&(this.#b.fill(0),this.#x.fill(0)),this.#_&&this.#_.fill(0),this.#l=0,this.#u=0,this.#v.length=0,this.#m=0,this.#a=0,this.#g&&this.#f){let e=this.#f,r;for(;r=e?.shift();)this.#r?.(...r)}}};var g1=class extends dt{constructor(r,n,o,s){super();this.path=r;this.version=n;this.options=o;this.fileSystem=s;this._cache=new YO(this.options),this._delayer=typeof o.autoWriteDelay=="number"?this._register(new $h(o.autoWriteDelay)):void 0}dispose(){super.dispose(),this._delayer=void 0}async initialize(){if(!this.path)return;let r;try{r=await this.fileSystem.readFile(this.path)}catch{return}try{let n=new TextDecoder().decode(r),o=JSON.parse(n);o.version===this.version&&this._cache.load(o.data)}catch(n){console.error(`Failed to load LRU cache at ${this.path}`,n)}}async get(r){return this._cache.get(await this.toKey(r))}async set(r,n){this._cache.set(await this.toKey(r),n),this._delayer?.trigger(()=>this.save()).catch(o=>{if(!(o instanceof Hi))throw o})}async save(){if(!this.path)return;let r=JSON.stringify({version:this.version,data:this._cache.dump()});await this.fileSystem.writeFile(this.path,new TextEncoder().encode(r))}async toKey(r){let o=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(s)).map(u=>u.toString(16).padStart(2,"0")).join("")}};g1=w([b(3,hr)],g1);var v1=class extends dt{constructor(r,n,o,s,a,c,u){super();this._embeddingEndpoint=r;this._embeddingsComputer=c;this._logService=u;this._isDisposed=!1;this._embeddingsCache=new Ti(async()=>{let l=a.storageUri,d=l?Ye.joinPath(l,`${n}-${r.model}.json`):void 0,p=this._register(s.createInstance(g1,d,o,{max:5e3,autoWriteDelay:5e3}));return await p.initialize(),p})}dispose(){this._isDisposed=!0,super.dispose()}async computeEmbeddings(r,n){let o=await this._embeddingsCache.value;if(this._isDisposed)return[];let s=new Array(r.length),a=[];for(let[u,l]of r.entries()){let d=await o.get(l);d?s[u]=d:a.push({index:u,value:l})}if(a.length===0)return s;let c=await this.computeEmbeddingsWithRetry(a.map(u=>u.value),n);for(let u=0;u<a.length;u++){if(this._isDisposed)return[];let l=a[u],d=c.embeddings[u];if(typeof d>"u")throw new Error("Error computing embedding");s[l.index]=d,await o.set(l.value,d)}return s}async computeEmbeddingsWithRetry(r,n){let s=0,a;for(;s<3;)try{if(a=await this._embeddingsComputer.computeEmbeddings(this._embeddingEndpoint,r,{parallelism:2},n),!a)throw new Error("Failed to compute embeddings");return a}catch(c){if(s++,s===3)throw c;if(n.isCancellationRequested)throw new Error("Cancelled computing embeddings");this._logService.public.warn(`Error computing embeddings. Retrying in ${s} seconds. Error: ${c}`),await new Promise(u=>setTimeout(u,1e3*s))}throw new Error("Failed to compute embeddings")}};v1=w([b(3,K),b(4,jt),b(5,Go),b(6,oe)],v1);var m7e="1.0.9",h7e="workspaceEmbeddingsCache",g7e=500,Ug=ie("IWorkspaceChunkEmbeddingsIndex"),Zf=class extends dt{constructor(r,n,o,s,a,c,u){super();this._logService=n;this._configurationService=o;this._endpointProvider=s;this._experimentationService=a;this._workspaceIndex=c;this._workspaceService=u;this.shouldSearchTimeout=!0;this._chunksEndpointEmbeddingComputer=this._register(r.createInstance(my)),this._embeddingsComputer=new Ti(async()=>{let l=await this._endpointProvider.getEmbeddingsEndpoint(this.getEmbeddingsEndpoint());return this._register(r.createInstance(v1,l,h7e,m7e))}),this.tryPreInit()}static{this._MAX_EMBEDDINGS_COMPUTATION_TIME=1e4}static{this._MAX_CHUNK_LENGTH=2e3}get fileSystemFileCount(){return this._workspaceIndex.fileSystemFileCount}getEmbeddingsEndpoint(){switch(this._experimentationService.getTreatmentVariable("vscode","workspace.embeddingsEndpointFamily")){case"ada":return"ada";case"text3small":return"text3small";default:return"ada"}}initialize(){return this._initializePromise??=this._workspaceIndex.initialize(),this._initializePromise}async triggerIndexing(r){let n=await this.getChunksToSearch(r);if(r.isCancellationRequested)return;let o=await this._embeddingsComputer.value;if(r.isCancellationRequested)return;let s=await o.computeEmbeddings(n.map(a=>this.chunkToIndexString(a)),r);this._logService.internal.debug(`Indexed ${s.length} chunks`)}async searchAllChunks(r,n,o){if(this._chunksEndpointEmbeddingComputer.isAvailable()){let a=await this.searchAllChunksUsingEndpoint(r,n,o);if(a)return a;if(o.isCancellationRequested)return[]}let s=await this.getChunksToSearch(o);return o.isCancellationRequested?[]:this.rankChunks(r,s,n,o)}async searchAllChunksUsingEndpoint(r,n,o){return this._chunksEndpointEmbeddingComputer.searchChunks(r,n,o)}async rankChunks(r,n,o,s){if(!n.length)return[];let a=[r,...n.map(p=>this.chunkToIndexString(p))],c=await this.computeEmbeddings(a,s);if(s.isCancellationRequested)return[];if(c.length<1)throw new Error("Invalid response");let[u,...l]=c,d=l.map((p,f)=>[n[f],p]);return gH(u,d,o,this.getEmbeddingsEndpoint()==="text3small"?0:Kae)}async getChunksToSearch(r){let n=(await Promise.all(Array.from(this._workspaceIndex.values(),o=>o.getSemanticChunks(r)))).flat();return r.isCancellationRequested?[]:n.filter(o=>o.text.length<Zf._MAX_CHUNK_LENGTH)}async computeEmbeddings(r,n){let o=await this._embeddingsComputer.value;if(n.isCancellationRequested)return[];let s=this.shouldSearchTimeout?await NR(o.computeEmbeddings(r,n),Zf._MAX_EMBEDDINGS_COMPUTATION_TIME):await o.computeEmbeddings(r,n);if(n.isCancellationRequested)return[];if(!s)throw new Error("Timeout computing embeddings");return s}chunkToIndexString(r){let n=gS(this._workspaceService,r.file);return this.toStringForEmbeddingsComputer(r,n)}async tryPreInit(){if(!this._configurationService.getExperimentBasedConfig(de.WorkspacePreInitEmbeddings,this._experimentationService))return!1;let n=new la;try{await NR((async()=>{let s=new yo;if(this._logService.public.debug("Trying to preload workspace embeddings"),await this._workspaceIndex.preLoadWorkspaceFiles(g7e,n.token),n.token.isCancellationRequested){this._logService.public.debug("Preload indexing cancelled");return}this._logService.public.debug(`Preloaded ${this._workspaceIndex.fileSystemFileCount} files. Preload elapsed time: ${s.elapsed()}ms`),this._logService.public.debug(`Preloading trying to pre-compute embeddings for ${Array.from(this._workspaceIndex.values()).length} files`);let a=await this.getChunksToSearch(n.token);if(n.token.isCancellationRequested){this._logService.public.debug("Preload embedding compute cancelled");return}this._logService.public.debug(`Preloaded completed for ${a.length} chunks. Total preload time: ${s.elapsed()}ms`)})(),1e4,()=>(this._logService.public.debug("Preload timed out"),n.cancel()))}catch{}finally{n.dispose()}}toStringForEmbeddingsComputer(r,n){return`File: \`${n}\`
${Pi($4(r.file),r.text)}`}};Zf=w([b(0,K),b(1,oe),b(2,be),b(3,Se),b(4,wt),b(5,Oc),b(6,Ve)],Zf);var my=class extends dt{constructor(r,n,o,s,a,c,u,l,d){super();this._authService=o;this._configurationService=s;this._domainService=a;this._envService=c;this._fetcherService=u;this._telemetryService=l;this._workspaceIndex=d;let p=n.storageUri,f=p?Ye.joinPath(p,my.cacheFileName):void 0;this._cache=em.load(f,d,r).then(m=>this._register(m))}static{this.cacheFileName="workspace-chunks.json"}isAvailable(){return this._configurationService.getConfig(de.WorkspaceUseChunksEndpoint)}async searchChunks(r,n,o){let s=new kd(6),a;try{a=await Promise.all([s.queue(()=>this.computeChunksAndEmbeddings(Ye.parse("prompt:///query.txt"),r,o)),...Array.from(this._workspaceIndex.values(),l=>s.queue(()=>this.getChunksAndEmbeddings(l,o)))])}finally{s.dispose()}if(o.isCancellationRequested||a.length<=1)return;let c=a[0][0].embedding,u=a.slice(1).flat();return gH(c,u.map(l=>[l.chunk,l.embedding]),n,0)}async getChunksAndEmbeddings(r,n){let o=await this._cache,s=await o.get(r);if(n.isCancellationRequested)return[];if(s)return s;let a=await r.getText(n);if(n.isCancellationRequested)return[];let c=await this.computeChunksAndEmbeddings(r.uri,a,n);return o.update(r,c),c}async computeChunksAndEmbeddings(r,n,o){if(Yoe(n))return[];let s=(await this._authService.getPermissiveGitHubSession({createIfNone:!0}))?.accessToken;if(!s||o.isCancellationRequested)return[];try{let a=this._domainService.chunksURL,c=await Mg(this._fetcherService,this._envService,this._telemetryService,this._domainService,a,s,await Pl(process.env.HMAC_SECRET),"copilot-panel","",{content:n,path:r.fsPath,embed:!0},o);if(o.isCancellationRequested)return[];if(!c.ok)return console.log("Error chunking",r.toString(),c.status,c.statusText,await c.text()),[];let u=await c.json();if(o.isCancellationRequested||!u.chunks.length)return[];let l=f1.create(r.toString(),"",0,n);return u.chunks.map(d=>{let p=l.positionAt(d.range.start),f=l.positionAt(d.range.end),m=new Xe(p.line,p.character,f.line,f.character);return{chunk:{file:r,text:d.text,range:m,sources:[]},embedding:d.embedding?.embedding||[]}})}catch(a){console.log(a)}return[]}};my=w([b(0,hr),b(1,jt),b(2,Nt),b(3,be),b(4,Xr),b(5,St),b(6,nn),b(7,he),b(8,Oc)],my);var em=class extends dt{constructor(r,n,o){super();this.cachePath=r;this._workspaceIndex=n;this.fileSystem=o;this._cache=new tn;this._writeDelayer=this._register(new $h(5e3));let s=a=>this._cache.delete(a);this._register(this._workspaceIndex.onDidChangeFile(s)),this._register(this._workspaceIndex.onDidDeleteFile(s))}static{this.version="1.0.0"}static async load(r,n,o){let s=new em(r,n,o);if(r){await n.initialize();try{let a=await o.readFile(r),c=JSON.parse(new TextDecoder().decode(a));if(c.version===em.version)for(let[u,l]of Object.entries(c.entries)){let d=Ye.parse(u);n.get(d)&&s._cache.set(d,{hash:Promise.resolve(l.hash),entries:l.entries.map(p=>({embedding:p.embedding,chunk:{file:d,text:p.text,range:Xe.lift(p.range),sources:[]}}))})}}catch(a){console.error(a)}}return s}async get(r){let n=await this.getHash(r),o=this._cache.get(r.uri);if(!(!o||await o.hash!==n))return o.entries}update(r,n){this._cache.set(r.uri,{hash:this.getHash(r),entries:n}),this._writeDelayer.trigger(()=>this.save())}async getHash(r){let n=await r.getText(Lr.None);return await AS(n)}async save(){if(!this.cachePath)return;let r={};for(let[o,s]of this._cache)r[o.toString()]={hash:await s.hash,entries:s.entries.map(a=>({text:a.chunk.text,range:a.chunk.range.toJSON(),embedding:a.embedding}))};let n={version:em.version,entries:r};await this.fileSystem.writeFile(this.cachePath,new TextEncoder().encode(JSON.stringify(n)))}};em=w([b(1,Oc),b(2,hr)],em);var tm=class extends dt{constructor(r,n,o,s,a,c,u,l,d,p,f){super();this._logService=r;this._accessor=n;this._codeSearchClient=o;this._configurationService=s;this._embeddingsIndex=a;this._experimentationService=c;this._ignoreService=u;this._telemetryService=l;this._workspaceChunkIndex=d;this._workspaceService=p;this._gitService=f;this.id="codesearch";this.timeout=5e3}async searchFileChunks(r,n,o,s){if(s.isCancellationRequested)return{chunks:[]};if(await Yd(this._logService,"initialize",()=>this.initialized()),s.isCancellationRequested)return{chunks:[]};let a,c=!1;try{let l=await this.getSimilarFilesFromCodeSearch(r,n,s);if(a=l?.chunks,c=l?.couldBeOutdated??!1,s.isCancellationRequested)return{chunks:[]};this._telemetryService.sendMSFTTelemetryEvent("codeSearchChunkSearch.search.success",{},{chunkCount:a?.length??0})}catch(l){throw this._telemetryService.sendMSFTTelemetryEvent("codeSearchChunkSearch.search.error",{errorMessage:l instanceof Error?l.message:l.toString()}),l}if(!a||s.isCancellationRequested)return{chunks:[]};let u=await Yd(this._logService,"toSemanticChunks",()=>zO(this._accessor,a,s));return s.isCancellationRequested?{chunks:[]}:{chunks:o.include?u.filter(l=>rde(l.file,o.include)):u,couldBeOutdated:c}}async isAvailable(){let r;return r=this._configurationService.getConfig(de.WorkspaceCodeSearchEnabled),r===void 0&&(r=this._experimentationService.getTreatmentVariable("vscode","copilotchat.useCodeSearch")),!(r===!1||!this.getReposContext())}async getShouldUseRawChunks(){let r;return r=this._configurationService.getConfig(de.WorkspaceCodeSearchReturnRawChunks),r===void 0&&(r=this._experimentationService.getTreatmentVariable("vscode","copilotchat.codeSearchRawChunks")),r??!1}initialized(){return this._embeddingsIndex.initialize()}async getSimilarFilesFromCodeSearch(r,n,o){let s=this.getReposContext();if(!s)return;let{repos:a,repoToWorkspaceFolder:c}=s;if(!a.length)throw new Error("No repos to search through");let u=await this.getShouldUseRawChunks();if(o.isCancellationRequested)return;let l=await r.resolveQuery(o);if(!l||o.isCancellationRequested)return;let d=await this._codeSearchClient.search(l,{repo:a},{rawChunks:u,limit:n},o);if(o.isCancellationRequested)return;let p=await this.processResults(c,d,o);if(!(!p||o.isCancellationRequested))return{chunks:p.chunks.flat().sort((f,m)=>m.score-f.score),couldBeOutdated:p.couldBeOutdated}}getReposContext(){let r=this._workspaceService.getWorkspaceFolders(),n=this._accessor.safeGet(xo)?.repositories;if(!n)return;let o=[],s=new Map;for(let a=0;a<n.length;a++){let c=n[a];if(!c)continue;let u=ES(c)?.toLowerCase();u&&(o.push(u),s.set(u,r[a]))}if(o.length)return{repos:o,repoToWorkspaceFolder:s}}_isOutdatedResponse(r,n){return r.commitOID?this._gitService.getRepository(n)?.headCommitHash!==r.commitOID:!1}async processResults(r,n,o){let s=!1,a=[],c=n.errors.filter(u=>!(u instanceof jk));if(c.length){let u=!0;for(let l of r.keys()){let d=c.filter(p=>p.repo===l);if(d){this._logService.internal.debug(`[${l}] Errors when searching codesearch: ${d.map(zN)}`);continue}u=!1}if(u)throw c.length===1?c[0]:new AggregateError(c)}for(let u of n.results){let l=u.repoOwner.toLowerCase()+"/"+u.repoName.toLowerCase(),d=r.get(l);if(!d){this._logService.public.error("Could not find workspace folder for repo: "+l);continue}!s&&this._isOutdatedResponse(u,d)&&(s=!0);let p=this._workspaceChunkIndex.get(Ye.joinPath(d,u.path));if(p&&!await this._ignoreService.isCopilotIgnored(p.uri)){if(o.isCancellationRequested)return;a.push({file:p.uri,score:u.score,text:u.contents,sources:[],range:new Xe(u.range.start,0,u.range.end+1,0)})}}return{chunks:a,couldBeOutdated:s}}};w([oo(r=>r._logService,function(r,n){this._telemetryService.sendMSFTTelemetryEvent("codeSearchChunkSearch.perf.searchFileChunks",{status:n},{execTime:r})})],tm.prototype,"searchFileChunks",1),w([oo(r=>r._logService)],tm.prototype,"getSimilarFilesFromCodeSearch",1),tm=w([b(0,oe),b(1,st),b(2,jO),b(3,be),b(4,Ug),b(5,wt),b(6,ke),b(7,he),b(8,Oc),b(9,Ve),b(10,xo)],tm);var rm=class extends dt{constructor(r,n,o,s,a){super();this._logService=n;this._experimentationService=o;this._telemetryService=s;this._embeddingsIndex=a;this.id="ada";this.timeout=5e3;this._state=0;this._disposeCts=this._register(new la);r&&(this._embeddingsIndex.shouldSearchTimeout=!1)}static{this.defaultFileCap=200}async searchFileChunks(r,n,o,s){if(await this.initialize(),s.isCancellationRequested)return{chunks:[]};if(this._state!==1&&this._state!==2)return{chunks:[]};let a=await r.resolveQuery(s);return s.isCancellationRequested?{chunks:[]}:(this._logService.internal.debug("Fetching related workspace chunks in repository..."),{chunks:await this._embeddingsIndex.searchAllChunks(a,n,s)})}async isAvailable(){return await this.initialize(),this._state===1||this._state===2}async initialize(){this._init??=(async()=>{if(await this._embeddingsIndex.initialize(),this._disposeCts.token.isCancellationRequested)return;let r=this._experimentationService.getTreatmentVariable("vscode","workspace.embeddingsCacheFileCap")??rm.defaultFileCap;if(this._disposeCts.token.isCancellationRequested)return;if(this._embeddingsIndex.fileSystemFileCount>r){this._state=3;return}this._state=1,this.triggerIndexing()})(),await this._init}triggerIndexing(){this._indexingPromise??=(async()=>{this._logService.internal.debug("Starting indexing");try{await this._embeddingsIndex.triggerIndexing(this._disposeCts.token),this._state=2,this._logService.internal.debug("Workspace Chunk Embeddings Index initialized.")}catch(r){this._logService.internal.warn(`Failed to index workspace: ${r}`),this._indexingPromise=void 0}})()}};w([oo(r=>r._logService,function(r,n){this._telemetryService.sendMSFTTelemetryEvent("embeddingsChunkSearch.perf.searchFileChunks",{status:n},{execTime:r})})],rm.prototype,"searchFileChunks",1),rm=w([b(1,oe),b(2,wt),b(3,he),b(4,Ug)],rm);var yde=H(require("path"));var bde=require("worker_threads"),wG=class{constructor(e,r){this.handlers=new Map;this.nextId=1;this.worker=new bde.Worker(e,r),this.worker.on("message",({id:n,err:o,res:s})=>{let a=this.handlers.get(n);a&&(this.handlers.delete(n),o?a.reject(o):a.resolve(s))}),this.worker.on("error",n=>this.handleError(n)),this.worker.on("exit",n=>{n!==0&&this.handleError(new Error(`Worker thread exited with code ${n}.`))})}terminate(){this.worker.removeAllListeners(),this.worker.terminate(),this.handlers.clear()}handleError(e){for(let r of this.handlers.values())r.reject(e);this.handlers.clear()}remoteCall(e,r){let n=this.nextId++,o,s,a=new Promise((c,u)=>{o=c,s=u});return this.handlers.set(n,{resolve:o,reject:s}),this.worker.postMessage({id:n,fn:e,args:r}),a}},Bg=class{constructor(e,r){this.worker=new wG(e,r);let n={get:(o,s)=>(typeof s=="string"&&!o[s]&&(o[s]=(...a)=>{if(!this.worker)throw new Error("Worker was terminated!");return this.worker.remoteCall(s,a)}),o[s])};this.proxy=new Proxy(Object.create(null),n)}terminate(){this.worker.terminate()}};function zk(t,e){if(!t)return t;if(Array.isArray(t))return t.map(r=>zk(r,e));if(typeof t=="object"){let r=e(t);if(r)return r;let n={};for(let o in t)n[o]=zk(t[o],e);return n}return t}var v7e=yde.default.join(__dirname,"tfidfWorker.js"),qg=class extends dt{constructor(r,n,o){super();this._logService=r;this._telemetryService=n;this._workspaceIndex=o;this.id="tfidf";this.timeout=500;this._isDisposed=!1;this._tfIdfWorker=new Ti(()=>new Bg(v7e,{name:"TfIdf Worker"}));let s=a=>{let c=this._workspaceIndex.get(a);c&&this.addOrUpdateTfidfEntries([c])};this._register(this._workspaceIndex.onDidCreateFile(s)),this._register(this._workspaceIndex.onDidChangeFile(s)),this._register(this._workspaceIndex.onDidDeleteFile(a=>{this._isDisposed||this._tfIdfWorker.value.proxy.delete(a)}))}dispose(){this._isDisposed=!0,super.dispose(),this._tfIdfWorker.rawValue?.terminate()}initialize(){return this._initializePromise??=this._initializeWorkspaceFiles(),this._initializePromise}async searchFileChunks(r,n,o,s){if(await su(this.initialize(),s),s.isCancellationRequested||this._isDisposed)return{chunks:[]};let a=await r.resolveQueryAndKeywords(s);if(!a||s.isCancellationRequested||this._isDisposed)return{chunks:[]};let c=a.keywords.flatMap(l=>[l.keyword,...l.variations]),u=await Yd(this._logService,"search",()=>su(this._tfIdfWorker.value.proxy.search([c.length?c.join(", "):a.rephrasedQuery],{maxResults:n,include:o.include,maxSpread:.75}),s),(l,d)=>{this._telemetryService.sendMSFTTelemetryEvent("tfIdfChunkSearch.perf.tfidfSearch",{status:s.isCancellationRequested?"cancelled":d},{execTime:l})});return{chunks:y7e(u)}}async isAvailable(){return await this.initialize(),!0}async _initializeWorkspaceFiles(){await Yd(this._logService,"initialize workspaceIndex",()=>this._workspaceIndex.initialize()),!this._isDisposed&&await Yd(this._logService,"initialize tfidf",()=>this.addOrUpdateTfidfEntries(this._workspaceIndex.values()),(r,n)=>{this._telemetryService.sendMSFTTelemetryEvent("tfidfChunkSearch.perf.initializeTfidf",{status:n},{execTime:r,fileSystemFileCount:this._workspaceIndex.fileSystemFileCount})})}async addOrUpdateTfidfEntries(r){if(this._isDisposed)return;let n=new kd(20),o;try{o=await Promise.all(Array.from(r,s=>n.queue(async()=>({uri:s.uri,content:await s.getText(Lr.None)}))))}finally{n.dispose()}this._isDisposed||this._tfIdfWorker.value.proxy.addOrUpdate(b7e(o))}};w([oo(r=>r._logService)],qg.prototype,"initialize",1),w([oo(r=>r._logService,function(r,n){this._telemetryService.sendMSFTTelemetryEvent("tfIdfChunkSearch.perf.searchFileChunks",{status:n},{execTime:r})})],qg.prototype,"searchFileChunks",1),qg=w([b(0,oe),b(1,he),b(2,Oc)],qg);function b7e(t){return zk(t,e=>{if(Ye.isUri(e))return{$mid:"uri",...e};if(e instanceof Xe)return{startLineNumber:e.startLineNumber,startColumn:e.startColumn,endLineNumber:e.endLineNumber,endColumn:e.endColumn}})}function y7e(t){return zk(t,e=>{if(e.$mid==="range")return new Xe(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn);if(e.$mid==="uri")return Ye.revive(e)})}var hy=class extends dt{constructor(r,n,o,s){super();this._logService=r;this.instantiationService=n;this._telemetryService=o;this._experimentationService=s;this.id="tfidf";this.timeout=500;this._tfidf=this._register(n.createInstance(qg))}async _shouldUseRangedChunks(){return await this._experimentationService.getTreatmentVariableAsync("vscode","copilotchat.hasRangedSemanticChunksForTFIDF")??!1}async searchFileChunks(r,n,o,s){this._logService.internal.debug("Performing full workspace search for chunks...");let c=(await this._tfidf.searchFileChunks(r,n*2,o,s)).chunks;if(s.isCancellationRequested||!c.length)return{chunks:[]};let u=await this._shouldUseRangedChunks(),l=await Yd(this._logService,"toSemanticChunks",()=>this.instantiationService.invokeFunction(d=>zO(d,c,s,u)));return s.isCancellationRequested||!l.length?{chunks:[]}:{chunks:l}}isAvailable(){return this._tfidf.isAvailable()}};w([oo(r=>r._logService,function(r,n){this._telemetryService.sendMSFTTelemetryEvent("tfIdfWithSemanticChunkSearch.perf.searchFileChunks",{status:n},{execTime:r})})],hy.prototype,"_shouldUseRangedChunks",1),hy=w([b(0,oe),b(1,K),b(2,he),b(3,wt)],hy);var jg=ie("IWorkspaceChunkSearch"),nm=class{constructor(e,r,n,o,s,a){this._forcedChunkSearchStrategy=e;this._logService=n;this._telemetryService=o;this._workspaceChunkEmbeddingsIndex=s;this._accessor=a;this._simulationTestContext=this._accessor.get(Qf),this._embeddingsCacheChunkSearch=r.createInstance(rm,this._simulationTestContext.isInSimulationTests),this._codeSearchChunkSearch=r.createInstance(tm),this._tfIdfWithSemanticChunkSearch=r.createInstance(hy)}dispose(){this._embeddingsCacheChunkSearch.dispose(),this._codeSearchChunkSearch.dispose(),this._tfIdfWithSemanticChunkSearch.dispose()}async triggerIndexing(){await Promise.allSettled([this._tfIdfWithSemanticChunkSearch.isAvailable(),this._embeddingsCacheChunkSearch.isAvailable()])}isUpToDateCodesearchResult(e){return e.strategy==="codesearch"&&e.chunks.length>0&&e.couldBeOutdated===!1}async shouldUseOnlyCodeSearchWhenUpToDate(){return this._accessor.get(wt).getTreatmentVariable("vscode","copilotchat.useOnlyCodeSearchWhenUpToDate")??!1}async searchFileChunks(e,r,n,o,s,a){let c=new yo,u=await this.getStrategies();if(s.isCancellationRequested)return[];let l=await this.shouldUseOnlyCodeSearchWhenUpToDate();l&&this._logService.internal.debug("Using only CodeSearch results when local HEAD matches CodeSearch snippet commit hash");let d=u.map(I=>_j(async E=>{let R=await I.searchFileChunks(r,n,o,E);return{chunks:R.chunks.map(B=>({...B,strategy:I.id})),strategy:I.id,couldBeOutdated:R.couldBeOutdated}}));s.onCancellationRequested(()=>d.forEach(I=>I.cancel()));for(let I of d)I.then(E=>{for(let R=0;R<d.length;R++)E.strategy==="ada"||l&&this.isUpToDateCodesearchResult(E)?d[R].cancel():NR(d[R].catch(()=>{}),u[R].timeout,()=>{d[R].cancel(),this._logService.internal.warn(`WorkspaceChunkSearch strategy ${u[R].id} timed out`)})},()=>{});let p=await su(Promise.allSettled(d),s);if(s.isCancellationRequested||!p)return[];let f=[],m;for(let I=0;I<p.length;I++){let E=p[I],R=u[I];if(E.status==="fulfilled"){(!m||E.value.strategy==="ada"||this.isUpToDateCodesearchResult(E.value))&&(m=E.value.strategy),f.push(E.value);continue}if(this._logService.public.debug(`Strategy, ${R.id}, failed with the following error: ${zN(E.reason)}`),E.status==="rejected"&&E.reason instanceof qk&&R instanceof tm)try{if(this._accessor.get(Nt).permissiveGitHubSession)continue;if(await this._accessor.get(Nt).getPermissiveGitHubSession({forceNewSession:{detail:RG.t("To show you more relevant Copilot Chat results, we need permission to read the contents of your repository on GitHub."),learnMore:Ye.parse("https://aka.ms/copilotRepoScope")}})){let V=await R.searchFileChunks(r,n,o,s);m=R.id,f.unshift({chunks:V.chunks.map(M=>({...M,strategy:R.id,couldBeOutdated:V.couldBeOutdated})),strategy:R.id})}}catch{}}this._logService.internal.debug(`'${m}' was the top working workspace chunk search strategy`),this._accessor.get(he).sendMSFTTelemetryEvent("workspaceChunkSearchStrategy",{strategy:m??"none",allAttemptedStrategies:u.map(I=>I.id).join(","),allSuccessfulStrategies:p.filter(I=>I.status==="fulfilled").map(I=>I.value.strategy).join(",")},{execTime:c.elapsed()});let g=this._accessor.get(ke),v=await Promise.all(f.map(async I=>({...I,chunks:Nr(await Promise.all(I.chunks.map(async E=>await g.isCopilotIgnored(E.file)?null:E)))})));if(this._simulationTestContext.isInSimulationTests&&!v.some(I=>I.chunks.length>0))throw new Error("No chunks returned");function y(I){return JSON.stringify(I.map(E=>({strategy:E.strategy,text:E.text})),null,2)}let _=async(I,E)=>{this._simulationTestContext.isInSimulationTests&&await this._accessor.get(Qf).writeFile(I+".txt",y(E),I)},x=v.flatMap(I=>I.chunks);_("workspace-chunk-search-pre-rerank",x);let S=o.skipRerank?v.flatMap(I=>I.chunks).slice(0,n):await this.rerankChunks(e,r,v.flat(),n,s,a,l);return _("workspace-chunk-search-post-rerank",S),S}async rerankChunks(e,r,n,o,s,a,c=!1){let u=n.find(l=>l.strategy==="ada");if(u)return u.chunks.slice(0,o);if(c){let l=n.find(d=>this.isUpToDateCodesearchResult(d));if(l)return l.chunks.slice(0,o)}return a?.(RG.t("Filtering to most relevant information")),this._accessor.get(be).getConfig(de.WorkspaceRerankStrategy)==="model"?this.sortChunksUsingModel(e,r,n.flatMap(l=>l.chunks),o,s):this.rerankChunksUsingAda(r,n,o,s)}async rerankChunksUsingAda(e,r,n,o){try{let s=await e.resolveQuery(o);if(!s||o.isCancellationRequested)return[];let a=r.flatMap(d=>d.chunks.map(p=>({...p,strategy:d.strategy}))).map((d,p)=>({...d,index:p})),c=await this._workspaceChunkEmbeddingsIndex.rankChunks(s,a,n,o),u=this._accessor.get(he),l=c.filter(d=>d.index<n).length;return u.sendMSFTTelemetryEvent("workspaceChunkSearch.adaRerank",{allStrategies:r.filter(d=>d.chunks.length).map(d=>d.strategy).join(","),topChunkInitialIndices:c.map(d=>d.index).join(","),topChunkStrategies:c.map(d=>d.strategy).join(",")},{originalChunkCount:a.length,maxResultCount:n,originalTopInTopAfterRerank:l/n}),c}catch(s){return this._logService.public.error(s,"Failed to search chunk embeddings index"),r.flatMap(a=>a.chunks).slice(0,n)}}async sortChunksUsingModel(e,r,n,o,s){let a=await r.resolveQueryAndKeywords(s);if(!a||s.isCancellationRequested)return[];let c=this._accessor.get(Ct),u=[];for(let l=0;l<n.length;l+=o){let d=n.slice(l,l+o),p=[...u,...d];_oe(p);let f=await c.fetchOne("sortChunksUsingModel",[{role:"system",content:`
The user will provide you with question and a numbered list of code snippets.
You are to sort the code snippets by most to least helpful in answering the question.
If a code snippet is not related to the question in possible any way, you may opt not to include it in the list.
Return an ordered list of snippet numbers.
Only return snippet numbers.
Do not explain.
				`.trim()},{role:"user",content:`
Question: ${a.rephrasedQuery}

${p.map((h,g)=>`# Snippet ${g}
 ${Pi("",h.text)}`).join(`

`)}
					`.trim()}],async h=>{},s,2,e,{agent:qf},{temperature:.1,top_p:1,stop:["dontStopBelieving"]},{messageSource:"workspaceChunkRerank"});if(s.isCancellationRequested)return[];if(f.type!=="success"){console.warn("Model re-rank failed");continue}let m=new Set(Array.from(f.value.matchAll(/\d+/g),h=>parseInt(h[0])));u=Nr(Array.from(m).map(h=>p.at(h))).slice(0,o)}return u}async getStrategies(){let e=new Array;switch(this._forcedChunkSearchStrategy){case"codesearch":e.push(this._codeSearchChunkSearch);break;case"ada":e.push(this._embeddingsCacheChunkSearch);break;case"tfidf":e.push(this._tfIdfWithSemanticChunkSearch);break;default:await this._codeSearchChunkSearch.isAvailable()&&e.push(this._codeSearchChunkSearch),await this._embeddingsCacheChunkSearch.isAvailable()&&e.push(this._embeddingsCacheChunkSearch),e.push(this._tfIdfWithSemanticChunkSearch);break}return this._logService.internal.debug(`Using ${e.map(r=>r.id).join(", ")} for chunk search`),e}};w([oo(e=>e._logService,function(e,r){this._accessor.get(he).sendMSFTTelemetryEvent("workspaceChunkSearch.perf.triggerIndexing",{status:r},{execTime:e})})],nm.prototype,"triggerIndexing",1),w([oo(e=>e._logService,function(e,r){this._telemetryService.sendMSFTTelemetryEvent("workspaceChunkSearch.perf.searchFileChunks",{status:r},{execTime:e})})],nm.prototype,"searchFileChunks",1),w([oo(e=>e._logService),Bk(function(e,r){this._accessor.get(he).sendMSFTTelemetryEvent("workspaceChunkSearch.perf.adaRerank",{status:r},{execTime:e})})],nm.prototype,"rerankChunksUsingAda",1),nm=w([b(1,K),b(2,oe),b(3,he),b(4,Ug),b(5,st)],nm);var QO=H(nt());function _de(t){return t.reduce((r,n)=>r+n.value.length,0)+Math.max(0,t.length-1)}async function x7e(t,e=1/0,r){let n=xde(0,t,e),o=e-_de(n);for(;;){let s=!1,a=[];for(let c of n)if(c.type==="text")a.push(c);else if(c.type==="dir"){a.push({type:"text",value:c.value});let u=await c.getChildren();if(r?.isCancellationRequested)return"";let l=xde(c.level+1,u,o-1);l.length&&(s=!0,o-=_de(l)+1,a.push(...l))}if(n=a,!s)break}return n.map(s=>s.value).join(`
`)}function xde(t,e,r){let n="	".repeat(t),o=[],s=r;for(let a=0;a<e.length;++a){let c=e[a],u=n+c.name+(c.type===2?"/":"");if(u.length>s){let l=n+"...";for(;l.length>s&&o.length>0;)s+=o.pop().value.length+1;l.length<=s&&o.push({type:"text",value:l});break}c.type===2?o.push({type:"dir",level:t,value:u,getChildren:c.getChildren}):o.push({type:"text",value:u}),s-=u.length,a!==e.length-1&&(s-=1)}return o}async function Sde(t,e,r,n){let o=t.get(hr),s=t.get(ke);async function a(u){let l;try{l=await o.readDirectory(u)}catch(d){return console.error(d),[]}return n?.isCancellationRequested?[]:(l.sort((d,p)=>d[0].localeCompare(p[0])),Promise.all(l.map(async d=>{let p=Ye.joinPath(u,d[0]);return await fy(t,p)?d:null})).then(d=>d.filter(p=>p!==null).map(p=>p[1]===2?{type:2,name:p[0],getChildren:()=>a(Ye.joinPath(u,p[0]))}:{type:1,name:p[0]})))}if(await s.init(),n?.isCancellationRequested)return"";let c=await a(e);return n?.isCancellationRequested?"":x7e(c,r,n)}var Jd=class extends X{constructor(r,n,o){super(r);this.accessor=n;this.workspaceService=o}async prepare(r,n,o){let s=this.workspaceService.getWorkspaceFolders().at(0);if(s)return Sde(this.accessor,s,this.props.maxSize,o)}render(r,n){if(r)return vscpp(vscppf,null,"I am working in a workspace that has the following structure:",vscpp("br",null),vscpp("br",null),Pi("",r))}};Jd=w([b(1,st),b(2,Ve)],Jd);var kG=class extends X{render(e,r){return vscpp(vscppf,null,this.props.history&&vscpp(Ot,{priority:500,history:this.props.history}),vscpp(QO.SystemMessage,{priority:1e3},"You are a coding assistant who help the user answer questions about code in their workspace by providing a list of relevant keywords they can search for to answer the question.",vscpp("br",null),"The user will provide you with potentially relevant information from the workspace. This information may be incomplete.",vscpp("br",null),"Respond in Markdown. First under a `# Question` header, output a rephrased version of the user's question that resolves all pronouns and ambiguous words like 'this' to the specific nouns they stand for.",vscpp("br",null),"Then under a `# Keywords` header, output a short markdown list of up to 8 relevant keywords that the user can search for to answer the question. You may include variations after each keyword.",vscpp("br",null),"DO NOT ask the user for additional information or clarification.",vscpp("br",null),"DO NOT answer the user's question directly.",vscpp("br",null),vscpp("br",null),"# Additional Rules",vscpp("br",null),vscpp("br",null),"Think step by step:",vscpp("br",null),"1. Read the user's question to understand what they are asking about their workspace.",vscpp("br",null),"2. If the question contains pronouns such as 'it' or 'that', try to understand what the pronoun refers to by looking at the rest of the question and the conversation history.",vscpp("br",null),"3. If the question contains an ambiguous word such as 'this', try to understand what is refers to by looking at the rest of the question, the user's active selection, and the conversation history.",vscpp("br",null),"4. After a `# Question` header, output a precise version of question that resolves all pronouns and ambiguous words like 'this' to the specific nouns they stand for. Be sure to preserve the exact meaning of the question by only changing ambiguous pronouns and words like 'this'.",vscpp("br",null),"5. Then after a `# Keywords` header, output a short markdown list of up to 8 relevant keywords that user could try searching for to answer their question. These keywords could used as file name, symbol names, abbreviations, or comments in the relevant code. Put the keywords most relevant to the question first. Do not include overly generic keywords. Do not repeat keywords.",vscpp("br",null),"6. For each keyword in the markdown list of related keywords, if applicable add a comma separated list of variations after it. For example: for 'encode' possible variations include 'encoding', 'encoded', 'encoder', 'encoders'. Consider synonyms and plural forms. Do not repeat variations.",vscpp("br",null),vscpp("br",null),"Examples",vscpp("br",null),vscpp("br",null),"User: Where's the code for base64 encoding?",vscpp("br",null),vscpp("br",null),"Assistant:",vscpp("br",null),"# Question",vscpp("br",null),"Where's the code for base64 encoding?",vscpp("br",null),vscpp("br",null),"# Keywords",vscpp("br",null),"- base64 encoding, base64 encoder, base64 encode",vscpp("br",null),"- base64, base 64",vscpp("br",null),"- encode, encoded, encoder, encoders"),vscpp(zr,{flexGrow:1,priority:600,document:this.props.document,range:this.props.selection}),vscpp(QO.UserMessage,{priority:700},vscpp(Jd,{maxSize:1e3})),vscpp(Jr,{flexGrow:2,priority:1e3,chatVariables:this.props.chatVariables,query:this.props.query}))}};async function Ide(t,{query:e,history:r,chatVariables:n},o){let s=t.get(zt).activeTextEditor;return Be.create(t.get(K),o,kG,{chatVariables:n,query:e,history:r,document:s?.document,selection:s?.selection}).render()}var S7e=/^[\*\-]\s*(.+)/m;function Cde(t,e){let r=e.match(/#+\s*Question\n(?<question>.+?)#+\s*Keywords\n(?<keywords>.+)/si);if(!r?.groups)return{rephrasedQuestion:t.trim(),keywords:[]};let n=[];for(let o of r.groups.keywords.trim().split(`
`)){let s=o.match(S7e);if(s){let a=s[1].split(/,/g).map(c=>c.trim());a.length&&n.unshift({keyword:a[0],variations:a.slice(1)})}}return{rephrasedQuestion:r.groups.question.trim(),keywords:n}}var im=class extends X{constructor(r,n,o,s,a,c){super(r);this.accessor=n;this.logService=o;this.telemetryService=s;this.workspaceChunkSearch=a;this.workspaceService=c}async prepare(r,n,o=Lr.None){let s=await Uk(this.accessor,{valueFor4096:4,maxMultiplier:4});if(o.isCancellationRequested)return;let a=(await this.workspaceChunkSearch.searchFileChunks(r.endpoint,this.props.query,this.props.maxResults??s,{include:this.props.include},o,l=>n?.report(new ui(l)))).slice(0,s);if(o.isCancellationRequested||!a.length)return;let c=new tn;for(let l of a){let d=c.get(l.file)??[];l.isFullFile?d=[l]:d.some(p=>p.isFullFile||p.range.containsRange(l.range))||(d=[...d.filter(p=>!l.range.containsRange(p.range)),l]),c.set(l.file,d)}let u=Array.from(c.values()).flatMap(l=>l.sort((d,p)=>Xe.compareRangesUsingStarts(d.range,p.range)).map(d=>new Ms.PromptReference(d.isFullFile?d.file:new Ri(d.file,c1(d.range)))));return{chunks:a,references:u}}render(r,n){if(r)return vscpp(vscppf,null,vscpp("references",{value:r.references}),r.chunks.map((o,s)=>{let a=typeof this.props.priority<"u"?this.props.priority+(1-(s+1)/r.chunks.length):void 0;return{chunk:o,priority:a}}).reverse().map(({chunk:o,priority:s})=>{let a=gS(this.workspaceService,o.file);return vscpp(JO.TextChunk,{priority:s},"Here is a potentially relevant code excerpt ",o.isFullFile?`starting at line ${o.range.startLineNumber} `:"","in `",a,"`:",vscpp("br",null),Pi($4(o.file),o.text))}))}};w([oo(r=>r.logService),Bk(function(r,n){this.telemetryService.sendMSFTTelemetryEvent("workspaceContext.perf.prepareWorkspaceChunks",{status:n},{execTime:r})})],im.prototype,"prepare",1),im=w([b(1,st),b(2,oe),b(3,he),b(4,jg),b(5,Ve)],im);var Hg=class extends X{constructor(r,n,o,s,a,c){super(r);this.accessor=n;this.logService=o;this.chatFetcher=s;this.telemetryService=a;this.tokenizerProvider=c}async prepare(r,n,o){let s=this.props,a=s.promptContext.query;if(!a)return;n?.report(new ui(XO.t("Deciding which workspace information to collect")));let c=(async()=>{this.logService.internal.debug("[Workspace Resolver] Asking the model to update the user question and provide queries...");let{messages:u}=await Ide(this.accessor,this.props.promptContext,r.endpoint);if(o.isCancellationRequested)return;let l=this.tokenizerProvider.acquireTokenizer(r.endpoint).tokenLength(a),p=await this.chatFetcher.fetchOne("workspaceContext",u,async h=>{},o,2,r.endpoint,{agent:qf},{temperature:0,top_p:1,stop:["dontStopBelieving"],max_tokens:l+200},{messageSource:"workspaceIntent"});if(o.isCancellationRequested)return;let f;if(p.type!=="success")if(this.telemetryService.sendMSFTTelemetryEvent("workspaceResolver.error",{type:p.type,reason:p.reason,requestId:p.requestId}),p.type==="length")f=p.truncatedValue;else throw new Error(XO.t("Encountered an error while deciding what workspace information to collect: ({0}) {1}",p.type,p.reason));else f=p.value;let m=Cde(a,f);return this.telemetryService.sendMSFTTelemetryEvent("workspaceResolver.success",{type:p.type,requestId:p.requestId},{totalKeywordCount:m.keywords.flatMap(h=>[h.keyword,h.variations]).length}),this.logService.internal.debug("[Workspace Resolver] Running all tools..."),n?.report(new ui(XO.t("Collecting workspace information"))),{rephrasedQuery:m.rephrasedQuestion,keywords:m.keywords}})();return new class{constructor(){this.rawQuery=a}resolveQueryAndKeywords(u){return su(c,u)}async resolveQuery(u){return this.maySkipResolve()?a:(await this.resolveQueryAndKeywords(u))?.rephrasedQuery??a}maySkipResolve(){return s.promptContext.chatVariables.hasVariables()?!1:!/\b(it|that|this)\b/i.test(a)}}}render(r,n){if(!r)return;let o=this.props.include??{workspaceStructure:!0,workspaceChunks:!0};return vscpp(vscppf,null,o.workspaceStructure&&vscpp(Jd,{maxSize:500,...this.props}),o.workspaceChunks&&vscpp(im,{priority:this.props.priority,query:r}))}};w([Bk(function(r,n){this.telemetryService.sendMSFTTelemetryEvent("workspaceContext.perf.prepare",{status:n},{execTime:r})})],Hg.prototype,"prepare",1),Hg=w([b(1,st),b(2,oe),b(3,Ct),b(4,he),b(5,yr)],Hg);var b1=class extends X{render(e,r){return vscpp(JO.UserMessage,null,vscpp(Hg,{...this.props}))}};var ZO=class extends X{render(e,r){let{query:n,history:o,chatVariables:s}=this.props.promptContext;return vscpp(vscppf,null,vscpp(e3.SystemMessage,{priority:1e3},"You are a software engineer with expert knowledge of the codebase the user has open in their workspace.",vscpp("br",null),vscpp("br",null),vscpp(Br,null),vscpp(Rt,null),vscpp(Vi,null),vscpp(Xt,null),"# Additional Rules",vscpp("br",null),"Think step by step:",vscpp("br",null),"1. Read the provided relevant workspace information (code excerpts, file names, and symbols) to understand the user's workspace.",vscpp("br",null),"2. Consider how to answer the user's prompt based on the provided information and your specialized coding knowledge. Always assume that the user is asking about the code in their workspace instead of asking a general programming question. Prefer using variables, functions, types, and classes from the workspace over those from the standard library.",vscpp("br",null),"3. Generate a response that clearly and accurately answers the user's question. In your response, add fully qualified links for referenced symbols (example: [`namespace.VariableName`](path/to/file.ts)) and links for files (example: [path/to/file](path/to/file.ts)) so that the user can open them. If you do not have enough information to answer the question, respond with \"I'm sorry, I can't answer that question with what I currently know about your workspace\".",vscpp("br",null),vscpp("br",null),"DO NOT mention that you cannot read files in the workspace.",vscpp("br",null),"DO NOT ask the user to provide additional information about files in the workspace.",vscpp("br",null),"Remember that you MUST add links for all referenced symbols from the workspace and fully qualify the symbol name in the link, for example: [`namespace.functionName`](path/to/util.ts).",vscpp("br",null),"Remember that you MUST add links for all workspace files, for example: [path/to/file.js](path/to/file.js)",vscpp("br",null),vscpp("br",null),"# Examples",vscpp("br",null),"Question:",vscpp("br",null),"What file implements base64 encoding?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),"Base64 encoding is implemented in [src/base64.ts](src/base64.ts) as [`encode`](src/base64.ts) function.",vscpp("br",null),vscpp("br",null),vscpp("br",null),"Question:",vscpp("br",null),"How can I join strings with newlines?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),"You can use the [`joinLines`](src/utils/string.ts) function from [src/utils/string.ts](src/utils/string.ts) to join multiple strings with newlines.",vscpp("br",null),vscpp("br",null),vscpp("br",null),"Question:",vscpp("br",null),"How do I build this project?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),"To build this TypeScript project, run the `build` script in the [package.json](package.json) file:",vscpp("br",null),vscpp("br",null),"```sh",vscpp("br",null),"npm run build",vscpp("br",null),"```",vscpp("br",null),vscpp("br",null),vscpp("br",null),"Question:",vscpp("br",null),"How do I read a file?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),"To read a file, you can use a [`FileReader`](src/fs/fileReader.ts) class from [src/fs/fileReader.ts](src/fs/fileReader.ts).",vscpp("br",null)),vscpp(Ot,{flexGrow:1,priority:400,history:o}),vscpp(zr,{flexGrow:1,document:this.props.document,range:this.props.selection,priority:600}),vscpp(e3.UserMessage,{flexGrow:1},vscpp(Hg,{priority:800,...this.props})),vscpp(pr,{priority:899,...this.props,flexGrow:2}),vscpp(Jr,{flexGrow:2,priority:900,chatVariables:s,query:n}))}};var Wk="workspace",$k=class extends Ho{constructor(r,n,o,s,a){super(r,n,o);this.instantiationService=s;this.tabsAndEditorsService=a}createRenderer(r,n,o,s){let a=this.tabsAndEditorsService.activeTextEditor;return Be.create(this.instantiationService,n,ZO,{promptContext:r,document:a?.document,selection:a?.selection,endpoint:n})}};$k=w([b(3,K),b(4,zt)],$k);var Vg=class{constructor(e,r){this.instantiationService=e;this.endpointProvider=r;this.id=Vg.ID;this.description=Tde.t("Ask a question about the files in your current workspace");this.locations=[2];this.commandInfo={allowsEmptyArgs:!1,defaultEnablement:!0}}static{this.ID=Wk}get intentDetectionInput(){let e="workspace_questions";return{functionName:e,sampleQuestion:"How do I build this project?",functionCallingBlurb:`If the user's message is about files in the current project, repository, or workspace, you should use the '${e}' function.`}}async invoke(e){let r=e.location,n="gpt-3.5-turbo";r===2&&(n="gpt-4");let o=await this.endpointProvider.getChatEndpoint(n);return this.instantiationService.createInstance($k,this,r,o)}};Vg=w([b(0,K),b(1,Se)],Vg);var js=H(require("vscode"));var y1={location:"sameFolder",prefix:"test_",suffixes:[".test",".spec","_test","Test","_spec","_test","Tests",".Tests","Spec"]},_1={csharp:{suffixes:["Test"],location:"testFolder"},dart:{suffixes:["_test"],location:"testFolder"},go:{suffixes:["_test"],location:"sameFolder"},java:{suffixes:["Test"],location:"testFolder"},javascript:{suffixes:[".test",".spec"],location:"sameFolder"},javascriptreact:{suffixes:[".test",".spec"],location:"sameFolder"},kotlin:{suffixes:["Test"],location:"testFolder"},php:{suffixes:["Test"],location:"testFolder"},powershell:{suffixes:[".Tests"],location:"testFolder"},python:{prefix:"test_",suffixes:["_test"],location:"testFolder"},ruby:{suffixes:["_test","_spec"],location:"testFolder"},rust:{suffixes:[""],location:"testFolder"},swift:{suffixes:["Tests"],location:"testFolder"},typescript:{suffixes:[".test",".spec"],location:"sameFolder"},typescriptreact:{suffixes:[".test",".spec"],location:"sameFolder"}},I7e={cs:"csharp",dart:"dart",go:"go",java:"java",js:"javascriptreact",kt:"kotlin",php:"php",ps1:"powershell",py:"python",rb:"ruby",rs:"rust",swift:"swift",ts:"typescript",tsx:"typescriptreact"},C7e=function(){let t={};for(let[e,r]of Object.entries(I7e))t[e]=_1[r];return t}(),Zd=class{constructor(e,r){this._search=e;this._tabs=r}_findTabMatchingPattern(e){return this._tabs.tabs.find(n=>n.uri&&n.uri.scheme!==xn.untitled&&qO(n.uri,e))?.uri}async findTestFileForSourceFile(e,r){if(e.isUntitled)return;let n=ou(e.uri),o=Rc(e.uri),s=_1[e.languageId]??y1,a=[];if(s.prefix&&a.push(s.prefix+n),s.suffixes)for(let l of s.suffixes??[]){let d=n.replace(`${o}`,`${l}${o}`);a.push(d)}let c=a.length===1?`**/${a[0]}`:`**/{${a.join(",")}}`,u=this._findTabMatchingPattern(c);return u||(e.languageId==="python"?u=await this._search.findFilesWithExcludes(c,"**/*.pyc",1,r):u=await this._search.findFilesWithDefaultExcludes(c,1,r)),u}async findAnyTestFileForSourceFile(e,r){let n=_1[e.languageId]??y1,o=[];if(n.prefix&&o.push(`${n.prefix}*`),n.suffixes){let c=Rc(e.uri);for(let u of n.suffixes??[])o.push(`*${u}${c}`)}let s=o.length===1?`**/${o[0]}`:`**/{${o.join(",")}}`,a=this._findTabMatchingPattern(s);return a||(e.languageId==="python"?a=await this._search.findFilesWithExcludes(s,"**/*.pyc",1,r):a=await this._search.findFilesWithDefaultExcludes(s,1,r)),a}async findFileForTestFile(e,r){let n=_1[e.languageId]??y1,o=ou(e.uri),s=[];n.suffixes&&s.splice(0,0,...n.suffixes),n.prefix&&s.splice(0,0,n.prefix);for(let a of s){let c=o.replace(a,"");if(c!==o){let u=`**/${c}`,l=this._findTabMatchingPattern(u);if(l||(l=await this._search.findFilesWithDefaultExcludes(u,1,r)),l)return l}}}};Zd=w([b(0,Fd),b(1,zt)],Zd);function Gg(t){let e;Ye.isUri(t)||(e=_1[t.languageId],t=t.uri);let r=ou(t),n=Rc(t);if(e??=C7e[n.replace(".","")],e){if(e.suffixes&&e.suffixes.some(s=>r.endsWith(s+n))||e.prefix&&r.startsWith(e.prefix))return!0}else if(y1.suffixes.some(s=>r.endsWith(s+n))||r.startsWith(y1.prefix))return!0;return!1}function T7e(t){let e=_1[t.languageId]??y1,r=ou(t.uri);if(e.prefix)return e.prefix+r;let n=Rc(t.uri),o=e.suffixes&&e.suffixes.length>0?e.suffixes[0]:".test";return r.replace(`${n}`,`${o}${n}`)}function E7e(t){let e=cse(t.uri,"..");if(t.languageId==="java"){let r=e.path;if(r.includes("/src/main/")){let n=r.replace("/src/main/","/src/test/");return e.with({path:n})}}return e}function t3(t){let e=T7e(t),r=E7e(t);return Ye.joinPath(r,e).with({scheme:xn.untitled})}var x1=ie("ITestGenInfoStorage"),r3=class{constructor(){this.sourceFileToTest=void 0}};var S1=class{constructor(e,r,n,o){this.instaService=e;this.parserService=r;this.testGenInfoStorage=n;this.ignoreService=o}async runCommand(e){let r,n;if(e)r=e.document,n=e.selection;else{let o=js.window.activeTextEditor;if(o===void 0)return;r=o.document,n=o.selection}if(Gg(r.uri))return js.commands.executeCommand("vscode.editorChat.start",{message:"/tests ",autoSend:!0,initialRange:n});{let o=await this.identifyTestableNode(r,n);this.updateTestGenInfo(r,o,n);let s=await this.findOrCreateTestFile(r),a=await js.workspace.openTextDocument(s),c=await this.determineTestInsertPosition(a),u=await js.window.showTextDocument(a,2);return u.selection=new js.Selection(c.start,c.end),u.revealRange(c,js.TextEditorRevealType.InCenter),c.end.line===0&&c.end.character===0||await u.edit(d=>{d.insert(c.start,`

`)}),js.commands.executeCommand("vscode.editorChat.start",{message:"/tests",autoSend:!0})}}async determineTestInsertPosition(e){let r=this.parserService.getTreeSitterAST(e),n=r?await r.findLastTest():null,o;if(n===null){let s=e.lineAt(e.lineCount-1);o=new js.Range(s.range.end,s.range.end)}else{let s=e.positionAt(n.endIndex),a=e.lineAt(s).range.end;o=new js.Range(a,a)}return o}updateTestGenInfo(e,r,n){this.testGenInfoStorage.sourceFileToTest={uri:e.uri,target:r?.range??n,identifier:r?.identifier}}async identifyTestableNode(e,r){let n=this.parserService.getTreeSitterAST(e);if(!n)return null;let o=await n.getTestableNode({startIndex:e.offsetAt(r.start),endIndex:e.offsetAt(r.end)});if(!o)return null;let{startIndex:s,endIndex:a}=o.node,c=new js.Range(e.positionAt(s),e.positionAt(a));return{identifier:o.identifier.name,range:c}}async findOrCreateTestFile(e){let n=await this.instaService.createInstance(Zd).findTestFileForSourceFile(e,Lr.None);return n!==void 0&&await this.ignoreService.isCopilotIgnored(n)&&(n=void 0),n===void 0&&(n=t3(e)),n}};S1=w([b(0,K),b(1,_t),b(2,x1),b(3,ke)],S1);var l3=H(Gt()),NG=H(require("path"));var w7e="vscode-notebook-cell";function rr(t){return t.scheme===w7e||t.scheme==="untitled"&&t.fragment.startsWith("notebook-chat-input")}var wde=H(nt());var Ede=H(nt());var sn=class extends X{constructor(r,n,o,s){super(r);this.accessor=n;this.ignoreService=o;this.tokenizerProvider=s}async prepare(r){let n=this.tokenizerProvider.acquireTokenizer(r.endpoint),o=[];for(let u of this.props.input)await this.ignoreService.isCopilotIgnored(u.document.uri)||o.push(u);let s=o.map(u=>{let{document:l,change:d,selection:p}=u,f;if(d?.hunks.length){let m=d.hunks[0];f=[m.range.start.line>0?sn.enumeratedLines(l,0,m.range.start.line):"",...d.hunks.map((h,g,v)=>{let y=g+1<v.length?v[g+1].range.start.line:l.lineCount;return[sn.enumeratedChangeLines(h.text,h.range.start.line),`
`,h.range.end.line<y?sn.enumeratedLines(l,h.range.end.line,y):""]}).flat()].join("")}else if(p){let m=p.end.line+(p.end.character>0?1:0);f=sn.enumeratedSelectedLines(l,0,l.lineCount,p.start.line,m)}else f=sn.enumeratedLines(l,0,l.lineCount);return{input:u,hunks:[{range:new Qe(0,0,u.document.lineCount,0),text:f}],tokens:n.tokenLength(f)}}),a=s.reduce((u,{tokens:l})=>u+l,0);if(this.props.logService.internal.info(`[CurrentChange] Full documents: ${a} tokens, ${r.tokenBudget} budget`),a<=r.tokenBudget)return{input:s.map(({input:u,hunks:l})=>({input:u,hunks:l}))};let c=s.slice().sort((u,l)=>l.tokens-u.tokens);for(let u of c){let{input:l,tokens:d}=u,{document:p,change:f,selection:m}=l;if(f?.hunks.length){let h=[],g=0;for(let v of f.hunks){let y=await hs.getDefinitionAtRange(this.accessor,p,v.range,!1);if(y){let _=y.range.end.line+(y.range.end.character>0?1:0),x=v.range.end.line+(v.range.end.character>0?1:0),S=[v.range.start.line>y.range.start.line?sn.enumeratedLines(p,y.range.start.line,v.range.start.line):"",sn.enumeratedChangeLines(v.text,v.range.start.line),`
`,_>x?sn.enumeratedLines(p,x,_):""].join("");h.push({range:new Qe(Math.min(v.range.start.line,y.range.start.line),0,Math.max(_,x),0),text:S}),g+=n.tokenLength(S)}else{let _=sn.enumeratedChangeLines(v.text,v.range.start.line),x=v.range.end.line+(v.range.end.character>0?1:0);h.push({range:new Qe(v.range.start.line,0,x,0),text:_}),g+=n.tokenLength(_)}}u.hunks=h,u.tokens=g,a+=u.tokens-d}else if(m){let h=await hs.getDefinitionAtRange(this.accessor,p,m,!1);if(h){let g=h.range.end.line+(h.range.end.character>0?1:0),v=m.end.line+(m.end.character>0?1:0),y=sn.enumeratedSelectedLines(p,h.range.start.line,g,m.start.line,v),_=n.tokenLength(y);u.hunks=[{range:h.range,text:y}],u.tokens=_,a+=u.tokens-d}else{let g=m.end.line+(m.end.character>0?1:0),v=sn.enumeratedSelectedLines(p,m.start.line,g,m.start.line,g);u.hunks=[{range:new Qe(m.start.line,0,g,0),text:v}],u.tokens=n.tokenLength(v),a+=u.tokens-d}}else u.hunks=[],u.tokens=0,a+=u.tokens-d;if(this.props.logService.internal.info(`[CurrentChange] Reduced ${l.relativeDocumentPath} to defintions: ${a} tokens, ${r.tokenBudget} budget`),a<=r.tokenBudget)return{input:s.map(({input:h,hunks:g})=>({input:h,hunks:g}))}}if(this.props.logService.public.info(`[CurrentChange] Still too large: ${a} tokens, ${r.tokenBudget} budget, ${s.length} inputs`),s.length>1){let u=new Error("Split prompt.");throw u.code="split_input",u}return{input:s.map(({input:u,hunks:l})=>({input:u,hunks:l}))}}render(r,n){let o=r.input.filter(a=>a.hunks.length>0);if(!o.length)return;let s=o.map(({input:a,hunks:c})=>({uri:a.document.uri,version:a.document.version,ranges:c.map(u=>u.range)}));return vscpp(vscppf,null,vscpp("usedContext",{value:s}),vscpp(Ede.UserMessage,{priority:this.props.priority},o.map(a=>vscpp(vscppf,null,a.input.change?vscpp(vscppf,null,"Change at cursor:",vscpp("br",null),vscpp("br",null),"Each line is annotated with the line number in the file.",vscpp("br",null)):vscpp(vscppf,null,"Current selection with the selected lines labeled as such:",vscpp("br",null)),vscpp("br",null),"From the file: ",a.input.relativeDocumentPath,vscpp("br",null),a.hunks.map(c=>vscpp(ay,{uri:a.input.document.uri,range:c.range,code:c.text,languageId:`${a.input.document.languageId}/${a.input.relativeDocumentPath}: FROM_LINE: ${c.range.start.line+1} - TO_LINE: ${c.range.end.line}`})),vscpp("br",null),vscpp("br",null)))))}static async getCurrentChanges(r,n){let o=r.getExtensionApi();return o?(await Promise.all(o.repositories.map(async a=>{let c=await(n==="index"?a.diffIndexWithHEAD():a.diffWithHEAD());return await Promise.all(c.map(async l=>{let d=await(n==="index"?a.diffIndexWithHEAD(l.uri.fsPath):a.diffWithHEAD(l.uri.fsPath));return{repository:a,uri:l.uri,hunks:sn.parseDiff(d).map(p=>sn.gitHunkToHunk(p))}}))}))).flat():[]}static async getCurrentChange(r,n,o){let a=r.get(_o).getExtensionApi();if(!a)return;let c=a.getRepository(n.uri);if(!c)return;let u=await c.diffWithHEAD(n.uri.fsPath);if(!u)return;let d=sn.parseDiff(u).find(p=>p.additions.some(f=>{let m=f.start-1,h=m+f.length-1;return o.line>=m&&o.line<=h}));if(d)return{repository:c,uri:n.uri,hunks:[sn.gitHunkToHunk(d)]}}static async getChanges(r,n,o,s){let c=r.get(_o).getExtensionApi();if(!c)return;let u=sn.parseDiff(s),l=c.repositories.find(d=>d.rootUri.toString().toLowerCase()===n.toString().toLowerCase());if(l)return{repository:l,uri:o,hunks:u.map(d=>sn.gitHunkToHunk(d))}}static gitHunkToHunk(r){return{range:new Qe(r.startAddedLine-1,0,r.startAddedLine-1+r.addedLines,0),text:r.diffText}}static parseDiff(r){let n=r.split(`
@@`);return n.length&&n[n.length-1].endsWith(`
`)&&(n[n.length-1]=n[n.length-1].slice(0,-1)),n.map(s=>{let a=s.match(/-(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))?/);if(a){let c=parseInt(a[1]),u=a[2]?parseInt(a[2]):1,l=parseInt(a[3]),d=a[4]?parseInt(a[4]):1,p=[],f=s.split(`
`).slice(1),m=0,h;for(let g of f){let v=g.charAt(0);v==="+"?(h===void 0&&(h=l+m),m++):(h!==void 0&&(p.push({start:h,length:l+m-h}),h=void 0),v===" "&&m++)}return h!==void 0&&(p.push({start:h,length:l+m-h}),h=void 0),c===0&&(c=1),l===0&&(l=1),{startDeletedLine:c,deletedLines:u,startAddedLine:l,addedLines:d,additions:p,diffText:f.join(`
`)}}return null}).filter(Boolean)}static enumeratedLines(r,n,o){return r.getText(new Qe(n,0,o,0)).split(`
`).map((u,l)=>l===o-n?u:`/* Line ${n+l+1} */${u}`).join(`
`)}static enumeratedSelectedLines(r,n,o,s,a){return r.getText(new Qe(n,0,o,0)).split(`
`).map((d,p)=>{if(p===o-n)return d;let f=n+p;return`/* ${s<=f&&f<a?"Selected ":""}Line ${f+1} */${d}`}).join(`
`)}static enumeratedChangeLines(r,n){let o=0;return r.split(`
`).filter(a=>a[0]!=="-").map((a,c)=>{let u=a[0],l=u==="-";return l&&o++,`/* ${l?"Removed Line":`${u==="+"?"Changed ":""}Line ${n+c-o+1}`} */${a.substring(1)}`}).join(`
`)}};sn=w([b(1,st),b(2,ke),b(3,yr)],sn);var I1=class extends X{render(e,r){return vscpp(vscppf,null,vscpp(wde.SystemMessage,{priority:1001},"You are a world-class software engineer and the author and maintainer of the discussed code. Your feedback prefectly combines detailed feedback and explanation of context.",vscpp("br",null),vscpp(Br,null),vscpp(Rt,null),vscpp(Vi,null),vscpp(Xt,null),vscpp("br",null),"Additional Rules",vscpp("br",null),"Think step by step:",vscpp("br",null),"1. Examine the provided code and any other context like user question, related errors, project details, class definitions, etc.",vscpp("br",null),"2. Provide feedback on the current ",this.props.input[0]?.change?vscpp(vscppf,null,"change"):vscpp(vscppf,null,"selection")," on where it can be improved or introduces a problem.",vscpp("br",null),"2a. Focus on naming conventions, readability, style and local logical correctness.",vscpp("br",null),"2b. Avoid commenting on correct code.",vscpp("br",null),"2c. Avoid commenting on commented out code.",vscpp("br",null),"2d. Keep scoping rules in mind.",vscpp("br",null),"3. Reply with an enumerated list of feedback with source line number, filepath, kind (bug, performance, consistency, documentation, naming, readability, style, other), severity (low, medium, high), and feedback text.",vscpp("br",null),"3a. E.g.: 1. Line 357 in src/flow.js, bug, high severity: `i` is not incremented.",vscpp("br",null),"3b. E.g.: 2. Line 361 in src/arrays.js, documentation, low severity: Function `binarySearch` is not documented.",vscpp("br",null),"3c. E.g.: 3. Line 176 in src/vs/platform/actionWidget/browser/actionWidget.ts, consistency, medium severity: The color id `'background.actionBar'` is not consistent with the other color ids used. Use `'actionBar.background'` instead.",vscpp("br",null),"3d. E.g.: 4. Line 410 in src/search.js, documentation, medium severity: Returning `-1` when the target is not found is a common convention, but it should be documented.",vscpp("br",null),"3e. E.g.: 5. Line 51 in src/account.py, bug, high severity: The deposit method is not thread-safe. You should use a lock to ensure that the balance update is an atomic operation.",vscpp("br",null),"3f. E.g.: 6. Line 220 in src/account.py, readability, low severity: The withdraw method is very long and combines multipe logical steps, consider splitting it into multiple methods.",vscpp("br",null),"4. Try to sort the feedback by file and line number.",vscpp("br",null),'5. When there is no feedback to provide, reply with "No feedback to provide."',vscpp("br",null),vscpp("br",null),"Focus on being clear, helpful, and thorough.",vscpp("br",null),"Use developer-friendly terms and analogies in your explanations.",vscpp("br",null),"Provide clear and relevant examples when helpful."),vscpp(Vo,{flexGrow:1,priority:700}),vscpp(sn,{input:this.props.input,logService:this.props.logService,priority:1e3,flexGrow:2}),this.props.input.map(n=>vscpp(yu,{document:n.document,range:n.selection,priority:800})),this.props.chatVariables&&this.props.query&&vscpp(Jr,{flexGrow:3,priority:900,chatVariables:this.props.chatVariables,query:this.props.query}))}};var n3=class{constructor(e,r){this.originalText=e;this._combinedEditsSinceStart=on.empty;this._text=r.apply(this.originalText),this._textAfterTrackedEdits=this._text,this._originalEdits=r}handleEdits(e){let r=e.apply(this._text),n=this._combinedEditsSinceStart.compose(e);n=n.removeCommonSuffixPrefix(this._textAfterTrackedEdits),this._combinedEditsSinceStart=n,this._text=r}computeTrackedEditsSurvivalScore(){let e=0,r=0,n=0,o=0,s=this._originalEdits.getNewTextRanges(),a=R7e(s,this._combinedEditsSinceStart);for(let c=0;c<s.length;c++){let u=this._originalEdits.edits[c],l=this.originalText.substring(u.replaceRange.start,u.replaceRange.endExclusive),d=u.newText,p=a[c],f=this._text.substring(p.start,p.endExclusive),m=Kk(f,d),h=Kk(d,l),g=Kk(f,l);if(h!==1){let _=1-Math.max(g-h,0)/(1-h);n+=u.replaceRange.length*_,o+=u.replaceRange.length}let v=u.newText.length*m,y=u.newText.length;e+=v,r+=y}return{fourGram:r===0?1:e/r,noRevert:o===0?1:n/o}}};function Kk(t,e){if(t.length<4||e.length<4)return t===e?1:0;let n=new Map;for(let c=0;c<=t.length-4;c++){let u=t.substring(c,c+4),l=n.get(u)||0;n.set(u,l+1)}for(let c=0;c<=e.length-4;c++){let u=e.substring(c,c+4),l=n.get(u)||0;n.set(u,l-1)}let o=t.length-4+1+e.length-4+1,s=0;for(let c of n.values())s+=Math.abs(c);return(o-s)/o}function R7e(t,e){t=t.slice();let r=[],n=0;for(let o of e.edits){for(;;){let a=t[0];if(!a||a.endExclusive>=o.replaceRange.start)break;t.shift(),r.push(a.delta(n))}let s=[];for(;;){let a=t[0];if(!a||!a.intersectsOrTouches(o.replaceRange))break;t.shift(),s.push(a)}for(let a=s.length-1;a>=0;a--){let c=s[a],u=c.intersect(o.replaceRange).length;c=c.deltaEnd(-u+(a===0?o.newText.length:0));let l=c.start-o.replaceRange.start;l>0&&(c=c.delta(-l)),a!==0&&(c=c.delta(o.newText.length)),c=c.delta(-(o.newText.length-o.replaceRange.length)),t.unshift(c)}n+=o.newText.length-o.replaceRange.length}for(;;){let o=t[0];if(!o)break;t.shift(),r.push(o.delta(n))}return r}var ep=class{constructor(e,r,n,o,s,a,c,u){this._document=e;this._originalDocumentText=r;this._edits=n;this._sendTelemetryEvent=s;this._gitService=c;this._telemetryService=u;this._editSurvivalTracker=new n3(this._originalDocumentText,this._edits);this._store=new ht;this._store.add(a.onDidChangeTextDocument(l=>{if(l.document!==this._document)return;let d=on.from(l.contentChanges);this._editSurvivalTracker.handleEdits(d)})),this._editSurvivalTracker.handleEdits(o),this._initialBranchName=this._getCurrentBranchName(),this._reportAfter(30*1e3),this._reportAfter(120*1e3),this._reportAfter(300*1e3),this._reportAfter(600*1e3,()=>{this._store.dispose()})}_getCurrentBranchName(){return this._gitService.getRepository(this._document.uri)?.headBranchName}_reportAfter(e,r){let n=new fL(()=>{this._report(e),n.dispose(),r&&r()},e);this._store.add(n)}_report(e){let r=this._editSurvivalTracker.computeTrackedEditsSurvivalScore(),o=this._getCurrentBranchName()!==this._initialBranchName;this._sendTelemetryEvent({telemetryService:this._telemetryService,fourGram:r.fourGram,noRevert:r.noRevert,timeDelayMs:e,didBranchChange:o})}};ep=w([b(5,Ve),b(6,xo),b(7,he)],ep);function i3(t,e){return r=>{r.telemetryService.sendMSFTTelemetryEvent("inline.trackEditSurvival",t,{...e,survivalRateFourGram:r.fourGram,survivalRateNoRevert:r.noRevert,timeDelayMs:r.timeDelayMs,didBranchChange:r.didBranchChange?1:0})}}function C1(t,e){return{headerRequestId:t.headers.get("x-request-id")||"",completionId:e&&e.id?e.id:"",created:e&&e.created?e.created:0,serverExperiments:t.headers.get("X-Copilot-Experiment")||"",deploymentId:t.headers.get("azureml-model-deployment")||""}}function Rde(t){let e=t.headers.get("openai-processing-ms");return e?parseInt(e,10):0}function kde(t){if(typeof t!="object"||t===null||!("details"in t))return!1;let{details:e}=t;return typeof e=="object"&&e!==null&&"type"in e&&"description"in e&&typeof e.type=="string"&&typeof e.description=="string"}function Pde(t){if(typeof t!="object"||t===null||!("citations"in t))return!1;let{citations:e}=t;return typeof e=="object"&&e!==null&&"url"in e&&"license"in e&&typeof e.url=="string"&&typeof e.license=="string"}function Ade(t){return typeof t=="object"&&!!t&&"title"in t&&"excerpt"in t&&"url"in t}function T1(){let t=_r(),e=Jn.createAndMarkAsIssued({messageId:t});return new PG(e)}var PG=class t{constructor(e){this.raw=e}get properties(){return this.raw.properties}get measurements(){return this.raw.measurements}markAsDisplayed(){this.raw.markAsDisplayed()}extendedBy(e,r){let n=this.raw.extendedBy(e,r);return new t(n)}};function o3(t,e,r,n,o,s,a){let c=t.turns[t.turns.length-1].contextParts.map(d=>d.kind).sort(),u={source:"user",turnIndex:(t.turns.length-1).toString(),conversationId:e,uiKind:r,inputSources:c.join(",")},l={promptTokenLen:o,messageCharLen:n.length};return s&&(u.suggestion=s),a=a.extendedBy(u,l),a}function s3(t,e,r,n,o,s,a){o!==void 0&&(a=a.extendedBy({offTopic:o.toString()})),a=a.extendedBy({headerRequestId:r}),AG(t,s,e,n,{},{},a)}function a3(t,e,r,n,o,s,a,c){let u=DG(o);AG(t,a,n,o,{source:"model",turnIndex:e.turns.length.toString(),conversationId:r,headerRequestId:s,uiKind:n,codeBlockLanguages:JSON.stringify({...u})},{messageCharLen:o.length,numCodeBlocks:u.length},c)}function c3(t,e,r,n,o,s,a,c){AG(t,a,n,o,{source:"offTopic",turnIndex:e.turns.length.toString(),conversationId:r,userMessageId:s,uiKind:n},{messageCharLen:o.length},c)}function AG(t,e,r,n,o,s,a){let c={...n?{messageText:n}:{},...o};e&&(o.languageId=e.languageId,s.documentLength=e.getText().length);let u=a.extendedBy(o,s),l=a.extendedBy(c),d=k7e(r);return t.sendGHTelemetryEvent(`${d}.message`,u.raw.properties,u.raw.measurements),t.sendRestrictedGHTelemetryEvent(`${d}.messageText`,l.raw.properties,l.raw.measurements),u.raw}function u3(t,e,r,n,o){return om(t,o,{suggestion:e,messageId:r,suggestionId:n},{},"conversation.suggestionShown")}function om(t,e,r,n,o,s){let a=s??Jn.createAndMarkAsIssued();e&&(r.languageId=e.languageId,n.documentLength=e.getText().length);let c=a.extendedBy(r,n);return t.sendGHTelemetryEvent(o,c.properties,c.measurements),c}function k7e(t){switch(t){case"conversationInline":return"inlineConversation";case"conversationPanel":default:return"conversation"}}function DG(t){let e=t.split(`
`),r=[],n;for(let o=0;o<e.length;o++){let s=e[o];if(n)new RegExp(`^\\s*${n.delimiter}\\s*$`).test(s)&&(r.push(n.languageId),n=void 0);else{let a=s.match(/^(\s*)(`{3,}|~{3,})(\w*)/);a&&(n={delimiter:a[2],languageId:a[3]})}}return r}var E1=class{constructor(e){this.telemetryService=e.get(he),this.options=e.get(Rr),this.endpointProvider=e.get(Se),this.fetcher=e.get(Ct),this.logService=e.get(oe),this.instantiationService=e.get(K),this.ignoreService=e.get(ke)}async generateComments(e,r,n){let o=Date.now(),s=this.ignoreService,a=await Promise.all(e.map(_=>s.isCopilotIgnored(_.document.uri))),c=e.filter((_,x)=>!a[x]);if(c.length===0)return this.logService.public.info("All input documents are ignored. Skipping feedback generation."),{type:"error",severity:"info",reason:l3.t("All input documents are ignored by configuration. Check your .copilotignore file.")};let u=await this.endpointProvider.getChatEndpoint("gpt-4"),l=[],d=[c];for(;d.length;){let _=d.shift();try{let S=await Be.create(this.instantiationService,u,I1,{input:_,logService:this.logService}).render();this.logService.internal.debug(`[FeedbackGenerator] Rendered batch of ${_.length} inputs.`),l.push(S)}catch(x){if(x.code==="split_input"){let S=Math.floor(_.length/2);d.unshift(_.slice(0,S),_.slice(S)),this.logService.internal.debug(`[FeedbackGenerator] Splitting in batches of ${d[0].length} and ${d[1].length} inputs due to token limit.`)}else throw x}}if(r.isCancellationRequested)return{type:"cancelled"};let p=c[0]?.selection?"selection":"change";if(l.length>10)return{type:"error",reason:p==="selection"?l3.t("There is too much text to review, try reviewing a smaller selection."):l3.t("There are too many changes to review, try reviewing a smaller set of changes.")};let m={promptCount:l.length,messageId:_r(),inputType:p,inputRanges:c.map(_=>({uri:_.document.uri,ranges:_.selection?[_.selection]:_.change?.hunks.map(x=>x.range)||[]}))},h=Date.now(),g=await Promise.all(l.map(async _=>{let x=[],S=n?async R=>{let B=Yk(m,c,R,!0);B.length>x.length&&(n.report(B.slice(x.length)),x=B)}:void 0,I=await this.fetcher.fetchOne("feedbackGenerator",_.messages,S,r,3,u,void 0,{temperature:this.options.temperature,top_p:this.options.topP},{messageId:m.messageId,messageSource:"command.generateFeedbackPrompt"}),E=I.type==="success"?Yk(m,c,I.value,!1):[];return n&&E&&E.length>x.length&&(n.report(E.slice(x.length)),x=E),{fetchResult:I,comments:E}})),v=g.find(_=>_.fetchResult.type!=="success")?.fetchResult||g[0].fetchResult,y=g.map(_=>_.comments).flat();return this.telemetryService.sendMSFTTelemetryEvent("feedback.generateDiagnostics",{model:u.model,requestId:v.requestId,responseType:v.type,messageId:m.messageId,documentType:c[0]&&rr(c[0]?.document.uri)?"notebook":"text",languageId:c[0]?.document.languageId,inputType:m.inputType,commentTypes:[...new Set(y?.map(_=>Nde.has(_.kind)?_.kind:"unknown")).values()].sort().join(",")||void 0},{promptCount:l.length,numberOfDiagnostics:y?.length??-1,inputDocumentCount:m.inputRanges.length,inputLineCount:m.inputRanges.reduce((_,x)=>_+x.ranges.reduce((S,I)=>S+(I.end.line-I.start.line),0),0),timeToRequest:h-o,timeToComplete:Date.now()-o}),r.isCancellationRequested?{type:"cancelled"}:v.type==="success"?{type:"success",comments:y||[]}:{type:"error",reason:v.reason}}},Nde=new Set(["bug","performance","consistency","documentation","naming","readability","style","other"]),P7e=new Set(["bug","performance","consistency","naming","readability","style"]);function Yk(t,e,r,n=!1){let o=[];for(let s of LG(r,n)){let{relativeDocumentPath:a,from:c,to:u,kind:l,severity:d,content:p}=s;if(!P7e.has(l))continue;let f=a&&e.find(S=>S.relativeDocumentPath===a);if(!f)continue;let m=f.document,h=f.selection?[f.selection]:f.change?.hunks.map(S=>S.range),g=m.lineAt(c>=0?c:0),v=m.lineAt((u<=m.lineCount?u:m.lineCount)-1),y=v.text.trimEnd().length,_=new Qe(g.lineNumber,g.firstNonWhitespaceCharacterIndex,v.lineNumber,y);if(h&&!h.some(S=>S.intersection(_)))continue;let x={request:t,document:m,uri:m.uri,languageId:m.languageId,range:_,body:new us(p),kind:l,severity:d,originalIndex:o.length,actionCount:0};o.push(x)}return o}function LG(t,e=!1){let r=/(?<num>\d+)\. Line (?<from>\d+)(-(?<to>\d+))?([^:]*)( in `?(?<relativeDocumentPath>[^,:`]+))`?(, (?<kind>\w+))?(, (?<severity>\w+) severity)?: (?<content>.+?)((?=\n\d+\.|\n\n)|(?<earlyEnd>$))/gs;return Nr(Array.from(t.matchAll(r),n=>{let o=n.groups;if(e&&typeof o.earlyEnd=="string")return;let s=parseInt(o.from)-1,a=o.to?parseInt(o.to):s+1,c=o.relativeDocumentPath?.replaceAll(NG.default.sep==="/"?"\\":"/",NG.default.sep),u=o.kind||"other",l=o.severity||"unknown",d=o.content.trim();if(d.endsWith("```")){let p=d.lastIndexOf("```",d.length-4);p!==-1&&(d=d.substring(0,p).trim())}return{relativeDocumentPath:c,from:s,to:a,linkOffset:n.index+o.num.length+2,linkLength:5+o.from.length+(o.to?o.to.length+1:0),kind:u,severity:l,content:d}}))}function zg(t,e,r,n,o,s){n.public.debug("[FeedbackGenerator] user feedback received");let a=Array.isArray(t)?t:[t],c=a[0];if(!c){n.public.warn("[FeedbackGenerator] No review comment found for user feedback");return}let u={messageId:c.request.messageId,userAction:r},l=Nde.has(c.kind)?c.kind:"unknown",d={requestId:c.request.messageId,documentType:rr(c.uri)?"notebook":"text",languageId:c.languageId,inputType:c.request.inputType,commentType:l,userAction:r},p={commentIndex:c.originalIndex,actionCount:c.actionCount,inputDocumentCount:c.request.inputRanges.length,inputLineCount:c.request.inputRanges.reduce((f,m)=>f+m.ranges.reduce((h,g)=>h+(g.end.line-g.start.line),0),0),promptCount:c.request.promptCount,totalComments:e,comments:a.length,commentLength:a.reduce((f,m)=>f+(typeof m.body=="string"?m.body.length:m.body.value.length),0)};if(r==="helpful"||r==="unhelpful"?(o.sendMSFTTelemetryEvent("review.comment.vote",d,p),o.sendInternalMSFTTelemetryEvent("review.comment.vote",d),om(o,void 0,u,{},"review.comment.vote")):(c.actionCount++,o.sendMSFTTelemetryEvent("review.comment.action",d,p),o.sendInternalMSFTTelemetryEvent("review.comment.action",d),om(o,void 0,u,{},"review.comment.action")),r==="discardComment"){let{document:f,range:m}=c,h=f.offsetAt(m.start),g=f.offsetAt(m.end),v=f.getText(m);s.createInstance(ep,f,f.getText(),on.single(Qt.ofStartAndLength(h,g-h),v),on.empty,A7e(d,p))}}function A7e(t,e){return r=>{r.telemetryService.sendMSFTTelemetryEvent("review.discardCommentRangeSurvival",t,{...e,survivalRateFourGram:r.fourGram,survivalRateNoRevert:r.noRevert,timeDelayMs:r.timeDelayMs,didBranchChange:r.didBranchChange?1:0})}}var Qk=H(require("path")),di=H(require("vscode"));var $g=require("vscode"),OG,d3=class{constructor(e){this._outputChannel=$g.window.createOutputChannel("GitHub Copilot Chat",{log:!0});OG=this._outputChannel,e.subscriptions.push(this._outputChannel)}logIt(e,r,...n){switch(e){case $g.LogLevel.Trace:this._outputChannel.trace(r);break;case $g.LogLevel.Debug:this._outputChannel.debug(r);break;case $g.LogLevel.Info:this._outputChannel.info(r);break;case $g.LogLevel.Warning:this._outputChannel.warn(r);break;case $g.LogLevel.Error:this._outputChannel.error(r);break}}};function D7e(t,e){let r=new la,n=t.onCancellationRequested(()=>{r.cancel(),s()}),o=e.onCancellationRequested(()=>{r.cancel(),s()});function s(){n.dispose(),o.dispose()}return r.token}async function w1(t,e,r){let n=di.window.activeTextEditor,o=n?.selection;if(e==="selection"){if(!n)return;if(!o||o.isEmpty){let a=await t.get(Kh).selectEnclosingScope(n,{reason:di.l10n.t("Select an enclosing range to review"),includeBlocks:!0});if(!a)return;o=a}}let s=e==="selection"?di.l10n.t("Reviewing selected code in {0}...",Qk.default.posix.basename(n.document.uri.path)):e==="index"?di.l10n.t("Reviewing staged changes..."):e==="workingTree"?di.l10n.t("Reviewing unstaged changes..."):di.l10n.t("Reviewing changes...");return di.window.withProgress({location:di.ProgressLocation.Notification,title:s,cancellable:!0},async(a,c)=>{let u=t.get(So),l=new E1(t);u.removeReviewComments(u.getReviewComments());let d=[];if(e==="index"||e==="workingTree"){let m=await sn.getCurrentChanges(t.get(_o),e);(await Promise.all(m.map(async g=>{try{return{document:await di.workspace.openTextDocument(g.uri),relativeDocumentPath:Qk.default.relative(g.repository.rootUri.fsPath,g.uri.fsPath),change:g}}catch(v){try{if((await di.workspace.fs.stat(g.uri)).type===di.FileType.File)throw v;return}catch(y){if(y.code==="FileNotFound")return;throw v}}}))).map(g=>{g&&d.push(g)})}else if(e==="selection")d.push({document:n.document,relativeDocumentPath:Qk.default.basename(n.document.uri.fsPath),selection:n.selection});else for(let m of e.patches){let h=Ye.parse(m.fileUri);d.push({document:await di.workspace.openTextDocument(h),relativeDocumentPath:Qk.default.relative(e.repositoryRoot,h.fsPath),change:await sn.getChanges(t,Ye.file(e.repositoryRoot),h,m.patch)})}let p=r?D7e(r,c):c,f=await l.generateComments(d,p,{report:m=>u.addReviewComments(m)});if(f.type==="error"){let m=di.l10n.t("Show Log");await di.window.showInformationMessage(f.severity==="info"?di.l10n.t("Reviewing your code did not provide any feedback."):di.l10n.t("Code review generation failed."),{modal:!0,detail:f.reason},...f.severity==="info"?[]:[m])===m&&OG.show()}else f.type==="success"&&f.comments.length===0&&await di.window.showInformationMessage(di.l10n.t("Reviewing your code did not provide any feedback."),{modal:!0});return f})}var nI=H(Gt());var R1=ie("IDiffService");var Wg=class extends dt{constructor(r,n,o,s){super();this._initialText=r;this._document=n;this._workspaceService=o;this._diffService=s;this._additionalEdits=on.empty;this._documentText=this._document.getText();this._register(this._workspaceService.onDidChangeTextDocument(a=>{if(a.document.uri.toString()!==this._document.uri.toString())return;let c=on.from(a.contentChanges);this._additionalEdits=this._additionalEdits.compose(c)}))}async compute(){let r=await on.fromDiff(this._initialText,this._documentText,this._diffService);return{getEditsSinceInitial:()=>{if(this._store.isDisposed)throw new Qr("EditComputer has been disposed");return r.compose(this._additionalEdits)}}}};Wg=w([b(2,Ve),b(3,R1)],Wg);var Kg=class{constructor(e,r){this.initialText=e;this._diffService=r;this._document=new MG(e)}addEdits(e){let r=N7e(e,this._document);this._document.apply(r)}getText(){return this._document.getValue()}async getEdits(){let e=this.getText();return await on.fromDiff(this.initialText,e,this._diffService)}};Kg=w([b(1,R1)],Kg);function N7e(t,e){return new on(t.map(r=>{let n=e.positionToOffset(r.range.start),o=e.positionToOffset(r.range.end);return new Io(new Qt(n,o),r.newText)}))}var MG=class{constructor(e=""){this._converter=void 0;this._value="";this._value=e}getValue(){return this._value}apply(e){this._value=e.apply(this._value),this._converter=void 0}positionToOffset(e){return this._converter||(this._converter=new Wa(this._value)),this._converter.positionToOffset(new tr(e.line+1,e.character+1))}};var To=ie("ILanguageDiagnosticService"),k1=class{constructor(e){this._ignoreService=e}waitForNewDiagnostics(e,r,n=5e3){let o,s,a;return new Promise(c=>{o=r.onCancellationRequested(()=>c([])),a=setTimeout(()=>c(this.getDiagnostics(e)),n),s=this.onDidChangeDiagnostics(u=>{for(let l of u.uris)if(DR(l,e)){c(this.getDiagnostics(e));break}})}).finally(()=>{o.dispose(),s.dispose(),clearTimeout(a)})}};k1=w([b(0,ke)],k1);function Lde(t){return t.map(e=>e.range).reduce((e,r)=>e.union(r))}function Ode(t){return t.severity===mS.Error}function FG(t,e,r=[mS.Error,mS.Warning]){return t.find(n=>n.range.contains(e)&&r.includes(n.severity))}var P1=ie("ISurveyService");var Bde=H(Gt());var gy=H(nt());var Yg=class extends X{constructor(r,n,o){super(r);this.instantiationService=n;this.heatmapService=o;this._summarizer=n.createInstance(Wd)}async render(r,n){let o=(await this.heatmapService.getEntries()).filter(a=>a.document.uri.toString()!==this.props.exclude.toString());if(o.length===0)return vscpp(vscppf,null);let s=await Promise.all(o.map(async a=>({summarized:await this._summarizer.summarizeDocument(a.document,void 0,void 0,n.tokenBudget/o.length,{costFnOverride:(u,l)=>{let d=goe(a.offsets,u.range.start,(f,m)=>f-m);d<0&&(d=~d);let p=Math.abs(a.offsets[d]-u.range.start);return l+p}}),document:a.document})));return vscpp(vscppf,null,"I have read or edited some files recently, they may by helpful for answering.",vscpp("br",null),s.map(a=>vscpp(vscppf,null,"From `",vscpp(ps,{value:a.document.uri,mode:1}),"` I have read or edited:",vscpp("br",null),vscpp(Fe,{languageId:a.document.languageId,uri:a.document.uri,code:a.summarized.text}),vscpp("br",null))))}};Yg=w([b(1,K),b(2,oS)],Yg);var A1=class extends X{constructor(r,n,o,s,a){super(r);this._ignoreService=n;this._parserService=o;this._experimentationService=s;this._configurationService=a}async render(r,n){let o=this.props.documentContext,s=o.document,a=s.languageId;if(rr(s.uri))throw dn("InlineChatEditCodePrompt should not be used with a notebook!");if(a==="markdown")throw dn("InlineChatEditCodePrompt should not be used with a markdown document!");if(await this._ignoreService.isCopilotIgnored(s.uri))return vscpp("ignoredFiles",{value:[s.uri]});let{query:u,history:l,chatVariables:d,customInstructions:p}=this.props.promptContext,f=this._configurationService.getExperimentBasedConfig(de.ProjectLabelsInline,this._experimentationService),m=this._configurationService.getExperimentBasedConfig(de.TemporalContextEnabled,this._experimentationService),g=(await ga(this._parserService,s,o.fileIndentInfo,s.validateRange(o.wholeRange),n.endpoint.modelMaxPromptTokens/3)).splitAroundAdjustedSelection(),{codeAbove:v,codeSelected:y,codeBelow:_,hasCodeWithoutSelection:x}=g,S="$SELECTION_PLACEHOLDER$",I=`${v}${S}${_}`,E=g.createReplyInterpreter(Yo.Mute,1,g.replaceSelectionStreaming,Ai.createCodeBlockClassifier(),R=>R.value.trim()!==S);return vscpp(vscppf,null,vscpp("meta",{value:new Hn(E)}),vscpp(gy.SystemMessage,{priority:1e3},"You are an AI programming assistant.",vscpp("br",null),'When asked for your name, you must respond with "GitHub Copilot".',vscpp("br",null),"You are a world class expert in programming, and especially good at ",a,".",vscpp("br",null),"Source code is always contained in ``` blocks.",vscpp("br",null),"The user needs help to modify some code.",vscpp("br",null),x&&vscpp(vscppf,null,"The user includes existing code and marks with ",S," where the selected code should go.",vscpp("br",null)),vscpp(Rt,null)),f&&vscpp(Vo,{priority:600}),vscpp(Ot,{priority:700,history:l}),vscpp(gy.UserMessage,{priority:725},vscpp(Or,{customInstructions:p,languageId:a})),m&&vscpp(gy.UserMessage,null,vscpp(Yg,{priority:600,exclude:s.uri})),vscpp(pr,{priority:750,endpoint:n.endpoint,promptContext:this.props.promptContext,flexGrow:1}),vscpp(Bs,{priority:750,chatVariables:d}),vscpp(gy.UserMessage,{priority:800},"I have the following code in a file called `",vscpp(ps,{value:s.uri,mode:1}),"`:",x&&vscpp(vscppf,null,vscpp(Fe,{uri:s.uri,languageId:a,code:I,shouldTrim:!1}),vscpp("br",null)),x&&vscpp(vscppf,null,"The ",S," code is:",vscpp("br",null)),vscpp(Fe,{uri:s.uri,languageId:a,code:y,shouldTrim:!1})),vscpp(gy.UserMessage,{priority:900},vscpp(qs,{chatVariables:d,query:u}),vscpp("br",null),x&&vscpp(vscppf,null,"The modified ",S," code with ``` is:")))}};A1=w([b(1,ke),b(2,_t),b(3,wt),b(4,be)],A1);var am=H(nt());var sm=H(nt());var D1=class extends X{constructor(r,n,o){super(r);this._ignoreService=n;this._parserService=o}async render(r,n){let o=this.props.documentContext,s=o.document,a=s.languageId;if(rr(this.props.documentContext.document.uri))throw dn("InlineChatGenerateMarkdownPrompt should not be used with a notebook!");if(a!=="markdown")throw dn("InlineChatGenerateMarkdownPrompt should only be used with markdown documents!");if(await this._ignoreService.isCopilotIgnored(o.document.uri))return vscpp("ignoredFiles",{value:[this.props.documentContext.document.uri]});let{query:u,history:l,chatVariables:d,customInstructions:p}=this.props.promptContext,m=(await ga(this._parserService,o.document,o.fileIndentInfo,o.document.validateRange(o.wholeRange),n.endpoint.modelMaxPromptTokens/3)).splitAroundOriginalSelectionEnd(),{codeAbove:h,hasContent:g,codeBelow:v}=m,y="$PLACEHOLDER$",_=`${h}${y}${v}`,x=m.createReplyInterpreter(Yo.Mute,0,m.insertStreaming,Ai.createFencedBlockClassifier(Hs.FenceSequence),S=>S.value.trim()!==y);return vscpp(vscppf,null,vscpp("meta",{value:new Hn(x)}),vscpp(sm.SystemMessage,{priority:1e3},"You are an AI programming assistant.",vscpp("br",null),'When asked for your name, you must respond with "GitHub Copilot".',vscpp("br",null),"You are a world class markdown editor, very well versed in programming.",vscpp("br",null),"The user needs help to write some new markdown.",vscpp("br",null),"The markdown is always delimited by ",Hs.FenceSequence,".",vscpp("br",null),g&&vscpp(vscppf,null,"The user includes existing markdown and marks with ",y," where the new code should go.",vscpp("br",null)),g&&vscpp(vscppf,null,'DO NOT include the text "',y,'" in your reply.',vscpp("br",null)),g&&vscpp(vscppf,null,"DO NOT repeat any markdown from the user in your reply.",vscpp("br",null)),!g&&vscpp(vscppf,null,"Your answer must begin and end with ",Hs.FenceSequence,vscpp("br",null)),vscpp(Rt,null)),vscpp(Ot,{priority:700,history:l}),vscpp(sm.UserMessage,{priority:725},vscpp(Or,{customInstructions:p,languageId:a})),vscpp(pr,{priority:750,endpoint:n.endpoint,promptContext:this.props.promptContext,flexGrow:1}),vscpp(Bs,{priority:750,chatVariables:d}),g&&vscpp(sm.UserMessage,{priority:800},"I have the following markdown in a file called `",vscpp(ps,{value:s.uri,mode:1}),"`:",vscpp(Hs,{uri:s.uri,code:_})),!g&&vscpp(sm.UserMessage,{priority:800},"I am in an empty file `",vscpp(ps,{value:s.uri,mode:1}),"`."),vscpp(sm.UserMessage,{priority:900},vscpp(qs,{chatVariables:d,query:u}),vscpp("br",null),g&&vscpp(vscppf,null,"Remember to start and end your answer with ",Hs.FenceSequence,". The markdown that would fit at ",y," is:")))}};D1=w([b(1,ke),b(2,_t)],D1);var Hs=class t extends $f{static{this.FenceSequence="-+-+-+-+-+"}async render(e){if(this.props.uri?await this._ignoreService.isCopilotIgnored(this.props.uri):!1)return this._handleFoulPrompt();let n=t.FenceSequence,o=`${n}
${this.props.code}
${n}`;return vscpp(sm.TextChunk,null,o)}};var N1=class extends X{constructor(r,n,o){super(r);this._ignoreService=n;this._parserService=o}async render(r,n){let o=this.props.documentContext,s=o.document,a=s.languageId;if(rr(this.props.documentContext.document.uri))throw dn("InlineChatEditMarkdownPrompt should not be used with a notebook!");if(a!=="markdown")throw dn("InlineChatEditMarkdownPrompt should only be used with markdown documents!");if(await this._ignoreService.isCopilotIgnored(o.document.uri))return vscpp("ignoredFiles",{value:[this.props.documentContext.document.uri]});let{query:u,history:l,chatVariables:d,customInstructions:p}=this.props.promptContext,m=(await ga(this._parserService,o.document,o.fileIndentInfo,o.document.validateRange(o.wholeRange),n.endpoint.modelMaxPromptTokens/3)).splitAroundAdjustedSelection(),{codeAbove:h,codeSelected:g,codeBelow:v,hasCodeWithoutSelection:y}=m,_="$SELECTION_PLACEHOLDER$",x=`${h}${_}${v}`,S=m.createReplyInterpreter(Yo.Mute,0,m.replaceSelectionStreaming,Ai.createFencedBlockClassifier(Hs.FenceSequence),I=>I.value.trim()!==_);return vscpp(vscppf,null,vscpp("meta",{value:new Hn(S)}),vscpp(am.SystemMessage,{priority:1e3},"You are an AI programming assistant.",vscpp("br",null),'When asked for your name, you must respond with "GitHub Copilot".',vscpp("br",null),"You are a world class markdown editor, very well versed in programming.",vscpp("br",null),"The user needs help to modify some markdown content.",vscpp("br",null),"The markdown is always delimited by ",Hs.FenceSequence,".",vscpp("br",null),"Your answer must begin and end with ",Hs.FenceSequence,".",vscpp("br",null),vscpp(Rt,null)),vscpp(Ot,{priority:700,history:l}),vscpp(am.UserMessage,{priority:725},vscpp(Or,{customInstructions:p,languageId:a})),vscpp(pr,{priority:750,endpoint:n.endpoint,promptContext:this.props.promptContext,flexGrow:1}),vscpp(Bs,{priority:750,chatVariables:d}),y&&vscpp(vscppf,null,vscpp(am.UserMessage,{priority:750},"For context, I have the following markdown in a file called `",vscpp(ps,{value:s.uri,mode:1}),"`:",vscpp(Hs,{uri:s.uri,code:x}),vscpp("br",null)),vscpp(am.UserMessage,{priority:800},"I need your help with the following content:",vscpp("br",null),vscpp(Hs,{uri:s.uri,code:g})),vscpp(am.UserMessage,{priority:900},vscpp(qs,{chatVariables:d,query:u}),vscpp("br",null),"The rewritten markdown content from my last message wrapped with ",Hs.FenceSequence," is:")),!y&&vscpp(vscppf,null,vscpp(am.UserMessage,{priority:800},"I have the following markdown in a file called `",vscpp(ps,{value:s.uri,mode:1}),"`:",vscpp(Hs,{uri:s.uri,code:g})),vscpp(am.UserMessage,{priority:900},vscpp(qs,{chatVariables:d,query:u}),vscpp("br",null),"The rewritten markdown content wrapped with ",Hs.FenceSequence," is:")))}};N1=w([b(1,ke),b(2,_t)],N1);var Qg=H(nt());var L1=class extends X{constructor(r,n,o,s,a){super(r);this._ignoreService=n;this._parserService=o;this._experimentationService=s;this._configurationService=a}async render(r,n){let o=this.props.documentContext,s=o.document,a=s.languageId;if(rr(s.uri))throw dn("InlineChatGenerateCodePrompt should not be used with a notebook!");if(a==="markdown")throw dn("InlineChatGenerateCodePrompt should not be used with a markdown document!");if(await this._ignoreService.isCopilotIgnored(s.uri))return vscpp("ignoredFiles",{value:[s.uri]});let{query:u,history:l,chatVariables:d,customInstructions:p}=this.props.promptContext,f=this._configurationService.getExperimentBasedConfig(de.ProjectLabelsInline,this._experimentationService),m=this._configurationService.getExperimentBasedConfig(de.TemporalContextEnabled,this._experimentationService),g=(await ga(this._parserService,s,o.fileIndentInfo,s.validateRange(o.wholeRange),n.endpoint.modelMaxPromptTokens/3)).splitAroundOriginalSelectionEnd(),{codeAbove:v,hasContent:y,codeBelow:_}=g,x="$PLACEHOLDER$",S=`${v}${x}${_}`,I=g.createReplyInterpreter(Yo.Mute,1,n.endpoint.family!=="gpt-3.5-turbo"?g.insertStreaming:g.insertOrReplaceStreaming,Ai.createCodeBlockClassifier(),E=>E.value.trim()!==x);return vscpp(vscppf,null,vscpp("meta",{value:new Hn(I)}),vscpp(Qg.SystemMessage,{priority:1e3},"You are an AI programming assistant.",vscpp("br",null),'When asked for your name, you must respond with "GitHub Copilot".',vscpp("br",null),"You are a world class expert in programming, and especially good at ",a,".",vscpp("br",null),"Source code is always contained in ``` blocks.",vscpp("br",null),"The user needs help to write some new code.",vscpp("br",null),y&&vscpp(vscppf,null,"The user includes existing code and marks with ",x," where the new code should go.",vscpp("br",null)),y&&vscpp(vscppf,null,'DO NOT include the text "',x,'" in your reply.',vscpp("br",null)),y&&vscpp(vscppf,null,"DO NOT repeat any code from the user in your reply.",vscpp("br",null)),!y&&vscpp(vscppf,null,"Your must generate a code block surrounded with ``` that will be used in a new file",vscpp("br",null)),vscpp(Rt,null)),f&&vscpp(Vo,{priority:600}),vscpp(Ot,{priority:700,history:l}),vscpp(Qg.UserMessage,{priority:725},vscpp(Or,{customInstructions:p,languageId:a})),m&&vscpp(Qg.UserMessage,null,vscpp(Yg,{priority:600,exclude:s.uri})),vscpp(pr,{priority:750,endpoint:n.endpoint,promptContext:this.props.promptContext,flexGrow:1}),vscpp(Bs,{priority:750,chatVariables:d}),y&&vscpp(Qg.UserMessage,{priority:800},"I have the following code in a file called `",vscpp(ps,{value:s.uri,mode:1}),"`:",vscpp(Fe,{uri:s.uri,languageId:a,code:S,shouldTrim:!1})),!y&&vscpp(Qg.UserMessage,{priority:800},"I am in an empty file `",vscpp(ps,{value:s.uri,mode:1}),"`."),vscpp(Qg.UserMessage,{priority:900},vscpp(qs,{chatVariables:d,query:u}),vscpp("br",null),y&&vscpp(vscppf,null,"The code that would fit at ",x," with ``` is:")))}};L1=w([b(1,ke),b(2,_t),b(3,wt),b(4,be)],L1);var Mc=H(nt());var O1=ie("INotebookService");function Xg(t){return rr(t)?t.path.endsWith(".ipynb"):!1}function Mde(t,e){return t.notebookDocuments.find(n=>n.uri.fsPath===e.fsPath)?.notebookType}var UG={core:1e3,context:800,runtimeCore:600,history:500,other:100};var j1=H(nt());var gs=H(nt());function Fde(t,e,r,n,o,s){if(r.start.line!==r.end.line&&r.end.character===0){let p=t.lineAt(r.end.line-1);r=new Qe(r.start,new rn(r.end.line-1,p.text.length))}else if(e.end.character===0&&e.end.line!==e.start.line&&(r.start.line===e.start.line&&r.start.character===0&&r.end.line===e.end.line&&r.end.character===t.lineAt(r.end.line).text.length||r.isEqual(e))){let p=t.lineAt(r.end.line-1);r=new Qe(r.start,new rn(r.end.line-1,p.text.length))}let a=new Us(s,t,o,"ed8c6549bwf9"),c=new Us(s,t,o,"abpxx6d04wxr"),u=new Us(s,t,o,"be15d9bcejpp"),l=()=>(c.trim(),a.trim(e),u.trim(),{language:o,above:c,range:a,below:u});for(let p=r.end.line;p>=r.start.line;p--)if(!a.prependLine(p))return l();let d={aboveLineIndex:r.start.line-1,belowLineIndex:r.end.line+1,minimumLineIndex:Math.max(0,n.start.line),maximumLineIndex:Math.min(t.lineCount-1,n.end.line)};return BG(d,c,u),l()}function BG(t,e,r){let n=t.aboveLineIndex,o=!0,s=t.belowLineIndex,a=!0;for(let c=0;c<100&&(o||a);c++)!o||a&&c%4===3?s<=t.maximumLineIndex&&r.appendLine(s)?s++:a=!1:n>=t.minimumLineIndex&&e.prependLine(n)?n--:o=!1;e.isComplete=n<t.minimumLineIndex,r.isComplete=s>t.maximumLineIndex}function p3(t,e,r,n,o){let s={...n,aboveCells:[],belowCells:[]},a,c,u;if(r.document.uri.scheme==="vscode-notebook-cell"){a=e.notebookDocuments.find(S=>S.uri.fsPath===r.document.uri.fsPath&&S.getCells().find(I=>I.document===r.document));let x=a?.getCells().findIndex(S=>S.document===r.document);if(x===void 0||x===-1)return s;c=x-1,u=x+1}else{if(t.activeNotebookEditor?.notebook.uri.path!==r.document.uri.path)return s;let x=t.activeNotebookEditor;a=x?.notebook;let S=x.selection.start;c=S-1,u=S}if(!a)return s;let{language:l,above:d,range:p,below:f}=n,m=d.lines.length+p.lines.length+f.lines.length,h=[],g=[],v=()=>(h.forEach(x=>x.trim()),g.forEach(x=>x.trim()),{language:l,above:d,range:p,below:f,aboveCells:h,belowCells:g}),y=!0,_=!0;for(let x=m;x<100&&(y||_);x++)if(y)if(c>=0){let I=a.cellAt(c).document,E=new Us(o,I,Ko(I),"CELL:"+I.uri.fragment);for(let R=0;R<I.lineCount;R++)E.appendLine(R);h.unshift(E),c--}else y=!1;else if(u<a.cellCount){let I=a.cellAt(u).document,E=new Us(o,I,Ko(I),"CELL:"+I.uri.fragment);for(let R=0;R<I.lineCount;R++)E.appendLine(R);g.push(E),u++}else _=!1;return v()}var cm=class extends X{render(){return vscpp(vscppf,null,"```",this.props.language.languageId,vscpp("br",null),this.props.document&&vscpp(vscppf,null,hu.forDocument(this.props.language,this.props.document),vscpp("br",null)),this.props.code&&vscpp(vscppf,null,this.props.code,vscpp("br",null)),"```")}};var va=class extends X{render(){if(!this.props.codeRegion.hasContent)return;let e=[];return this.props.useMarkers&&e.push(this.props.codeRegion.startMarker),e.push(...this.props.codeRegion.lines),this.props.useMarkers&&e.push(this.props.codeRegion.endMarker),vscpp(cm,{language:this.props.codeRegion.language,document:this.props.codeRegion.document,code:e.join(`
`)})}};var f3=class extends X{render(e,r){if(!rr(this.props.documentContext.document.uri))throw dn("InlineChatNotebookSelectionRenderer should be used only with a notebook!");let n=Xg(this.props.documentContext.document.uri),{below:o,above:s,range:a,aboveCells:c,belowCells:u}=this.props,l=c||[],d=u||[],p=this.props.documentContext.language,f=this.props.includeDelimeters??!1;return vscpp(vscppf,null,n?vscpp(vscppf,null,(l.length>0||d.length>0)&&vscpp(F1,{documentContext:this.props.documentContext,aboveCells:l,belowCells:d}),p.languageId==="markdown"?vscpp(VG,{cellIndex:l.length,selected:a,above:s,below:o,includeDelimeters:f}):vscpp(GG,{cellIndex:l.length,selected:a,above:s,below:o,includeDelimeters:f})):vscpp(vscppf,null,vscpp(Jg,{documentContext:this.props.documentContext}),vscpp(M1,{documentContext:this.props.documentContext,aboveCells:l,belowCells:d}),p.languageId==="markdown"?vscpp(jG,{cellIndex:l.length,selected:a,above:s,below:o,includeDelimeters:f}):vscpp(HG,{cellIndex:l.length,selected:a,above:s,below:o,includeDelimeters:f})))}},Ude=[{viewType:"polyglot-notebook",exampleCells:[{lan:"markdown",source:"Samples"},{lan:"csharp",source:"using Microsoft.Data.Analysis;"},{lan:"csharp",source:`DateTimeDataFrameColumn dateTimes = new DateTimeDataFrameColumn("DateTimes");
 Int32DataFrameColumn ints = new Int32DataFrameColumn("Ints", 6);
 StringDataFrameColumn strings = new StringDataFrameColumn("Strings", 6);`},{lan:"csharp",source:'dateTimes.Append(DateTime.Parse("2019/01/01"));'}]},{viewType:"sql-notebook",exampleCells:[{lan:"sql",source:"SELECT * FROM users;"}]},{viewType:"node-notebook",exampleCells:[{lan:"javascript",source:'console.log("Hello World");'},{lan:"javascript",source:"const {display} = require('node-kernel');"},{lan:"markdown",source:"# Plain text output"},{lan:"javascript",source:"display.text('Hello World');"}]},{viewType:"sas-notebook",exampleCells:[{lan:"sas",source:"proc print data=sashelp.class; run;"},{lan:"sas",source:`data race;
pr = probnorm(-15/sqrt(325));
run;

proc print data=race;
var pr;
run;
`}]},{viewType:"http-notebook",exampleCells:[{lan:"http",source:"GET https://httpbin.org/get"},{lan:"http",source:"POST https://httpbin.org/post"}]},{viewType:"powerbi-notebook",exampleCells:[{lan:"markdown",source:"# Get Groups"},{lan:"powerbi-api",source:"GET /groups"},{lan:"powerbi-api",source:`%dax /groups/ccce57d1-10af-1234-1234-665f8bbd8458/datasets/51ba6d4b-1234-1234-8635-a7d743a5ea89
EVALUATE INFO.TABLES()
This`}]},{viewType:"wolfram-language-notebook",exampleCells:[{lan:"wolfram",source:"Plot[Sin[x], {x, 0, 2 Pi}]"}]},{viewType:"github-issues",exampleCells:[{lan:"github-issues",source:`$vscode=repo:microsoft/vscode
$milestone=milestone:"May 2020"`},{lan:"github-issues",source:"$vscode $milestone is:closed author:@me -assignee:@me label:bug -label:verified"},{lan:"github-issues",source:"$vscode assignee:@me is:open label:freeze-slow-crash-leak"}]},{viewType:"rest-book",exampleCells:[{lan:"rest-book",source:"GET google.com"},{lan:"rest-book",source:`GET https://www.google.com
    ?query="fun"
    &page=2
    User-Agent: rest-book
    Content-Type: application/json`}]}],qG=class extends X{render(){let e=this.props.viewType,r=Ude.find(o=>o.viewType===this.props.viewType);if(!r)return vscpp(vscppf,null);let{exampleCells:n}=r;return vscpp(gs.UserMessage,null,"Below you will find a set of example cells for a ",e," notebook.",vscpp("br",null),n.map((o,s)=>vscpp(vscppf,null,"CELL INDEX: ",s,":",vscpp("br",null),"```",o.lan,vscpp("br",null),o.source,vscpp("br",null),vscpp("br",null),"```")))}},Jg=class extends X{constructor(r,n,o){super(r);this.workspaceService=o}render(r,n){if(!rr(this.props.documentContext.document.uri))throw dn("InlineChatCustomNotebookInfoRenderer should be used only with a notebook!");let o=Mde(this.workspaceService,this.props.documentContext.document.uri),s=Ude.find(c=>c.viewType===o),a=s?o:"custom";return vscpp(vscppf,null,vscpp(gs.UserMessage,null,"I am working on a ",a," notebook in VS Code.",vscpp("br",null),a," notebooks in VS Code are documents that contain a mix of rich Markdown, executable code snippets, ",vscpp("br",null),"and accompanying rich output. These are all separated into distinct cells and can be interleaved in any order ",vscpp("br",null),"A ",a," notebook contains multiple cells.",vscpp("br",null)),s&&vscpp(qG,{viewType:s.viewType}))}};Jg=w([b(1,st),b(2,Ve)],Jg);var M1=class extends X{render(e,r){if(!rr(this.props.documentContext.document.uri))throw dn("InlineChatCustomNotebookCellsContextRenderer should be used only with a notebook!");let{aboveCells:n,belowCells:o,documentContext:s}=this.props,a=n||[],c=o||[],u=s.language;return vscpp(vscppf,null,(a.length>0||c.length>0)&&vscpp(gs.UserMessage,null,"The content of cells are listed below, each cell starts with CELL INDEX and a code block started with ```",u.languageId,vscpp("br",null),"Each cell is a block of code that can be executed independently.",vscpp("br",null),"Do not generate CELL INDEX in your answer, it is only used to help you understand the context.",vscpp("br",null),vscpp("br",null),"Below you will find a set of examples of what you should respond with. Please follow the exmaples on how to avoid repeating code.",vscpp("br",null),a.length>0&&vscpp(U1,{cells:a,title:`Here are the cells in this custom notebook:
`}),c.length>0&&vscpp(U1,{cells:c,cellIndexDelta:a.length+1,title:`Here are the cells below the current cell that I am editing in this custom notebook:
`})))}},jG=class extends X{render(){let e=this.props.includeDelimeters??(this.props.above.hasContent||this.props.below.hasContent);return vscpp(vscppf,null,vscpp(gs.UserMessage,null,"Now I create a new cell in this custom Notebook document at index ",this.props.cellIndex,".",vscpp("br",null),"This is a markdown cell. Markdown cell is used to describe and document your workflow.",vscpp("br",null),this.props.selected.hasContent?vscpp(vscppf,null,"I have the following content in the selection:",vscpp(va,{codeRegion:this.props.selected,useMarkers:e})):vscpp(vscppf,null,"In this new cell, I am working with the following content:",vscpp(cm,{language:this.props.selected.language,code:""}))),this.props.above.hasContent&&vscpp(gs.UserMessage,null,"In this new cell, I have the following markdown content above the selection:",vscpp(va,{codeRegion:this.props.above,useMarkers:this.props.includeDelimeters})),this.props.below.hasContent&&vscpp(gs.UserMessage,null,"In this new cell, I have the following markdown content below the selection:",vscpp(va,{codeRegion:this.props.below,useMarkers:this.props.includeDelimeters})))}},HG=class extends X{render(){let e=this.props.includeDelimeters??(this.props.above.hasContent||this.props.below.hasContent);return vscpp(vscppf,null,vscpp(gs.UserMessage,null,"Now I create a new cell in this custom Notebook document at index ",this.props.cellIndex,".",vscpp("br",null),this.props.selected.hasContent?vscpp(vscppf,null,"I have the following code in the selection:",vscpp(va,{codeRegion:this.props.selected,useMarkers:e})):vscpp(vscppf,null,"In this new cell, I am working with the following code:",vscpp(cm,{language:this.props.selected.language,code:""}))),this.props.above.hasContent&&vscpp(gs.UserMessage,null,"In this new cell, I have the following code above the selection:",vscpp(va,{codeRegion:this.props.above,useMarkers:this.props.includeDelimeters})),this.props.below.hasContent&&vscpp(gs.UserMessage,null,"In this new cell, I have the following code below the selection:",vscpp(va,{codeRegion:this.props.below,useMarkers:this.props.includeDelimeters})))}},F1=class extends X{render(e,r){if(!rr(this.props.documentContext.document.uri))throw dn("InlineChatNotebookSelectionRenderer should be used only with a notebook!");let{aboveCells:n,belowCells:o}=this.props,s=this.props.documentContext.language;return vscpp(vscppf,null,(n.length>0||o.length>0)&&vscpp(gs.UserMessage,null,"I am working on a Jupyter notebook.",vscpp("br",null),"This Jupyter Notebook already contains multiple cells.",vscpp("br",null),"The content of cells are listed below, each cell starts with CELL INDEX and a code block started with ```",s.languageId,vscpp("br",null),"Each cell is a block of code that can be executed independently.",vscpp("br",null),"Since it is Jupyter Notebook, if a module is already imported in a cell, it can be used in other cells as well.",vscpp("br",null),"For the same reason, if a variable is defined in a cell, it can be used in other cells as well.",vscpp("br",null),"We should not repeat the same import or variable definition in multiple cells, unless we want to overwrite the previous definition.",vscpp("br",null),"Do not generate CELL INDEX in your answer, it is only used to help you understand the context.",vscpp("br",null),vscpp("br",null),"Below you will find a set of examples of what you should respond with. Please follow the exmaples on how to avoid repeating code.",vscpp("br",null),"## Examples starts here",vscpp("br",null),"Here are the cells in this Jupyter Notebook:",vscpp("br",null),"`CELL INDEX: 0",vscpp("br",null),"```python",vscpp("br",null),"import pandas as pd",vscpp("br",null),vscpp("br",null),"# create a dataframe with sample data",vscpp("br",null),"df = pd.DataFrame({'Name': ['Alice', 'Bob', 'Charlie'], 'Age': [25, 30, 35], 'Gender': ['F', 'M', 'M']})",vscpp("br",null),"print(df)",vscpp("br",null),"```",vscpp("br",null),"---------------------------------",vscpp("br",null),"USER:",vscpp("br",null),"Now I create a new cell in this Jupyter Notebook document at index 1.",vscpp("br",null),"In this new cell, I am working with the following code:",vscpp("br",null),"```python",vscpp("br",null),"```",vscpp("br",null),"---------------------------------",vscpp("br",null),"USER:",vscpp("br",null),"plot the data frame",vscpp("br",null),vscpp("br",null),"---------------------------------",vscpp("br",null),"ChatGPT Answer",vscpp("br",null),"---------------------------------",vscpp("br",null),"To plot the dataframe, we can use the `plot()` method of pandas dataframe. Here's the code:",vscpp("br",null),vscpp("br",null),"```python",vscpp("br",null),"df.plot(x='Name', y='Age', kind='bar')",vscpp("br",null),"```",vscpp("br",null),"## Example ends here",vscpp("br",null),n.length>0&&vscpp(U1,{cells:n,title:`Here are the cells in this Jupyter Notebook:
`}),o.length>0&&vscpp(U1,{cells:o,cellIndexDelta:n.length+1,title:`Here are the cells below the current cell that I am editing in this Jupyter Notebook:
`})))}},VG=class extends X{render(){let e=this.props.includeDelimeters??(this.props.above.hasContent||this.props.below.hasContent);return vscpp(vscppf,null,vscpp(gs.UserMessage,null,"Now I create a new cell in this Jupyter Notebook document at index ",this.props.cellIndex,".",vscpp("br",null),"This is a markdown cell. Markdown cell is used to describe and document your workflow.",vscpp("br",null),this.props.selected.hasContent?vscpp(vscppf,null,"I have the following content in the selection:",vscpp(va,{codeRegion:this.props.selected,useMarkers:e})):vscpp(vscppf,null,"In this new cell, I am working with the following content:",vscpp(cm,{language:this.props.selected.language,code:""}))),this.props.above.hasContent&&vscpp(gs.UserMessage,null,"In this new cell, I have the following markdown content above the selection:",vscpp(va,{codeRegion:this.props.above,useMarkers:this.props.includeDelimeters})),this.props.below.hasContent&&vscpp(gs.UserMessage,null,"In this new cell, I have the following markdown content below the selection:",vscpp(va,{codeRegion:this.props.below,useMarkers:this.props.includeDelimeters})))}},GG=class extends X{render(){let e=this.props.includeDelimeters??(this.props.above.hasContent||this.props.below.hasContent);return vscpp(vscppf,null,vscpp(gs.UserMessage,null,"Now I create a new cell in this Jupyter Notebook document at index ",this.props.cellIndex,".",vscpp("br",null),this.props.selected.hasContent?vscpp(vscppf,null,"I have the following code in the selection:",vscpp(va,{codeRegion:this.props.selected,useMarkers:e})):vscpp(vscppf,null,"In this new cell, I am working with the following code:",vscpp(cm,{language:this.props.selected.language,code:""}))),this.props.above.hasContent&&vscpp(gs.UserMessage,null,"In this new cell, I have the following code above the selection:",vscpp(va,{codeRegion:this.props.above,useMarkers:this.props.includeDelimeters})),this.props.below.hasContent&&vscpp(gs.UserMessage,null,"In this new cell, I have the following code below the selection:",vscpp(va,{codeRegion:this.props.below,useMarkers:this.props.includeDelimeters})))}},U1=class extends X{render(){return vscpp(vscppf,null,this.props.title,vscpp("br",null),this.props.cells.map((e,r)=>vscpp(zG,{index:r+(this.props.cellIndexDelta??0),cell:e})))}},zG=class extends X{render(){return vscpp(vscppf,null,"CELL INDEX: ",this.props.index,vscpp("br",null),"```",this.props.cell.language.languageId,vscpp("br",null),this.props.cell.lines.join(`
`),vscpp("br",null),"```")}};function $G(t,e,r,n,o){let s=t*4,a=new zd(s),c=Fde(e.document,e.selection,r,new Qe(0,0,e.document.lineCount,0),e.language,a);return p3(n,o,e,c,a)}var B1=class extends X{constructor(r,n,o){super(r);this.tabsAndEditorsService=n;this.workspaceService=o}async prepare(){let{document:r,wholeRange:n}=this.props.documentContext;return{wholeRange:r.validateRange(n)}}render(r,n){if(!rr(this.props.documentContext.document.uri))throw dn("InlineChatNotebookSelection should be used only with a notebook!");let{wholeRange:o}=r,s=$G(n.endpoint.modelMaxPromptTokens/3,this.props.documentContext,o,this.tabsAndEditorsService,this.workspaceService),a=this.props.documentContext.document,c=new Kf(o,s),u=[{uri:a.uri,version:a.version,ranges:Nr([s.range.toRange(),s.above.toRange(),s.below.toRange()])}],l=Xg(this.props.documentContext.document.uri),{hasCodeWithoutSelection:d,codeWithoutSelection:p,codeSelected:f}=this.props,{aboveCells:m,belowCells:h}=s,g=m||[],v=h||[],y=this.props.documentContext.language,_=y.languageId==="markdown",x=d||f.length>0;return vscpp(vscppf,null,vscpp("usedContext",{value:u}),vscpp("meta",{value:c}),l?vscpp(vscppf,null,(g.length>0||v.length>0)&&vscpp(F1,{documentContext:this.props.documentContext,aboveCells:g,belowCells:v}),vscpp(j1.UserMessage,null,_?vscpp(vscppf,null,x&&vscpp(vscppf,null,"Now I edit a markdown cell in this Jupyter Notebook document at index ",g.length,".",vscpp("br",null)),!x&&vscpp(vscppf,null,"Now I create a new markdown cell in this Jupyter Notebook document at index ",g.length,".",vscpp("br",null)),"This is a markdown cell. Markdown cell is used to describe and document your workflow.",vscpp("br",null),d&&vscpp(vscppf,null,vscpp(Fe,{uri:a.uri,languageId:y.languageId,code:p,shouldTrim:!1}),vscpp("br",null)),d&&vscpp(vscppf,null,"The $SELECTION_PLACEHOLDER$ code is:",vscpp("br",null)),vscpp(Fe,{uri:a.uri,languageId:y.languageId,code:f,shouldTrim:!1})):vscpp(vscppf,null,x&&vscpp(vscppf,null,"Now I edit a cell in this Jupyter Notebook document at index ",g.length,".",vscpp("br",null)),!x&&vscpp(vscppf,null,"Now I create a new cell in this Jupyter Notebook document at index ",g.length,".",vscpp("br",null)),d&&vscpp(vscppf,null,vscpp(Fe,{uri:a.uri,languageId:y.languageId,code:p,shouldTrim:!1}),vscpp("br",null)),f.length>0&&vscpp(vscppf,null,"The $SELECTION_PLACEHOLDER$ code is:",vscpp("br",null)),vscpp(Fe,{uri:a.uri,languageId:y.languageId,code:f,shouldTrim:!1})))):vscpp(vscppf,null,vscpp(Jg,{documentContext:this.props.documentContext}),vscpp(M1,{documentContext:this.props.documentContext,aboveCells:g,belowCells:v}),vscpp(j1.UserMessage,null,_?vscpp(vscppf,null,d&&vscpp(vscppf,null,"Now I edit a markdown cell in this custom Notebook document at index ",g.length,".",vscpp("br",null)),!d&&vscpp(vscppf,null,"Now I create a new markdown cell in this custom Notebook document at index ",g.length,".",vscpp("br",null)),"This is a markdown cell. Markdown cell is used to describe and document your workflow.",vscpp("br",null),d&&vscpp(vscppf,null,vscpp(Fe,{uri:a.uri,languageId:y.languageId,code:p,shouldTrim:!1}),vscpp("br",null)),d&&vscpp(vscppf,null,"The $SELECTION_PLACEHOLDER$ code is:",vscpp("br",null)),vscpp(Fe,{uri:a.uri,languageId:y.languageId,code:f,shouldTrim:!1})):vscpp(vscppf,null,d&&vscpp(vscppf,null,"Now I edit a cell in this custom Notebook document at index ",g.length,".",vscpp("br",null)),!d&&vscpp(vscppf,null,"Now I create a new cell in this custom Notebook document at index ",g.length,".",vscpp("br",null)),d&&vscpp(vscppf,null,vscpp(Fe,{uri:a.uri,languageId:y.languageId,code:p,shouldTrim:!1}),vscpp("br",null)),d&&vscpp(vscppf,null,"The $SELECTION_PLACEHOLDER$ code is:",vscpp("br",null)),vscpp(Fe,{uri:a.uri,languageId:y.languageId,code:f,shouldTrim:!1})))))}};B1=w([b(1,zt),b(2,Ve)],B1);var q1=class extends X{constructor(r,n,o,s,a,c){super(r);this.configurationService=n;this.notebookService=o;this.tabsAndEditorsService=s;this.experimentationService=a;this.workspaceService=c}async prepare(){let{document:r,wholeRange:n}=this.props.documentContext,o=this.experimentationService.getTreatmentVariable("vscode","copilotchat.notebookSummary")||this.configurationService.getConfig(de.NotebookSummaryExperimentEnabled),s;return o&&this.tabsAndEditorsService.activeNotebookEditor?.notebook&&this.tabsAndEditorsService.activeNotebookEditor?.notebook.uri.path===r.uri.path&&(s=this.notebookService.getCellExecutions(this.tabsAndEditorsService.activeNotebookEditor.notebook.uri)),{wholeRange:r.validateRange(n),executedCells:s}}render(r,n){if(!rr(this.props.documentContext.document.uri))throw dn("InlineChatNotebookSelection should be used only with a notebook!");let{wholeRange:o}=r,s=$G(n.endpoint.modelMaxPromptTokens/3,this.props.documentContext,o,this.tabsAndEditorsService,this.workspaceService),a=this.props.documentContext.document,c=new Kf(o,s),u=[{uri:a.uri,version:a.version,ranges:Nr([s.range.toRange(),s.above.toRange(),s.below.toRange()])}],l=Xg(this.props.documentContext.document.uri),{hasContent:d,code:p}=this.props,{aboveCells:f,belowCells:m}=s,h=f||[],g=m||[],v=this.props.documentContext.language,y=v.languageId==="markdown",_=r.executedCells||[];return vscpp(vscppf,null,vscpp("usedContext",{value:u}),vscpp("meta",{value:c}),l?vscpp(vscppf,null,_.length>0&&vscpp(WG,{documentContext:this.props.documentContext,executedCells:_}),_.length===0&&(h.length>0||g.length>0)&&vscpp(F1,{documentContext:this.props.documentContext,aboveCells:h,belowCells:g}),vscpp(j1.UserMessage,null,y?vscpp(vscppf,null,d&&vscpp(vscppf,null,"Now I edit a markdown cell in this Jupyter Notebook document at index ",h.length,".",vscpp("br",null)),!d&&vscpp(vscppf,null,"Now I create a new markdown cell in this Jupyter Notebook document at index ",h.length,".",vscpp("br",null)),"This is a markdown cell. Markdown cell is used to describe and document your workflow.",vscpp("br",null),d&&vscpp(vscppf,null,vscpp(Fe,{uri:a.uri,languageId:v.languageId,code:p,shouldTrim:!1}),vscpp("br",null))):vscpp(vscppf,null,d&&vscpp(vscppf,null,"Now I edit a cell in this Jupyter Notebook document at index ",h.length,".",vscpp("br",null)),!d&&vscpp(vscppf,null,"Now I create a new cell in this Jupyter Notebook document at index ",h.length,".",vscpp("br",null)),d&&vscpp(vscppf,null,vscpp(Fe,{uri:a.uri,languageId:v.languageId,code:p,shouldTrim:!1}),vscpp("br",null))))):vscpp(vscppf,null,vscpp(Jg,{documentContext:this.props.documentContext}),vscpp(M1,{documentContext:this.props.documentContext,aboveCells:h,belowCells:g}),vscpp(j1.UserMessage,null,y?vscpp(vscppf,null,d&&vscpp(vscppf,null,"Now I edit a markdown cell in this custom Notebook document at index ",h.length,".",vscpp("br",null)),!d&&vscpp(vscppf,null,"Now I create a new markdown cell in this custom Notebook document at index ",h.length,".",vscpp("br",null)),"This is a markdown cell. Markdown cell is used to describe and document your workflow.",vscpp("br",null),d&&vscpp(vscppf,null,vscpp(Fe,{uri:a.uri,languageId:v.languageId,code:p,shouldTrim:!1}),vscpp("br",null))):vscpp(vscppf,null,d&&vscpp(vscppf,null,"Now I edit a cell in this custom Notebook document at index ",h.length,".",vscpp("br",null)),!d&&vscpp(vscppf,null,"Now I create a new cell in this custom Notebook document at index ",h.length,".",vscpp("br",null)),d&&vscpp(vscppf,null,vscpp(Fe,{uri:a.uri,languageId:v.languageId,code:p,shouldTrim:!1}),vscpp("br",null))))))}};q1=w([b(1,be),b(2,O1),b(3,zt),b(4,wt),b(5,Ve)],q1);var WG=class extends X{render(e,r){if(!rr(this.props.documentContext.document.uri))throw dn("InlineChatJupyterNotebookCellSummaryContextRenderer should be used only with a notebook!");let n=this.props.documentContext.language,o=this.props.executedCells||[];return vscpp(vscppf,null,vscpp(j1.UserMessage,null,"I am working on a Jupyter notebook.",vscpp("br",null),"Users have executed the following cells in this notebook",vscpp("br",null),"Each cell contains a code block started with ```",n.languageId,vscpp("br",null),"Since it is Jupyter Notebook, if a module is already imported in a cell, it can be used in other cells as well.",vscpp("br",null),"For the same reason, if a variable is defined in a cell, it can be used in other cells as well.",vscpp("br",null),"We should not repeat the same import or variable definition in multiple cells, unless we want to overwrite the previous definition.",vscpp("br",null),"Do not generate CELL INDEX in your answer, it is only used to help you understand the context.",vscpp("br",null),vscpp("br",null),"Below you will find a set of examples of what you should respond with. Please follow the exmaples on how to avoid repeating code.",vscpp("br",null),"## Examples starts here",vscpp("br",null),"Here are the executed cells in this Jupyter Notebook:",vscpp("br",null),"```python",vscpp("br",null),"import pandas as pd",vscpp("br",null),vscpp("br",null),"df = pd.DataFrame({'Name': ['Alice', 'Bob', 'Charlie'], 'Age': [25, 30, 35], 'Gender': ['F', 'M', 'M']})",vscpp("br",null),"print(df)",vscpp("br",null),"```",vscpp("br",null),"---------------------------------",vscpp("br",null),"USER:",vscpp("br",null),"Now I create a new cell in this Jupyter Notebook document at index 1.",vscpp("br",null),"USER:",vscpp("br",null),"plot the data frame",vscpp("br",null),vscpp("br",null),"---------------------------------",vscpp("br",null),"ChatGPT Answer",vscpp("br",null),"---------------------------------",vscpp("br",null),"To plot the dataframe, we can use the `plot()` method of pandas dataframe. Here's the code:",vscpp("br",null),vscpp("br",null),"```python",vscpp("br",null),"df.plot(x='Name', y='Age', kind='bar')",vscpp("br",null),"```",vscpp("br",null),"## Example ends here",vscpp("br",null),o.map(s=>vscpp(KG,{cell:s}))))}},KG=class extends X{render(){return vscpp(vscppf,null,"```",this.props.cell.document.languageId,vscpp("br",null),this.props.cell.document.getText(),vscpp("br",null),"```")}};var H1=class extends X{render(){let e=this.props.language;return vscpp(vscppf,null,"You are an AI programming assistant.",vscpp("br",null),'When asked for your name, you must respond with "GitHub Copilot".',vscpp("br",null),"Follow the user's requirements carefully & to the letter.",vscpp("br",null),"The user has a ",e.languageId," file opened in a code editor.",vscpp("br",null),"The user includes some code snippets from the file.",vscpp("br",null),"Each code block starts with ``` and ",hu.forLanguage(e),".",vscpp("br",null),"Answer with a single ",e.languageId," code block.",vscpp("br",null),"If you modify existing code, you will use the ",Ya.begin(e)," and ",Ya.end(e)," markers.")}};var V1=class extends X{constructor(r,n,o){super(r);this.tabsAndEditorsService=n;this.notebookService=o}async prepare(){if(this.tabsAndEditorsService.activeNotebookEditor?.notebook.uri.path!==this.props.documentContext.document.uri.path)return{variables:[],packages:[]};let n=this.tabsAndEditorsService.activeNotebookEditor?.notebook;if(!n)return{variables:[],packages:[]};let o=this.notebookService.getVariables(n.uri),s=Promise.resolve([]),[a,c]=await Promise.all([o,s]);return{variables:a,packages:c}}render(r){let{priorities:n}=this.props;return vscpp(vscppf,null,r.variables.length!==0&&vscpp(vscppf,null,vscpp(Mc.UserMessage,{priority:n.runtimeCore},"The following variables are present in this Jupyter Notebook:",r.variables.map(o=>vscpp(vscppf,null,vscpp(Mc.TextChunk,null,"Name: ",o.variable.name,vscpp("br",null),o.variable.type&&vscpp(vscppf,null,"Type: ",o.variable.type),vscpp("br",null),"Value: ",o.variable.value,vscpp("br",null),o.indexedChildrenCount>0&&vscpp(vscppf,null,"Length: ",o.indexedChildrenCount),vscpp("br",null),o.variable.summary&&vscpp(vscppf,null,"Summary: ",o.variable.summary)))))),r.packages.length!==0&&vscpp(vscppf,null,vscpp(Mc.UserMessage,{priority:n.other},"The following pip packages are available in this Jupyter Notebook:",r.packages.map(o=>vscpp(vscppf,null,vscpp(Mc.TextChunk,null,o.name,"==",o.version),vscpp("br",null))))))}};V1=w([b(1,zt),b(2,O1)],V1);var G1=class extends X{constructor(r,n,o,s){super(r);this.configurationService=n;this.ignoreService=o;this.parserService=s}async prepare(r){let n=this.configurationService.getConfig(de.NotebookAdditionalCodeGenerationRuleEnabled),{documentContext:o}=this.props,s=await this.ignoreService.isCopilotIgnored(o.document.uri),a=o.document.validateRange(o.wholeRange);return{summarizedDocument:await ga(this.parserService,o.document,o.fileIndentInfo,a,r.endpoint.modelMaxPromptTokens/3),isIgnored:s,priorities:UG,additionalCodeGenerationRule:n}}render(r,n){if(!rr(this.props.documentContext.document.uri))throw dn("InlineChatNotebookBasePrompt should be used only with a notebook!");let{query:o,history:s,customInstructions:a}=this.props.promptContext,{language:c}=this.props.documentContext,u=c.languageId!=="markdown",l=Xg(this.props.documentContext.document.uri),d=r.summarizedDocument.splitAroundOriginalSelectionEnd(),{codeAbove:p,hasContent:f,codeBelow:m}=d,h=`${p}$PLACEHOLDER$${m}`,g=d.createReplyInterpreter(Yo.Mute,u?1:0,n.endpoint.model!=="gpt-3.5-turbo"?d.insertStreaming:d.insertOrReplaceStreaming,u?Ai.createCodeBlockClassifier():Ai.createAlwaysInsideCodeBlockClassifier(),_=>_.value.trim()!=="$PLACEHOLDER$"),v=r.priorities,y=r.additionalCodeGenerationRule??!1;return vscpp(vscppf,null,vscpp("meta",{value:new Hn(g)}),vscpp(Mc.SystemMessage,{priority:v.core},vscpp(H1,{language:c}),vscpp("br",null),l&&vscpp(vscppf,null,"When dealing with Jupyter Notebook, if a module is already imported in a cell, it can be used in other cells directly without importing it again. For the same reason, if a variable is defined in a cell, it can be used in other cells as well",vscpp("br",null),"When dealing with Jupyter Notebook, cells below the current cell can be executed before the current cell, you must use the variables defined in the cells below, unless you want to overwrite them.",vscpp("br",null),"When dealing with Jupyter Notebook, do not generate CELL INDEX in the code blocks in your answer, it is only used to help you understand the context.",vscpp("br",null),"If the Jupyter Notebook already contains variables, you should respect the name and value of the variables, and use them in your code when necessary.",vscpp("br",null)),f&&vscpp(vscppf,null,"The user includes existing code and marks with $PLACEHOLDER$ where the new code should go.",vscpp("br",null)),f&&vscpp(vscppf,null,'DO NOT include the text "$PLACEHOLDER$" in your reply.',vscpp("br",null)),f&&vscpp(vscppf,null,"DO NOT repeat any code from the user in your reply.",vscpp("br",null)),!f&&u&&vscpp(vscppf,null,"Your must generate a code block surrounded with ``` that will be used in a new file",vscpp("br",null)),!u&&vscpp(vscppf,null,"When generating content for markdown cell, provide the answer directly without any additional introductory text. Ensure that the response is structured in Markdown format to seamlessly integrate into the markdown file."),vscpp(Rt,null)),vscpp(Ot,{priority:v.history??700,history:s}),vscpp(Mc.UserMessage,{priority:725},vscpp(Or,{customInstructions:a,languageId:c.languageId})),vscpp(q1,{documentContext:this.props.documentContext,hasContent:f,code:h,priority:v.core}),vscpp(V1,{documentContext:this.props.documentContext,priorities:v,query:o}),vscpp(Mc.UserMessage,{priority:v.core},y&&vscpp(vscppf,null,"Please generate code for: "),o,f&&u&&vscpp(vscppf,null,"The code that would fit at $PLACEHOLDER$ with ``` is:"),f&&!u&&vscpp(vscppf,null,"The code that would fit at $PLACEHOLDER$ without ``` is:")))}};G1=w([b(1,be),b(2,ke),b(3,_t)],G1);var z1=class extends X{constructor(r,n,o,s){super(r);this.configurationService=n;this.ignoreService=o;this.parserService=s}async prepare(r){let n=this.configurationService.getConfig(de.NotebookAdditionalCodeGenerationRuleEnabled),{documentContext:o}=this.props,s=await this.ignoreService.isCopilotIgnored(o.document.uri),a=o.document.validateRange(o.wholeRange);return{summarizedDocument:await ga(this.parserService,o.document,o.fileIndentInfo,a,r.endpoint.modelMaxPromptTokens/3),isIgnored:s,priorities:UG,additionalCodeGenerationRule:n}}render(r,n){if(!rr(this.props.documentContext.document.uri))throw dn("InlineChatNotebookEditPrompt should be used only with a notebook!");if(r.isIgnored)return vscpp("ignoredFiles",{value:[this.props.documentContext.document.uri]});let{query:o,history:s,customInstructions:a}=this.props.promptContext,c=Xg(this.props.documentContext.document.uri),{language:u}=this.props.documentContext,l=u.languageId==="markdown",d=r.summarizedDocument.splitAroundAdjustedSelection(),{codeAbove:p,codeSelected:f,codeBelow:m,hasCodeWithoutSelection:h}=d,g=`${p}$SELECTION_PLACEHOLDER$${m}`,v=d.createReplyInterpreter(Yo.Mute,1,d.replaceSelectionStreaming,Ai.createCodeBlockClassifier(),x=>x.value.trim()!=="$SELECTION_PLACEHOLDER$"),y=r.priorities,_=r.additionalCodeGenerationRule??!1;return vscpp(vscppf,null,vscpp("meta",{value:new Hn(v)}),vscpp(Mc.SystemMessage,{priority:y.core},vscpp(vscppf,null,"You are an AI programming assistant.",vscpp("br",null),'When asked for your name, you must respond with "GitHub Copilot".',vscpp("br",null),"You are a world class expert in programming, and especially good at ",u.languageId,".",vscpp("br",null),"Source code is always contained in ``` blocks.",vscpp("br",null),"The user needs help to modify some code.",vscpp("br",null),h&&vscpp(vscppf,null,"The user includes existing code and marks with $SELECTION_PLACEHOLDER$ where the selected code should go.",vscpp("br",null))),c&&vscpp(vscppf,null,"When dealing with Jupyter Notebook, if a module is already imported in a cell, it can be used in other cells directly without importing it again. For the same reason, if a variable is defined in a cell, it can be used in other cells as well",vscpp("br",null),"When dealing with Jupyter Notebook, cells below the current cell can be executed before the current cell, you must use the variables defined in the cells below, unless you want to overwrite them.",vscpp("br",null),"When dealing with Jupyter Notebook, do not generate CELL INDEX in the code blocks in your answer, it is only used to help you understand the context.",vscpp("br",null),"If the Jupyter Notebook already contains variables, you should respect the name and value of the variables, and use them in your code when necessary.",vscpp("br",null)),l&&vscpp(vscppf,null,"When generating content for markdown cell, provide the answer directly without any additional introductory text. Ensure that the response is structured in Markdown format to seamlessly integrate into the markdown file."),h&&vscpp(vscppf,null,"The user includes existing code and marks with $SELECTION_PLACEHOLDER$ where the selected code should go.",vscpp("br",null)),vscpp(Rt,null)),vscpp(B1,{documentContext:this.props.documentContext,hasCodeWithoutSelection:h,codeWithoutSelection:g,codeSelected:f,priority:y.core}),vscpp(Ot,{priority:y.history??700,history:s}),vscpp(Mc.UserMessage,{priority:725},vscpp(Or,{customInstructions:a,languageId:u.languageId})),vscpp(V1,{documentContext:this.props.documentContext,priority:y.core,priorities:y,query:o}),vscpp(Mc.UserMessage,{priority:y.core},_&&vscpp(vscppf,null,"Please edit code for: "),o,vscpp("br",null),h&&l&&vscpp(vscppf,null,"The modified $SELECTION_PLACEHOLDER$ code without ``` is:"),h&&!l&&vscpp(vscppf,null,"The modified $SELECTION_PLACEHOLDER$ code with ``` is:")))}};z1=w([b(1,be),b(2,ke),b(3,_t)],z1);var tp=class{constructor(e,r,n,o,s,a){this.intent=e;this.location=r;this.endpoint=n;this.documentContext=o;this.editStrategy=s;this.instantiationService=a;this.replyInterpreter=null}async buildPrompt(e,r,n){let o;rr(this.documentContext.document.uri)?o=this.editStrategy===4?G1:z1:this.documentContext.document.languageId==="markdown"?o=this.editStrategy===4?D1:N1:o=this.editStrategy===4?L1:A1;let s=Be.create(this.instantiationService,this.endpoint,o,{documentContext:this.documentContext,promptContext:e}),a=await s.render(r,n);return this.replyInterpreter=s.getMeta(Hn)?.replyInterpreter??null,a}processResponseInline(e,r,n){if(!this.replyInterpreter)throw new Error("Could not process response without a reply interpreter!");return this.replyInterpreter.processResponse(e,r,n)}};tp=w([b(5,K)],tp);var xu=class{constructor(e,r){this.instantiationService=e;this.endpointProvider=r;this.id=xu.ID;this.description=Bde.t("Make changes to existing code");this.locations=[1];this.commandInfo={hiddenFromUser:!0}}static{this.ID="edit"}get intentDetectionInput(){let e="edit_text";return{functionName:e,sampleQuestion:"Change this method to use async/await",modelDescription:"Make changes to existing code",functionCallingBlurb:`If the user's message appears related to refactoring or changing existing code, such as the code in the active selection, you should use the '${e}' function.`}}async invoke(e){let{location:r,documentContext:n}=e;if(!n)throw new Error("Open a file to add code.");let o=await this.endpointProvider.getEndpointForLocation(r);return this.instantiationService.createInstance(tp,this,r,o,n,2)}};xu=w([b(0,K),b(1,Se)],xu);var qde=H(Gt());var Su=class{constructor(e,r){this.instantiationService=e;this.endpointProvider=r;this.id=Su.ID;this.description=qde.t("Generate new code");this.locations=[1];this.commandInfo={hiddenFromUser:!0}}static{this.ID="generate"}get intentDetectionInput(){let e="generate_code_or_markdown";return{functionName:e,sampleQuestion:"Add a function that returns the sum of two numbers",modelDescription:"Generate new code",functionCallingBlurb:`If the user's message appears related to generating new code, you should use the '${e}' function.`}}async invoke(e){let{location:r,documentContext:n}=e;if(!n)throw new Error("Open a file to add code.");let o=await this.endpointProvider.getEndpointForLocation(r);return this.instantiationService.createInstance(tp,this,r,o,n,4)}};Su=w([b(0,K),b(1,Se)],Su);var Zg=class extends Ho{constructor(r,n,o,s=Dg,a,c){super(r,n,o);this.prompt=s;this.documentContext=a;this.instantiationService=c}createRenderer(r,n,o,s){return Be.create(this.instantiationService,n,this.prompt,{documentContext:this.documentContext,endpoint:n,promptContext:r})}};Zg=w([b(5,K)],Zg);var ba=class{constructor(e,r){this.instantiationService=e;this.endpointProvider=r;this.id=ba.ID;this.locations=[1,2];this.description="Intent of this command is unclear or is not related to information technologies";this.commandInfo={hiddenFromUser:!0};this.intentDetectionInput={sampleQuestion:"Add a dog to this comment."}}static{this.ID="unknown"}async invoke(e){let{location:r,documentContext:n}=e,o=await this.endpointProvider.getEndpointForLocation(r);if(r===1){if(!n)throw new Error("Open a file to add code.");return this.instantiationService.createInstance(tp,this,r,o,n,2)}return this.instantiationService.createInstance(Zg,this,r,o,void 0,n)}};ba=w([b(0,K),b(1,Se)],ba);var ev="_github.copilot.openRelativePath",$1="_github.copilot.openSymbolInFile",m3=[ev,$1,"_github.copilot.openSymbolFromReferences"];function rp(t,e){return`command:${t}?${encodeURIComponent(JSON.stringify(e))}`}function h3(t,e,r){let n=t;n.startsWith("`")||(n=n.replace(/(?<!\\)\[/g,"\\[").replace(/(?<!\\)\]/g,"\\]"));let o=e.replace(/(?<!\\)\(/g,"\\(").replace(/(?<!\\)\)/g,"\\)");return`[${n}](${o} "${L7e(r)}")`}function L7e(t){return t.replace(/"/g,'\\"')}var W1=class{constructor(e,r){this.fileSystem=e;this.workspaceService=r}async linkify(e,r,n){let o=this.workspaceService.getWorkspaceFolders(),s=0,a=async(c,u,l)=>{if(/^[\w\-_]+:/.test(l)||!o.length||l.length<2)return c;for(let f of o){let m=Gr.joinPath(f,l);if(await this.exists(m))return s++,g3(l,m,r.requestId)}let d=oL(l),p=r.references.map(f=>"variableName"in f.anchor?PR(f.anchor.value)?f.anchor.value:f.anchor.value?.uri:PR(f.anchor)?f.anchor:f.anchor.uri).filter(f=>!!f).find(f=>ou(f)===d);return p?(s++,g3(l,p,r.requestId)):u};return e=await zb(e,/\[(`?)([^`\s]+)\1\]\((\2)\)/g,(c,u,l,d)=>a(c,l,d)),n?.isCancellationRequested?{text:e,addedLinkCount:0}:(e=await zb(e,/(?<!\[)(`([^`\s]+)`)(?!\])/g,a),{text:e,trustedCommands:[ev],addedLinkCount:s})}async exists(e){try{return await this.fileSystem.stat(e),!0}catch{return!1}}};W1=w([b(0,hr),b(1,Ve)],W1);function g3(t,e,r){return h3("`"+t+"`",rp(ev,[Jk(e),r]),e.fsPath)}function Jk(t){return{scheme:t.scheme,authority:t.authority,path:t.path,query:t.query,fragment:t.fragment}}var Bl;(s=>{let t;(l=>(l[l.Default=0]="Default",l[l.CodeBlock=1]="CodeBlock",l[l.Accumulating=2]="Accumulating"))(t=s.Type||={});let e;(l=>(l[l.Word=0]="Word",l[l.InlineCode=1]="InlineCode",l[l.PotentialLink=2]="PotentialLink"))(e=s.AccumulationType||={}),s.Default={type:0};class n{constructor(c,u,l=""){this.fence=c;this.indent=u;this.contents=l;this.type=1}appendContents(c){return new n(this.fence,this.indent,this.contents+c)}}s.CodeBlock=n;class o{constructor(c,u=0){this.pendingText=c;this.accumulationType=u;this.type=2}}s.Accumulating=o})(Bl||={});var v3=class{constructor(e,r=[]){this.context=e;this.linkifiers=r;this._state=Bl.Default;this._appliedText="";this._totalAddedLinkCount=0}get totalAddedLinkCount(){return this._totalAddedLinkCount}async append(e,r){let n={text:"",trustedCommands:m3,addedLinkCount:0};for(let o of e.split(/(\s+)/))if(o.length)switch(this._state.type){case 0:{let s=o.match(/(^|\n)\s*(`{3,}|~{3,})/);if(s){let a=this._appliedText.match(/(\n|^)([ \t]*)$/);this._state=new Bl.CodeBlock(s[2],a?.[2]??""),n=K1(n,this.doAppend(o))}else if(/\s/.test(o)){let a=await this.doLinkifyAndAppend(o,r);n=K1(n,a)}else if(/^\s*\[.+\]\(.+\)\s*/.test(o)){let a=await this.doLinkifyAndAppend(o,r);n=K1(n,a)}else/^[^\[]*`[^`]*$/.test(o)?this._state=new Bl.Accumulating(o,1):/^\s*\[[^\]]+$/.test(o)?this._state=new Bl.Accumulating(o,2):this._state=new Bl.Accumulating(o);break}case 1:{if(new RegExp("(^|\\n)"+this._state.fence+"($|\\n)").test(o)||this._state.contents.length>2&&new RegExp("(^|\\n)\\s*"+this._state.fence+"($|\\n\\s*$)").test(this._appliedText+o)){let s=this._appliedText.match(/(\n|^)([ \t]*)[`~]*$/);if(s&&s[2].length<=this._state.indent.length){this._state=Bl.Default,n=K1(n,this.doAppend(o));break}}this._state=this._state.appendContents(o),n=K1(n,this.doAppend(o));break}case 2:{let s=async a=>{let c=a.pendingText+o;this._state=Bl.Default;let u=await this.doLinkifyAndAppend(c,r);n=K1(n,u)};if(this._state.accumulationType===2){if(/]/.test(o)){this._state=new Bl.Accumulating(this._state.pendingText+o,0);break}else if(/\n/.test(o)){await s(this._state);break}}else if(this._state.accumulationType===1&&/`/.test(o)){await s(this._state);break}else if(this._state.accumulationType===0&&/\s/.test(o)){await s(this._state);break}this._state=new Bl.Accumulating(this._state.pendingText+o,this._state.accumulationType);break}}return n}async flush(e){if(this._state.type===2){let r=this._state.pendingText;return this._state=Bl.Default,this.doLinkifyAndAppend(r,e)}}doAppend(e){return this._appliedText=this._appliedText+e,{text:e,trustedCommands:m3,addedLinkCount:0}}async doLinkifyAndAppend(e,r){this.doAppend(e);let n=new Set(m3),o=0;for(let s of this.linkifiers){let a=await s.linkify(e,this.context,r);if(r?.isCancellationRequested)return{text:e,addedLinkCount:0};if(a){e=a.text,o+=a.addedLinkCount;for(let c of a.trustedCommands??[])n.add(c)}}return e=e.replace(/\[([^\[\]]+)]\(([^\s\)]+)\)/g,(s,a,c)=>/^\w+:/.test(c)?s:a),this._totalAddedLinkCount+=o,{text:e,trustedCommands:Array.from(n),addedLinkCount:o}}};function K1(t,e){return{text:t.text+e.text,trustedCommands:Array.from(new Set([...t.trustedCommands??[],...e.trustedCommands??[]])),addedLinkCount:t.addedLinkCount+e.addedLinkCount}}var Y1=class{constructor(e,r){this.fileSystem=e;this.workspaceService=r}async linkify(e,r,n){let o=this.workspaceService.getWorkspaceFolders(),s=0;if(e=await zb(e,/\[`([^`\[\]]+?)`]\((\S+?\.\w+)\)/g,async(a,c,u)=>{for(let l of o){let d=Gr.joinPath(l,u);if(await this.exists(d))return s++,O7e(d,c,r.requestId)}return"`"+c+"`"}),!(!s||n.isCancellationRequested))return{text:e,trustedCommands:[$1],addedLinkCount:s}}async exists(e){try{return await this.fileSystem.stat(e),!0}catch{return!1}}};Y1=w([b(0,hr),b(1,Ve)],Y1);function O7e(t,e,r){return h3("`"+e+"`",rp($1,[Jk(t),e,r]),t.fsPath)}var X1=ie("ILinkifyService"),Q1=class{constructor(e,r){this.globalLinkifiers=new Set;this.registerGlobalLinkifier({create:()=>new W1(e,r)}),this.registerGlobalLinkifier({create:()=>new Y1(e,r)})}registerGlobalLinkifier(e){if(this.globalLinkifiers.has(e))throw new Error("Linkifier already registered");return this.globalLinkifiers.add(e),{dispose:()=>this.globalLinkifiers.delete(e)}}createLinkifier(e,r){return new v3(e,[...r,...this.globalLinkifiers].map(n=>n.create()))}};Q1=w([b(0,hr),b(1,Ve)],Q1);var um=class{constructor(e,r,n,o,s){this.sequencer=Promise.resolve();this._linkifier=s.createLinkifier(e,n),this._progress=r,this._token=o}get totalAddedLinkCount(){return this._linkifier.totalAddedLinkCount}markdown(e){return this.appendMarkdown(typeof e=="string"?new us(e):e),this}anchor(e,r){return this.enqueue(()=>this._progress.anchor(e,r)),this}button(e){return this.enqueue(()=>this._progress.button(e)),this}filetree(e,r){return this.enqueue(()=>this._progress.filetree(e,r)),this}progress(e){return this.enqueue(()=>this._progress.progress(e)),this}warning(e){return this.enqueue(()=>this._progress.warning(e)),this}reference(e){return this.enqueue(()=>this._progress.reference(e)),this}reference2(e){return this.enqueue(()=>this._progress.reference(e)),this}codeCitation(e,r,n){return this.enqueue(()=>this._progress.codeCitation(e,r,n)),this}push(e){return e instanceof ls?this.appendMarkdown(e.value):this.enqueue(()=>this._progress.push(e)),this}textEdit(e,r){return this.enqueue(()=>this._progress.textEdit(e,r)),this}markdownWithVulnerabilities(e,r){return this.enqueue(()=>this._progress.markdownWithVulnerabilities(e,r)),this}detectedParticipant(e,r){return this.enqueue(()=>this._progress.detectedParticipant(e,r)),this}confirmation(e,r,n){return this.enqueue(()=>this._progress.confirmation(e,r,n)),this}enqueue(e,r=!0){return r&&(this.sequencer=this.sequencer.then(()=>this.doFinalize())),this.sequencer=this.sequencer.then(e),this.sequencer}async appendMarkdown(e){this.enqueue(async()=>{await this.doApplyText(e.value)},!1)}async finalize(){await this.enqueue(()=>this.doFinalize(),!1)}async doFinalize(){let e=await this._linkifier.flush(this._token);this._token.isCancellationRequested||e&&this.outputMarkdown(e)}async doApplyText(e){if(!e)return;let r=await this._linkifier.append(e,this._token);this._token.isCancellationRequested||r&&this.outputMarkdown(r)}outputMarkdown(e){if(!e.text)return;let r=new us(e.text);r.isTrusted={enabledCommands:e.trustedCommands??[]},this._progress.markdown(r)}};um=w([b(4,X1)],um);var M7e=3,F7e=3,U7e=1;function J1(t,e){let r=0;for(let n of e)r+=B7e(t,n);return r+=M7e,r}function B7e(t,e){let r=F7e;for(let[n,o]of Object.entries(e))o&&(r+=t.tokenLength(o),n==="name"&&(r+=U7e));return r}var Z1=ie("IFeedbackReporter");var b3={top_p:1,temperature:.1};var Vs=class t{constructor(e){this._source=e;this._variables=null}_getVariables(){if(!this._variables){this._variables=[];for(let e=0;e<this._source.length;e++){let r=this._source[e];if(r.value){let n=r.name,o=this.uniqueFileName(n,this._source.slice(0,e));this._variables.push({originalName:n,uniqueName:o,value:r.value,range:r.range})}}}return this._variables}reverse(){let e=this._source.slice(0);return e.reverse(),new t(e)}find(e){return this._getVariables().find(e)}*[Symbol.iterator](){yield*this._getVariables()}substituteVariablesWithReferences(e){let r=[];for(let n of this._getVariables())n.range&&r.push({start:n.range[0],end:n.range[1],newText:`[#${n.uniqueName}](#${n.uniqueName}-context)`});r.sort((n,o)=>o.end-n.end);for(let n of r)e=e.slice(0,n.start)+n.newText+e.slice(n.end);return e}hasVariables(){return this._getVariables().length>0}uniqueFileName(e,r){let n=r.filter(o=>o.name===e).length;return n===0?e:`${e}-${n}`}};var iv=H(nt());var Iu=ie("ITestProvider");var ql=H(Gt());function jde(t){let e=(o,s,a)=>{let c="",u=a?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ";if(s===1?c=`${u}${o.name}
`:s>1&&(c=`|   ${"    ".repeat(s-2)}${u}${o.name}
`),o.children){let l=o.children.length-1;o.children.forEach((d,p)=>{c+=e(d,s+1,p===l)})}return c},r=`${t.baseUri.path.replace("/","")}
`,n=t.value.length-1;return t.value.forEach((o,s)=>{r+=e(o,1,s===n)}),`\`\`\`filetree
${r}\`\`\`
`}var tv=ie("IConversationStore"),y3=class{constructor(){this.conversationMap=new Map}addConversation(e,r){this.conversationMap.set(e,r)}getConversation(e){return this.conversationMap.get(e)}};var Hde=H(nt());var _3=class extends X{render(e,r){let{query:n}=this.props.promptContext;return vscpp(vscppf,null,vscpp(Hde.SystemMessage,{priority:1e3},"You are an AI pair programmer helping a developer to clarify their prompt for another AI code assistant, integrated into Visual Studio Code. You are not answering the developer's prompts, but collaborate with them to better understand their intent, context and goal. Stay focussed, succinct and to the point.",vscpp("br",null),vscpp("br",null),vscpp(Br,null),vscpp(Rt,null),vscpp("br",null),vscpp(bu,{location:2,endpoint:this.props.endpoint}),vscpp("br",null),"## First, think step-by-step:",vscpp("br",null),"1. Analyze the prompt and the optionally provided active code selection for what the developer might be asking. Keep your capabilities in mind.",vscpp("br",null),"2. As first part of your response, rephrase the prompt back to the developer with any explicit and implicit assumptions, included and missing context, and your capabilities. Paragraph with with maximum 50 words.",vscpp("br",null),"3. Finally, last paragraph with maximum 50 words: Request specifics about the missing context of their prompt. Include constructive feedback for how to add context (add specifics, using the knowledge base excerpt below).",vscpp("br",null),vscpp("br",null),"## Knowledge base: How to add context",vscpp("br",null),"- Selecting code will explicitly include it as context.",vscpp("br",null),"- Use the attachement button in the chat input to add specific files.",vscpp("br",null),"- Start the prompt with `@workspace` to refer to the entire codebase.",vscpp("br",null),"- Use commands for specific tasks, like `/fix` for debugging and fixing code issues, `/explain` to explain code, and `/tests` for writing tests.",vscpp("br",null),"- Mention context variables to the prompt: `#terminalLastCommand` for terminal output.",vscpp("br",null),vscpp("br",null),"## Rules",vscpp("br",null),"- Minimize any other prose.",vscpp("br",null),vscpp("br",null),"Take a deep breath. Do each step one by one.",vscpp(Xt,null)),vscpp(zr,{flexGrow:1,document:this.props.documentContext?.document,range:this.props.documentContext?.selection,priority:800}),vscpp(Jr,{flexGrow:2,priority:900,chatVariables:new Vs([]),query:n}))}};var eI=class extends Ho{constructor(r,n,o,s,a){super(r,n,o);this.documentContext=s;this.instantiationService=a}async followUps(r){let n=[],o="is my context";if(r.chatMessages){let s=r.chatMessages.filter(a=>a.role==="user");s.length>0&&(o=s[s.length-1].content)}return n.push({prompt:`@workspace ${o}`,label:"Find related @workspace code"}),n.push({prompt:`#selected ${o}`,label:"Use my #selected code"}),Promise.resolve(n)}createRenderer(r,n,o,s){return Be.create(this.instantiationService,n,_3,{documentContext:this.documentContext,promptContext:r,endpoint:n})}};eI=w([b(4,K)],eI);var rv=class{constructor(e,r){this.instantiationService=e;this.endpointProvider=r;this.id=rv.ID;this.locations=[2];this.description="Clarify unclear prompt for the user.";this.commandInfo={hiddenFromUser:!0};this.intentDetectionInput={sampleQuestion:"How can I ask this question better?"}}static{this.ID="clarify"}async invoke(e){let{location:r,documentContext:n}=e,o=await this.endpointProvider.getChatEndpoint("gpt-4");return this.instantiationService.createInstance(eI,this,r,o,n)}};rv=w([b(0,K),b(1,Se)],rv);var Zk;(e=>{function t(r,n){let{options:o,document:s,selection:a,visibleRanges:c}=r,u={insertSpaces:o.insertSpaces,tabSize:o.tabSize},l=Ko(s);return n||(c.length===1?n=c[0]:c.length>1?n=c[0].union(c[c.length-1]):n=a),{document:s,fileIndentInfo:u,language:l,selection:a,wholeRange:n}}e.fromEditor=t})(Zk||={});var eP=H(nt());var tI=class{constructor(e,r,n,o,s){this.telemetryService=e;this.options=r;this.endpointProvider=n;this.instantiationService=o;this.chatMLFetcher=s}async evaluate(e,r,n,o){let s=await this.endpointProvider.getChatEndpoint("gpt-3.5-turbo"),a=Be.create(this.instantiationService,s,YG,{userQuestion:r,documentContext:e}),{messages:c}=await a.render(void 0,o),u=await this.chatMLFetcher.fetchMany("promptEval",c,void 0,o,2,s,{agent:n},{temperature:this.options.temperature,top_p:this.options.topP,stop:["\n```"],n:2},{messageSource:"chat.promptEval.meta"}),l=this.handleResult(u,r);return this.telemetryService.sendMSFTTelemetryEvent("promptEval",{},{requestContext:l?.requestContext,requirementsClarification:l?.requirementsClarification,taskDecomposition:l?.taskDecomposition}),this.telemetryService.sendInternalMSFTTelemetryEvent("promptEval",{request:r,response:u.type==="success"?u.value.join(`
`):void 0},{requestContext:l?.requestContext,requirementsClarification:l?.requirementsClarification,taskDecomposition:l?.taskDecomposition}),l}handleResult(e,r){if(e.type!=="success")return;let n=e.value.map(s=>{let a={requestContext:/requestContext:\s*(\d+)\s*/,requirementsClarification:/requirementsClarification:\s*(\d+)\s*/,taskDecomposition:/taskDecomposition:\s*(\d+)\s*/},c={requestContext:void 0,requirementsClarification:void 0,taskDecomposition:void 0};for(let u in c){let l=a[u].exec(s);l&&l.length===2&&(c[u]=parseInt(l[1],10)||void 0)}return c}).filter(s=>s!==void 0),o={requestContext:void 0,requirementsClarification:void 0,taskDecomposition:void 0};for(let s in o){let a=n.map(c=>c[s]||void 0).filter(c=>c!==void 0);o[s]=a.reduce((c,u)=>c+u,0)/a.length}return o}};tI=w([b(0,he),b(1,Rr),b(2,Se),b(3,K),b(4,Ct)],tI);var YG=class extends X{render(){let{userQuestion:e,documentContext:r}=this.props;return vscpp(vscppf,null,vscpp(eP.SystemMessage,{priority:1e3},"You are a helpful developer support expert in reviewing the prompts that a developer is sending to an AI coding assistant. Your ratings will be used to follow up with the developer on clarifying their prompt. For context, the developer queries this AI coding assistant inside Visual Studio Code for general questions, coding, debugging, and other software development tasks. The AI coding assistant will not get any more details when it needs to generate a response to the prompt. The AI coding assistant has the same software development knowledge that you have access to, which might be affected by knowledge cutoffs and niche domains.",vscpp("br",null),vscpp("br",null),"Rate how important different follow-ups are to clarify the given prompt, enabling the AI pair programmer to give more precise and useful responses. Rate each 1 (LEAST important) to 5 (MOST important):",vscpp("br",null),vscpp("br",null),"- **Request Context**: If the prompt references code, symbols, data, files, terminal output, or other parts of the development environment that are not in the prompt, follow-up would ask to attach those references to the prompt. Less critical for general coding questions, but most critical when the prompt references context that is missing.",vscpp("br",null),"- **Requirements Clarification**: If the prompt is too vague or general, follow-up questions help narrow down the specific information, preferences, and constraints. Less critical for general coding questions, more critical when the prompt involves specific coding requirements.",vscpp("br",null),"- **Task Decomposition**: If the prompt involves a complex task, follow-up breaks it down into smaller, more manageable steps so the developer can provide feedback and work through them one by one. Doesn't apply to general questions but is most important for multi-step coding tasks.",vscpp("br",null),vscpp("br",null),"Summarize your rating with a markdown codeblock:",vscpp("br",null),vscpp(Fe,{uri:null,languageId:"markdown",code:`- requestContext: int
- requirementsClarification: int
- taskDecomposition: int`}),vscpp("br",null),vscpp("br",null),"You will be provided with the prompt and context, then asked to rate the follow-up."),vscpp(eP.UserMessage,{priority:900},"# Developer Prompt",vscpp("br",null),e),r&&vscpp(zr,{document:r?.document,range:r?.selection}),vscpp(eP.UserMessage,{priority:1e3},"Rating:",vscpp("br",null),"```md",vscpp("br",null)))}};var Vde=H(Gt());var nv=class{constructor(e,r,n,o){this.stopStartMappings=e;this.processNonReportedDelta=r;this.experimentationService=n;this.configurationService=o;this.stagedDeltasToApply=[];this.currentStartStop=void 0;this._appliedText="";this.nonReportedDeltas=[];this._enableSnippyAnnotations=!1}async processResponse(e,r,n,o,s){return this._enableSnippyAnnotations=this.configurationService.getExperimentBasedConfig(de.ShowCodeMatches,this.experimentationService),this.doProcessResponse(n,o,s)}async doProcessResponse(e,r,n){for await(let{delta:o}of e){if(n.isCancellationRequested)break;this.applyDelta(o,r)}return this._appliedText}applyDeltaToProgress(e,r){let n=e.ipCitations;n?.length&&this._enableSnippyAnnotations&&n.forEach(s=>{let a=s.citations.license==="NOASSERTION"?Vde.t("unknown"):s.citations.license;r.codeCitation(Ye.parse(s.citations.url),a,s.citations.snippet)});let o=e.codeVulnAnnotations?.map(s=>({title:s.details.type,description:s.details.description}));o?.length?r.markdownWithVulnerabilities(e.text??"",o):e.text&&r.markdown(e.text)}updateStagedDeltasUpToIndex(e,r){let n=[];for(let o=0;o<e+r;){let s=this.stagedDeltasToApply.shift();if(s){if(o+s.text.length<=e)n.push(s);else if(o<e||o<e+r){if(o<e){let c={...s};c.text=s.text.substring(0,e-o),n.push(c)}let a={...s};a.text=s.text.substring(e-o+r),a.text&&this.stagedDeltasToApply.unshift(a)}o+=s.text.length}else break}return n}checkForKeyWords(e,r,n){let o=this.stagedDeltasToApply.map(s=>s.text).join("")+r.text;for(let s of e){let a=o.indexOf(s);if(a===-1)continue;return this.stagedDeltasToApply.push(r),this.updateStagedDeltasUpToIndex(a,s.length).forEach(u=>n(u)),s}for(let s of e)for(let a=s.length-1;a>0;a--){let c=s.substring(0,a);if(o.endsWith(c)){this.stagedDeltasToApply=[...this.stagedDeltasToApply,r];return}}[...this.stagedDeltasToApply,r].forEach(s=>{n(s)}),this.stagedDeltasToApply=[]}postReportRecordProgress(e){this.nonReportedDeltas.push(e)}applyDelta(e,r){if(this._appliedText+=e.text,this.currentStartStop===void 0){let n=this.checkForKeyWords(this.stopStartMappings.map(o=>o.stop),e,o=>this.applyDeltaToProgress(o,r));n&&(this.currentStartStop=this.stopStartMappings.find(o=>o.stop===n));return}else{if(!this.currentStartStop.start)return;this.checkForKeyWords([this.currentStartStop.start],e,this.postReportRecordProgress.bind(this))&&(this.processNonReportedDelta&&this.processNonReportedDelta(this.nonReportedDeltas).forEach(s=>this.applyDeltaToProgress({text:s},r)),this.currentStartStop=void 0,this.stagedDeltasToApply.length>0&&this.applyDelta({text:""},r))}}};nv=w([b(2,wt),b(3,be)],nv);var tP={errorDetails:{message:ql.t("Cancelled")}},rI=class{constructor(e,r,n,o,s,a,c,u,l,d,p,f,m,h,g,v,y,_,x,S,I){this.request=r;this.token=o;this.chatAgentArgs=s;this._instantiationService=a;this.options=c;this._telemetryService=u;this._configurationService=l;this._experimentationService=d;this._commandService=p;this._intentService=f;this._conversationStore=m;this._tabsAndEditorsService=h;this._logService=v;this._ignoreService=y;this._chatMLFetcher=_;this._tokenizerProvider=x;this._customInstructionsService=S;this._surveyService=I;this.intentDetector=g.createInstance(np,2),this.promptEval=this._instantiationService.createInstance(tI),this.conversation=new Md,this.initHistory(e),this.turn=this.newTurn(this.request),this.baseUserTelemetry=T1(),this.baseUserTelemetry.markAsDisplayed(),this.turn.userMessageId=this.baseUserTelemetry.properties.messageId,this.stream=n}initHistory(e){let r=rP(this.conversation,e,this._commandService);r?this._sessionId=r:this._sessionId||(this._sessionId=_r())}async getResult(){this._logService.public.trace("Panel chat request received from extension host");try{let e=await this._provideResponseWithProgress(),r=await this.turn.intentInvocation?.commands?.(this.turn);return r&&r.forEach(n=>this.stream.button(n)),this.sendResponseTelemetry(),this._conversationStore.addConversation(this.turn.requestId,this.conversation),{...e,metadata:{modelMessageId:this.turn.modelMessageId??"",responseId:this.turn.requestId,sessionId:this._sessionId,agentId:this.chatAgentArgs.agentId,command:this.request.command}}}catch(e){throw e}}sendResponseTelemetry(){this._telemetryService.sendInternalMSFTTelemetryEvent("interactiveSessionResponse",{chatLocation:"panel",intent:this.turn.intentInvocation?.intent.id??"",isParticipantDetected:String(this.request.isParticipantDetected),request:this.request.prompt,response:this.turn.response?.message??"",sessionId:this._sessionId},{turnNumber:this.conversation.turns.length})}newTurn(e){let r={message:e.prompt,type:"user"},n=new Bf(r,this._sessionId);return this.conversation.addTurn(n),n}checkCancellation(){return this.token.isCancellationRequested?(this.turn.status="cancelled",!0):!1}async _provideResponseWithProgress(){if(this.checkCancellation())return tP;try{let e=this._tabsAndEditorsService.activeTextEditor,r=this.turn.request.message,n=this.chatAgentArgs.intentId?this._commandService.getCommand(this.chatAgentArgs.intentId,2):void 0,o=this.checkCommandUsage(n,r);if(o)return o;let s=n?.intent;s&&(this.turn.request={message:r||s.intentDetectionInput.sampleQuestion,type:"user"});let a=e?Zk.fromEditor(e):void 0;if(!s&&!this.request.command&&!this.request.references.length&&!this.request.toolReferences.length&&this.conversation.turns.length===1&&await this.shouldDoClarifyIntent(a,r,this.chatAgentArgs.agentName)){if(this.checkCancellation())return tP;s=this._intentService.getIntent(rv.ID,2)}let c=this.request.references??this.request.variables,u=new Vs(c),l=this.conversation.turns.slice(0,-1);this._logService.public.trace("Processing panel chat intent"),this.request.isParticipantDetected||this.intentDetector.collectIntentDetectionContextInternal(r,this.request.enableCommandDetection?s?.id??"unknown":"none",u,l,e?.document),s??=this._intentService.unknownIntent;let d=await s.invoke({location:2,documentContext:a,request:this.request});if(this.checkCancellation())return tP;this._logService.public.trace("Processed panel chat intent"),this.turn.intentInvocation=d,this.request=await this.sanitizeVariables();let p=d.endpoint,f=await this.handleConfirmationsIfNeeded();if(f)return f;let m,h,g=!1,v,y,_={query:this.turn.request.message,history:l,chatVariables:u,customInstructions:await this._customInstructionsService.fetchInstructions(),toolReferences:this.request.toolReferences};try{({messages:m,tokenCount:h,hasIgnoredFiles:g,references:v,omittedReferences:y}=await this.buildPrompt(d,_,this.stream,this.token));let[R,B]=[v,y].map(V=>V.reduce((M,le)=>("variableName"in le.anchor&&M.add(le.anchor.variableName),M),new Set));for(let V of v){let M=V.options??("variableName"in V.anchor&&B.has(V.anchor.variableName)?{status:{kind:2,description:ql.t("Part of this attachment was not sent to the model due to context window limitations.")}}:void 0);this.stream.reference2(V.anchor,void 0,M)}for(let V of y)"variableName"in V.anchor&&!R.has(V.anchor.variableName)&&this.stream.reference2(V.anchor,void 0,{status:{kind:3,description:ql.t("This attachment was not sent to the model due to context window limitations.")}});this.turn.addReferences(v)}catch(R){if(Af(R))return tP;throw R}if(this.checkCancellation())return tP;if(m.length===0)return{};this._logService.public.trace("Built panel chat prompt");let x=this.conversation.getLatestTurn()?.contextParts.map(R=>R.kind)??[];this._telemetryService.sendInternalMSFTTelemetryEvent("interactiveSessionMessage",{intent:s?.id??"none",isParticipantDetected:String(this.request.isParticipantDetected),detectedIntent:this.request.enableCommandDetection?s?.id:"none",contextTypes:x.join(","),query:r},{}),this.turn.chatMessages=m,this.fixMessageNames(s,m),this.baseUserTelemetry=o3(this.conversation,this._sessionId,"conversationPanel",r,h,s?.id,this.baseUserTelemetry);let S=this._instantiationService,I=new class{processResponse(R,B,V,M,le){return typeof d.processResponsePanel=="function"?d.processResponsePanel(R,B,V,M,le):S.createInstance(nv,[{stop:"[COMMANDS START]"}],void 0).processResponse(R,B,V,M,le)}};this._logService.public.trace("Sending panel chat prompt to model");let E=await this.fetchConversationResponse(p,r,m,I,_,d.linkification,{messageId:this.baseUserTelemetry.properties.messageId,messageSource:s?.id&&s.id!==ba.ID?`chat.${s.id}`:"chat.user"});return g&&this.stream.markdown(ql.t(_L)),E}catch(e){this._logService.public.error(e),this._telemetryService.sendGHTelemetryException(e,"Error");let r=e.message;return this.turn.status="error",this.turn.response={message:r,type:"meta"},{errorDetails:{message:r}}}}async buildPrompt(e,r,n,o){let s={report(a){n.push(a)}};return await e.buildPrompt(r,s,o)}checkCommandUsage(e,r){if(e?.intent&&!(e.intent.commandInfo?.allowsEmptyArgs??!0)&&!r){let n=T4(e.intent.id),o="";return n&&(o=`@${n.agent} `,n.command&&(o+=` /${n.command}`),o+=` ${e.details}`),this.turn.response={message:ql.t(`Please specify a question when using this command.

Usage: {0}`,o),type:"meta"},this.turn.status="error",{errorDetails:{message:this.turn.response.message,responseIsFiltered:!1}}}}async handleConfirmationsIfNeeded(){if((this.request.acceptedConfirmationData?.length||this.request.rejectedConfirmationData?.length)&&this.turn.intentInvocation.confirmationHandler)return await this.turn.intentInvocation.confirmationHandler(this.request.acceptedConfirmationData,this.request.rejectedConfirmationData,this.stream),{}}async shouldDoClarifyIntent(e,r,n){if(this._configurationService.getExperimentBasedConfig(de.ConversationPromptEval,this._experimentationService)){let s=this.promptEval.evaluate(e,r,n,this.token),a={requestContext:this._configurationService.getExperimentBasedConfig(de.ConversationPromptEvalRequestContext,this._experimentationService)};if(a.requestContext!==void 0){let c=await s;if(c?.requestContext&&c.requestContext>=a.requestContext)return!0}}return!1}async sanitizeVariables(){let e=this.request.references.map(async n=>{let o=!1;return n.value instanceof Gr&&(o=await this._ignoreService.isCopilotIgnored(n.value)),o&&n.range&&(this.turn.request.message=this.turn.request.message.slice(0,n.range[0])+this.turn.request.message.slice(n.range[1])),o?null:n}),r=Nr(await Promise.all(e));return{...this.request,references:r}}fixMessageNames(e,r){let n=this._configurationService.getConfig(de.UseMessageNames);r.forEach(o=>{n?o.role!=="system"&&"name"in o&&o.name===e?.id&&(o.name=void 0):"name"in o&&(o.name=void 0)})}async fetchConversationResponse(e,r,n,o,s,a,c){let u=T1();this.turn.requestId=this.baseUserTelemetry.properties.messageId,this.turn.modelMessageId=u.properties.messageId;let l=Date.now(),d=0,p=new XS,f=a?.disable?this.stream:this._instantiationService.createInstance(um,{requestId:this.turn.requestId,references:this.turn.references},this.stream,a?.additionaLinkifiers??[],this.token),m=o.processResponse(this.turn,n,p.stream,f,this.token),h=!1;m.finally(()=>{h=!0});let g=await this._chatMLFetcher.fetchOne("chatParticipantRequestHandler",n,async(R,B,V)=>(d===0&&(d=Date.now()),p.update(R,V),h?R.length:void 0),this.token,2,e,{agent:this.chatAgentArgs.agentName},{temperature:this.options.temperature,top_p:this.options.topP},c,{intent:!0});p.resolve();let v=await m,y=0;f instanceof um&&(await f.finalize(),y=f.totalAddedLinkCount);let _=v?DG(v):[],x=this.baseUserTelemetry.raw.displayedTime??l,S=["programming-related tasks","programming related questions","software development topics","related to programming","expertise is limited","sorry, i can't assist with that"],I=0;g.type==="success"&&!v.trim().includes(`
`)&&S.some(R=>v.toLowerCase().includes(R))&&(I=1);let E=this._tokenizerProvider.acquireTokenizer(e);switch(this._telemetryService.sendMSFTTelemetryEvent("panel.request",{command:this.turn.intentInvocation?.intent.id??"none",contextTypes:this.turn.contextParts.map(R=>R.kind).join(",")??"none",promptTypes:n.map(R=>`${R.role}${"name"in R&&R.name?`-${R.name}`:""}:${R.content?.length}`).join(","),conversationId:this._sessionId,requestId:this.turn.requestId,responseId:g.requestId,responseType:g.type,languageId:this._tabsAndEditorsService.activeTextEditor?.document.languageId,codeBlocks:_.join(","),model:e.model,isParticipantDetected:String(this.request.isParticipantDetected)},{turn:this.conversation.turns.length,textBlocks:_.length?-1:v.split(/\n{2,}/).length??0,links:y,maybeOffTopic:I,messageTokenCount:E.tokenLength(this.turn.request.message),promptTokenCount:J1(this._tokenizerProvider.acquireTokenizer(e),n),userPromptCount:n.filter(R=>R.role==="user").length,responseTokenCount:E.tokenLength(v)??0,timeToRequest:l-x,timeToFirstToken:d?d-x:-1,timeToComplete:Date.now()-x,...EO(this.turn.references)}),s3(this._telemetryService,"conversationPanel",g.requestId,r,g.type==="offTopic",this._tabsAndEditorsService.activeTextEditor?.document,this.baseUserTelemetry),this._surveyService.signalUsage(`panel.${this.turn.intentInvocation?.intent.id??"default"}`,this._tabsAndEditorsService.activeTextEditor?.document.languageId),g.type){case"success":return await this.processSuccessfulFetchResult(v,g.requestId,u);case"offTopic":return this.processOffTopicFetchResult(r);case"canceled":return this.turn.status="cancelled",this.turn.response={message:"Cancelled",type:"user"},{errorDetails:this.turn.response};case"rateLimited":return this.turn.status="error",{errorDetails:{message:ql.t("Sorry, your request was rate-limited. Please wait and try sending again later."),responseIsFiltered:!0}};case"badRequest":case"failed":return this.turn.status="error",this.turn.response={message:g.reason,type:"server"},{errorDetails:this.turn.response};case"filtered":return this.turn.status="filtered",{errorDetails:{message:o4(g.category),responseIsFiltered:!0}};case"agent_unauthorized":return this.turn.status="error",{};case"agent_failed_dependency":return this.turn.status="error",{errorDetails:{message:g.reason}};case"length":return this.turn.status="error",{errorDetails:{message:ql.t("Sorry, the response hit the length limit. Please rephrase your prompt.")}};case"unknown":return this.turn.status="error",{errorDetails:{message:ql.t("Sorry, no response was returned."),responseIsFiltered:!1}};case"extensionBlocked":return this.turn.status="error",{errorDetails:{message:ql.t("Sorry, something went wrong."),responseIsFiltered:!1}}}}async processSuccessfulFetchResult(e,r,n){return e.length>0?(this.turn.status="success",this.turn.response={message:e,type:"model"},n.markAsDisplayed(),a3(this._telemetryService,this.conversation,this._sessionId,"conversationPanel",e,r,this._tabsAndEditorsService.activeTextEditor?.document,n),{}):(this.turn.status="error",this.turn.response={message:ql.t("The model unexpectedly did not return a response, which may indicate a service issue. Please report a bug."),type:"meta"},{errorDetails:this.turn.response})}processOffTopicFetchResult(e){let r=T1();return this.stream.markdown(this.options.rejectionMessage),this.turn.response={message:this.options.rejectionMessage,type:"offtopic-detection"},this.turn.status="off-topic",r.markAsDisplayed(),c3(this._telemetryService,this.conversation,this._sessionId,"conversationPanel",e,this.baseUserTelemetry.properties.messageId,this._tabsAndEditorsService.activeTextEditor?.document,r),{}}};rI=w([b(5,K),b(6,Rr),b(7,he),b(8,be),b(9,wt),b(10,vu),b(11,Qa),b(12,tv),b(13,zt),b(14,K),b(15,oe),b(16,ke),b(17,Ct),b(18,yr),b(19,r1),b(20,P1)],rI);function rP(t,e,r){let n,o;for(let s of e)if(s instanceof Pae)o=new Bf({message:s.prompt,type:"user"});else{let a=s.response.map(u=>u instanceof ls?u.value.value:u instanceof og?jde(u):"content"in u?u.content:null).filter(u=>!!u).join("");if(o){let u=s.command||$ae(s.participant),l=r.getCommand(u,2);o.response={message:a,type:"model",name:l?.commandId||ba.ID},s.result.errorDetails?s.result.errorDetails?.responseIsFiltered?o.status="filtered":s.result.errorDetails.message==="Cancelled"?o.status="cancelled":o.status="error":o.status="success",t.addTurn(o),o=void 0}let c=s.result;typeof c.metadata?.sessionId=="string"&&(n=c.metadata.sessionId)}return n}var np=class{constructor(e,r,n,o,s,a,c,u,l,d,p,f,m,h){this.location=e;this.logService=r;this.chatMLFetcher=n;this.endpointProvider=o;this.telemetryService=s;this.configurationService=a;this.testProvider=c;this.experimentationService=u;this.intentService=l;this.options=d;this.commandService=p;this.instantiationService=f;this.authenticationService=m;this.tabsAndEditorsService=h}async provideParticipantDetection(e,r,n,o){if(n.location!==1||this.configurationService.getNonExtensionConfig("chat.experimental.detectParticipant.enabled")!==!0&&!this.experimentationService.getTreatmentVariable("vscode","copilotchat.chatParticipantDetectionPublic")&&!(this.authenticationService.copilotToken?.isInternal&&this.experimentationService.getTreatmentVariable("vscode","copilotchat.chatParticipantDetection")))return;let s=new Vs(e.references),a=new Md;rP(a,r.history,this.commandService);let c;try{let u=await this.detectIntent(void 0,e.prompt,void 0,o,void 0,void 0,void 0,s,a.turns),l=n.participants?.filter(d=>d.participant!==kH&&!d.participant.startsWith(mH)&&d.disambiguation.length)??[];if(u&&"participant"in u)return c=u,u;if(u){c=u.id;let d=T4(u.id);if(d)return{participant:lg(d.agent),command:d.command}}else if(l.length){let d=await this.detectIntent(void 0,e.prompt,void 0,o,void 0,void 0,!0,new Vs(e.references),a.turns,l);if(d&&"participant"in d)return c=d,d}}finally{c&&this.collectIntentDetectionContextInternal(e.prompt,c,s,a.turns.slice(0,-1),this.tabsAndEditorsService.activeTextEditor?.document)}}async detectIntent(e,r,n,o,s,a,c,u,l,d){this.logService.public.trace("Building intent detector");let p;this.location===2?p=await this.endpointProvider.getChatEndpoint("gpt-4o-mini"):p=await this.endpointProvider.getChatEndpoint("gpt-3.5-turbo");let f=Be.create(this.instantiationService,p,this.location===1?jl:JG,{preferredIntent:a,location:this.location,userQuestion:r,documentContext:e,history:l,chatVariables:u,thirdPartyParticipants:d}),{messages:m}=await f.render(void 0,o);this.logService.public.trace("Built intent detector");let h=[],g=async(S,I,E)=>{if(E.copilotFunctionCalls)for(let R of E.copilotFunctionCalls)h.push({name:R.name,arguments:JSON.parse(R.arguments)})},v=await this.chatMLFetcher.fetchMany("intentDetection",m,g,o,this.location,p,{agent:n},{temperature:this.options.temperature,top_p:this.options.topP,stop:[";"],n:1},{messageSource:"chat.intentprompt"}),y=this.validateResult(v,s,r,h.map(S=>S.name),a,d),_=y&&"id"in y?y?.id:y?.participant;this.sendTelemetry(a,_,e?.language.languageId,c);let x=f.getMeta(nP);return this.sendInternalTelemetry(r,a,x?.filePath,x?.fileExcerpt,_,e?.language.languageId,c,m.slice(0,-1)),y}async collectIntentDetectionContextInternal(e,r,n,o=[],s){let a=await this.endpointProvider.getChatEndpoint("gpt-3.5-turbo"),{messages:c}=await ki(this.instantiationService,a,zr,{document:s}),{messages:u}=await ki(this.instantiationService,a,Ot,{history:o,priority:1e3},void 0,void 0,{validate:!1}).catch(()=>({messages:[]})),{history:l,fileExcerpt:d,attachedContext:p,fileExcerptExceedsBudget:f}=this.prepareInternalTelemetryContext(c?.[0]?.content,u,n);this.telemetryService.sendInternalMSFTTelemetryEvent("participantDetectionContext",{chatLocation:gt.toString(this.location),userQuery:e,history:l.join(""),assignedIntent:typeof r=="string"?r:void 0,assignedThirdPartyChatParticipant:typeof r!="string"?r.participant:void 0,assignedThirdPartyChatCommand:typeof r!="string"?r.command:void 0,fileExcerpt:d??(f?"<truncated>":"<none>"),attachedContext:p.join(";")},{})}getFunctions(e){let r=e!==void 0&&rr(e.document.uri);return jl.getDetectableIntents(this.location,r,this.intentService,this.configurationService,this.testProvider).map(n=>({name:n.id,functionName:n.intentDetectionInput.functionName,description:n.intentDetectionInput.modelDescription||n.description}))}validateResult(e,r,n,o,s,a){if(e.type!=="success"){r&&this.sendPromptIntentErrorTelemetry(r,e);return}let c=o?.length?o.map(p=>{let[f,m]=p.replaceAll("```","").split(".");return(m??f).replaceAll("'","")}):e.value.map(p=>p.trimStart().split(`
`)[0].replaceAll("```","").replace(/function id:|response:/i,"").trim());if(c=c.filter(p=>p!==ba.ID),!c.length&&s&&(c=[s]),c[0]==="github_questions"||c[0]==="web_questions")return{participant:kH};let u=a?.reduce((p,f)=>(f.disambiguation.forEach(m=>{p[m.categoryName]={participant:f.participant,command:f.command}}),p),{}),l=c.map(p=>this.intentService.getIntent(p,this.location)??this.intentService.getIntentByFunctionName(p,this.location)??(Gde[p]&&this.intentService.getIntent(Gde[p],this.location))??u?.[p]).filter(p=>p!==void 0)?.[0],d=l&&"id"in l?l?.id:l?.participant;if(this.logService.internal.debug(`picked intent "${d}" from ${JSON.stringify(e.value,null,"	")}`),r){let p=r.extendedBy({messageText:n,promptContext:c.join(),intent:d||"unknown"});this.telemetryService.sendRestrictedGHTelemetryEvent("conversation.promptIntent",p.raw.properties,p.raw.measurements)}return l}sendPromptIntentErrorTelemetry(e,r){let n=e.extendedBy({resultType:r.type,reason:r.reason});this.telemetryService.sendRestrictedGHTelemetryErrorEvent("conversation.promptIntentError",n.raw.properties,n.raw.measurements)}sendTelemetry(e,r,n,o){this.telemetryService.sendMSFTTelemetryEvent("intentDetection",{chatLocation:gt.toString(this.location),preferredIntent:e??"<none>",detectedIntent:r??"<none>",languageId:n??"<none>",isRerunWithoutIntentDetection:String(o)??"<none>"})}prepareInternalTelemetryContext(e,r,n){let o=5e3,s=[];if(n)for(let u of n){let l=Buffer.byteLength(u.uniqueName,"utf8");if(o-l<0)break;o-=l,s.push(u.uniqueName)}let a=!1;if(e){let u=Buffer.byteLength(e,"utf8");u>o?(a=!0,e=void 0):o-=u}else e=void 0;let c=[];for(let u=r.length-1;u>=0;u-=1){let l=r[u],d=`${l.role.toUpperCase()}: ${l.content}

`,p=Buffer.byteLength(d,"utf8");if(o-p<0)break;c.push(d),o-=p}return{fileExcerpt:e,fileExcerptExceedsBudget:a,history:c.reverse(),attachedContext:s}}sendInternalTelemetry(e,r,n,o,s,a,c,u){let{fileExcerpt:l,history:d}=this.prepareInternalTelemetryContext(o,u);this.telemetryService.sendInternalMSFTTelemetryEvent("intentDetection",{chatLocation:gt.toString(this.location),request:e,preferredIntent:r??"<none>",filePath:n??"<none>",fileExerpt:l??"<none>",detectedIntent:s??"<none>",languageId:a??"<none>",isRerunWithoutIntentDetection:String(c)??"<none>",history:d.join("")},{})}};np=w([b(1,oe),b(2,Ct),b(3,Se),b(4,he),b(5,be),b(6,Iu),b(7,wt),b(8,Qa),b(9,Rr),b(10,vu),b(11,K),b(12,Nt),b(13,zt)],np);var nP=class extends iv.PromptMetadata{constructor(r,n){super();this.fileExcerpt=r;this.filePath=n}},jl=class extends X{constructor(r,n,o,s,a){super(r);this._ignoreService=n;this._configurationService=o;this._testProvider=s;this._intentService=a}static getDetectableIntents(r,n,o,s,a){let c=o.getIntents(r),u=[];for(let l=0;l<c.length;l++){let d=c[l];d.id==="review"&&!s.getConfig(de.ReviewIntent)||d.id==="fixTestFailure"&&(!a.isEnabled.get()||Os.isEmpty(a.getAllFailures()))||d.id==="tests"&&n||d.commandInfo?.defaultEnablement===!1||d.intentDetectionInput.disabled&&r===2||u.push(d)}return u}async prepare(r,n,o){let{documentContext:s}=this.props,a=!1;return s!==void 0&&(a=await this._ignoreService.isCopilotIgnored(s.document.uri)),{isDocumentCopilotIgnored:a}}render(r){let{preferredIntent:n,location:o,userQuestion:s,documentContext:a}=this.props,c,u,l;try{if(a!==void 0&&!r.isDocumentCopilotIgnored){let{document:h,selection:g}=a;c=h.uri;let v=new Qe(new rn(Math.max(g.start.line-5,0),0),new rn(Math.min(g.end.line+5,h.lineCount),h.lineAt(g.end.line).text.length));u=h.getText(v),l=u.trim().length>0?vscpp(Fe,{uri:c,languageId:h.languageId,code:u,shouldTrim:!1}):void 0}}catch{}let d=new nP(u,c?.path),p=a!==void 0&&rr(a.document.uri),f=jl.getDetectableIntents(o,p,this._intentService,this._configurationService,this._testProvider),m=(n?this._intentService.getIntent(n,o)?.intentDetectionInput.functionName:void 0)??n;return vscpp(vscppf,null,vscpp("meta",{value:d}),vscpp(iv.SystemMessage,null,'When asked for your name, you must respond with "GitHub Copilot".',vscpp("br",null),"Follow the user's requirements carefully & to the letter.",vscpp("br",null)),vscpp(iv.UserMessage,null,"A software developer is using an AI chatbot in a code editor",c&&` in file ${c.path}`,".",vscpp("br",null),l===void 0?vscpp("br",null):vscpp(vscppf,null,"Current active file contains following excerpt:",vscpp("br",null),l,vscpp("br",null)),"The developer added the following request to the chat and your goal is to select a function to perform the request.",vscpp("br",null),m&&`The developer probably wants Function Id '${m}', pick different only if you're certain.`,vscpp("br",null),"Request: ",s,vscpp("br",null),vscpp("br",null),"Available functions:",vscpp("br",null),f.map(h=>vscpp(vscppf,null,"Function Id: ",h.id,vscpp("br",null),"Function Description: ",h.intentDetectionInput.modelDescription||h.description,vscpp("br",null),vscpp("br",null))),vscpp("br",null),"Here are some examples to make the instructions clearer:",vscpp("br",null),f.map(h=>vscpp(vscppf,null,"Request: ",h.intentDetectionInput.sampleQuestion,vscpp("br",null),"Response: ",h.id,vscpp("br",null),vscpp("br",null))),"Request: ",s,vscpp("br",null),"Response:"))}};jl=w([b(1,ke),b(2,be),b(3,Iu),b(4,Qa)],jl);var Gde={workspace_questions:"workspace",create_workspace_or_extension:"new",create_new_workspace:"new",create_jupyter_notebook:"newNotebook",create_new_jupyter_notebook:"newNotebook",vscode_questions:"vscode",github_questions:"github",web_questions:"github",create_tests:"tests",generate_test_for_code:"tests",terminal_state_questions:"terminalExplain",configure_python_environment:"vscode",generate_with_workspace_context:"workspace",generate_code_sample:"unknown",unknown:"unknown"},QG=class extends X{render(){return vscpp(vscppf,null,'| workspace_questions | The user wants to learn about the code or files in their current workspace. Questions in this category may be about understanding what the whole workspace does or locating the implementation of some code. | "What does this project do?" |',vscpp("br",null),'| generate_with_workspace_context | The user wants to generate code based on multiple files in the workspace and did not specify which files to reference. | "Create a README for this project." |',vscpp("br",null),'| generate_code_sample | The user wants to generate code snippets without referencing the contents of the current workspace. This category does not include generating entire projects. | "Write an example of computing a SHA256 hash." |',vscpp("br",null),'| create_workspace_or_extension | The user wants to create a complete workspace from scratch in Visual Studio Code, such as a new application or Visual Studio Code extension. The user may have specified individual files that you should refer to. This does not include requests to generate individual methods or files. | "Scaffold a Node server." |',vscpp("br",null),'| configure_python_environment | The user wants to set up their Python environment. | "Create a virtual environment for my project." |',vscpp("br",null),'| create_tests | The user wants to generate unit tests. | "Generate tests for my selection using pytest." |',vscpp("br",null),'| create_jupyter_notebook | The user wants to create a new Jupyter notebook in Visual Studio Code. | "Create a notebook to analyze this CSV file." |',vscpp("br",null),'| vscode_questions | The user wants to learn about, use, or configure the editor, terminal, debugger, tasks, extensions, commands, or settings in Visual Studio Code. This category does not include creating VS Code extensions or generating and explaining code. | "Switch to light mode." |',vscpp("br",null),'| terminal_state_questions | The user wants to learn about specific state such as the selection, command, or failed command in the integrated terminal in Visual Studio Code. | "Why did the latest terminal command fail?" |',vscpp("br",null),'| github_questions | The user is asking about an issue, pull request, branch, commit hash, diff, discussion, repository, or published release on GitHub.com.  This category does not include performing local Git operations using the CLI. | "What has been changed in the pull request 1361 in browserify/browserify repo?" |',vscpp("br",null),'| web_questions | The user is asking a question that requires current knowledge from a web search engine. Such questions often reference time periods that exceed your knowledge cutoff. | "What is the latest LTS version of Node.js?" |',vscpp("br",null),`| unknown | The user's question does not fit exactly one of the categories above, is about a product other than Visual Studio Code or GitHub, or is a general question about code, code errors, or software engineering. | "How do I center a div in CSS?" |`,vscpp("br",null))}},XG=class extends X{render(){return vscpp(vscppf,null,this.props.participants.flatMap(e=>e.disambiguation.map(r=>vscpp(vscppf,null,"| ",r.categoryName," | ",r.description," | ",r.examples[0]?`"${r.examples[0]}"`:"--"," |",vscpp("br",null)))),vscpp("br",null),`| unknown | The user's question does not fit exactly one of the categories above or is a general question about code, code errors, or software engineering. | "How do I center a div in CSS?" |`,vscpp("br",null))}},JG=class extends jl{render(){let{history:e,chatVariables:r,userQuestion:n}=this.props,o=!!(e?.length&&e.length>0);return vscpp(vscppf,null,vscpp(iv.SystemMessage,null,`You are a helpful AI programming assistant to a user who is a software engineer, acting on behalf of the Visual Studio Code editor. Your task is to choose one category from the Markdown table of categories below that matches the user's question. Carefully review the user's question, any previous messages, and any provided context such as code snippets. Respond with just the category name. Your chosen category will help Visual Studio Code provide the user with a higher-quality response, and choosing incorrectly will degrade the user's experience of using Visual Studio Code, so you must choose wisely. If you cannot choose just one category, or if none of the categories seem like they would provide the user with a better result, you must always respond with "unknown".`,vscpp("br",null),vscpp("br",null),"| Category name | Category description | Example of matching question |",vscpp("br",null),"| -- | -- | -- |",vscpp("br",null),this.props.thirdPartyParticipants?vscpp(XG,{participants:this.props.thirdPartyParticipants}):vscpp(QG,null)),o&&vscpp(Ot,{history:e,priority:800}),vscpp(Jr,{query:n,chatVariables:r,priority:900}))}},x3=class extends jl{constructor(e,r,n,o,s){super(e,r,n,o,s)}render(e){let{preferredIntent:r,location:n,userQuestion:o,documentContext:s,history:a,chatVariables:c}=this.props,u=(r?this._intentService.getIntent(r,n)?.intentDetectionInput.functionName:void 0)??r,l,d,p;try{if(s!==void 0&&!e.isDocumentCopilotIgnored){let{document:v,selection:y}=s;l=v.uri;let _=new Qe(new rn(Math.max(y.start.line-5,0),0),new rn(Math.min(y.end.line+5,v.lineCount),v.lineAt(y.end.line).text.length));d=v.getText(_),p=d.trim().length>0?vscpp(Fe,{uri:l,languageId:v.languageId,code:d,shouldTrim:!1}):void 0}}catch{}let f=new nP(d,l?.path),m=s!==void 0&&rr(s.document.uri),h=jl.getDetectableIntents(n,m,this._intentService,this._configurationService,this._testProvider),g=!!(a?.length&&a.length>0);return vscpp(vscppf,null,vscpp("meta",{value:f}),vscpp(iv.SystemMessage,{priority:1e3},"You are an AI programming assistant in the Visual Studio Code editor.",vscpp("br",null),l&&vscpp(vscppf,null,"The user is currently looking at the file ",l.path,".",vscpp("br",null)),p&&vscpp(vscppf,null,"The current active file contains the following excerpt:",vscpp("br",null),p,vscpp("br",null)),"Your task is to choose the function from the following list that is most relevant to the user's message. This function will be executed to provide the user with a more specific and actionable response.",vscpp("br",null),vscpp("br",null),Nr(h.filter(v=>!!v.intentDetectionInput.functionCallingBlurb).map(v=>`Function name: ${v.intentDetectionInput.functionName??v.id}
${v.intentDetectionInput.functionCallingBlurb}
An example of a question that matches the '${v.intentDetectionInput.functionName??v.id}' function is: "${v.intentDetectionInput.sampleQuestion}".`)).join(`

`),vscpp("br",null),vscpp("br",null),n===2&&vscpp(vscppf,null,"If the user's question is not related to the functions described above, or if it is related to two or more functions described above, you should use the 'unknown' function.",vscpp("br",null)),u&&vscpp(vscppf,null,"The user probably wants the '",u,"' function, pick different only if you're certain.",vscpp("br",null)),"Your response should contain just the name of the function and no other text. You can only choose from the functions mentioned above."),g&&vscpp(Ot,{history:a,priority:800}),vscpp(Jr,{query:o,chatVariables:c,priority:900}))}};x3=w([b(1,ke),b(2,be),b(3,Iu),b(4,Qa)],x3);async function zde(t,e,r,n,o,s,a,c){let u,l="",d=!1;if(!n.command&&n.prompt.startsWith("/")&&n.prompt.startsWith("/")){let h=/\/(?<intentId>\w+)(?<restOfQuery>\s.*)?/s.exec(n.prompt)?.groups;n.command=h?.intentId??void 0,n.prompt=h?.restOfQuery?.trim()??""}if(n.command&&e.getCommand(n.command,1))u=e.getCommand(n.command,1)?.intent,l=n.prompt,d=!0;else{let m=n.enableCommandDetection,g=t.createInstance(np,1).detectIntent(o,n.prompt,s?.agent,c,a,s?.preferredIntent,!m,new Vs(n.references),void 0);m&&(u=await g,u?.id===xu.ID&&o.selection.isEmpty&&o.document.lineAt(o.selection.start.line).text.trim()===""&&(u=r.getIntent(Su.ID,1))),l=n.prompt}let p;if(u){let m=e.getCommand(u.id,1);m&&(m.intent?.asSlashCommand?p=await m.intent.asSlashCommand(o):p={name:m.commandId,description:m.details})}u??=r.unknownIntent;let f=await u.invoke({request:n,location:1,documentContext:o,slashCommand:p});return{queryWithoutCommand:l,intentInvocation:f,slashCommand:p,fromQuery:d}}async function $de(t,e,r,n,o,s){let a;if(r.length>0){let l=`The current code is a result of a previous interaction with you. Here are my previous messages: 
- ${r.map(d=>d.prompt).join(`
- `)}`;a=[new Bf({message:l,type:"user"})]}else a=[];let c={history:a,query:t.queryWithoutCommand,chatVariables:new Vs(e.references),customInstructions:n,toolReferences:e.toolReferences},u={report(l){o.push(l)}};return await t.intentInvocation.buildPrompt(c,u,s)}var ZG=class{constructor(e,r,n,o,s){this.wholeRange=e;this.document=r;this.formattingOptions=n;this.preferredIntent=o;this.agent=s;this._requests=[];this.aiEditCollector=void 0;this.store=void 0;this.sessionId=_r(),this.conversation=void 0}addRequest(e){this._requests.push(e)}getRequests(){return this._requests}};var Cu=class{constructor(e,r,n,o,s,a,c,u,l,d,p,f,m,h,g){this.agent=e;this.rejectionMessage=r;this.logService=n;this._telemetryService=o;this.tabAndEditorsService=s;this.languageDiagnosticsService=a;this.ignoreService=c;this.chatMLFetcher=u;this.tokenizerProvider=l;this.feedbackReporter=d;this.instantiationService=p;this.commandService=f;this.intentService=m;this.customInstructionsService=h;this.surveyService=g;this.logService.internal.trace(`CopilotInteractiveEditorSessionProvider created, with rejection message: ${this.rejectionMessage}`)}async prepareInteractiveEditorSession(e){if(await this.ignoreService.isCopilotIgnored(e.document.uri))throw new Error(nI.t("Inline chat is disabled for this file due to content exclusion policies."));let n;if(this.tabAndEditorsService.activeTextEditor?.document.uri.toString()===e.document.uri.toString()){let s=this.tabAndEditorsService.activeTextEditor.options;n={insertSpaces:s.insertSpaces,tabSize:s.tabSize}}let o;return e.selection.isEmpty&&e.document.lineAt(e.selection.start.line).text.trim()===""?o=Su.ID:!e.selection.isEmpty&&e.selection.start.line!==e.selection.end.line&&(o=xu.ID),new ZG(e.selection,e.document,n,o,this.agent)}async provideInteractiveEditorResponse(e,r,n,o){this.logService.public.trace("Providing Inline Chat Response"),r.attempt===0&&e.addRequest(r);let s=e.aiEditCollector=this.instantiationService.createInstance(Kg,e.document.getText()),a=n;n=new Al(u=>{"edits"in u&&s.addEdits(u.edits),a.push(u)});let c=await this.fetchResponse(e,r,n,o);return!c||c.kind==="error"||(e.store=c.reply.store),c}handleInteractiveEditorResponseFeedback(e,r,n){if(n===4&&e.conversation){this.feedbackReporter.reportInline(e.conversation,r.promptQuery,r.reply);return}let o={messageId:r.messageId},s,{selection:a,wholeRange:c,intent:u,query:l}=r.promptQuery,d=e.conversation?.getLatestTurn()?.requestId??"",p=e.sessionId,f=u?.id,m=e.document.languageId,h=r.reply.type,g=f==="fix"?Wde(a,this.languageDiagnosticsService.getDiagnostics(e.document.uri)):void 0,v=rr(e.document.uri)?1:0;this.surveyService.signalUsage(`inline.${f??"default"}`,m);let y={languageId:m,replyType:h,conversationId:p,requestId:d,command:f},_=r.telemetry?.editCount??0,x=r.telemetry?.editLineCount??0,S={selectionLineCount:a?Math.abs(a.end.line-a.start.line):-1,wholeRangeLineCount:c?Math.abs(c.end.line-c.start.line):-1,editCount:_>0?_:-1,editLineCount:x>0?x:-1,isNotebook:v,problemsCount:g?.fileDiagnosticsTelemetry.problemsCount??0,selectionProblemsCount:g?.selectionDiagnosticsTelemetry.problemsCount??0,diagnosticsCount:g?.fileDiagnosticsTelemetry.diagnosticsCount??0,selectionDiagnosticsCount:g?.selectionDiagnosticsTelemetry.diagnosticsCount??0},I=(E,R)=>{this._telemetryService.sendInternalMSFTTelemetryEvent(E,{language:m,intent:f,query:l,conversationId:p,requestId:d,replyType:h,problems:g?.fileDiagnosticsTelemetry.problems??"",selectionProblems:g?.selectionDiagnosticsTelemetry.problems??"",diagnosticCodes:g?.fileDiagnosticsTelemetry.diagnosticCodes??"",selectionDiagnosticCodes:g?.selectionDiagnosticsTelemetry.diagnosticCodes??""},{isNotebook:v,...R})};if(n===3&&e.aiEditCollector){let E=e.aiEditCollector,R=this.instantiationService.createInstance(Wg,e.aiEditCollector.getText(),e.document);(async()=>{try{let[B,V]=await Promise.all([E.getEdits(),R.compute()]),M=V.getEditsSinceInitial();this.instantiationService.createInstance(ep,e.document,E.initialText,B,M,i3(y,S))}finally{R.dispose()}})()}if(e.aiEditCollector=void 0,n===1||n===0){let E=n===1?1:0;this._telemetryService.sendMSFTTelemetryEvent("inline.action.vote",y,{...S,vote:E}),I("interactiveSessionVote",{vote:E})}else if(n===2||n===3){let E=n===3?1:0;this._telemetryService.sendMSFTTelemetryEvent("inline.done",y,{...S,accepted:E}),I("interactiveSessionDone",{accepted:E})}switch(n){case 1:o.rating="positive",s="inlineConversation.messageRating";break;case 0:o.rating="negative",s="inlineConversation.messageRating";break;case 2:o.action="undo",s="inlineConversation.undo";break;case 3:o.action="accept",s="inlineConversation.accept";break;case 4:s="";break}s&&om(this._telemetryService,e.document,o,{},s)}async fetchResponse(e,r,n,o){let s=new iP(Date.now(),e,e.conversation===void 0,r,this._telemetryService,this.languageDiagnosticsService,this.tokenizerProvider),a;e.getRequests().length>1&&r.attempt===0&&e.store&&e.document.getText()===e.store.lastDocumentContent&&(a=e.store.lastWholeRange,this.logService.public.debug("Ignoring passed in whole range and using the whole range from the previous turn"));let c=e.document.getText(),u={document:e.document,fileIndentInfo:e.formattingOptions,language:Ko(e.document),selection:r.selection,wholeRange:a??r.wholeRange};(e.getRequests().length>1||r.attempt>0)&&(e.preferredIntent=void 0),this.logService.public.trace("Resolving inline chat intent");let l=await zde(this.instantiationService,this.commandService,this.intentService,r,u,e,s.baseUserTelemetry,o);this.logService.public.trace("Resolved inline chat intent");let d=l.intentInvocation;l.slashCommand&&!l.fromQuery&&n.detectedParticipant("github.copilot.editor",l.slashCommand);let p={query:l.queryWithoutCommand,...u,intent:d.intent},f=await this.customInstructionsService.fetchInstructions();this.logService.public.trace("Building prompt");let{messages:m,references:h}=await $de(l,r,e.getRequests().slice(0,-1),f,n,o);this.logService.public.trace("Built prompt");for(let ne of h)n.reference(ne.anchor);if(o.isCancellationRequested)return;let g=e.conversation;g||(g=e.conversation=new Md);let v=new Bf({message:m.map(ne=>ne.content).join(`
`),type:"user"});v.requestDebugInformation={uri:e.document.uri,intentId:l.intentInvocation.intent.id,languageId:e.document.languageId,initialDocumentText:c,userPrompt:r.prompt,userSelection:r.selection},v.chatMessages=m,v.requestId=s.telemetryMessageId,g.addTurn(v);let y,_,x=d.linkification?.disable?void 0:this.instantiationService.createInstance(um,{requestId:v.requestId,references:h},n,d.linkification?.additionaLinkifiers??[],o),S=x??n;if(m.length===0){let ne=await d.processResponseInline(qo.EMPTY,S,o);return x&&await x.finalize(),{kind:"ok",promptQuery:p,reply:ne,messageId:s.telemetryMessageId,telemetry:void 0}}let I=s.makeRequest(g,l.queryWithoutCommand,d,m,h);S=Al.spy(S,ne=>{ne instanceof ls&&I.markEmittedMarkdown(ne.value),ne instanceof Uf&&I.markEmittedEdits(ne.uri,ne.edits)});let E=new XS,R=d.processResponseInline(E.stream,S,o),B=!1;R.finally(()=>{B=!0});let V=async(ne,q,P)=>(I.markReceivedToken(),E.update(ne,P),B?ne.length:void 0);try{y=await this.chatMLFetcher.fetchOne(`inlineChat/${d.intent.id}`,m,V,o,1,d.endpoint,{agent:sk},{temperature:Cu.pickTemperature(r),top_p:b3.top_p},{messageId:I.telemetryMessageId,messageSource:d.intent.id!==ba.ID?`inline.${d.intent.id}`:"inline.user"},{intent:!0})}catch(ne){throw this._telemetryService.sendGHTelemetryException(ne,"Fetching failed: "),v.status="error",v.response={message:ne.message,type:"server"},new Error("Failed to make request")}if(y.type!=="success")return this._handleFetchError(v,y,I);if(_=y.value,_.length===0){I.sendTelemetry(y.requestId,"unknown","Empty response");return}E.resolve();let M=await R;x&&await x.finalize(),v.status="success";let le=_;return v.response={message:le,type:"model"},v.responseDebugInformation={parsedReply:M},I.sendTelemetry(y.requestId,"success",le,M),{kind:"ok",promptQuery:p,reply:M,messageId:I.telemetryMessageId,telemetry:I}}_handleFetchError(e,r,n){let{turnStatus:o,message:s,messageType:a,errorDetails:c}=this._interpretFetchError(r);return e.status=o,e.response={message:s,type:a},n.sendTelemetry(r.requestId,r.type,s),{kind:"error",errorDetails:c}}_interpretFetchError(e){switch(e.type){case"rateLimited":return{turnStatus:"error",message:`Response failed ${e.type}: ${e.reason}`,messageType:"server",errorDetails:{message:nI.t("Sorry, your request was rate-limited. Please wait and try sending again later.")}};case"badRequest":return{turnStatus:"error",message:`Response failed ${e.type}: ${e.reason}`,messageType:"server",errorDetails:{message:e.reason}};case"failed":return this.logService.public.error(`Response failed: ${e.reason}`),{turnStatus:"error",message:e.reason,messageType:"server",errorDetails:{message:e.reason}};case"canceled":return this.logService.public.debug(`Response canceled: ${e.reason}`),{turnStatus:"error",message:"Cancelled",messageType:"user",errorDetails:{message:"Cancelled"}};case"unknown":{let r=`Response is empty: ${e.reason}`;return this.logService.public.info(r),{turnStatus:"error",message:r,messageType:"server",errorDetails:{message:nI.t("Sorry, no response was returned.")}}}case"filtered":{let r=`Response got filtered: ${e.reason}`;return this.logService.internal.info(r),{turnStatus:"filtered",message:r,messageType:"server",errorDetails:{message:o4(e.category),responseIsFiltered:!0}}}case"offTopic":return this.logService.internal.info(`Response marked as offtopic: ${e.reason}`),{turnStatus:"off-topic",message:this.rejectionMessage,messageType:"offtopic-detection",errorDetails:{message:this.rejectionMessage}};case"length":{let r=`Response was too long: ${e.reason}`;return this.logService.internal.info(r),{turnStatus:"error",message:r,messageType:"server",errorDetails:{message:nI.t("Sorry, the response hit the length limit. Please rephrase your prompt.")}}}default:return this.logService.public.error("Unexpected response type"),this.logService.internal.error(JSON.stringify(e)),{turnStatus:"error",message:`Unexpected response type: ${JSON.stringify(e)}`,messageType:"server",errorDetails:{message:nI.t("Sorry, something went wrong.")}}}}static pickTemperature(e){return"attempt"in e&&typeof e.attempt=="number"?Math.min(b3.temperature*(e.attempt+1),2):b3.temperature}};Cu=w([b(2,oe),b(3,he),b(4,zt),b(5,To),b(6,ke),b(7,Ct),b(8,yr),b(9,Z1),b(10,K),b(11,vu),b(12,Qa),b(13,r1),b(14,P1)],Cu);var iP=class{constructor(e,r,n,o,s,a,c){this._startTime=e;this._session=r;this._firstTurn=n;this._request=o;this._telemetryService=s;this._languageDiagnosticsService=a;this._tokenizerProvider=c;this.baseUserTelemetry=T1()}get telemetryMessageId(){return this.baseUserTelemetry.properties.messageId}makeRequest(e,r,n,o,s){return new oP(this._session,this._firstTurn,this._request,this._startTime,this.baseUserTelemetry,e,r,n,o,s,this._telemetryService,this._languageDiagnosticsService,this._tokenizerProvider.acquireTokenizer(n.endpoint))}};iP=w([b(4,he),b(5,To),b(6,yr)],iP);var oP=class{constructor(e,r,n,o,s,a,c,u,l,d,p,f,m){this._session=e;this._firstTurn=r;this._request=n;this._startTime=o;this._conversation=a;this._queryWithoutCommand=c;this._intentInvocation=u;this._messages=l;this._references=d;this._telemetryService=p;this._languageDiagnosticsService=f;this._tokenizer=m;this._requestStartTime=Date.now();this._firstTokenTime=0;this._markdownCharCount=0;this._editCount=0;this._editLineCount=0;this._userTelemetry=o3(this._conversation,this._session.sessionId,"conversationInline",this._request.prompt,q7e(this._tokenizer,this._messages),this._intentInvocation.intent.id,s),this._diagnosticsTelemetryData=Wde(this._request.selection,this._languageDiagnosticsService.getDiagnostics(this._session.document.uri)),this._sendInternalRequestTelemetryEvent()}get editCount(){return this._editCount}get editLineCount(){return this._editLineCount}get telemetryMessageId(){return this._userTelemetry.properties.messageId}get _isNotebookDocument(){return rr(this._session.document.uri)?1:0}_sendInternalRequestTelemetryEvent(){this._telemetryService.sendInternalMSFTTelemetryEvent("interactiveSessionRequest",{conversationId:this._session.sessionId,requestId:this.telemetryMessageId,chatLocation:"inline",intent:this._intentInvocation.intent.id,language:this._session.document.languageId,prompt:this._messages.map(e=>`${e.role.toUpperCase()}:
${e.content}`).join(`
---
`),model:this._intentInvocation.endpoint.model},{isNotebook:this._isNotebookDocument})}markReceivedToken(){this._firstTokenTime===0&&(this._firstTokenTime=Date.now())}markEmittedMarkdown(e){this._markdownCharCount+=e.value.length}markEmittedEdits(e,r){this._editCount+=r.length,this._editLineCount+=r.reduce((n,o)=>n+o.newText.split(`
`).length,0)}sendTelemetry(e,r,n,o){s3(this._telemetryService,"conversationInline",e,this._request.prompt,r==="offTopic",this._session.document,this._userTelemetry),r==="offTopic"&&c3(this._telemetryService,this._conversation,this._session.sessionId,"conversationInline",this._request.prompt,this.telemetryMessageId,this._session.document,this._userTelemetry),r==="success"&&o&&a3(this._telemetryService,this._conversation,this._session.sessionId,"conversationInline",n,this.telemetryMessageId,this._session.document,this._userTelemetry.extendedBy({replyType:o.type})),this._sendTelemetryEvent(r,n,o),this._sendInternalTelemetryEvent(r,n)}_sendTelemetryEvent(e,r,n){this._telemetryService.sendMSFTTelemetryEvent("inline.request",{command:this._intentInvocation.intent.id??"",contextTypes:"none",promptTypes:this._messages.map(o=>`${o.role}${"name"in o&&o.name?`-${o.name}`:""}:${o.content.length}`).join(","),conversationId:this._session.sessionId,requestId:this.telemetryMessageId,languageId:this._session.document.languageId,responseType:e,replyType:n?.type,model:this._intentInvocation.endpoint.model,diagnosticsProvider:this._diagnosticsTelemetryData.diagnosticsProvider,diagnosticCodes:this._diagnosticsTelemetryData.fileDiagnosticsTelemetry.diagnosticCodes,selectionDiagnosticCodes:this._diagnosticsTelemetryData.selectionDiagnosticsTelemetry.diagnosticCodes,outcomeAnnotations:n?.annotations?.map(o=>o.label).join(",")},{firstTurn:this._firstTurn?1:0,isNotebook:this._isNotebookDocument,withIntentDetection:this._request.enableCommandDetection===void 0?void 0:this._request.enableCommandDetection?1:0,messageTokenCount:this._tokenizer.tokenLength(this._queryWithoutCommand),promptTokenCount:J1(this._tokenizer,this._messages),responseTokenCount:e==="success"?this._tokenizer.tokenLength(r):-1,implicitCommand:this._request.prompt.trim().startsWith(`/${this._intentInvocation.intent.id}`)?0:1,attemptCount:this._request.attempt||0,selectionLineCount:this._request.selection?Math.abs(this._request.selection.end.line-this._request.selection.start.line)+1:-1,wholeRangeLineCount:this._request.wholeRange?Math.abs(this._request.wholeRange.end.line-this._request.wholeRange.start.line)+1:-1,editCount:this._editCount>0?this._editCount:-1,editLineCount:this._editLineCount>0?this._editLineCount:-1,markdownCharCount:this._markdownCharCount,problemsCount:this._diagnosticsTelemetryData.fileDiagnosticsTelemetry.problemsCount,selectionProblemsCount:this._diagnosticsTelemetryData.selectionDiagnosticsTelemetry.problemsCount,diagnosticsCount:this._diagnosticsTelemetryData.fileDiagnosticsTelemetry.diagnosticsCount,selectionDiagnosticsCount:this._diagnosticsTelemetryData.selectionDiagnosticsTelemetry.diagnosticsCount,timeToRequest:this._requestStartTime-this._startTime,timeToFirstToken:this._firstTokenTime?this._firstTokenTime-this._startTime:-1,timeToComplete:Date.now()-this._startTime,...EO(this._references)})}_sendInternalTelemetryEvent(e,r){this._telemetryService.sendInternalMSFTTelemetryEvent("interactiveSessionResponse",{conversationId:this._session.sessionId,requestId:this.telemetryMessageId,chatLocation:"inline",intent:this._intentInvocation.intent.id??"",problems:this._diagnosticsTelemetryData.fileDiagnosticsTelemetry.problems,selectionProblems:this._diagnosticsTelemetryData.selectionDiagnosticsTelemetry.problems,diagnosticCodes:this._diagnosticsTelemetryData.fileDiagnosticsTelemetry.diagnosticCodes,selectionDiagnosticCodes:this._diagnosticsTelemetryData.selectionDiagnosticsTelemetry.diagnosticCodes,diagnosticsProvider:this._diagnosticsTelemetryData.diagnosticsProvider,language:this._session.document.languageId,request:this._request.prompt,responseType:e,response:r},{isNotebook:this._isNotebookDocument})}};oP=w([b(10,he),b(11,To)],oP);function q7e(t,e){let r=0;for(let n of e)r+=t.tokenLength(n.content);return r}function Wde(t,e){let r=e.filter(l=>t.intersection(l.range)),n={problems:e.map(l=>l.message).join(", "),problemsCount:e.length,diagnosticCodes:"",diagnosticsCount:0},o={problems:r.map(l=>l.message).join(", "),problemsCount:r.length,diagnosticCodes:"",diagnosticsCount:0},s=new Map,a=new Map;e.forEach(l=>{let d=l.code,p=typeof d=="string"||typeof d=="number"?d.toString():d?d.value.toString():"",f=l.source?`${l.source}@${p}`:p;s.set(f,(s.get(f)||0)+1),t.intersection(l.range)&&a.set(f,(a.get(f)||0)+1)});let c=l=>{let d="";return l.forEach((p,f)=>{d+=`${f}:${p},`}),d};n.diagnosticCodes=c(s),n.diagnosticsCount=s.size,o.diagnosticCodes=c(a),o.diagnosticsCount=a.size;let u=e.length>0?e[0].source??"":"";return{fileDiagnosticsTelemetry:n,selectionDiagnosticsTelemetry:o,diagnosticsProvider:u}}var Dn=H(require("vscode"));var ov=class extends Dn.CodeAction{constructor(){super(...arguments);this.isAI=!0}},Tu=class{constructor(e,r){this.configurationService=e;this.ignoreService=r}static{this.providedCodeActionKinds=[Dn.CodeActionKind.QuickFix]}static getSevereDiagnostics(e){let r=e.filter(n=>n.severity<=Dn.DiagnosticSeverity.Warning);return r.length===0?[]:r}static getDiagnosticsAsText(e){return e.map(r=>r.message).join(", ")}async provideCodeActions(e,r,n){if(!this.configurationService.getConfig(de.EnableCodeActions)||await this.ignoreService.isCopilotIgnored(e.uri))return;let s=[],a=Dn.window.activeTextEditor;if(!a)return s;if(this.configurationService.getConfig(de.ReviewContextMenu)&&!a.selection.isEmpty){let h=new ov(Dn.l10n.t("Review using Copilot (Experimental)"),Dn.CodeActionKind.RefactorRewrite);h.command={title:h.title,command:"github.copilot.interactiveEditor.review"},s.push(h)}let c=Tu.getSevereDiagnostics(n.diagnostics);if(c.length===0)return s;let u=c.map(h=>h.range).reduce((h,g)=>h.union(g)),l=new Dn.Selection(u.start,u.end),d=Tu.getDiagnosticsAsText(c),p=new ov(Dn.l10n.t("Fix using Copilot"),Dn.CodeActionKind.QuickFix);p.diagnostics=c,p.command={title:p.title,command:"vscode.editorChat.start",arguments:[{autoSend:!0,message:`/fix ${d}`,position:u.start,initialSelection:l,initialRange:u}]};let f=new ov(Dn.l10n.t("Explain using Copilot"),Dn.CodeActionKind.QuickFix);f.diagnostics=c;let m=`/explain ${d}`;return this.configurationService.getConfig(de.ExplainIntentRefer)&&(m=`@${Wk} ${m}`),f.command={title:f.title,command:"github.copilot.chat.explain",arguments:[m]},s.push(p,f),s}};Tu=w([b(0,be),b(1,ke)],Tu);var vy=class{constructor(e,r,n,o,s){this.logger=e;this.configurationService=r;this.ignoreService=n;this.parserService=o;this.telemetryService=s}static{this.providedCodeActionKinds=[Dn.CodeActionKind.RefactorRewrite]}async provideCodeActions(e,r,n){if(!this.configurationService.getConfig(de.EnableCodeActions)||await this.ignoreService.isCopilotIgnored(e.uri))return;let s=this.provideGenerateUsingCopilotCodeAction(e,r),a=await this.provideDocGenCodeAction(e,r),c=await this.provideTestGenCodeAction(e,r);return Nr([a,s,c])}provideGenerateUsingCopilotCodeAction(e,r){let n;if(r.isEmpty){let s=e.lineAt(r.start.line).text;r.end.character===s.length&&/^\s*$/g.test(s)&&(n=Dn.l10n.t("Generate using Copilot"))}else{let s=e.getText(r);/^\s*$/g.test(s)||(n=Dn.l10n.t("Modify using Copilot"))}if(n===void 0)return;let o=new ov(n,Dn.CodeActionKind.RefactorRewrite);return o.command={title:o.title,command:"vscode.editorChat.start",arguments:[{position:r.start,initialSelection:new Dn.Selection(r.start,r.end),initialRange:r}]},o}async provideDocGenCodeAction(e,r){let n=e.offsetAt(r.start),o=e.offsetAt(r.end),s={startIndex:n,endIndex:o},a,c=this.parserService.getTreeSitterAST(e);if(c)try{a=await c.getDocumentableNodeIfOnIdentifier(s)}catch(p){this.logger.internal.error(p,"RefactorsProvider: getDocumentableNodeIfOnIdentifier failed"),this.telemetryService.sendGHTelemetryException(p,"RefactorsProvider: getDocumentableNodeIfOnIdentifier failed")}if(a===void 0)return;let u=Dn.l10n.t("Generate Documentation using Copilot"),l=new ov(u,Dn.CodeActionKind.RefactorRewrite),d=a.nodeRange===void 0?void 0:new Qe(e.positionAt(a.nodeRange.startIndex),e.positionAt(a.nodeRange.endIndex));return l.command={title:u,command:"vscode.editorChat.start",arguments:[{autoSend:!0,message:"/doc",initialRange:d}]},l}async provideTestGenCodeAction(e,r){let n=e.offsetAt(r.start),o=e.offsetAt(r.end),s={startIndex:n,endIndex:o},a=null,c=this.parserService.getTreeSitterAST(e);if(c)try{a=await c.getTestableNode(s)}catch(p){this.logger.internal.error(p,"RefactorsProvider: getTestableNode failed"),this.telemetryService.sendGHTelemetryException(p,"RefactorsProvider: getTestableNode failed")}if(!a||!ms(e,a.identifier.range).contains(r))return;let l=Dn.l10n.t("Generate Tests using Copilot"),d=new ov(l,Dn.CodeActionKind.RefactorRewrite);return d.command={title:l,command:"github.copilot.interactiveEditor.generateTests"},d}};vy=w([b(0,oe),b(1,be),b(2,ke),b(3,_t),b(4,he)],vy);var Kde=require("util"),sv=H(require("vscode"));var j7e="application/vnd.code.notebook.error",S3=class{constructor(e){this.accessor=e}async provideCellStatusBarItems(e,r){if(sv.workspace.getConfiguration("notebook").get("cellFailureDiagnostics"))return[];if(e.kind===sv.NotebookCellKind.Markup){let a=sv.workspace.getConfiguration("notebook.experimental").get("cellChat");if(!a)return[];let c=e.document.getText().trim();if(!a||c.length===0)return[];let u="Generate code from markdown content",l=c;return[{text:"$(sparkle)",alignment:sv.NotebookCellStatusBarAlignment.Left,priority:Number.MAX_SAFE_INTEGER-1,tooltip:u,command:{title:u,command:"notebook.cell.chat.start",arguments:[{index:e.index+1,input:l,autoSend:!0}]}}]}let o=e.outputs.flatMap(a=>a.items).find(a=>a.mime===j7e);if(!o)return[];let s;try{let a=new Kde.TextDecoder;if(s=JSON.parse(a.decode(o.data)),!s.name&&!s.message)return[];let c="Fix using Copilot",u=[s.name,s.message].filter(Boolean).join(": ").replace(/\s*\(\S+,\s*line\s*\d+\)/,"");return[{text:"$(sparkle)",alignment:sv.NotebookCellStatusBarAlignment.Left,priority:Number.MAX_SAFE_INTEGER-1,tooltip:c,command:{title:c,command:"vscode.editorChat.start",arguments:[{autoSend:!0,message:`/fix ${u}`}]}}]}catch(a){this.accessor.get(oe).public.error(`Failed to parse error output ${a}`)}return[]}};function Qde(t){let e=t.get(K),r=new ht,n=async(y,_)=>{let x=`@${Wk} /explain `,S,I,E=!1;if(typeof y=="string"&&y)x=y;else{let R=t.get(zt),B=zr.getCurrentSelection(R,!0);if(B){let M=It.languages.getDiagnostics(B.activeDocument.uri),le=M.filter(q=>!!q.range.intersection(B.range));Tu.getSevereDiagnostics(le).length&&(x+=Tu.getDiagnosticsAsText(M),E=!0)}let V=zr.getCurrentSelection(R);if(!E&&V&&(x+=DO,S=jS.formatSelection({languageId:V.languageId,selectedText:V.selectedText}),I=V.activeDocument.uri),!E&&B&&_)try{let M=await hs.getSelectedScope(t,{document:B.activeDocument,selection:B.range});if(M&&M.symbolAtCursorState&&M.symbolAtCursorState.codeAtCursor){x+=DO;let le=M.symbolAtCursorState.document.languageId??"";S=jS.formatSelection({languageId:le,selectedText:M.symbolAtCursorState.codeAtCursor}),I=B.activeDocument.uri}}catch(M){if(M instanceof Hi)return}}I&&S&&!await t.get(ke).isCopilotIgnored(I)&&(x+=S),It.commands.executeCommand("workbench.action.chat.open",{query:x})},o=async(y,_=!1)=>{let x=t.get(So),S=x.findReviewComment(y);if(!S||!S.suggestion)return;let I=It.window.activeTextEditor;if(!I||I.document!==S.document)return;let{edits:E}=await S.suggestion;I.edit(B=>{E.forEach(V=>{B.replace(V.range,V.newText)})}),_&&f(y,1);let R=x.getReviewComments().length;x.removeReviewComments([S]),zg(S,R,"applySuggestion",t.get(oe),t.get(he),t.get(K))},s=async y=>{let _=t.get(So),x=_.findReviewComment(y);if(!x)return;let S=_.getReviewComments().length,I=x.body instanceof It.MarkdownString?x.body.value:x.body;_.collapseReviewComment(x),await It.commands.executeCommand("vscode.editorChat.start",{initialRange:y.range,message:`/fix ${I}`,autoSend:!0}),zg(x,S,"continueInInlineChat",t.get(oe),t.get(he),t.get(K))},a=async y=>{let _=t.get(So),x=_.findReviewComment(y);if(!x)return;let S=_.getReviewComments().length,I=x.body instanceof It.MarkdownString?x.body.value:x.body;await It.commands.executeCommand("workbench.action.chat.open",{query:"Explain your comment.",isPartialQuery:!0,previousRequests:[{request:"Review my code.",response:`In file \`${Yde.default.basename(x.uri.fsPath)}\` at line ${x.range.start.line+1}:

${I}`}]}),zg(x,S,"continueInChat",t.get(oe),t.get(he),t.get(K))},c=async(y,_=!1)=>{_&&f(y,1);let x=t.get(So),S=x.findReviewComment(y);if(S){let I=x.getReviewComments().length;x.removeReviewComments([S]),zg(S,I,"discardComment",t.get(oe),t.get(he),t.get(K))}},u=async()=>{let y=t.get(So),_=y.getReviewComments();_.length&&(y.removeReviewComments(_),zg(_,_.length,"discardAllComments",t.get(oe),t.get(he),t.get(K)))},l=async y=>{let _=t.get(So),x=_.findReviewComment(y);if(x){let S=_.getReviewComments().length;zg(x,S,"helpful",t.get(oe),t.get(he),t.get(K))}},d=async y=>{let _=t.get(So),x=_.findReviewComment(y);if(x){let S=_.getReviewComments().length;zg(x,S,"unhelpful",t.get(oe),t.get(he),t.get(K))}},p=t.get(jt).extensionMode;typeof p=="number"&&p!==It.ExtensionMode.Test&&t.get(So).updateContextValues();let f=(y,_)=>{let x=t.get(So),S;if(y){let E=x.findReviewComment(y);if(!E)return;let R=x.getReviewComments(),V=(R.indexOf(E)+_+R.length)%R.length;S=R[V]}else{let E=x.getReviewComments();S=E[_>0?0:E.length-1]}let I=S&&x.findCommentThread(S);I&&(_!==0&&I.reveal(),H7e(t,I))},m=()=>It.commands.executeCommand("vscode.editorChat.start",{message:"/generate "}),h=()=>It.commands.executeCommand("vscode.editorChat.start",{message:`/${Fl.ID} `,autoSend:!0,initialRange:It.window.activeTextEditor?.selection}),g=y=>{let _=y&&typeof y=="object"&&"document"in y&&y.document&&typeof y.document=="object"&&"getText"in y.document&&"selection"in y&&y.selection instanceof It.Range?y:void 0;return e.createInstance(S1).runCommand(_)},v=()=>{let y=It.window.activeTextEditor;if(!y)return;let _=y.selection,x=It.languages.getDiagnostics(y.document.uri).filter(S=>!!_.intersection(S.range)).map(S=>S.message).join(", ");return It.commands.executeCommand("vscode.editorChat.start",{message:`/fix ${x}`,autoSend:!0,initialRange:It.window.activeTextEditor?.selection})};return r.add(It.commands.registerCommand("github.copilot.chat.explain",n)),r.add(It.commands.registerCommand("github.copilot.chat.explain.palette",()=>n(void 0,!0))),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review",()=>w1(t,"selection"))),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.stagedChanges",()=>w1(t,"index"))),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.changes",()=>w1(t,"workingTree"))),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.apply",o)),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.applyAndNext",y=>o(y,!0))),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.continueInInlineChat",s)),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.continueInChat",a)),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.discard",c)),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.discardAndNext",y=>c(y,!0))),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.discardAll",u)),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.markHelpful",l)),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.markUnhelpful",d)),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.previous",y=>f(y,-1))),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.next",y=>f(y,1))),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.review.current",y=>f(y,0))),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.generate",m)),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.generateDocs",h)),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.generateTests",g)),r.add(It.commands.registerCommand("github.copilot.interactiveEditor.fix",v)),r.add(It.languages.registerCodeActionsProvider("*",e.createInstance(Tu),{providedCodeActionKinds:Tu.providedCodeActionKinds})),r.add(It.languages.registerCodeActionsProvider("*",e.createInstance(vy),{providedCodeActionKinds:vy.providedCodeActionKinds})),r.add(It.notebooks.registerNotebookCellStatusBarItemProvider("jupyter-notebook",new S3(t))),r}function H7e(t,e){let r=t.get(So),n=r.findReviewComment(e);!n||n.suggestion||(n.suggestion=(async()=>{let o=n.body instanceof It.MarkdownString?n.body.value:n.body,a=t.get(K).createInstance(Cu,"editorAgentName","options.rejectionMessage"),c=n.document,u=new It.Selection(n.range.start,n.range.end),l=await a.prepareInteractiveEditorSession({document:c,selection:u}),d=l.wholeRange??u,p="fix",f=o,m={location:It.ChatLocation.Editor,location2:new It.ChatRequestEditorData(c,u,d),command:p,prompt:f,selection:u,wholeRange:d,references:[],attempt:0,enableCommandDetection:!1,isParticipantDetected:!1,toolReferences:[]},h="",g=[],v=new Al(_=>{_ instanceof It.ChatResponseTextEditPart&&_.edits.length>0?g.push(..._.edits.map(x=>({range:x.range,newText:x.newText,oldText:c.getText(x.range)})).filter(x=>x.newText!==x.oldText)):_ instanceof It.ChatResponseMarkdownPart&&(h+=_.value.value)});await a.provideInteractiveEditorResponse(l,m,v,Lr.None);let y={markdown:h,edits:g};return n.suggestion=y,r.updateReviewComment(n),e.contextValue=g.length?"hasSuggestion":"hasNoSuggestion",y})().catch(o=>(t.get(oe).public.error(o,"Error fetching suggestion"),n.suggestion={markdown:`Error fetching suggestion: ${o?.message}`,edits:[]},r.updateReviewComment(n),n.suggestion)),r.updateReviewComment(n))}var tz=H(Gt());var Eu=H(nt());var Gs=class extends X{render(){return vscpp(vscppf,null,"Your expertise is strictly limited to software development topics.",vscpp("br",null),"Follow Microsoft content policies.",vscpp("br",null),"Avoid content that violates copyrights.",vscpp("br",null),"For questions not related to software development, simply give a reminder that you are an AI programming assistant.",vscpp("br",null),"Keep your answers short and impersonal.")}};var I3=class extends X{async prepare(){return{}}render(e,r){return vscpp(vscppf,null,vscpp(vscppf,null,vscpp(Eu.SystemMessage,{priority:1e3},"You are an AI that creates a detailed content outline for a Jupyter notebook on a given topic.",vscpp("br",null),vscpp(Br,null),vscpp(Gs,null),vscpp(Vi,null),vscpp(Xt,null),vscpp("br",null),"Additional Rules",vscpp("br",null),"DO NOT include Introduction or Conclusion section in the outline!",vscpp("br",null),"Focus only on sections that will need code!",vscpp("br",null),["","Generate the outline as two parts:","- First part is markdown bullet list of section titles","- Second part is the JSON data that will validate against this JSON schema, wrap the response in code block. We assume that a code block begins with ```[optionally the language] and ends with ```","","The JSON schema is:","{",'  "$schema": "http://json-schema.org/draft-07/schema#",','  "type": "object",','  "properties": {','	"description": {','	  "type": "string"',"	},",'	"sections": {','	  "type": "array",','	  "items": {','		"type": "object",','		"properties": {','		  "title": {','			"type": "string"',"		  },",'		  "content": {','			"type": "string"',"		  }","		},",'		"required": ["title", "content"]',"	  }","	}","  },",'  "required": ["sections"]',"}"].join(`
`),["","Examples:","","Below you will find a set of examples of what you should respond with. Please follow these examples as closely as possible.","","## Valid notebook creation question","","user: Creating Random Arrays with Numpy","","assistant: Here's an outline for a Jupyter notebook that creates Random Arrays with Numpy:","","* **Import Required Libraries**","* **Create Random Arrays**","* **Seed the Random Number Generator**","* **Generate Random Integers**","","```json","{",'  "description": "A Jupyter notebook that creates Random Arrays with Numpy.",','  "sections": [',"    {",'      "title": "Import Required Libraries",','      "content": "Import the necessary libraries, including NumPy."',"    },","    {",'      "title": "Create Random Arrays",','      "content": "Use NumPy to create random arrays of various shapes and sizes, including 1D, 2D, and 3D arrays."',"    },","    {",'      "title": "Seed the Random Number Generator",','      "content": "Use the seed() function to seed the random number generator for reproducibility."',"    },","	{",'	  "title": "Generate Random Integers",','	  "content": "Use the randint() function to generate random integers within a specified range."',"	}","  ]","}","```"].join(`
`))),vscpp(pr,{priority:899,...this.props,flexGrow:2}),this.props.promptContext.chatVariables&&Object.keys(this.props.promptContext.chatVariables).length>0?vscpp(Jr,{flexGrow:2,priority:900,chatVariables:this.props.promptContext.chatVariables,query:`Create notebook: ${this.props.promptContext.query}`}):vscpp(Eu.UserMessage,{priority:900},"Create notebook: ",this.props.promptContext.query))}},C3=class extends X{async prepare(){return{}}render(e,r){return vscpp(vscppf,null,vscpp(vscppf,null,this.props.history&&vscpp(ez,{messages:this.props.history.chatMessages??[]}),vscpp(Eu.SystemMessage,{priority:1e3},"You are an AI that writes Python code for a single section of a Jupyter notebook.",vscpp("br",null),vscpp(Br,null),vscpp(Gs,null),vscpp(Xt,null),"When dealing with Jupyter Notebook, if a module is already imported in a cell, it can be used in other cells directly without importing it again. For the same reason, if a variable is defined in a cell, it can be used in other cells as well",vscpp("br",null),"When dealing with Jupyter Notebook, cells below the current cell can be executed before the current cell, you must use the variables defined in the cells below, unless you want to overwrite them.",vscpp("br",null),"When dealing with Jupyter Notebook, do not generate CELL INDEX in the code blocks in your answer, it is only used to help you understand the context.",vscpp("br",null),"If the Jupyter Notebook already contains variables, you should respect the name and value of the variables, and use them in your code when necessary.",vscpp("br",null),"Your output should be valid Python code with inline comments.",vscpp("br",null),"You should return the code directly without any explantion.",vscpp("br",null),"You should not print message to explain the code or purpose of the code.",vscpp("br",null),"You should return the code directly, without wrapping it inside \\`\\`\\`.",vscpp("br",null),"Please make sure that the new code is syntactically valid Python code. It can be validated by running it in a Python interpreter.",vscpp("br",null),"For example, it should pass the validation through builtin module codeop \\`codeop.compile_command(statement)\\`.",vscpp("br",null)),vscpp(Eu.UserMessage,{priority:900},"Overall topic of the notebook: ",this.props.description,vscpp("br",null),"Title of the notebook section: ",this.props.section.title,vscpp("br",null),"Description of the notebok section: ",this.props.section.content,vscpp("br",null),"Given this information, write all the code for this section and this section only.",vscpp("br",null),"The request to generate the outline of the notebook is already completed.",vscpp("br",null),"Here is the request details for the outline generation:",vscpp("br",null),vscpp("br",null),"Code in the notebook so far:",vscpp("br",null),vscpp("br",null),this.props.existingCode,vscpp("br",null),vscpp("br",null),"Please make sure the new code you generate works fine with the code above.",vscpp("br",null))))}},ez=class extends X{render(e,r){let n=[];for(let o of this.props.messages)switch(o.role){case"user":n.push(vscpp(Eu.UserMessage,{priority:800},o.content));break;case"assistant":n.push(vscpp(Eu.AssistantMessage,{priority:800},o.content));break;case"system":n.push(vscpp(Eu.SystemMessage,{priority:100},o.content));break;default:break}return vscpp(vscppf,null,n)}},T3=class extends X{async prepare(){return{}}render(e,r){return vscpp(vscppf,null,vscpp(vscppf,null,vscpp(Eu.SystemMessage,{priority:1e3},"You are an AI that improves Python code with respect to readability and performance for a single section of a Jupyter notebook.",vscpp("br",null),vscpp(Br,null),vscpp(Gs,null),vscpp(Xt,null),"You MUST return Python code as your answer.",vscpp("br",null),"DO NOT explain in inline comments for your the improvements.",vscpp("br",null),"You should not print messages to explain the code or purpose of the code.",vscpp("br",null),"Make sure the new code you generate works fine with the code above.",vscpp("br",null),"Make sure if a module is already imported in the code above, it can be used in the new code directly without importing it again. For the same reason, if a variable is defined above, it can be used in new code as well. ",vscpp("br",null),"Make sure to return the code only - don't give an explanation of the improvements.",vscpp("br",null)),vscpp(Eu.UserMessage,{priority:900},"Overall topic of the notebook: ",this.props.description,vscpp("br",null),"Title of the notebook section: ",this.props.section.title,vscpp("br",null),"Description of the notebook section: ",this.props.section.content,vscpp("br",null),"Code in the notebook so far:",vscpp("br",null),vscpp("br",null),this.props.existingCode,vscpp("br",null),vscpp("br",null),"Given this information, suggest improvements for the following code:",vscpp("br",null),vscpp("br",null),this.props.code,vscpp("br",null),vscpp("br",null))))}};var E3=class{constructor(){this.stagedTextToApply="";this.reporting=!0;this._appliedText="";this._resolvedContentDeferredPromise=new Of;this._incodeblock=!1;this._presentCodeblockProgress=!1}async processResponse(e,r,n,o,s){for await(let{delta:a}of n){if(s.isCancellationRequested)return this._appliedText;this.applyDelta(a.text,e,o)}return this._appliedText}applyDeltaToTurn(e,r){r.response||(r.response={message:e,type:"model"}),this._appliedText+=e,r.response.message+=e}applyDeltaToProgress(e,r){r.markdown(e)}applyDelta(e,r,n){if(!this.reporting){this.applyDeltaToTurn(e,r);return}if(e=this.stagedTextToApply+e,this._incodeblock){let s=e.indexOf("```");if(s===-1){this.stagedTextToApply=e,this.applyDeltaToTurn("",r),this._presentCodeblockProgress||(this._presentCodeblockProgress=!0,n.progress(tz.t("Thinking ...")));return}else{this._incodeblock=!1,e=e.substring(0,s)+"```";try{this.applyDeltaToTurn(e,r)}catch{}finally{this.reporting=!1,this.stagedTextToApply="",this._resolvedContentDeferredPromise.complete(new ls(""))}return}}let o=e.indexOf("```");if(o!==-1){this._incodeblock=!0;let s=e.indexOf("```",o+3);if(s!==-1){this._incodeblock=!1,this.applyDeltaToProgress(e.substring(0,o),n),this.applyDeltaToProgress(e.substring(s+3),n),this.applyDeltaToTurn(e,r),this.reporting=!1,this.stagedTextToApply="";return}else{let a=e.substring(0,o);this.applyDeltaToProgress(a,n),this.applyDeltaToTurn(e,r),this.stagedTextToApply="",this._presentCodeblockProgress||(this._presentCodeblockProgress=!0,n.progress(tz.t("Thinking ..."))),this._resolvedContentDeferredPromise.p.then(c=>n.push(c));return}}this.applyDeltaToProgress(e,n),this.applyDeltaToTurn(e,r),this.stagedTextToApply=""}};async function Xde(t,e,r,n,o,s,a,c){let u={messageSource:"slash.newNotebook"},{messages:l}=await ki(t.get(K),e,C3,{history:n,description:o,section:s,existingCode:a}),p=await t.get(Ct).fetchOne("newNotebookCodeCell",l,void 0,c,2,e,void 0,{temperature:r.temperature,top_p:r.topP},u);if(p.type!=="success")return;let f=Fs(p.value);return f.length>0?f[0].code:p.value}async function Jde(t,e,r,n,o,s,a,c){let u={messageSource:"slash.newNotebook"},{messages:l}=await ki(t.get(K),e,T3,{description:n,section:o,existingCode:s,code:a}),p=await t.get(Ct).fetchOne("improveNotebookCodeCell",l,void 0,c,2,e,void 0,{temperature:r.temperature,top_p:r.topP},u);if(p.type==="success")return p.value}var nz=H(Gt());var Zn=ie("ITerminalService");var oI=H(nt());var Zde=H(nt());var lm=class extends X{constructor(r,n){super(r);this._terminalService=n}static{this.variableInfo={name:"terminalLastCommand",description:"The active terminal's last run command",defaultEnablement:!0}}async prepare(){return this._terminalService.terminalLastCommand}render(r,n){if(!r)return;let o=[];r.commandLine&&(o.push("The following is the last command run in the terminal:"),o.push(r.commandLine)),r.cwd&&(o.push("It was run in the directory:"),o.push(typeof r.cwd=="object"?r.cwd.toString():r.cwd)),r.output&&(o.push("It has the following output:"),o.push(r.output));let s=o.join(`
`);return vscpp(vscppf,null,vscpp(Zde.UserMessage,{priority:this.props.priority},"The active terminal's last run command:",vscpp("br",null),s))}};lm=w([b(1,Zn)],lm);var rz=H(nt());var iI=class extends X{constructor(r,n){super(r);this._terminalService=n}static{this.variableInfo={name:"terminalSelection",description:"The active terminal's selection",defaultEnablement:!0}}async prepare(){return this._terminalService.terminalSelection}render(r,n){return r.trim().length===0?vscpp(vscppf,null,vscpp(rz.UserMessage,{priority:this.props.priority},"The active terminal has no selection.")):vscpp(vscppf,null,vscpp(rz.UserMessage,{priority:this.props.priority},"The active terminal's selection:",vscpp("br",null),r))}};iI=w([b(1,Zn)],iI);var w3=class extends X{render(e){let{query:r,history:n,chatVariables:o,customInstructions:s}=this.props.promptContext;return vscpp(vscppf,null,vscpp(oI.SystemMessage,{priority:1e3},"You are a programmer who specializes in using the command line. Your task is to help the Developer by giving a detailed answer to their query.",vscpp("br",null),vscpp(Br,null),vscpp(Rt,null),vscpp(Vi,null),vscpp(Xt,null),vscpp("br",null),"Additional Rules",vscpp("br",null),`Generate a response that clearly and accurately answers the user's question. In your response, follow the following:
- Provide any command suggestions using the active shell and operating system.
- Say "I'm not quite sure how to do that." when you aren't confident in your explanation`,vscpp("br",null)),vscpp(Ot,{flexGrow:1,priority:600,history:n}),vscpp(oI.UserMessage,{flexGrow:1,priority:750},vscpp(Or,{customInstructions:s,languageId:void 0})),vscpp(oI.UserMessage,{flexGrow:1,priority:800},"The active terminal's shell type is:",vscpp("br",null),this.props.shellType),vscpp(oI.UserMessage,{flexGrow:1,priority:800},"The active operating system is:",vscpp("br",null),this.props.osName),vscpp(iI,{flexGrow:1,priority:800}),vscpp(lm,{flexGrow:1,priority:800}),vscpp(pr,{priority:899,...this.props,flexGrow:2}),vscpp(Jr,{flexGrow:2,priority:900,chatVariables:o,query:r}))}};var Hl=class{constructor(e,r){this.instantiationService=e;this.endpointProvider=r;this.id=Hl.ID;this.locations=[2];this.description=nz.t("Explain what just happened in the terminal");this.commandInfo={allowsEmptyArgs:!0,defaultEnablement:!0,sampleRequest:nz.t("What did the last command do?")}}static{this.ID="terminalExplain"}static{this.intentName="explain"}get intentDetectionInput(){let e="explain_terminal_state";return{functionName:e,sampleQuestion:"What did the last command do?",functionCallingBlurb:`If the user's message is about explaining what happened in the terminal, you should use the '${e}' function.`}}async invoke(e){let r=e.location,n=await this.endpointProvider.getEndpointForLocation(r);return this.instantiationService.createInstance(sP,this,n,r)}};Hl=w([b(0,K),b(1,Se)],Hl);var sP=class{constructor(e,r,n,o,s,a){this.intent=e;this.endpoint=r;this.location=n;this.instantiationService=o;this.envService=s;this.terminalService=a}async buildPrompt(e,r,n){let o=this.envService.OS,s=this.terminalService.terminalShellType;return await Be.create(this.instantiationService,this.endpoint,w3,{promptContext:e,osName:o,shellType:s,endpoint:this.endpoint}).render(r,n)}};sP=w([b(3,K),b(4,St),b(5,Zn)],sP);var by=H(Gt()),fn=H(require("vscode"));function epe(t){let e=new ht,r=t.get(Iu);return r.setEnablement(t.get(wt)),G7e(e,t.get(he)),z7e(r,t.get(be),e),V7e(e),e}function V7e(t){async function e(r){let n=Os.first(r.entries());if(!n)return;await fn.workspace.applyEdit(r,{isRefactoring:!0});let o=await fn.workspace.openTextDocument(n[0]);await fn.window.showTextDocument(o,{preview:!0,selection:n[1][0].range})}t.add(fn.commands.registerCommand("github.copilot.tests.fixTestFailure.applyAndRerun",async(r,n,o)=>{await e(n),await iS(1e3),fn.commands.executeCommand("testing.reRunFailTests");let s=await new Promise(d=>{let p=fn.tests.onDidChangeTestResults(()=>{fn.tests.testResults.length&&(d(fn.tests.testResults[0]),p.dispose())})}),a=$7e(r,s.results);if(a===void 0||!a.taskStates.some(d=>d.state===fn.TestResultState.Failed||d.state===fn.TestResultState.Errored))return;let c=by.t("Undo"),u=by.t("Try Fixing Again"),l=await fn.window.showInformationMessage(by.t("Looks like the test still failed. What would you like to do?"),by.t("Keep Changes"),c,u);if(l===u){let d=$N(a.taskStates,p=>p.messages.find(f=>!!f.location));d?fn.commands.executeCommand("github.copilot.tests.fixTestFailure",{message:d,test:a,source:"retry"}):fn.commands.executeCommand("vscode.editorChat.start",{message:"/fixTestFailure",autoSend:!0})}else l===c&&await e(o)}))}function G7e(t,e){t.add(fn.commands.registerCommand("github.copilot.tests.fixTestFailure",async r=>{if(!r.test.uri)return;e.sendMSFTTelemetryEvent("intent.fixTestFailure.actioned",{source:r.source??"testResultsPanel"});let n=await fn.workspace.openTextDocument(r.test.uri);await fn.window.showTextDocument(n,{preserveFocus:!1,preview:!0,selection:r.test.range?new fn.Range(r.test.range.start,r.test.range.start):void 0}),await fn.commands.executeCommand("vscode.editorChat.start",{message:"/fixTestFailure",autoSend:!0})}))}function z7e(t,e,r){r.add(fn.languages.registerCodeActionsProvider("*",{provideCodeActions(n,o,s,a){if(!e.getConfig(de.EnableCodeActions)||!t.isEnabled.get())return;let u=t.getFailureAtPosition(n.uri,o.start);if(!u)return;let l=new fn.CodeAction(by.t("Fix test failure"),fn.CodeActionKind.QuickFix);return l.isAI=!0,l.command={title:by.t("Fix test failure"),command:"github.copilot.tests.fixTestFailure",arguments:[{message:u.task.messages[0],test:u.snapshot,source:"sparkles"}]},[l]}}))}function $7e(t,e){let r=[];for(let n=t;n;n=n.parent)r.push(n.id);for(let n=r.length-1;n>=0;n--){let o=r[n],s=e.find(a=>a.id===o);if(!s)return;if(n===0)return s;e=s.children}}var R3=H(require("vscode"));function tpe(t){return t.createInstance(aP)}var aP=class extends ht{constructor(r){super();this.configurationService=r;this.add(R3.workspace.onDidChangeConfiguration(n=>{n.affectsConfiguration(de.StartDebuggingIntent.fullyQualifiedId)&&this.updateContextKey()})),this.updateContextKey()}updateContextKey(){R3.commands.executeCommand("setContext","github.copilot.advanced.startDebugging.experimental.enabled",this.configurationService.getConfig(de.StartDebuggingIntent))}};aP=w([b(0,be)],aP);var vs=H(require("vscode"));var dm=class{constructor(e,r){this.logService=e;this.parserService=r;this.store=new ht,this.onDidChangeCodeLenses=vs.tests.onDidChangeTestResults}static{this.codeLensTitle=vs.l10n.t("Generate tests using Copilot")}static isEnabled(e){return e.getConfig(de.GenerateTestsCodeLens)}provideCodeLenses(e,r){return this.computeCodeLens(e,r)}async computeCodeLens(e,r){if(e.uri.scheme==="output")return[];let n=vs.tests.testResults;if(n.length===0)return this.logService.public.debug("No test results"),[];let o=n[0],s;try{s=await o.getDetailedCoverage?.(e.uri,r)}catch(c){return this.logService.public.error(c),[]}if(!s||s.length===0)return this.logService.public.debug("No detailed coverage"),[];let a=[];for(let c of s)if(c instanceof vs.DeclarationCoverage){if(this.logService.public.debug(`Received statement coverage for ${c.name}. (detail.executed: ${c.executed})`),!!c.executed)continue;let l=c.location instanceof vs.Range?c.location:new vs.Range(c.location,c.location);a.push(this.createCodeLens(e,l))}else c instanceof vs.StatementCoverage?this.logService.public.debug("Received statement coverage; did nothing"):this.logService.public.error("Unexpected coverage type");if(a.length===0){let c=this.parserService.getTreeSitterAST(e);if(c===void 0)return a;let u=await c.getTestableNodes();if(u===null)return a;let l=s.flatMap(p=>p.executed?[]:p.location instanceof vs.Position?[p.location.line]:this.toLineNumbers(p.location)),d=new Set(l);for(let p of u){let f=e.positionAt(p.node.startIndex),m=e.positionAt(p.node.endIndex),h=new vs.Range(f,m);yoe(f.line,m.line).every(g=>d.has(g))&&a.push(this.createCodeLens(e,h))}}return a}createCodeLens(e,r){return new vs.CodeLens(r,{title:dm.codeLensTitle,command:"github.copilot.interactiveEditor.generateTests",arguments:[{document:e,selection:r}]})}toLineNumbers(e){let r=[];for(let n=e.start.line;n<=e.end.line;n++)r.push(n);return r}dispose(){this.store.dispose()}};dm=w([b(0,oe),b(1,_t)],dm);var npe=H(Gt()),Zr=H(require("vscode"));function k3(t,e){if(!e.length)return;let r;for(let n of t)if(n.children){let o=n.name===e[0]?{symbol:n,matchCount:1}:void 0;if(o){let c=k3(n.children,e.slice(1));c&&(o={symbol:c.symbol,matchCount:o.matchCount+c.matchCount})}let s=k3(n.children,e),a;o&&s?a=o.matchCount>=s.matchCount?o:s:a=o??s,a&&(!r||a.matchCount>r?.matchCount)&&(r=a)}else n.name===e[0]&&(r??={symbol:n,matchCount:1});return r}function rpe(t,e){return(k3(t,[e])??k3(t,W7e(e)))?.symbol}function W7e(t){return Array.from(t.matchAll(/[#\w$][\w\d$]*/g),e=>e[0])}var P3="_github.copilot.openSymbolFromReferences";function ipe(t){return Yx(Zr.commands.registerCommand(ev,async(...[e,r])=>{t.sendMSFTTelemetryEvent("panel.action.filelink",{requestId:r});let n=Zr.workspace.workspaceFolders?.[0].uri;if(!n)return;let o=typeof e=="string"?Zr.Uri.joinPath(n,e):Zr.Uri.from(e);if(await s(o))await Zr.commands.executeCommand("revealInExplorer",o);else return Zr.commands.executeCommand("vscode.open",o);async function s(a){if(a.path.endsWith("/"))return!0;try{return(await Zr.workspace.fs.stat(a)).type===Zr.FileType.Directory}catch{return!1}}}),Zr.commands.registerCommand($1,async(...[e,r,n])=>{let o=Zr.Uri.from(e),s;try{s=await Zr.commands.executeCommand("vscode.executeDocumentSymbolProvider",o)}catch(a){console.error(a)}if(s?.length){let a=rpe(s,r);if(t.sendMSFTTelemetryEvent("panel.action.symbollink",{requestId:n},{hadMatch:a?1:0}),a){let c=a instanceof Zr.SymbolInformation?a.location.range:a.selectionRange;return Zr.commands.executeCommand("vscode.open",o,{selection:new Zr.Range(c.start,c.start)})}}return Zr.commands.executeCommand("vscode.open",o)}),Zr.commands.registerCommand(P3,async(...[e,r,n])=>{let o;for(let s of r)try{let a=(await Zr.commands.executeCommand("vscode.executeDefinitionProvider",Zr.Uri.from(s.uri),s.pos)).at(0);if(a){o={type:"definition",loc:K7e(a)};break}}catch(a){console.error(a)}if(!o){let s=r.at(0);s&&(o={type:"firstOccurrence",loc:new Zr.Location(Zr.Uri.from(s.uri),s.pos)})}return t.sendMSFTTelemetryEvent("panel.action.openSymbolFromReferencesLink",{requestId:n,resolvedDestinationType:o?.type??"unresolved"}),o?Zr.commands.executeCommand("vscode.open",o.loc.uri,{selection:new Zr.Range(o.loc.range.start,o.loc.range.start)}):Zr.window.showWarningMessage((0,npe.t)("Could not resolve this symbol in the current workspace."))}))}function K7e(t){return"uri"in t?t:new Zr.Location(t.targetUri,t.targetRange)}var ope=H(Gt());var Fc=H(require("vscode"));async function A3(t,e,r,n,o){let s=t.get(_t),a=n.symbolMatchesOnly??!1,c=[],u=n.maxResultCount??1/0,l=new kd(10);try{await Promise.all(e.map(d=>l.queue(async()=>{if(c.length>=u||o.isCancellationRequested)return;let p;PR(d.anchor)?p=await iz(s,r,d.anchor,new Fc.Range(0,0,Number.MAX_SAFE_INTEGER,0),a,o):"range"in d.anchor?p=await iz(s,r,d.anchor.uri,d.anchor.range,a,o):"value"in d.anchor&&Ye.isUri(d.anchor.value)&&(p=await iz(s,r,d.anchor.value,new Fc.Range(0,0,Number.MAX_SAFE_INTEGER,0),a,o)),p&&c.push(p)})))}finally{l.dispose()}return c.sort((d,p)=>p.type-d.type).map(d=>d.location).slice(0,n.maxResultCount)}async function iz(t,e,r,n,o,s){let a=await Y7e(r);if(!a||s.isCancellationRequested)return;let c=await Q7e(t,a,n,s);if(s.isCancellationRequested)return;for(let d of c)if(d.identifier===e){let p=a.positionAt(d.startIndex);return{type:2,location:new Fc.Location(r,p)}}if(o)return;let u=a.getText(n),l=a.offsetAt(n.start);for(let d of u.matchAll(new RegExp(Vb(e),"g")))if(d.index){let p=a.positionAt(l+d.index);if("getWordRangeAtPosition"in a){let f=a.getText(a.getWordRangeAtPosition(p));if(e===f)return{type:1,location:new Fc.Location(r,p)}}else{let f=a.getText(new Fc.Range(p,a.positionAt(a.offsetAt(p)+e.length)));if(e===f)return{type:1,location:new Fc.Location(r,p)}}}}async function Y7e(t){let e=Fc.workspace.textDocuments.find(r=>r.uri.toString()===t.toString());if(e)return e;try{let r=await Fc.workspace.fs.readFile(t),n=ha(t).languageId,o=f1.create(t.toString(),n,0,new TextDecoder().decode(r));return new class{constructor(){this.languageId=n}getText(s){return o.getText(s)}offsetAt(s){return o.offsetAt(s)}positionAt(s){let a=o.positionAt(s);return new Fc.Position(a.line,a.character)}}}catch{return}}async function Q7e(t,e,r,n){let o=Ol(e.languageId);if(!o)return[];let s=t.getTreeSitterASTForWASMLanguage(o,e.getText());return s?s.getSymbols({startIndex:e.offsetAt(r.start),endIndex:e.offsetAt(r.end)}):[]}var sI=class{constructor(e,r){this.maxPotentialWordMatches=e;this.instantiationService=r;this.cache=new Map}async resolve(e,r,n){if(!r.length)return;let o=this.cache.get(e);if(o)return o;{let s=this.doResolve(e,r,n);return this.cache.set(e,s),s}}async doResolve(e,r,n){let o=await this.instantiationService.invokeFunction(s=>A3(s,r,e,{maxResultCount:this.maxPotentialWordMatches},n));if(!n.isCancellationRequested){if(!o.length){let s=e.split(/([#\w$][\w\d$]*)/g).map(c=>c.trim()).filter(c=>c.length),a;for(let c of s){if(!/[#\w$][\w\d$]*/.test(c))break;a=c}if(a&&a!==e&&(o=await this.instantiationService.invokeFunction(c=>A3(c,r,a,{symbolMatchesOnly:!0,maxResultCount:this.maxPotentialWordMatches},n)),n.isCancellationRequested))return}return o.slice(0,this.maxPotentialWordMatches)}}};sI=w([b(1,K)],sI);var X7e=/(?<!\[)`([^`\n]+)`(?!\])/g,J7e=8,aI=class{constructor(e){this.resolver=e.createInstance(sI,J7e)}async linkify(e,r,n){if(!r.references.length)return;let o=0,s=await zb(e,X7e,async(a,c)=>{let u=await this.resolver.resolve(c,r.references,n);return u?.length?(o++,this.createOpenSymbolCommand(u,a,r.requestId)):a});if(o)return{text:s,trustedCommands:[P3],addedLinkCount:o}}createOpenSymbolCommand(e,r,n){let o=rp(P3,["",e.map(s=>({uri:Jk(s.uri),pos:s.range.start})),n]);return`[${r}](${o} "${(0,ope.t)("Go to definition")}")`}};aI=w([b(0,K)],aI);function sz(t){return/^[a-z][a-z0-9]*$/.test(t)?"lowercase":/^[a-z][a-zA-Z0-9]*$/.test(t)?"camelCase":/^[a-z]+(_[a-z0-9]+)*$/.test(t)?"snake_case":/^[a-z]+(-[a-z0-9]+)*$/.test(t)?"kebab-case":/^[A-Z][a-z0-9]*$/.test(t)?"Capitalized":/^[A-Z0-9]+(_[A-Z0-9]+)+$/.test(t)?"SCREAMING_SNAKE_CASE":/^[A-Z]+$/.test(t)?"Uppercase":/^[A-Z][a-zA-Z0-9]*$/.test(t)?"PascalCase":/^[A-Z][a-z0-9]*(_[a-z0-9]+)*$/.test(t)?"Capital_snake_case":"Unknown"}function oz(t){return t.map((e,r)=>r===0?e.toLowerCase():e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()).join("")}function Z7e(t){return t.map(e=>e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()).join("")}function D3(t){return t.map(e=>e.toLowerCase()).join("_")}function eUe(t){return t.map(e=>e.toLowerCase()).join("-")}function spe(t,e){let r=sz(t);if(r===e)return t;{let n=tUe(t,r);switch(e){case"camelCase":return oz(n);case"PascalCase":return Z7e(n);case"snake_case":return D3(n);case"SCREAMING_SNAKE_CASE":return D3(n).toUpperCase();case"Capital_snake_case":return D3(n).charAt(0).toUpperCase()+D3(n).substring(1);case"kebab-case":return eUe(n);case"Capitalized":return oz(n).charAt(0).toUpperCase()+oz(n).substring(1);case"Uppercase":return t.toUpperCase();case"lowercase":return t.toLowerCase();case"Unknown":return t}}}function tUe(t,e){switch(e){case"camelCase":case"PascalCase":return t.split(/(?=[A-Z])/);case"snake_case":case"SCREAMING_SNAKE_CASE":case"Capital_snake_case":case"kebab-case":return t.split(/[-_]/).map(r=>r.toLowerCase());case"Capitalized":case"Uppercase":case"lowercase":case"Unknown":return[t]}}var uI=H(nt());var ape=H(nt());var av=class extends ape.PromptElement{constructor(r,n,o,s,a,c,u,l){super(r);this._languageFeaturesService=n;this._workspaceService=o;this._vscodeExtensionCtxService=s;this._ignoreService=a;this._logService=c;this._parserService=u;this._telemetryService=l}static{this.DEFAULT_TIMEOUT_MS=200}async prepare(){if(await this._ignoreService.isCopilotIgnored(this.props.document.uri))return{k:"ignored"};let r=this._vscodeExtensionCtxService.extensionMode===au.Test?0:this.props.timeoutMs===void 0?av.DEFAULT_TIMEOUT_MS:this.props.timeoutMs,n=await this.findDefinition(r);return this._logService.internal.debug(`Found ${n.length} implementation(s)/definition(s)`),n.length>0&&this._logService.internal.debug("Implementation(s)/definition(s) found:"+JSON.stringify(n,null,"	")),{k:"found",definitions:n}}render(r,n){if(r.k==="ignored")return vscpp("ignoredFiles",{value:[this.props.document.uri]});let{document:o,position:s}=this.props,{definitions:a}=r;if(a.length===0){let c=o.lineAt(s.line);a.push({languageId:o.languageId,uri:o.uri,code:c.text,excerptRange:c.range})}return vscpp(vscppf,null,"Relevant definition",a.length>1?"s":"",": ",vscpp("br",null),vscpp("br",null),a.map(c=>{let d=`${`${Ko(c.languageId).lineComment.start} FILEPATH: ${c.uri.path}`}
${c.code}`;return vscpp(Fe,{uri:c.uri,languageId:c.languageId,code:d})}))}async findDefinition(r){let{document:n,position:o}=this.props,s=async u=>{try{let l=await this._languageFeaturesService.getImplementations(n.uri,u);if(this._logService.internal.debug(`Found ${l.length} implementations`+JSON.stringify(l,null,"	")),l.length>0)return l}catch{}try{let l=await this._languageFeaturesService.getDefinitions(n.uri,u);if(this._logService.internal.debug(`Found ${l.length} definitions`+JSON.stringify(l,null,"	")),l.length>0)return l}catch{}return this._logService.internal.debug("No definitions or implementations found"),[]},a=await Ka(this._logService,this._telemetryService,n,r*3,()=>s(o),[]),c=Nr(await Promise.all(a.map(async u=>{let l=Wf(u)?u.targetUri:n.uri;return await this._ignoreService.isCopilotIgnored(l)?void 0:u})));return Promise.all(c.map(async u=>{let{uri:l,range:d}=Wf(u)?{uri:u.targetUri,range:u.targetRange}:u,p=await this._workspaceService.openTextDocument(l),f=Ol(p.languageId),m,h;if(f===void 0){let g=p.lineAt(d.start.line);m=g.text,h=g.range}else h=(await xg(this._parserService,this._telemetryService,{document:p,language:Ko(n.languageId),wholeRange:d,selection:new fS(d.start,d.end),fileIndentInfo:void 0})).range,m=p.getText(h);return{languageId:p.languageId,uri:p.uri,code:m,excerptRange:h}}))}};av=w([b(1,Co),b(2,Ve),b(3,jt),b(4,ke),b(5,oe),b(6,_t),b(7,he)],av);var cI=class extends uI.PromptElement{constructor(r,n,o){super(r);this.instaService=n;this.endpointProvider=o;let{document:s,range:a}=this.props;this._defAtPos=n.createInstance(new Me(av,[{document:s,position:a.start}]))}async prepare(r,n,o){let{document:s,range:a}=this.props,c=await this._defAtPos.prepare();if(!(c.k==="found"&&c.definitions.some(d=>d.excerptRange.contains(this.props.range)))){let d=await this.endpointProvider.getChatEndpoint("gpt-3.5-turbo"),p={document:s,fileIndentInfo:void 0,language:Ko(s.languageId),wholeRange:a,selection:new fS(a.start,a.end)};this._defAroundCursor=this.instaService.createInstance(_g,{documentContext:p,endpointInfo:d})}return{defAtPositionState:c,defAroundCursorState:this._defAroundCursor?await this._defAroundCursor.prepare(r):void 0}}render(r,n){let{document:o,range:s}=this.props,a=o.getText(s),c=rUe(a),u=c?` keeping prefix '${c}'`:"",l=this._defAtPos.render(r.defAtPositionState,n),d=r.defAroundCursorState!==void 0&&this._defAroundCursor?.render(r.defAroundCursorState,n);return vscpp(vscppf,null,vscpp(uI.SystemMessage,null,"You are a distinguished software engineer.",vscpp("br",null),vscpp(Rt,null),vscpp("br",null),'You must reply with a JSON array of strings of at least four new names, e.g., `["first", "second", "third", "fourth"]`.',vscpp("br",null),"You must respect existing naming conventions",u,"."),d,vscpp(uI.UserMessage,null,l!==void 0&&vscpp(vscppf,null,l,vscpp("br",null)),"Think of the purpose of `",a,"` in the given code. Think of several names that reflect what `",a,"` is and what it does",u,". Follow existing naming conventions. Reply with a JSON array of strings of at least four new names for `",a,"`."))}};cI=w([b(1,K),b(2,Se)],cI);function rUe(t){return t.match(/^([\\.\\$\\_]+)/)?.[0]}var Vl=class{constructor(e,r,n,o,s,a,c){this._instaService=e;this._chatMLFetcher=r;this._ignoreService=n;this._telemetryService=o;this._configurationService=s;this._endpointProvider=a;this._simulationTestContext=c;this.supportsAutomaticTriggerKind=Promise.resolve(this.isEnabled(rk.Automatic))}isEnabled(e){return e===rk.Invoke?!0:this._configurationService.getConfig(de.AutomaticRenameSuggestions)}async provideNewSymbolNames(e,r,n,o){let s="",a=new yo,c=e.getText(r);if(!this.isEnabled(n))throw new Error("CopilotFeatureUnavailableOrDisabled");if(await this._ignoreService.isCopilotIgnored(e.uri))throw new Error("CopilotIgnoredDocument");let u=e.languageId,l,d;if(o.isCancellationRequested)s="afterEnablementCheck";else{let p=await this._endpointProvider.getChatEndpoint("gpt-3.5-turbo");if(l=this.delayBeforeFetchMs,o.isCancellationRequested)s="afterRunParametersFetch";else{let f=new yo(!1);f.reset();let m=await this._computePrompt(e,r,p,o),h=f.elapsed();if(o.isCancellationRequested)s="afterPromptCompute";else{d=a.elapsed();let g;if(n===rk.Automatic&&(g=l?Math.max(0,l-d):void 0,g!==void 0&&g>0&&await new Promise(v=>setTimeout(v,g))),o.isCancellationRequested)s="afterDelay";else{f.reset();let v=await this._chatMLFetcher.fetchOne("renameSuggestionsProvider",m.messages,void 0,o,3,p,{agent:"symbol-names"},void 0,{messageSource:"symbolNamesProvider"}),y=f.elapsed();switch(o.isCancellationRequested&&(s="afterFetchStarted"),v.type){case"success":{let _=v.value,{replyFormat:x,symbolNames:S,redundantCharCount:I}=Vl.parseResponse(_);return x==="unknown"&&this._sendInternalTelemetry({languageId:u,reply:_}),this._sendPublicTelemetry({triggerKind:n,languageId:u,cancellationReason:s,fetchResultType:v.type,promptConstructionTime:h,promptTokenCount:m.tokenCount,expectedDelayBeforeFetch:l,actualDelayBeforeFetch:g,timeElapsedBeforeDelay:d,successResponseCharCount:_.length,responseUnusedCharCount:I,fetchTime:y,replyFormat:x,symbolNamesCount:S.length}),Vl.preprocessSymbolNames({currentSymbolName:c,newSymbolNames:S,languageId:u}).map(R=>new Aae(R,[Dae.AIGenerated]))}default:return this._sendPublicTelemetry({triggerKind:n,languageId:u,cancellationReason:s,fetchResultType:v.type,promptConstructionTime:h,promptTokenCount:m.tokenCount,expectedDelayBeforeFetch:l,actualDelayBeforeFetch:g,timeElapsedBeforeDelay:d,fetchTime:y}),null}}}}}return this._sendPublicTelemetry({triggerKind:n,languageId:u,cancellationReason:s,expectedDelayBeforeFetch:l,timeElapsedBeforeDelay:d}),null}get delayBeforeFetchMs(){return this._simulationTestContext.isInSimulationTests?0:250}_computePrompt(e,r,n,o){return Be.create(this._instaService,n,cI,{document:e,range:r}).render(void 0,o)}static preprocessSymbolNames({currentSymbolName:e,newSymbolNames:r,languageId:n}){let o=sz(e),s;switch(o){case"lowercase":n==="python"?s="snake_case":s="camelCase";break;case"Uppercase":case"camelCase":case"PascalCase":case"snake_case":case"SCREAMING_SNAKE_CASE":case"Capital_snake_case":case"kebab-case":case"Capitalized":case"Unknown":s=o;break;default:return o}return s==="Unknown"?r:r.map(a=>spe(a,s))}static parseResponse(e){let r=Vl._parseReplyAsJSONStringArray(e);if(r!==void 0)return r;let n=Vl._parseReplyAsList(e);return n!==void 0?n:{replyFormat:"unknown",symbolNames:[],redundantCharCount:e.length}}static _parseReplyAsJSONStringArray(e){let r=/\[.*?\]/gs,n=[...e.matchAll(r)];for(let o=0;o<n.length;o++){let s=n[o];try{let a=JSON.parse(s[0]);if(Array.isArray(a)){let c=a.filter(u=>typeof u=="string");if(c.length>0){let u=o===0?"jsonStringArray":"multiJsonStringArray",l=e.length-s[0].length;return{replyFormat:u,redundantCharCount:l,symbolNames:c.map(d=>d.trim())}}}}catch{}}}static _parseReplyAsList(e){let r=/(?:\d+[\.|\)]|[\*\-])\s*(.*)/g,n=e.matchAll(r),o=[];for(let a of n){let c=a[1].trim(),u=["'",'"',"`"];u.includes(c[0])&&(c=c.slice(1)),u.includes(c[c.length-1])&&(c=c.slice(0,-1)),c&&o.push(c)}return o.length===0?void 0:{replyFormat:"list",redundantCharCount:e.length-o.reduce((a,c)=>a+c.length,0),symbolNames:o}}_sendPublicTelemetry({triggerKind:e,languageId:r,cancellationReason:n,fetchResultType:o,timeElapsedBeforeDelay:s,promptConstructionTime:a,promptTokenCount:c,expectedDelayBeforeFetch:u,actualDelayBeforeFetch:l,successResponseCharCount:d,responseUnusedCharCount:p,fetchTime:f,replyFormat:m,symbolNamesCount:h}){this._telemetryService.sendMSFTTelemetryEvent("provideRenameSuggestions",{languageId:r,cancellationReason:n,fetchResultType:o,replyFormat:m,triggerKind:e===rk.Automatic?"automatic":"manual"},{promptConstructionTime:a,promptTokenCount:c,expectedDelayBeforeFetch:u,actualDelayBeforeFetch:l,timeElapsedBeforeFetch:s,fetchTime:f,successResponseCharCount:d,responseUnusedCharCount:p,symbolNamesCount:h})}_sendInternalTelemetry({languageId:e,reply:r}){this._telemetryService.sendMSFTTelemetryEvent("provideRenameSuggestionsIncorrectFormatResponse",{languageId:e,reply:r})}static _determinePrefix(e){return e.match(/^([\\.\\$\\_]+)/)?.[0]}};Vl=w([b(0,K),b(1,Ct),b(2,ke),b(3,he),b(4,be),b(5,Se),b(6,Qf)],Vl);var _y=H(require("vscode"));var op=H(Gt());function N3(t,e=!1){let r=t.length,n=0,o="",s=0,a=16,c=0,u=0,l=0,d=0,p=0;function f(x,S){let I=0,E=0;for(;I<x||!S;){let R=t.charCodeAt(n);if(R>=48&&R<=57)E=E*16+R-48;else if(R>=65&&R<=70)E=E*16+R-65+10;else if(R>=97&&R<=102)E=E*16+R-97+10;else break;n++,I++}return I<x&&(E=-1),E}function m(x){n=x,o="",s=0,a=16,p=0}function h(){let x=n;if(t.charCodeAt(n)===48)n++;else for(n++;n<t.length&&lI(t.charCodeAt(n));)n++;if(n<t.length&&t.charCodeAt(n)===46)if(n++,n<t.length&&lI(t.charCodeAt(n)))for(n++;n<t.length&&lI(t.charCodeAt(n));)n++;else return p=3,t.substring(x,n);let S=n;if(n<t.length&&(t.charCodeAt(n)===69||t.charCodeAt(n)===101))if(n++,(n<t.length&&t.charCodeAt(n)===43||t.charCodeAt(n)===45)&&n++,n<t.length&&lI(t.charCodeAt(n))){for(n++;n<t.length&&lI(t.charCodeAt(n));)n++;S=n}else p=3;return t.substring(x,S)}function g(){let x="",S=n;for(;;){if(n>=r){x+=t.substring(S,n),p=2;break}let I=t.charCodeAt(n);if(I===34){x+=t.substring(S,n),n++;break}if(I===92){if(x+=t.substring(S,n),n++,n>=r){p=2;break}switch(t.charCodeAt(n++)){case 34:x+='"';break;case 92:x+="\\";break;case 47:x+="/";break;case 98:x+="\b";break;case 102:x+="\f";break;case 110:x+=`
`;break;case 114:x+="\r";break;case 116:x+="	";break;case 117:let R=f(4,!0);R>=0?x+=String.fromCharCode(R):p=4;break;default:p=5}S=n;continue}if(I>=0&&I<=31)if(cP(I)){x+=t.substring(S,n),p=2;break}else p=6;n++}return x}function v(){if(o="",p=0,s=n,u=c,d=l,n>=r)return s=r,a=17;let x=t.charCodeAt(n);if(az(x)){do n++,o+=String.fromCharCode(x),x=t.charCodeAt(n);while(az(x));return a=15}if(cP(x))return n++,o+=String.fromCharCode(x),x===13&&t.charCodeAt(n)===10&&(n++,o+=`
`),c++,l=n,a=14;switch(x){case 123:return n++,a=1;case 125:return n++,a=2;case 91:return n++,a=3;case 93:return n++,a=4;case 58:return n++,a=6;case 44:return n++,a=5;case 34:return n++,o=g(),a=10;case 47:let S=n-1;if(t.charCodeAt(n+1)===47){for(n+=2;n<r&&!cP(t.charCodeAt(n));)n++;return o=t.substring(S,n),a=12}if(t.charCodeAt(n+1)===42){n+=2;let I=r-1,E=!1;for(;n<I;){let R=t.charCodeAt(n);if(R===42&&t.charCodeAt(n+1)===47){n+=2,E=!0;break}n++,cP(R)&&(R===13&&t.charCodeAt(n)===10&&n++,c++,l=n)}return E||(n++,p=1),o=t.substring(S,n),a=13}return o+=String.fromCharCode(x),n++,a=16;case 45:if(o+=String.fromCharCode(x),n++,n===r||!lI(t.charCodeAt(n)))return a=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return o+=h(),a=11;default:for(;n<r&&y(x);)n++,x=t.charCodeAt(n);if(s!==n){switch(o=t.substring(s,n),o){case"true":return a=8;case"false":return a=9;case"null":return a=7}return a=16}return o+=String.fromCharCode(x),n++,a=16}}function y(x){if(az(x)||cP(x))return!1;switch(x){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function _(){let x;do x=v();while(x>=12&&x<=15);return x}return{setPosition:m,getPosition:()=>n,scan:e?_:v,getToken:()=>a,getTokenValue:()=>o,getTokenOffset:()=>s,getTokenLength:()=>n-s,getTokenStartLine:()=>u,getTokenStartCharacter:()=>s-d,getTokenError:()=>p}}function az(t){return t===32||t===9}function cP(t){return t===10||t===13}function lI(t){return t>=48&&t<=57}var cpe;(function(t){t[t.lineFeed=10]="lineFeed",t[t.carriageReturn=13]="carriageReturn",t[t.space=32]="space",t[t._0=48]="_0",t[t._1=49]="_1",t[t._2=50]="_2",t[t._3=51]="_3",t[t._4=52]="_4",t[t._5=53]="_5",t[t._6=54]="_6",t[t._7=55]="_7",t[t._8=56]="_8",t[t._9=57]="_9",t[t.a=97]="a",t[t.b=98]="b",t[t.c=99]="c",t[t.d=100]="d",t[t.e=101]="e",t[t.f=102]="f",t[t.g=103]="g",t[t.h=104]="h",t[t.i=105]="i",t[t.j=106]="j",t[t.k=107]="k",t[t.l=108]="l",t[t.m=109]="m",t[t.n=110]="n",t[t.o=111]="o",t[t.p=112]="p",t[t.q=113]="q",t[t.r=114]="r",t[t.s=115]="s",t[t.t=116]="t",t[t.u=117]="u",t[t.v=118]="v",t[t.w=119]="w",t[t.x=120]="x",t[t.y=121]="y",t[t.z=122]="z",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.asterisk=42]="asterisk",t[t.backslash=92]="backslash",t[t.closeBrace=125]="closeBrace",t[t.closeBracket=93]="closeBracket",t[t.colon=58]="colon",t[t.comma=44]="comma",t[t.dot=46]="dot",t[t.doubleQuote=34]="doubleQuote",t[t.minus=45]="minus",t[t.openBrace=123]="openBrace",t[t.openBracket=91]="openBracket",t[t.plus=43]="plus",t[t.slash=47]="slash",t[t.formFeed=12]="formFeed",t[t.tab=9]="tab"})(cpe||(cpe={}));var L3;(function(t){t.DEFAULT={allowTrailingComma:!1}})(L3||(L3={}));function upe(t,e=[],r=L3.DEFAULT){let n=null,o=[],s=[];function a(u){Array.isArray(o)?o.push(u):n!==null&&(o[n]=u)}return cz(t,{onObjectBegin:()=>{let u={};a(u),s.push(o),o=u,n=null},onObjectProperty:u=>{n=u},onObjectEnd:()=>{o=s.pop()},onArrayBegin:()=>{let u=[];a(u),s.push(o),o=u,n=null},onArrayEnd:()=>{o=s.pop()},onLiteralValue:a,onError:(u,l,d)=>{e.push({error:u,offset:l,length:d})}},r),o[0]}function cz(t,e,r=L3.DEFAULT){let n=N3(t,!1),o=[];function s(ne){return ne?()=>ne(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter()):()=>!0}function a(ne){return ne?()=>ne(n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter(),()=>o.slice()):()=>!0}function c(ne){return ne?q=>ne(q,n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter()):()=>!0}function u(ne){return ne?q=>ne(q,n.getTokenOffset(),n.getTokenLength(),n.getTokenStartLine(),n.getTokenStartCharacter(),()=>o.slice()):()=>!0}let l=a(e.onObjectBegin),d=u(e.onObjectProperty),p=s(e.onObjectEnd),f=a(e.onArrayBegin),m=s(e.onArrayEnd),h=u(e.onLiteralValue),g=c(e.onSeparator),v=s(e.onComment),y=c(e.onError),_=r&&r.disallowComments,x=r&&r.allowTrailingComma;function S(){for(;;){let ne=n.scan();switch(n.getTokenError()){case 4:I(14);break;case 5:I(15);break;case 3:I(13);break;case 1:_||I(11);break;case 2:I(12);break;case 6:I(16);break}switch(ne){case 12:case 13:_?I(10):v();break;case 16:I(1);break;case 15:case 14:break;default:return ne}}}function I(ne,q=[],P=[]){if(y(ne),q.length+P.length>0){let k=n.getToken();for(;k!==17;){if(q.indexOf(k)!==-1){S();break}else if(P.indexOf(k)!==-1)break;k=S()}}}function E(ne){let q=n.getTokenValue();return ne?h(q):(d(q),o.push(q)),S(),!0}function R(){switch(n.getToken()){case 11:let ne=n.getTokenValue(),q=Number(ne);isNaN(q)&&(I(2),q=0),h(q);break;case 7:h(null);break;case 8:h(!0);break;case 9:h(!1);break;default:return!1}return S(),!0}function B(){return n.getToken()!==10?(I(3,[],[2,5]),!1):(E(!1),n.getToken()===6?(g(":"),S(),le()||I(4,[],[2,5])):I(5,[],[2,5]),o.pop(),!0)}function V(){l(),S();let ne=!1;for(;n.getToken()!==2&&n.getToken()!==17;){if(n.getToken()===5){if(ne||I(4,[],[]),g(","),S(),n.getToken()===2&&x)break}else ne&&I(6,[],[]);B()||I(4,[],[2,5]),ne=!0}return p(),n.getToken()!==2?I(7,[2],[]):S(),!0}function M(){f(),S();let ne=!0,q=!1;for(;n.getToken()!==4&&n.getToken()!==17;){if(n.getToken()===5){if(q||I(4,[],[]),g(","),S(),n.getToken()===4&&x)break}else q&&I(6,[],[]);ne?(o.push(0),ne=!1):o[o.length-1]++,le()||I(4,[],[4,5]),q=!0}return m(),ne||o.pop(),n.getToken()!==4?I(8,[4],[]):S(),!0}function le(){switch(n.getToken()){case 3:return M();case 1:return V();case 10:return E(!0);default:return R()}}return S(),n.getToken()===17?r.allowEmptyContent?!0:(I(4,[],[]),!1):le()?(n.getToken()!==17&&I(9,[],[]),!0):(I(4,[],[]),!1)}var lpe;(function(t){t[t.None=0]="None",t[t.UnexpectedEndOfComment=1]="UnexpectedEndOfComment",t[t.UnexpectedEndOfString=2]="UnexpectedEndOfString",t[t.UnexpectedEndOfNumber=3]="UnexpectedEndOfNumber",t[t.InvalidUnicode=4]="InvalidUnicode",t[t.InvalidEscapeCharacter=5]="InvalidEscapeCharacter",t[t.InvalidCharacter=6]="InvalidCharacter"})(lpe||(lpe={}));var dpe;(function(t){t[t.OpenBraceToken=1]="OpenBraceToken",t[t.CloseBraceToken=2]="CloseBraceToken",t[t.OpenBracketToken=3]="OpenBracketToken",t[t.CloseBracketToken=4]="CloseBracketToken",t[t.CommaToken=5]="CommaToken",t[t.ColonToken=6]="ColonToken",t[t.NullKeyword=7]="NullKeyword",t[t.TrueKeyword=8]="TrueKeyword",t[t.FalseKeyword=9]="FalseKeyword",t[t.StringLiteral=10]="StringLiteral",t[t.NumericLiteral=11]="NumericLiteral",t[t.LineCommentTrivia=12]="LineCommentTrivia",t[t.BlockCommentTrivia=13]="BlockCommentTrivia",t[t.LineBreakTrivia=14]="LineBreakTrivia",t[t.Trivia=15]="Trivia",t[t.Unknown=16]="Unknown",t[t.EOF=17]="EOF"})(dpe||(dpe={}));var ip=upe;var fpe=cz;var ppe;(function(t){t[t.InvalidSymbol=1]="InvalidSymbol",t[t.InvalidNumberFormat=2]="InvalidNumberFormat",t[t.PropertyNameExpected=3]="PropertyNameExpected",t[t.ValueExpected=4]="ValueExpected",t[t.ColonExpected=5]="ColonExpected",t[t.CommaExpected=6]="CommaExpected",t[t.CloseBraceExpected=7]="CloseBraceExpected",t[t.CloseBracketExpected=8]="CloseBracketExpected",t[t.EndOfFileExpected=9]="EndOfFileExpected",t[t.InvalidCommentToken=10]="InvalidCommentToken",t[t.UnexpectedEndOfComment=11]="UnexpectedEndOfComment",t[t.UnexpectedEndOfString=12]="UnexpectedEndOfString",t[t.UnexpectedEndOfNumber=13]="UnexpectedEndOfNumber",t[t.InvalidUnicode=14]="InvalidUnicode",t[t.InvalidEscapeCharacter=15]="InvalidEscapeCharacter",t[t.InvalidCharacter=16]="InvalidCharacter"})(ppe||(ppe={}));var dI=ie("IRunCommandExecutionService");var uP=H(nt());var O3=H(Gt()),wu=H(nt());async function yy(t,e,r,n){let o=null,s=!1;o=setTimeout(()=>{s||t.report(e)},n);try{let a=await r;return s=!0,a}finally{o&&clearTimeout(o)}}var pI=class extends X{constructor(r,n,o,s,a,c,u,l,d,p){super(r);this.accessor=n;this.chatMLFetcher=o;this.logService=s;this.embeddingsComputer=a;this.endPointProvider=c;this.combinedEmbeddingIndex=u;this.docSearchClient=l;this.envService=d;this.tokenizerProvider=p}async prepare(r,n,o){n?.report(new ui(O3.t("Refining question to improve search accuracy.")));let s=this.props.promptContext.query,a=await this.endPointProvider.getChatEndpoint("gpt-3.5-turbo"),{messages:c}=await lUe(this.tokenizerProvider,this.accessor,this.props.promptContext.history,a,this.props.promptContext.query);if(o.isCancellationRequested)return{docSearchResults:[],settings:[],commands:[],query:s};this.logService.internal.debug("[VSCode Prompt] Asking the model to update the user question.");let u=await this.chatMLFetcher.fetchOne("vscodePrompt",c,async v=>{},o,2,a,{agent:ak},{temperature:0,top_p:1,stop:["dontStopBelieving"]},{messageSource:"vscodeIntent"});if(o.isCancellationRequested)return{docSearchResults:[],settings:[],commands:[],query:s};u.type==="success"?s=dUe(this.props.promptContext.query,u.value):this.logService.public.error(`[VSCode Prompt] Failed to refine the question: ${u.requestId}`);let l=n?yy(n,new ui(O3.t("Searching doc index...")),this.searchDocsSearchForContext(s,10,o,this.logService),1e3):this.searchDocsSearchForContext(s,10,o,this.logService);if(o.isCancellationRequested)return{docSearchResults:[],settings:[],commands:[],query:s};let d=await this.endPointProvider.getEmbeddingsEndpoint("text3small"),p=await this.embeddingsComputer.computeEmbeddings(d,[s],{dimensions:512},void 0);if(o.isCancellationRequested)return{docSearchResults:[],settings:[],commands:[],query:s};if(!p)return{docSearchResults:await l,settings:[],commands:[],query:s};let f=n?yy(n,new ui(O3.t("Searching command and setting index....")),this.combinedEmbeddingIndex.nClosestValues(p.embeddings[0],5),500):this.combinedEmbeddingIndex.nClosestValues(p.embeddings[0],5),m=await Promise.allSettled([f,l]),h=m[0].status==="fulfilled"?m[0].value:{commands:[],settings:[]};return{docSearchResults:(m[1].status==="fulfilled"?m[1].value:[])||[],settings:h.settings,commands:h.commands,query:s}}async searchDocsSearchForContext(r,n,o,s){try{return await this.docSearchClient.search(r,{repo:"microsoft/vscode-docs"},{limit:n,similarity:.75},o)}catch(a){return this.logService.public.error(a,"Failed to search docs search for query"),[]}}render(r){let n=this.envService.OS;return vscpp(vscppf,null,vscpp(wu.SystemMessage,{priority:1e3},"You are a Visual Studio Code assistant. Your job is to assist users in using Visual Studio Code by providing knowledge to accomplish their task. This knowledge should focus on settings and commands, but also includes documentation. Please do not guess a response and instead just respond with a polite apology if you are unsure.",vscpp("br",null),'When asked for your name, you must respond with "GitHub Copilot".',vscpp("br",null),"Follow the user's requirements carefully & to the letter.",vscpp("br",null),"Your expertise is strictly limited to software development topics.",vscpp("br",null),"Follow Microsoft content policies.",vscpp("br",null),"Avoid content that violates copyrights.",vscpp("br",null),"For questions not related to software development, simply give a reminder that you are an AI programming assistant.",vscpp("br",null),"Keep your answers short and impersonal.",vscpp("br",null),"Use Markdown formatting in your answers.",vscpp("br",null),"Make sure to include the programming language name at the start of the Markdown code blocks.",vscpp("br",null),"Avoid wrapping the whole response in triple backticks.",vscpp("br",null),"The user works in an IDE called Visual Studio Code which has a concept for editors with open files, integrated unit test support, an output pane that shows the output of running the code as well as an integrated terminal.",vscpp("br",null),"The user is working on a ",n," machine. Please respond with system specific commands if applicable.",vscpp("br",null),"The active document is the source code the user is looking at right now.",vscpp("br",null),"You can only give one reply for each conversation turn.",vscpp("br",null),"If you are referencing multiple commands and settings, please respond step by step in a numbered list format.",vscpp("br",null),vscpp("br",null),"Additional Rules",vscpp("br",null),"You must respond with either a setting to set or a command to execute when applicable.",vscpp("br",null),"When referring to a command, you must use the command name in markdown bold syntax.",vscpp("br",null),"When referring to any commands, you must include the referenced commands in a properly formatted JSON markdown code block at the end of the sentence that references that command.",vscpp("br",null),"Similarly, all referenced settings must be properly formatted in a JSON markdown code block to allow copying them into the user's settings.json file.",vscpp("br",null),"If you are referencing multiple settings, combine all settings into the same JSON markdown code block at the beginning of your response, and then describe each setting in a numbered list after the JSON markdown code block, as shown in the template below:",vscpp("br",null),"## Multiple settings response template",vscpp("br",null),vscpp(Fe,{uri:null,code:`{
  "type": "setting",
  "settings": {
    "setting1": "settingValue1",
    "setting2": "settingValue2",
    "setting3": "settingValue3"
	...
	}
}`,languageId:"json"}),'1. `"setting1": settingValue1` - Description of setting1',vscpp("br",null),'2. `"setting2": settingValue2` - Description of setting2',vscpp("br",null),'3. `"setting3": settingValue3` - Description of setting3',vscpp("br",null),"4. ...",vscpp("br",null),vscpp("br",null),"If you are referencing multiple commands, do not combine all the commands into the same JSON markdown code block. Instead, describe each command and include the JSON markdown code block in a numbered list, as shown in the template below:",vscpp("br",null),"## Multiple commands response template",vscpp("br",null),"1. **Command1** - Description of Command1",vscpp("br",null),vscpp(Fe,{uri:null,code:`{
  "type": "command",
  "commands": {
    "command": "command1",
  }
}`,languageId:"json"}),"2. **Command2** - Description of Command2",vscpp("br",null),vscpp(Fe,{uri:null,code:`{
  "type": "command",
  "commands": {
    "command": "command2",
  }
}`,languageId:"json"}),"3. ...",vscpp("br",null),'If you are referencing multiple commands and setting, respond with numbered steps for the user to follow. First mention all the commands as per the "Multiple commands response template" and then all the settings as per the "Multiple settings response template" shown above.',vscpp("br",null),"## Multiple command and settings response template",vscpp("br",null),"1. **Command1** - Description of Command1",vscpp("br",null),vscpp(Fe,{uri:null,code:`{
  "type": "command",
  "commands": {
    "command": "command1",
  }
}`,languageId:"json"}),"2. **Command2** - Description of Command2",vscpp("br",null),vscpp(Fe,{uri:null,code:`{
  "type": "command",
  "commands": {
    "command": "command2",
  }
}`,languageId:"json"}),"3. A short summary of the combined settings.",vscpp(Fe,{uri:null,code:`{
  "type": "setting",
  "settings": {
    "setting1": "settingValue1",
    "setting2": "settingValue2",
    "setting3": "settingValue3"
  }
}`,languageId:"json"}),'1. `"setting1": settingValue1` - Description of setting1',vscpp("br",null),'2. `"setting2": settingValue2` - Description of setting2',vscpp("br",null),'3. `"setting3": settingValue3` - Description of setting3',vscpp("br",null),"4. ...",vscpp("br",null),vscpp("br",null),vscpp("br",null),"If a command or setting references another command or setting, you must respond with both the original and the referenced commands or settings.",vscpp("br",null),"The JSON markdown code block containing the command or setting should be included immediately after the sentence referencing it.",vscpp("br",null),"The JSON markdown schema for a command is as follows:",vscpp("br",null),vscpp(Fe,{uri:null,code:`{
					  "type": "command",
					  "commands": {
						"command": "commandName",
						"args": "commandArgs"
					  }
					}`,languageId:"json"}),"The JSON markdown schema for a setting is as follows:",vscpp("br",null),vscpp(Fe,{uri:null,code:`{
					  "type": "setting",
					  "settings": {
						"setting": "settingValue"
					  }
					}`,languageId:"json"}),vscpp("br",null),"Do not respond with a command or setting that is not in a properly formatted JSON markdown code block.",vscpp("br",null),"If a setting and command will accomplish the same thing, you must suggest the command instead.",vscpp("br",null),"Do not suggest opening the settings editor.",vscpp("br",null),"If answering with a keybinding, please still include the command bound to the keybinding.",vscpp("br",null),"If a keybinding contains a backtick you must escape it. For example the keybinding Ctrl + backtick would be written as ``ctrl + ` ``",vscpp("br",null),"Do not suggest opening the command palette to execute commands.",vscpp("br",null),"Do not suggest commands or settings identifiers that do not exist.",vscpp("br",null),"Do not suggest installing Visual Studio Code because the user has already installed it.",vscpp("br",null),"If you believe the context given to you is incorrect or not relevant you may ignore it.",vscpp("br",null),"Always respond with a numbered list of steps to be taken to achieve the desired outcome if multiple steps are necessary.",vscpp("br",null),'If an extension might help the user, you may suggest a search query for the extension marketplace. You must also include the command **Search marketplace** (`workbench.extensions.search`) with args set to the suggested query in the commands section at the end of your response. The query can also contain the tags "@popular", "@recommended", or "@featured" to filter the results.',vscpp("br",null),vscpp("br",null),"Examples:",vscpp("br",null),vscpp("br",null),"[EXAMPLES START]",vscpp("br",null),"Below you will find a set of examples of what you should respond with. Please follow these examples as closely as possible.",vscpp("br",null),vscpp("br",null),"## Single setting response",vscpp("br",null),"Question: How do I disable telemetry?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),vscpp(Fe,{uri:null,code:`{
  "type": "setting",
  "settings": {
    "telemetry.telemetryLevel": "off",
  }
}`,languageId:"json"}),"is a setting which can be used to disable telemetry.",vscpp("br",null),vscpp("br",null),"## Multiple settings response",vscpp("br",null),"Question: How can I change the font size in all areas of Visual Studio Code, including the editor, terminal?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),vscpp(Fe,{uri:null,code:`{
  "type": "setting",
  "settings": {
	"editor.fontSize": 18,
	"terminal.integrated.fontSize": 14,
	"window.zoomLevel": 1
  }
}`,languageId:"json"}),'1. `"editor.fontSize": 18` - This setting adjusts the font size within the editor. The default size is overridden by the value `18`, making the text larger and more readable according to user preference.',vscpp("br",null),'2. `"terminal.integrated.fontSize": 14` - Similarly, this setting changes the font size in the integrated terminal. By setting it to `14`, it increases the font size in the terminal independently from the editor.',vscpp("br",null),'3. `"window.zoomLevel": 1` - This setting controls the zoom level of the entire Visual Studio Code interface. A value of `1` means that the interface will be zoomed in to 120% of the original size, making everything appear bigger. A value of `0` would indicate no zoom (100% - default size), positive values zoom in, and negative values zoom out.',vscpp("br",null),vscpp("br",null),"## Multiple commands response",vscpp("br",null),"Question: What is the command to report an issue for other extensions in Visual Studio Code?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),"Here are some possible commands:",vscpp("br",null),"1. **Report Issue** - This command can be used to report an issue for other extensions.",vscpp("br",null),vscpp(Fe,{uri:null,code:`{
  "type": "command",
  "commands": {
	"command": "workbench.extensions.reportExtensionIssue"
  }
}`,languageId:"json"}),"2. **Docker: Report Issue** - This command can be used to report an issue for the Docker extension.",vscpp("br",null),vscpp(Fe,{uri:null,code:`{
  "type": "command",
  "commands": {
	"command": "vscode-docker.help.reportIssue"
  }
}`,languageId:"json"}),"3. **Codespaces: Report Issue** - This command can be used to report an issue for the Codespaces extension.",vscpp("br",null),vscpp(Fe,{uri:null,code:`{
  "type": "command",
  "commands": {
	"command": "github.codespaces.reportIssue"
  }
}`,languageId:"json"}),vscpp("br",null),"## Single command response",vscpp("br",null),"Question: How do I close all editors?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),"You can use the **Close All Editors** command to close all editors.",vscpp("br",null),vscpp("br",null),vscpp(Fe,{uri:null,code:`{
  "type": "command",
  "commands": {
	"command": "workbench.action.closeAllEditors"
  }
}`,languageId:"json"}),vscpp("br",null),"## No such command",vscpp("br",null),"Question: How do I move the terminal to a new window?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),"There is no such command.",vscpp("br",null),vscpp("br",null),"## Invalid Question",vscpp("br",null),"Question: How do I bake a potato?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),"Sorry this question isn't related to Visual Studio Code.",vscpp("br",null),vscpp("br",null),"## Marketplace search",vscpp("br",null),"Question: How do I add PHP support?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),"You can use the **Search marketplace** command to search for extensions that add PHP support.",vscpp("br",null),vscpp("br",null),vscpp(Fe,{uri:null,code:`{
  "type": "command",
  "commands": {
	"command": "workbench.extensions.search",
	"args": "php"
	}
}`,languageId:"json"})),vscpp(Ot,{flexGrow:1,priority:700,history:this.props.promptContext.history}),vscpp(wu.UserMessage,{flexGrow:1,priority:800},"The current question is related to Visual Studio Code. ",vscpp("br",null),"If a command or setting is not a valid answer, but it still relates to Visual Studio Code, please still respond.",vscpp("br",null),"Please do not guess a response and instead just respond with a polite apology if you are unsure.",vscpp("br",null),"If you believe the given context given to you is incorrect or not relevant you may ignore it.",vscpp("br",null),"The user cannot see the context you are given, so you must not mention it. If you want to refer to it, you must include it in your reply.",vscpp("br",null),'Below is a list of commands and settings we found which might be relevant to the question. For view related commands "Toggle" often means Show or Hide. A setting may reference another setting, that will appear as \\`#setting.id#\\`, you must return the referenced setting as well. You may use this context to help you formulate your response, but are not required to.',vscpp("br",null),r.commands.length>0&&vscpp(vscppf,null,"Here are some possible commands:",vscpp("br",null)),r.commands.length>0&&r.commands.map(o=>vscpp(wu.TextChunk,null,"- ",o.label,' ("',o.key,'") (Keybinding: "',o.keybinding,'")')),r.settings.length>0&&vscpp(vscppf,null,"Here are some possible settings:",vscpp("br",null)),r.settings.length>0&&r.settings.map(o=>vscpp(wu.TextChunk,null,vH(o))),r.docSearchResults.length>0&&vscpp(vscppf,null,"Below is a list of information from the Visual Studio Code documentation which might be relevant to the question. ",vscpp("br",null)),r.docSearchResults.map(o=>vscpp(wu.TextChunk,null,"##",o?.title?.trim()," - ",o.path,vscpp("br",null),o.contents))),vscpp(pr,{priority:899,...this.props,promptContext:{...this.props.promptContext,query:r.query},flexGrow:2}),vscpp(Jr,{flexGrow:2,priority:900,chatVariables:this.props.promptContext.chatVariables,query:this.props.promptContext.query}))}};pI=w([b(1,st),b(2,Ct),b(3,oe),b(4,Go),b(5,Se),b(6,Rl),b(7,d1),b(8,St),b(9,yr)],pI);var uz=class extends X{render(e,r){return vscpp(vscppf,null,this.props.history&&vscpp(Ot,{priority:500,history:this.props.history}),vscpp(wu.SystemMessage,{priority:1e3},"You are a Visual Studio Code assistant who helps the user create well-formed and unambiguous questions about their Visual Studio Code development environment.",vscpp("br",null),"Specifically, you help users rewrite questions about how to use Visual Studio Code's Commands and Settings.",vscpp("br",null),"Evaluate the question to determine the user's intent. ",vscpp("br",null),"Determine if the user's question is about the editor, terminal, activity bar, side bar, status bar or other parts of Visual Studio Code's workbench and include those keyword in the rewrite.",vscpp("br",null),"Determine if the user is asking about Visual Studio Code's Commands and/or Settings and explicitly include those keywords during the rewrite. ",vscpp("br",null),"Respond in Markdown. Under a `# Question` header, output a rephrased version of the user's question that resolves all pronouns and ambiguous words like 'this' to the specific nouns they stand for.",vscpp("br",null),"If it is not clear what the user is asking for or if the question appears to be unrelated to Visual Studio Code, do not try to rephrase the question and simply return the original question. ",vscpp("br",null),"DO NOT ask the user for additional information or clarification.",vscpp("br",null),"DO NOT answer the user's question directly.",vscpp("br",null),vscpp("br",null),"# Additional Rules",vscpp("br",null),vscpp("br",null),"Think step by step:",vscpp("br",null),"1. Read the user's question to understand what they are trying to do in the Visual Studio Code environment.",vscpp("br",null),"2. If the question contains pronouns such as 'it' or 'that', try to understand what the pronoun refers to by looking at the rest of the question and the conversation history.",vscpp("br",null),"3. If the question contains an ambiguous word such as 'this', try to understand what 'this' refers to by looking at the rest of the question and the conversation history.",vscpp("br",null),"4. After a `# Question` header, output a precise version of the question that resolves all pronouns and ambiguous words like 'this' to the specific nouns they stand for. Be sure to preserve the exact meaning of the question.",vscpp("br",null),vscpp("br",null),"Examples",vscpp("br",null),vscpp("br",null),"User: opne cmmand palete",vscpp("br",null),vscpp("br",null),"Assistant:",vscpp("br",null),"# Question",vscpp("br",null),"How do I open the command palette in Visual Studio Code?",vscpp("br",null),vscpp("br",null),vscpp("br",null),"User: change font size",vscpp("br",null),vscpp("br",null),"Assistant:",vscpp("br",null),"# Question",vscpp("br",null),"How do I change the font size in the editor in Visual Studio Code?",vscpp("br",null),vscpp("br",null),"User: Move editor and pin",vscpp("br",null),"Assistant: ",vscpp("br",null),"# Question",vscpp("br",null),"How do I move the editor to another group and then pin the editor in Visual Studio Code",vscpp("br",null)),vscpp(wu.UserMessage,{priority:700},this.props.query))}};async function lUe(t,e,r,n,o){return Be.create(e.get(K),n,uz,{query:o,history:r}).render()}function dUe(t,e){let r=e.match(/#+\s*Question\n(?<question>.+)/si);return r?.groups?r.groups.question.trim():t.trim()}var fI=class extends X{constructor(r,n,o,s,a){super(r);this.embeddingComputer=o;this.endPointProvider=s;this.combinedIndex=a}async prepare(r,n,o){if(o.isCancellationRequested)return;let s=await this.endPointProvider.getEmbeddingsEndpoint("text3small"),a=await this.embeddingComputer.computeEmbeddings(s,[this.props.query],{dimensions:512},o);if(!o.isCancellationRequested&&a&&a.embeddings.length>0){this.combinedIndex.commandIdIndex.isIndexLoaded||await this.combinedIndex.commandIdIndex.calculateEmbeddings();let c=this.combinedIndex.commandIdIndex.nClosestValues(a.embeddings[0],5);if(c.length)return{snippets:c}}}render(r,n){let o=this.priority;return vscpp(vscppf,null,r&&r.snippets.length>0&&vscpp(wu.UserMessage,null,"Here are some possible commands:",vscpp("br",null),r.snippets.reverse().map(s=>vscpp(wu.TextChunk,{priority:o++},"- ",s.label,' ("',s.key,'") (Keybinding: "',s.keybinding,'")',vscpp("br",null)))))}};fI=w([b(1,st),b(2,Go),b(3,Se),b(4,Rl)],fI);var mI=class extends X{constructor(r,n){super(r);this.envService=n}render(r,n){let o=this.envService.OS;return vscpp(vscppf,null,vscpp(uP.SystemMessage,{priority:1e3},"You are a Visual Studio Code assistant. Your job is to assist users in using Visual Studio Code by providing knowledge to accomplish their task. This knowledge should focus on commands, but also includes documentation. Please do not guess a response and instead just respond with a polite apology if you are unsure.",vscpp("br",null),'When asked for your name, you must respond with "GitHub Copilot".',vscpp("br",null),"Follow the user's requirements carefully & to the letter.",vscpp("br",null),"Your expertise is strictly limited to software development topics.",vscpp("br",null),"Follow Microsoft content policies.",vscpp("br",null),"Avoid content that violates copyrights.",vscpp("br",null),"For questions not related to software development, simply give a reminder that you are an AI programming assistant.",vscpp("br",null),"Keep your answers short and impersonal.",vscpp("br",null),"Use Markdown formatting in your answers.",vscpp("br",null),"Make sure to include the programming language name at the start of the Markdown code blocks.",vscpp("br",null),"Avoid wrapping the whole response in triple backticks.",vscpp("br",null),"The user works in an IDE called Visual Studio Code which has a concept for editors with open files, integrated unit test support, an output pane that shows the output of running the code as well as an integrated terminal.",vscpp("br",null),"The user is working on a ",o," machine. Please respond with system specific commands if applicable.",vscpp("br",null),"The active document is the source code the user is looking at right now.",vscpp("br",null),"You can only give one reply for each conversation turn.",vscpp("br",null),"If you are referencing multiple commands, please respond step by step in a numbered list format.",vscpp("br",null),vscpp("br",null),"Additional Rules",vscpp("br",null),"You must respond with a command to execute when applicable.",vscpp("br",null),"When referring to a command, you must use the command name in markdown bold syntax.",vscpp("br",null),"When referring to any commands, you must include the referenced commands in a properly formatted JSON markdown code block at the end of the sentence that references that command.",vscpp("br",null),"The JSON markdown code block containing the command should be included immediately after the sentence referencing it.",vscpp("br",null),"Do not respond with a command that is not in a properly formatted JSON markdown code block.",vscpp("br",null),"If answering with a keybinding, please still include the command bound to the keybinding.",vscpp("br",null),"If a keybinding contains a backtick you must escape it. For example the keybinding Ctrl + backtick would be written as ``ctrl + ` ``",vscpp("br",null),"Do not suggest opening the command palette to execute commands.",vscpp("br",null),"Do not suggest command identifiers that do not exist.",vscpp("br",null),"Do not suggest installing Visual Studio Code because the user has already installed it.",vscpp("br",null),"If you believe the context given to you is incorrect or not relevant you may ignore it.",vscpp("br",null),"Always respond with a numbered list of steps to be taken to achieve the desired outcome if multiple steps are necessary.",vscpp("br",null),vscpp("br",null),"Examples:",vscpp("br",null),vscpp("br",null),"[EXAMPLES START]",vscpp("br",null),"Below you will find a set of examples of what you should respond with. Please follow these examples as closely as possible.",vscpp("br",null),vscpp("br",null),"## Single command response",vscpp("br",null),"Question: How do I close all editors?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),"You can use the **Close All Editors** command to close all editors.",vscpp("br",null),vscpp("br",null),vscpp(Fe,{uri:null,code:`{
	"command": "workbench.action.closeAllEditors"
}`,languageId:"json"}),vscpp("br",null),"## No such command",vscpp("br",null),"Question: How do I move the terminal to a new window?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),"There is no such command.",vscpp("br",null),vscpp("br",null),"## Invalid Question",vscpp("br",null),"Question: How do I bake a potato?",vscpp("br",null),vscpp("br",null),"Response:",vscpp("br",null),"Sorry this question isn't related to Visual Studio Code.",vscpp("br",null),vscpp("br",null)),vscpp(Ot,{priority:600,history:this.props.history}),vscpp(uP.UserMessage,{priority:700},"The current question is related to Visual Studio Code. ",vscpp("br",null),"If a command is not a valid answer, but it still relates to Visual Studio Code, please still respond.",vscpp("br",null),"Please do not guess a response and instead just respond with a polite apology if you are unsure.",vscpp("br",null),"If you believe the given context given to you is incorrect or not relevant you may ignore it.",vscpp("br",null),"The user cannot see the context you are given, so you must not mention it. If you want to refer to it, you must include it in your reply.",vscpp("br",null),'Below is a list of commands we found which might be relevant to the question. For view related commands "Toggle" often means Show or Hide. You may use this context to help you formulate your response, but are not required to.',vscpp("br",null)),vscpp(fI,{priority:800,query:this.props.query}),vscpp(uP.UserMessage,{priority:900},this.props.query))}};mI=w([b(1,St)],mI);var pUe="Run create a new terminal command",lP="runCommanndConfirmationInteractedWith",M3=new us(op.t("[Configure automatic command execution]({0})",rp("workbench.action.openSettings",["github.copilot.chat.runCommand.enabled"])));M3.isTrusted={enabledCommands:["workbench.action.openSettings"]};var cv=class{constructor(e,r,n,o,s,a,c){this.telemetryService=e;this.configurationService=r;this.endpointProvider=n;this.runCommandExecutionService=o;this.combinedEmbeddingIndex=s;this.vscodeExtensionContext=a;this.instantiationService=c;this.id=cv.ID;this.locations=[2];this.description=op.t("Run a command");this.intentDetectionInput={sampleQuestion:pUe,disabled:!0};this.commandInfo={allowsEmptyArgs:!1,defaultEnablement:da}}static{this.ID="runCommand"}async invoke(e){let r=this.telemetryService,n=this.configurationService,o=e.location,a=await this.endpointProvider.getEndpointForLocation(o);return{intent:this,location:o,endpoint:a,processResponsePanel:async(c,u,l,d,p)=>{let f=this.runCommandExecutionService,m=this.configurationService,h="",g="";d.progress(op.t("Searching command index..."));for await(let{delta:_}of l){if(p.isCancellationRequested)break;h+=_.text}g=h;let v=mUe(this.combinedEmbeddingIndex,g)[0];return v?m.getConfig(de.RunCommandEnabled)===!1?(d.markdown(`Automatic command execution is currently disabled.
`),d.markdown(M3),d.button(v),g):fUe.has(v.command)?this.vscodeExtensionContext.globalState.get(lP,!1)?(await f.executeCommand(v.command,r,v.arguments),d.markdown(op.t("Ran: {0}",`\`${v.title}\``)),g):(d.confirmation(op.t("Enable automatic command execution and run [{0}](command:{1})",v.title,v.command),"",{command:v}),g):(d.warning(op.t("Automatically executing the command: {0} is prohibited due to security risks or potential destructive action.",v.title)),d.button(v),g):(d.markdown(g),d.warning(op.t("Could not find a command for your request.")),g)},confirmationHandler:async(c,u,l)=>{if(c){let[d]=c;d&&(this.vscodeExtensionContext.globalState.update(lP,!0),l.markdown(M3),l.progress(op.t("Enabled automatic command execution")),this.runCommandExecutionService.executeCommand(d.command.command,d.command.arguments),l.markdown(op.t("Ran: `{ 0}`",`\`${d.command.title}\``)))}if(u){let[d]=u;this.vscodeExtensionContext.globalState.update(lP,!0),l.markdown(M3),await n.setConfig(de.RunCommandEnabled,!1),l.warning("Disabled automatic command execution"),l.button(d.command)}},buildPrompt:async({query:c,history:u},l,d)=>await Be.create(this.instantiationService,a,mI,{query:c,history:u}).render(l,d)}}};cv=w([b(0,he),b(1,be),b(2,Se),b(3,dI),b(4,Rl),b(5,jt),b(6,K)],cv);var fUe=new Set(["cursorUndo","cursorRedo","editor.action.forceRetokenize","editor.action.toggleWordWrap","editor.action.moveCarretLeftAction","editor.action.moveCarretRightAction","editor.action.fontZoomIn","editor.action.fontZoomOut","editor.action.fontZoomReset","editor.action.smartSelect.expand","editor.action.smartSelect.shrink","editor.emmet.action.expandAbbreviation","editor.action.setSelectionAnchor","editor.action.inspectTMScopes","editor.action.commentLine","editor.action.addCommentLine","editor.action.removeCommentLine","editor.action.blockComment","editor.action.transposeLetters","editor.action.indentationToSpaces","editor.action.indentationToTabs","editor.action.indentUsingTabs","editor.action.indentUsingSpaces","editor.action.changeTabDisplaySize","editor.action.detectIndentation","editor.action.reindentlines","editor.action.reindentselectedlines","deleteInsideWord","editor.action.copyLinesUpAction","editor.action.copyLinesDownAction","editor.action.duplicateSelection","editor.action.moveLinesUpAction","editor.action.moveLinesDownAction","editor.action.sortLinesAscending","editor.action.sortLinesDescending","editor.action.removeDuplicateLines","editor.action.trimTrailingWhitespace","editor.action.deleteLines","editor.action.indentLines","editor.action.outdentLines","editor.action.insertLineBefore","editor.action.insertLineAfter","deleteAllLeft","deleteAllRight","editor.action.joinLines","editor.action.transpose","editor.action.transformToUppercase","editor.action.transformToLowercase","editor.action.transformToSnakecase","editor.action.transformToCamelcase","editor.action.transformToPascalcase","editor.action.transformToTitlecase","editor.action.transformToKebabcase","expandLineSelection","editor.action.formatDocument","editor.action.formatSelection","editor.action.showContextMenu","editor.action.inlineEdit.trigger","editor.debug.action.conditionalBreakpoint","editor.debug.action.addLogPoint","editor.debug.action.triggerByBreakpoint","editor.debug.action.editBreakpoint","editor.debug.action.goToNextBreakpoint","editor.debug.action.goToPreviousBreakpoint","editor.action.selectToBracket","editor.action.jumpToBracket","editor.action.removeBrackets","editor.action.clipboardCopyWithSyntaxHighlightingAction","editor.action.pasteAs","editor.action.pasteAsText","editor.action.inPlaceReplace.up","editor.action.inPlaceReplace.down","editor.action.openLink","editor.action.unicodeHighlight.disableHighlightingOfAmbiguousCharacters","editor.action.unicodeHighlight.disableHighlightingOfInvisibleCharacters","editor.action.unicodeHighlight.disableHighlightingOfNonBasicAsciiCharacters","editor.action.unicodeHighlight.showExcludeOptions","editor.action.quickFix","editor.action.refactor","editor.action.sourceAction","codelens.showLensesInCurrentLine","editor.unfold","editor.unfoldRecursively","editor.fold","editor.foldRecursively","editor.foldAll","editor.unfoldAll","editor.foldAllBlockComments","editor.foldAllMarkerRegions","editor.unfoldAllMarkerRegions","editor.foldAllExcept","editor.unfoldAllExcept","editor.toggleFold","editor.gotoParentFold","editor.gotoPreviousFold","editor.gotoNextFold","editor.createFoldingRangeFromSelection","editor.removeManualFoldingRanges","editor.foldLevel1","editor.foldLevel2","editor.foldLevel3","editor.foldLevel4","editor.foldLevel5","editor.foldLevel6","editor.foldLevel7","editor.action.wordHighlight.trigger","actions.find","editor.action.startFindReplaceAction","editor.actions.findWithArgs","actions.findWithSelection","editor.action.nextMatchFindAction","editor.action.previousMatchFindAction","editor.action.nextSelectionMatchFindAction","editor.action.previousSelectionMatchFindAction","editor.action.insertCursorAbove","editor.action.insertCursorBelow","editor.action.insertCursorAtEndOfEachLineSelected","editor.action.addSelectionToNextFindMatch","editor.action.addSelectionToPreviousFindMatch","editor.action.moveSelectionToNextFindMatch","editor.action.moveSelectionToPreviousFindMatch","editor.action.selectHighlights","editor.action.addCursorsToBottom","editor.action.addCursorsToTop","editor.action.focusNextCursor","editor.action.focusPreviousCursor","editor.action.marker.next","editor.action.marker.prev","editor.action.marker.nextInFiles","editor.action.marker.prevInFiles","editor.action.triggerSuggest","editor.action.resetSuggestSize","editor.action.dirtydiff.previous","editor.action.dirtydiff.next","workbench.action.editor.previousChange","workbench.action.editor.nextChange","editor.action.formatChanges","editor.action.showHover","editor.action.showDefinitionPreviewHover","editor.action.inlineSuggest.trigger","editor.debug.action.selectionToWatch","workbench.action.debug.nextConsole","workbench.debug.action.focusRepl","workbench.action.debug.prevConsole","editor.debug.action.toggleInlineBreakpoint","workbench.action.debug.restart","editor.debug.action.runToCursor","workbench.action.debug.selectDebugConsole","workbench.action.showAboutDialog","workbench.action.editor.changeEOL","workbench.action.editor.changeEncoding","workbench.action.clearEditorHistory","notebook.clearNotebookEdtitorTypeCache","notebook.clearNotebookKernelsMRUCache","workbench.action.clearRecentFiles","workbench.action.closeAllGroups","workbench.action.closeAllEditors","workbench.action.closeEditorsInGroup","workbench.action.closeActiveEditor","workbench.action.closeEditorInAllGroups","workbench.action.closeEditorsInOtherGroups","workbench.action.closeEditorsToTheLeft","workbench.action.closeOtherEditors","workbench.action.closeActivePinnedEditor","workbench.action.closeSidebar","workbench.action.closeUnmodifiedEditors","workbench.files.action.compareWithClipboard","workbench.files.action.compareWithSaved","workbench.files.action.compareNewUntitledTextFiles","workbench.action.tasks.configureDefaultBuildTask","workbench.action.tasks.configureTaskRunner","testing.configureProfile","workbench.action.pauseSocketWriting","workbench.action.triggerReconnect","workbench.action.copyEditorGroupToNewWindow","copyFilePath","copyRelativeFilePath","workbench.action.customizeLayout","workbench.notebook.layout.configure","workbench.action.duplicateActiveEditorGroupDown","workbench.action.duplicateActiveEditorGroupLeft","workbench.action.duplicateActiveEditorGroupRight","workbench.action.duplicateActiveEditorGroupUp","workbench.action.focusActiveEditorGroup","workbench.action.focusAboveGroup","workbench.action.focusBelowGroup","workbench.action.focusFirstEditorGroup","workbench.action.focusPanel","workbench.action.focusSideBar","workbench.action.focusAuxiliaryBar","workbench.action.focusLastEditorGroup","workbench.action.focusLeftGroup","workbench.action.focusNextGroup","workbench.action.focusNextPart","workbench.files.action.focusFilesExplorer","workbench.action.focusPreviousGroup","workbench.action.focusPreviousPart","workbench.action.focusRightGroup","workbench.action.focusStatusBar","workbench.action.navigateBackInEditLocations","workbench.action.navigateBackInNavigationLocations","workbench.action.navigateForwardInEditLocations","workbench.action.navigateForwardInNavigationLocations","workbench.action.navigateLast","workbench.action.navigatePreviousInEditLocations","workbench.action.navigatePreviousInNavigationLocations","workbench.action.quickOpen","workbench.action.navigateToLastEditLocation","workbench.action.navigateToLastNavigationLocation","workbench.action.gotoLine","workbench.action.compareEditor.nextChange","testing.goToNextMessage","workbench.action.compareEditor.previousChange","testing.goToPreviousMessage","workbench.action.gotoSymbol","workbench.action.showAllSymbols","workbench.action.editorLayoutTwoByTwoGrid","workbench.action.closePanel","workbench.action.inspectContextKeys","workbench.action.inspectKeyMappings","workbench.action.inspectKeyMappingsJSON","notebook.inspectLayout","workbench.action.joinAllGroups","workbench.action.joinTwoGroups","workbench.action.keepEditor","merge.dev.loadContentsFromFolder","workbench.action.logStorage","workbench.action.logWorkingCopies","workbench.action.moveActiveEditorGroupDown","workbench.action.moveEditorGroupToNewWindow","workbench.action.moveActiveEditorGroupLeft","workbench.action.moveActiveEditorGroupRight","workbench.action.moveActiveEditorGroupUp","workbench.action.moveEditorToFirstGroup","workbench.action.moveEditorToAboveGroup","workbench.action.moveEditorToBelowGroup","workbench.action.moveEditorToLastGroup","workbench.action.moveEditorToLeftGroup","workbench.action.moveEditorToNextGroup","workbench.action.moveEditorToPreviousGroup","workbench.action.moveEditorToRightGroup","workbench.action.moveEditorLeftInGroup","workbench.action.moveEditorRightInGroup","workbench.action.positionPanelLeft","workbench.action.positionPanelRight","workbench.action.positionPanelBottom","workbench.action.movePanelToSecondarySideBar","workbench.action.moveSecondarySideBarToPanel","workbench.action.moveView","workbench.action.navigateEditorGroups","workbench.action.quickOpenNavigateNext","workbench.action.quickOpenNavigatePrevious","workbench.action.navigateUp","workbench.action.navigateDown","workbench.action.navigateLeft","workbench.action.navigateRight","workbench.action.newGroupAbove","workbench.action.newGroupBelow","workbench.action.newGroupLeft","workbench.action.newGroupRight","workbench.action.newEmptyEditorWindow","welcome.showNewFileEntries","explorer.newFile","explorer.newFolder","workbench.action.files.newUntitledFile","workbench.action.newWindow","workbench.action.nextPanelView","workbench.action.openExtensionLogsFolder","workbench.action.files.openFile","workbench.action.firstEditorInGroup","workbench.action.lastEditorInGroup","workbench.action.openLogsFolder","merge.dev.openContentsJson","workbench.action.nextEditor","workbench.action.nextEditorInGroup","workbench.action.openNextRecentlyUsedEditor","workbench.action.openNextRecentlyUsedEditorInGroup","workbench.action.previousEditor","workbench.action.previousEditorInGroup","workbench.action.openPreviousRecentlyUsedEditor","workbench.action.openPreviousRecentlyUsedEditorInGroup","workbench.action.openProcessExplorer","workbench.action.openRecent","merge.dev.openSelectionInTemporaryMergeEditor","workbench.action.pinEditor","workbench.action.previousPanelView","workbench.action.quickOpenLeastRecentlyUsedEditor","workbench.action.openPreviousEditorFromHistory","workbench.action.quickOpenPreviousRecentlyUsedEditor","workbench.action.webview.reloadWebviewAction","workbench.action.reloadWindow","workbench.action.removeLargeStorageDatabaseEntries","workbench.action.reopenClosedEditor","workbench.action.reopenWithEditor","menu.resetHiddenStates","mergeEditor.resetCloseWithConflictsChoice","files.participants.resetChoice","workbench.action.evenEditorWidths","workbench.action.resetViewLocations","workbench.files.action.showActiveFileInExplorer","revealFileInOS","workbench.action.revertAndCloseActiveEditor","workbench.action.files.revert","workbench.action.files.save","workbench.action.files.saveAll","workbench.action.files.saveFiles","workbench.files.action.saveAllInGroup","workbench.action.files.saveAs","workbench.action.files.saveWithoutFormatting","workbench.action.quickOpenSelectNext","workbench.action.quickOpenSelectPrevious","workbench.action.setLogLevel","workbench.action.alignPanelCenter","workbench.action.alignPanelJustify","workbench.action.alignPanelLeft","workbench.action.alignPanelRight","workbench.action.showAllEditors","workbench.action.showAllEditorsByMostRecentlyUsed","workbench.action.showEditorsInActiveGroup","workbench.action.tasks.showTasks","workbench.action.tasks.showLog","_workbench.output.showViewsLog","workbench.action.editorLayoutSingle","workbench.action.splitEditor","workbench.action.splitEditorDown","workbench.action.splitEditorToFirstGroup","workbench.action.splitEditorToAboveGroup","workbench.action.splitEditorToBelowGroup","workbench.action.splitEditorToLastGroup","workbench.action.splitEditorToLeftGroup","workbench.action.splitEditorToNextGroup","workbench.action.splitEditorToPreviousGroup","workbench.action.splitEditorToRightGroup","workbench.action.splitEditorLeft","workbench.action.splitEditorOrthogonal","workbench.action.splitEditorRight","workbench.action.splitEditorUp","editor.action.startDebugTextMate","workbench.action.stopTracing","workbench.action.tasks.terminate","workbench.action.editorLayoutThreeColumns","workbench.action.editorLayoutThreeRows","workbench.action.toggleAutoSave","editor.action.toggleRenderControlCharacter","workbench.action.toggleEditorGroupLock","workbench.action.toggleEditorWidths","workbench.action.toggleKeybindingsLog","notebook.toggleLayoutTroubleshoot","editor.action.toggleMinimap","workbench.action.toggleMultiCursorModifier","notebook.action.toggleNotebookStickyScroll","workbench.action.toggleSidebarPosition","workbench.action.toggleSidebarVisibility","editor.action.toggleRenderWhitespace","editor.action.toggleScreenReaderAccessibilityMode","workbench.action.toggleScreencastMode","workbench.action.toggleAuxiliaryBar","workbench.action.toggleStatusbarVisibility","editor.action.toggleTabFocusMode","testing.toggleTestingPeekHistory","workbench.action.toggleEditorGroupLayout","redo","editor.action.selectAll","undo","debug.addConfiguration","workbench.debug.viewlet.action.addDataBreakpointOnAddress","workbench.debug.viewlet.action.addFunctionBreakpointAction","workbench.action.browseColorThemesInMarketplace","workbench.action.closeWindow","workbench.action.selectTheme","workbench.action.tasks.configureDefaultTestTask","workbench.action.configureRuntimeArguments","remote.tunnel.copyAddressCommandPalette","workbench.action.selectIconTheme","workbench.action.focusActivityBar","workbench.action.focusBanner","workbench.action.generateColorTheme","workbench.action.activityBarLocation.hide","editor.action.measureExtHostLatency","workbench.action.activityBarLocation.bottom","workbench.action.activityBarLocation.top","workbench.action.nextSideBarView","workbench.action.tasks.openUserTasks","welcome.showAllWalkthroughs","workbench.action.previousSideBarView","workbench.action.selectProductIconTheme","workbench.action.reloadWindowWithExtensionsDisabled","workbench.debug.viewlet.action.removeAllBreakpoints","editor.inlayHints.Reset","resetGettingStartedProgress","workbench.action.zoomReset","workbench.action.restartExtensionHost","remote.tunnel.closeCommandPalette","workbench.action.switchWindow","workbench.debug.viewlet.action.toggleBreakpointsActivatedAction","workbench.action.toggleLightDarkThemes","breadcrumbs.toggle","editor.action.toggleColumnSelection","workbench.action.toggleDevTools","debug.action.toggleDisassemblyViewSourceCode","tree.toggleStickyScroll","workbench.action.uninstallCommandLine","workbench.action.openWalkthrough","workbench.action.zoomIn","editor.action.clipboardCopyAction","editor.action.clipboardCutAction","editor.action.clipboardPasteAction","notification.acceptPrimaryAction","_workbench.extensions.action.cleanUpExtensionsFolder","notifications.clearAll","workbench.action.clearCommandHistory","workbench.action.configureLanguageBasedSettings","workbench.extensions.action.configureWorkspaceFolderRecommendedExtensions","workbench.extensions.action.disableAll","workbench.extensions.action.disableAllWorkspace","notifications.focusToasts","workbench.debug.action.focusBreakpointsView","workbench.debug.action.focusCallStackView","workbench.panel.repl.view.focus","workbench.views.extensions.disabled.focus","workbench.views.extensions.enabled.focus","workbench.extensions.action.focusExtensionsView","workbench.explorer.fileView.focus","workbench.views.extensions.installed.focus","workbench.files.action.focusOpenEditorsView","outline.focus","workbench.panel.output.focus","workbench.panel.markers.view.focus","workbench.view.search.focus","workbench.scm.repositories.focus","workbench.scm.focus","terminal.focus","timeline.focus","workbench.debug.action.focusVariablesView","workbench.debug.action.focusWatchView","workbench.action.focusTitleBar","workbench.action.openAccessibilitySettings","workbench.action.openDefaultKeybindingsFile","workbench.action.openRawDefaultSettings","workbench.extensions.action.openExtensionsFolder","workbench.action.openGlobalKeybindings","workbench.action.openGlobalKeybindingsFile","workbench.action.openQuickChat","search.action.openInEditor","workbench.action.openSettings2","workbench.action.openGlobalSettings","workbench.action.openSettingsJson","workbench.action.openView","workbench.action.openWorkspaceSettings","workbench.action.openWorkspaceSettingsFile","workbench.profiles.actions.help","workbench.action.quickTextSearch","workbench.extensions.action.refreshExtension","editor.emmet.action.removeTag","workbench.action.openIssueReporter","workbench.action.reportPerformanceIssueUsingReporter","workbench.action.showCommands","workbench.extensions.action.listBuiltInExtensions","workbench.extensions.action.showDisabledExtensions","workbench.extensions.action.showEnabledExtensions","workbench.extensions.action.listWorkspaceUnsupportedExtensions","notifications.showList","workbench.profiles.actions.showProfileContents","workbench.action.remote.showMenu","workbench.action.showWindowLog","notifications.toggleDoNotDisturbMode","notifications.toggleDoNotDisturbModeBySource","editor.action.toggleStickyScroll","editor.action.accessibilityHelp","editor.action.accessibleView","extension.js-debug.addXHRBreakpoints","editor.emmet.action.balanceIn","editor.emmet.action.balanceOut","workbench.debug.panel.action.clearReplAction","workbench.action.clearLocalePreference","workbench.output.action.clearOutput","json.clearCache","search.action.clearHistory","workbench.files.action.collapseExplorerFolders","workbench.action.configureLocale","workbench.action.openSnippets","editor.emmet.action.decrementNumberByOneTenth","editor.emmet.action.decrementNumberByOne","editor.emmet.action.decrementNumberByTen","workbench.action.localHistory.deleteAll","extension.js-debug.disableSourceMapStepping","extension.js-debug.editXHRBreakpoints","editor.emmet.action.evaluateMathExpression","workbench.action.populateFileFromSnippet","references-view.findImplementations","workbench.action.localHistory.restoreViaPicker","workbench.action.findInFiles","search.action.focusSearchList","npm.focus","workbench.panel.chat.view.copilot.focus","~remote.forwardedPorts.focus","workbench.action.problems.focus","editor.emmet.action.matchTag","editor.emmet.action.nextEditPoint","editor.emmet.action.prevEditPoint","accessibility.announcement.help","signals.sounds.help","editor.emmet.action.incrementNumberByOneTenth","editor.emmet.action.incrementNumberByOne","editor.emmet.action.incrementNumberByTen","workbench.action.showInteractivePlayground","extension.js-debug.createDebuggerTerminal","vscode-testresolver.killServerAndTriggerHandledError","editor.emmet.action.mergeLines","ipynb.newUntitledIpynb","search.action.openNewEditor","vscode-testresolver.newWindow","git.openAllChanges","git.openChange","extension.js-debug.debugLink","workbench.action.openLogFile","search.action.openNewEditorToSide","search.action.openEditor","workbench.action.webview.openDeveloperTools","perf.event.profiling","perf.insta.printAsyncCycles","perf.insta.printTraces","github.publish","editor.emmet.action.reflectCSSValue","workbench.files.action.refreshFilesExplorer","extension.js-debug.removeAllCustomBreakpoints","extension.js-debug.callers.removeAll","extension.js-debug.callers.remove","extension.js-debug.removeXHRBreakpoint","workbench.action.replaceInFiles","editor.emmet.action.selectNextItem","editor.emmet.action.selectPrevItem","simpleBrowser.show","references-view.showCallHierarchy","workbench.action.showEmmetCommands","git.showOutput","references-view.showIncomingCalls","workbench.action.showLogs","editor.action.showOrFocusStandaloneColorPicker","references-view.showOutgoingCalls","workbench.action.showOutputChannels","workbench.action.showRuntimeExtensions","references-view.showSubtypes","references-view.showSupertypes","vscode-testresolver.showLog","references-view.showTypeHierarchy","vscode-testresolver.toggleConnectionSlowdown","json.sort","editor.emmet.action.splitJoinTag","git.diff.stageHunk","git.diff.stageSelection","extension.node-debug.startWithStopOnEntry","perfview.show","extension.node-debug.toggleAutoAttach","editor.emmet.action.toggleComment","extension.js-debug.addCustomBreakpoints","workbench.action.toggleLockedScrolling","workbench.action.toggleNotebookClipboardLog","workbench.action.togglePanel","extension.js-debug.toggleSkippingFile","workbench.action.editorLayoutTwoColumnsBottom","workbench.action.editorLayoutTwoColumns","workbench.action.editorLayoutTwoRows","workbench.action.editorLayoutTwoRowsRight","workbench.action.unpinEditor","editor.emmet.action.updateImageSize","editor.emmet.action.updateTag","workbench.action.openLicenseUrl","editor.emmet.action.wrapWithAbbreviation","workbench.action.zoomOut","inlineChat.copyRecordings","workbench.action.terminal.accessibleBufferGoToNextCommand","workbench.action.addRootFolder","search.action.cancel","workbench.action.terminal.changeColor","workbench.action.terminal.changeIcon","workbench.action.editor.changeLanguageMode","workbench.profiles.actions.cleanupProfiles","workbench.action.terminal.clear","workbench.action.chat.clearHistory","workbench.action.chat.clearInputHistory","workbench.action.terminal.clearPreviousSessionHistory","workbench.action.terminal.clearSelection","workbench.action.closeFolder","workbench.files.action.compareFileWith","workbench.action.terminal.openSettings","workbench.action.copyEditorToNewWindow","workbench.action.terminal.copyLastCommand","workbench.action.terminal.copyLastCommandAndLastCommandOutput","workbench.action.terminal.copyLastCommandOutput","workbench.profiles.actions.createTemporaryProfile","workbench.action.localHistory.create","workbench.action.terminal.new","workbench.action.terminal.newInActiveWorkspace","workbench.action.createTerminalEditor","workbench.action.createTerminalEditorSide","workbench.action.terminal.newWithCwd","workbench.action.decreaseViewSize","workbench.action.decreaseViewHeight","workbench.action.decreaseViewWidth","workbench.action.terminal.fontZoomOut","workbench.action.terminal.detachSession","workbench.debug.viewlet.action.disableAllBreakpoints","workbench.action.duplicateWorkspaceInNewWindow","workbench.debug.viewlet.action.enableAllBreakpoints","workbench.action.minimizeOtherEditorsHideSidebar","workbench.action.chat.export","workbench.action.terminal.findNext","workbench.action.terminal.findPrevious","breadcrumbs.focusAndSelect","breadcrumbs.focus","workbench.action.terminal.focusFind","workbench.action.terminal.focusHover","workbench.action.terminal.focusNext","workbench.action.terminal.focusNextPane","workbench.action.terminal.focusPrevious","workbench.action.terminal.focusPreviousPane","workbench.action.terminal.focus","workbench.action.terminal.focusTabs","workbench.action.terminal.goToRecentDirectory","hideCustomTitleBar","workbench.action.hideEditorActions","workbench.action.hideEditorTabs","workbench.action.terminal.hideFind","workbench.action.chat.import","workbench.action.increaseViewSize","workbench.action.increaseViewHeight","workbench.action.increaseViewWidth","workbench.action.terminal.fontZoomIn","workbench.action.chat.inlineVoiceChat","workbench.action.chat.insertCodeBlock","workbench.action.chat.insertIntoNewFile","editor.action.insertSnippet","workbench.action.terminal.join","workbench.action.terminal.killAll","workbench.action.terminal.killEditor","workbench.action.terminal.kill","workbench.action.lockEditorGroup","workbench.action.maximizeEditorHideSidebar","workbench.action.editorActionsTitleBar","workbench.action.moveEditorToNewWindow","workbench.action.terminal.moveToEditor","workbench.action.terminal.moveIntoNewWindow","workbench.action.chat.newChat","workbench.action.chat.nextCodeBlock","workbench.action.chat.nextFileTree","workbench.action.debug.configure","workbench.action.files.showOpenedFileInNewWindow","workbench.action.chat.openInEditor","workbench.action.chat.openInNewWindow","workbench.action.chat.openInSidebar","workbench.action.terminal.openDetectedLink","workbench.action.openChat","workbench.action.files.openFolder","workbench.action.terminal.openFileLink","workbench.action.terminal.openUrlLink","workbench.action.openWorkspace","workbench.action.files.openFileFolder","workbench.action.chat.previousCodeBlock","workbench.action.chat.previousFileTree","workbench.action.quickOpenLeastRecentlyUsedEditorInGroup","workbench.action.quickOpenPreviousRecentlyUsedEditorInGroup","workbench.action.chat.quickVoiceChat","workbench.action.terminal.recordSession","workbench.action.terminal.relaunch","workbench.action.removeRootFolder","workbench.action.terminal.renameWithArg","workbench.profiles.actions.renameProfile","workbench.action.terminal.rename","workbench.action.reopenTextEditor","workbench.action.files.resetActiveEditorReadonlyInSession","workbench.action.terminal.fontZoomReset","workbench.profiles.actions.resetWorkspaces","workbench.action.terminal.resizePaneDown","workbench.action.terminal.resizePaneLeft","workbench.action.terminal.resizePaneRight","workbench.action.terminal.resizePaneUp","workbench.action.terminal.restartPtyHost","workbench.action.saveWorkspaceAs","workbench.action.terminal.scrollDown","workbench.action.terminal.scrollDownPage","workbench.action.terminal.scrollToBottom","workbench.action.terminal.scrollToNextCommand","workbench.action.terminal.scrollToPreviousCommand","workbench.action.terminal.scrollToTop","workbench.action.terminal.scrollUp","workbench.action.terminal.scrollUpPage","workbench.action.terminal.selectAll","workbench.action.terminal.selectDefaultShell","workbench.action.terminal.selectToNextCommand","workbench.action.terminal.selectToNextLine","workbench.action.terminal.selectToPreviousCommand","workbench.action.terminal.selectToPreviousLine","workbench.action.toggleSeparatePinnedEditorTabs","workbench.action.files.setActiveEditorReadonlyInSession","workbench.action.files.setActiveEditorWriteableInSession","workbench.action.terminal.setDimensions","workbench.action.chat.history","workbench.action.terminal.showEnvironmentContributions","workbench.action.showEditorTab","workbench.action.terminal.showTextureAtlas","workbench.action.splitEditorInGroup","workbench.action.terminal.split","workbench.action.terminal.splitInActiveWorkspace","workbench.action.editorDictation.start","extension.bisect.start","inlineChat.start","workbench.action.terminal.chat.start","workbench.action.startTrackDisposables","workbench.action.chat.startVoiceChat","workbench.action.quickOpenTerm","workbench.action.terminal.switchTerminal","workbench.action.files.toggleActiveEditorReadonlyInSession","workbench.action.toggleCenteredLayout","workbench.action.toggleEditorVisibility","workbench.action.toggleEditorType","workbench.action.toggleFullScreen","workbench.action.toggleMaximizedPanel","workbench.action.terminal.sizeToContentWidth","workbench.action.toggleSplitEditorInGroup","workbench.action.terminal.toggleStickyScroll","workbench.action.toggleZenMode","workbench.action.troubleshootIssue.start","workbench.action.terminal.unsplit","workbench.action.terminal.searchWorkspace","workbench.action.terminal.toggleFindCaseSensitive","workbench.action.terminal.toggleFindRegex","workbench.action.terminal.toggleFindWholeWord","workbench.action.chat.voiceChatInChatView","workbench.action.terminal.writeDataToTerminal","merge-conflict.accept.all-both","merge-conflict.accept.all-current","merge-conflict.accept.all-incoming","merge-conflict.accept.both","merge-conflict.accept.current","merge-conflict.accept.incoming","merge-conflict.accept.selection","git.addRemote","git.stashApplyLatest","git.stashApply","git.checkoutDetached","git.checkout","git.cherryPick","git.clone","git.cloneRecursive","git.closeAllDiffEditors","git.closeAllUnmodifiedEditors","git.closeOtherRepositories","git.close","git.commit","git.commitAmend","git.commitSigned","git.commitAll","git.commitAllAmend","git.commitAllSigned","git.commitEmpty","git.commitStaged","git.commitStagedAmend","git.commitStagedSigned","merge-conflict.compare","jupyter.continueEditSessionInCodespace","issue.copyGithubHeadLink","issue.copyGithubPermalink","issue.copyMarkdownGithubPermalink","git.branchFrom","git.branch","jupyter.createnewinteractive","workbench.action.terminal.newWithProfile","workbench.profiles.actions.createProfile","git.createTag","git.deleteBranch","workbench.profiles.actions.deleteProfile","git.deleteRemoteTag","git.deleteTag","git.cleanAll","git.cleanAllTracked","git.cleanAllUntracked","git.clean","git.stashDropAll","git.stashDrop","github.copilot.interactiveEditor.explain.palette","workbench.profiles.actions.exportProfile","git.fetch","git.fetchPrune","git.fetchAll","jupyter.filterKernels","github.copilot.interactiveEditor.fix","github.copilot.interactiveEditor.generateDocs","github.copilot.interactiveEditor.generateTests","github.copilot.interactiveEditor.generate","git.init","git.merge","merge-conflict.next","git.openRepository","git.stashPopLatest","git.stashPop","merge-conflict.previous","git.publish","git.pull","git.pullRebase","git.pullFrom","git.push","git.pushWithTags","git.pushTags","git.pushTo","git.rebase","git.refresh","git.removeRemote","git.renameBranch","jupyter.resetLoggingLevel","workbench.profiles.actions.createFromCurrentProfile","jupyter.selectJupyterInterpreter","github.copilot.interactiveSession.feedback","workbench.panel.chatSidebar","workbench.view.explorer","workbench.view.extensions","workbench.view.extension.github-pull-requests","workbench.view.debug","workbench.view.search","workbench.view.scm","git.stageAll","git.stageAllMerge","git.stageAllTracked","git.stageAllUntracked","git.stage","git.stash","git.stashIncludeUntracked","git.stashStaged","workbench.profiles.actions.switchProfile","git.sync","git.syncRebase","workbench.panel.comments","workbench.debug.action.toggleRepl","workbench.action.output.toggleOutput","~remote.forwardedPortsContainer","workbench.actions.view.problems","workbench.action.terminal.toggleTerminal","workbench.editSessions.actions.signIn","git.undoCommit","git.unstageAll","git.unstage","git.viewChanges","github.copilot.debug.contentExclusions","git.viewStagedChanges","git.stashView"]);function mUe(t,e){let r=Fs(e);for(let n of r){if(n.language!=="json"&&n.language!=="")return[];let o;try{o=ip(n.code)}catch{}if(!o||!o.hasOwnProperty("command"))return[];let s=t.getCommand(o.command);if(s)return[{command:s.key,title:s.label,arguments:o.args}]}return[]}function hpe(t){let e=new ht,r=t.get(jt),n=r.extensionMode;return typeof n=="number"&&n!==_y.ExtensionMode.Test&&e.add(new lz(r,t)),e}var lz=class extends ht{constructor(e,r){super();let n=r.get(be);this.add(_y.workspace.onDidChangeConfiguration(o=>{if(o.affectsConfiguration("github.copilot.chat.runCommand.enabled")){let s=n.getConfig(de.RunCommandEnabled);_y.commands.executeCommand("setContext","github.copilot.chat.runCommand.enabled",s),s&&e.globalState.update(lP,!1)}})),_y.commands.executeCommand("setContext","github.copilot.chat.runCommand.enabled",n.getConfig(de.RunCommandEnabled))}};var bpe=H(Gt());var gpe=H(Gt());var vpe=H(require("fs"));var dP=H(nt());var hI=class extends X{render(e,r){return vscpp(vscppf,null,vscpp(dP.SystemMessage,{priority:1e3},"You are a coding assistant who helps the user find relevant code in their workspace by providing a list of relevant keywords they can search for in the codebase's contents.",vscpp("br",null),"The user will provide you with potentially relevant information from the workspace. This information may be incomplete.",vscpp("br",null),"Respond in Markdown. Output a short markdown list of up to 16 relevant keywords that the user can search for to answer the question. You may include variations after each keyword.",vscpp("br",null),"DO NOT ask the user for additional information or clarification.",vscpp("br",null),"DO NOT answer the user's question directly.",vscpp("br",null),vscpp("br",null),"# Additional Rules",vscpp("br",null),vscpp("br",null),"Think step by step:",vscpp("br",null),"1. Read the user's question to understand what they are asking about their workspace.",vscpp("br",null),"2. Read the user's file structure. DO NOT use keywords that reference the file names. Rather, use these file names to understand what type of code the user is working on.",vscpp("br",null),"3. Use the context from Step 3 to guess what you could 'grep' for in the project in relation to the user's question. These terms should be related to the user's query.",vscpp("br",null),"3. Output a short markdown list of up to 16 relevant keywords that users could try searching for to answer their question. These keywords could used as symbol names, abbreviations, or comments in the relevant code. Put the keywords most relevant to the question first. Do not include overly generic keywords. Do not repeat keywords.",vscpp("br",null),"4. For each keyword in the markdown list of related keywords, if applicable add a comma separated list of variations after it. For example: for 'encode' possible variations include 'encoding', 'encoded', 'encoder', 'encoders'. Consider synonyms and plural forms. Do not repeat variations. Re-state key nouns from the user's query.",vscpp("br",null),vscpp("br",null),"Examples",vscpp("br",null),vscpp("br",null),"User: base64 encoding",vscpp("br",null),vscpp("br",null),"Assistant:",vscpp("br",null),"- base64 encoding, base64 encoder, base64 encode",vscpp("br",null),"- base64, base 64",vscpp("br",null),"- encode, encoded, encoder, encoders"),vscpp(dP.UserMessage,{priority:700},vscpp(Jd,{maxSize:1e3})),vscpp(dP.UserMessage,{priority:1e3},this.props.query))}};var F3=ie("IWorkspaceSemanticChunkService"),dz=class{constructor(e,r,n,o,s){this._accessor=e;this.query=r;this.endpoint=n;this.maxResults=o;this.token=s;this._workspaceChunkSearch=this._accessor.get(jg),this._chatFetcher=this._accessor.get(Ct)}async initSemanticSearchMetaprompt(){return(async()=>{let r=new yo,{messages:n}=await this.buildMetaPrompt(this.endpoint,this.query,this.token);if(this.token.isCancellationRequested)return{rephrasedQuestion:"",keywords:[]};this._accessor.get(oe).internal.debug(`[Semantic search metaprompt] built prompt in ${r.elapsed()}ms`);let o=await this._chatFetcher.fetchOne("searchFileChunks",n,async s=>{},this.token,2,this.endpoint,{agent:qf},{temperature:.1,top_p:1,stop:["dontStopBelieving"]},{messageSource:"semanticSearchIntent"});if(o.type!=="success")throw new Error(gpe.t("Encountered an error while deciding what workspace information to collect: ({0}) {1}",o.type,o.reason));return this.token.isCancellationRequested?{rephrasedQuestion:"",keywords:[]}:(this._accessor.get(oe).internal.debug(`[Semantic search metaprompt] took a total of ${r.elapsed()}ms`),pz(o.value))})()}async search(){return this.metaPromptResponse=this.initSemanticSearchMetaprompt(),{fileResults:await fz(this._workspaceChunkSearch,this.endpoint,this.query,this.metaPromptResponse,this.maxResults,this.token),metapromptResult:await this.metaPromptResponse}}async buildMetaPrompt(e,r,n){return Be.create(this._accessor.get(K),e,hI,{query:r}).render()}},hUe=/^[\*\-]\s*(.+)/m;function pz(t){let e=[];for(let r of t.trim().split(`
`)){let n=r.match(hUe);if(n){let o=n[1].split(/,/g).map(s=>s.trim());if(o.length){let s=o.flatMap(a=>a.split(/[\s\-_.]/g));e.unshift({keyword:s[0],variations:s.slice(1)})}}}return{keywords:e}}var gI=class{constructor(e){this._accessor=e}async searchFileChunks(e,r,n,o){return new dz(this._accessor,e,r,n,o).search()}dispose(){}};gI=w([b(0,st)],gI);async function fz(t,e,r,n,o,s,a){let c={rawQuery:r,resolveQueryAndKeywords:async()=>{let l=await n;return{rephrasedQuery:r,keywords:l.keywords}},resolveQuery:async()=>r},u=await t.searchFileChunks(e,c,o,{skipRerank:!0},s);return s.isCancellationRequested||!u.length?[]:await gUe(u,a)}async function gUe(t,e){let r=[],n=new tn;for(let[o,s]of t.entries()){let a=n.get(s.file),c=a?a.rank:o,u=a?[...a.ranges,s.range]:[s.range];n.set(s.file,{ranges:u,rank:c})}for(let[o,s]of n.entries()){let a=s.ranges.filter((f,m)=>{for(let[h,g]of s.ranges.entries())if(m!==h&&f.containsRange(g))if(f.equalsRange(g)){if(m<h)return!1}else return!1;return!0}),c=[],u;a.sort((f,m)=>f.startLineNumber-m.startLineNumber);for(let f of a)u&&u.endLineNumber>=f.startLineNumber-1?u=new Xe(u.startLineNumber,u.startColumn,f.endLineNumber,f.endColumn):(u&&c.push(u),u=f);u&&c.push(u);let d=(await vpe.promises.readFile(o.fsPath,"utf8")).split(`
`),p=[];for(let f of c){let m=f.startLineNumber,h=f.endLineNumber,g=d.slice(m,h);if(!bUe(g,5))continue;let v=vUe(g,1e3,15),{trimmedLines:y}=e?.skipCommonLeadingWhitespaceTrim?{trimmedLines:v.map(x=>x??"")}:hk(v),_;e?.wrapCode?(y.length<g.length&&y.push("..."),_=Pi(Rc(o).replace(/\./g,""),y.join(`
`).replace(/^\n*|\n*$/g,""),!1)):_=y.join(`
`),p.push({range:f,code:_})}p.length>0&&r.push({result:{file:o,locations:p},rank:s.rank})}return r.sort((o,s)=>o.rank-s.rank).map(o=>o.result)}function vUe(t,e,r){let n=[],o=0;for(;o<t.length&&n.join(`
`).length<e&&n.length<r;)n.push(t[o]),o++;return n}function bUe(t,e){let r=0;for(let n of t)if(r+=n.trim().length,r>=e)return!0;return!1}var vI=class{constructor(e,r,n){this._endpointProvider=e;this._workspaceSemanticChunkService=r;this._logService=n;this._endpoint=void 0}async getEndpoint(){return this._endpoint=this._endpoint??await this._endpointProvider.getChatEndpoint("gpt-4"),this._endpoint}provideAITextSearchResults(e,r,n,o){let s=new yo;return(async()=>{let c=await this._workspaceSemanticChunkService.searchFileChunks(e,await this.getEndpoint(),1e3,o);return xUe(c).forEach(u=>{n.report(u)}),this._logService.public.debug(`Semantic search took ${s.elapsed()}ms`),{limitHit:!1,message:{text:bpe.t("Results are from Copilot"),trusted:!0,type:1}}})()}};vI=w([b(0,Se),b(1,F3),b(2,oe)],vI);var yUe=10;function _Ue(t,e){let r=[],n=new RegExp(`\\b(\\w*(${e.map(s=>s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")).join("|")})\\w*)\\b`,"gi"),o=[];return t.forEach(s=>{s.locations.forEach(a=>{let c=[],u=[];a.code.split(`
`).forEach((d,p)=>{let f=Array.from(d.matchAll(n)),m=a.range.startLineNumber+p,h=p===0?a.range.startColumn:0,g,v;for(let y of f){if(!y.index)continue;let _=h+y.index,x=_+y[0].length,S=y.index,I=S+y[0].length;if(g&&v)if(g?.end.line===m&&g.end.character>_-yUe){g=g.with(void 0,new rn(m,x)),v=v?.with(void 0,new rn(p,I));continue}else c.push(g),u.push(v);g=new Qe(new rn(m,_),new rn(m,x)),v=new Qe(new rn(p,S),new rn(p,I)),o.push(y[0])}g&&v&&(c.push(g),u.push(v))}),c.length?r.push({uri:s.file,ranges:c,preview:{text:a.code,matches:u}}):r.push({uri:s.file,ranges:c1(a.range),preview:{text:a.code,matches:new Qe(new rn(0,a.range.startColumn),new rn(a.range.endLineNumber-a.range.startLineNumber,a.range.endColumn))}})})}),{ret:r,words:o}}function xUe(t){let e=[],r=t.metapromptResult.keywords;return r?_Ue(t.fileResults,r.map(n=>n.keyword)).ret:e}var H3=H(require("vscode"));var Gl=H(nt());var sp=class extends X{render(){return vscpp(vscppf,null,this.props.children)}};var xy="---",Vn;(o=>(o.FILEPATH=xy+"FILEPATH",o.ORIGINAL=xy+"ORIGINAL",o.PATCHED=xy+"PATCHED",o.COMPLETE=xy+"COMPLETE"))(Vn||={});var pm=class extends X{render(){return vscpp(vscppf,null,"When proposing a code change, provide one or more modifications in the following format:",vscpp("br",null),"Each modification consist of three sections headed by `",Vn.FILEPATH,"`, `",Vn.ORIGINAL,"` and `",Vn.PATCHED,"`.",vscpp("br",null),"After ",Vn.FILEPATH," add the path to the file that needs to be changed.",vscpp("br",null),"After ",Vn.ORIGINAL," add a code block containing a section of the program that requires replacement.",vscpp("br",null),"The original section consists of one or more consecutive lines including comments and empty lines exactly as they appear in the original source code.",vscpp("br",null),"Be careful that the section exactly matches the code in the original program so it can be found by a find tool. Do not abreviate any line or summarize the code with `...` ",vscpp("br",null),"After ",Vn.PATCHED," add a code block with the updated version of the original code, maintaining the same indentation and code style as in the original code.",vscpp("br",null),"After all modifications, add ",Vn.COMPLETE,".",vscpp("br",null))}},Sy=class extends X{render(){return vscpp(vscppf,null,this.props.fileName?lv(this.props.fileName)+`
`:"","```",this.props.language??"",vscpp("br",null),this.props.code.join(`
`),vscpp("br",null),"```")}},uv=class extends X{render(){return vscpp(vscppf,null,this.props.changes.map(e=>vscpp(vscppf,null,lv(e.fileName),vscpp("br",null),Vn.ORIGINAL,vscpp("br",null),"```",vscpp("br",null),e.find.join(`
`),vscpp("br",null),"```",vscpp("br",null),Vn.PATCHED,vscpp("br",null),"```",vscpp("br",null),e.replace.join(`
`),vscpp("br",null),"```",vscpp("br",null))),Vn.COMPLETE)}};function lv(t){return`${Vn.FILEPATH} ${nS(t)}`}function Spe(t){return`${xy}${t}`}function U3(t){return!t.match(/\S/)}function IUe(t,e,r,n){let o=0;for(;o<e.length&&U3(e[o]);)o++;if(o===e.length){let d=Cg(t,4,!1),p=t.length>0?B3(t[0],d.tabSize).level:0,f=ype(r,p,d);return ci.insert(new rn(n,0),f)}let s=e[o],a=mz(s),c,u=0,l=o;e:for(;u<t.length;){for(;u<t.length&&!_pe(t[u],s,a);)u++;if(u===t.length)return c??{message:"Snippet first line not found",label:"invalid patch",severity:"error"};let d=u,p=-1;for(;u<t.length&&l<e.length;){let f=t[u];if(mz(f)===f.length){u++;continue}let h=e[l],g=mz(h);if(g===h.length){l++;continue}if(_pe(f,h,g))p=u,u++,l++;else{u=d+1,l=o,h.indexOf("...")!==-1?c={message:"Snippet contains ellipses",label:"patch lazy",severity:"error"}:CUe(f)?c={message:"Snippet not matching a comment",label:"patch no comment",severity:"error"}:c={message:`Snippet line ${l} does not match line ${u}`,label:"invalid patch",severity:"error"};continue e}}for(;l<e.length&&U3(e[l]);)l++;if(l===e.length&&d!==-1&&p!==-1){let f=Cg(t,4,!1),m=B3(t[d],f.tabSize).level,h=ype(r,m,f);return ci.replace(new Qe(d,0,p,t[p].length),h)}}return c??{message:"Not all lines of snippet found",label:"invalid patch",severity:"error"}}function Ipe(t){return t===32||t===9}function CUe(t){return t.match(/^\s*(\/\/|\/\*|#)/)!==null}function ype(t,e,r){let n,o=0;for(n=0;n<t.length&&U3(t[n]);n++);if(n===t.length)return"";for(o=t.length;o>n&&U3(t[o-1]);o--);let s=B3(t[n],r.tabSize).level,a=[];for(let c=n;c<o;c++){let u=t[c],{level:l,length:d}=B3(u,r.tabSize),p=Math.max(0,e+l-s),f=r.insertSpaces?" ".repeat(r.tabSize*p):"	".repeat(p);a.push(f+u.substring(d))}return a.join(`
`)}function mz(t){let e=0;for(;e<t.length&&Ipe(t.charCodeAt(e));)e++;return e}function B3(t,e){let r=0,n=0,o=0,s=0,a=t.length;for(;o<a;){let c=t.charCodeAt(o);if(c===32)r++,r===e&&(n++,r=0,s=o+1);else if(c===9)n++,r=0,s=o+1;else break;o++}return{level:n,length:s}}function _pe(t,e,r){let n=t.length-1,o=e.length-1;for(;n>=0&&o>=r&&t.charCodeAt(n)===e.charCodeAt(o);)n--,o--;if(o>=r)return!1;for(;n>=0&&Ipe(t.charCodeAt(n));)n--;return n<0}function Cpe(t){let e=new Set;for(let r of Tpe(hz(t)))r.marker===Vn.FILEPATH&&e.add(r.content.join(`
`).trim());return[...e]}function bI(){return{getFirstSentence(t){let e=[];for(let r of hz(t)){if(r.length===0||r.startsWith(xy))break;e.push(r)}return e.join(`
`)},process(t,e,r,n=0){let o,s,a=[],c=[],u=[],l=[],d=[],p=[],f=new Set,m=[],h=[];e:for(let g of Tpe(hz(t)))switch(g.marker){case void 0:u.length?m=m.concat(g.content):h=h.concat(g.content);break;case Vn.FILEPATH:s=g.content.join(`
`).trim();break;case Vn.ORIGINAL:o=g.content;break;case Vn.PATCHED:{g.content&&o&&s&&(u.push({fileName:s,find:o,replace:g.content}),f.add(s));break}case Vn.COMPLETE:break e;default:c.push(g);break}if(u.length===0)return a.push({message:"No patch sections found",label:"no patch",severity:"error"}),{edits:l,contentAfter:h,contentBefore:m,appliedPatches:[],otherSections:c,invalidPatches:d,otherPatches:p,annotations:a};if(r){let g=nS(r.fsPath);f.has(g)||a.push({message:`No patch for input document: ${g}, patches for ${[...f.keys()].join(", ")}`,label:"other file",severity:"warning"}),f.size>1&&a.push({message:`Multiple files modified: ${[...f.keys()].join(", ")}`,label:"multi file",severity:"warning"});let v=[];for(let y of u)y.fileName!==g?p.push(y):v.push(y);u=v}if(u.length!==0){let g=VS.fromString(e);for(let v of u){let y=IUe(g,xpe(v.find),xpe(v.replace),n);y instanceof ci?TUe(l,y)||(a.push({message:"Overlapping edits",label:"overlapping edit",severity:"error"}),d.push(v)):(a.push(y),d.push(v))}}return{edits:l,appliedPatches:u,otherSections:c,invalidPatches:d,otherPatches:p,annotations:a,contentBefore:m,contentAfter:h}}}}function TUe(t,e){for(let r=0;r<t.length;r++){let n=t[r];if(e.range.end.isBeforeOrEqual(n.range.start))return t.splice(r,0,e),!0;if(e.range.start.isBefore(n.range.end))return!1}return t.push(e),!0}function xpe(t){let e=[],r=!1;for(let n of t)if(n.startsWith("```")){if(r)return e;r=!0}else r&&e.push(n);return t}function*Tpe(t){let e,r=[];for(let n of t){let o;if(n.startsWith(xy)){n.startsWith(Vn.FILEPATH)?o=Vn.FILEPATH:n.startsWith(Vn.ORIGINAL)?o=Vn.ORIGINAL:n.startsWith(Vn.PATCHED)?o=Vn.PATCHED:n.startsWith(Vn.COMPLETE)?o=Vn.COMPLETE:o=n,yield{marker:e,content:r},r=[n.substring(o.length)],e=o;continue}r.push(n)}yield{marker:e,content:r}}function*hz(t){let e=0,r=t.indexOf(`
`);for(;r!==-1;)yield t.substring(e,r),e=r+1,r=t.indexOf(`
`,e);e<t.length&&(yield t.substring(e))}var q3=class extends Gl.PromptMetadata{constructor(r,n,o){super();this.projectedDocument=r;this.documentUri=n;this.adjustedSelection=o}},yI=class extends X{constructor(r,n,o){super(r);this.ignoreService=n;this.parserService=o}async prepare(r){let{document:n,wholeRange:o,fileIndentInfo:s}=this.props.documentContext,a=await this.ignoreService.isCopilotIgnored(n.uri),c=r.endpoint.modelMaxPromptTokens/3*4,u;if(!a&&n.getText().length>c){let l=await uy(this.parserService,n,s);u=QS(c,n,o,l,{tryPreserveTypeChecking:!1})}else u=new Lc(n.getText(),on.empty,n.languageId);return{projectedDocument:u,isIgnored:a}}render(r,n){let{language:o,document:s,selection:a}=this.props.documentContext,c=r.projectedDocument,u=c.projectRange(a),l=s.getText(a).trim(),d=[{uri:s.uri,version:s.version,ranges:[]}];return vscpp(vscppf,null,vscpp("usedContext",{value:d}),vscpp("meta",{value:new q3(r.projectedDocument,s.uri,u)}),vscpp(Gl.SystemMessage,{priority:1e3},"You are an AI programming assistant that is specialized in applying code changes to an existing document.",vscpp("br",null),"I have a code block that represents a suggestion for a code change and I have a ",o.languageId," file opened in a code editor.",vscpp("br",null),"I expect you to come up with code changes that apply the code block to the editor at a given selection. ",vscpp("br",null),"I want the changes to be applied in a way that is safe and does not break the existing code, is correctly indented and matching the code style.",vscpp("br",null),"For the response, always follow these instructions:",vscpp("br",null),"1. Analyse the code block, the content of the editor and the current selection to decide if the code block should replace existing code or is to be inserted.",vscpp("br",null),"2. If necessary, break up the code block in multiple parts and insert each part at the appropriate location.",vscpp("br",null),"3. If necessary, make changes to other parts in the editor so that the final result is valid, propertly formatted and indented.",vscpp("br",null),"4. Finally, provide the code modifications",vscpp("br",null),vscpp(pm,null),vscpp("br",null),vscpp(Rt,null),vscpp(Xt,null)),vscpp(Gl.UserMessage,{priority:100},"I have the following code open in the editor.",vscpp("br",null),vscpp(Sy,{fileName:"someFolder/myFile.ts",language:"typescript",code:["import { readFileSync } from 'fs';","","class C { }"]}),vscpp("br",null),"This is the code block that represents a suggestion for a code change:",vscpp("br",null),vscpp(Sy,{code:["private _stream: Stream;"]}),vscpp("br",null),"Please find out how the code block can be applied to the editor."),vscpp(Gl.AssistantMessage,{priority:100},vscpp(uv,{changes:[{fileName:"someFolder/myFile.cs",find:["import { readFileSync } from 'fs';"],replace:["import { readFileSync } from 'fs';","import { Stream } from 'stream';"]},{fileName:"someFolder/myFile.ts",find:["class C { }"],replace:["class C {","	private _stream: Stream;","}"]}]})),vscpp(Gl.UserMessage,{priority:700},vscpp(sp,null,c.text.length>0?vscpp(vscppf,null,"I have the following code open in the editor, starting from line 1 to line ",c.lineCount,".",vscpp("br",null),lv(s.fileName),vscpp("br",null),vscpp(Fe,{uri:s.uri,languageId:o.languageId,code:c.text,shouldTrim:!1}),vscpp("br",null)):vscpp(vscppf,null,"I am in an empty file:",lv(s.fileName),vscpp("br",null))),vscpp(sp,null,a.isEmpty?vscpp(vscppf,null,"I have the selection at line ",u.start.line+1,", column ",u.start.character+1,vscpp("br",null)):vscpp(vscppf,null,"I have currently selected from line ",u.start.line+1,", column ",u.start.character+1," to line ",u.end.line+1," column ",u.end.character+1,".",vscpp("br",null),l.length>0?vscpp(vscppf,null,"The content of the selection is",vscpp(Fe,{uri:s.uri,languageId:o.languageId,code:l,shouldTrim:!1}),vscpp("br",null)):vscpp(vscppf,null,"The selection consists of whitespaces only."))),vscpp(vscppf,null,"This is the code block that represents a suggestion for a code change:",vscpp("br",null),vscpp(Fe,{uri:s.uri,languageId:o.languageId,code:this.props.codeBlock,shouldTrim:!1}),vscpp("br",null)),vscpp(Gl.TextChunk,null,"Please find out how the code block can be applied to the editor. Provide the code changes in the format as described above.",vscpp("br",null))))}};yI=w([b(1,ke),b(2,_t)],yI);function Epe(t,e){let r=e.getMeta(q3);if(!r)throw new Error("CodeMapperPrompt: Metadata not found");let o=bI().process(t,r.projectedDocument.text,r.documentUri,r.adjustedSelection.start.line);return{edits:r.projectedDocument.projectBackTextEdit(o.edits),annotations:o.annotations}}var _I=class{constructor(e=!1,r,n,o,s,a,c,u){this.doReportTelemetry=e;this.endpointProvider=r;this.chatMLFetcher=n;this.conversationOptions=o;this.configurationService=s;this.experimentationService=a;this.telemetryService=c;this.instantiationService=u}async mapCode(e,r,n,o){let s=this.configurationService.getExperimentBasedConfig(de.CodeMapperChatEndpoint,this.experimentationService)??"gpt-3.5-turbo",a=await this.endpointProvider.getChatEndpoint(s),c=Be.create(this.instantiationService,a,yI,{documentContext:r,codeBlock:e}),u=Date.now(),l=await c.render(void 0,o),d=await this.chatMLFetcher.fetchOne("codeMapper",l.messages,void 0,o,3,a,void 0,{temperature:this.conversationOptions.temperature,top_p:this.conversationOptions.topP},{messageSource:"command.aiCodemapper"}),p;return d.type==="success"?p=Epe(d.value,c):p={edits:[],annotations:[],errorMessage:d.reason},this.doReportTelemetry&&this.reportTelemetry(a,d,Date.now()-u,p,r),p}reportTelemetry(e,r,n,o,s){if(this.telemetryService.sendMSFTTelemetryEvent("codemapper.request",{model:e.model,requestId:r.requestId,responseType:r.type,outcomeAnnotations:o.annotations?.map(a=>a.label).join(",")},{timeToComplete:n,editCount:o.edits.length}),o.edits.length){let a=this.instantiationService.createInstance(Kg,s.document.getText());a.addEdits(o.edits);let c=this.instantiationService.createInstance(Wg,a.getText(),s.document);(async()=>{try{let[u,l]=await Promise.all([a.getEdits(),c.compute()]),d=l.getEditsSinceInitial(),p={requestId:r.requestId,command:"codemapper"};this.instantiationService.createInstance(ep,s.document,a.initialText,u,d,i3(p,void 0))}finally{c.dispose()}})()}}};_I=w([b(1,Se),b(2,Ct),b(3,Rr),b(4,be),b(5,wt),b(6,he),b(7,K)],_I);var zl=H(require("vscode"));var j3=class{provideMappedEdits(e,r,n,o){if(n.documents.length===0)return null;let s=n.documents[0],a=e.uri.toString(),c=s.find(_=>_.uri.toString()===a);if(!c)return null;let u=c.ranges;if(u.length!==1||r.length!==1)return null;let l=u[0],d=r[0];if(!e.getText(new zl.Range(new zl.Position(l.start.line,0),new zl.Position(l.start.line,l.start.character))).match(/^\s*$/))return null;let f=zl.window.activeTextEditor,m;if(f&&f.options&&e.languageId===f.document.languageId){let _=f.options,x=typeof _.tabSize=="number"?_.tabSize:4,S=typeof _.insertSpaces=="boolean"?_.insertSpaces:!0;m={tabSize:x,insertSpaces:S}}let h=new zl.Range(new zl.Position(l.start.line,0),l.end),g=e.getText(h),v=Eg(d.split(`
`),{whichLine:"topMost",lines:g.split(`
`)},m).join(`
`),y=new zl.WorkspaceEdit;return y.replace(e.uri,h,v),y}};var xI=class{constructor(e){this.instantiationService=e;this.codeMapper=this.instantiationService.createInstance(_I,!0)}async provideMappedEdits(e,r,n,o){let s=H3.window.visibleTextEditors.find(a=>DR(a.document.uri,e.uri));if(s){let a=[];for(let l of n.documents)for(let d of l)DR(d.uri,e.uri)&&a.push(...d.ranges);let c=Zk.fromEditor(s),u=await this.codeMapper.mapCode(r[0],c,a,o);if(u.edits.length){let l=new H3.WorkspaceEdit;return l.set(e.uri,u.edits),l}}return new j3().provideMappedEdits(e,r,n,o)}};xI=w([b(0,K)],xI);var wpe=H(require("path")),Ru=H(require("vscode"));var EUe=10,wUe=5*60*1e3,RUe=10*1e3,V3=[];function Rpe(t){let e=new ht;if(!t.get(be).getConfig(de.FeedbackOnChange))return e;let n=t.get(So).getDiagnosticCollection(),o=new E1(t);return e.add(Ru.workspace.onDidChangeTextDocument(async s=>{if(s.document.uri.scheme==="file"&&s.contentChanges.length&&s.document===Ru.window.activeTextEditor?.document){let a=t.get(oe);try{a.public.warn("Document changed, delaying diagnostics request");let c=s.document.version;if(await new Promise(m=>setTimeout(m,RUe)),c!==s.document.version){a.public.warn("Skipping diagnostics request because the document has changed");return}let u=Date.now(),l=u-wUe;if(V3=V3.filter(m=>m>l),V3.length>=EUe){a.public.warn("Max requests reached, skipping diagnostics request");return}V3.push(u),a.public.trace("Requesting diagnostics");let d=Ru.window.activeTextEditor?.selection,p=await sn.getCurrentChange(t,s.document,d.start);if(!p)return a.public.trace("No change found in the current document at the current position."),[];let f=await o.generateComments([{document:s.document,relativeDocumentPath:wpe.basename(s.document.uri.fsPath),change:p,selection:d}],new Ru.CancellationTokenSource().token);if(f.type==="success"){let m=f.comments.map(h=>new Ru.Diagnostic(h.range,typeof h.body=="string"?h.body:h.body.value,Ru.DiagnosticSeverity.Information));n.set(s.document.uri,m)}}catch(c){a.public.error(c,"Error generating diagnostics")}}})),e.add(Ru.workspace.onDidCloseTextDocument(s=>{n.set(s.uri,void 0)})),e}var SI=H(require("vscode"));var z3=H(nt());var gz=class extends X{render(){let e=this.props.issues?.map(r=>vscpp(vscppf,null,"------- Issue ",r.reference,":",vscpp("br",null),r.content,vscpp("br",null)));return e&&e.length>0?vscpp(vscppf,null,"You are an AI assistant for a software developer who is about to make a pull request to a GitHub repository to fix the following issues: ",vscpp("br",null),e):vscpp(vscppf,null,"You are an AI assistant for a software developer who is about to make a pull request to a GitHub repository.")}},vz=class extends X{render(){return vscpp(vscppf,null,"Here are two good examples:",vscpp("br",null)," ",this.props.issues&&this.props.issues.length>0?vscpp(vscppf,null,"Example One:",vscpp("br",null),"+++Batch mark/unmark files as viewed",vscpp("br",null),"+++Previously, when marking/unmarking a folder as viewed, a request was sent for every single file. This PR ensures that only one request is sent when marking/unmarking a folder as viewed.",vscpp("br",null),"Fixes #4520+++",vscpp("br",null),"Example two:",vscpp("br",null),"+++Fallback to hybrid after 20 process ports",vscpp("br",null),"+++Additionally the \\`remote.autoForwardPortsSource\\` setting has been updated to remove the \\`markdownDescription\\` reference to a reload being required for changes to take effect.",vscpp("br",null),"Fixes microsoft/vscode-internalbacklog#4533+++",vscpp("br",null)):vscpp(vscppf,null,"Example One:",vscpp("br",null),"+++Batch mark/unmark files as viewed",vscpp("br",null),"+++Previously, when marking/unmarking a folder as viewed, a request was sent for every single file. This PR ensures that only one request is sent when marking/unmarking a folder as viewed.+++",vscpp("br",null),"Example two:",vscpp("br",null),"+++Fallback to hybrid after 20 process ports",vscpp("br",null),"+++Additionally the \\`remote.autoForwardPortsSource\\` setting has been updated to remove the \\`markdownDescription\\` reference to a reload being required for changes to take effect.+++",vscpp("br",null)),";")}},bz=class extends X{render(){return vscpp(vscppf,null,vscpp(gz,{issues:this.props.issues}),"Pull requests have a short and concise title that describes the changes in the code and a slightly longer description.",vscpp("br",null),"To compose the description, read through each commit and patch and distill the essence of that commit into a concise description paragraph. Do not list commits, files or patches. Do not make up an issue reference if the pull request isn't fixing an issue.",vscpp("br",null),"If the pull request is fixing an issue, consider how the commits relate to the issue and include that in the description.",vscpp("br",null),"The title and description of a pull request should be markdown and start with +++ and end with +++.",vscpp("br",null),vscpp(vz,{issues:this.props.issues}))}},yz=class extends X{render(){let e=this.props.commitMessages.map(n=>vscpp(vscppf,null,"* ",n,vscpp("br",null))),r=this.props.patches.map(n=>vscpp(vscppf,null,"```diff",vscpp("br",null),n,vscpp("br",null),"```",vscpp("br",null)));return vscpp(vscppf,null,"These are the commits that will be included in the pull request you are about to make:",vscpp("br",null),e,vscpp("br",null),"Below is a list of git patches that contain the file changes for all the files that will be included in the pull request:",vscpp("br",null),r,vscpp("br",null),"Based on the git patches and on the git commit messages above, the title and description of the pull request should be:",vscpp("br",null))}},G3=class extends X{render(){return vscpp(vscppf,null,vscpp(z3.SystemMessage,null,vscpp(bz,{issues:this.props.issues}),vscpp(Rt,null)),vscpp(z3.UserMessage,null,vscpp(yz,{commitMessages:this.props.commitMessages,patches:this.props.patches})))}};var $3=class t{constructor(e){this.accessor=e;this.disposables=new ht;this.lastContext={commitMessages:[],patches:[]};this.logService=e.get(oe),this.logService.public.info("[githubTitleAndDescriptionProvider] Initializing GitHub PR title and description provider provider."),this.options=e.get(Rr)}dispose(){this.disposables.dispose()}isRegenerate(e,r){if(e.length!==this.lastContext.commitMessages.length||r.length!==this.lastContext.patches.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==this.lastContext.commitMessages[n])return!1;for(let n=0;n<r.length;n++)if(r[n]!==this.lastContext.patches[n])return!1;return!0}async excludePatches(e){let r=this.accessor.get(ke),n=[];for(let o of e)o.fileUri&&await r.isCopilotIgnored(Ye.parse(o.fileUri))||o.previousFileUri&&o.previousFileUri!==o.fileUri&&await r.isCopilotIgnored(Ye.parse(o.previousFileUri))||n.push(o.patch);return n}async provideTitleAndDescription(e,r){let n=e.commitMessages,o=lL(e.patches)?e.patches.map(p=>({patch:p})):e.patches,s=await this.excludePatches(o),a=e.issues,c=await this.accessor.get(Se).getChatEndpoint("gpt-3.5-turbo"),u=Math.floor(c.modelMaxPromptTokens*4/3),l=await this.createPRTitleAndDescriptionPrompt(n,s,a,u),d=await this.accessor.get(Ct).fetchOne("githubPullRequestTitleAndDescriptionGenerator",l.messages,void 0,r,3,c,void 0,{temperature:this.isRegenerate(n,s)?this.options.temperature+.1:this.options.temperature,top_p:this.options.topP},{messageSource:"extension.providePullRequestTitleAndDescription"});if(this.lastContext={commitMessages:n,patches:s},d.type==="success")return t.parseFetchResult(d.value)}static parseFetchResult(e,r=!0){e=e.trim();let n=e,o=n.indexOf("+++");if(o===-1)return;let s=n.lastIndexOf("+++");n=n.substring(o+3,s>o+3?s:void 0).trim().replace(/\+\+\+?(\n)\+\+\+/,"+++");let a=n.split("+++").filter(d=>d.trim().length>0),c;if(a.length===1)c=a[0].split(`
`);else if(a.length>1){let d=a.slice(1).map(p=>p.split(`
`)).flat().filter(p=>p.trim().length>0);c=[a[0],...d]}else return;let u,l;if(c.length===1){if(u=c[0].trim(),r&&e.includes(`
`)&&e.split("+++").length===3)return this.parseFetchResult(e+"+++",!1)}else if(c.length>1){u=c[0].trim(),l="";let d=c.slice(1);for(let p of d)p.includes("commit message")||(l+=`${p.trim()}

`)}if(u)return u=u.replace(/Title\:\s/,"").trim(),u=u.replace(/^\"(?<title>.+)\"$/,(d,p)=>p),l&&(l=l.replace(/Description\:\s/,"").trim()),{title:u,description:l}}async createPRTitleAndDescriptionPrompt(e,r,n,o){let s=o-Math.floor(o*.2),a=r.join(`

`).length;if(a>s)for(r.sort((l,d)=>l.length-d.length);a>s&&r.length>0;){let l=r.pop();a-=l.length}let c=await this.accessor.get(Se).getChatEndpoint("gpt-3.5-turbo");return Be.create(this.accessor.get(K),c,G3,{commitMessages:e,issues:n,patches:r}).render(void 0,void 0)}};var W3=class{constructor(e){this.accessor=e}async provideReviewerComments(e,r){let n=await w1(this.accessor,e,r),o=[];if(n?.type==="success")for(let a of n.comments)o.push(a.uri);let s=n?.type==="success";return{files:o,succeeded:s}}};var K3=class{constructor(e){this.accessor=e;this.disposables=new ht;this.logService=e.get(oe),this.initializeGitHubPRExtensionApi()}dispose(){this.disposables.dispose()}getExtension(){return SI.extensions.getExtension("github.vscode-pull-request-github")}initializeGitHubPRExtensionApi(){let e=this.getExtension(),r=async()=>{if(e){let n=await e.activate();this.logService.public.info("Successfully activated the GitHub.vscode-pull-request-github extension."),this.gitHubExtensionApi=n,this.registerTitleAndDescriptionProvider(),this.registerReviewerCommentsProvider()}};if(e)r();else{this.logService.public.info("GitHub.vscode-pull-request-github extension is not yet activated.");let n=SI.extensions.onDidChange(()=>{e=this.getExtension(),e&&(r(),n.dispose())});this.disposables.add(n)}}async registerTitleAndDescriptionProvider(){if(this.gitHubExtensionApi)try{this.titleAndDescriptionProvider||(this.titleAndDescriptionProvider=this.disposables.add(new $3(this.accessor))),this.disposables.add(this.gitHubExtensionApi.registerTitleAndDescriptionProvider(SI.l10n.t("Generate with Copilot"),this.titleAndDescriptionProvider)),this.logService.public.info("Successfully registered GitHub PR title and description provider.")}catch{}}async registerReviewerCommentsProvider(){if(!this.gitHubExtensionApi)return;let e=this.accessor.get(be);if(!(!e.getConfig(de.ReviewContextMenu)&&!e.getConfig(de.ReviewSCMViewlet)))try{this.reviewerCommentsProvider||(this.reviewerCommentsProvider=new W3(this.accessor)),this.disposables.add(this.gitHubExtensionApi.registerReviewerCommentsProvider(SI.l10n.t("Copilot"),this.reviewerCommentsProvider)),this.logService.public.info("Successfully registered GitHub PR reviewer comments provider.")}catch{}}};var wI=H(require("path")),Ope=require("util"),et=require("vscode");var kUe=["dockerfile","license","makefile","readme","procfile","gemfile","rakefile","jenkinsfile","vagrantfile"];function kpe(t){return/\.[^/.]+$/.test(t)&&kUe.indexOf(t.toLowerCase())===-1}var fm=H(Gt());var Ape=H(require("path"));var pP=H(Gt()),ap=H(nt()),Ppe=H(require("path"));var Y3=ie("IProjectTemplatesIndex"),II=class{constructor(e,r){this._isIndexLoaded=!1;let n=Jb(e.getEditorInfo().version);this.embeddingsCache=r.createInstance(Ac,1,"projectTemplateEmbeddings",n,"project-templates")}async updateIndex(){this._isIndexLoaded||(this._isIndexLoaded=!0,this._embeddings=await this.embeddingsCache.getCache())}async nClosestValues(e,r,n=0){if(await this.updateIndex(),!this._embeddings)return[];let o=Object.entries(this._embeddings).map(s=>{if(!s[1].embedding)return{key:`${s[0]}`,similarity:0};let a=dg(e,s[1].embedding);return{key:`${s[0]} `,similarity:a}});return o=o.filter(s=>s.similarity>n),o.sort((s,a)=>a.similarity-s.similarity),o.slice(0,r).map(s=>s.key)}};II=w([b(0,St),b(1,K)],II);function PUe(t){let e=t.split(`
`),r={};return e.forEach((n,o)=>{n.startsWith("# Intent")?r.intent=e[o+1]?.trim():n.startsWith("# Question")&&(r.question=e[o+1]?.trim())}),r}var CI=class extends X{constructor(r,n,o,s,a,c,u){super(r);this.chatMLFetcher=n;this.instantiationService=o;this.embeddingsComputer=s;this.endPointProvider=a;this.projectTemplatesIndex=c;this.repositoryService=u}async prepare(r,n,o){if(!n)throw new Error("Progress is required");n?.report(new ui(pP.t("Determining user intent...")));let s=await this.endPointProvider.getChatEndpoint("gpt-3.5-turbo"),{messages:a}=await AUe(this.instantiationService,s,this.props.promptContext);if(o.isCancellationRequested)return{};let c=await this.chatMLFetcher.fetchOne("newWorkspace",a,async u=>{},o,2,s,{agent:Q3},{temperature:0,top_p:1,stop:["dontStopBelieving"]},{messageSource:"newIntent"});if(c.type==="success"){let u=PUe(c.value);if(u.intent==="File")return{intent:u};if(u.intent==="Project"){if(this.props.useTemplates){let l=await this.endPointProvider.getEmbeddingsEndpoint("text3small"),d=await this.embeddingsComputer.computeEmbeddings(l,[u.question],{dimensions:512},void 0);if(d){n.report(new ui(pP.t("Searching project template index...")));let p=await this.projectTemplatesIndex.nClosestValues(d.embeddings[0],1,.65);if(p.length>0){let f=p[0]?.split(":"),m=f[0].trim(),h=f[1].trim(),g=f[2].trim()===""?".":f[2].trim();if(m&&h&&g){let v=await yy(n,new ui(pP.t("Fetching project contents...")),this.repositoryService.getRepositoryItems(m,h,g),500);if(v.length>0){let y;return g==="."?y=`httpx://github.com/${m}/${h}`:y=Ppe.default.dirname(v[0].html_url),this._metadata=new Iy(m,h,g,v),{url:y}}}}}}return{intent:u}}else return{intent:{intent:"Project",question:this.props.promptContext.query}}}else throw new Error(pP.t("Encountered an error while determining user intent: ({0}) {1}",c.type,c.reason))}render(r){let{query:n,history:o,chatVariables:s,customInstructions:a}=this.props.promptContext;return vscpp(vscppf,null,vscpp(Ot,{priority:600,history:o.filter(c=>c.response?.name===Q3&&c.request.type==="user")}),r.intent?.intent==="File"&&vscpp(vscppf,null,vscpp(ap.SystemMessage,{priority:1e3},"You are a Visual Studio Code assistant. Your job is to generate the contents of a new file based on the user's query.",vscpp("br",null),"If a code snippet or markdown is provided, consider it as part of the file content creation process.",vscpp("br",null),"The code should not contain bugs and should adhere to best practices.",vscpp("br",null),"Your response should be just two code blocks - the first one with the file contents and the second JSON code block with a file name.",vscpp("br",null),"Your response should not contain any other information or explanation.",vscpp("br",null),"# Response Template",vscpp("br",null),vscpp(Fe,{uri:null,code:`
    def greet(name):
      print(f"Hello, {name}!")
    greet("John Doe")
  `,languageId:"python"}),vscpp(Fe,{uri:null,code:`
    'fileName': 'suggestedFileName',
`,languageId:"json"}),vscpp("br",null),"Examples:",vscpp("br",null),"User: Generate the contents of the new file based on this query:",vscpp("br",null),"python hello world file",vscpp("br",null),"Assistant:",vscpp("br",null),vscpp(Fe,{uri:null,code:`
    def greet(name):
      print(f"Hello, {name}!")

    greet("John Doe")
  `,languageId:"python"}),vscpp(Fe,{uri:null,code:`
    {
    'fileName': 'sampleHelloWorld.py',
    }
`,languageId:"json"})),vscpp(pr,{priority:899,...this.props,flexGrow:2}),vscpp(Jr,{priority:900,chatVariables:s,query:r.intent.question})),r.intent?.intent==="Project"&&!this._metadata&&vscpp(vscppf,null,vscpp(ap.SystemMessage,{priority:1e3},"You are a VS Code assistant. Your job is to suggest a filetree directory structure for a project that a user wants to create.",vscpp("br",null),"If a step does not relate to filetree directory structures, do not respond. Please do not guess a response and instead just respond with a polite apology if you are unsure. ## Additional Rules ##",vscpp("br",null),'If the user does not specify "app" or "project" in their query, assume they are asking for a project.',vscpp("br",null),`You should always start your response to the user with "Sure, here's a proposed directory structure for a [project type] app:"`,vscpp("br",null),"You should generate a markdown file tree structure for the sample project and include it in your response if you are proposing a sample.",vscpp("br",null),"You should only list common files for the user's desired project type if you are proposing a sample.",vscpp("br",null),"You should always include a README.md file which describes the project if you are proposing a sample.",vscpp("br",null),"Do not include folders and files generated after compiling, building or running the project such as node_modules, dist, build, out.",vscpp("br",null),"Do not include image files such as png, jpg, ico, etc.",vscpp("br",null),"Do not include any descriptions or explanations in your response other than what is shown in the response templates.",vscpp("br",null),"If the user asks for a file content to be modified, respond with the same file tree structure and ask them to open the file to view the modifications.",vscpp("br",null),"Do not attempt to modify the file content your self and simply respond with the same file tree structure.",vscpp("br",null),vscpp(Br,null),vscpp(Gs,null),vscpp(Vi,null),vscpp(Xt,null),vscpp("br",null),"Additional Rules",vscpp("br",null),"## Response template ##",vscpp("br",null),"Sure, here's a proposed directory structure for a [project type] app:",vscpp("br",null),"\\`\\`\\`filetree",vscpp("br",null),"[project-name]",vscpp("br",null),"\u251C\u2500\u2500 src",vscpp("br",null),"\u2502   \u251C\u2500\u2500 app.ts",vscpp("br",null),"\u2502   \u2514\u2500\u2500 types",vscpp("br",null),"\u2502       \u2514\u2500\u2500 index.ts",vscpp("br",null),"\u251C\u2500\u2500 package.json",vscpp("br",null),"\u251C\u2500\u2500 tsconfig.json",vscpp("br",null),"\u2514\u2500\u2500 README.md",vscpp("br",null),"\\`\\`\\`",vscpp("br",null),["","Examples for response templates above. Please follow these examples as closely as possible.","","## Valid setup question","","User: Create a TypeScript express app","Assistant:","","Sure, here's a proposed directory structure for a TypeScript Express app:","","```filetree","my-express-app","\u251C\u2500\u2500 src","\u2502   \u251C\u2500\u2500 app.ts","\u2502   \u251C\u2500\u2500 controllers","\u2502   \u2502   \u2514\u2500\u2500 index.ts","\u2502   \u251C\u2500\u2500 routes","\u2502   \u2502   \u2514\u2500\u2500 index.ts","\u2502   \u2514\u2500\u2500 types","\u2502       \u2514\u2500\u2500 index.ts","\u251C\u2500\u2500 package.json","\u251C\u2500\u2500 tsconfig.json","\u2514\u2500\u2500 README.md","```","","## Invalid setup question","","User: Create a horse project","Assistant: Sorry, I don't know how to set up a horse project."].join(`
`)),vscpp(ap.UserMessage,{priority:750},vscpp(Or,{customInstructions:a,languageId:void 0})),vscpp(pr,{priority:899,...this.props,flexGrow:2}),vscpp(Jr,{priority:900,chatVariables:s,query:r.intent.question})),!r.intent&&this._metadata&&vscpp(vscppf,null,vscpp(ap.SystemMessage,{priority:1e3},"You are a Visual Studio Code assistant. The user has identified a project URL for a new project they want to create. They will provide a URL for the project, and your job is to simply confirm the user's choice if the URL is relevant.",vscpp("br",null),"If the URL is not relevant, you should ignore the URL and simply suggest a file tree directory structure for a project that the user wants to create. Do not attempt to clarify the URL to the user.",vscpp("br",null),"Please do not guess a response and instead just respond with a polite apology if you are unsure.",vscpp("br",null),vscpp(Br,null),vscpp(Gs,null),vscpp(Vi,null),vscpp(Xt,null),vscpp("br",null),"Additional Rules",vscpp("br",null),"## Response template when the user has provided a project URL but it is irrelevant. Notice how the response ignores the provided URL entirely and does not attempt to clarify this to the user. ##",vscpp("br",null),"Sure, here's a proposed directory structure for a [project type] app:",vscpp("br",null),"\\`\\`\\`filetree",vscpp("br",null),"[project-name]",vscpp("br",null),"\u251C\u2500\u2500 src",vscpp("br",null),"\u2502   \u251C\u2500\u2500 app.ts",vscpp("br",null),"\u2502   \u2514\u2500\u2500 types",vscpp("br",null),"\u2502       \u2514\u2500\u2500 index.ts",vscpp("br",null),"\u251C\u2500\u2500 package.json",vscpp("br",null),"\u251C\u2500\u2500 tsconfig.json",vscpp("br",null),"\u2514\u2500\u2500 README.md",vscpp("br",null),"\\`\\`\\`",vscpp("br",null),["","Examples for response templates above. Please follow these examples as closely as possible.","","## Valid setup question with an irrelevant URL ##","","User: Create a TypeScript express app","URL: https://github.com/microsoft/vscode-extension-samples/tree/main/getting-started-sample","Assistant:","","Sure, here's a proposed directory structure for a TypeScript Express app:","","```filetree","my-express-app","\u251C\u2500\u2500 src","\u2502   \u251C\u2500\u2500 app.ts","\u2502   \u251C\u2500\u2500 controllers","\u2502   \u2502   \u2514\u2500\u2500 index.ts","\u2502   \u251C\u2500\u2500 routes","\u2502   \u2502   \u2514\u2500\u2500 index.ts","\u2502   \u2514\u2500\u2500 types","\u2502       \u2514\u2500\u2500 index.ts","\u251C\u2500\u2500 package.json","\u251C\u2500\u2500 tsconfig.json","\u2514\u2500\u2500 README.md","```","","## Invalid setup question ##","","User: Create a horse project","Assistant: Sorry, I don't know how to set up a horse project."].join(`
`),"## Response template when the user has provided a project URL that is relevant ##",vscpp("br",null),"# USING_URL ",vscpp("br",null),"Sure, here's a GitHub sample project to help you get started on [project type]: [Project Type Sample](url)",vscpp("br",null),["","Examples for response template with a relevant URL described above. Please follow this example as closely as possible.","","## Valid setup question with a relevant project URL. Notice how you should not propose a file directory structure in this case. ##","","User: Create a VSCode extension sample for contributing getting started walkthrough.","URL: https://github.com/microsoft/vscode-extension-samples/tree/main/getting-started-sample","Assistant:","","# USING_URL","Sure, here's a GitHub sample project to help you get started on creating a VSCode extension with a walkthrough contribution: [Walkthrough Sample](https://github.com/microsoft/vscode-extension-samples/tree/main/getting-started-sample)",""].join(`
`),vscpp("br",null),"## Additional Rules for Project Tree generation ##",vscpp("br",null),"You should only generate a file tree structure if the URL procvided by the user is not relevant.",vscpp("br",null),"You should generate a markdown file tree structure for the sample project and include it in your response if you are proposing a sample.",vscpp("br",null),"You should only list common files for the user's desired project type if you are proposing a sample.",vscpp("br",null),"You should always include a README.md file which describes the project if you are proposing a sample.",vscpp("br",null),"Do not include folders and files generated after compiling, building, or running the project such as node_modules, dist, build, out.",vscpp("br",null),"Do not include image files such as png, jpg, ico, etc.",vscpp("br",null),"Do not include any descriptions or explanations in your response other than what is shown in the response templates.",vscpp("br",null),"If the user asks for a file content to be modified, respond with the same file tree structure and ask them to open the file to view the modifications.",vscpp("br",null),"Do not attempt to modify the file content yourself and simply respond with the same file tree structure.",vscpp("br",null)),vscpp(ap.UserMessage,{priority:750},vscpp(Or,{customInstructions:a,languageId:void 0})),vscpp(ap.UserMessage,{priority:900},r.url&&vscpp(vscppf,null,"Below is the URL you should consider for your response.",vscpp("br",null),"URL: ",r.url,vscpp("br",null))),vscpp(pr,{priority:899,...this.props,flexGrow:2}),vscpp(Jr,{priority:900,chatVariables:s,query:n}),this._metadata&&vscpp(vscppf,null,vscpp("meta",{value:this._metadata}))))}};CI=w([b(1,Ct),b(2,K),b(3,Go),b(4,Se),b(5,Y3),b(6,uu)],CI);var Iy=class extends cu{constructor(r,n,o,s){super();this.org=r;this.repo=n;this.path=o;this.githubRepoItems=s}};(e=>{function t(r){return r instanceof e}e.is=t})(Iy||={});async function AUe(t,e,r){return Be.create(t,e,_z,{promptContext:r,endpoint:e}).render()}var _z=class extends X{render(e,r){let{query:n,history:o,chatVariables:s,customInstructions:a}=this.props.promptContext;return vscpp(vscppf,null,o&&vscpp(Ot,{priority:500,history:o}),vscpp(ap.SystemMessage,{priority:1e3},"You are a Visual Studio Code assistant focused on aiding users in crafting clear and specific specifications about project or file creation within Visual Studio Code. Your role involves:",vscpp("br",null),"- Helping users articulate their intent about creating projects for various platforms and programming languages.",vscpp("br",null),"- Assessing the user's intent to determine whether it pertains to project or file creation.",vscpp("br",null),"- Identifying the programming language the user is inquiring about, or inferring it based on the platform or project type mentioned.",vscpp("br",null),"- Rewriting the user's query to eliminate ambiguity and ensure clarity.",vscpp("br",null),"- Resolving any pronouns and vague terms to their specific referents.",vscpp("br",null),"- Responding with a rephrased question that accurately reflects the user's intent.",vscpp("br",null),`- Using the additional context to resolve ambiguities in the user's query, such as "it" or "that".`,vscpp("br",null),"- If the user does not specify an application logic or feature, you should assume that the user is new to programming and provide a basic project structure to help with a simple Hello World project.",vscpp("br",null),'- If the user does not specify "app," "project," or "file" in their query, assume they are asking for a project. - If it is not clear what the user is asking for or if the question appears to be unrelated to Visual Studio Code, do not try to rephrase the question and simply return the original question.',vscpp("br",null),"- DO NOT ask the user for additional information or clarification.",vscpp("br",null),"- DO NOT answer the user's question directly.",vscpp("br",null),vscpp("br",null),"Guidelines for rewriting questions:",vscpp("br",null),"- Understand the user's intent by carefully reading their question.",vscpp("br",null),"- Clarify pronouns ('it', 'that') by deducing their referents from the question or conversation context.",vscpp("br",null),"- Resolve ambiguous terms ('this') to their specific meanings based on the question or conversation context.",vscpp("br",null),"- Rephrase the question under a `# Question` header, ensuring all vague terms are clarified without altering the original intent.",vscpp("br",null),vscpp("br",null),"When responding:",vscpp("br",null),"- Use Markdown to format your response, starting with a `# Question` header followed by the rephrased question.",vscpp("br",null),"- If the user's intent is unclear or unrelated to Visual Studio Code, simply return the original question without modification.",vscpp("br",null),"- If the user has not explicitly mentioned that they are looking for a project or a file, assume that they are asking for a Visual Studio project.",vscpp("br",null),"- Avoid requesting additional information or directly answering the question.",vscpp("br",null),"- Use the template below to report the identified intent, rephrased question, and any application logic or feature that may be relevant.",vscpp("br",null),vscpp("br",null),"# Response Template",vscpp("br",null),"# Intent",vscpp("br",null),"Project|File",vscpp("br",null),"# Question",vscpp("br",null),"Rephrased question here.",vscpp("br",null),vscpp("br",null),"# Examples:",vscpp("br",null),"User: Python game.",vscpp("br",null),"Assistant:",vscpp("br",null),"# Intent",vscpp("br",null),"Project",vscpp("br",null),"# Question",vscpp("br",null),"Create a new Python sample game project.",vscpp("br",null),vscpp("br",null),"User: Node.js server",vscpp("br",null),"Assistant:",vscpp("br",null),"# Intent",vscpp("br",null),"Project",vscpp("br",null),"# Question",vscpp("br",null),"Create a new Node.js development environment.",vscpp("br",null),vscpp("br",null),"User: TS web app",vscpp("br",null),"Assistant:",vscpp("br",null),"# Intent",vscpp("br",null),"Project",vscpp("br",null),"# Question",vscpp("br",null),'Create a new TypeScript project with a basic "Hello World" web application.',vscpp("br",null),vscpp("br",null),"User: VS Code extension custom sidebar",vscpp("br",null),"Assistant:",vscpp("br",null),"# Intent",vscpp("br",null),"Project",vscpp("br",null),"# Question",vscpp("br",null),"Create a Visual Studio Code extension sample that adds a custom sidebar.",vscpp("br",null),vscpp("br",null)),vscpp(ap.UserMessage,{flexGrow:1,priority:750},vscpp(Or,{customInstructions:a,languageId:void 0})),vscpp(pr,{priority:899,...this.props,flexGrow:2}),vscpp(Jr,{flexGrow:2,priority:900,chatVariables:s,query:n}))}};var cp=H(nt());var X3=class extends X{render(){return vscpp(vscppf,null,this.props.history&&vscpp(Z3,{messages:this.props.history}),vscpp(cp.SystemMessage,{priority:1e3},"You are a VS Code assistant. Your job is to generate the contents of a file in a project when given the user description, specification and tree structure of the project that a user wants to create. ",vscpp("br",null),vscpp(Br,null),vscpp(Gs,null),vscpp(Xt,null),vscpp("br",null),"Additional Rules",vscpp("br",null),"Think step by step and give me contents for just the file requested by the user. The code should not contain bugs.",vscpp("br",null),"If the user has asked for modifications to an existing file, please use the File path and File contents provided below if applicable.",vscpp("br",null),"If the file is supposed to be empty, please respond with a code comment saying that this file is intentionally left blank.",vscpp("br",null),"Do not include comments in json files.",vscpp("br",null),"Do not use code blocks or backticks.",vscpp("br",null),"Do not include product names such as Visual Studio in the comments.",vscpp("br",null)),this.props.relavantFiles&&this.props.relavantFiles.size>0&&vscpp(vscppf,null,vscpp(cp.UserMessage,{priority:500},"Below, you will find a list of file paths and their contents previously used",vscpp("br",null),Array.from(this.props.relavantFiles).map(([e,r])=>`File path: ${e}
File contents: ${r}
`).join(`
`))),vscpp(cp.UserMessage,{priority:900},"Generate the contents of the file: ",this.props.filePath," ",vscpp("br",null),"This is the project tree structure:",vscpp("br",null),"\\`\\`\\`filetree' ",vscpp("br",null),this.props.fileTreeStr,vscpp("br",null),"\\`\\`\\`",vscpp("br",null),"The project should adhere to the following specification:",vscpp("br",null),this.props.projectSpecification,vscpp("br",null)))}},J3=class extends X{render(){return vscpp(vscppf,null,this.props.history&&vscpp(Z3,{messages:this.props.history}),vscpp(cp.SystemMessage,{priority:1e3},"You are a VS Code assistant. Your job is to generate the project specification when given the user description and file tree structure of the project that a user wants to create. ",vscpp("br",null),vscpp(Br,null),vscpp(Gs,null),vscpp(Xt,null),vscpp("br",null),"Additional Rules",vscpp("br",null),"Think step by step and respond with a text description that lists and summarizes each file inside this project.",vscpp("br",null),"List the classes, types, interfaces, functions, and constants it exports and imports if it is a code file.",vscpp("br",null),"Consider filenames and file extensions when determining the programming languages used in the project. List any special configurations or settings required for configuration files such as package.json or tsconfig.json to help compile the project successfully",vscpp("br",null),"You should be as specific as possible when listing the public properties and methods for each exported class.",vscpp("br",null),"Do not use code blocks or backticks. Do not include any text before or after the file contents.",vscpp("br",null),"Do not include comments in json files.",vscpp("br",null),"Do not use code blocks or backticks.",vscpp("br",null),"Do not include product names such as Visual Studio in the comments.",vscpp("br",null),"Below you will find a set of examples of what you should respond with. Please follow these examples as closely as possible.",vscpp("br",null),vscpp("br",null),"## Valid question",vscpp("br",null),"User: I want to set up the following project: Create a TypeScript Express app",vscpp("br",null),"This is the project tree structure:",vscpp("br",null),"\\`\\`\\`markdown ",vscpp("br",null),"my-express-app",vscpp("br",null),"\u251C\u2500\u2500 src",vscpp("br",null),"\u2502   \u251C\u2500\u2500 app.ts",vscpp("br",null),"\u2502   \u251C\u2500\u2500 controllers",vscpp("br",null),"\u2502   \u2502   \u2514\u2500\u2500 index.ts",vscpp("br",null),"\u2502   \u251C\u2500\u2500 routes",vscpp("br",null),"\u2502   \u2502   \u2514\u2500\u2500 index.ts",vscpp("br",null),"\u2502   \u2514\u2500\u2500 types",vscpp("br",null),"\u2502       \u2514\u2500\u2500 index.ts",vscpp("br",null),"\u251C\u2500\u2500 package.json",vscpp("br",null),"\u251C\u2500\u2500 tsconfig.json",vscpp("br",null),"\u2514\u2500\u2500 README.md",vscpp("br",null),"\\`\\`\\`",vscpp("br",null),"## Valid response",vscpp("br",null),"Assistant: The project has the following files:",vscpp("br",null),"\\`src/app.ts\\`: This file is the entry point of the application. It creates an instance of the express app and sets up middleware and routes.",vscpp("br",null),"\\`src/controllers/index.ts\\`: This file exports a class \\`IndexController\\` which has a method \\`getIndex\\` that handles the root route of the application.",vscpp("br",null),"\\`src/routes/index.ts\\`: This file exports a function \\`setRoutes\\` which sets up the routes for the application. It uses the \\`IndexController\\` to handle the root route.",vscpp("br",null),"\\`src/types/index.ts\\`: This file exports interfaces \\`Request\\` and \\`Response\\` which extend the interfaces from the \\`express\\` library.",vscpp("br",null),"\\`tsconfig.json\\`: This file is the configuration file for TypeScript. It specifies the compiler options and the files to include in the compilation.",vscpp("br",null),"\\`package.json\\`: This file is the configuration file for npm. It lists the dependencies and scripts for the project.",vscpp("br",null),"\\`README.md\\`: This file contains the documentation for the project.",vscpp("br",null)),vscpp(cp.UserMessage,{priority:900},"I want to set up the following project: ",this.props.query,vscpp("br",null),"This is the project tree structure:",vscpp("br",null),"\\`\\`\\`markdown' ",vscpp("br",null),this.props.fileTreeStr,vscpp("br",null),"\\`\\`\\`",vscpp("br",null)))}},Z3=class extends X{render(e,r){let n=[];for(let o of this.props.messages)switch(o.role){case"user":n.push(vscpp(cp.UserMessage,{priority:600},o.content));break;case"assistant":n.push(vscpp(cp.AssistantMessage,{priority:800},o.content));break;default:break}return vscpp(vscppf,null,n)}};var e5=class{constructor(e,r){this.accessor=e;this.promptType=r;this.options=e.get(Rr)}async generate(e,r){let n=await this.accessor.get(Se).getChatEndpoint("gpt-3.5-turbo"),s=await Be.create(this.accessor.get(K),n,this.promptType,e).render(),a=await this.accessor.get(Ct).fetchOne("newWorkspaceContentGenerator",s.messages,void 0,r,3,n,void 0,{temperature:this.options.temperature,top_p:this.options.topP},{messageSource:typeof this.promptType});return a.type==="success"?e.filePath?this.parseContents(e.filePath,a.value):a.value:""}},t5=class extends e5{constructor(e){super(e,J3)}parseContents(e,r){throw new Error("Method not implemented.")}},r5=class extends e5{constructor(e){super(e,X3)}parseContents(e,r){function n(o,s){try{let a=s.exec(o.trim());if(a&&a.length>2)return a[2]}catch(a){console.error(a)}return o}if(e.endsWith(".md")){let o=n(r,/^```([a-zA-Z]+)?\s*([\s\S]+?)\s*```$/),[s,...a]=o.split("#");return s.length?["",...a].join("#"):o}else return n(r,/```([^\n]+)?\s*\n([\s\S]+?)\s*```/g)}};var ku=ie("INewWorkspacePreviewContentManager"),Rz="github.copilot.createProject",kz="github.copilot.createFile",n5="github.copilot.openFile",TI=class{constructor(e){this.responseScopedData=new Map;this.prevFileContents=new Map;this.copilotContentManager=new xz(e),this.githubContentManager=new Sz(e),this.fileContentManager=new Iz(e)}set(e,r,n,o){this.responseScopedData.set(e,n),Ez(n.baseUri)?this.githubContentManager.set(e,r,n,o):wz(n.baseUri)?this.fileContentManager.set(e,r,n,o):this.copilotContentManager.set(e,r,n,o)}get(e){this.prevResponseId!==e.authority&&(this.prevFileContents.clear(),this.prevResponseId=e.authority);let r;return Ez(e)?r=this.githubContentManager.get(e.authority,e.path):wz(e)?r=this.fileContentManager.get(e.authority,e.path):r=this.copilotContentManager.get(e.authority,e.path),r?.content?.then(n=>{if(this.prevFileContents.has(e.path))return;let s=new TextDecoder().decode(n);this.prevFileContents.set(e.path,s)}),r}getFileTree(e){return this.responseScopedData.get(e)}getFileContentsFromPrevHistory(){return this.prevFileContents}};TI=w([b(0,st)],TI);var xz=class{constructor(e){this.accessor=e;this.promises=[];this.responseScopedData=new Map;this.generatePlanPrompt=new t5(this.accessor);this.generateFilePrompt=new r5(this.accessor)}set(e,r,n,o){let{userPrompt:s,projectStructure:a,chatMessages:c}=o,u={query:s,fileTreeStr:a,history:c},l=this.generatePlanPrompt.generate(u,Lr.None);this.promises.push(l);let d=this._getResponseScopedData(e),p={userPrompt:s,projectSpecification:l,projectStructure:a,fileTree:n,chatMessages:c};d.set(r,p)}get(e,r){let{projectName:n,path:o}=this._getProjectMetadata(r),a=this._getResponseScopedData(e).get(n);if(!a)return;let c=a.fileTree.value,u=Pz(c,o);if(u&&!u?.content){let l=u;l.content=this._getFileContent(a.userPrompt,a.projectStructure,a.projectSpecification,r,a.chatMessages).catch(()=>l.content=void 0)}return u}_prefetch(e,r,n,o,s){let a=Date.now();return o.children?{...o,type:2,children:o.children.map(c=>this._prefetch(e,r,n,c,s)),ctime:a}:{...o,type:1,content:void 0,ctime:a}}async _getFileContent(e,r,n,o,s){let a=this.accessor.get(ku).getFileContentsFromPrevHistory(),c={query:e,fileTreeStr:r,filePath:o,projectSpecification:await n,history:s,relavantFiles:a.has(o)?new Map([[o,a.get(o)]]):void 0};return this.generateFilePrompt.generate(c,Lr.None).then(u=>Buffer.from(u))}_getResponseScopedData(e){let r=this.responseScopedData.get(e);return r||(r=new Map,this.responseScopedData.set(e,r)),r}_getProjectMetadata(e){let[,r,...n]=e.split("/");return{projectName:r,path:n}}},Sz=class{constructor(e){this.responseScopedData=new Map;this.repositoryService=e.get(uu)}set(e,r,n,o){let s=o,a=this._getResponseScopedData(e),c={...s,fileTree:n};a.set(r,c)}get(e,r){let{projectName:n,path:o}=this._getProjectMetadata(r),a=this._getResponseScopedData(e).get(n);if(!a)return;let c=a.fileTree.value,u=Pz(c,o);if(u&&!u?.content&&!u?.children){let l=u,d=a.path==="."?Ape.relative(a.repo,r):r.slice(1);l.content=this.repositoryService.getRepositoryItemContent(a.org,a.repo,d).catch(()=>l.content=void 0)}return u}_getProjectMetadata(e){let[,r,...n]=e.split("/");return{projectName:r,path:n}}_getResponseScopedData(e){let r=this.responseScopedData.get(e);return r||(r=new Map,this.responseScopedData.set(e,r)),r}},Iz=class{constructor(e){this.responseScopedData=new Map}set(e,r,n,o){let s=o,a=this._getResponseScopedData(e),c={content:s,fileTree:n};a.set(r,c)}get(e,r){let{projectName:n,path:o}=this._getFileMetadata(r),a=this._getResponseScopedData(e).get(n);if(!a)return;let c=a.fileTree.value,u=Pz(c,o);return u&&!u?.content&&!u?.children&&(u.content=Promise.resolve(new Uint8Array(new TextEncoder().encode(a.content)))),u}_getFileMetadata(e){let[,r,...n]=e.split("/");return{projectName:r,path:n}}_getResponseScopedData(e){let r=this.responseScopedData.get(e);return r||(r=new Map,this.responseScopedData.set(e,r)),r}};function Pz(t,e){let r;for(let n of e)r?r.children&&(r=r.children.find(o=>o.name===n)??r):r=t.find(o=>o.name===n);return r}var Q3="new",EI=class{constructor(e){this.accessor=e;this.id="new";this.locations=[2];this.description=fm.t("Scaffold code for a new file or project in a workspace");this.commandInfo={allowsEmptyArgs:!1,defaultEnablement:!0}}static{this.ID="new"}get intentDetectionInput(){let e="create_new_workspace";return{functionName:e,sampleQuestion:"Create a RESTful API server using typescript",modelDescription:"Scaffolds a new file or project from scratch based on requirements from the user.",functionCallingBlurb:`If the user's message is related to generating files, folders, projects, workspaces, or VS Code extensions, you should use the '${e}' function.`}}async invoke(e){let r=e.location,o=await this.accessor.get(Se).getEndpointForLocation(r);return new Cz(this.accessor,this,o,r)}};EI=w([b(0,st)],EI);function Dpe(t,e){return{command:Rz,arguments:[t,e],title:fm.t("Create Workspace...")}}function DUe(t){return{command:kz,arguments:[t],title:fm.t("Create File...")}}var Cz=class{constructor(e,r,n,o){this.accessor=e;this.intent=r;this.endpoint=n;this.location=o;this.linkification={disable:!0}}async getShouldUseProjectTemplate(e){let r=e.get(be).getConfig(de.UseProjectTemplates);return r!==void 0?r:!1}async buildPrompt(e,r,n){let{query:o,history:s,chatVariables:a}=e,c=!a.hasVariables()&&s[s.length-1]?.request?.message!==o&&await this.getShouldUseProjectTemplate(this.accessor),u=Be.create(this.accessor.get(K),this.endpoint,CI,{promptContext:e,useTemplates:c,endpoint:this.endpoint}),l=await u.render(r,n),d=u.getMeta(Iy);return d&&(this.githubContentMetadata=d),l}processResponsePanel(e,r,n,o,s){return new Tz(this.accessor,this.githubContentMetadata).processResponse(e,r,n,o,s)}async commands(e){if(!e.response?.message||!e.requestId)return[];let r=this.accessor.get(ku).getFileTree(e.requestId);if(!r)return[];if(Ez(r.baseUri))return[];if(wz(r.baseUri))return[DUe(r)];let n=this.accessor.get(Ve).getWorkspaceFolders();return[Dpe(r,n.length>0?n[0]:void 0)]}};function NUe(t){let e=(t.match(/   /g)||[]).length;return e+=(t.match(/\|   /g)||[]).length,e+=(t.match(/    /g)||[]).length,e+=(t.match(/ /g)||[]).length,e+=(t.match(/ /g)||[]).length,e}var LUe=["node_modules","out","bin","debug","obj","lib",".dll",".pdb",".lib",".jpg",".png",".ico",".gif",".svg",".jpeg",".tiff",".bmp",".webp",".jpeg",".gitignore","LICENSE.txt","yarn.lock","package-lock.json"];function Npe(t){let e=[];for(let r of t)OUe(r)||(r.children&&(r.children=Npe(r.children)),e.push(r));return e}function OUe(t){return!!LUe.includes(t.name)}function MUe(t,e){let r=e.trim().split(`
`),n=[],o,s={name:"",children:[]};n[0]=s;for(let c of r){let u=NUe(c),l=c.lastIndexOf("\u2500\u2500 "),d=l>=0?c.substring(l+3):c,p={name:d};if(u===0){o=Lpe(t,d),s.name=d;continue}else{for(;u>0&&n[u-1]===void 0;)u--;n[u-1].children===void 0?n[u-1].children=[p]:n[u-1].children?.push(p),n[u]=p}}if(o===void 0)throw new Error("Base URI is undefined");let a=Npe(s.children);return s.children=a.sort((c,u)=>c.children&&!u.children?-1:1),{chatResponseTree:new og([s],o),projectName:s.name}}function FUe(t,e,r){let n;r?n=t.map(l=>[e.path,l.path].join("/")):n=t.map(l=>l.path);let o=n[0].split("/")[0],s={name:o,children:[]},a={rootName:s};for(let l of n){let d=l.split("/"),p=o,f=s;for(let m=1;m<d.length;m++){let h=d[m];if(p+=`/${h}`,!a[p]){let g={name:h};f.children===void 0&&(f.children=[]),f.children.push(g),a[p]=g}f=a[p]}}let c;r?c=s.children?.[0].children??[]:c=s.children??[];let u=c?.sort((l,d)=>l.children&&!d.children?-1:1)??[];return new og(u,e)}var i5="vscode-copilot-workspace",o5="vscode-copilot-github-workspace",Cy="vscode-copilot-file";function Lpe(t,e,r=!1){return Gr.from({scheme:r?o5:i5,authority:t??"",path:e?`/${e}`:void 0})}var Tz=class{constructor(e,r){this.accessor=e;this.githubContentMetadata=r;this._appliedText="";this._p=Promise.resolve("")}async processResponse(e,r,n,o,s){let a=!1,c="",u=/```filetree\n/,l=r.filter(p=>p.role!=="system"),d=!1;for await(let{delta:p}of n){if(s.isCancellationRequested)break;let f=p.text;this._p=this._p.then(async()=>{let m=e.requestId??"";if(e.response||(e.response={message:this._appliedText,type:"model"}),!f)return this._appliedText;if(e.response.message+=f,this._appliedText+=f,this._appliedText.startsWith("#"))/(?:.*\n){1,}/.test(this._appliedText)&&o.markdown(f);else{let h=e.request.message,g=this._appliedText.match(/```filetree\n([\s\S]+?)\n```/);if(g&&(a||!d)){a=!1;let[v,y]=this._appliedText.split(g[0]);d||o.markdown(v),c=g[1];let{chatResponseTree:_,projectName:x}=MUe(m,c);o.progress(fm.t("Generating workspace preview...")),o.push(_),o.markdown(y),this.accessor.get(ku).set(m,x,_,{userPrompt:h,projectStructure:c,chatMessages:l})}else if(this._appliedText.match(u)&&!a&&!g){a=!0;let[v,y]=this._appliedText.split(u);c+=y,o.progress(fm.t("Generating workspace preview..."))}else a?c+=f:!a&&!this._appliedText.match(/```/)&&(d=!0,o.markdown(f))}return this._appliedText})}if(await this._p,e.requestId&&this.githubContentMetadata&&this.githubContentMetadata.org&&this.githubContentMetadata.repo&&this.githubContentMetadata.path&&this.githubContentMetadata.githubRepoItems&&!this.accessor.get(ku).getFileTree(e.requestId)){o.reference(Gr.parse(this.githubContentMetadata.githubRepoItems[0].html_url)),o.progress(fm.t("Generating workspace preview..."));let p=this.githubContentMetadata.path===".",f=p?this.githubContentMetadata.repo:this.githubContentMetadata.path.split("/")[0],m=FUe(this.githubContentMetadata.githubRepoItems,Lpe(e.requestId,f,!0),p);o.push(m);let h=this.accessor.get(Ve).getWorkspaceFolders();o.button(Dpe(m,h.length>0?h[0]:void 0)),this.accessor.get(ku).set(e.requestId,f,m,this.githubContentMetadata);let g=encodeURIComponent(`["@workspace /${Q3} ${e.request.message}"]`),v=new us(fm.t("Hint: You can [regenerate this project without using this sample](command:workbench.action.chat.open?{0}) or use this [setting](command:workbench.action.openSettings?%5B%22github.copilot.chat.useProjectTemplates%22%5D) to configure the behavior.",g));v.isTrusted={enabledCommands:["workbench.action.openSettings","workbench.action.chat.open"]},o.markdown(v)}else{if(!e.requestId)throw new Error("Request ID is undefined");let p=Fs(this._appliedText);if(p.length===2){let f;try{f=ip(p[1].code)}catch(y){throw y}let m=Gr.from({scheme:Cy,authority:e.requestId,path:`/${f.fileName}`}),h=new og([{name:`${f.fileName}`}],m),g=rp(n5,[h]),v=new us(`[${f.fileName}](${g})`);v.isTrusted={enabledCommands:[n5]},o.markdown(fm.t("Sure, here is the file you requested:")),o.markdown(v),this.accessor.get(ku).set(e.requestId,f.fileName,h,p[0].code)}}return this._appliedText}};function Ez(t){return t.scheme===o5}function wz(t){return t.scheme===Cy}var zs=require("vscode"),fP=class{constructor(e){this.contentManager=e;this._onDidChangeFile=new zs.EventEmitter;this.onDidChangeFile=this._onDidChangeFile.event}async stat(e){let r=this.contentManager.get(e);if(!r)throw zs.FileSystemError.FileNotFound(e);let n=await r.content?.then(o=>o?.length)??0;return{ctime:r.ctime??0,mtime:r.ctime??0,size:n,type:r.children?zs.FileType.Directory:zs.FileType.File}}readDirectory(e){let r=this.contentManager.get(e);if(!r)throw zs.FileSystemError.FileNotFound(e);return r.children?.map(n=>[n.name,n.children?zs.FileType.Directory:zs.FileType.File])??[]}async readFile(e){let r=this.contentManager.get(e);if(!r)throw zs.FileSystemError.FileNotFound(e);let n;try{n=await r.content}catch{}return n??new Uint8Array}watch(e,r){return{dispose(){}}}createDirectory(e){throw zs.FileSystemError.NoPermissions(e)}writeFile(e,r,n){throw zs.FileSystemError.NoPermissions(e)}delete(e,r){throw zs.FileSystemError.NoPermissions(e)}rename(e,r,n){throw zs.FileSystemError.NoPermissions(r)}copy(e,r,n){throw zs.FileSystemError.NoPermissions(r)}};var a5=require("vscode");var s5=class extends dt{constructor(r){super();this.contentManager=r;this.onDidChangeEmitter=new a5.EventEmitter;this.onDidChange=this.onDidChangeEmitter.event;this._register(a5.workspace.onDidChangeTextDocument(n=>{n.document.uri.scheme===Cy&&this.onDidChangeEmitter.fire(n.document.uri)}))}async provideTextDocumentContent(r,n){let o=this.contentManager.get(r);if(!o)return"";let s;try{s=await o.content}catch{}return new TextDecoder().decode(s)??""}};function Mpe(t,e){return et.Disposable.from(et.workspace.registerFileSystemProvider(i5,new fP(t.get(ku)),{isReadonly:new et.MarkdownString(et.l10n.t(`This file preview was generated by Copilot and may contain surprises or mistakes.

Ask followup questions to refine it, then press Create Workspace.`))}),et.workspace.registerFileSystemProvider(o5,new fP(t.get(ku)),{isReadonly:!0}),et.workspace.registerTextDocumentContentProvider(Cy,new s5(t.get(ku))),et.commands.registerCommand(Rz,async(r,n)=>{let o=(await et.window.showOpenDialog({defaultUri:n,title:wI.basename(r.baseUri.path),canSelectFolders:!0,canSelectFiles:!1,canSelectMany:!1,openLabel:"Select as Parent Folder"}))?.[0];o&&await UUe(t.get(oe),n,o,r)}),et.commands.registerCommand(n5,async r=>{let n=et.Uri.joinPath(r.baseUri,r.value[0].name).toString(),o=await et.workspace.openTextDocument(et.Uri.parse(n));await et.window.showTextDocument(o,{preview:!1})}),et.commands.registerCommand(kz,async r=>{let n={defaultUri:et.Uri.file(wI.posix.join(et.workspace.workspaceFolders?.[0].uri.path??"",r.value[0].name)),saveLabel:et.l10n.t("Save File")},o=await et.window.showSaveDialog(n);if(o){let s=et.Uri.joinPath(r.baseUri,r.value[0].name).toString(),a=await et.workspace.openTextDocument(et.Uri.parse(s));await et.workspace.fs.writeFile(o,Buffer.from(a.getText()));let c=[];et.window.tabGroups.all.forEach(l=>{l.tabs.forEach(d=>{d.input instanceof et.TabInputText&&d.input.uri.scheme===Cy&&c.push(d)})}),et.window.tabGroups.close(c,!0);let u=await et.workspace.openTextDocument(et.Uri.file(o.fsPath));await et.window.showTextDocument(u)}}))}async function UUe(t,e,r,n){let o=n.baseUri.path,s=await BUe(r,o),a=[];et.window.tabGroups.all.forEach(u=>{u.tabs.forEach(l=>{l.input instanceof et.TabInputText&&l.input.uri.scheme===i5&&a.push(l)})}),et.window.tabGroups.close(a,!0);let c=et.Uri.joinPath(r,s);try{if(await et.window.withProgress({location:et.ProgressLocation.Notification,cancellable:!0},async(m,h)=>{await et.workspace.fs.createDirectory(c);let g=wI.basename(o);async function v(y,_,x){let S=y?y.slice(g.length+1):"..",I=et.Uri.joinPath(c,S,_.name);if(_.children?.length||!kpe(_.name)){y!==""&&(m.report({message:et.l10n.t("Creating folder {0}...",I.fsPath)}),await et.workspace.fs.createDirectory(I));for(let E of _.children??[])await v(wI.posix.join(y,_.name),E,x)}else{m.report({message:et.l10n.t("Creating file {0}...",I.fsPath)});let E=await et.workspace.fs.readFile(et.Uri.joinPath(x,y,_.name));await et.workspace.fs.writeFile(I,Buffer.from(E))}}for(let y of n.value)await v("",y,n.baseUri);await jUe(c)}),e&&c.fsPath.startsWith(e.fsPath))return;let u=et.l10n.t("Would you like to open the created workspace?"),l=et.l10n.t("Open"),d=et.l10n.t("Open in New Window"),p=[l,d],f=await et.window.showInformationMessage(u,{modal:!0},...p);f===l?(et.interactive.transferActiveChat(c),t.public.info("[newIntent] Opening folder: "+c.fsPath),et.commands.executeCommand("vscode.openFolder",c)):f===d&&et.commands.executeCommand("vscode.openFolder",c,!0)}catch(u){let l=`[newIntent] Failed to create workspace: ${s}`;t.public.error(u,l),et.window.showErrorMessage(l),await et.workspace.fs.delete(c,{recursive:!0})}}async function BUe(t,e){let r=0,n=!0,o=e;for(;n;)try{await et.workspace.fs.stat(et.Uri.joinPath(t,o)),o=e+"-"+ ++r}catch{n=!1}return o}async function qUe(t){try{return await et.workspace.fs.stat(t),!0}catch{return!1}}async function jUe(t){let e=HUe();if(e)if(await qUe(e)){let r=await et.workspace.fs.readFile(e).then(o=>new Ope.TextDecoder().decode(o)),n=JSON.parse(r);n.push(t.toString()),await et.workspace.fs.writeFile(e,Buffer.from(JSON.stringify(n,null,2)))}else await et.workspace.fs.writeFile(e,Buffer.from(JSON.stringify([t.toString()],null,2)))}function HUe(){let t=et.env.appName.indexOf("Insider")>0||et.env.appName.indexOf("Code - OSS Dev")>=0?"Code - Insiders":"Code",e=et.Uri.file(process.env.HOME||(process.env.USERPROFILE?process.env.USERPROFILE:""));switch(process.platform){case"darwin":return et.Uri.joinPath(e,"Library","Application Support",t,"User","workspaceStorage","aiGeneratedWorkspaces.json");case"linux":return et.Uri.joinPath(e,".config",t,"User","workspaceStorage","aiGeneratedWorkspaces.json");case"win32":return process.env.APPDATA?et.Uri.joinPath(et.Uri.file(process.env.APPDATA),t,"User","workspaceStorage","aiGeneratedWorkspaces.json"):void 0;default:return}}var RI=ie("IDebugOutputService");async function c5(t,e){let r=t.get(zt),n=t.get(To),o=t.get(Co),s=t.get(Ve),a=t.get(Zn),c=t.get(RI),u=t.get(xo),l=s.getWorkspaceFolders().map(y=>y.fsPath+"/"),d=s.notebookDocuments.map(y=>y.uri.fsPath),f=(await Promise.all(e.map(y=>o.getWorkspaceSymbols(y)))).flat().map(y=>({name:y.name,kind:y.kind,containerName:y.containerName,filePath:y.location.uri.fsPath,start:y.location.range.start,end:y.location.range.end})),m=r.activeTextEditor?n.getDiagnostics(r.activeTextEditor.document.uri).map(y=>({start:y.range.start,end:y.range.end,message:y.message,severity:y.severity,relatedInformation:y.relatedInformation?.map(VUe)})):[],h=r.activeTextEditor?{selections:r.activeTextEditor?.selections.map(y=>({anchor:y.anchor,active:y.active,isReversed:y.isReversed}))??[],documentFilePath:r.activeTextEditor?.document.uri.fsPath??"",visibleRanges:r.activeTextEditor?.visibleRanges.map(y=>({start:y.start,end:y.end}))??[],languageId:r.activeTextEditor?.document.languageId??"javascript"}:void 0,g=a.terminalLastCommand?{commandLine:a.terminalLastCommand.commandLine,cwd:typeof a.terminalLastCommand.cwd=="object"?a.terminalLastCommand.cwd.toString():a.terminalLastCommand.cwd,exitCode:a.terminalLastCommand.exitCode,output:a.terminalLastCommand.output}:void 0;return{workspaceFoldersFilePaths:l,symbols:f,activeFileDiagnostics:m,activeTextEditor:h,debugConsoleOutput:c.consoleOutput,terminalBuffer:a.terminalBuffer,terminalLastCommand:g,terminalSelection:a.terminalSelection,terminalShellType:a.terminalShellType,repoContexts:u.repositories,notebookDocumentFilePaths:d,activeNotebookEditor:void 0}}function VUe(t){return{filePath:t.location.uri.fsPath,start:t.location.range.start,end:t.location.range.end,message:t.message}}var u5=H(Gt()),Fpe=require("path"),Ja=H(require("vscode")),Upe=require("vscode");var Uc=H(nt()),mP=require("path");var kI=class extends X{constructor(r,n){super(r);this._terminalService=n}render(){let r=this._terminalService.terminalLastCommand?.cwd?typeof this._terminalService.terminalLastCommand.cwd=="string"?this._terminalService.terminalLastCommand.cwd:this._terminalService.terminalLastCommand.cwd.path:void 0;return vscpp(vscppf,null,vscpp(Uc.SystemMessage,{priority:1e3},"You are a programmer who specializes in using the command line. Your task is to respond with a list of files that you need access to in order to fix the command. Carefully consider the command line, output and current working directory in your response.",vscpp("br",null),vscpp(Rt,null),vscpp(Xt,null),`
You MUST respond ONLY with a JSON array in the format:

\`\`\`json
[
	{
		fileName: string
	},
	...
]
\`\`\`

Follow these rules in your response:

- Use an absolute path if you know the exact location of the file.
- Do NOT include any introduction, description or prose. Only include the paths.
`),vscpp(Uc.SystemMessage,{priority:1e3},`Examples:

User: npm startt
Assistant:
- \`${r?(0,mP.join)(r,".bin/startt"):".bin/startt"}\`
- \`${r?(0,mP.join)(r,"package.json"):"package.json"}\`
`),vscpp(AI,{priority:800}),vscpp(DI,{priority:600}),vscpp(Uc.UserMessage,{priority:1100},this._terminalService.terminalLastCommand?"":`The following command just failed when run in the terminal \`${this.props.commandLine}\`.

Here is the output of the command:
${(this.props.output??[]).join()}`),vscpp(lm,{priority:800}))}};kI=w([b(1,Zn)],kI);var PI=class extends X{constructor(r,n){super(r);this._terminalService=n}render(r){let n=this.props.verifiedContextUris.map(o=>vscpp(Kd,{variableName:(0,mP.basename)(o.path),variableValue:o}));return vscpp(vscppf,null,vscpp(Uc.SystemMessage,{priority:1e3},"You are a programmer who specializes in using the command line. Your task is to help the user fix a command that was run in the terminal by providing a list of fixed command suggestions. Carefully consider the command line, output and current working directory in your response.",vscpp("br",null),vscpp(Rt,null),vscpp(Xt,null),`
You MUST respond ONLY with a JSON array containing HIGHLY RELEVANT command suggestions in the format:

\`\`\`json
[
	{
		command: string,
		description: string,
		relevance: 'low' | 'medium' | 'high'
	},
	...
]
\`\`\`

Follow these rules in your response:

- You MUST NOT suggest commands that use non-existent files.
- Under no circumstance will you include an summary, description or any prose whatsoever.
- Do NOT repeat the command and/or output.
- Provide a maximum of 10 suggestions, starting with the most relevant.
- When there is text that needs to be replaced in the suggestion, prefix the text with '{', suffix the text with '}' and use underscores instead of whitespace. Only do this when the replacement text is NOT provided.
- Avoid providing suggestions that do exactly the same thing like aliases.
- Only provide suggestions for the active shell and avoid shelling out where possible.
- The suggestions must be relevant. For example, if the command is a build command, the suggestions must look like build commands, not test commands.
- If the command is related to a particular programming language, do not include suggestions for different languages.
- NEVER suggest to change directory to the current working directory.
`),vscpp(Uc.SystemMessage,{priority:700},`Examples:

User: lss
Assistant:
- \`ls\`

User: clone git
Assistant:
- \`git clone {repository}\`

User: .venv/bin/activate
Context: .venv/bin/activate DOES NOT exist
Assistant:
- \`python -m venv .venv\`

User: .venv/bin/activate
Context: .venv/bin/activate exists
Assistant:
- \`source .venv/bin/activate\`
`),vscpp(AI,{priority:800}),vscpp(DI,{priority:800}),vscpp(Az,{priority:600}),vscpp(Uc.UserMessage,{priority:1100},this._terminalService.terminalLastCommand?"":`The following command just failed when run in the terminal \`${this.props.commandLine}\`.

Here is the output of the command:
${(this.props.output??[]).join()}`),vscpp(lm,{priority:800}),vscpp(Uc.UserMessage,{priority:700},`${this.props.verifiedContextDirectoryUris.length>0?`The following directories exist:

${this.props.verifiedContextDirectoryUris.map(o=>`- ${o.path}`).join(`
`)}`:""}`),vscpp(Uc.UserMessage,{priority:700},`${this.props.nonExistentContextUris.length>0?`The following files DO NOT exist and cannot be used in the suggestion:

${this.props.nonExistentContextUris.map(o=>`- ${o.path}`).join(`
`)}`:""}`),...n)}};PI=w([b(1,Zn)],PI);var Az=class extends X{render(){return vscpp(vscppf,null,vscpp(Uc.SystemMessage,{priority:this.props.priority},`
Follow these guidelines for python:
- NEVER recommend using "pip install" directly, always recommend "python -m pip install"
- The following are pypi modules: ruff, pylint, black, autopep8, etc
- If the error is module not found, recommend installing the module using "python -m pip install" command.
- If activate is not available create an environment using "python -m venv .venv".
`))}},AI=class extends X{constructor(r,n){super(r);this._terminalService=n}render(){return vscpp(vscppf,null,vscpp(Uc.UserMessage,{priority:this.props.priority},"The active terminal's shell type is: ",this._terminalService.terminalShellType))}};AI=w([b(1,Zn)],AI);var DI=class extends X{constructor(r,n){super(r);this._envService=n}render(){return vscpp(vscppf,null,vscpp(Uc.UserMessage,{priority:this.props.priority},"The active operating system is: ",this._envService.OS))}};DI=w([b(1,St)],DI);function GUe(t){switch(t){case 3:return u5.t("high relevance");case 2:return u5.t("medium relevance");case 1:return u5.t("low relevance")}}function zUe(t){return t==="high"?3:t==="medium"?2:1}function Bpe(t){qpe=t}var qpe;async function jpe(t){let e=qpe;if(!e)return;let r=new Promise(o=>{t.createInstance(hP).generateTerminalQuickFix(e,Lr.None).then(s=>{let a=(s??[]).sort((u,l)=>l.relevance-u.relevance).map(u=>({label:u.command,description:u.description,suggestion:u})),c;for(let u=0;u<a.length;u++){let l=a[u],d=a.at(u-1);"suggestion"in l&&(!c||u>0&&"suggestion"in d&&l.suggestion.relevance!==d.suggestion.relevance)&&(c=l.suggestion.relevance,a.splice(u++,0,{label:GUe(c),kind:Ja.QuickPickItemKind.Separator}))}o(a)})}),n=await Ja.window.showQuickPick(r,{canPickMany:!1});if(n&&"suggestion"in n){let o=!n.suggestion.command.match(/{.+}/);Ja.window.activeTerminal?.sendText(n.suggestion.command,o)}}var hP=class{constructor(e,r,n,o,s){this._chatMLFetcher=e;this._endpointProvider=r;this._instantiationService=n;this._logService=o;this._workspaceService=s}async generateTerminalQuickFix(e,r){let n=await this._generateTerminalQuickFixFileContext(e,r);if(!n||r.isCancellationRequested)return;let o=[],s=[],a=[];for(let f of n)try{let m=await Ja.workspace.fs.stat(f);m.type===Ja.FileType.File||m.type===Ja.FileType.SymbolicLink?o.push(f):m.type===Ja.FileType.Directory?s.push(f):a.push(f)}catch{a.push(f)}let c=await this._endpointProvider.getChatEndpoint("gpt-3.5-turbo"),l=await Be.create(this._instantiationService,c,PI,{commandLine:e.commandLine,output:[],verifiedContextUris:o,verifiedContextDirectoryUris:s,nonExistentContextUris:a}).render(void 0,void 0),d=await this._chatMLFetcher.fetchOne("terminalQuickFixGenerator",l.messages,async f=>{},r,3,c,void 0,{temperature:.1,top_p:1,stop:["dontStopBelieving"]});if(this._logService.public.info("Terminal QuickFix FetchResult "+d),r.isCancellationRequested)return;if(d.type!=="success")throw new Error(Ja.l10n.t("Encountered an error while determining terminal quick fixes: {0}",d.type));this._logService.internal.debug("generalTerminalQuickFix fetchResult.value "+d.value);let p=[];try{let f=JSON.parse(d.value);if(f&&Array.isArray(f)){for(let m of f)if(typeof m=="object"&&m){let h="command"in m&&typeof m.command=="string"?m.command:void 0,g="description"in m&&typeof m.description=="string"?m.description:void 0,v="relevance"in m&&typeof m.relevance=="string"&&(m.relevance==="low"||m.relevance==="medium"||m.relevance==="high")?m.relevance:void 0;h&&g&&v&&p.push({command:h,description:g,relevance:zUe(v)})}}}catch{}return p}async _generateTerminalQuickFixFileContext(e,r){let n=await this._endpointProvider.getChatEndpoint("gpt-3.5-turbo"),s=await Be.create(this._instantiationService,n,kI,{commandLine:e.commandLine,output:[]}).render(void 0,void 0);this._logService.internal.debug("_generalTerminalQuickFixFileContext prompt.messages: "+s.messages);let a=await this._chatMLFetcher.fetchOne("terminalQuickFixGenerator",s.messages,async f=>{},r,3,n,void 0,{temperature:.1,top_p:1,stop:["dontStopBelieving"]});if(this._logService.internal.info("Terminal Quick Fix Fetch Result: "+a),r.isCancellationRequested)return;if(a.type!=="success")throw new Error(Ja.l10n.t("Encountered an error while fetching quick fix file context: {0}",a.type));this._logService.internal.debug("_generalTerminalQuickFixFileContext fetchResult.value"+a.value);let c=[];try{let f=JSON.parse(a.value);if(f&&Array.isArray(f)){for(let m of f)if(typeof m=="object"&&m){let h="fileName"in m&&typeof m.fileName=="string"?m.fileName:void 0;h&&c.push({fileName:h})}}}catch{}let u=[],l=new Set,d=this._workspaceService.getWorkspaceFolders(),p=async f=>{for(let m of d){let h=Ye.joinPath(m,f);if(l.has(h.toString()))return;l.add(h.toString()),u.push(h)}};for(let{fileName:f}of c)f.endsWith(".exe")||f.includes("/bin/")&&!f.endsWith("activate")||((0,Fpe.isAbsolute)(f)?u.push(Upe.Uri.file(f)):await p(f));return u}};hP=w([b(0,Ct),b(1,Se),b(2,K),b(3,oe),b(4,Ve)],hP);var l5=ie("IConversationFeature"),NI=class{constructor(e,r,n,o,s,a,c,u,l,d,p,f){this.accessor=e;this.instantiationService=r;this.logService=n;this.configurationService=o;this.conversationOptions=s;this.chatAgentService=a;this.telemetryService=c;this.authenticationService=u;this.embeddingIndex=l;this.devContainerConfigurationService=d;this.gitCommitMessageService=p;this.linkifyService=f;this._disposables=new ht;this._activatedDisposables=new ht;this._enabled=!1,this._activated=!1,this.registerCopilotTokenListener(),this._disposables.add(u.onDidAuthenticationChange(async()=>{let m=!!u.copilotToken;this.logService.public.debug(`onDidChangeSessionsHandler has token: ${m}`),m?this.activated=!0:this.activated=!1}))}get enabled(){return this._enabled}set enabled(e){e&&!this.activated&&(this.activated=!0),this._enabled=e,qe.commands.executeCommand("setContext","github.copilot.interactiveSession.disabled",!e)}get activated(){return this._activated}set activated(e){if(this._activated!==e)if(this._activated=e,!e)this._activatedDisposables.clear();else{let r=this.conversationOptions;this._activatedDisposables.add(this.registerProviders()),this._activatedDisposables.add(this.registerCommands(r)),this._activatedDisposables.add(this.registerCodeLens()),this._activatedDisposables.add(this.registerRelatedInformationProviders()),this._activatedDisposables.add(this.registerParticipants(r))}}dispose(){this._activated=!1,this._activatedDisposables.dispose(),this._disposables?.dispose()}[Symbol.dispose](){this.dispose()}registerParticipants(e){return this.chatAgentService.register(e)}registerProviders(){let e=new ht;try{"registerMappedEditsProvider"in qe.chat&&e.add(qe.chat.registerMappedEditsProvider("*",this.instantiationService.createInstance(xI))),"registerNewSymbolNamesProvider"in qe.languages&&e.add(qe.languages.registerNewSymbolNamesProvider({language:"*"},this.instantiationService.createInstance(Vl))),this.registerParticipantDetectionProvider(),e.add(qe.workspace.registerAITextSearchProvider("file",this.instantiationService.createInstance(vI)))}catch(r){this.logService.public.error(r,"Registration of interactive providers failed")}return e}registerParticipantDetectionProvider(){if("registerChatParticipantDetectionProvider"in qe.chat){let e=this.instantiationService.createInstance(np,2);this._disposables.add(qe.chat.registerChatParticipantDetectionProvider(e))}}registerCommands(e){let r=new ht;return[qe.commands.registerCommand("github.copilot.interactiveSession.feedback",async()=>qe.env.openExternal(qe.Uri.parse(l4))),qe.commands.registerCommand("github.copilot.debug.workbenchState",async()=>{let n=await qe.window.showInputBox({prompt:"Enter a comma-separated list of symbol queries. Can be left blank if not using WorkspaceSymbols"}),o=await qe.window.showInputBox({prompt:"Enter a file name - .state.json will be appended as the extension",value:"workspaceState"});if(!o)return;let s=await c5(this.accessor,n?.split(",")??[]),a=qe.workspace.workspaceFolders?.[0].uri;if(!a)return;let c=qe.Uri.joinPath(a,`${o}.state.json`),u=JSON.stringify(s,null,2);u=u.replace(new RegExp(`${a.fsPath}/`,"g"),"./"),qe.workspace.fs.writeFile(c,Buffer.from(u))}),qe.commands.registerCommand("github.copilot.terminal.explainTerminalSelection",async()=>this.triggerTerminalChat({query:`/${Hl.intentName} #terminalSelection`})),qe.commands.registerCommand("github.copilot.terminal.explainTerminalSelectionContextMenu",()=>qe.commands.executeCommand("github.copilot.terminal.explainTerminalSelection")),qe.commands.registerCommand("github.copilot.terminal.explainTerminalLastCommand",async()=>this.triggerTerminalChat({query:`/${Hl.intentName} #terminalLastCommand`})),qe.commands.registerCommand("github.copilot.terminal.fixTerminalLastCommand",async()=>jpe(this.instantiationService)),qe.commands.registerCommand("github.copilot.terminal.generateCommitMessage",async()=>{let n=qe.workspace.workspaceFolders;if(!n?.length)return;let o=n.length===1?n[0].uri:await qe.window.showWorkspaceFolderPick().then(c=>c?.uri);if(!o)return;let s=this.gitCommitMessageService.getRepository(o);if(!s)return;let a=await this.gitCommitMessageService.generateCommitMessage(s,Lr.None);if(a){let u=`git commit -m "${a.replace(/"/g,'\\"').replace(/\\/g,"\\\\").replace(/\$/g,"\\$")}"`;qe.window.activeTerminal?.sendText(u,!1)}}),qe.commands.registerCommand("github.copilot.git.generateCommitMessage",async(n,o,s)=>{let a=this.gitCommitMessageService.getRepository(n);if(!a)return;let c=await this.gitCommitMessageService.generateCommitMessage(a,s);c&&(a.inputBox.value=c)}),qe.commands.registerCommand("github.copilot.devcontainer.generateDevContainerConfig",async(n,o=new qe.CancellationTokenSource().token)=>this.devContainerConfigurationService.generateConfiguration(n,o)),Rpe(this.accessor),ipe(this.telemetryService),this.linkifyService.registerGlobalLinkifier({create:()=>this.instantiationService.createInstance(aI)}),Qde(this.accessor),hpe(this.accessor),tpe(this.instantiationService),this.registerTerminalQuickFixProviders(),$Ue(this.accessor,e),Mpe(this.accessor,e),YUe(this.accessor),Bce(this.accessor),epe(this.accessor),WUe(),KUe()].forEach(n=>r.add(n)),r}registerCodeLens(){let e=new ht;if(dm.isEnabled(this.configurationService)){let r=this.instantiationService.createInstance(dm);e.add(qe.languages.registerCodeLensProvider("*",r)),e.add(r)}return e}async triggerTerminalChat(e){let r=this.configurationService.getConfig(de.TerminalChatLocation),n;switch(r){case"quickChat":n="workbench.action.quickchat.toggle",e.query=`@${Xb} `+e.query;break;case"terminal":n="workbench.action.terminal.chat.start";break;case"chatView":default:n="workbench.action.chat.open",e.query=`@${Xb} `+e.query;break}await qe.commands.executeCommand(n,e)}registerRelatedInformationProviders(){let e=new ht;return[qe.ai.registerRelatedInformationProvider(qe.RelatedInformationType.CommandInformation,this.embeddingIndex.commandIdIndex),qe.ai.registerRelatedInformationProvider(qe.RelatedInformationType.SettingInformation,this.embeddingIndex.settingsIndex)].forEach(r=>e.add(r)),e}registerCopilotTokenListener(){this._disposables.add(this.authenticationService.onDidAuthenticationChange(()=>{let e=this.authenticationService.copilotToken?.isChatEnabled();this.logService.public.info(`copilot token chat_enabled: ${e}, sku: ${this.authenticationService.copilotToken?.sku??""}`),this.enabled=e??!1}))}registerTerminalQuickFixProviders(){let e=()=>this.enabled;return Yx(qe.window.registerTerminalQuickFixProvider("copilot-chat.fixWithCopilot",{provideTerminalQuickFixes(r,n){return!e()||r.commandLine.endsWith("^C")?[]:(Bpe(r),[{command:"github.copilot.terminal.fixTerminalLastCommand",title:qe.l10n.t("Fix using Copilot")},{command:"github.copilot.terminal.explainTerminalLastCommand",title:qe.l10n.t("Explain using Copilot")}])}}),qe.window.registerTerminalQuickFixProvider("copilot-chat.generateCommitMessage",{provideTerminalQuickFixes:(r,n)=>this.enabled?[{command:"github.copilot.terminal.generateCommitMessage",title:qe.l10n.t("Generate Commit Message")}]:[]}))}};NI=w([b(0,st),b(1,K),b(2,oe),b(3,be),b(4,Rr),b(5,SS),b(6,he),b(7,Nt),b(8,Rl),b(9,f4),b(10,g4),b(11,X1)],NI);function $Ue(t,e){let r=t.get(be);return qe.commands.registerCommand("github.copilot.newNotebook",async n=>{let o=r.getConfig(de.NotebookIterativeImproving);await qe.window.withProgress({location:qe.ProgressLocation.Notification},async s=>{let a=new qe.NotebookData([]);a.metadata={custom:{cells:[],metadata:{orig_nbformat:4},nbformat:4,nbformat_minor:2}};let c=await qe.workspace.openNotebookDocument("jupyter-notebook",a),u=await qe.window.showNotebookDocument(c);s.report({message:qe.l10n.t("Generating notebook...")});let l=n.outline.description,d=n.outline.sections,p=await t.get(Se).getChatEndpoint("gpt-4");for(let f of d){let m=u.notebook.getCells().filter(I=>I.kind===qe.NotebookCellKind.Code).map(I=>I.document.getText()).join(`
`),h=new qe.CancellationTokenSource;s.report({message:qe.l10n.t('Generating section "{0}"...',f.title)});let g=await Xde(t,p,e,n.turn,l,f,m,h.token);if(!g)return;g=g.trim();let v=/```([a-zA-Z]+)?\s*([\s\S]+?)\s*```$/.exec(g);if(v&&v.length>2&&(g=v[2]),o){s.report({message:qe.l10n.t('Improving code for section "{0}"...',f.title)});let I=await Jde(t,p,e,l,f,m,g,h.token);if(!I)return;g=I}let y=new qe.NotebookCellData(qe.NotebookCellKind.Markup,`# ${f.title}
${f.content}`,"markdown"),_=new qe.NotebookCellData(qe.NotebookCellKind.Code,g,"python"),x=qe.NotebookEdit.insertCells(c.cellCount,[y,_]),S=new qe.WorkspaceEdit;S.set(c.uri,[x]),await qe.workspace.applyEdit(S),u.revealRange(new qe.NotebookRange(c.cellCount-1,c.cellCount),qe.NotebookEditorRevealType.Default),u.selection=new qe.NotebookRange(c.cellCount-1,c.cellCount)}s.report({increment:100})})})}function WUe(){return qe.commands.registerCommand("github.copilot.executeSearch",async t=>{let e=t.filesToExclude.length>0||t.filesToInclude.length>0;qe.commands.executeCommand("workbench.view.search.focus").then(()=>qe.commands.executeCommand("workbench.action.search.toggleQueryDetails",{show:e})),qe.commands.executeCommand("workbench.action.findInFiles",t)})}function KUe(){return qe.commands.registerCommand("github.copilot.ghpr.applySuggestion",async(t,e)=>{let r=s=>!!(s&&"body"in s&&(s.body instanceof qe.MarkdownString||typeof s.body=="string")),n=s=>"range"in s&&s.range instanceof qe.Range;if(!r(t)||!n(e))return;let o=t.body instanceof qe.MarkdownString?t.body.value:t.body;await qe.commands.executeCommand("vscode.editorChat.start",{initialRange:e.range,message:o,autoSend:!0})})}function YUe(t){return new K3(t)}var lfe=H(Gt());var LI=class{constructor(e,r,n,o,s,a,c){this.intent=e;this.location=r;this.endpoint=n;this.prompt=o;this.documentContext=s;this.features=a;this.instantiationService=c;this.replyInterpreter=null;this.followUps=void 0}async buildPrompt(e,r,n){let o=Be.create(this.instantiationService,this.endpoint,this.prompt,{documentContext:this.documentContext,promptContext:e,features:this.features}),s=await o.render(r,n);return this.replyInterpreter=o.getMeta(Hn)?.replyInterpreter??null,this.followUps=o.getMeta(KS)?.followUps,s}processResponseInline(e,r,n){if(!this.replyInterpreter)throw new Error("Could not process response without a reply interpreter.");return this.replyInterpreter.processResponse(e,r,n)}};LI=w([b(6,K)],LI);var mm=H(nt());function Hpe(t,e,r,n){let o=t.modelMaxPromptTokens*4/3,s=new zd(o),a=e.document,c=e.language,u=new Us(s,a,c,"ed8c6549bwf9"),l=new Us(s,a,c,"abpxx6d04wxr"),d=new Us(s,a,c,"be15d9bcejpp"),p=()=>(l.trim(),u.trim(),d.trim(),{contextInfo:{language:c,above:l,range:u,below:d},tracker:s});if(!QUe(u,r,n))return p();let m={aboveLineIndex:n.start.line-1,belowLineIndex:n.end.line+1,minimumLineIndex:0,maximumLineIndex:a.lineCount-1};return BG(m,l,d),p()}function QUe(t,e,r){let n=Math.floor((e.start.line+e.end.line)/2),o=Math.max(n-r.start.line,r.end.line-n);t.appendLine(n);for(let s=1;s<=o;s++){let a=n-s,c=n+s;if(a>=r.start.line&&!t.prependLine(a)||c<=r.end.line&&!t.appendLine(c))return!1}return!0}function dv(t,e,r,n){let o=t.getDiagnostics(e).filter(s=>!!s.range.intersection(r));if(n){let s=o.filter(a=>n.includes(a.message));if(s.length>0)return s}return o}async function Vpe(t,e,r){let n=K4(e),o=Math.max(r,e.end.line-e.start.line+r),s=await t.getFixSelectionOfInterest(n,o);return Y4(s)}var Kpe=H(nt());var Gpe=H(nt());var pv=class extends X{constructor(r,n,o,s,a,c,u,l){super(r);this.ignoreService=n;this.extensionContext=o;this.languageFeaturesService=s;this.workspaceService=a;this.logService=c;this.parserService=u;this.telemetryService=l}static{this.DEFAULT_TIMEOUT_MS=200}async render(r,n){if(await this.ignoreService.isCopilotIgnored(this.props.document.uri))return vscpp("ignoredFiles",{value:[this.props.document.uri]});let o=this.extensionContext.extensionMode===au.Test?0:this.props.timeoutMs===void 0?pv.DEFAULT_TIMEOUT_MS:this.props.timeoutMs,[s,a]=await this.findReferences(o);return this.logService.public.debug(`Found ${s.length} implementation(s)/definition(s), ${a.length} usages`),s.length>0&&this.logService.public.debug("Implementation(s)/definition(s) found:"+JSON.stringify(s,null,"	")),a.length>0&&this.logService.public.debug("Usages found:"+JSON.stringify(a,null,"	")),vscpp(vscppf,null,this.renderCodeExcerpts(`Relevant definition${s.length>1?"s":""}:`,s),this.renderCodeExcerpts("Other usages:",a))}renderCodeExcerpts(r,n){if(n.length>0)return vscpp(vscppf,null,r,vscpp("br",null),vscpp("br",null),n.map(o=>{let c=`${`${Ko(o.languageId).lineComment.start} FILEPATH: ${o.uri.path}`}
${o.code}`;return vscpp(Fe,{uri:o.uri,languageId:o.languageId,code:c,references:[new Gpe.PromptReference(new Ri(o.uri,o.excerptRange))]})}),vscpp("br",null),vscpp("br",null))}async findReferences(r){let{document:n,position:o}=this.props,s=async()=>{try{let l=await this.languageFeaturesService.getReferences(n.uri,o);return this.logService.public.debug(`Found ${l.length} references: `+JSON.stringify(l,null,"	")),l}catch{return[]}},a=await Ka(this.logService,this.telemetryService,n,r*3,s,[]),c=[],u=[];for(let l of a){if(await this.ignoreService.isCopilotIgnored(l.uri))continue;let d=await this.workspaceService.openTextDocument(l.uri),p=this.parserService.getTreeSitterAST(d);if(!p)continue;let f=io(l.range,d),m=await p.getCallExpressions(f),h=await p.getFunctionDefinitions();if(m.length>0)u.push({languageId:d.languageId,uri:d.uri,code:m[0].text,excerptRange:ms(d,m[0])});else if(h.some(g=>Sn.doIntersect(g,f))){let v=(await xg(this.parserService,this.telemetryService,{document:d,language:Ko(n.languageId),wholeRange:l.range,selection:new fS(l.range.start,l.range.end),fileIndentInfo:void 0})).range;c.push({languageId:d.languageId,uri:d.uri,code:d.getText(v),excerptRange:v})}}return[c,u]}};pv=w([b(1,ke),b(2,jt),b(3,Co),b(4,Ve),b(5,oe),b(6,_t),b(7,he)],pv);function zpe(t,e,r){let n=typeof r.code=="object"?r.code.value:r.code,o=XUe(t,e,r.source,n);return{fixes:o,messageReplacement(){for(let s of o)if(s.replaceMessage!==void 0)return s.replaceMessage},additionalContext(){let s=[];for(let a of o)a.additionalContext!==void 0&&s.push(a.additionalContext);return s}}}var $pe=new Map;$pe.set("typescript",["eslint","ts"]);$pe.set("python",["pylint","Pylint"]);function XUe(t,e,r,n){if(!e||!r||n===void 0)return[];let o=JUe[e];if(!o)return[];let s=o[r];if(!s)return[];let a=s[n];if(!a)return[];let c=t.get(wt),u=t.get(be),l=t.get(Qf);return(n.toString()==="C0301"||n.toString()==="C0301:line-too-long")&&!u.getExperimentBasedConfig(de.usePythonCookbookLineTooLong,c)&&!l.isInSimulationTests?[]:(t.get(he).sendMSFTTelemetryEvent("cookbookAccessed",{languageId:e,diagnosticCode:n.toString(),provider:r}),(Array.isArray(a)?a:[a]).map(f=>typeof f=="string"?{title:f,message:""}:f))}var JUe={python:{pylint:{C0301:["Split into many short lines to make sure each line is less than 20 tokens; split into many more lines than you normally would. Make sure to do the following: You must split all long strings, comments, and dictionary arguments and lists into shorter lines."]},Pylint:{"C0301:line-too-long":["Split into many short lines to make sure each line is less than 20 tokens; split into many more lines than you normally would. Make sure to do the following: You must split all long strings, comments, and dictionary arguments and lists into shorter lines."]}},typescript:{ts:{2345:[{title:"Use this declaration and other usages as examples.",message:"",additionalContext:0}],2554:[{title:"Use this declaration and other usages as examples.",message:"",additionalContext:0}]},eslint:{"class-methods-use-this":["Make the method static.","Move the method outside of the class.","Rewrite the method to use properties of the class."],"consistent-this":["Use the alias for this required by eslint consistent-this rule.","Use this directly instead of an alias."],"constructor-super":{title:"Add missing super call and pass through new arguments.",message:"The code is missing a super call in the constructor. Copy base class parameters to this constructor and pass them to super.",replaceMessage:"Missing super call in constructor"},"func-names":["Give the function expression the same name as the variable it is assigned to.","Convert the function to an arrow function."],"func-style":[{title:"Convert the function declaration to an expression.",message:"The function expression should be assigned to a variable with the name of the original function declaration."}],"max-lines-per-function":["Split into multiple functions."],"max-nested-callbacks":["Rewrite to avoid at least one callback."],"max-params":[{title:"Rewrite the signature to use an object parameter.",message:"Preserve all the parameters of the original signature."}],"max-statements":["Split into multiple functions."],"no-case-declarations":["Surround the case block with braces.","Move the declaration outside the case block."],"no-dupe-else-if":["Fix the duplicate condition to be different from the first.","Remove the duplicate condition"],"no-duplicate-case":[{title:"Change the duplicate condition to be different.",message:"Do not delete the duplicate case, just fix it",replaceMessage:"Duplicated condition."},"Remove the duplicate condition"],"no-duplicate-imports":"Merge the duplicated import lines.","no-fallthrough":[{title:"Rewrite to avoid fallthrough.",message:"Use the return value of the following cases and copy it to the preceding fallthrough case.",replaceMessage:"Fallthrough case in switch statement."},"Add a // fallthrough comment.","Add a break statement."],"no-inner-declarations":["Move the inner declaration to the top of its containing function.","Move the inner declaration to the bottom of its containing function.","Change the inner function declaration to an expression."],"no-multi-assign":"Assign each variable in separate statements.","no-negated-condition":"Invert the branches of the conditional.","no-new":["Convert the class to functions.","Assign the resulting object to a variable."],"no-sequences":[{title:"Wrap the whole comma sequence in parentheses.",message:"",replaceMessage:"Unnecessary comma sequence"},{title:"Rewrite, preserving the original behavior.",message:"The last element of the comma sequence is the one returned."},{title:"Delete the non-final elements of the sequence.",message:"They are unused unless it is for side effects."}],"no-sparse-arrays":["Remove duplicated commas.","Add default values for the missing elements."],"require-await":["Removed the unused async keyword.",{title:"Rewrite the function to use await.",message:"The code should change to call asynchronous functions where appropriate."}],"sort-keys":{title:"Sort the properties of the entire object literal.",message:"",replaceMessage:"Unsorted keys in object literal."}}}};var ZUe=200,Wpe=300,Pu=class extends X{constructor(r,n,o){super(r);this.accessor=n;this.ignoreService=o}async render(r,n){let{diagnostics:o,documentContext:s}=this.props;return await this.ignoreService.isCopilotIgnored(s.document.uri)?vscpp("ignoredFiles",{value:[s.document.uri]}):o.length>0&&vscpp(vscppf,null,o.map((c,u)=>{let l=zpe(this.accessor,s.language.languageId,c);return vscpp(vscppf,null,vscpp(Dz,{diagnostic:c,cookbook:l,maxLength:ZUe,documentContext:s}),vscpp(gP,{diagnostic:c,cookbook:l,document:s.document}),vscpp(Nz,{cookbook:l}))}))}};Pu=w([b(1,st),b(2,ke)],Pu);var Dz=class extends X{render(e,r){let n=this.props.diagnostic,o=this.props.documentContext.document,s=n.range,a=o.getText(new Qe(s.start.line,0,s.end.line+1,0)).trimEnd(),c=a.length>0&&a.length<this.props.maxLength?a:"";return c?vscpp(vscppf,null,"This code",vscpp("br",null),vscpp(Fe,{code:c,uri:o.uri,shouldTrim:!1}),vscpp("br",null),vscpp(vscppf,null,"has the problem reported:",vscpp("br",null),n.message," ",vscpp("br",null))):vscpp(vscppf,null)}},gP=class extends X{constructor(r,n,o,s,a,c){super(r);this.workspaceService=n;this.parserService=o;this.ignoreService=s;this.logService=a;this.telemetryService=c}async render(r,n){let{infos:o,ignoredFiles:s,definitionRanges:a}=await this.getRelatedInfos();return!o.length&&!a.length?vscpp("ignoredFiles",{value:s}):vscpp(vscppf,null,"This diagnostic has some related code:",vscpp("br",null),o.map(c=>vscpp(Fe,{code:c.content,uri:c.uri,references:[new Kpe.PromptReference(new Ri(c.uri,c.range))]})),a.map(c=>vscpp(pv,{document:this.props.document,position:c.start})),vscpp("ignoredFiles",{value:s}))}async getRelatedInfos(){let r=[],n=[],o=[],s=this.props.diagnostic;if(s.relatedInformation)for(let c of s.relatedInformation)try{let u=c.location;if(await this.ignoreService.isCopilotIgnored(u.uri)){o.push(u.uri);continue}let l=await this.workspaceService.openTextDocument(u.uri),d=u.range,p=this.parserService.getTreeSitterAST(l),f;if(p){let m=K4(d),h=await p.getCoarseParentScope(m);f=l.getText(Y4(h))}(!f||f.length>Wpe)&&(f=l.getText(d)),f.length<=Wpe&&r.push({content:f,uri:u.uri,range:u.range})}catch{}let a=this.props.cookbook.additionalContext();for(let c of a)switch(c){case 0:{let u=this.parserService.getTreeSitterAST(this.props.document);if(u){let l=io(this.props.diagnostic.range,this.props.document),d=await Ka(this.logService,this.telemetryService,this.props.document,500,()=>u.getCallExpressions(l),[]);for(let p of d){let f=ms(this.props.document,p);n.push(f)}}break}case 1:{n.push(this.props.diagnostic.range);break}}return{infos:r,definitionRanges:n,ignoredFiles:o}}};gP=w([b(1,Ve),b(2,_t),b(3,ke),b(4,oe),b(5,he)],gP);var Nz=class extends X{render(e,r){let n=this.props.cookbook.fixes;if(n.length){let o=n[0];return vscpp(vscppf,null,"Suggested fix:",vscpp("br",null),o.title+o.message)}return null}};var d5=class extends X{render(e,r){let{useWorkspaceChunksFromSelection:n,useWorkspaceChunksFromDiagnostics:o}=this.props;if(!n&&!o)return null;let s=r.tokenBudget;return n&&o&&(s=s/2),vscpp(vscppf,null,n&&vscpp(im,{...this.getChunkSearchPropsForSelection(s)}),o&&vscpp(im,{...this.getChunkSearchPropsForDiagnostics(s)}))}getChunkSearchPropsForSelection(e){let{document:r,wholeRange:n}=this.props.documentContext,o=r.validateRange(n);this.props.diagnostics.forEach(c=>{o=o.union(c.range)});let s=r.getText(o),a=[`Please find code that is similar to the following code block:
`,"```",s,"```"].join(`
`);return{query:{rawQuery:a,resolveQueryAndKeywords:async()=>({rephrasedQuery:a,keywords:Ype(s)}),resolveQuery:async()=>a},include:{exclude:[r.uri.fsPath]},maxResults:3}}getChunkSearchPropsForDiagnostics(e){let r=this.props.documentContext.document,n=this.props.diagnostics.map(s=>s.message).join(" "),o=`Please find code that can help me fix the following problems: ${n}`;return{query:{rawQuery:o,resolveQueryAndKeywords:async()=>({rephrasedQuery:o,keywords:Ype(n)}),resolveQuery:async()=>o},include:{exclude:[r.uri.fsPath]},maxResults:3}}};function Ype(t){let e=new Set;for(let r of t.matchAll(/(-?\d*\.\d\w*)|([^\`\~\!\@\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\"\,\.\<\>\/\?\s]+)/g))e.add(r[0]);return Array.from(e.values(),r=>({keyword:r,variations:[]}))}var OI=class extends X{constructor(r,n,o,s){super(r);this.ignoreService=n;this.parserService=o;this.languageDiagnosticsService=s}async render(r,n){let{document:o,wholeRange:s,fileIndentInfo:a,selection:c,language:u}=this.props.documentContext;if(await this.ignoreService.isCopilotIgnored(o.uri))return vscpp("ignoredFiles",{value:[o.uri]});if(rr(o.uri))throw dn("InlineFix3PlusPrompt should not be used with a notebook!");let d=n.endpoint.modelMaxPromptTokens/3*4,p;if(o.getText().length>d){let R=await uy(this.parserService,o,a);p=QS(d,o,s,R,{tryPreserveTypeChecking:!0})}else p=new Lc(o.getText(),on.empty,o.languageId);let{query:f,history:m,chatVariables:h,customInstructions:g}=this.props.promptContext,{useWorkspaceChunksFromDiagnostics:v,useWorkspaceChunksFromSelection:y}=this.props.features,_=p.projectRange(c),x=o.getText(new Qe(c.start.line,0,c.end.line+1,0)).trimEnd(),S=[{uri:o.uri,version:o.version,ranges:[]}],I=dv(this.languageDiagnosticsService,o.uri,c,f),E=new Lz(p,o.uri,_);return vscpp(vscppf,null,vscpp("usedContext",{value:S}),vscpp("meta",{value:new Hn(E)}),vscpp(mm.SystemMessage,{priority:1e3},"You are an AI programming assistant.",vscpp("br",null),'When asked for your name, you must respond with "GitHub Copilot".',vscpp("br",null),"The user has a ",u.languageId," file opened in a code editor.",vscpp("br",null),"The user expects you to propose a fix for one or more problems in that file.",vscpp("br",null),"For the response always follow these instructions:",vscpp("br",null),"Describe in a single sentence how you would solve the problem. After that sentence, add an empty line. Then provide code changes or a terminal command to run.",vscpp("br",null),"When proposing to fix the problem by running a terminal command, write `",eBe,"` and provide a code block that starts with ```bash and contains the terminal script inside.",vscpp("br",null),vscpp(pm,null),vscpp(Rt,null)),vscpp(Ot,{priority:700,history:m}),vscpp(mm.UserMessage,{priority:100},"I have the following code open in the editor.",vscpp("br",null),vscpp(Sy,{fileName:"someFolder/myFile.cs",language:"csharp",code:["// This is my class","class C { }","","new C().Field = 9;"]})),vscpp(mm.AssistantMessage,{priority:100},"The problem is that the class 'C' does not have a field or property named 'Field'. To fix this, you need to add a 'Field' property to the 'C' class.",vscpp("br",null),vscpp("br",null),vscpp(uv,{changes:[{fileName:"someFolder/myFile.cs",find:["// This is my class","class C { }"],replace:["// This is my class","class C {","public int Field { get; set; }","}"]},{fileName:"someFolder/myFile.cs",find:["new C().Field = 9;"],replace:["// set the field to 9","new C().Field = 9;"]}]})),vscpp(mm.UserMessage,{priority:700},vscpp(Or,{customInstructions:g,languageId:u.languageId}),vscpp(sp,null,...RO(h)),vscpp(sp,null,p.text.length>0?vscpp(vscppf,null,"I have the following code open in the editor, starting from line 1 to line ",p.lineCount,".",vscpp("br",null),lv(o.fileName),vscpp("br",null),vscpp(Fe,{uri:o.uri,languageId:u.languageId,code:p.text,shouldTrim:!1}),vscpp("br",null)):vscpp(vscppf,null,"I am in an empty file:",lv(o.fileName),vscpp("br",null))),vscpp(sp,null,c.isEmpty?vscpp(vscppf,null,"I have the selection at line ",_.start.line+1,", column ",_.start.character+1,vscpp("br",null)):vscpp(vscppf,null,"I have currently selected from line ",_.start.line+1,", column ",_.start.character+1," to line ",_.end.line+1," column ",_.end.character+1,".",vscpp("br",null))),vscpp(sp,null,x.length&&!I.some(R=>R.range.contains(c))&&vscpp(vscppf,null,"The content of the lines at the selection is",vscpp(Fe,{uri:o.uri,languageId:u.languageId,code:x,shouldTrim:!1}),vscpp("br",null))),vscpp(Pu,{documentContext:this.props.documentContext,diagnostics:I}),vscpp(d5,{diagnostics:I,documentContext:this.props.documentContext,useWorkspaceChunksFromDiagnostics:v,useWorkspaceChunksFromSelection:y}),vscpp(mm.TextChunk,null,"Please find a fix for my code so that the result is without any errors."),vscpp(qs,{chatVariables:h,query:f}),vscpp("br",null)))}};OI=w([b(1,ke),b(2,_t),b(3,To)],OI);var eBe=Spe("TERMINAL"),Lz=class{constructor(e,r,n){this.projectedDocument=e;this.documentUri=r;this.adjustedSelection=n;this._lastText=void 0;this._lastLength=0;this._replyProcessor=bI()}async processResponse(e,r,n){for await(let a of e)if(this._lastText=a.text,this._firstSentence===void 0){let c=this._replyProcessor.getFirstSentence(a.text);r.markdown(c.substring(this._lastLength)),this._lastLength=c.length,c.length<a.text.length&&(this._firstSentence=c,r.markdown(`

`),r.progress("Generating edits..."))}if(!this._lastText)throw new Error("No text");let o=this._replyProcessor.process(this._lastText,this.projectedDocument.text,this.documentUri,this.adjustedSelection.start.line);if(o.otherSections.length)for(let a of o.otherSections)r.markdown(a.content.join(`

`));if(o.otherPatches.length)for(let a of o.otherPatches)r.markdown(a.replace.join(`

`));o.invalidPatches.length&&r.warning("The edit generation was not successful. Please try again.");let s=o.edits;if(s.length)if(s=this.projectedDocument.projectBackTextEdit(s),o.edits.length!==s.length)o.annotations.push({message:"Some edits were not applied because they were out of bounds.",label:"summarize conflict",severity:"error"});else{let a=tBe(o.edits,s,this.projectedDocument);a&&o.annotations.push(a)}return s.length?(r.textEdit(this.documentUri,s),{type:"inlineEdit",annotations:o.annotations}):{type:"conversational",annotations:o.annotations}}};function tBe(t,e,r){for(let n=0;n<t.length;n++){let o=r.positionOffsetTransformer.toOffsetRange(t[n].range).substring(r.text),s=r.originalPositionOffsetTransformer.toOffsetRange(e[n].range).substring(r.originalText);if(o!==s)return{message:`Problem projecting edits: '${o}' does not match '${s}' (projectecBack)`,label:"invalid projection",severity:"error"}}}var Oz=H(Gt()),bP=H(nt());function Qpe(t,e){let r=t;for(let n of e){let o=n.range.start,s=n.range.end,a=r.start,c=r.end,u=n.newText.split(`
`).length,l=u-(s.line-o.line)-1,d=a.line,p=a.line;s.isBefore(a)?(d=a.line+l,p=c.line+l):o.isBefore(a)&&s.isAfterOrEqual(a)&&s.isBeforeOrEqual(c)?(d=o.line,p=c.line+l):o.isAfterOrEqual(a)&&o.isBeforeOrEqual(c)&&s.isAfter(c)?(d=a.line,p=s.line+l):o.isAfter(c)?(d=a.line,p=c.line):r.contains(n.range)?(d=a.line,p=c.line+l):n.range.contains(r)&&(d=o.line,p=o.line+u-1),r=new Qe(d,0,p,0)}return r}function Xpe(t,e,r){let n=rBe(t,e);if(!n)return null;let{code:o,contentBeforeCode:s,language:a}=n;if(hu.testLine(r,o)){let c=o.indexOf(`
`);o=o.substring(c).trim()}return{code:o,contentBeforeCode:s,language:a}}function rBe(t,e){e=e.trim();let n=Fs(e).at(0);if(n){let u=Gb(e);return{code:n.code,contentBeforeCode:u.slice(0,n.startLine).join(`
`).trimEnd(),language:n.language}}let o=e.split(/\r\n|\r|\n/g),s=!1,a=[],c=[];for(let u of o){let l=rO(t,u);if(s){if(l)return c.push(u),{code:c.join(`
`),contentBeforeCode:a.join(`
`),language:""};c.push(u)}else l?(s=!0,c.push(u)):a.push(u)}return null}var nBe=15,MI=class extends X{constructor(r,n,o,s,a,c,u){super(r);this._ignoreService=n;this._instantiationService=o;this._languageDiagnosticsService=s;this._parserService=a;this._tabsAndEditorsService=c;this._workspaceService=u}async render(r,n){let o=this.props.documentContext;if(await this._ignoreService.isCopilotIgnored(o.document.uri))return vscpp("ignoredFiles",{value:[o.document.uri]});if(!rr(o.document.uri))throw dn("InlineFix4Prompt should not be used with a non-notebook!");let{query:a,history:c,chatVariables:u,customInstructions:l}=this.props.promptContext,d=dv(this._languageDiagnosticsService,o.document.uri,o.selection,a),p=d.length>0?Lde(d):o.selection,f=this._parserService.getTreeSitterAST(o.document),m=f?await Vpe(f,p,nBe):p,h=Hpe(n.endpoint,o,p,m),g=p3(this._tabsAndEditorsService,this._workspaceService,o,h.contextInfo,h.tracker),v=o.document,y=[{uri:v.uri,version:v.version,ranges:Nr([g.range.toRange(),g.above.toRange(),g.below.toRange()])}],_=this._instantiationService.createInstance(vP,p,g,o);return vscpp(vscppf,null,vscpp("usedContext",{value:y}),vscpp("meta",{value:new Hn(_)}),vscpp("meta",{value:new KS(()=>_.generateFollowUps())}),vscpp(bP.SystemMessage,null,vscpp(H1,{language:o.language}),vscpp("br",null),"When dealing with Jupyter Notebook, if a module is already imported in a cell, it can be used in other cells directly without importing it again. For the same reason, if a variable is defined in a cell, it can be used in other cells as well",vscpp("br",null),"When dealing with Jupyter Notebook, cells below the current cell can be executed before the current cell, you must use the variables defined in the cells below, unless you want to overwrite them.",vscpp("br",null),"When dealing with Jupyter Notebook, do not generate CELL INDEX in the code blocks in your answer, it is only used to help you understand the context.",vscpp("br",null),"If you suggest to run a terminal command, use a code block that starts with ```bash.",vscpp("br",null),'When fixing "ModuleNotFoundError" or "Import could not be resolved" errors, always use magic command "%pip install" to add the missing packages. The imports MUST be inserted at the top of the code block and it should not replace existing code.',vscpp("br",null),"You should not import the same module twice.",vscpp("br",null),vscpp(Rt,null)),vscpp(Ot,{priority:700,history:c}),vscpp(bP.UserMessage,{priority:725},vscpp(Or,{customInstructions:l,languageId:o.language.languageId})),vscpp(pr,{priority:750,endpoint:n.endpoint,promptContext:this.props.promptContext,flexGrow:1}),vscpp(Bs,{priority:750,chatVariables:u}),vscpp(f3,{documentContext:o,above:g.above,range:g.range,below:g.below,aboveCells:g.aboveCells,belowCells:g.belowCells,includeDelimeters:!0}),vscpp(bP.UserMessage,null,vscpp(Pu,{documentContext:o,diagnostics:d}),"Describe in a single sentence how you would solve the problem. After that sentence, add an empty line. Then add a code block with the fix.",vscpp(qs,{chatVariables:u,query:a}),vscpp("br",null)))}};MI=w([b(1,ke),b(2,K),b(3,To),b(4,_t),b(5,zt),b(6,Ve)],MI);var vP=class{constructor(e,r,n,o,s){this.wholeRange=e;this.contextInfo=r;this.documentContext=n;this._logService=o;this._languageDiagnosticsService=s;this._lastText=void 0;this._lastLength=0}async processResponse(e,r,n){for await(let s of e){if(this._lastText=s.text,this._firstSentence===void 0){let a=ule(s.text);a.length<s.text.length&&(this._firstSentence=a),r.markdown(a.substring(this._lastLength)),this._lastLength=a.length}if(MV(s.text))break}if(!this._lastText)throw new Error("No text");let o=Xpe(this.contextInfo,this._lastText,this.documentContext.language);return!o||o.language==="bash"||o.language==="ps1"?(r.markdown(this._lastText.substring(this._lastLength)),{type:"conversational"}):(this._edits=this.generateEdits(o.code),this._versionBeforeUpdate=this.documentContext.document.version,r.textEdit(this.documentContext.document.uri,this._edits),{type:"inlineEdit"})}generateEdits(e){let r=e.split(`
`),n=[],o=[];for(let c of r)c.match(/^[%\!]pip/)?n.push(c):o.push(c);if(!n.length)return qV(this._logService,this.contextInfo,e,2,this.documentContext.fileIndentInfo,Ik.fromDocumentContext(this.documentContext));let s=[],a=Eg(n,{whichLine:"topMost",lines:this.contextInfo.range.lines},this.documentContext.fileIndentInfo).join(`
`)+`
`;return s.push(new ci(new Qe(this.wholeRange.start,this.wholeRange.start),a)),o.length&&s.push(...qV(this._logService,this.contextInfo,o.join(`
`),2,this.documentContext.fileIndentInfo,Ik.fromDocumentContext(this.documentContext))),s}async generateFollowUps(){return typeof this._edits>"u"||typeof this._versionBeforeUpdate>"u"?[]:this._generateFollowUps(this._edits,this.wholeRange,this._versionBeforeUpdate,Lr.None)}async _generateFollowUps(e,r,n,o){let s=await this._languageDiagnosticsService.waitForNewDiagnostics(this.documentContext.document.uri,o);if(!o.isCancellationRequested&&s.length&&this.documentContext.document.version!==n){let a=Qpe(r,e),c=s.filter(u=>Ode(u)&&u.range.intersection(a));if(c.length)return c.length===1?[{label:Oz.t("An error remains after applying the change, click here to iterate."),prompt:`/fix ${c[0].message}`}]:[{label:Oz.t("{0} errors remain after applying the change, click here to iterate.",c.length),prompt:"/fix Fix the remaining errors"}]}return[]}};vP=w([b(3,oe),b(4,To)],vP);var yP=H(nt());var FI=class extends X{constructor(r,n){super(r);this.languageDiagnosticsService=n}render(r,n){let o=this.props.documentContext,{query:s,history:a,chatVariables:c,customInstructions:u}=this.props.promptContext,l=({document:d,selection:p})=>dv(this.languageDiagnosticsService,d.uri,p,s);return vscpp(vscppf,null,vscpp(yP.SystemMessage,{priority:1e3},"You are an AI programming assistant.",vscpp("br",null),'When asked for your name, you must respond with "GitHub Copilot".',vscpp("br",null),"Follow the user's requirements carefully & to the letter.",vscpp("br",null),vscpp(Gs,null),vscpp("br",null),vscpp("br",null),vscpp(bu,{location:2,endpoint:this.props.endpoint}),vscpp("br",null),"First think step-by-step - describe your plan for what to build in pseudocode, written out in great detail.",vscpp("br",null),"Then output the code in a single code block.",vscpp("br",null),"Minimize any other prose.",vscpp("br",null),"Use Markdown formatting in your answers.",vscpp("br",null),"Make sure to include the programming language name at the start of the Markdown code blocks.",vscpp("br",null),"Avoid wrapping the whole response in triple backticks.",vscpp("br",null),"The user works in an IDE called Visual Studio Code which has a concept for editors with open files, integrated unit test support, an output pane that shows the output of running the code as well as an integrated terminal.",vscpp("br",null),"The active document is the source code the user is looking at right now.",vscpp("br",null),"You can only give one reply for each conversation turn.",vscpp("br",null),vscpp("br",null),"Additional Rules",vscpp("br",null),"You specialize in being a highly skilled code generator. Your task is to help the Developer fix an issue.",vscpp("br",null),"If context is provided, try to match the style of the provided code as best as possible.",vscpp("br",null),"Generated code is readable and properly indented.",vscpp("br",null),"Markdown blocks are used to denote code.",vscpp("br",null),"Preserve user's code comment blocks, do not exclude them when refactoring code.",vscpp("br",null),"Pay especially close attention to the selection or exception context.",vscpp("br",null),"Given a description of what to do you can refactor, fix or enhance the existing code.",vscpp(Xt,null)),vscpp(Ot,{flexGrow:1,priority:700,history:a}),vscpp(yP.UserMessage,{flexGrow:1,priority:750},vscpp(Or,{customInstructions:u,languageId:o?.language.languageId})),vscpp(zr,{flexGrow:1,priority:800,document:o?.document,range:o?.selection}),o&&vscpp(yP.UserMessage,{flexGrow:1,priority:800},vscpp(Pu,{documentContext:o,diagnostics:l(o)})),vscpp(pr,{priority:899,...this.props,flexGrow:2}),vscpp(Jr,{flexGrow:2,priority:900,chatVariables:c,query:s}))}};FI=w([b(1,To)],FI);var mv=H(Gt());var v5=H(Gt());var sfe=H(nt());var f5=H(nt());var p5=class extends X{render(){let{chunk:e,failure:r,priority:n}=this.props,o=r.task.messages.filter(a=>a.location?.uri.toString()===e.uri.toString()&&e.range.containsPosition({column:a.location.range.start.character+1,lineNumber:a.location.range.start.line+1})),s=new Ri(e.uri,new Qe(e.range.startLineNumber-1,0,e.range.endLineNumber,0));return vscpp(f5.UserMessage,{priority:n},o.length?vscpp(vscppf,null,'This is the source code of the test that failed. The error message is shown after the text "FAILURE_MESSAGE" on the line where it occurred:'):vscpp(vscppf,null,"The test failed with the message: ",r.task.messages.map(a=>typeof a.message=="object"?a.message.value:a.message).join(`
`),". The source code of the test is:"),vscpp("br",null),vscpp(Fe,{references:[new f5.PromptReference(s)],languageId:e.uri.fsPath.replaceAll("\\","/"),uri:e.uri,code:e.source.split(`
`).map((a,c)=>{let u=o.find(l=>l.location?.range.start.line===c+e.range.startLineNumber-1);return u?`${a} FAILURE_MESSAGE: ${u.message.toString().replaceAll(`
`," ")}`:a}).join(`
`)}),vscpp("br",null))}};var UI=H(nt());function Jpe(t,e,r){let n=0,o=t.length;for(;n<o;){let s=n+o>>>1;r(t[s],e)?n=s+1:o=s}return n}function _P(t,e){if(t.length===0)return;let r=t[0];for(let n=1;n<t.length;n++){let o=t[n];e(o,r)>0&&(r=o)}return r}var iBe=/^[\*\-]\s*[`"']?([^<([`"'\s]+).*? +in +(.+)/gm,Zpe=(t,e)=>[...t.matchAll(iBe)].flatMap(([,r,n])=>r.split(",").map(o=>({keyword:o,fileUri:n,interest:"IMPLEMENTATION"}))).map(({keyword:r,fileUri:n,interest:o})=>{let s=m5(e,r,n)||m5(e,r);if(!s){let l=/^.+?(\b[^\b]+)/.exec(r);l&&(s=m5(e,l[1],n)||m5(e,l[1]))}if(!s)return;let{index:a,chunk:c}=s,u=c.convert.positionToOffset(c.range.getStartPosition());return{keyword:r,interest:o,location:{uri:c.uri,position:c.convert.offsetToPosition(u+a)}}}).filter(rS);function m5(t,e,r){let n=r?t.filter(s=>s.uri.toString().toLowerCase()===r.toLowerCase()):t,o=new RegExp(`^(?!~:).*\\b(${Vb(e)})\\b`,"m");for(let s=n.length-1;s>=0;s--){let a=n[s],c=o.exec(a.source);if(c)return{chunk:a,index:c.index+c[0].length-c[1].length}}}var efe=async(t,e,r,n)=>{let o=await r.readFile(t.uri),s=new TextDecoder().decode(o);return oBe(t,e,s,n)},oBe=async(t,e,r,n)=>{let o=new Wa(r),s=new Xe(t.range.start.line+1,1,t.range.end.line+1,1);return s.endLineNumber-s.startLineNumber<=1&&(s=await sBe(t,e,r,o,n)||s.setEndPosition(s.startLineNumber+50,1)),{range:s,source:r.slice(o.positionToOffset(s.getStartPosition()),o.positionToOffset(s.getEndPosition())),uri:t.uri,convert:o}},sBe=async(t,e,r,n,o)=>{let s=Ol(ha(t.uri).languageId);if(!s)return;let c=await o.getTreeSitterASTForWASMLanguage(s,r).getFunctionDefinitions(),u=c.find(f=>f.identifier===e);if(u)return Mz(n,u);let l=n.positionToOffset(new tr(t.range.start.line+1,1));c.sort((f,m)=>f.startIndex-m.startIndex);let d,p;for(let f of c){if(f.startIndex>l){p=f;break}f.startIndex<=l&&f.endIndex>=l&&(d=f)}return p&&(!d||p.startIndex>=d.startIndex&&p.endIndex<=d.endIndex)?Mz(n,p):d&&Mz(n,d)},Mz=(t,e)=>{let r=t.offsetToPosition(e.startIndex),n=t.offsetToPosition(e.endIndex);return new Xe(r.lineNumber-1,1,n.lineNumber+1,1)},tfe=async(t,e,r,n)=>{let o=Ol(ha(n).languageId);if(!o)return a=>"";let s=await t.getSemanticChunkTree(o,e);return a=>{let c=r.positionToOffset(a.getStartPosition()),u=r.positionToOffset(a.getEndPosition()),l=cBe(s.roots,m=>m.info.mainBlock.startIndex<=c&&m.info.mainBlock.endIndex>=c),d="",p=(m,h)=>c<=m&&h<=u?!1:(d&&!d.endsWith(`
`)&&(d+=`
`),d+=e.slice(m,h),!0),f=m=>{if(m.info.detailBlocks.comments instanceof Array)for(let y of m.info.detailBlocks.comments)p(y.startIndex,y.endIndex);let h=/\s*\{\s/.exec(e.slice(m.info.detailBlocks.body.startIndex,m.info.detailBlocks.body.endIndex))?.[0].length||0,g=r.startOffsetOfLineContaining(m.info.mainBlock.startIndex),v=m.info.detailBlocks.body.startIndex+h;p(g,v)&&(d+=" ... "),m.children.forEach(f)};return l.forEach(f),d}},aBe=/@@ -\d+,\d+ \+(\d+),(\d+) @@/g,rfe=async(t,{source:e,convert:r},n,o)=>{let s=[];for(let a of o.matchAll(aBe)){let[,c,u]=a.map(Number);s.push({uri:n,range:new Xe(c,1,c+u,1),convert:r,source:e,interest:"CHANGED",tokensWithoutExpansion:t.tokenLength(e.slice(r.positionToOffset(new tr(c,1)),r.positionToOffset(new tr(c+u,1))))})}return s},cBe=(t,e)=>{let r=n=>{let o=n.children.map(r).filter(rS);return o.length||e(n)?{children:o,info:n.info}:void 0};return t.map(r).filter(rS)},nfe=(t,e)=>{let r=new Wa(t),n=e.map(l=>{let d=r.positionToOffset(new tr(l.range.start.line+1,l.range.start.character+1)),p=r.positionToOffset(new tr(l.range.end.line+1,l.range.end.character+1));return{start:d,end:p,text:l.newText}});n.sort((l,d)=>l.start-d.start||l.end-d.end);let o=0,s=0;function a(l){let d=l.indexOf(`
`);if(d===-1){s+=l.length;return}for(;d!==-1;)o++,s=l.length-d-1,d=l.indexOf(`
`,d+1)}let c=0,u=[];for(let{start:l,end:d,text:p}of n){a(t.slice(c,l));let f=new rn(o,s);a(p);let m=new rn(o,s);c=d;let h=t.slice(l,d);u.push(ci.replace(new Qe(f,m),h))}return u};function uBe(t,e,r){let n=_P(t,(l,d)=>l.range.startLineNumber-d.range.startLineNumber).range.getStartPosition(),o=_P(t,(l,d)=>d.range.endLineNumber-l.range.endLineNumber).range.getEndPosition(),s=e?new tr(Math.max(1,n.lineNumber-Math.ceil(e*2/3)),1):n,a=e-(n.lineNumber-s.lineNumber),c=a>0?new tr(o.lineNumber+a,1):o,u=r(new Xe(s.lineNumber,1,c.lineNumber,1));return{start:s,end:c,context:u?u+`
`:"",snippet:t[0].source.slice(t[0].convert.positionToOffset(s),t[0].convert.positionToOffset(c)),original:t}}function lBe(t){return ife(t)+"```"+t.original[0].uri.toString()+`
`+t.context+t.snippet+"\n```\n"}function dBe({start:t,end:e,snippet:r,original:n}){return{uri:n[0].uri,source:r,convert:n[0].convert,range:new Xe(t.lineNumber,1,e.lineNumber,1)}}function ife(t){let e=t.original.flatMap(r=>r.keywords||[]);return e.length?`Definition of \`${e.join("` and `")}\`:
`:`Here's code I've been working on that might be related to the failure:
`}function pBe(t){return t.start.lineNumber>1||t.end.lineNumber<t.original[0].convert.lines}var h5=class extends X{async prepare(e){let{chunks:r,parser:n,tokenizer:o}=this.props,s=0,a,c=new tn;for(let u of r)c.has(u.uri)||c.set(u.uri,await tfe(n,u.source,u.convert,u.uri));for(;;){let u=(a?a.chunks.map(p=>p.original):r.map(p=>[p])).map(p=>uBe(p,s,c.get(p[0].uri))),l=u.map(lBe).join(""),d=o.tokenLength(l);if(a&&(d*1.1>e.tokenBudget||!u.some(pBe)))return Promise.resolve({chunks:u});for(let p=0;p<u.length;p++){let f=u[p],m=f.original[0].uri.toString(),h={startLineNumber:f.start.lineNumber,startColumn:1,endLineNumber:f.end.lineNumber,endColumn:1};for(let g=p+1;g<u.length;g++){let v=u[g];if(v.original[0].uri.toString()!==m)continue;let y={startLineNumber:v.start.lineNumber,startColumn:1,endLineNumber:v.end.lineNumber,endColumn:1};Xe.areIntersectingOrTouching(h,y)&&(f.original.push(...v.original),u.splice(g,1),g--)}}s++,a={tokens:d,chunks:u}}}render({chunks:e}){return vscpp(vscppf,null,vscpp("meta",{value:new xP(e.map(dBe))}),e.map((r,n)=>vscpp(UI.UserMessage,{priority:100-(e.length-n)},ife(r),vscpp(Fe,{languageId:r.original[0].uri.fsPath.replaceAll("\\","/"),uri:r.original[0].uri,code:r.context+r.snippet,references:[new UI.PromptReference(new Ri(r.original[0].uri,new Qe(r.start.lineNumber-1,0,r.end.lineNumber-1,0)))]}),vscpp("br",null))))}},xP=class extends UI.PromptMetadata{constructor(r){super();this.chunks=r}};var g5=class extends X{render(){let{chunk:e,testFailure:r,references:n,turnsLeft:o,parser:s,tokenizer:a}=this.props,c=n.length>0;return vscpp(vscppf,null,vscpp(sfe.SystemMessage,{priority:1e3},"You are an assistant who specializes in diagnosing and fixing failing tests. The user will provide you with the source code of the test that failed, and the location where the failure happened. They will also provide you with relevant related code. This information may be incomplete.",vscpp("br",null),vscpp("br",null),"# Additional Rules",vscpp("br",null),vscpp("br",null),`- Read the test's source code and the line containing "FAILURE_MESSAGE". The text after "FAILURE_MESSAGE" is the error returned from running tests.`,vscpp("br",null),"- Assume that the test code and test fixtures are correct. It's more likely the problem is code called by the test.",vscpp("br",null),c&&vscpp(vscppf,null,"- The provided code is incomplete. DO NOT assume that something isn't implemented if it doesn't appear here.",vscpp("br",null)),o===0?vscpp(vscppf,null,"- If you believe you have found a bug in one of the code snippets the user provided, propose a code change.",vscpp("br",null),vscpp(pm,null)):vscpp(vscppf,null,c?vscpp(vscppf,null,"- If you have found a bug the code provided, propose a code change. Do this only if you have found the underlying bug!",vscpp("br",null),vscpp(pm,null),"- Otherwise, if you haven't found the bug, print a list of up to five keywords, classes, or function calls from one of the files that you need more information about to diagnose the failure. Make sure the most relevant keywords are written first. ",o===0&&"You won't get another chance to ask for more info.",vscpp("br",null),ofe):vscpp(vscppf,null,"- Don't try to fix the failure yet. Instead, print a list of keywords, classes, or function calls that you need more information about to diagnose the failure!",vscpp("br",null),ofe,vscpp("br",null)),"- NEVER ask the user for additional information or clarification, or give them suggestions to review code themselves. Instead, print keywords that should be investigated.",vscpp("br",null)),vscpp("br",null),o>0&&vscpp(vscppf,null,"# Example",vscpp("br",null),fBe,vscpp("br",null),vscpp("br",null)),c&&vscpp(vscppf,null,"# Example",vscpp("br",null),mBe,vscpp("br",null))),vscpp(p5,{chunk:e,failure:r,priority:800}),vscpp(h5,{flexGrow:1,priority:700,chunks:n,parser:s,tokenizer:a}))}},fBe=vscpp(vscppf,null,"User:",vscpp("br",null),`\`\`\`/project/my.test.ts
test('reverseString test', () => {'{'}
	const value = 'hello';
	const value2 = doReverseString(value);
	assert.deepStrictEquals(value2, 'olleh'); FAILURE_MESSAGE: Expected undefinedolleh to equal olleh
{'}'});
\`\`\`

Implementation of \`doReverseString\` in /project/my.test.ts:

\`\`\`/project/strings.ts
function doReverseString(str: string): number {
	return stringUtils.reverseString(str);
}
\`\`\`
`,vscpp("br",null),"Response:",vscpp("br",null),vscpp("br",null),"I need more information about:",vscpp("br",null),"- stringUtils.reverseString",vscpp("br",null)),mBe=vscpp(vscppf,null,"User:",vscpp("br",null),`\`\`\`/project/my.test.ts
test('reverseString test', () => {'{'}
	const value = 'hello';
	const value2 = doReverseString(value);
	assert.deepStrictEquals(value2, 'olleh'); FAILURE_MESSAGE: Expected undefinedolleh to equal olleh
{'}'});
\`\`\`

Implementation of \`doReverseString\`:

\`\`\`/project/my.test.ts
function doReverseString(str: string): number {
	return stringUtils.reverseString(str);
}

Implementation of \`stringUtils.reverseString\`:

\`\`\`/project/strings.ts
function reverseString(str) {
	let out = '';
	for (let i = str.length; i >= 0; i--) {
		out += str[i];
	}
	return out;
}
\`\`\`
`,vscpp("br",null),"Response:",vscpp("br",null),"The problem is that the loop ieration starts after the last element. To fix this, modify the loop to start at `str.length - 1` instead of `str.length`.",vscpp("br",null),vscpp(uv,{changes:[{fileName:"/project/stringUtils.ts",find:["	for (let i = str.length; i >= 0; i--) {"],replace:["	for (let i = str.length - 1; i >= 0; i--) {"]}]})),ofe=vscpp(vscppf,null,'- Write your response in a list in the form "- [keyword] in [file where keyword is used]". Do not include any extra text. Keywords should be EXACT substrings from the code the user provides, do not modify them.',vscpp("br",null));var hBe=1e3;async function gBe(t,e,r){let n=Cpe(t);if(!n.length)return;let o=Ye.file(n[0]),s="";try{s=(await r(o)).source}catch{}let a=e.find(l=>l.uri.toString()===o.toString())?.range.startLineNumber,u=bI().process(t,s,void 0,a);return{text:t,uri:o,code:(u.appliedPatches[0]||u.invalidPatches[0]||u.otherPatches[0])?.replace.join(`
`),before:u.contentBefore.join(`
`),after:u.contentAfter.join(`
`),edits:{apply:u.edits,undo:nfe(s,u.edits)}}}var vBe=new Set(["rust"]),Fz=class{constructor(e,r){this.testLocation=r;this.fileCache=new tn;this.globallySeen=new Set;this._promise=new Of;this.turnsUsed=0;this.tokensUsed=0;this.endpoint=e.endpoint,this.progress=e.progress,this.token=e.token,this.accessor=e.accessor,this.turnsBudget=e.turnsBudget,this.timeBudget=e.timeBudget,this.tokenBudget=e.tokenBudget,this.deadline=Date.now()+this.timeBudget,this.logService=e.accessor.get(oe),this.gitRepo=e.accessor.safeGet(_o)?.getExtensionApi()?.getRepository(this.testLocation.uri)||void 0}get promise(){return this._promise.p}get hasFoundSolution(){return this._promise.isResolved}get possibleExplanation(){return this._possibleExplanation}foundSolution(e){this._promise.complete(e)}gotPossibleExplanation(e,r){(!this._possibleExplanation||e.length>this._possibleExplanation.text.length)&&(this._possibleExplanation={text:e,references:r})}takeTurn(){return this.turnsUsed++,Date.now()+hBe>=this.deadline?0:Math.max(0,this.turnsBudget-this.turnsUsed)}throwIfCancelled(){if(this.token.isCancellationRequested||this.hasFoundSolution)throw new Hi}async getSymbols(e){let r=this.accessor.get(ke),n=this.accessor.get(yr).acquireTokenizer(this.endpoint),o=new Map,s=await this.getDefinitionLocations(e);this.throwIfCancelled();let a=new Set(s.flatMap(({links:u})=>u.map(l=>l.link.uri.fsPath))),c=new Set;if(this.gitRepo)try{c=await this.gitRepo.checkIgnore([...a])}catch{}for(let{keyword:u,links:l}of s)for(let{interest:d,link:p}of l){if(c.has(p.uri.fsPath)||await r.isCopilotIgnored(p.uri)||p.uri.toString()===this.testLocation.uri.toString()&&!vBe.has(ha(p.uri).languageId))continue;p.range.isEmpty&&(p.range=new Qe(p.range.start,p.range.end.with(p.range.start.line+5)));let f=new tr(p.range.start.line+1,1),m=p.range.isEmpty?new tr(f.lineNumber+10,1):new tr(p.range.end.line+1,p.range.end.character+1),h=[d,p.uri.toString(),p.range.start.line].join("\0");if(this.globallySeen.has(h))continue;let g=o.get(h);if(g){g.keywords.push(u);continue}try{let v=await this.readFile(p.uri);o.set(h,{keywords:[u],interest:d,uri:p.uri,range:Xe.fromPositions(f,m),tokensWithoutExpansion:n.tokenLength(v.source.slice(v.convert.positionToOffset(f),v.convert.positionToOffset(m))),...v}),this.progress.report(new r4(p))}catch{}}for(let u of o.keys())this.globallySeen.add(u);return[...o.values()]}async readFile(e){let r=this.fileCache.get(e);return r||(r=this.accessor.get(hr).readFile(e).then(n=>new TextDecoder().decode(n)).then(n=>({source:n,convert:new Wa(n)})),this.fileCache.set(e,r)),r}async getDefinitionLocations(e){let r=this.accessor.get(Co);return Promise.all(e.map(async({keyword:n,interest:o,location:s})=>{let a=new rn(s.position.lineNumber-1,s.position.column-1+(n.length-1)),c=s.uri,u=()=>r.getDefinitions(c,a).then(f=>f.length?f:r.getImplementations(c,a)).then(f=>f.length?{interest:"DEFINITION",link:f[0]}:void 0),l=()=>r.getImplementations(c,a).then(f=>f.length?f:r.getDefinitions(c,a)).then(f=>f.length?{interest:"IMPLEMENTATION",link:f[0]}:void 0),d=[];(o==="DEFINITION"||o==="BOTH")&&d.push(u()),(o==="IMPLEMENTATION"||o==="BOTH")&&d.push(l());let p=(await Promise.all(d)).filter(rS);return{keyword:n,links:p.map(f=>"targetUri"in f.link?{interest:f.interest,link:new Ri(f.link.targetUri,f.link.targetRange)}:f)}}))}};var b5=class t{constructor(e,r,n){this.context=e;this.testFailure=r;this.testLocation=n}static create(e,r,n){let o=$N(r.task.messages,s=>s.location);return(!o||n.uri.toString()!==o.uri.toString())&&(o=n),new t(new Fz(e,n),r,n)}async tryGetInitialGitContext(){let e=this.context.accessor.get(yr).acquireTokenizer(this.context.endpoint),r=this.context.gitRepo;if(!r)return[];let n=[],o=await r.diffWithHEAD();return await Promise.all(o.map(async s=>{if(s.status===2||s.status===6)return;let[a,c]=await Promise.all([r.diffWithHEAD(s.uri.fsPath),this.context.readFile(s.uri)]);n.push(...await rfe(e,c,s.uri,a))})),n}async climb(){let e=await efe(this.testLocation,this.testFailure.snapshot.label,this.context.accessor.get(hr),this.context.accessor.get(_t));if(!e)throw new Error("Could not find semantic information for the test location");let r=[];try{r=await this.tryGetInitialGitContext()}catch(s){this.context.logService.public.error(s,"Could not get git context for test failure")}let n=await Promise.race([this.context.promise,this.climbInner(this.context,e,{symbols:[],activity:r,name:`"${this.testFailure.snapshot.label}"`,prefixTokens:0,tokens:0}).then(()=>({type:2,possibleSolution:this.context.possibleExplanation}),s=>{if(Af(s))return{type:1,possibleSolution:this.context.possibleExplanation};throw s})]);return this.context.accessor.get(he).sendMSFTTelemetryEvent("intent.fixTestFailure.outcome",{outcome:n.type===0?"solution":n.type===1?"cancelled":"nosolution",languageId:ha(this.testLocation.uri).languageId},{requestsMade:this.context.turnsUsed,tokenCount:this.context.tokensUsed}),n}async climbInner(e,r,n,o=!1){let{endpoint:s,progress:a,token:c,accessor:u}=this.context,l=u.get(he),d=u.get(Ct),p=n.name,f=e.takeTurn();o&&(f=0);let m=u.get(yr).acquireTokenizer(s),h=Be.create(u.get(K),s,g5,{testFailure:this.testFailure,chunk:r,tokenizer:m,parser:u.get(_t),references:[...n.activity,...n.symbols],turnsLeft:o?0:f}),g=await h.render();n.prefixTokens=g.tokenCount,n.tokens=n.prefixTokens+g.tokenCount,e.tokensUsed+=n.tokens,e.throwIfCancelled(),a.report(new ui(v5.t("Investigating the code around {0}",p)));let v=await d.fetchOne("failingTestMonkey",g.messages,async S=>{},c,2,s,void 0,{temperature:.1,top_p:1,stop:["dontStopBelieving"]},{messageSource:"failingTestMeta"});if(e.throwIfCancelled(),v.type!=="success")throw l.sendMSFTTelemetryEvent("failingTestResolver.error",{type:v.type,reason:v.reason,requestId:v.requestId}),new Error(v5.t("Encountered an error while deciding what test information to collect: ({0}) {1}",v.type,v.reason));let y=[r,...h.getMeta(xP).chunks],_=await gBe(v.value,y,S=>this.context.readFile(S));if(_){e.foundSolution({type:0,references:g.references,solution:_});return}let x=Zpe(v.value,y);if(f>0){let S=await e.getSymbols(x);await this.chunkAndSendFollowups(e,r,S,n)}x.length||e.gotPossibleExplanation(v.value,g.references)}async chunkAndSendFollowups(e,r,n,o){let s=[],a=e.accessor.get(yr).acquireTokenizer(e.endpoint);for(let c of n){let u=s[s.length-1],l=c.tokensWithoutExpansion+a.tokenLength("```${tokenizer.tokenLength(symbol.chunk.file.toString())}");!u||l+u.tokens>e.tokenBudget?s.push({activity:o.activity,symbols:[...o.symbols,c],tokens:o.tokens+l,name:o.name,prefixTokens:o.prefixTokens}):(u.symbols.push(c),u.tokens+=l)}for(let c of s){let u=c.symbols.slice(o.symbols.length).flatMap(l=>l.keywords||[]);c.name=u.length>1?v5.t('"{0}" + {1} more symbols...',u[0],u.length-1):`"${u[0]}"`,await this.climbInner(e,r,c)}if(s.length===0)return this.climbInner(e,r,o,!0)}};var fv=class{constructor(e,r,n){this.instantiationService=e;this.testProvider=r;this.endpointProvider=n;this.id="fixTestFailure";this.locations=[1,2];this.description=mv.t("Propose a fix for the a test failure");this.commandInfo={defaultEnablement:!0,allowsEmptyArgs:!0}}static{this.ID="fixTestFailure"}get intentDetectionInput(){let e="fix_test_failure";return{disabled:!0,functionName:e,sampleQuestion:"This test failed, suggest how to fix it.",functionCallingBlurb:`If the user's message is related to generating code to fix test failures, you should use the '${e}' function.`}}async asSlashCommand(){if(this.testProvider.isEnabled.get()&&Os.first(this.testProvider.getAllFailures()))return{name:this.id,description:this.description}}async invoke(e){let r;(h=>(h[h.Any=0]="Any",h[h.SameDocument=1]="SameDocument",h[h.InViewRange=2]="InViewRange",h[h.InSelection=3]="InSelection"))(r||={});let n,o=0,s=e.documentContext?.document.uri.toString();for(let d of this.testProvider.getAllFailures())if(!n||!n.snapshot.uri||!n.snapshot.range)n=d;else if(d.snapshot.range&&d.snapshot.uri?.toString()===s&&(o<1&&(n=d,o=1),d.snapshot.range.intersection(e.documentContext.wholeRange)&&(n=d,o=2),d.snapshot.range.intersection(e.documentContext.selection))){n=d,o=3;break}if(!n)throw new wk(mv.t("No test failures found."));let{range:a,uri:c}=n.snapshot;if(!c||!a)throw new wk(mv.t("Tests have no associated editor location."));let u=e.location,l=await this.endpointProvider.getChatEndpoint("gpt-4");return this.instantiationService.createInstance(SP,this,l,u,n,{uri:c,range:a})}};fv=w([b(0,K),b(1,Iu),b(2,Se)],fv);var SP=class{constructor(e,r,n,o,s,a){this.intent=e;this.endpoint=r;this.location=n;this.testFailure=o;this.testLocation=s;this.instantiationService=a}async buildPrompt({history:e,query:r,chatVariables:n},o,s){let a=Be.create(this.instantiationService,this.endpoint,IP,{testFailure:this.testFailure,chatVariables:n,query:r,endpoint:this.endpoint,progress:o,chatLocation:this.location,location:this.testLocation,history:e}),c=await a.render(o,s),u=a.getMeta(y5)?.value;u&&(this.lastSolutionForInterpreter={outcome:u,test:this.testFailure.snapshot});let l=a.getMeta(_5)?.value;return{...c,references:l||c.references}}processResponseInline(e,r,n){let{outcome:o,test:s}=this.lastSolutionForInterpreter;return new Uz(s,o).processResponse(e,r,n)}};SP=w([b(5,K)],SP);var IP=class extends X{constructor(r,n){super(r);this.accessor=n}async prepare(r,n,o=Lr.None){let{progress:s}=this.props,c=await b5.create({accessor:this.accessor,endpoint:this.props.endpoint,progress:s,token:o,tokenBudget:r.tokenBudget,timeBudget:1/0,turnsBudget:6},this.props.testFailure,this.props.location).climb();if(this.props.chatLocation===1)return{outcome:c};if(c.type===0)if(c.solution.edits){s.report(new ls(new us(c.solution.before))),s.report(new Uf(c.solution.uri,c.solution.edits.apply)),s.report(new ls(new us(c.solution.after)));let u=new ek;u.set(c.solution.uri,c.solution.edits.apply);let l=new ek;l.set(c.solution.uri,c.solution.edits.undo),s.report(new tk(ufe(this.props.testFailure.snapshot,u,l)))}else s.report(new ls(new us(c.solution.text)));else c.possibleSolution?s.report(new ls(new us(c.possibleSolution.text))):c.type===1?(s.report(new ls(afe())),s.report(new tk({command:"workbench.action.openSettings",title:mv.t("Go to Settings"),arguments:[{query:"github.copilot.config.testFixLimits"}]}))):s.report(new ls(cfe()));return{outcome:c}}render(r,n){return vscpp(vscppf,null,vscpp("meta",{value:new y5(r.outcome)}),vscpp("meta",{value:new _5(r.outcome.type===0?r.outcome.references:r.outcome.possibleSolution?.references||[])}))}};IP=w([b(1,st)],IP);var afe=()=>mv.t("Unfortunately I was unable to find a solution to this test failure in the time alloted. My time limit can be configured in your settings."),cfe=()=>mv.t("Unfortunately I was unable to find a solution to this test failure. Please try providing more context."),y5=class extends cu{constructor(r){super();this.value=r}},_5=class extends cu{constructor(r){super();this.value=r}},Uz=class{constructor(e,r){this.test=e;this.solution=r}async processResponse(e,r,n){let o=this.solution||{type:1};if(o.type!==0){if(o.possibleSolution)return r.markdown(o.possibleSolution.text),{type:"conversational"};if(o.type===1)return r.markdown(afe()),{type:"conversational"};if(o.type===2)return r.markdown(cfe()),{type:"conversational"}}let s=o.solution;if(!s.uri||!s.edits)return r.markdown(s.text),{type:"conversational"};let a=new ek;a.set(s.uri,s.edits.apply);let c=new ek;return c.set(s.uri,s.edits.undo),r.markdown(s.before),r.textEdit(s.uri,s.edits.apply),r.markdown(s.after),r.button(ufe(this.test,a,c)),{type:"workspaceEdit"}}};function ufe(t,e,r){return{title:mv.t("Apply and Rerun"),command:"github.copilot.tests.fixTestFailure.applyAndRerun",arguments:[t,e,r]}}var BI=class{constructor(e,r,n,o){this._intentService=e;this.instantiationService=r;this.endpointProvider=n;this.accessor=o;this.id="fix";this.locations=[1,2];this.description=lfe.t("Propose a fix for the problems in the selected code");this.commandInfo=void 0}static{this.ID="fix"}get intentDetectionInput(){let e="fix_code_or_markdown";return{functionName:e,sampleQuestion:"There is a problem in this code. Rewrite the code to show it with the bug fixed.",functionCallingBlurb:`If the user's message appears related to fixing problems in the selected code, you should use the '${e}' function.`}}async invoke(e){if(this.shouldDelegateToTestFixer(this.accessor,e))return this._intentService.getIntent(fv.ID,e.location).invoke(e);let{location:r,documentContext:n,request:o}=e;if(!n)throw new Error("Open a file to fix an issue");let s=this.accessor.get(be),a=this.accessor.get(wt),c=await this.endpointProvider.getEndpointFamilyForLocation(r);if(r===2){let h=await this.endpointProvider.getChatEndpoint(c);return this.instantiationService.createInstance(Zg,this,r,h,FI,e.documentContext)}let u=o.attempt,l=s.getExperimentBasedConfig(de.FixInlineChatEndpoint,a);l||(l=c,u>0&&l==="gpt-3.5-turbo"&&(l="gpt-4"));let d=await this.endpointProvider.getChatEndpoint(l),p;rr(n.document.uri)&&n.document.languageId==="python"?p=MI:p=OI;let f=u>1,m={useWorkspaceChunksFromSelection:f||s.getExperimentBasedConfig(de.FixUseWorkspaceChunksFromSelection,a),useWorkspaceChunksFromDiagnostics:!f&&s.getExperimentBasedConfig(de.FixUseWorkspaceChunksFromDiagnostics,a)};return this.instantiationService.createInstance(LI,this,r,d,p,n,m)}shouldDelegateToTestFixer(e,r){let n=e.safeGet(Iu);return!n?.isEnabled||r.documentContext?.selection.isEmpty===!1?!1:!!(r.location===1&&r.documentContext&&n.getFailureAtPosition(r.documentContext.document.uri,r.documentContext.selection.end)||n.lastResultsFrom&&Date.now()-n.lastResultsFrom<1e4&&!Os.isEmpty(n.getAllFailures()))}};BI=w([b(0,Qa),b(1,K),b(2,Se),b(3,st)],BI);var x5=H(Gt());var qI=class{constructor(e,r){this.endpointProvider=e;this.instantiationService=r;this.id="newNotebook";this.description=x5.t("Create a new Jupyter Notebook");this.locations=[2];this.commandInfo={allowsEmptyArgs:!1,yieldsTo:[{command:"fix"},{command:"explain"},{command:"workspace"},{command:"tests"}],defaultEnablement:!0,sampleRequest:x5.t("How do I create a notebook to load data from a csv file?")}}static{this.ID="newNotebook"}get intentDetectionInput(){let e="create_new_jupyter_notebook";return{functionName:e,modelDescription:"Creates a new Jupyter Notebook for tasks such as data analysis, scientific computing, and machine learning.",sampleQuestion:"How do I create a notebook to load data from a csv file?",functionCallingBlurb:`If the user's message is related to creating a new Jupyter notebook for data analysis, scientific computing, and machine learning, you should use the '${e}' function.`}}async invoke(e){let r=e.location,n=await this.endpointProvider.getEndpointForLocation(r);return this.instantiationService.createInstance(CP,this,n,r)}};qI=w([b(0,Se),b(1,K)],qI);var CP=class{constructor(e,r,n,o){this.intent=e;this.endpoint=r;this.location=n;this.instantiationService=o;this.linkification={disable:!0}}async buildPrompt(e,r,n){return await Be.create(this.instantiationService,this.endpoint,I3,{promptContext:e,endpoint:this.endpoint}).render(r,n)}processResponsePanel(e,r,n,o,s){return new E3().processResponse(e,r,n,o,s)}async commands(e){let r=(e.response?.message??"").replace(/\n/g,""),o=/```(?:json)?(.+)/g.exec(r);if(o)try{let s=o[1],a=s.indexOf("```"),c=a===-1?s:s.substring(0,a),u=JSON.parse(c);return Promise.resolve([{command:"github.copilot.newNotebook",arguments:[{turn:e,outline:u}],title:x5.t("Create Notebook")}])}catch{}return[]}};CP=w([b(3,K)],CP);var EP=H(Gt()),wP=H(require("path"));var dfe="Review the currently selected code.",bBe=EP.t("local changes"),jI=class extends Ho{constructor(r,n,o,s,a,c,u,l,d){super(r,n,o);this.documentContext=s;this.instantiationService=a;this.workspaceService=c;this.tabsAndEditorsService=u;this.logService=l;this.gitExtensionService=d;this.linkification={additionaLinkifiers:[{create:()=>new qz(this.documentContext.document.uri)}]}}async createRenderer({history:r,query:n,chatVariables:o},s,a,c){let u=[];if(n===bBe){let l=await sn.getCurrentChanges(this.gitExtensionService,"workingTree");(await Promise.all(l.map(async p=>({document:await this.workspaceService.openTextDocument(p.uri),relativeDocumentPath:wP.default.relative(p.repository.rootUri.fsPath,p.uri.fsPath),change:p})))).map(p=>u.push(p))}else{let l=this.tabsAndEditorsService.activeTextEditor;l&&u.push({document:l.document,relativeDocumentPath:wP.default.basename(l.document.uri.fsPath),selection:l.selection})}return Be.create(this.instantiationService,s,I1,{query:n,history:r,chatVariables:o,input:u,logService:this.logService})}};jI=w([b(4,K),b(5,Ve),b(6,zt),b(7,oe),b(8,_o)],jI);var Bz=class extends jI{async buildPrompt(e,r,n){return e.query===""&&(e={...e,query:dfe}),super.buildPrompt(e,r,n)}processResponseInline(e,r,n){return this.instantiationService.createInstance(TP,this.documentContext).processResponse(e,r,n)}},HI=class{constructor(e,r){this.instantiationService=e;this.endpointProvider=r;this.id="review";this.locations=[2,1];this.description=EP.t("Review the selected code in your active editor");this.intentDetectionInput={sampleQuestion:dfe,disabled:!0}}static{this.ID="review"}async invoke(e){let r=e.documentContext,n=e.location,o=await this.endpointProvider.getChatEndpoint("gpt-4");return n===1?this.instantiationService.createInstance(Bz,this,n,o,r):this.instantiationService.createInstance(jI,this,n,o,r)}};HI=w([b(0,K),b(1,Se)],HI);var qz=class{constructor(e){this.file=e}async linkify(e,r,n){let o=LG(e);if(!o.length)return;let s=0,a=0,c=[];for(let u of o)c.push(e.substring(a,u.linkOffset)),c.push(g3(e.substring(u.linkOffset,u.linkOffset+u.linkLength),this.file.with({fragment:String(u.from+1)}))),s++,a=u.linkOffset+u.linkLength;return c.push(e.substring(a)),{text:c.join(""),trustedCommands:[ev],addedLinkCount:s}}},TP=class{constructor(e,r){this.documentContext=e;this.reviewService=r;this.updating=!1;this.text="";this.comments=[]}async processResponse(e,r,n){let o={promptCount:1,messageId:_r(),inputType:"selection",inputRanges:[{uri:this.documentContext.document.uri,ranges:[this.documentContext.selection]}]};for await(let a of e){if(this.text=a.text,!this.updating){this.updating=!0;let u=new us(EP.t({message:`Reviewing your code...
`,comment:"{Locked='](command:workbench.panel.markers.view.focus)'}"}));u.isTrusted={enabledCommands:["workbench.panel.markers.view.focus"]},r.markdown(u)}let c=Yk(o,[{document:this.documentContext.document,relativeDocumentPath:wP.default.basename(this.documentContext.document.uri.fsPath),selection:this.documentContext.selection}],this.text,!0);c.length>this.comments.length&&(this.reviewService.addReviewComments(c.slice(this.comments.length)),this.comments=c)}let s=Yk(o,[{document:this.documentContext.document,relativeDocumentPath:wP.default.basename(this.documentContext.document.uri.fsPath),selection:this.documentContext.selection}],this.text,!1);return s.length>this.comments.length&&(this.reviewService.addReviewComments(s.slice(this.comments.length)),this.comments=s),r.markdown(EP.t("Reviewed your code and generated {0} suggestions.",s.length)),{type:"conversational"}}};TP=w([b(1,So)],TP);var jz=H(Gt());var I5=H(nt());var S5=class extends X{render(e,r){let{query:n,history:o}=this.props.promptContext;return vscpp(vscppf,null,vscpp(I5.SystemMessage,{priority:1e3},"You are a VS Code search expert who helps to write search queries for text in a workspace. Users want to search across a whole workspace. Your response will contain parameters to use in the search that targets what the user wants.",vscpp("br",null),vscpp(Br,null),vscpp(Rt,null),vscpp(Vi,null),vscpp(Xt,null),vscpp("br",null),"Additional Rules",vscpp("br",null),"The user's question is ALWAYS related to search or replace. When the user's question does not seem to be related to searching or replacing, you MUST assume that they're searching for or replacing what they are describing.",vscpp("br",null),`For example, if the user says "emojis", try appending "I'm looking for _____" to the beginning (e.g. I'm looking for emojis) to make more sense of it.`,vscpp("br",null),vscpp("br",null),"For all valid questions, you MUST respond with a JSON object with search parameters to use.",vscpp("br",null),'- Your answer MUST wrap the JSON object in "[ARGS START]" and "[ARGS END]". "[ARGS START]" must be on a new line.',vscpp("br",null),'- Your answer MUST have an explanation in full, human-readable sentences. This goes before the "[ARGS START]" line.',vscpp("br",null),vscpp("br",null),'If you put a regex in the "query" parameter, make sure to set "isRegex" to true.',vscpp("br",null),'If you put a regex in the "query" parameter, do not start and/or end with forward slashes to denote a regex literal.',vscpp("br",null),"You MUST NOT give an answer with an empty-string query parameter.",vscpp("br",null),vscpp("br",null),'The "replace" string will be used to replace the query-matched search results.',vscpp("br",null),vscpp("br",null),'If you want to target certain files, set "filesToInclude" to a glob pattern. DO NOT assume the "filesToInclude" and "filesToExclude" without being very sure that the user wants to target these files!',vscpp("br",null),vscpp("br",null),'If the query is case sensitive, set "isCaseSensitive" to true.',vscpp("br",null),vscpp("br",null),"By default, all string fields are the empty string, and all boolean fields are false. Only list the fields you want to change.",vscpp("br",null),vscpp("br",null),"You should write the JSON object of the search parameters in the following format:",vscpp("br",null),"[ARGS START]",vscpp("br",null),"```json",vscpp("br",null),"{",vscpp("br",null),'	"query": ...,',vscpp("br",null),'	"replace": ...,',vscpp("br",null),'	"filesToInclude": ...,',vscpp("br",null),'	"filesToExclude": ...,',vscpp("br",null),'	"isRegex": ...,',vscpp("br",null),'	"isCaseSensitive": ...,',vscpp("br",null),"}",vscpp("br",null),"```",vscpp("br",null),"[ARGS END]",vscpp("br",null),vscpp("br",null),"Examples:",vscpp("br",null),vscpp("br",null),"### Question:",vscpp("br",null),"Search for 'foo' in all files under my 'src' directory.",vscpp("br",null),vscpp("br",null),"### Answer:",vscpp("br",null),"Populate the query field with 'foo' and specify the files to include as 'src/'.",vscpp("br",null),vscpp("br",null),"[ARGS START]",vscpp("br",null),"```json",vscpp("br",null),"{",vscpp("br",null),'	"query": "foo",',vscpp("br",null),'	"filesToInclude": "src" ,',vscpp("br",null),"}",vscpp("br",null),"```",vscpp("br",null),"[ARGS END]",vscpp("br",null),vscpp("br",null),"### Question:",vscpp("br",null),"Find all CamelCase words in all files under the 'src/extensions' directory.",vscpp("br",null),vscpp("br",null),"### Answer:",vscpp("br",null),"Perform a regex search for camelCase variables by checking for any word that has a lowercase letter followed by an uppercase letter, followed by any number of lowercase letters. You can use `\\b[a-z]+[A-Z][a-z]+\\b` to acheive this.",vscpp("br",null),"This must be case-sensitive since the capitalization of the letters in our regex matters.",vscpp("br",null),vscpp("br",null),"[ARGS START]",vscpp("br",null),"```json",vscpp("br",null),"{",vscpp("br",null),'	"query": "\\\\b[a-z]+[A-Z][a-z]+\\\\b",',vscpp("br",null),'	"filesToInclude": "src/extensions" ,',vscpp("br",null),'	"isRegex": true,',vscpp("br",null),'	"isCaseSensitive": true,',vscpp("br",null),"}",vscpp("br",null),"```",vscpp("br",null),"[ARGS END]",vscpp("br",null),vscpp("br",null),"### Question:",vscpp("br",null),"Find all hex color codes in css files",vscpp("br",null),vscpp("br",null),"### Answer:",vscpp("br",null),"Perform a search for 6-digit or 3-digit hex color codes using the regex `#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})\\b`.",vscpp("br",null),vscpp("br",null),"[ARGS START]",vscpp("br",null),"```json",vscpp("br",null),"{",vscpp("br",null),'	"query": "#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})\\\\b",',vscpp("br",null),'	"filesToInclude": "*.css" ,',vscpp("br",null),'	"isRegex": true,',vscpp("br",null),"}",vscpp("br",null),"```",vscpp("br",null),"[ARGS END]",vscpp("br",null),vscpp("br",null),"### Question:",vscpp("br",null),"Find all HTTPS links in markdown.",vscpp("br",null),vscpp("br",null),"### Answer:",vscpp("br",null),"Search all URLs that have the HTTPS protocol in a markdown file. Make sure to include all valid URL characters in their respective places. This regex should achieve this: `https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,6}\\b([-a-zA-Z0-9@:%_\\+.~#()?&//=]*)`.",vscpp("br",null),vscpp("br",null),"[ARGS START]",vscpp("br",null),"```json",vscpp("br",null),"{",vscpp("br",null),'	"query": "https?:\\\\/\\\\/(www\\\\.)?[-a-zA-Z0-9@:%._\\\\+~#=]{2,256}\\\\.[a-z]{2,6}\\\\b([-a-zA-Z0-9@:%_\\\\+.~#()?&//=]*)",',vscpp("br",null),'	"filesToInclude": "*.md" ,',vscpp("br",null),'	"isRegex": true,',vscpp("br",null),"}",vscpp("br",null),"```",vscpp("br",null),"[ARGS END]",vscpp("br",null),vscpp("br",null),"### Question:",vscpp("br",null),"Replace all YYYY-MM-DD dates with MM/DD/YYYY dates. Don't do this in typescript files.",vscpp("br",null),vscpp("br",null),"### Answer:",vscpp("br",null),"You will need to use the regex `(\\d{4})-(\\d{2})-(\\d{2})` to match the YYYY-MM-DD date format. Then, you will need to use the replace string `$2/$3/$1` to replace the date with the MM/DD/YYYY format.",vscpp("br",null),vscpp("br",null),"[ARGS START]",vscpp("br",null),"```json",vscpp("br",null),"{",vscpp("br",null),'	"query": "(\\\\d{4})-(\\\\d{2})-(\\\\d{2})",',vscpp("br",null),'	"replace: "$2/$3/$1",',vscpp("br",null),'	"filesToExclude": "*.ts",',vscpp("br",null),'	"isRegex": true,',vscpp("br",null),"}",vscpp("br",null),"```",vscpp("br",null),"[ARGS END]",vscpp("br",null),vscpp("br",null),"### Question:",vscpp("br",null),"Replace all camel case variable names with snake case variable names.",vscpp("br",null),vscpp("br",null),"### Answer:",vscpp("br",null),"To replace all camel case variables with snake case, we will need to:",vscpp("br",null),"1. Find all sequences of lowercase letters succeeded by uppercase letters. Use `([a-z]+)([A-Z])` to capture these sequences.",vscpp("br",null),"2. Separate them with an underscore character. `$1_$2` does this.",vscpp("br",null),"3. Convert both characters to lowercase. Adjust the previous replace text to be `\\l$1_\\l$2`.",vscpp("br",null),vscpp("br",null),"[ARGS START]",vscpp("br",null),"```json",vscpp("br",null),"{",vscpp("br",null),'	"query": "([a-z]+)([A-Z])",',vscpp("br",null),'	"replace: "\\\\l$1_\\\\l$2",',vscpp("br",null),'	"isRegex": true,',vscpp("br",null),'	"isCaseSensitive": true,',vscpp("br",null),"}",vscpp("br",null),"```",vscpp("br",null),"[ARGS END]",vscpp("br",null),vscpp("br",null),"### Question:",vscpp("br",null),"alphanumeric",vscpp("br",null),vscpp("br",null),"### Answer:",vscpp("br",null),"To find all alphanumeric characters, you can use the regex `[a-zA-Z0-9]`.",vscpp("br",null),vscpp("br",null),"[ARGS START]",vscpp("br",null),"```json",vscpp("br",null),"{",vscpp("br",null),'	"query": "[a-zA-Z0-9]",',vscpp("br",null),'	"isRegex": true,',vscpp("br",null),'	"isCaseSensitive": true,',vscpp("br",null),"}",vscpp("br",null),"```",vscpp("br",null),"[ARGS END]",vscpp("br",null),vscpp("br",null),"### Question:",vscpp("br",null),"link",vscpp("br",null),vscpp("br",null),"### Answer:",vscpp("br",null),"To find all web links, use the regex `https?:\\/\\/\\S+`.",vscpp("br",null),vscpp("br",null),"[ARGS START]",vscpp("br",null),"```json",vscpp("br",null),"{",vscpp("br",null),'	"query": "https?:\\\\/\\\\/\\\\S+",',vscpp("br",null),'	"isRegex": true,',vscpp("br",null),"}",vscpp("br",null),"```",vscpp("br",null),"[ARGS END]",vscpp("br",null),vscpp("br",null),"### Question:",vscpp("br",null),'Search for actionbar files outside of my "extensions" directoy',vscpp("br",null),vscpp("br",null),"### Answer:",vscpp("br",null),"To do this, use the query `actionbar` in all files except the ones in `extensions`.",vscpp("br",null),vscpp("br",null),"[ARGS START]",vscpp("br",null),"```json",vscpp("br",null),"{",vscpp("br",null),'	"query": "actionbar",',vscpp("br",null),'	"filesToExclude": "extensions",',vscpp("br",null),"}",vscpp("br",null),"```",vscpp("br",null),"[ARGS END]",vscpp("br",null),vscpp("br",null),"### Question:",vscpp("br",null),"typescript for loop",vscpp("br",null),vscpp("br",null),"### Answer:",vscpp("br",null),'To look for "for" loops in most languages, use the query `for\\s*\\(`.',vscpp("br",null),vscpp("br",null),"[ARGS START]",vscpp("br",null),"```json",vscpp("br",null),"{",vscpp("br",null),'	"query": "for\\s*\\(",',vscpp("br",null),'	"isRegex: true,',vscpp("br",null),'	"filesToInclude: "*.ts"',vscpp("br",null),"}",vscpp("br",null),"```",vscpp("br",null),"[ARGS END]",vscpp("br",null)),vscpp(Ot,{priority:600,history:o}),vscpp(Vo,{priority:700}),vscpp(zr,{priority:800,document:this.props.document,range:this.props.selection}),vscpp(I5.UserMessage,{priority:900},n))}};function yBe(t){if(!t)return[];let e=[],r={query:t.query??"",replace:t.replace??"",filesToInclude:t.filesToInclude??"",filesToExclude:t.filesToExclude??"",isRegex:t.isRegex??!1,isCaseSensitive:t.isRegex??!1};return e.push({command:"github.copilot.executeSearch",arguments:[r],title:jz.t("Search")}),e}function pfe(t){let e=Fs(t).at(0),r;if(e){let n;try{n=ip(e.code)}catch{}n&&(r=n)}return r}function _Be(t){if(!t)return[];let e=[`| Parameter  | Value |
`,`| ------ | ----- |
`];for(let[r,n]of Object.entries(t)){if(n==="")continue;let o=n;(typeof n=="string"||n instanceof String)&&(o=n.replace(/\|/g,"\\|")),e.push(`| ${r} | \`${o}\` |
`)}return e.push(`
`),e}var xBe="Search for 'foo' in all files under my 'src' directory",RP=class extends Ho{constructor(r,n,o,s){super(r,n,o);this.instantiationService=s}createRenderer(r,n,o,s){return Be.create(this.instantiationService,n,S5,{promptContext:r})}processResponsePanel(r,n,o,s,a){return this.instantiationService.createInstance(nv,[{start:"[ARGS END]",stop:"[ARGS START]"}],u=>_Be(pfe(u.join("")))).processResponse(r,n,o,s,a)}async commands(r){let n=pfe(r.response?.message??"");return yBe(n)}};RP=w([b(3,K)],RP);var VI=class{constructor(e,r){this.instantiationService=e;this.endpointProvider=r;this.id="search";this.locations=[2];this.description=jz.t("Generate query parameters for workspace search");this.commandInfo={allowsEmptyArgs:!1,defaultEnablement:da}}static{this.ID="search"}get intentDetectionInput(){let e="vscode_search";return{disabled:!0,functionName:e,sampleQuestion:xBe,functionCallingBlurb:`If the user's message is related to generating search query parameters for running a file search, you should use the '${e}' function.`}}async invoke(e){let r=e.location,n=await this.endpointProvider.getEndpointForLocation(r);return this.instantiationService.createInstance(RP,this,r,n)}};VI=w([b(0,K),b(1,Se)],VI);var PP=H(Gt());var kP=class extends Ho{constructor(r,n,o,s,a){super(r,n,o);this.accessor=s;this.instantiationService=a}async createRenderer({query:r,history:n},o,s,a){return Be.create(this.instantiationService,o,hI,{query:r})}processResponsePanel(r,n,o,s,a){return new Hz(this.accessor,this.endpoint).processResponse(r,n,o,s,a)}};kP=w([b(3,st),b(4,K)],kP);var hv=class{constructor(e,r){this.instantiationService=e;this.endpointProvider=r;this.id=hv.ID;this.locations=[2];this.description=PP.t("Find relevant code to your query");this.commandInfo={allowsEmptyArgs:!1,defaultEnablement:!1};this.intentDetectionInput={sampleQuestion:"Where is the toolbar code?",disabled:!0}}static{this.ID="semanticSearch"}async invoke(e){let r=e.location,n=await this.endpointProvider.getEndpointForLocation(r);return this.instantiationService.createInstance(kP,this,r,n)}};hv=w([b(0,K),b(1,Se)],hv);var Hz=class{constructor(e,r){this.accessor=e;this.endpoint=r}async processResponse(e,r,n,o,s){let a=r[r.length-1].content,c=0,u="";for await(let{delta:d}of n)c+=d.text.length,u+=d.text;o.progress(PP.t("Looking for relevant code"));let l=pz(u);return SBe(this.accessor,this.endpoint,a,l,s).then(d=>IBe(this.accessor,d,o))}};async function SBe(t,e,r,n,o){let s=t.get(jg),a=await Uk(t,{valueFor4096:8,maxMultiplier:4});return fz(s,e,r,n,a,o,{wrapCode:!0})}function IBe(t,e,r){if(e.length===0){let s=PP.t(`No relevant code found. Please be more specific.
`);return r.markdown(s),s}r.markdown(PP.t(`Here is some relevant code:

`));let n=t.get(Ve),o="";for(let s of e)o+=CBe(s,r,n);return o}function CBe(t,e,r){let n=[],s=`## ${gS(r,t.file)}

`;return e.markdown(s),n.push(s),t.locations.forEach(a=>{let c={uri:t.file,range:c1(a.range)},u=a.range.startLineNumber,l=a.range.endLineNumber,d=u+1===l?`Line ${u+1}`:`Lines ${u+1}-${l}`;e.markdown("- "),e.anchor(c,d),e.markdown(`

`),n.push(d+`

`),e.markdown(a.code+`
`),n.push(a.code+`
`)}),n.join("")}var $z=H(Gt());var up=ie("IExtensionsService");var TBe=globalThis._VSCODE_NLS_LANGUAGE==="pseudo"||typeof document<"u"&&document.location&&document.location.hash.indexOf("pseudo=true")>=0;function ffe(t,e){let r;return e.length===0?r=t:r=t.replace(/\{(\d+)\}/g,(n,o)=>{let s=o[0],a=e[s],c=n;return typeof a=="string"?c=a:(typeof a=="number"||typeof a=="boolean"||a===void 0||a===null)&&(c=String(a)),c}),TBe&&(r="\uFF3B"+r.replace(/[aouei]/g,"$&$&")+"\uFF3D"),r}function mfe(t,e,...r){return ffe(typeof t=="number"?EBe(t,e):e,r)}function EBe(t,e){let r=globalThis._VSCODE_NLS_MESSAGES?.[t];if(typeof r!="string"){if(typeof e=="string")return e;throw new Error(`!!! NLS MISSING: ${t} !!!`)}return r}var C5=(t,e)=>{let r=[t,...Fs(t).map(n=>n.code)];for(let n of r)try{let o=ip(n);if(o&&"configurations"in o&&Array.isArray(o.configurations))return o.configurations=o.configurations.map(s=>hfe(s,e)),o;if(o&&"type"in o&&"request"in o)return{configurations:[hfe(o,e)]}}catch{}},wBe=["name","type","request","debugServer","preLaunchTask","postDebugTask","presentation","internalConsoleOptions","suppressMultipleSessionWarning"];function hfe(t,e){"type"in t&&t.type==="python"&&(t.type="debugpy");let r=RBe(t.type,e);if(!r)return t;for(let n of Object.keys(t))wBe.includes(n)||n in r||delete t[n];return t}function gfe(t,e){for(let r of e.allAcrossExtensionHosts){let n=r.packageJSON?.contributes?.debuggers;if(!n)continue;let o=n.filter(a=>a.type===t&&!a.deprecated);if(!Array.isArray(o)||o.length===0)continue;let s=o.map(a=>{let c=[a.configurationAttributes.launch.properties,a.configurationAttributes.attach.properties].filter(u=>u!==void 0).flat();return Object.entries(c).map(u=>Object.entries(u[1]).map(l=>`${l[0]}: ${l[1].description||l[1].markdownDescription}`).flat()).flat()}).flat();if(s.length)return s}}function RBe(t,e){for(let r of e.allAcrossExtensionHosts){let n=r.packageJSON?.contributes?.debuggers;if(!n)continue;let o=n.filter(s=>s.type===t&&!s.deprecated);if(!(!Array.isArray(o)||o.length===0))return o.flatMap(s=>[s.configurationAttributes.launch?.properties,s.configurationAttributes.attach?.properties]).filter(s=>s!==void 0).reduce((s,a)=>({...s,...a}),{})}}var vfe=H(Gt()),so=H(nt()),Ty=require("path");function kBe(t,e){let r={configurations:[{type:"node",request:"launch",name:"Launch Program",program:"${workspaceFolder}/app/index.js",args:["--serve"]}]},n={configurations:[{type:"cppvsdbg",request:"launch",name:"Launch Program",program:"${workspaceFolder}/${input:executableName}.exe",stopAtEntry:!0}],inputs:[{type:"promptString",id:"executableName",description:"Name of your executable"}]},o=s=>e===1?JSON.stringify(s):`\`\`\`json
${JSON.stringify(s,null,2)}
\`\`\``;return t===0?`# Example
User:
My operating system is macOS.
Create a debug configuration to do the following: launch my node app

Assistant:
${o(r)}

# Example
User:
My operating system is Windows.
Create a debug configuration to do the following: debug my c++ program

Assistant:
${o(n)}
`:`# Example
User:
My operating system is macOS.
In the working directory \${workspaceFolder}/app, I ran this on the command line: node ./index --serve

Assistant:
${o(r)}

# Example
User:
My operating system is Windows.
In the working directory \${workspaceFolder}, I ran this on the command line: make test

Assistant:
${o(n)}
`}var gv=class extends X{constructor(r,n,o,s,a,c,u,l,d,p,f,m,h){super(r);this.workspace=n;this.chatMLFetcher=o;this.endpointProvider=s;this.instantiationService=a;this.conversationOptions=c;this.extensionsService=u;this.logService=l;this.docSearchClient=d;this.gitService=p;this.fileSystemService=f;this.ignoreService=m;this.envService=h}async prepare(r,n,o){if(o.isCancellationRequested)return{};let s=n?yy(n,new ui(vfe.t("Searching doc index...")),this.searchDocsSearchForContext(10,o),1e3):this.searchDocsSearchForContext(10,o);if(o.isCancellationRequested)return{};let a=await this.getDebuggerType(n,o),[c,u,l]=await Promise.all([s,this.getResources(a,n,o),this.getSchema(a,n,o)]);return{docSearchResults:c,resources:u,schema:l}}async getResources(r,n,o){let s=await this.queryModelForRequestedFiles(r,n,o);if(!s?.length)return;let a=this.props.input.type===1?this.props.input.absoluteCwd:void 0;if(a||(this.workspace.getWorkspaceFolders().length===1?a=this.workspace.getWorkspaceFolders()?.[0]?.fsPath:a=(await this.workspace.showWorkspaceFolderPicker())?.uri.fsPath),!a)return;let c=[],u=new Set(s.map(m=>a+Ty.sep+m)),l=new Set,d=this.gitService?.getExtensionApi()?.getRepository(Ye.from({scheme:"file",path:a}));if(d)try{l=await d.checkIgnore([...u])}catch{}let p,f=a;for(let m of s){a=f,(m==="tasks.json"||m==="launch.json")&&(a+=Ty.sep+".vscode");let h=await PBe(a,async g=>{if(g===Ty.sep)return;let v=Ye.from({scheme:"file",path:g+Ty.sep+m});try{p=await this.fileSystemService.readFile(v)}catch{return}if(p)return l.has(v.fsPath)||await this.ignoreService.isCopilotIgnored(v)?void 0:v});h&&c.push(h)}return c}async queryModelForRequestedFiles(r,n,o){let s=await this.endpointProvider.getChatEndpoint("gpt-3.5-turbo"),c=await(this.props.input.type===1?Be.create(this.instantiationService,s,Gz,{debuggerType:r,input:this.props.input,os:this.envService.OS}):Be.create(this.instantiationService,s,Vz,{debuggerType:r,input:this.props.input,os:this.envService.OS})).render(void 0,o),u=await this.chatMLFetcher.fetchOne("referenceFiles",c.messages,void 0,o,2,s,void 0,{temperature:this.conversationOptions.temperature,top_p:this.conversationOptions.topP},{messageSource:"referenceFiles"});if(u.type!=="success")return;let l;try{l=JSON.parse(u.value)}catch{return}if(Array.isArray(l))return n?.report(new ui("Requesting resources: "+l.join(", "))),l}async getSchema(r,n,o){if(!r)return;let s=gfe(r,this.extensionsService);if(s)return n?.report(new ui("Identified launch config properties")),s}async getDebuggerType(r,n){let o=await this.endpointProvider.getChatEndpoint("gpt-3.5-turbo"),a=await Be.create(this.instantiationService,o,zz,{debuggerTypes:this.getAllDebuggerTypes(),input:this.props.input,os:this.envService.OS}).render(void 0,n),c=await this.chatMLFetcher.fetchOne("debugType",a.messages,void 0,n,2,o,void 0,{temperature:this.conversationOptions.temperature,top_p:this.conversationOptions.topP},{messageSource:"debugType"});if(c.type==="success")return/`(.*?)`/.exec(c.value)?.[1]||c.value}getAllDebuggerTypes(){return this.extensionsService.allAcrossExtensionHosts.filter(r=>!!r.packageJSON?.contributes?.debuggers).map(r=>{let n=[];for(let o of r.packageJSON?.contributes?.debuggers)o.type==="*"||o.deprecated||n.push(`- ${o.type}: ${o.label} (${r.id})`);return n}).flat()}async searchDocsSearchForContext(r,n){if(this.props.input.type!==0)return[];try{return await this.docSearchClient.search(this.props.input.userQuery,{repo:"microsoft/vscode-docs"},{limit:r,similarity:.75},n)}catch(o){return this.logService.public.error(o,"Failed to search docs search for query"),[]}}render(r,n){let o=this.props.input.type===1?1:0;return vscpp(vscppf,null,vscpp(so.SystemMessage,{priority:1e3},"You are a Visual Studio Code assistant who specializes in debugging and creating launch configurations. Your task is to create a launch configuration for the user's query.",vscpp("br",null),vscpp(Br,null),vscpp(Rt,null),o===1?vscpp(vscppf,null,"Print out only the VS Code `launch.json` file needed to debug the command, formatted as JSON.",vscpp("br",null),"Pay attention to my operating system and suggest the best tool for the platform I'm working on. For example, for debugging native code on Windows, you would not suggest the `lldb` type.",vscpp("br",null),"If there are unknowns, such as the path to the program, use the `inputs` field in the launch.json schema to prompt the user with an informative message. Input types may either be `promptString` for free text input or `pickString` with an `options` array for enumerations.",vscpp("br",null),"Do not give any other explanation. Avoid wrapping the whole response in triple backticks.",vscpp("br",null)):vscpp(vscppf,null,"The user cannot see the context you are given, so you must not mention it. If you want to refer to it, you must include it in your reply.",vscpp("br",null)),"If there are unknowns, such as the path to the program, use the `inputs` field in the launch.json schema to prompt the user with an informative message. Input types may either be `promptString` for free text input or `pickString` with an `options` array for enumerations.",vscpp("br",null),"Always include the following properties in the launch.json file:",vscpp("br",null),"- type: the type of debugger to use for this launch configuration. Every installed debug extension introduces a type: node for the built-in Node debugger, for example, or php and go for the PHP and Go extensions.",vscpp("br",null),"- request:  the request type of this launch configuration. Currently, launch and attach are supported.",vscpp("br",null),"- name:  the reader-friendly name to appear in the Debug launch configuration dropdown.",vscpp("br",null),"If a result is not a valid answer, but it still relates to Visual Studio Code, please still respond.",vscpp("br",null),"Please do not guess a response and instead just respond with a polite apology if you are unsure.",vscpp("br",null),"If you believe the given context given to you is incorrect or not relevant you may ignore it.",vscpp("br",null),kBe(this.props.input.type,o),vscpp("br",null)),vscpp(Ot,{priority:600,history:this.props.history}),vscpp(so.UserMessage,{priority:700},r.docSearchResults&&r.docSearchResults.length>0&&vscpp(vscppf,null,"Below is a list of information from the Visual Studio Code documentation which might be relevant to the question. ",vscpp("br",null)),r.docSearchResults&&r.docSearchResults.map(s=>{s?.title&&s.contents&&(so.TextChunk,s?.title?.trim(),s.path,s.contents)})),vscpp(so.UserMessage,{priority:850},r.schema&&vscpp(vscppf,null,"Below is a list of properties that the launch config might include. ",vscpp("br",null),r.schema.map(s=>vscpp(so.TextChunk,null,s,vscpp("br",null),")")),")",vscpp("br",null))),vscpp(so.UserMessage,{priority:800},r.resources&&r.resources.length>0&&vscpp(vscppf,null,"Below is a list of resources from the workspace that might be useful in building the launch config. ",vscpp("br",null)),r.resources&&r.resources.map(s=>vscpp(Kd,{variableName:(0,Ty.basename)(s.path),variableValue:s}))),vscpp(GI,{priority:900,input:this.props.input,os:this.envService.OS}))}};gv=w([b(1,Ve),b(2,Ct),b(3,Se),b(4,K),b(5,Rr),b(6,up),b(7,oe),b(8,d1),b(9,_o),b(10,hr),b(11,ke),b(12,St)],gv);var Vz=class extends X{render(e,r){return vscpp(vscppf,null,vscpp(so.SystemMessage,{priority:10},"You are a Visual Studio Code assistant who specializes in debugging and creating launch configurations. Your job is to return an array of file names that may contain useful information to translate a user query into a VS Code debug configuration.",vscpp("br",null),`If a user's query includes "task", include "tasks.json" in the response.`,vscpp("br",null),"Do not give any other explanation and return only a JSON array of strings. Avoid wrapping the whole response in triple backticks. Do not include any other information in your response.",vscpp("br",null),vscpp(so.TextChunk,{priority:8},"# Example 1",vscpp("br",null),"## User: ",vscpp("br",null),"Create node app launch configuration",vscpp("br",null),"## Response:",vscpp("br",null),JSON.stringify(["package.json","index.js","app.js"]),vscpp("br",null),vscpp("br",null),"# Example 2",vscpp("br",null),"## User: ",vscpp("br",null),"Launch a rust app with lldb",vscpp("br",null),"## Response:",vscpp("br",null),JSON.stringify(["Cargo.toml","src/main.rs"]),vscpp("br",null),vscpp("br",null),"# Example 3",vscpp("br",null),"## User: ",vscpp("br",null),"Launch a go app",vscpp("br",null),"## Response:",vscpp("br",null),JSON.stringify(["main.go","go.mod"]),vscpp("br",null),vscpp("br",null))),vscpp(GI,{priority:4,...this.props}))}},Gz=class extends X{render(e,r){return vscpp(vscppf,null,vscpp(so.SystemMessage,{priority:10},"You are a Visual Studio Code assistant who specializes in debugging and creating launch configurations. Your job is to return an array of file names that may contain useful information to translate a command line invocation into a VS Code debug configuration.",vscpp("br",null),"For example, when running a task `make tests`, you should ask for the `Makefile` because it contains information about how the tests are run.",vscpp("br",null),`If a user's query includes "task", include "tasks.json" in the response.`,vscpp("br",null),"Do not give any other explanation and return only a JSON array of strings. Avoid wrapping the whole response in triple backticks. Do not include any other information in your response.",vscpp("br",null),vscpp(so.TextChunk,{priority:8},"# Example",vscpp("br",null),"## User: ",vscpp("br",null),"`npm run start`",vscpp("br",null),"## Response:",vscpp("br",null),JSON.stringify(["package.json"]),vscpp("br",null),vscpp("br",null),"# Example",vscpp("br",null),"## User: ",vscpp("br",null),"cargo run",vscpp("br",null),"## Response:",vscpp("br",null),JSON.stringify(["Cargo.toml"]),vscpp("br",null),vscpp("br",null))),vscpp(GI,{priority:4,...this.props}))}},GI=class extends X{render(){return this.props.input.type===0?vscpp(so.UserMessage,null,"Here's a description of the app I want to debug: ",this.props.input.userQuery,this.props.debuggerType?` and the debugging type: ${this.props.debuggerType}`:""):vscpp(so.UserMessage,null,"My operating system is ",this.props.os,".",vscpp("br",null),"In the working directory `",(this.props.input.relativeCwd||this.props.input.absoluteCwd).replaceAll("\\","/"),"`, I ran this on the command line:",vscpp("br",null),"```\n"+this.props.input.args.map(e=>e.replaceAll(`
`,"\\n")).join(` \\
  `)+"\n```")}},zz=class extends X{render(e,r){let n=this.props.input.type===1;return vscpp(vscppf,null,vscpp(so.SystemMessage,{priority:10},"You are a Visual Studio Code assistant. Your job is to assist users in using Visual Studio Code by providing knowledge to accomplish their task. Please do not guess a response and instead just respond with a polite apology if you are unsure.",vscpp("br",null),"You are a debugging expert. Your job is to return the debug type to use for launch config for the given use case.",vscpp("br",null),"Pay attention to my operating system and suggest the best tool for the platform I'm working on. For example, for debugging native code on Windows, you would not suggest the `lldb` type.",vscpp("br",null),this.props.input.type===1&&vscpp(vscppf,null,"The command I give you is used to run code that I'm working on. Although the command itself might not directly be my program, you should suggest a tool to debug the likely language I'm working in.",vscpp("br",null)),"The user will list the debug types they have installed, but this is not a complete list of debug types available. You may suggest a type outside of that list if it's a better fit.",vscpp("br",null),vscpp("br",null),vscpp(so.TextChunk,{priority:8},"# Example 1",vscpp("br",null),"## User: ",vscpp("br",null),n?"npx mocha":"Node.js",vscpp("br",null),"## Response:",vscpp("br",null),"`node`",vscpp("br",null),vscpp("br",null),"# Example 2",vscpp("br",null),"## User: ",vscpp("br",null),n?"python3 example.py":"Python",vscpp("br",null),"## Response:",vscpp("br",null),"`debugpy`",vscpp("br",null),vscpp("br",null),"# Example 3",vscpp("br",null),"## User: ",vscpp("br",null),n?"mvn test -Dtest=TestCircle":"Java",vscpp("br",null),"## Response:",vscpp("br",null),"`java`",vscpp("br",null),vscpp("br",null)),"Suggest the right debug type for my use case. Print ONLY the debug type. NEVER print any other explanation.",vscpp("br",null)),vscpp(GI,{...this.props,priority:6}),vscpp(so.UserMessage,{priority:5,flexGrow:1},vscpp(so.TextChunk,null,"Here are the debug types I have installed:"),vscpp(so.TextChunk,{flexGrow:1,breakOnWhitespace:!0},this.props.debuggerTypes.join(`
`))))}};async function PBe(t,e){for(;;){let r=await e(t);if(r!==void 0)return r;let n=iL(t);if(n===t)return;t=n}}var DBe="Attach to node app at port 5870 with outFiles",vv=class{constructor(e,r,n,o,s){this.endpointProvider=e;this.instantiationService=r;this.runCommandExecutionService=n;this.telemetryService=o;this.extensionsService=s;this.id=vv.ID;this.locations=[2];this.description=$z.t("Start Debugging");this.isListedCapability=!1;this.intentDetectionInput={sampleQuestion:DBe};this.commandInfo={allowsEmptyArgs:!1,defaultEnablement:da}}static{this.ID="startDebugging"}async asSlashCommand(){return{name:this.id,description:this.description}}async invoke(e){let r=e.location,n=await this.endpointProvider.getChatEndpoint("gpt-4");return{intent:this,location:r,endpoint:n,processResponsePanel:async(o,s,a,c,u)=>{let l="",d="";c.progress($z.t("Generating launch configuration..."));for await(let{delta:f}of a){if(u.isCancellationRequested)break;l+=f.text}d=l;let p=C5(d,this.extensionsService);return p&&(c.markdown(`The ${p.configurations[0].type} launch configuration has been added.`),await this.runCommandExecutionService.executeCommand("github.copilot.createLaunchJsonFileWithContents",this.telemetryService,p),c.button({title:mfe("startDebugging","Start Debugging"),command:"workbench.action.debug.start",arguments:[p]})),d},buildPrompt:async(o,s,a)=>await Be.create(this.instantiationService,n,gv,{input:{type:0,userQuery:o.query},history:o.history}).render(s,a)}}};vv=w([b(0,Se),b(1,K),b(2,dI),b(3,he),b(4,up)],vv);var bfe=H(Gt());var Ey=H(nt());var T5=class extends X{render(e){let{query:r,history:n,chatVariables:o,customInstructions:s}=this.props.promptContext;return vscpp(vscppf,null,vscpp(Ey.SystemMessage,{priority:1e3},"You are a programmer who specializes in using the command line. Your task is to help the Developer craft a command to run on the command line.",vscpp("br",null),vscpp(Br,null),vscpp(Rt,null),vscpp(Vi,null),vscpp(Xt,null),vscpp("br",null),"Additional Rules",vscpp("br",null),"Think step by step:",`
1. Read the provided relevant workspace information (file names, project files in the project root) to understand the user's workspace.`,`
2. Generate a response that clearly and accurately answers the user's question. In your response, follow the following:
    - Prefer single line commands.
    - Omit an explanation unless the suggestion is complex, if an explanation is included then be concise.
    - Provide the command suggestions using the active shell and operating system.
    - When there is text that needs to be replaced in the suggestion, prefix the text with '{', suffix the text with '}' and use underscores instead of whitespace. Only do this when the replacement text is NOT provided.
    - Say "I'm not quite sure how to do that." when you aren't confident in your explanation`,Wz(this.props.shellType)?"\n    - Prefer idiomatic PowerShell over aliases for other shells or system utilities. For example use `Stop-Process` or `Get-NetTCPConnection` instead of `kill` or `lsof` respectively.\n	- Only use unix utilities when there is no PowerShell equivalent.\n    - Prefer cross-platform PowerShell scripting that works on any operating system.":`
    - Only use a tool like python or perl when it is not possible with the shell.`,`
3. At the end of the response, list all text that needs to be replaced with associated descriptions in the form of a markdown list
`.trim(),vscpp("br",null)),vscpp(Ey.SystemMessage,{priority:700},"Examples:",vscpp("br",null),NBe(this.props.shellType)),vscpp(Ot,{flexGrow:1,priority:600,history:n}),vscpp(Ey.UserMessage,{flexGrow:1,priority:750},vscpp(Or,{customInstructions:s,languageId:Wz(this.props.shellType)?"ps1":"bash"})),vscpp(Ey.UserMessage,{flexGrow:1,priority:800},"The active terminal's shell type is:",vscpp("br",null),this.props.shellType),vscpp(Ey.UserMessage,{flexGrow:1,priority:800},"The active operating system is:",vscpp("br",null),this.props.osName),vscpp(pr,{priority:899,...this.props,flexGrow:2}),vscpp(Jr,{flexGrow:2,priority:900,chatVariables:o,query:r}))}};function NBe(t){let e=['User: How do I revert a specific commit?\nAssistant:\n```sh\ngit revert {commit_id}\n```\n\nUser: How do I commit in git?\nAssistant:\n```sh\ngit commit -m "{message}"\n```'];switch(Wz(t)||e.push("User: go to the foo dir\nAssistant:\n```sh\ncd foo\n```"),t){case"ps1":case"pwsh":case"powershell":{e.push("User: go to the foo dir\nAssistant:\n```pwsh\ncd .\\foo\\\n```\n\nUser: How do I delete a directory?\nAssistant:\n```pwsh\nRemove-Item {dir_name}\n```\n\nUser: create a file called foo\nAssistant:\n```pwsh\nNew-Item -ItemType File -Name foo\n```");break}case"bash":{e.push("User: Print all files starting with \"pre\"\n```bash\nfind . -type f -name 'pre*'\n```");break}default:{e.push("\nUser: How do I print all files recursively within a directory?\nAssistant:\n```sh\nls -lR\n```");break}}return e.join(`

`)}function Wz(t){return t==="ps1"||t==="pwsh"||t==="powershell"}var bv=class{constructor(e,r){this.instantiationService=e;this.endpointProvider=r;this.locations=[2];this.id=bv.ID;this.description=bfe.t("Ask how to do something in the terminal");this.commandInfo=void 0}static{this.ID="terminal"}get intentDetectionInput(){let e="terminal_questions";return{functionName:e,sampleQuestion:"How do I list files in the terminal",functionCallingBlurb:`If the user's message is about how to do something in the terminal, you should use the '${e}' function.`}}async invoke(e){let r=e.location,n=await this.endpointProvider.getEndpointForLocation(r);return this.instantiationService.createInstance(AP,this,n,r)}};bv=w([b(0,K),b(1,Se)],bv);var AP=class{constructor(e,r,n,o,s,a){this.intent=e;this.endpoint=r;this.location=n;this.instantiationService=o;this.envService=s;this.terminalService=a}async buildPrompt(e,r,n){let o=this.envService.OS,s=this.terminalService.terminalShellType;return await Be.create(this.instantiationService,this.endpoint,T5,{promptContext:e,osName:o,shellType:s,endpoint:this.endpoint}).render(r,n)}async followUps(e){let r="Explain the suggested command",n=!1,o=e.response?.message;if(o){let a=Fs(o);if(a.length===0)return[];a.length===1?r=`Explain this command:

${s(a[0])}`:(n=!0,r=`Explain these commands:${a.map(c=>`

${s(c)}`).join("")}`)}return[{prompt:r,label:n?"Explain the suggested commands":"Explain the suggested command"}];function s(a){return`${a.startMarkup}${a.language}
${a.code.trim()}
${a.startMarkup}`}}};AP=w([b(3,K),b(4,St),b(5,Zn)],AP);var Cfe=H(Gt());var KI=H(nt()),_fe=H(require("assert")),wy=H(require("path"));var DP=H(nt()),E5=H(require("path"));var zI=class extends X{constructor(r,n,o){super(r);this.parserService=n;this.workspaceService=o}async render(r,n,o,s){let{kind:a,testExampleFile:c}=this.props,u;try{u=await this.workspaceService.openTextDocument(c)}catch{return}let l=await Ak(this.parserService,u,void 0,new Qe(0,0,0,0),n.tokenBudget),d=[new DP.PromptReference(c)],p=this.workspaceService.getWorkspaceFolders().find(m=>c.path.startsWith(m.path)),f=c.path;switch(p!==void 0&&(f=E5.relative(p.path,c.path),f=f.split(E5.sep).join("/")),a){case"candidateTestFile":return vscpp(DP.UserMessage,null,vscpp("references",{value:d}),"Excerpt of the existing test file at `",f,"`:",vscpp("br",null),vscpp(Fe,{uri:c,code:l.text,languageId:l.languageId}),vscpp("br",null),"Because a test file exists: ",vscpp("br",null),"- Do not generate preambles, like imports, copyright headers etc.",vscpp("br",null),"- Do generate code that can be appended to the existing test file.");case"anyTestFile":return vscpp(DP.UserMessage,null,"This is a sample test file:",vscpp("br",null),vscpp(Fe,{uri:c,code:l.text,languageId:l.languageId}))}}};zI=w([b(1,_t),b(2,Ve)],zI);var R5=H(nt());var yfe=require("util");var w5=ie("ITestDepsResolver"),$I=class{constructor(e,r){this._searchService=e;this._fileSystemService=r;this._perLanguageTestDepsFinder=new Map;this._cachedResults=new Map,this._textDecoder=new yfe.TextDecoder}async getTestDeps(e){let r=this._cachedResults.get(e);if(r!==void 0)return r;let n=this.getTestDepsFinder(e);if(n===void 0)return[];let o=await n.findTestDeps();return this._cachedResults.set(e,o),o}getTestDepsFinder(e){let r=this._perLanguageTestDepsFinder.get(e);if(r===void 0)switch(e){case"javascript":case"javascriptreact":case"typescript":case"typescriptreact":{r=new Kz(this._searchService,this._fileSystemService,this._textDecoder);break}case"python":{r=new Yz(this._searchService,this._fileSystemService,this._textDecoder);break}case"java":{r=new Qz(this._searchService,this._fileSystemService,this._textDecoder);break}}return r!==void 0&&this._perLanguageTestDepsFinder.set(e,r),r}};$I=w([b(0,Fd),b(1,hr)],$I);var Kz=class{constructor(e,r,n){this._searchService=e;this._fileSystemService=r;this._textDecoder=n;this._jsTsTestDeps=new Set(["mocha","jest","vitest","chai","ava","jasmine","qunit","tape","cypress","puppeteer","enzyme","testing-library","sinon","supertest","happy-dom"])}async findTestDeps(){let e=await this._searchService.findFiles("**/package.json",{exclude:"**/node_modules/**",useDefaultExcludes:!0});return(await Promise.allSettled(e.map(async n=>{let o=await this._fileSystemService.readFile(n),s=JSON.parse(this._textDecoder.decode(o)),a=s.dependencies||{},c=s.devDependencies||{};return[a,c].flatMap(l=>Object.keys(l).filter(d=>this._jsTsTestDeps.has(d)))}))).flatMap(n=>n.status==="fulfilled"?n.value:[])}},Yz=class{constructor(e,r,n){this._searchService=e;this._fileSystemService=r;this._textDecoder=n;this._pyTestDeps=["pytest","nose","unittest","tox","doctest","hypothesis","mock","coverage","behave","robotframework"]}async findTestDeps(){let e=new Set,r=["pyproject.toml","setup.py","requirements.txt","tox.ini"],n=await this._searchService.findFiles(`**/{${r.join(",")}}`);return await Promise.all(n.map(async o=>{let s=await this._fileSystemService.readFile(o),a=this._textDecoder.decode(s);o.path.endsWith("pyproject.toml")?this._getPyProjectTomlDeps(a).forEach(u=>e.add(u)):o.path.endsWith("setup.py")?this._getSetupPyDeps(a).forEach(u=>e.add(u)):o.path.endsWith("requirements.txt")?this._getRequirementsTxtDeps(a).forEach(u=>e.add(u)):o.path.endsWith("tox.ini")&&e.add("tox")})),Array.from(e)}_getPyProjectTomlDeps(e){return this._pyTestDeps.filter(r=>e.includes(r))}_getSetupPyDeps(e){return this._pyTestDeps.filter(r=>e.includes(r))}_getRequirementsTxtDeps(e){return this._pyTestDeps.filter(r=>e.includes(r))}},Qz=class{constructor(e,r,n){this._searchService=e;this._fileSystemService=r;this._textDecoder=n;this._javaTestDeps=["junit","testng","mockito","assertj","hamcrest","powermock","spock","cucumber","arquillian","selenium","rest-assured","wiremock","pitest"]}async findTestDeps(){let e=new Set,r=["pom.xml","build.gradle","build.gradle.kts"],n=await this._searchService.findFiles(`**/{${r.join(",")}}`);return await Promise.all(n.map(async o=>{let s=await this._fileSystemService.readFile(o),a=this._textDecoder.decode(s);this._javaTestDeps.filter(c=>a.includes(c)).forEach(c=>e.add(c))})),Array.from(e)}};var yv=class extends R5.PromptElement{constructor(r,n){super(r);this.testDepsResolver=n}async render(r,n){let{languageId:o}=this.props,s=await this.testDepsResolver.getTestDeps(o);return s.length>0&&vscpp(R5.UserMessage,null,"The project has the following testing dependencies: ",s.join(", "),".")}};yv=w([b(1,w5)],yv);var k5=H(require("path"));function P5({workspaceService:t,chatVariables:e,userQuery:r,testFileToWriteTo:n,testedSymbolIdentifier:o,context:s}){let a=o?`\`${o}\``:"my code",c=e.substituteVariablesWithReferences(r),u=t.getWorkspaceFolders().find(p=>n.path.startsWith(p.path)),l=null;return u!==void 0&&(l=k5.relative(u.path,n.path),l=l.split(k5.sep).join("/")),[`Please, generate tests for ${a}.`,l===null?"":`The tests will be placed in \`${l}\`${l.includes("/")?"":" located in the same directory as `"+s.document.uri.path+"`"}. Generate tests accordingly.`,c].filter(p=>p!=="").join(" ").trim()}var WI=class{constructor(e,r,n,o,s,a,c,u){this.intent=e;this.endpoint=r;this.location=n;this.documentContext=o;this.instantiationService=s;this.workspaceService=a;this.ignoreService=c;this._parserService=u;this._testFileFinder=this.instantiationService.createInstance(Zd)}async buildPrompt(e,r,n){(0,_fe.default)(!Gg(this.documentContext.document),"TestFromSourceInvocation should not be invoked from a test file");let o=await this.findTestFileForSourceFile(n);if(o!==null&&o.kind==="candidateTestFile")this._testFileToWriteTo={kind:"existing",uri:o.testExampleFile};else{let u=t3(this.documentContext.document);this._testFileToWriteTo={kind:"new",uri:u}}let s;if(this._testFileToWriteTo.kind==="new")s=new Qe(0,0,0,0);else{let u=this._testFileToWriteTo.uri,l=await this.workspaceService.openTextDocument(u),d=this._parserService.getTreeSitterAST(l),p=d?await d.findLastTest():null;if(p===null)s=new Qe(l.lineCount,0,l.lineCount,0);else{let f=l.positionAt(p.endIndex),m=f.line+1;s=new Qe(f.line,f.character,m,0)}}return r.report(new Eae(this._testFileToWriteTo.uri,s)),await Be.create(this.instantiationService,this.endpoint,NP,{context:this.documentContext,endpoint:this.endpoint,location:this.location,testExampleFile:o,testFileToWriteTo:this._testFileToWriteTo,promptContext:e}).render(r,n)}async processResponseInline(e,r,n){let o=this.documentContext.document;iu(this._testFileToWriteTo!==void 0,"Test file to write to must have been defined in buildPrompt");let s=this._testFileToWriteTo.uri;if(this._testFileToWriteTo.kind==="new"){let a=new Qe(0,0,0,0),c=new Lc("",on.empty,o.languageId);return{...await new Ag(s,c,this.documentContext.fileIndentInfo,Yo.Emit,1,(d,p)=>new kg(p,a.start,d),Ai.createCodeBlockClassifier(),d=>!0).processResponse(e,r,n),type:"workspaceEdit"}}else{let a=await this.workspaceService.openTextDocument(s),c=this._parserService.getTreeSitterAST(a),u=c?await c.findLastTest():null,l;if(u===null)l=new Qe(a.lineCount,0,a.lineCount,0);else{let g=a.positionAt(u.endIndex),v=g.line+1;l=new Qe(g.line,g.character,v,0)}let p=(await ga(this._parserService,a,this.documentContext.fileIndentInfo,l,a.getText().length)).splitAroundOriginalSelectionEnd(),f="$PLACEHOLDER$";return{...await p.createReplyInterpreter(GS.chain(g=>HV(g,"`"+f+"`","selection"),g=>HV(g,f,"selection")),1,p.insertStreaming,Ai.createCodeBlockClassifier(),g=>g.value.trim()!==f).processResponse(e,r,n),type:"workspaceEdit"}}}async findTestFileForSourceFile(e){let r,n=await this._testFileFinder.findTestFileForSourceFile(this.documentContext.document,e);if(e.isCancellationRequested)return null;if(n!==void 0)r="candidateTestFile";else{let o=await this._testFileFinder.findAnyTestFileForSourceFile(this.documentContext.document,e);if(e.isCancellationRequested)return null;r="anyTestFile",n=o}return n===void 0||await this.ignoreService.isCopilotIgnored(n)?null:{kind:r,testExampleFile:n}}};WI=w([b(4,K),b(5,Ve),b(6,ke),b(7,_t)],WI);var NP=class extends X{constructor(r,n,o){super(r);this.parserService=n;this.workspaceService=o}async render(r,n){let{history:o,query:s,chatVariables:a,customInstructions:c}=this.props.promptContext,{context:u,testExampleFile:l,testFileToWriteTo:d,location:p}=this.props,f=this.parserService.getTreeSitterAST(u.document),m=u.selection,h,g;if(f!==void 0){let E=await f.getNodeToDocument(io(u.selection,u.document));m=ms(u.document,E.nodeToDocument),h=E.nodeIdentifier,g=E.nodeToDocument.type}let v=["typescript","typescriptreact"].includes(u.document.languageId)&&g!==void 0&&["class_declaration","method_definition"].includes(g)?{costFnOverride:(E,R)=>E.kind==="constructor"||E.kind==="method_definition"?0:R}:void 0,y=await Ak(this.parserService,u.document,u.fileIndentInfo,m,n.tokenBudget/2,v),_=u.language.languageId,x=await this.computeLangSpecificExtraGuidelines(u,l),S=P5({workspaceService:this.workspaceService,chatVariables:a,userQuery:s,testFileToWriteTo:d.uri,testedSymbolIdentifier:h,context:u}),I=o.at(-1)?.request.message;return vscpp(vscppf,null,vscpp(KI.SystemMessage,{priority:1e3},"You are an AI programming assistant.",vscpp("br",null),vscpp(Br,null),vscpp("br",null),vscpp(Rt,null),vscpp("br",null),p===1?vscpp(vscppf,null,"The user has a ",_," file opened in a code editor.",vscpp("br",null),"The user includes some code snippets from the file.",vscpp("br",null),"Answer with a single ",_," code block."):p===2?vscpp(vscppf,null,"First think step-by-step - describe your plan for what to build in pseudocode, written out in great detail.",vscpp("br",null),"Then output the code in a single code block.",vscpp("br",null),"Minimize any other prose.",vscpp("br",null),"Use Markdown formatting in your answers.",vscpp("br",null),"Make sure to include the programming language name at the start of the Markdown code blocks.",vscpp("br",null),"Avoid wrapping the whole response in triple backticks.",vscpp("br",null),"The user works in an IDE called Visual Studio Code which has a concept for editors with open files, integrated unit test support, an output pane that shows the output of running the code as well as an integrated terminal.",vscpp("br",null),"The active document is the source code the user is looking at right now.",vscpp("br",null),"You can only give one reply for each conversation turn."):void 0,x.length>0&&vscpp(vscppf,null,vscpp("br",null)," ",x)),vscpp(yv,{languageId:_}),I!==void 0&&I.length>0&&vscpp(KI.UserMessage,{priority:700},I),c.length>0&&vscpp(KI.UserMessage,{priority:725},vscpp(Or,{customInstructions:c,languageId:u.language.languageId})),vscpp(pr,{priority:750,endpoint:n.endpoint,promptContext:this.props.promptContext,flexGrow:1}),vscpp(Bs,{priority:750,chatVariables:a}),l!==null&&vscpp(zI,{priority:750,...l}),vscpp(KI.UserMessage,{priority:900},"Here is the current file at `",u.document.uri.path,"`:",vscpp("br",null),vscpp("br",null),vscpp(Fe,{uri:u.document.uri,languageId:u.document.languageId,code:y.text}),vscpp("br",null),vscpp("br",null),S))}async computeLangSpecificExtraGuidelines(r,n){let o=[];if(r.document.languageId==="python"&&!(n!==null&&n.kind==="candidateTestFile")){o.push("Make sure your answer imports the function to test as this is a total new file.");let a=wy.dirname(r.document.uri.fsPath),c=wy.join(a,"__init__.py"),u=this.workspaceService.getWorkspaceFolder(r.document.uri);try{await this.workspaceService.openTextDocument(Gr.file(c)),u!==void 0&&wy.resolve(a)===wy.resolve(u?.fsPath??"")?o.push("The file is in the root of the workspace, which has an __init__.py but use an absolute import to import the function to test."):o.push("The parent directory of the given file has an __init__.py file making it a regular package. Use a relative import to import the function to test.")}catch{o.push("The parent directory of the given file has no __init__.py file making it a namespace package. Use an absolute import to import the function to test.")}}return o.join(`
`)}};NP=w([b(1,_t),b(2,Ve)],NP);var Ry=H(nt());var xfe=H(nt()),Sfe=H(require("assert"));var YI=class extends X{constructor(r,n,o,s){super(r);this.instaService=n;this.ignoreService=o;this.workspaceService=s}async render(r,n){let{documentContext:o,srcFile:s}=this.props;(0,Sfe.default)(Gg(o.document),"Test2Impl must be invoked on a test file.");let a=this.instaService.createInstance(Zd),c,u;if(s?(c=s.uri,u=s.target):c=await a.findFileForTestFile(o.document,Lr.None),c===void 0||await this.ignoreService.isCopilotIgnored(c))return;let l=await this.workspaceService.openTextDocument(c),p=await this.instaService.createInstance(Wd).summarizeDocument(l,o.fileIndentInfo,u,n.tokenBudget),f=[new Ms.PromptReference(c)];return vscpp(xfe.UserMessage,null,vscpp("references",{value:f}),"Below is the file located at ",c.path,":",vscpp("br",null),vscpp(Fe,{code:p.text,uri:c,languageId:o.document.languageId}))}};YI=w([b(1,K),b(2,ke),b(3,Ve)],YI);var Ife=H(nt());var QI=class extends X{constructor(r,n,o){super(r);this.parserService=n;this.ignoreService=o}async render(r,n){let{documentContext:o}=this.props;if(await this.ignoreService.isCopilotIgnored(o.document.uri))return vscpp("ignoredFiles",{value:[o.document.uri]});let a=o.document.validateRange(o.wholeRange),c=await ga(this.parserService,o.document,o.fileIndentInfo,a,n.endpoint.modelMaxPromptTokens/3),{uri:u,languageId:l}=c,d=c.splitAroundAdjustedSelection(),{codeAbove:p,codeSelected:f,codeBelow:m,hasCodeWithoutSelection:h}=d,g=`${p}$SELECTION_PLACEHOLDER$${m}`,v=d.createReplyInterpreter(Yo.Mute,1,d.replaceSelectionStreaming,Ai.createCodeBlockClassifier(),y=>y.value.trim()!=="$SELECTION_PLACEHOLDER$");return vscpp(Ife.UserMessage,null,vscpp("meta",{value:new Hn(v)}),"I have the following code in a file called `",vscpp(ps,{value:u,mode:1}),"`:",h&&vscpp(vscppf,null,vscpp(Fe,{uri:u,languageId:l,code:g,shouldTrim:!1}),vscpp("br",null)),h&&vscpp(vscppf,null,"The $SELECTION_PLACEHOLDER$ code is:",vscpp("br",null)),vscpp(Fe,{uri:u,languageId:l,code:f,shouldTrim:!1}))}};QI=w([b(1,_t),b(2,ke)],QI);var XI=class{constructor(e,r,n,o,s,a){this.intent=e;this.endpoint=r;this.location=n;this.context=o;this.instantiationService=s;this.testGenInfoStorage=a;this.replyInterpreter=null}async buildPrompt(e,r,n){let o=this.testGenInfoStorage.sourceFileToTest;o!==void 0&&(this.testGenInfoStorage.sourceFileToTest=void 0);let s=Be.create(this.instantiationService,this.endpoint,LP,{context:this.context,promptContext:e,testGenInfo:o}),a=await s.render(r,n);return this.replyInterpreter=s.getMeta(Hn)?.replyInterpreter??null,a}processResponseInline(e,r,n){return iu(this.replyInterpreter!==null,"TestFromTestInvocation should have received replyInterpreter from its prompt element"),this.replyInterpreter.processResponse(e,r,n)}async processResponsePanel(e,r,n,o,s){let a="";try{for await(let c of n){let u=c.delta.text;if(s.isCancellationRequested)break;o.markdown(u),a+=u}return a}catch(c){console.error(c)}return a}};XI=w([b(4,K),b(5,x1)],XI);var LP=class extends X{constructor(r,n){super(r);this.workspaceService=n}async render(r,n){let{history:o,query:s,chatVariables:a,customInstructions:c}=this.props.promptContext,{context:u,testGenInfo:l}=this.props;if(rr(u.document.uri))throw dn("TestFromTestPrompt should not be used for notebooks");let d=l?.identifier,p=l===void 0?`Please, generate more tests, taking into account existing tests. ${s}`.trim():P5({workspaceService:this.workspaceService,chatVariables:a,userQuery:s,testFileToWriteTo:u.document.uri,testedSymbolIdentifier:d,context:u}),f;if(l!==void 0){let h=await this.workspaceService.openTextDocument(l.uri),g=l.target.start,v=l.target.with(g.with(g.line,0));f=h.getText(v)}let m=o.at(-1)?.request.message;return vscpp(vscppf,null,vscpp(Ry.SystemMessage,null,"You are an AI programming assistant.",vscpp("br",null),vscpp(Br,null),vscpp("br",null),"The user has a ",u.language.languageId," file opened in a code editor.",vscpp("br",null),"The user includes some code snippets from the file.",vscpp("br",null),"Answer with a single ",u.language.languageId," code block.",vscpp("br",null),"Your expertise is strictly limited to software development topics.",vscpp("br",null),vscpp(Rt,null)),vscpp(yv,{languageId:u.language.languageId}),m!==void 0&&m.length>0&&vscpp(Ry.UserMessage,null,m),c.length!==0&&vscpp(Ry.UserMessage,null,vscpp(Or,{customInstructions:c,languageId:u.language.languageId})),vscpp(YI,{documentContext:u,srcFile:l}),vscpp(QI,{documentContext:u}),l!==void 0&&f!==void 0&&vscpp(Ry.UserMessage,null,`Repeating excerpt from \`${l?.uri.path}\` here that needs to be tested:`,vscpp("br",null),vscpp(Fe,{uri:l.uri,languageId:u.language.languageId,code:f})),vscpp(Ry.UserMessage,null,p))}};LP=w([b(1,Ve)],LP);var JI=class{constructor(e,r,n){this.instantiationService=e;this.endpointProvider=r;this.ignoreService=n;this.id="tests";this.locations=[2,1];this.description=Cfe.t("Generate unit tests for the selected code");this.commandInfo=void 0}static{this.ID="tests"}get intentDetectionInput(){let e="generate_test_for_code";return{functionName:e,sampleQuestion:"Write a set of detailed unit test functions for the code above.",functionCallingBlurb:`If the user's message is related to generating tests, you should use the '${e}' function.`}}async invoke(e){let r=e.documentContext;if(!r)throw new Error("To generate tests, open a file and select code to test.");if(await this.ignoreService.isCopilotIgnored(r.document.uri))throw new Error("Copilot is disabled for this file.");let n=e.location,o=await this.endpointProvider.getChatEndpoint("gpt-4");return Gg(r.document)?this.instantiationService.createInstance(XI,this,o,n,r):this.instantiationService.createInstance(WI,this,o,n,r)}};JI=w([b(0,K),b(1,Se),b(2,ke)],JI);var A5=H(Gt());var OP=H(Gt());function Tfe(t,e){let r=Fs(e);for(let n of r){if(n.language!=="json"&&n.language!=="")return[{command:void 0,showCodeBlock:!0,failedValidation:!1}];let o;try{o=ip(n.code)}catch{}if(!o)return[];let s=o.hasOwnProperty("type")&&o.type==="setting",a=o.hasOwnProperty("type")&&o.type==="command";if(s){let c=[],u=o.settings;if(!u)return c;let l="",d=!1;for(let p of Object.keys(u))c.some(f=>f.command?.arguments&&f.command.arguments[0].includes(`@id:${p}`))||(l+=`@id:${p} `,t.hasSetting(p)||(d=!0));return l=l.trimEnd(),l&&c.push({command:{command:"workbench.action.openSettings",arguments:[l],title:OP.t("Show in Settings Editor")},showCodeBlock:!0,failedValidation:d,codeBlock:"```json\n"+JSON.stringify(u,null,2)+"\n```"}),c}else if(a){let c=o.commands.command;if(!c)return[{command:void 0,showCodeBlock:!0,failedValidation:!1}];let u=o.commands.args,l=[];if(c==="workbench.extensions.search"||c==="workbench.extensions.installExtension"){let d=(Array.isArray(u)?u:[u]).filter(p=>typeof p=="string");if(d.length===1){let p=["featured","popular","recentlyPublished","recommended","updates","builtin","enabled","disabled","installed","workspaceUnsupported"];d[0].includes(":")&&!d[0].startsWith("@")?d[0]=`@${d[0]}`:p.includes(d[0])&&(d[0]=`@${d[0]}`)}return l.push({command:{command:"workbench.extensions.search",arguments:d,title:OP.t("Search Extension Marketplace")},showCodeBlock:!1,failedValidation:!1}),l}else{let d=t.getCommand(c);if(!d)continue;return l.push({command:{command:"workbench.action.quickOpen",arguments:[`>${d.originalLabel??""}`],title:l.length>1?OP.t('Show "{0}"',d.originalLabel??""):OP.t("Show in Command Palette")},showCodeBlock:!1,failedValidation:!1}),l}}else return[{command:void 0,showCodeBlock:!0,failedValidation:!1}]}return[]}var MP=class extends Ho{constructor(r,n,o,s,a,c){super(r,n,o);this.instantiationService=s;this.combinedEmbeddingIndex=a;this.workbenchService=c;this.linkification={disable:!0}}async createRenderer(r,n,o,s){return Be.create(this.instantiationService,n,pI,{endpoint:n,promptContext:r})}processResponsePanel(r,n,o,s,a){return new Xz(this.combinedEmbeddingIndex,this.workbenchService).processResponse(r,n,o,s,a)}};MP=w([b(3,K),b(4,Rl),b(5,jf)],MP);var Xz=class{constructor(e,r){this.combinedIndex=e;this.workbechService=r;this.stagedTextToApply="";this.appliedText="";this._incodeblock=!1}async processResponse(e,r,n,o,s){for await(let{delta:a}of n){if(s.isCancellationRequested)break;await this.applyDelta(a.text,o)}return this.appliedText}async processNonReporting(e,r){let n=Tfe(this.combinedIndex,e);for(let o of n)if(o.showCodeBlock&&r.markdown(o.codeBlock?o.codeBlock:e),o.command&&r.button(o.command),o.failedValidation){if((await this.workbechService.getAllCommands()).map(c=>c.command).includes(o.command.command))return;let a=o.showCodeBlock?A5.t("To apply this setting, an additional extension installation is needed."):A5.t("To execute this command, an additional extension installation is needed.");r.warning(a)}}async applyDelta(e,r){this.appliedText+=e,e=this.stagedTextToApply+e;let n=e.indexOf("```");if(this._incodeblock){let o=e.indexOf("```");o===-1?this.stagedTextToApply=e:(this._incodeblock=!1,e="\n```"+e.substring(0,o)+"```\n",await this.processNonReporting(e,r),this.stagedTextToApply="")}else if(n!==-1){this._incodeblock=!0;let o=e.indexOf("```",n+3);if(o!==-1)this._incodeblock=!1,r.markdown(e.substring(0,n)),await this.processNonReporting(e,r),r.markdown(e.substring(o+3));else{let s=e.substring(0,n);r.markdown(s)}}else r.markdown(e)}},_v=class{constructor(e,r){this.instantiationService=e;this.endpointProvider=r;this.id=_v.ID;this.locations=[2];this.description=A5.t("Ask questions about VS Code");this.commandInfo={allowsEmptyArgs:!1}}static{this.ID="vscode"}get intentDetectionInput(){let e="vscode_questions";return{functionName:e,sampleQuestion:"What is the command to open the integrated terminal?",modelDescription:"Looks up information about VS Code via commands, settings, and documentation to accomplish the given editor-specific task.",functionCallingBlurb:`If the user's message is related to commands or settings in Visual Studio Code, you should use the '${e}' function.`}}async invoke(e){let r=e.location,n=await this.endpointProvider.getEndpointForLocation(r);return this.instantiationService.createInstance(MP,this,r,n)}};_v=w([b(0,K),b(1,Se)],_v);SO.setIntents([new Me(Fl),new Me(xu),new Me(VI),new Me(Vg),new Me(JI),new Me(BI),new Me(o1),new Me(HI),new Me(bv),new Me(Hl),new Me(ba),new Me(Su),new Me(hv),new Me(qI),new Me(EI),new Me(cv),new Me(_v),new Me(fv),new Me(vv)]);var ZI=class{constructor(e){this.telemetryService=e;e.sendGHTelemetryEvent("extension.activate")}dispose(){this.telemetryService.sendGHTelemetryEvent("extension.deactivate")}};ZI=w([b(0,he)],ZI);var LBe=[Au(ZI)];function Au(t){return{create(e){return e.get(K).createInstance(t)}}}var Efe=LBe;var l$={};_n(l$,{create:()=>MBe});var Jz=H(Gt());var FP=class{constructor(e){this.kind="workspace";let r,n,o,s;e.getConfig(de.WorkspaceUseFilesVariable)?(r="files",n=Jz.t("Searches through the files in the workspace and pulls out relevant information for the query.")):(r="codebase",o="Codebase",s="folder",n=Jz.t("Searches through the codebase and pulls out relevant information for the query.")),this.variableInfo={name:r,fullName:o,icon:s,description:n,defaultEnablement:da||void 0}}async resolveContext(e,r,n,o){if(!r.message)return;let{messages:s,references:a,usedContext:c}=await ki(e.get(K),r.endpoint,b1,{promptContext:{chatVariables:new Vs([]),query:this.turnQueryIntoWorkspaceQuery(r.message),history:r.history??[],customInstructions:[]},include:{workspaceChunks:!0}},o,n);if(s.length>0)return{kind:this.kind,userMessages:s.map(u=>u.content),usedContext:c,references:a}}turnQueryIntoWorkspaceQuery(e){let r=e;return r.startsWith("@")&&(r=r.replace(/@\w+\s*/,"")),r=r.replaceAll(/\#files/gi,"files"),r}};FP=w([b(0,be)],FP);pn.register(FP);var OBe=require("path"),Zz=class{constructor(){this.kind="current-editor";this.variableInfo={name:"editor",description:"The visible source code in the active editor",fullName:"Current Editor",icon:"file-code",defaultEnablement:!0,registerTool:!0}}async resolveContext(e,r){let n=e.get(zt).activeTextEditor,o=n?.visibleRanges[0];if(o){let s="";n.selection.isSingleLine&&(s=`The cursor is on line: ${n.selection.start.line}`);let a=[`Excerpt from active file ${OBe.basename(n.document.uri.path)}, lines ${o.start.line+1} to ${o.end.line+1}:`,Pi(n.document.languageId,n.document.getText(o),!1),"",s].join(`
`),c=[{uri:n.document.uri,version:n.document.version,ranges:[o]}];return{kind:this.kind,userMessages:[a],usedContext:c,references:[new Ms.PromptReference({uri:n.document.uri,range:o})]}}}},ecr=pn.register(new Zz);var e$=class{constructor(){this.kind="current-selection-implementations"}async resolveContext(e,r,n,o){let{references:s,messages:a,usedContext:c}=await ki(e.get(K),r.endpoint,yu,{});return{kind:this.kind,references:s,userMessages:a.map(u=>u.content),usedContext:c}}},acr=pn.register(new e$);var t$=class{constructor(){this.kind="debug-console-output";this.variableInfo={name:"debugConsole",description:"The output in the debug console",defaultEnablement:!1}}async resolveContext(e){return{kind:this.kind,userMessages:[`Debug console output:
`+e.get(RI).consoleOutput]}}},pcr=pn.register(new t$);var r$=class{constructor(){this.kind="diagnostics"}async resolveContext(e,r,n){let o=r.documentContext;if(!o)return;let s=dv(e.get(To),o.document.uri,o.selection,r.message),{messages:a,usedContext:c}=await ki(e.get(K),r.endpoint,Pu,{documentContext:o,diagnostics:s});return{kind:this.kind,userMessages:a.map(u=>u.content),usedContext:c}}},xcr=pn.register(new r$);var n$=H(nt());var N5="vscodeAPI",D5=class extends X{constructor(r,n){super(r);this.accessor=n}static{this.variableInfo={name:N5,description:"Use VS Code API references to answer questions about VS Code extension development.",defaultEnablement:!0}}async prepare(r,n,o){let s=this.accessor.get(Go),a=this.accessor.get(UP),c=await this.accessor.get(Se).getEmbeddingsEndpoint("ada");if(await a.updateIndex(),o.isCancellationRequested)return;let u=await s.computeEmbeddings(c,[this.props.query],{},o);if(!o.isCancellationRequested&&u&&u.embeddings.length>0){let l=a.nClosestValues(u.embeddings[0],5,.7);if(l.length)return{snippets:l}}}render(r,n){return vscpp(vscppf,null,r&&r.snippets.length>0&&vscpp(n$.UserMessage,{priority:900},"Below are some potentially relevant code samples related to VS Code extension development. You may use information from these samples to help you answer the question if you believe it is relevant."),r&&r.snippets.map(o=>vscpp(n$.UserMessage,{priority:900},o,vscpp("br",null))))}};D5=w([b(1,st)],D5);var eC=class{constructor(e,r){let n=Jb(e.getEditorInfo().version);this.embeddingsCache=r.createInstance(Ac,1,"api",n,"api")}async updateIndex(){this.apiChunks=await this.embeddingsCache.getCache()}nClosestValues(e,r,n=0){if(!this.apiChunks)return[];let o=this.apiChunks.map(s=>{if(!s.embedding)return{text:s.text,similarity:0};let a=dg(e,s.embedding);return{text:this.toContextString(s),similarity:a}});return o=o.filter(s=>s.similarity>n),o.sort((s,a)=>a.similarity-s.similarity),o.slice(0,r).map(s=>s.text)}toContextString(e){return e.type==="code"?`API Reference Code Snippet from vscode.d.ts:
${Pi(e.lang,e.text)}`:e.type==="command"?`${e.text}`:e.type==="documentationCodeBlock"?`Example code from VS Code documentation:
${Pi(e.lang,e.text)}`:""}};eC=w([b(0,St),b(1,K)],eC);var UP=ie("IApiEmbeddingsIndex"),i$=class{constructor(){this.kind="extension-api";this.variableInfo={name:N5,icon:"references",fullName:"VS Code API",description:"Use VS Code API references to answer questions about VS Code extension development.",defaultEnablement:!0,registerTool:"canBeInvokedManually"}}async resolveContext(e,r,n){if(!r.message)return;let o=r.message.replace(`#${N5}`,"").trim(),s=e.get(UP);if(await s.updateIndex(),n.isCancellationRequested)return;let a=e.get(Go),u=await e.get(Se).getEmbeddingsEndpoint("ada"),l=await a.computeEmbeddings(u,[o],{},n);if(!n.isCancellationRequested&&l&&l.embeddings.length>0){let d=s.nClosestValues(l.embeddings[0],5,.7);if(d.length)return{kind:this.kind,userMessages:[`Below are some potentially relevant code samples related to VS Code extension development. You may use information from these samples to help you answer the question if you believe it is relevant.
`,...d]}}}},Vcr=pn.register(new i$);var wfe=H(Gt()),Rfe=H(require("path"));var o$=class{constructor(){this.kind="git-metadata";this.variableInfo={name:"git",description:wfe.t("Information about the current git repository"),defaultEnablement:!1}}async resolveContext(e,r,n){let o=e.get(Ve),a=e.get(xo).repositories,c=o.getWorkspaceFolders();if(a.length===0||!c)return;if(c.length>1){let l=r.documentContext?.document.uri??e.get(zt).activeTextEditor?.document.uri;if(l){let d=o.getWorkspaceFolder(l);if(d){let p=c.findIndex(f=>f.toString()===d.toString());p!==-1&&(a=[a[p]],c=[c[p]])}}}let u=[];for(let l=0;l<a.length;l++){if(n.isCancellationRequested)return;let d=a[l],p=c[l];if(!d)continue;let f=[];f.push(`Workspace Folder: ${Rfe.basename(p.path)}`),f.push("```"),d.headBranchName?(f.push(`Current Branch name: ${d.headBranchName}`),f.push(`Upstream: ${d.upstreamBranchName?d.upstreamBranchName:"none"}`)):f.push("Detached HEAD?: yes"),f.push(`Is currently rebasing?: ${d.isRebasing?"yes":"no"}`),f.push(`Remotes: ${(d.remotes??[]).join(", ")}`),f.push("```"),u.push(f.join(`
`))}return{kind:this.kind,userMessages:[`Metadata about the current git repository:
`+u.join(`
`)]}}},Xcr=pn.register(new o$);var s$=class{constructor(){this.kind="terminal-buffer";this.variableInfo={name:"terminalBuffer",description:"The active terminal's buffer",defaultEnablement:!1}}async resolveContext(e){let r=e.get(Zn).terminalBuffer;return{kind:this.kind,userMessages:[`The active terminal's buffer:
`+r]}}},rur=pn.register(new s$);var a$=class{constructor(){this.kind="terminal-last-command";this.variableInfo={name:"terminalLastCommand",description:"The active terminal's last run command",fullName:"Terminal Last Command",icon:"terminal",defaultEnablement:!0,registerTool:!0}}async resolveContext(e){let r=e.get(Zn).terminalLastCommand;if(!r)return;let n=[];r.commandLine&&(n.push("The following is the last command run in the terminal:"),n.push(r.commandLine)),r.cwd&&(n.push("It was run in the directory:"),n.push(typeof r.cwd=="object"?r.cwd.toString():r.cwd)),r.output&&(n.push("It has the following output:"),n.push(r.output));let o=n.join(`
`);return{kind:this.kind,userMessages:[`The active terminal's last run command:
`+o]}}},aur=pn.register(new a$);var c$=class{constructor(){this.kind="terminal-selection";this.variableInfo={name:"terminalSelection",icon:"terminal",fullName:"Terminal Selection",description:"The active terminal's selection",defaultEnablement:!0,registerTool:!0}}async resolveContext(e){let r=e.get(Zn).terminalSelection;return{kind:this.kind,userMessages:[`The active terminal's selection:
`+r]}}},pur=pn.register(new c$);var u$=class{constructor(){this.kind="terminal-shell-type"}async resolveContext(e){let r=e.get(Zn).terminalShellType;return{kind:this.kind,userMessages:[`The active terminal's shell type:
`+r]}}},vur=pn.register(new u$);function MBe(){}var d$={};_n(d$,{create:()=>FBe});function FBe(t){let e=new ht;return e.add(pn.initialize(t.get(K))),e}var p$={};_n(p$,{create:()=>UBe});function UBe(t){let e=t.get(oe);t.get(Ve).ensureWorkspaceIsFullyLoaded().catch(r=>e.public.error(r))}var BBe=[...Efe,p$,l$,d$],kfe=BBe;var g$={};_n(g$,{create:()=>qBe});var ky=require("vscode");var Qo=require("vscode");async function L5(t,e,r){let n=t?.repositories;if(!n)return r.internal.debug("No git repositories found"),!1;let o=n.map(ES).filter(a=>a);return(await Promise.all(o.map(a=>{let[c,u]=a.split("/");return e.isAvailable(c,u)}))).every(a=>a)}var Afe="github.copilotChat.signIn",Dfe="github.copilotChat.signInGHE",Nfe="github.copilotChat.signInChoose";async function Lfe(t,e){let r=t.get(xo),n=t.get(uu),o=t.get(Nt);if(await L5(r,n,t.get(oe))){await o.getAnyGitHubSession(e?{forceNewSession:!0}:{createIfNone:!0});return}await o.getPermissiveGitHubSession({forceNewSession:{learnMore:Ye.parse("https://aka.ms/copilotRepoScope")}})}async function f$(t,e){let r=t.get(be);if(r.getConfig(de.AuthProvider)!=="github")try{await r.setConfig(de.AuthProvider,"github")}catch(o){console.error(o)}await Lfe(t,e)}async function m$(t,e){let r=t.get(be);if(r.getConfig(de.AuthProvider)!=="github-enterprise")try{await r.setConfig(de.AuthProvider,"github-enterprise")}catch(a){console.error(a)}let o=Qo.workspace.getConfiguration("github-enterprise");if(!o.get("uri")){let a=!1,c=await Qo.window.showInputBox({prompt:Qo.l10n.t("What is your GHE.com instance?"),placeHolder:Qo.l10n.t('i.e. "octocat" or "https://octocat.ghe.com"...'),validateInput(l){if(a=!1,!!l){if(/^[a-zA-Z\-_]+$/.test(l))return a=!0,{message:Qo.l10n.t({message:"Will resolve to {0}",args:[`https://${l}.ghe.com`],comment:"The {0} will be replaced with a URL"}),severity:Qo.InputBoxValidationSeverity.Info};if(!/^(https:\/\/)?([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.ghe\.com\/?$/.test(l))return{message:Qo.l10n.t('Please enter a valid GHE.com instance (i.e. "octocat" or "https://octocat.ghe.com")'),severity:Qo.InputBoxValidationSeverity.Error}}}});if(!c)return;let u=c;a?u=`https://${u}.ghe.com`:c.toLowerCase().startsWith("https://")||(u="https://"+c),await o.update("uri",u,Qo.ConfigurationTarget.Global)}await Lfe(t,e)}async function Ofe(t,e){let r=await Qo.window.showQuickPick([{label:Qo.l10n.t("Sign in to GitHub.com"),providerId:"github"},{label:Qo.l10n.t("Sign in to GHE.com"),providerId:"github-enterprise"}],{placeHolder:Qo.l10n.t("Sign in to...")});r&&(r.providerId==="github"?await f$(t,e):await m$(t,e))}var O5=require("vscode");async function Mfe(t){let e=new h$(t);return await e.run(),e}var h$=class{constructor(e){this.accessor=e;this.authenticationService=this.accessor.get(Nt);this.logService=this.accessor.get(oe);this.ghRepoService=this.accessor.get(uu);this.gitService=this.accessor.safeGet(xo);this.vscodeExtensionContext=this.accessor.get(jt);this.disposables=new ht}async run(){await this.waitForChatEnabled(),!(!this.gitService||await L5(this.gitService,this.ghRepoService,this.logService)||(this.registerListeners(),await this.authenticationService.getPermissiveGitHubSession({silent:!0})))&&await this.showPrompt()}async waitForChatEnabled(){try{if((await this.authenticationService.getCopilotToken()).isChatEnabled())return}catch(e){this.logService.public.error(e,"Failed to get copilot token")}await Ed.toPromise(Ed.filter(this.authenticationService.onDidAuthenticationChange,()=>this.authenticationService.copilotToken?.isChatEnabled()??!1))}registerListeners(){this.disposables.add(this.authenticationService.onDidAuthenticationChange(async()=>{if(!this.authenticationService.permissiveGitHubSession)if(this.authenticationService.anyGitHubSession)await this.showPrompt();else{this.vscodeExtensionContext.globalState.update("copilot.shownPermissiveTokenModal",!1);return}}))}async showPrompt(){try{let e=this.vscodeExtensionContext.globalState.get("copilot.shownPermissiveTokenModal",!1),r={};e||(r.forceNewSession={detail:O5.l10n.t("To show you more relevant Copilot Chat results, we need permission to read the contents of your repository on GitHub."),learnMore:O5.Uri.parse("https://aka.ms/copilotRepoScope")},this.vscodeExtensionContext.globalState.update("copilot.shownPermissiveTokenModal",!0)),await this.authenticationService.getPermissiveGitHubSession(r)&&this.logService.public.debug("Got permissive GitHub token")}catch(e){this.logService.public.error(e,"Failed to get permissive GitHub token"),await this.authenticationService.getPermissiveGitHubSession({})}}dispose(){this.disposables.dispose()}};function qBe(t){let e=t.get(st),r;return Mfe(e).then(n=>r=n),ky.Disposable.from(ky.commands.registerCommand(Afe,n=>f$(e,n)),ky.commands.registerCommand(Dfe,n=>m$(e,n)),ky.commands.registerCommand(Nfe,n=>Ofe(e,n)),new ky.Disposable(()=>r?.dispose()))}var b$={};_n(b$,{create:()=>WBe});var Du=H(require("vscode"));function v$(t){return Ye.isUri(t)}var jBe="vscode-chat-code-block",HBe=[/^\n```(typescript|javascript|tsx|jsx)\S*\nany\n```\n$/i],VBe=[new Set(["typescript","javascript","typescriptreact","javascriptreact"]),...Array.from(sy.keys(),t=>new Set([t]))],BP=class{constructor(e,r){this.accessor=e;this.telemetryService=r}async provideDefinition(e,r,n){return this.goTo("vscode.experimental.executeDefinitionProvider_recursive",e,r,n)}async provideImplementation(e,r,n){return this.goTo("vscode.experimental.executeImplementationProvider_recursive",e,r,n)}async provideTypeDefinition(e,r,n){return this.goTo("vscode.experimental.executeTypeDefinitionProvider_recursive",e,r,n)}async provideHover(e,r,n){let o=await this.execHover(e.uri,r),s=this.filterOutGenericHovers(o);if(s?.length)return this.convertHover(s);if(n.isCancellationRequested)return;let a=await this.getReferencesContext(e,r,n);if(!(!a||n.isCancellationRequested)){for(let c of a.wordMatches){let u=await this.execHover(c.uri,c.range.start);if(n.isCancellationRequested)return;if(u?.length)return this.convertHover(u)}return this.convertHover(o)}}async execHover(e,r){return Du.commands.executeCommand("vscode.experimental.executeHoverProvider_recursive",e,r)}convertHover(e){return e.length?new Du.Hover(e.flatMap(r=>r.contents),e[0].range):void 0}filterOutGenericHovers(e){return e.filter(r=>r.contents.some(n=>{if(typeof n=="string")return n.length;if(!n.value.length)return!1;for(let o of HBe)if(o.test(n.value))return!1;return!0}))}async goTo(e,r,n,o){let s=await AS(r.uri.fragment);if(o.isCancellationRequested)return;this.telemetryService.sendMSFTTelemetryEvent("codeBlock.action.goTo",{languageId:r.languageId,command:e,codeBlockId:s});let a=await this.executeGoToInChatBlocks(e,r,n);if(a?.length)return a;if(!o.isCancellationRequested)return this.executeGoToInChatReferences(e,r,n,o)}async executeGoToInChatBlocks(e,r,n){return(await this.executeGoTo(e,r.uri,n))?.map(s=>"uri"in s?{targetRange:s.range,targetUri:s.uri}:s)}async executeGoTo(e,r,n){return Du.commands.executeCommand(e,r,n)}async executeGoToInChatReferences(e,r,n,o){let s=await this.getReferencesContext(r,n,o);if(!(!s||o.isCancellationRequested))for(let a of s.wordMatches){let c=await this.executeGoTo(e,a.uri,a.range.start);if(o.isCancellationRequested)return;if(c)return c.map(u=>"uri"in u?{targetRange:u.range,targetUri:u.uri,originSelectionRange:s.wordRange}:{targetSelectionRange:u.targetSelectionRange,targetRange:u.targetRange,targetUri:u.targetUri,originSelectionRange:s.wordRange})}}async getReferencesContext(e,r,n){let o=this.getReferences(e);if(!o?.length)return;let s=e.getWordRangeAtPosition(r);if(!s)return;let a=e.getText(s),c=await A3(this.accessor,o,a,{},n);return{wordRange:s,wordMatches:c}}getReferences(e){let r=this.extractReferences(e),n=Ko(e),o=zBe(n);return o?r.filter(s=>{let a=GBe(s);if(!a)return!1;let c=ha(a);return!!o.has(c.languageId)}):r}extractReferences(e){try{let r=decodeURIComponent(e.uri.fragment);return JSON.parse(r).references.map(o=>"range"in o?new Ms.PromptReference(new Ri(Gr.from(o.uri),new Qe(o.range.startLineNumber-1,o.range.startColumn-1,o.range.endLineNumber-1,o.range.endColumn-1))):new Ms.PromptReference(Gr.from(o.uri)))}catch{return[]}}};BP=w([b(0,st),b(1,he)],BP);function GBe(t){return v$(t.anchor)?t.anchor:"uri"in t.anchor?t.anchor.uri:"value"in t.anchor&&v$(t.anchor.value)?t.anchor.value:void 0}function zBe(t){return VBe.find(e=>e.has(t.languageId))}function Ffe(t){let e=t.get(K).createInstance(BP),r={scheme:jBe,exclusive:!0};return Du.Disposable.from(Du.languages.registerDefinitionProvider(r,e),Du.languages.registerTypeDefinitionProvider(r,e),Du.languages.registerImplementationProvider(r,e),Du.languages.registerHoverProvider(r,e))}function WBe(t){return Ffe(t)}var y$={};_n(y$,{create:()=>KBe});var Bc=require("vscode");var xv=ie("ChatVariableService"),tC=class{constructor(e){this._variableEnablements=e.getConfigMixedWithDefaults(de.ConversationVariablesEnablements)}isVariableEnabled(e){return typeof this._variableEnablements[e.name]=="boolean"?this._variableEnablements[e.name]:typeof e.defaultEnablement=="boolean"?e.defaultEnablement:!!this._variableEnablements["*"]}getVariables(){let e=[];for(let r of pn.contextResolvers)r.variableInfo&&this.isVariableEnabled(r.variableInfo)&&e.push({name:r.variableInfo.name,fullName:r.variableInfo.fullName,icon:r.variableInfo.icon,kind:r.kind,description:r.variableInfo.description,registerTool:r.variableInfo.registerTool,resolve:r.resolveContext.bind(r)});return e}getVariable(e){return this.getVariables().find(r=>r.name===e)}};tC=w([b(0,be)],tC);function KBe(t){let e=t.get(Se),r=t.get(xv),n=t.get(st),o=new ht;for(let s of r.getVariables())s.registerTool!=="canBeInvokedManually"&&o.add(Bc.chat.registerChatVariableResolver(`copilot.${s.name}`,s.name,s.description??"",void 0,s.name==="codebase",{async resolve(a,c,u){return[]},resolve2:async(a,c,u,l)=>{let d={endpoint:await e.getChatEndpoint("gpt-3.5-turbo"),message:c.prompt},p={report(m){u.push(m)}},f=await s.resolve(n,d,l,p);return f?(f.references?.forEach(m=>{"variableName"in m.anchor||u.reference(m.anchor)}),[{level:Bc.ChatVariableLevel.Full,value:f.userMessages.join(`

`),description:""}]):[]}},s.fullName,s.icon?new Bc.ThemeIcon(s.icon):void 0));return o.add(YBe(t)),o}function YBe(t){return Bc.Disposable.from(Bc.commands.registerCommand("github.copilot.chat.attachSelection",()=>{Bc.commands.executeCommand("workbench.action.chat.attachSelection")}),Bc.commands.registerCommand("github.copilot.chat.attachFile",()=>{Bc.commands.executeCommand("workbench.action.chat.attachFile")}))}var zP=require("vscode");var Hfe=require("vscode");var Sv=class{constructor(){this._inFlightPromises=new Map}getOrCreate(e,r){let n=this._inFlightPromises.get(e);if(n)return n;let o=r().finally(()=>this._inFlightPromises.delete(e));return this._inFlightPromises.set(e,o),o}};var ya=require("vscode");var Ufe="You are not signed in to GitHub. Please sign in to use Copilot.";function M5(t){return t.getConfig(de.AuthProvider)==="github-enterprise"?"github-enterprise":"github"}async function Bfe(t,e,r,n={}){let o=await ya.authentication.getAccounts(t);if(!o.length)return await ya.authentication.getSession(t,e,n);let s=new Set(o.map(l=>l.label)),a=ya.workspace.getConfiguration(),c=a.get("github.copilot.preferredAccount")||void 0;if(n.forceNewSession){let l=await ya.authentication.getSession(t,e,{...n,forceNewSession:n.forceNewSession,clearSessionPreference:!0});return(c||s.size>1)&&await a.update("github.copilot.preferredAccount",l.account.label,ya.ConfigurationTarget.Global),l}let u=c;if(!u&&s.size===1&&(u=o[0].label),u){let l=o.find(d=>d.label===u);if(l){let d=await r(l);if(d)return d}}if(n.createIfNone){let l=await ya.authentication.getSession(t,e,{forceNewSession:!0,clearSessionPreference:!0});return s.add(l.account.label),(c||s.size>1)&&await a.update("github.copilot.preferredAccount",l.account.label,ya.ConfigurationTarget.Global),l}}function F5(t,e){let r=M5(t);return Bfe(r,pH,async n=>{let o=await ya.authentication.getSession(r,p4,{silent:!0,account:n});if(o)return o;let s=await ya.authentication.getSession(r,pH,{silent:!0,account:n});if(s)return s;let a=await ya.authentication.getSession(r,Gae,{silent:!0,account:n});if(a)return a},e)}function qfe(t,e){let r=M5(t);return Bfe(r,p4,async n=>await ya.authentication.getSession(r,p4,{silent:!0,account:n}),e)}var jfe=!1,qP=class extends Error{},jP=class extends Error{},HP=class extends Error{},VP=class extends Error{},GP=class extends Error{},rC=class extends _S{constructor(r,n,o,s,a,c){super(new ag(o,s),r,n,o,s,a);this.configurationService=c;this._taskSingler=new Sv}async getCopilotToken(r){if(!this.copilotToken||this.copilotToken.expires_at<ug()||r)try{this._logService.internal.debug(`Getting CopilotToken (force: ${r})...`),this.copilotToken=await this._authShowWarnings(),this._logService.internal.debug(`Got CopilotToken (force: ${r}).`)}catch(n){throw this._logService.internal.debug(`Getting CopilotToken (force: ${r}) threw error: ${n}`),this.copilotToken=void 0,n}return new Kb(this.copilotToken)}async _auth(){let r=await F5(this.configurationService,{silent:!0});if(!r)return this._logService.public.warn("GitHub login failed"),this._telemetryService.sendGHTelemetryErrorEvent("auth.github_login_failed"),{kind:"failure",reason:"GitHubLoginFailed"};this._logService.public.info(`Logged in as ${r.account.label}`);let n=await this.authFromGitHubToken(r.accessToken);return n.kind==="success"&&this._logService.public.info(`Got Copilot token for ${r.account.label}`),n}async _authShowWarnings(){let r=await this._taskSingler.getOrCreate("auth",()=>this._auth());if(r.kind==="failure"&&r.reason==="NotAuthorized"){let n=r.message;if(n?.includes("No access to GitHub Copilot found"))throw new qP(n??"User not authorized");if(n?.includes("Your subscription has ended"))throw new jP(n);if(n?.includes("Contact Support."))throw new HP(n)}if(r.kind==="failure"){let n=r.message;if(n?.includes("Please contact your enterprise admin to enable your managed account for Copilot for Business"))throw new VP(n)}if(r.kind==="failure"&&r.reason==="HTTP401"){let n="Your GitHub token is invalid. Please sign out from your GitHub account using the VS Code accounts menu and try again.";throw jfe||(jfe=!0,Hfe.window.showWarningMessage(n)),Error(n)}if(r.kind==="failure"&&r.reason==="GitHubLoginFailed")throw Error("GitHubLoginFailed");if(r.kind==="failure"&&r.reason==="RateLimited")throw Error("Your account has exceeded GitHub's API rate limit. Please try again later.");if(r.kind==="failure")throw Error("Failed to get copilot token");if(r.kind==="success"&&r.chat_enabled===!1)throw new GP("Copilot Chat is disabled");return r}};rC=w([b(0,oe),b(1,he),b(2,Xr),b(3,nn),b(4,St),b(5,be)],rC);var Iv={Activated:"github.copilot-chat.activated",Offline:"github.copilot.offline",IndividualDisabled:"github.copilot.interactiveSession.individual.disabled",IndividualExpired:"github.copilot.interactiveSession.individual.expired",ContactSupport:"github.copilot.interactiveSession.contactSupport",EnterpriseDisabled:"github.copilot.interactiveSession.enterprise.disabled",CopilotChatDisabled:"github.copilot.interactiveSession.chatDisabled"},QBe="github.copilot.chat.debug",nC=class extends dt{constructor(r,n,o,s){super();this._authenticationService=r;this._telemetryService=n;this._fetcherService=o;this._logService=s;this._inspectContext().catch(console.error),this._register(r.onDidAuthenticationChange(async()=>await this._inspectContext())),this._register(zP.commands.registerCommand("github.copilot.offline",async()=>await this._inspectContext()))}async _inspectContext(){let r=Object.values(Iv),n,o,s=!1;try{let a=await this._authenticationService.getCopilotToken();s=!!(a.isInternal&&a.isVscodeTeamMember),o=Iv.Activated}catch(a){n=a;let c=a.message||a,u=Jn.createAndMarkAsIssued({reason:c});this._telemetryService.sendGHTelemetryErrorEvent("activationFailed",u.properties,u.measurements);let l=c==="GitHubLoginFailed"?Ufe:`GitHub Copilot could not connect to server. Extension activation failed: "${c}"`;this._logService.public.error(l)}this._fetcherService.isDNSLookupFailedError(n)?o=Iv.Offline:n instanceof qP?o=Iv.IndividualDisabled:n instanceof jP?o=Iv.IndividualExpired:n instanceof VP?o=Iv.EnterpriseDisabled:n instanceof HP?o=Iv.ContactSupport:n instanceof GP&&(o=Iv.CopilotChatDisabled),o&&zP.commands.executeCommand("setContext",o,!0),zP.commands.executeCommand("setContext",QBe,s);for(let a of r)a!==o&&zP.commands.executeCommand("setContext",a,!1)}};nC=w([b(0,Nt),b(1,he),b(2,nn),b(3,oe)],nC);var Eo=H(require("vscode"));var B5=ie("IBlockedExtensionService"),U5=class{constructor(){this.blockedExtensions=new Map}reportBlockedExtension(e,r){this.blockedExtensions.has(e)&&clearTimeout(this.blockedExtensions.get(e));let n=setTimeout(()=>{this.blockedExtensions.delete(e)},r*1e3);this.blockedExtensions.set(e,n)}isExtensionBlocked(e){return this.blockedExtensions.has(e)}};var Tv=H(nt()),Cv=H(require("vscode"));var $P=class extends X{render(){let e=[],r=[];for(let n of this.props.messages)if(n.role===Cv.LanguageModelChatMessageRole.System)e.push(n.content);else if(n.role===Cv.LanguageModelChatMessageRole.Assistant){let o=n.content2.find(a=>typeof a=="string")??n.content,s=n.content2.filter(a=>a instanceof Cv.LanguageModelChatResponseToolCallPart);r.push(vscpp(Tv.AssistantMessage,{name:n.name,toolCalls:s.map(a=>({id:a.toolCallId,type:"function",function:{name:a.name,arguments:a.parameters}}))},o))}else n.role===Cv.LanguageModelChatMessageRole.User&&n.content2.forEach(o=>{o instanceof Cv.LanguageModelChatMessageToolResultPart?r.push(vscpp(Tv.FunctionMessage,{name:o.toolCallId},o.content)):typeof o=="string"&&r.push(vscpp(Tv.UserMessage,{name:n.name},o))});return vscpp(vscppf,null,vscpp(Tv.SystemMessage,null,this.props.noSafety?e:vscpp(vscppf,null,vscpp(Rt,null),vscpp(Vi,null),vscpp("br",null),e.join(`
`))),r)}};var iC=class{constructor(e,r,n,o,s,a){this._logService=e;this._instantiationService=r;this._authenticationService=n;this._endpointProvider=o;this._embeddingsComputer=s;this._vsCodeExtensionContext=a;this.id="languageModelAccess";this._store=new ht;if(this._vsCodeExtensionContext.extensionMode===au.Test){this._logService.public.warn("[LanguageModelAccess] LanguageModels and Embeddings are NOT AVAILABLE in test mode.");return}this.activationBlocker=Promise.all([this._registerLanguageModels(),this._registerEmbeddings()])}dispose(){this._store.dispose()}async _registerLanguageModels(){let e=new Map,r=async()=>{let o=await this._getAuthSession(),s=new Map,a=o?await this._endpointProvider.getAllChatEndpoints():[],c=new Set;this._logService.public.debug("[LanguageModelAccess] UPDATING language models");for(let u of a){if(this._store.isDisposed)break;if(c.has(u.family))continue;c.add(u.family);let l=e.get(u.model);if(l){s.set(u.model,l);continue}let d=await Be.create(this._instantiationService,u,$P,{noSafety:!1,messages:[]}).countTokens(),p={vendor:"copilot",name:u.name,family:u.family,version:u.version,maxInputTokens:u.modelMaxPromptTokens-d-xae,maxOutputTokens:4096/2,auth:o&&{label:o.account.label}},f=this._instantiationService.createInstance(WP,u,p),m=Eo.chat.registerChatResponseProvider(u.model,f,p);s.set(u.model,{endpoint:u,dispo:m}),this._logService.public.debug(`[LanguageModelAccess] ADDED language model ${u.model}`)}for(let[u,l]of e)s.has(u)||(l.dispo.dispose(),this._logService.public.debug("[LanguageModelAccess] REMOVED language model "+u));e=s,this._store.isDisposed||(n=setTimeout(r,1e3*60*15))},n;await r(),this._store.add(this._authenticationService.onDidAuthenticationChange(()=>r())),this._store.add(qa(()=>{clearInterval(n);for(let o of e.values())o.dispo.dispose()}))}async _registerEmbeddings(){let e=this._store.add(new Mb);await(async()=>{if(e.clear(),!await this._getAuthSession())return;let n=this._embeddingsComputer,o=await this._endpointProvider.getEmbeddingsEndpoint("ada");e.value=Eo.lm.registerEmbeddingsProvider(`copilot.${o.model}`,new class{async provideEmbeddings(s,a){let c=await n.computeEmbeddings(o,s,{parallelism:2},a);if(!c)throw new Error("Failed to compute embeddings");return c.embeddings.map(u=>({values:u.slice(0)}))}})})()}async _getAuthSession(){try{await this._authenticationService.getCopilotToken()}catch(r){this._logService.public.warn("[LanguageModelAccess] LanguageModel/Embeddings are not available without auth token"),this._logService.public.error(r);return}let e=this._authenticationService.anyGitHubSession;if(!e){this._logService.public.error("[LanguageModelAccess] Auth token not present when we expected it to be");return}return e}};iC=w([b(0,oe),b(1,K),b(2,Nt),b(3,Se),b(4,Go),b(5,jt)],iC);var WP=class extends dt{constructor(r,n,o,s,a,c,u,l){super();this._endpoint=r;this._metadata=n;this._expService=o;this._telemetryService=s;this._chatMLFetcher=a;this._tokenizerProvider=c;this._blockedExtensionService=u;this._instantiationService=l;this._onDidReceiveLanguageModelResponse2=this._register(new Yt);this.onDidReceiveLanguageModelResponse2=this._onDidReceiveLanguageModelResponse2.event;this._register(this._chatMLFetcher.onDidMakeChatMLRequest(({model:d,source:p,tokenCount:f})=>{d===this._endpoint.model&&this._onDidReceiveLanguageModelResponse2.fire({extensionId:p?.extensionId??Ud,participant:p?.agent,tokenCount:f})}))}async _provideLanguageModelResponse(r,n,o,s,a){let c=Eo.extensions.getExtension(o,!0);if(!c||typeof c.packageJSON.version!="string")throw new Error("Invalid extension information");let u=c.packageJSON.version,l=Eo.l10n.t("The extension has been temporarily blocked due to making too many requests. Please try again later.");if(this._blockedExtensionService.isExtensionBlocked(o))throw Eo.LanguageModelError.Blocked(l);let d=this._expService.getTreatmentVariable("vscode","copilotchat.languageModelControlList"),p=Vfe.extractCustomTokenLimit(d??"",o)??this._metadata.maxInputTokens,{messages:f,tokenCount:m}=await Be.create(this._instantiationService,this._endpoint,$P,{noSafety:!1,messages:r}).render();for(let _ of f)_.role==="assistant"&&_.tool_calls?.length&&(_.function_call={name:_.tool_calls[0].function.name,arguments:_.tool_calls[0].function.arguments},delete _.tool_calls);if(this._telemetryService.sendMSFTTelemetryEvent("languagemodelrequest",{extensionId:o,extensionVersion:u,model:this._endpoint.model},{tokenCount:m,tokenLimit:p}),f.length===0||m>p)throw new Error("Message exceeds token limit.");if(n.tools&&n.tools.length>128)throw new Error("Cannot have more than 128 tools per request.");if(n.toolChoice&&!n.tools?.some(_=>_.name===n.toolChoice))throw new Error("toolChoice not found in tools list.");let h=new Proxy(this._endpoint,{get:function(_,x,S){return x==="getExtraHeaders"?function(){return{..._.getExtraHeaders?.()??{},"x-onbehalf-extension-id":`${o}/${u}`}}:Reflect.get(_,x,S)}}),g=_$.Default.convert(n.modelOptions??{}),v={messageSource:`api.${o}`};g.functions=n.tools?.map(_=>({name:_.name,description:_.description,parameters:_.parametersSchema})),g.function_call=n.toolChoice?{name:n.toolChoice}:void 0;let y=await this._chatMLFetcher.fetchMany("copilotLanguageModelWrapper",f,s,a,3,h,{extensionId:o},g,v,{intent:!0});if(y.type!=="success")throw y.type==="extensionBlocked"?(this._blockedExtensionService.reportBlockedExtension(o,y.retryAfter),Eo.LanguageModelError.Blocked(l)):new Error(y.reason);this._telemetryService.sendInternalMSFTTelemetryEvent("languagemodelrequest",{extensionId:o,extensionVersion:u,requestid:y.requestId,query:f[f.length-1].content,model:this._endpoint.model},{tokenCount:m,tokenLimit:p})}async provideLanguageModelResponse2(r,n,o,s,a){let c=async(u,l,d)=>{if(d.text&&s.report({index:l,part:new Eo.LanguageModelChatResponseTextPart(d.text)}),d.copilotFunctionCalls)for(let p of d.copilotFunctionCalls)s.report({index:l,part:new Eo.LanguageModelChatResponseToolCallPart(p.name,p.name,p.arguments)})};return this._provideLanguageModelResponse(r,n,o,c,a)}async provideLanguageModelResponse(r,n,o,s,a){let c=async(u,l,d)=>{s.report({index:l,part:d.text})};return this._provideLanguageModelResponse(r,{modelOptions:n},o,c,a)}async provideTokenCount(r){if(typeof r=="string")return this._tokenizerProvider.acquireTokenizer(this._endpoint).tokenLength(r);{let s={role:new Map([[Eo.LanguageModelChatMessageRole.Assistant,"assistant"],[Eo.LanguageModelChatMessageRole.User,"user"],[Eo.LanguageModelChatMessageRole.System,"system"]]).get(r.role)??"user",content:r.content};return this._tokenizerProvider.acquireTokenizer(this._endpoint).countMessageTokens(s)}}};WP=w([b(2,wt),b(3,he),b(4,Ct),b(5,yr),b(6,B5),b(7,K)],WP);var Vfe;(e=>{function t(r,n){let o=r.indexOf(n);if(o<0)return;let s=o+n.length,a=r.indexOf(",",s);a<0&&(a=r.length);let c=Number(r.substring(s,a));if(!isNaN(c))return c*1e3}e.extractCustomTokenLimit=t})(Vfe||={});function XBe(...t){return e=>t.some(r=>r(e))}var _$=class t{constructor(e){this._description=e}static{this._defaultDesc={stop:XBe(lL,wR),temperature:tS,max_tokens:tS,frequency_penalty:tS,presence_penalty:tS}}static{this.Default=new t({...this._defaultDesc})}convert(e){let r={};for(let n in this._description){let o=this._description[n],s=e[n];s!=null&&o(s)&&(r[n]=s)}return r}};var G5=H(require("path")),QP=H(require("util")),$e=require("vscode");var q5=class{constructor(){this.logprobs=[];this.top_logprobs=[];this.text=[];this.newText=[];this.tokens=[];this.text_offset=[]}append(e){e.text&&(this.text.push(e.text),this.newText.push(e.text)),e.delta?.content&&(this.text.push(e.delta.content),this.newText.push(e.delta.content)),e.delta?.function_call&&(this.text.push(e.delta.function_call.arguments),this.newText.push(e.delta.function_call.arguments)),e.logprobs&&(this.tokens.push(e.logprobs.tokens??[]),this.text_offset.push(e.logprobs.text_offset??[]),this.logprobs.push(e.logprobs.token_logprobs??[]),this.top_logprobs.push(e.logprobs.top_logprobs??[]))}flush(){let e=this.newText.join("");return this.newText=[],e}};function ZBe(t){let e=t.split(`
`),r=e.pop();return[e.filter(n=>n!==""),r]}var j5=class t{constructor(e,r,n,o,s,a){this.logService=e;this.telemetryService=r;this.expectedNumChoices=n;this.response=o;this.body=s;this.cancellationToken=a;this.requestId=C1(this.response);this.stats=new x$(this.expectedNumChoices);this.solutions={};this.completedFunctionCallIdxs=new Map;this.functionCalls={};this.functionCallName=void 0}static async create(e,r,n,o,s){let a=await o.body();return a.setEncoding("utf8"),new t(e,r,n,o,a,s)}async*processSSE(e=async()=>{}){try{yield*this.processSSEInner(e)}finally{this.cancel(),this.logService.public.info(`request done: requestId: [${this.requestId.headerRequestId}] model deployment ID: [${this.requestId.deploymentId}]`),this.logService.internal.debug(`request stats: ${this.stats}`)}}async*processSSEInner(e){let r="",n=!1;e:for await(let o of this.body){if(this.maybeCancel("after awaiting body chunk"))return;let[s,a]=ZBe(r+o.toString());r=a;let c=!1;for(let u of s){let l=u.slice(5).trim();if(l==="[DONE]"){yield*this.finishSolutions();return}let d;try{d=JSON.parse(l)}catch{this.logService.public.error(`Error parsing JSON stream data for request id ${this.requestId.headerRequestId}:${u}`),hm(this.telemetryService,`Error parsing JSON stream data for request id ${this.requestId.headerRequestId}:`,u);continue}if(d.copilot_confirmation&&eqe(d.copilot_confirmation)&&await e("",0,{text:"",copilotConfirmation:d.copilot_confirmation}),!d.choices){!d.copilot_references&&!d.copilot_confirmation&&(d.error!==void 0?(this.logService.public.error(`Error in response for request id ${this.requestId.headerRequestId}:${d.error.message}`),hm(this.telemetryService,`Error in response for request id ${this.requestId.headerRequestId}:`,d.error.message)):(this.logService.public.error(`Unexpected response with no choices or error for request id ${this.requestId.headerRequestId}`),hm(this.telemetryService,`Unexpected response with no choices or error for request id ${this.requestId.headerRequestId}`))),d.copilot_errors&&await e("",0,{text:"",copilotErrors:d.copilot_errors}),d.copilot_references&&await e("",0,{text:"",copilotReferences:d.copilot_references});continue}if(this.requestId.created===0&&(this.requestId=C1(this.response,d),this.requestId.created===0&&d.choices?.length&&(this.logService.public.error(`Request id invalid, should have "completionId" and "created": ${JSON.stringify(this.requestId)} ${this.requestId}`),hm(this.telemetryService,`Request id invalid, should have "completionId" and "created": ${JSON.stringify(this.requestId)}`,this.requestId))),this.allSolutionsDone())break e;for(let p=0;p<d.choices.length;p++){let f=d.choices[p],m={...f};delete m.index,delete m.content_filter_results,delete m.content_filter_offsets,this.logService.internal.trace("choice "+JSON.stringify(m)),this.stats.add(f.index),f.index in this.solutions||(this.solutions[f.index]=new q5);let h=this.solutions[f.index];if(h===null)continue;let g,v=async(_,x,S,I,E)=>(_&&(!Array.isArray(_)||!_.every(R=>kde(R)))&&(_=void 0),x&&(!Array.isArray(x)||!x.every(Pde))&&(x=void 0),g=await e(h.text.join(""),f.index,{text:h.flush(),codeVulnAnnotations:_,ipCitations:x,copilotReferences:S,copilotFunctionCalls:I,copilotErrors:E}),g!==void 0&&(n=!0),this.maybeCancel("after awaiting finishedCb"));if(f.delta?.copilot_annotations?.CodeVulnerability||f.delta?.copilot_annotations?.IPCodeCitations){if(await v()||!n&&(h.append(f),await v(f.delta.copilot_annotations.CodeVulnerability,f.delta?.copilot_annotations?.IPCodeCitations)))continue}else if(f.delta?.role==="function"){if(f.delta.content)try{let _=JSON.parse(f.delta.content);if(Array.isArray(_)&&await v(void 0,void 0,_))continue}catch(_){this.logService.public.error(`Error parsing function references: ${JSON.stringify(_)}`)}}else if(f.delta?.function_call)c=!0,this.functionCallName??=f.delta.function_call.name,this.functionCalls[this.functionCallName]??=new q5,this.functionCalls[this.functionCallName].append(f);else if((f.finish_reason==="function_call"||f.finish_reason==="stop")&&this.functionCallName){let _=this.functionCalls[this.functionCallName],x={name:this.functionCallName,arguments:_.flush()};this.completedFunctionCallIdxs.set(f.index,x);try{if(await v(void 0,void 0,void 0,[x]))continue}catch{}this.functionCalls[this.functionCallName]=null,this.functionCallName=void 0;continue}else if(h.append(f),await v())continue;if(f.finish_reason||g!==void 0){if(this.stats.markYielded(f.index),yield{solution:h,finishOffset:g,reason:f.finish_reason??"client-trimmed",filterReason:tqe(f),requestId:this.requestId,index:f.index},this.maybeCancel("after yielding finished choice"))return;c||(this.solutions[f.index]=null)}}}}for(let[o,s]of Object.entries(this.solutions)){let a=Number(o);if(s!==null&&(this.stats.markYielded(a),yield{solution:s,finishOffset:void 0,reason:"Iteration Done",requestId:this.requestId,index:a},this.maybeCancel("after yielding after iteration done")))return}if(r.length>0&&!n)try{let o=JSON.parse(r);o.error!==void 0&&(this.logService.public.error(o.error,`Error in response: ${o.error.message}`),hm(this.telemetryService,`Error in response: ${o.error.message}`,o.error))}catch{this.logService.public.error(`Error parsing extraData for request id ${this.requestId.headerRequestId}: ${r}`),hm(this.telemetryService,`Error parsing extraData for request id ${this.requestId.headerRequestId}: ${r}`)}}async*finishSolutions(){for(let[e,r]of Object.entries(this.solutions)){let n=Number(e);if(r!==null){if(this.completedFunctionCallIdxs.has(n)){yield{solution:r,finishOffset:void 0,reason:"function_call",requestId:this.requestId,index:n};continue}if(this.stats.markYielded(n),yield{solution:r,finishOffset:void 0,reason:"DONE",requestId:this.requestId,index:n},this.maybeCancel("after yielding on DONE"))return}}}maybeCancel(e){return this.cancellationToken?.isCancellationRequested?(this.logService.public.debug("Cancelled: "+e),this.cancel(),!0):!1}cancel(){this.body.destroy()}allSolutionsDone(){let e=Object.values(this.solutions);return e.length===this.expectedNumChoices&&e.every(r=>r===null)}};function eqe(t){return typeof t.title=="string"&&typeof t.message=="string"&&!!t.confirmation}function Gfe(t){let r={text:t.text.join(""),tokens:t.text};if(t.logprobs.length===0)return r;let n=t.logprobs.reduce((c,u)=>c.concat(u),[]),o=t.top_logprobs.reduce((c,u)=>c.concat(u),[]),s=t.text_offset.reduce((c,u)=>c.concat(u),[]),a=t.tokens.reduce((c,u)=>c.concat(u),[]);return{...r,logprobs:{token_logprobs:n,top_logprobs:o,text_offset:s,tokens:a}}}function tqe(t){if(t.finish_reason==="content_filter"){if(t.delta?.copilot_annotations?.TextCopyright)return"snippy";if(t.delta?.copilot_annotations?.Sexual||t.delta?.copilot_annotations?.SexualPattern)return"sexual";if(t.delta?.copilot_annotations?.Violence)return"violence";if(t.delta?.copilot_annotations?.HateSpeech||t.delta?.copilot_annotations?.HateSpeechPattern)return"hate";if(t.delta?.copilot_annotations?.SelfHarm)return"self_harm";if(t.delta?.copilot_annotations?.PromptPromBlockList)return"prompt";if(t.content_filter_results){for(let e of Object.keys(t.content_filter_results))if(t.content_filter_results[e]?.filtered)return e}}}var x$=class{constructor(e){this.choices=new Map;for(let r=0;r<e;r++)this.choices.set(r,new KP)}add(e){let r=this.choices.get(e)??new KP;r.increment(),this.choices.set(e,r)}markYielded(e){let r=this.choices.get(e)??new KP;r.markYielded(),this.choices.set(e,r)}toString(){return Array.from(this.choices.entries()).map(([e,r])=>`${e}: ${r.yieldedTokens} -> ${r.seenTokens}`).join(", ")}},KP=class{constructor(){this.yieldedTokens=-1;this.seenTokens=0}increment(){this.seenTokens++}markYielded(){this.yieldedTokens=this.seenTokens}};function hm(t,e,r){let n=[e,r],o=n.length>0?JSON.stringify(n):"no msg",s=Jn.createAndMarkAsIssued({context:"fetch",level:TL[5],message:o});t.sendRestrictedGHTelemetryErrorEvent("log",s.properties,s.measurements);let a=Jn.createAndMarkAsIssued({context:"fetch",level:TL[5],message:"[redacted]"});t.sendGHTelemetryErrorEvent("log",a.properties,a.measurements)}function S$(t,e,r){let n=r.extendedBy({messagesJson:JSON.stringify(e)});t.sendRestrictedGHTelemetryEvent("engine.messages",n.properties,n.measurements)}function rqe(t,e,r,n,o,s,a,c,u){return S$(t,[e],u),{message:e,choiceIndex:n,requestId:o,blockFinished:s,finishReason:a,filterReason:c,tokens:r.tokens,numTokens:r.tokens.length,telemetryData:u}}function zfe(t,e,r,n){let o=r.solution.text.join(""),s=!1;r.finishOffset!==void 0&&(e.internal.debug(`message ${r.index}: early finish at offset ${r.finishOffset}`),o=o.substring(0,r.finishOffset),s=!0),e.public.info(`message ${r.index} returned. finish reason: [${r.reason}]`),e.internal.debug(`message ${r.index} details: finishOffset: [${r.finishOffset}] completionId: [{${r.requestId.completionId}}] created: [{${r.requestId.created}}]`);let a=Gfe(r.solution),c={role:"assistant",content:o};return rqe(t,c,a,r.index,r.requestId,s,r.reason,r.filterReason,n)}async function $fe(t,e){let n=(await t.get(Nt).getCopilotToken()).isInternal?t.get(be).getConfig(de.DebugOverrideChatMaxTokenNum):0,o=-3;if(n>0)return o+=n,o;let s={};try{let a=t.get(wt).getTreatmentVariable("vscode","copilotchat.contextWindows");s=JSON.parse(a??"{}")}catch{}if(s[e.id])return o+=s[e.id],o;if(e.capabilities?.limits?.max_prompt_tokens)return o+=e.capabilities.limits.max_prompt_tokens,o;switch(e.id){case"gpt-3.5-turbo":o+=7168;break;case"gpt-4o-2024-05-13":o+=3072;break;default:o+=3072}return o}async function iqe(t,e,r,n,o,s,a){let u=(await j5.create(e,t,n,r,a)).processSSE(o);return qo.map(u,d=>{let p=d.reason??"client-trimmed",f=s.extendedBy({completionChoiceFinishReason:p});return t.sendGHTelemetryEvent("completion.finishReason",f.properties,f.measurements),zfe(t,e,d,s)})}var oC=class{constructor(e,r,n,o,s){this.domainService=e;this.disableSnippy=o;this.urlOverride=s;this._maxTokens=n,this.model=r.id,this.name=r.name,this.version=r.version,this.family=r.capabilities.family}get modelMaxPromptTokens(){return this._maxTokens}get url(){return this.urlOverride??this.domainService.capiChatURL}interceptBody(e){e&&this.disableSnippy&&(e.snippy={enabled:!1},Object.keys(e).forEach(r=>{r.startsWith("intent")&&delete e[r]}))}getExtraHeaders(){let e={};return this.disableSnippy&&(e["Editor-Plugin-Version"]="simulation-tests-plugin/2",e["Editor-Version"]="simulation-tests-editor/1.85"),e}async processResponseFromChatEndpoint(e,r,n,o,s,a,c){return iqe(e,r,n,o,s,a,c)}};var H5=ie("IPromptVariablesService");var Ev=H(require("vscode"));var aC=ie("IUserFeedbackService"),sC=class{constructor(e,r,n){this.telemetryService=e;this.conversationStore=r;this.feedbackReporter=n}handleUserAction(e,r){let n=Ev.window.activeTextEditor?.document,o=Ev.window.activeTextEditor?.selection,s=e.result,a=s.metadata?.responseId&&this.conversationStore.getConversation(s.metadata.responseId);switch(e.action.kind){case"copy":this.telemetryService.sendMSFTTelemetryEvent("panel.action.copy",{languageId:n?.languageId,requestId:s.metadata?.responseId,participant:r,command:s.metadata?.command},{codeBlockIndex:e.action.codeBlockIndex,copyType:e.action.copyKind,characterCount:e.action.copiedCharacters,lineCount:e.action.copiedText.split(`
`).length});break;case"insert":this.telemetryService.sendMSFTTelemetryEvent("panel.action.insert",{languageId:n?.languageId,requestId:s.metadata?.responseId,participant:r,command:s.metadata?.command},{codeBlockIndex:e.action.codeBlockIndex,characterCount:e.action.totalCharacters,newFile:e.action.newFile?1:0});break;case"runInTerminal":this.telemetryService.sendMSFTTelemetryEvent("panel.action.runinterminal",{languageId:n?.languageId,requestId:s.metadata?.responseId,blockLanguage:e.action.languageId,participant:r,command:s.metadata?.command},{codeBlockIndex:e.action.codeBlockIndex});break;case"followUp":this.telemetryService.sendMSFTTelemetryEvent("panel.action.followup",{languageId:n?.languageId,requestId:s.metadata?.responseId,participant:r,command:s.metadata?.command});break;case"bug":a&&this.feedbackReporter.reportChat(a.getLatestTurn());break}if(e.action.kind==="copy"||e.action.kind==="insert"){let c={};c={totalCharacters:e.action.totalCharacters},e.action.kind==="copy"&&(c={...c,copiedCharacters:e.action.copiedCharacters}),n&&o&&(c={...c,cursorLocation:n.offsetAt(o.active)}),om(this.telemetryService,Ev.window.activeTextEditor?.document,{codeBlockIndex:e.action.codeBlockIndex.toString(),messageId:s.metadata?.modelMessageId??"",headerRequestId:s.metadata?.responseId??"",participant:r},c,e.action.kind==="copy"?"conversation.acceptedCopy":"conversation.acceptedInsert")}}handleFeedback(e,r){let n=Ev.window.activeTextEditor?.document,o=e.result;this.telemetryService.sendMSFTTelemetryEvent("panel.action.vote",{languageId:n?.languageId,requestId:o.metadata?.responseId,participant:r,command:o.metadata?.command,reason:e.unhelpfulReason},{direction:e.kind===Ev.ChatResultFeedbackKind.Helpful?1:2}),om(this.telemetryService,n,{rating:e.kind===Ev.ChatResultFeedbackKind.Helpful?"positive":"negative",messageId:o.metadata?.modelMessageId??"",headerRequestId:o.metadata?.responseId??"",reason:e.unhelpfulReason??""},{},"conversation.messageRating")}};sC=w([b(0,he),b(1,tv),b(2,Z1)],sC);var cC=new Map,XP=class{constructor(e){this.label=e;this.iconPath=new $e.ThemeIcon("lock")}},oqe=$e.l10n.t("Sign in again to {0}","GitHub"),YP="github",V5="platform",Wfe={web:"bing-search",kb:"kb-search"},I$="kb:",Kfe="github.copilot.chat.selectKnowledgeBase",uC=class{constructor(e,r,n,o,s,a,c,u,l,d,p,f,m,h,g){this.logService=e;this.fetcherService=r;this.envService=n;this.promptVariablesService=o;this.workspaceService=s;this.tabsAndEditorsService=a;this.ignoreService=c;this.gitService=u;this.githubRepositoryService=l;this.chatMLFetcher=d;this.vscodeExtensionContext=p;this.authenticationService=f;this.domainService=m;this.userFeedbackService=h;this.configurationService=g;this.disposables=new ht;this.knowledgeBases=null;this.organizationsMissingSSO=void 0;this.disposables.add(new $e.Disposable(()=>cC.forEach(v=>v.dispose()))),this.disposables.add($e.commands.registerCommand(Kfe,async()=>{let v=$e.window.createQuickPick();v.placeholder=$e.l10n.t("Select a knowledge base"),v.busy=!0,v.show(),v.items=await this.getKnowledgeBaseAutocompleteQuickPickItems(),v.busy=!1;let y=await new Promise((_,x)=>{v.canSelectMany=!1;let S=!1;v.onDidAccept(async()=>{if(v.selectedItems[0]instanceof XP){v.busy=!0;let I=await this.authenticationService.getPermissiveGitHubSession({forceNewSession:!0});if(!I){this.logService.public.error("Failed to get a new auth session for knowledge base selection"),_(void 0),v.hide();return}if(S=!0,this.organizationsMissingSSO=void 0,this.knowledgeBases?.clear(),v.items=await this.getKnowledgeBaseAutocompleteQuickPickItems(I.accessToken),v.items.length===1&&v.items[0]instanceof XP){this.logService.public.error("Failed to fetch new knowledge bases after fetching new auth session"),_(void 0),v.hide();return}v.busy=!1,v.show()}else _(v.selectedItems[0]),v.hide()}),v.onDidHide(()=>{S||_(void 0)})});return v.dispose(),y?.insertText})),this.refreshRemoteAgents(),this.disposables.add(this.authenticationService.onDidAccessTokenChange(()=>{this.refreshRemoteAgents()}))}dispose(){this.disposables.dispose()}async refreshRemoteAgents(){return this.refreshRemoteAgentsP||(this.refreshRemoteAgentsP=this._doRefreshRemoteAgents()),this.refreshRemoteAgentsP.finally(()=>this.refreshRemoteAgentsP=void 0)}async _doRefreshRemoteAgents(){let e=new Set(cC.keys());try{let r=this.authenticationService.anyGitHubSession?.accessToken;if(!r){this.logService.public.warn("Unable to fetch remote agents because user is not signed in.");return}try{e.delete(V5)||(this.logService.public.info("Registering default platform agent..."),cC.set(V5,this.registerAgent(null)))}catch(a){this.logService.public.info(`Encountered error while registering platform agent: ${JSON.stringify(a)}`)}let o=await(await this.fetcherService.fetch(this.domainService.remoteAgentsURL,{method:"GET",headers:{Authorization:QP.format("Bearer %s",r),...this.envService.getEditorVersionHeaders()}})).text(),s;try{if(s=JSON.parse(o).agents,!Array.isArray(s))throw new Error("Expected 'agents' to be an array")}catch(a){o.includes("access denied")||this.logService.public.warn(`Invalid remote agent response: ${o} (${a})`);return}for(let a of s)e.delete(a.slug)||cC.set(a.slug,this.registerAgent(a))}catch(r){this.logService.public.error(r,"Failed to load remote slash commands")}for(let r of e)cC.get(r).dispose(),cC.delete(r)}shouldSendImplicitContext(e){return e===YP?!0:this.configurationService.getConfig(de.EnableImplicitContext)}isAgentAuthorized(e){if(e===YP)return!0;let r=`copilot.agent.${e}.authorized`;return this.vscodeExtensionContext.globalState.get(r,!1)||this.vscodeExtensionContext.workspaceState.get(r,!1)}async setAuthorized(e,r=!1){await(r?this.vscodeExtensionContext.globalState:this.vscodeExtensionContext.workspaceState).update(`copilot.agent.${e}.authorized`,!0)}registerAgent(e){let r=new ht,n=`github.copilot-dynamic.${e?.slug??V5}`,o=e?.slug??YP,s=e?.description??$e.l10n.t("Get answers grounded in web search, code search, and your enterprise's knowledge bases"),a={name:o,description:s,publisherName:e?.owner_login??"GitHub",fullName:e?.name??"GitHub"},c=!1,u=r.add($e.chat.createDynamicChatParticipant(n,a,async(l,d,p,f)=>{let m=cqe(d),h=_r(),g=_r(),v={sessionId:m,modelMessageId:g,responseId:h,agentId:n,command:l.command};if(l.acceptedConfirmationData)for(let _ of l.acceptedConfirmationData){if(_.ssoSignIn)return await this.authenticationService.getPermissiveGitHubSession({forceNewSession:!0}),p.markdown($e.l10n.t("Please complete the sign-in process in your browser.")),{metadata:v};if(_?.url)return await this.setAuthorized(o,l.prompt.startsWith($e.l10n.t("Authorize for all workspaces"))),await $e.commands.executeCommand("vscode.open",Gr.parse(_.url)),p.markdown($e.l10n.t("Please complete authorization in your browser and resend your question.")),{metadata:v};if(_?.hasAcknowledgedImplicitReferences)return await this.setAuthorized(o,l.prompt.startsWith($e.l10n.t("Allow for All Workspaces"))),p.markdown($e.l10n.t("Your preference has been saved.")),{metadata:v}}let y=this.authenticationService.anyGitHubSession?.accessToken;e?.slug||(y=this.authenticationService.permissiveGitHubSession?.accessToken??(await this.authenticationService.getPermissiveGitHubSession({createIfNone:!0}))?.accessToken);try{let _=new oC(this.domainService,{capabilities:{type:"chat",family:"remote"},id:"gpt-3.5-turbo",name:"Remote Agents",version:"1.0"},4096,void 0,e?`${this.domainService.remoteAgentsURL}/${e.slug}?chat`:`${this.domainService.remoteAgentsURL}/chat`),x=await this.promptVariablesService.resolveVariablesInPrompt(l.prompt,l.references),S=[],{copilot_skills:I,copilot_references:E}=await this.resolveCopilotSkills(o,l);E&&S.push(...E);let R=!1;try{let U=await this.prepareClientPlatformReferences([...l.references],o);R=U.hasIgnoredFiles,U.clientReferences&&S.push(...U.clientReferences);for(let F of U.vscodeReferences)p.reference(F)}catch(U){return U instanceof Error&&U.message.includes("File seems to be binary and cannot be opened as text")?(p.markdown($e.l10n.t("Sorry, binary files are not currently supported.")),{metadata:v}):{errorDetails:{message:U.message},metadata:v}}let B=new Map,V=[],M=sqe(l),le,ne,q=!1,P,k=await this.chatMLFetcher.fetchMany("remoteAgent",[...aqe(n,d),{role:"user",content:l.acceptedConfirmationData?.length||l.rejectedConfirmationData?.length?"":x.message,...S.length?{copilot_references:S}:void 0,copilot_confirmations:M?.length?M:void 0}],async(U,F,$)=>{if($.copilotReferences){let Y=(j,xe)=>{let ee="url"in j?j.url:"url"in j.data?j.data.url:"html_url"in j.data?j.data.html_url:void 0;if(ee&&typeof ee=="string"){if(!B.has(ee)){let vt;Ade(j)?vt=Gr.joinPath(this.vscodeExtensionContext.extensionUri,"assets","bing.svg"):new URL(ee).hostname==="github.com"?vt=new $e.ThemeIcon("github"):vt=new $e.ThemeIcon("globe"),le?le?.report(new $e.ChatResponseReferencePart(Gr.parse(ee),vt)):p.reference(Gr.parse(ee),vt),B.set(ee,xe??j)}}else if(j.metadata){let vt=j.metadata.display_icon?Gr.parse(j.metadata.display_icon):new $e.ThemeIcon("globe"),We=j.metadata.display_url?Gr.parse(j.metadata.display_url):j.metadata.display_name;le?le.report(new n4(We,vt)):p.reference2(We,vt),B.set(j.metadata.display_url??j.metadata.display_name,xe??j)}};for(let j of $.copilotReferences)if(Array.isArray(j.data.results))j.data.results.forEach(xe=>{Y(xe,j)});else if(j.data.type==="github.agent")V.push(j);else{if(j.type==="github.text")continue;("html_url"in j.data||"url"in j.data&&typeof j.data.url=="string"||j.metadata)&&Y(j)}}let ce=(Y,j)=>{ne?.deferred.complete(ne.resolvedMessage),le=Y;let xe=new Of;return ne={deferred:xe,resolvedMessage:j},xe.p};if($.copilotFunctionCalls)for(let Y of $.copilotFunctionCalls)switch(Y.name){case"bing-search":{try{let j=JSON.parse(Y.arguments);p.progress($e.l10n.t('Searching Bing for "{0}"...',j.query),async xe=>ce(xe,$e.l10n.t('Bing search results for "{0}"',j.query)))}catch{}break}case"kb-search":{try{let j=JSON.parse(Y.arguments);p.progress($e.l10n.t('Searching knowledge base for "{0}"...',j.query),async xe=>ce(xe,$e.l10n.t('Knowledge base results for "{0}"',j.query)))}catch{}break}case"codesearch":{try{let j=JSON.parse(Y.arguments);p.progress($e.l10n.t('Searching {0} for "{1}"...',j.scopingQuery,j.query),async xe=>ce(xe,$e.l10n.t('Code search results for "{0}" in {1}',j.query,j.scopingQuery)))}catch{}break}}if($.copilotErrors&&typeof p.warning=="function"){q=!0;for(let Y of $.copilotErrors)Y.code==="sso"?P=Y.identifier:le?le?.report(new $e.ChatResponseWarningPart(Y.message)):p.warning(Y.message)}if($.copilotConfirmation){q=!0;let Y=$.copilotConfirmation;p.confirmation(Y.title,Y.message,Y.confirmation)}if($.text){ne?.deferred.complete(ne.resolvedMessage);let Y=new $e.MarkdownString($.text);Y.supportHtml=!0,p.markdown(Y)}},f,2,_,void 0,{secretKey:y,copilot_thread_id:m,...I?{copilot_skills:I}:void 0},{messageSource:`serverAgent.${e?.slug??V5}`});if(v.copilot_references=[...new Set(B.values()).values(),...V],k.type==="success"&&R&&p.markdown($e.l10n.t(_L)),P&&y){let U=await this.updateMissingSSOOrganizationInfo(P,y),F=typeof U=="string"?$e.l10n.t("Please grant permission to read resources protected by SSO in the {0} organization.",U):$e.l10n.t("Please grant permission to read resources protected by SSO.");p.confirmation(oqe,F,{ssoSignIn:!0},[$e.l10n.t("Sign In")])}if(k.type!=="success"){if(this.logService.internal.warn(`Bad response from /agents/${o}: ${k.type} ${k.reason}`),k.reason.includes("400 no docs found"))return{errorDetails:{message:"No docs found"},metadata:v};if(k.type==="agent_unauthorized"){let U=new URL(k.authorizationUrl),F=this.shouldSendImplicitContext(o)?$e.l10n.t("By default, **@{0}** will read your active file and selection.",o)+" ":"";return p.confirmation($e.l10n.t("Authorize agent"),F+$e.l10n.t("Please authorize usage of **@{0}** on {1} and resend your question.",o,U.hostname),{url:k.authorizationUrl},[$e.l10n.t("Authorize"),$e.l10n.t("Authorize for All Workspaces")]),{metadata:v,nextQuestion:{prompt:l.prompt,participant:n,command:l.command}}}else{if(k.type==="agent_failed_dependency")return{errorDetails:{message:$e.l10n.t("Sorry, an error occurred: {0}",k.reason)},metadata:v};if(k.type!=="unknown"||!q)return{errorDetails:{message:k.reason},metadata:v}}}return this.shouldSendImplicitContext(o)&&!this.isAgentAuthorized(o)&&!c&&(p.confirmation($e.l10n.t("Grant access to editor context"),$e.l10n.t("**@{0}** would like to read your active file and selection.",o),{hasAcknowledgedImplicitReferences:!0},[$e.l10n.t("Allow"),$e.l10n.t("Allow for All Workspaces")]),c=!0),{metadata:v}}catch(_){return this.logService.public.error(`/agents/${o} failed: ${_}`),{metadata:v}}}));return u.iconPath=e?Gr.parse(e.avatar_url):new $e.ThemeIcon("github"),o===YP&&(u.participantVariableProvider={triggerCharacters:["#"],provider:{provideCompletionItems:async(l,d)=>(await this.getPlatformAgentSkills()).map(f=>{let m=new $e.ChatCompletionItem(`copilot.${f.name}`,"#"+f.name,[{value:f.insertText,level:$e.ChatVariableLevel.Full,description:f.description}]);return m.command=f.command,m.detail=f.description,m.fullName=f.fullName,m.icon=f.icon,m})}}),r.add(u.onDidReceiveFeedback(l=>this.userFeedbackService.handleFeedback(l,n))),r}async prepareClientPlatformReferences(e,r){let n=[],o=[],s=!1,a=!1,c=async(p,f)=>{let m=G5.basename(p.uri.toString()),h=p.getText(f);return await this.ignoreService.isCopilotIgnored(p.uri)?(s=!0,h="content-exclusion"):m.startsWith(".")?h="hidden-file":Buffer.byteLength(h,"utf8")>1024**3&&(h="file-too-large"),h},u=async(p,f)=>{n.push({type:"client.file",data:{language:p.languageId,content:await c(p)},id:G5.basename(p.uri.path)}),o.push(f?{variableName:f,value:p.uri}:p.uri)},l=async(p,f,m=!1)=>{let h=p.selection.start.line,g=p.selection.isEmpty?new $e.Range(new $e.Position(h,0),new $e.Position(h+1,0)):p.selection;n.push({type:"client.selection",data:{start:{line:g.start.line,col:g.start.character},end:{line:g.end.line,col:g.end.character},content:await c(p.document,g)},id:G5.basename(p.document.uri.path)}),m&&o.push(f?{variableName:f,value:new $e.Location(p.document.uri,g)}:new $e.Location(p.document.uri,g))};if(this.shouldSendImplicitContext(r)&&this.isAgentAuthorized(r)){let{activeTextEditor:p}=this.tabsAndEditorsService;p&&(await u(p.document),await l(p),a=!0)}for(let p of e)if(p.value instanceof Gr){let f=await this.workspaceService.openTextDocument(p.value);await u(f,p.name)}else if(p.name==="selection"){let{activeTextEditor:f}=this.tabsAndEditorsService;if(!f)throw new Error($e.l10n.t({message:"Please open a text editor to use the `#selection` variable.",comment:"{Locked='`#selection`'}"}));a||await l(f,p.name,!0)}this.gitService.isInitialized||await this.gitService.initialize();let d=this.gitService.repositories;for(let p of d){let f=ES(p);if(f)try{let[m,h]=f?.split("/"),g=await this.githubRepositoryService.getRepositoryInfo(m,h);n.push({type:"github.repository",id:f,data:{type:"repository",name:h,ownerLogin:m,id:g.id}})}catch(m){m instanceof Error&&m.message.includes("Failed to fetch repository info")&&this.authenticationService.getPermissiveGitHubSession({silent:!0}),this.logService.public.error(m,"Failed to fetch info about current GitHub repository")}}return{clientReferences:n,vscodeReferences:o,hasIgnoredFiles:s}}async listEnabledSkills(e){if(!this.enabledSkillsPromise){let r=await this.fetcherService.fetch(this.domainService.listSkillsURL,{method:"GET",headers:{Authorization:QP.format("Bearer %s",e),...this.envService.getEditorVersionHeaders()}});this.enabledSkillsPromise=r.json().then(n=>n?.skills.reduce((o,s)=>o.add(s.slug),new Set))}return this.enabledSkillsPromise}async resolveCopilotSkills(e,r){if(e===YP){let n=new Set,o=new Set;for(let s of r.references)if(Wfe[s.name])n.add(Wfe[s.name]);else if(s.name.startsWith(I$)){n.add("kb-search"),await this.getKnowledgeBases();let a=this.knowledgeBases?.get(s.name.slice(I$.length));a&&o.add(a)}return{copilot_skills:[...n],copilot_references:[...o]}}return{copilot_skills:[]}}async updateMissingSSOOrganizationInfo(e,r){try{Ye.parse(e,!0);return}catch{let n=e?.split("partial-results; organizations=")[1];if(n){let o=n.split(",");this.logService.public.debug(`Missing knowledge bases SSO for ${o.length} organizations: ${n}`);let s=await this.getOrganizationName(r,parseInt(o[0]));return s?this.organizationsMissingSSO={name:s,numberOfOrganizations:o.length}:this.organizationsMissingSSO={name:void 0,numberOfOrganizations:o.length},s}}}async getKnowledgeBases(e){if(this.knowledgeBases?.size)return{knowledgeBases:[...this.knowledgeBases.values()],organizationsMissingSSO:this.organizationsMissingSSO};let r=e??(await this.authenticationService.getPermissiveGitHubSession({createIfNone:!0}))?.accessToken;if(!r)return this.logService.public.debug("No auth token available to fetch knowledge bases"),{knowledgeBases:[],organizationsMissingSSO:void 0};let n=await this.listKnowledgeBases(r),o=await n.text(),s=n.headers.get("X-GitHub-SSO");s&&this.updateMissingSSOOrganizationInfo(s,r);try{let a=JSON.parse(o);this.knowledgeBases=new Map;let c=a.map(u=>({label:u.name,organization:u.owner.login,iconPath:new $e.ThemeIcon("github"),insertText:u.name,name:u.name,description:u.description,type:"github.knowledge-base",id:_r(),data:{type:"knowledge-base",id:u.id}}));for(let u of c)this.knowledgeBases.set(u.name,u);return{knowledgeBases:[...this.knowledgeBases.values()],organizationsMissingSSO:this.organizationsMissingSSO}}catch(a){return this.logService.public.error(a),{knowledgeBases:[],organizationsMissingSSO:this.organizationsMissingSSO}}}async getOrganizationName(e,r){let n=await this.fetcherService.fetch(`https://api.github.com/user/${r}`,{method:"GET",headers:{Authorization:QP.format("Bearer %s",e),...this.envService.getEditorVersionHeaders()}});if(n.ok)return(await n.json()).name}async listKnowledgeBases(e){return this.fetcherService.fetch("https://api.github.com/user/knowledge-bases",{method:"GET",headers:{Authorization:QP.format("Bearer %s",e),...this.envService.getEditorVersionHeaders()}})}async getKnowledgeBaseAutocompleteQuickPickItems(e){let{knowledgeBases:r,organizationsMissingSSO:n}=await this.getKnowledgeBases(e),o=[];if(n){let a;n.name&&n.numberOfOrganizations>1?a=$e.l10n.t("Single-sign on to see knowledge bases from {0} and {1} other organizations",n.name,n.numberOfOrganizations-1):n.name?a=$e.l10n.t("Single-sign on to see knowledge bases from the {0} organization",n.name):n.numberOfOrganizations===1?a=$e.l10n.t("Single-sign on to see knowledge bases from 1 additional organization"):a=$e.l10n.t("Single-sign on to see knowledge bases from {0} additional organizations",n.numberOfOrganizations),o.push(new XP(a)),o.push({kind:$e.QuickPickItemKind.Separator,label:""})}let s=new Map;for(let a of r){let c=a.organization;s.has(c)||s.set(c,[]),s.get(c)?.push(a)}for(let a of[...s.keys()].sort()){let c=s.get(a);c?.length&&(o.push({kind:$e.QuickPickItemKind.Separator,label:a}),o.push(...c.sort((u,l)=>u.label.localeCompare(l.label))))}return o}async getPlatformAgentSkills(){let e=this.authenticationService.anyGitHubSession?.accessToken;if(!e)return[];let r=await this.listEnabledSkills(e);return[{name:"web",insertText:"#web",description:"Search Bing for real-time context",kind:"bing-search",command:void 0},{name:"kb",insertText:`#${I$}`,icon:new $e.ThemeIcon("book"),fullName:"Knowledge Bases...",description:"Search your enterprises' knowledge bases",kind:"kb-search",command:{title:"",command:Kfe}}].filter(n=>r.has(n.kind))}};uC=w([b(0,oe),b(1,nn),b(2,St),b(3,H5),b(4,Ve),b(5,zt),b(6,ke),b(7,xo),b(8,uu),b(9,Ct),b(10,jt),b(11,Nt),b(12,Xr),b(13,aC),b(14,be)],uC);function sqe(t){return[...t.acceptedConfirmationData?.map(r=>({state:"accepted",confirmation:r}))??[],...t.rejectedConfirmationData?.map(r=>({state:"dismissed",confirmation:r}))??[]]}function aqe(t,e){let r=[];for(let n of e.history)if(n.participant===t&&(n instanceof $e.ChatRequestTurn&&r.push({role:"user",content:n.prompt}),n instanceof $e.ChatResponseTurn)){let o=n.result.metadata?.copilot_references,s=n.response.map(a=>a instanceof $e.ChatResponseMarkdownPart?a.value.value:"content"in a?a.content:null).filter(a=>!!a).join("");r.push({role:"assistant",content:s,...o?{copilot_references:o}:void 0})}return r}function cqe(t){let e;for(let r of t.history)if(r instanceof $e.ChatResponseTurn){let n=r.result.metadata?.sessionId;if(typeof n=="string"){e=n;break}}return e??_r()}var lp=H(require("vscode"));var Yfe;(n=>{let t=new Map;t.set("typescript",new Set(["abstract","any","as","asserts","async","await","bigint","boolean","break","case","catch","class","const","continue","constructor","debugger","declare","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","implements","import","in","infer","instanceof","interface","is","keyof","let","module","namespace","never","new","null","number","object","of","package","private","protected","public","readonly","require","return","set","static","string","super","switch","symbol","this","throw","true","try","type","typeof","undefined","unique","unknown","var","void","while","with","yield"])),t.set("javascript",new Set(["break","case","catch","class","const","continue","constructor","debugger","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","import","in","instanceof","interface","is","let","new","null","require","return","set","static","string","super","switch","symbol","this","throw","true","try","type","typeof","undefined","var","void","while","with","yield"]));function e(o,s){let a=t.get(o.languageId),c=[],u=o.lineAt(s),l=u.firstNonWhitespaceCharacterIndex,d=l;for(;l<u.range.end.character;){let p=new lp.Position(s.line,l),f=o.getWordRangeAtPosition(p);if(!f){l+=1;continue}let m=f.start.character,h=f.end.character;if(m!==d){let v=u.text.substring(d,m);c.push({type:v.match(/^\s+$/)?"space":"other",value:v})}let g=u.text.substring(m,h);c.push({type:a?.has(g)?"keyword":"word",value:g}),l=h+1,d=h}return c}function r(o,s,a){let c=e(o,s),u=0,l=0,d=0,p=0;for(let f=0;f<c.length;f++)switch(c[f].type){case"keyword":l+=1;break;case"word":u+=1;break;case"space":d+=1;break;case"other":p+=1;break}return a?.public.trace("[ChatTrigger] "+JSON.stringify({wordCount:u,keywordCount:l,spaceCount:d,otherCount:p,tokenCount:c.length})),!(c.length<4||d<2||l>u||p>d)}n.isMostlyNaturalLanguage=r})(Yfe||={});var JP=class{constructor(e){this._logService=e}async provideCompletionItems(e,r){let n=e.lineAt(r);if(n.isEmptyOrWhitespace||r.character<n.range.end.character||!Yfe.isMostlyNaturalLanguage(e,r,this._logService))return;let o=new lp.CompletionItem({label:n.text.trim(),description:"Trigger Inline Chat"});return o.kind=lp.CompletionItemKind.Event,o.command={command:"inlineChat.startWithCurrentLine",title:"Trigger Inline Chat"},o.range=n.range.with(n.range.start.with(void 0,n.firstNonWhitespaceCharacterIndex)),o.filterText=n.text.substring(n.firstNonWhitespaceCharacterIndex),new lp.CompletionList([o],!0)}};JP=w([b(0,oe)],JP);var wv=class{constructor(e,r){this._store=new ht;let n=this._store.add(new Mb),o=()=>{if(r.getConfig(de.InlineChatCompletionsTrigger)){let s=e.createInstance(JP);n.value=lp.languages.registerCompletionItemProvider(wv._selector,s)}else n.clear()};this._store.add(r.onDidChangeConfiguration(s=>{s.affectsConfiguration(de.InlineChatCompletionsTrigger.fullyQualifiedId)&&o()})),o()}static{this._selector=["typescript","typescriptreact","javascript","javascriptreact"]}dispose(){this._store.dispose()}};wv=w([b(0,K),b(1,be)],wv);var zve=H(require("dns")),$ve=H(require("util")),Cm=H(require("vscode"));var uqe=H(require("http")),lqe=H(require("https"));var lC=class extends Og{constructor(r){super();this._envService=r}fetch(r,n){let o=n.headers||{};o["User-Agent"]=`GitHubCopilotChat/${this._envService.getVersion()}`;let s=n.body;if(n.json){if(n.body)throw new Error("Illegal arguments! Cannot pass in both 'body' and 'json'!");o["Content-Type"]="application/json",s=JSON.stringify(n.json)}let a=n.method||"GET";if(a!=="GET"&&a!=="POST")throw new Error("Illegal arguments! 'method' must be either 'GET' or 'POST'!");let c=n.signal??new AbortController().signal;if(c&&!(c instanceof AbortSignal))throw new Error("Illegal arguments! 'signal' must be an instance of AbortSignal!");return this._fetch(r,a,o,s,c)}_fetch(r,n,o,s,a){return new Promise((c,u)=>{let d=(r.startsWith("https:")?lqe:uqe).request(r,{method:n,headers:o},p=>{if(a.aborted){p.destroy(),d.destroy(),u(C$(a));return}let f=new T$(d,p,a);c(new cg(p.statusCode||0,p.statusMessage||"",f.headers,async()=>f.text(),async()=>f.json(),async()=>f.body()))});d.setTimeout(60*1e3),d.on("error",u),s&&d.write(s),d.end()})}async disconnectAll(){}makeAbortController(){return new AbortController}isAbortError(r){return dqe(r)}isDNSLookupFailedError(r){return r&&r.code==="ENOTFOUND"}isFetcherError(r){return r&&["EADDRINUSE","ECONNREFUSED","ECONNRESET","ENOTFOUND","EPIPE","ETIMEDOUT"].includes(r.code)}getUserMessageForFetcherError(r){return`Please check your firewall rules and network connection then try again. Error Code: ${r.code}.`}};function C$(t){return t.reason}function dqe(t){return t&&t.name==="AbortError"}var T$=class{constructor(e,r,n){this.req=e;this.res=r;this.signal=n;this.headers=new class{get(o){let s=r.headers[o];return Array.isArray(s)?s[0]:s??null}[Symbol.iterator](){let o=Object.keys(r.headers),s=0;return{next:()=>{if(s>=o.length)return{done:!0,value:void 0};let a=o[s++];return{done:!1,value:[a,this.get(a)]}}}}}}text(){return new Promise((e,r)=>{let n=[];this.res.on("data",o=>n.push(o)),this.res.on("end",()=>e(Buffer.concat(n).toString())),this.res.on("error",r),this.signal.addEventListener("abort",()=>{this.res.destroy(),this.req.destroy(),r(C$(this.signal))})})}async json(){let e=await this.text();return JSON.parse(e)}async body(){return this.signal.addEventListener("abort",()=>{this.res.emit("error",C$(this.signal)),this.res.destroy(),this.req.destroy()}),this.res}};var E$=require("stream");var dC=class t extends Og{constructor(r,n){super();this._net=r;this._envService=n}static create(r){let n=pqe();return n?new t(n,r):null}async fetch(r,n){let o=n.headers||{};o["User-Agent"]=`GitHubCopilotChat/${this._envService.getVersion()}`;let s=n.body;if(n.json){if(n.body)throw new Error("Illegal arguments! Cannot pass in both 'body' and 'json'!");o["Content-Type"]="application/json",s=JSON.stringify(n.json)}let a=n.method||"GET";if(a!=="GET"&&a!=="POST")throw new Error("Illegal arguments! 'method' must be either 'GET' or 'POST'!");let c=n.signal??new AbortController().signal;if(c&&!(c instanceof AbortSignal))throw new Error("Illegal arguments! 'signal' must be an instance of AbortSignal!");return this._fetch(r,a,o,s,c)}async _fetch(r,n,o,s,a){let c=await this._net.fetch(r,{method:n,headers:o,body:s,signal:a});return new cg(c.status,c.statusText,c.headers,()=>c.text(),()=>c.json(),async()=>{if(!c.body)return E$.Readable.from([]);let u=c.body[Symbol.asyncIterator]();return E$.Readable.from(u)})}async disconnectAll(){}makeAbortController(){return new AbortController}isAbortError(r){return r&&r.name==="AbortError"}isDNSLookupFailedError(r){return r?.message==="net::ERR_INTERNET_DISCONNECTED"}isFetcherError(r){return r&&r.message&&r.message.startsWith("net::")}getUserMessageForFetcherError(r){return`Please check your firewall rules and network connection then try again. Error Code: ${r.message}.`}};function pqe(){try{return require("electron").net}catch{}}var yC=H(lhe(),1),mmr={ALPN_HTTP2:yC.default.ALPN_HTTP2,ALPN_HTTP2C:yC.default.ALPN_HTTP2C,ALPN_HTTP1_1:yC.default.ALPN_HTTP1_1,ALPN_HTTP1_0:yC.default.ALPN_HTTP1_0},{fetch:hmr,context:dhe,reset:gmr,noCache:vmr,h1:bmr,keepAlive:ymr,h1NoCache:_mr,keepAliveNoCache:xmr,cacheStats:Smr,clearCache:Imr,offPush:Cmr,onPush:Tmr,createUrl:Emr,timeoutSignal:wmr,Body:Rmr,Headers:kmr,Request:Pmr,Response:Amr,AbortController:phe,AbortError:oW,AbortSignal:Dmr,FetchBaseError:Nmr,FetchError:sW,ALPN_HTTP2:Lmr,ALPN_HTTP2C:Omr,ALPN_HTTP1_1:Mmr,ALPN_HTTP1_0:Fmr}=yC.default;var Uve=H(require("tls"));var Lve=H(require("crypto")),Ove=H(require("fs")),Mve=require("tls");var dM=ie("IWindowsCaCertsLoader");var $M=ie("IRootCertificateReader"),x2=class{constructor(e,r){this.delegate=e;this.logService=r}async getAllRootCAs(){try{return await this.delegate.getAllRootCAs()}catch(e){return this.logService.public.warn(`Failed to read root certificates: ${e}`),[]}}};x2=w([b(1,oe)],x2);var S2=class{constructor(e,r){this._logService=r;this.delegates=e.map(n=>new x2(n,r))}async getAllRootCAs(){return this.certificates||(this.certificates=this.removeExpiredCertificates((await Promise.all(this.delegates.map(e=>e.getAllRootCAs()))).flat())),this.certificates}removeExpiredCertificates(e){let r=Date.now(),n=e.filter(o=>{try{let s=new Lve.X509Certificate(o),a=Date.parse(s.validTo);return isNaN(a)||a>r}catch(s){return this._logService.public.error(s,"Failed to parse certificate "+o),!1}});return e.length!==n.length&&this._logService.public.info(`Removed ${e.length-n.length} expired certificates`),n}};S2=w([b(1,oe)],S2);var fK=class{async getAllRootCAs(){return Mve.rootCertificates}},mK=class{async getAllRootCAs(){let e=process.env.NODE_EXTRA_CA_CERTS;return e?await Fve(e):[]}},hK=class{async getAllRootCAs(){let e=[];for(let r of["/etc/ssl/certs/ca-certificates.crt","/etc/ssl/certs/ca-bundle.crt"]){let n=await Fve(r);e=e.concat(n)}return e}},gK=class{async getAllRootCAs(){let e=Nve();return e.all(e.der2.pem).filter(r=>r!==void 0)}},I2=class{constructor(e){this.windowsCaCertsLoader=e}async getAllRootCAs(){return await this.windowsCaCertsLoader.loadCaCerts()||[]}};I2=w([b(0,dM)],I2);var MC=class extends S2{constructor(e,r,n){super([new fK,new mK,V$e(n,e)],r)}};MC=w([b(1,oe),b(2,K)],MC);function V$e(t,e){switch(e){case"linux":return new hK;case"darwin":return new gK;case"win32":return t.createInstance(I2);default:return new vK}}var vK=class{async getAllRootCAs(){throw new Error("No certificate reader available for unsupported platform")}};async function Fve(t){try{let n=(await Ove.promises.readFile(t,{encoding:"utf8"})).split(/(?=-----BEGIN CERTIFICATE-----)/g).filter(s=>s.length>0),o=new Set(n);return Array.from(o)}catch(e){if(e?.code!=="ENOENT")throw e}return[]}var WM=class{#t;constructor(e){this._certificateReader=e.get($M)}async enhanceProxySettings(e){let r=await this.getCertificates();return{...e,ca:r}}async getCertificates(){let e=await this._certificateReader.getAllRootCAs();if(e.length!==0)return e}async createSecureContext(){let e=await this._certificateReader.getAllRootCAs(),n=Uve.createSecureContext({_vscodeAdditionalCaCerts:e});for(let o of e)n.context.addCACert(o);return{secureContext:n,certs:e}}async applyToRequestOptions(e){this.#t??=this.createSecureContext();let r=await this.#t;e.secureContext=r.secureContext,e.ca=r.certs,e.cert=r.certs}};var Bve=H(require("http"));var KM=ie("IKerberosLoader");var G$e=407,YM=ie("IProxySocketFactory"),Gy=class extends Error{constructor(e,r,n){super(e),this.code=r?.code,this.syscall=r?.syscall,this.errno=r?.errno,/^Failed to establish a socket connection to proxies:/.test(r?.message??"")?this.code="ProxyFailedToEstablishSocketConnection":/^InitializeSecurityContext:/.test(r?.message??"")?this.code="ProxyInitializeSecurityContext":r?.message==="Miscellaneous failure (see text): Server not found in Kerberos database"?this.code="ProxyKerberosServerNotFound":/^Unspecified GSS failure. {2}Minor code may provide more information: No Kerberos credentials available/.test(r?.message??"")&&(this.code="ProxyGSSFailureNoKerberosCredentialsAvailable"),n!==void 0&&(this.code=n)}};function qve(t){return new bK(t,new yK(t))}var bK=class{constructor(e,r,n=process.platform){this.accessor=e;this.delegate=r;this.platform=n;this.successfullyAuthorized=new Uh(20);this.logService=e.get(oe)}async createSocket(e,r){this.successfullyAuthorized.get(this.getProxyCacheKey(r))&&(this.logService.public.debug("Proxy authorization already successful once, skipping 407 rountrip"),await this.reauthorize(e,r));try{return await this.delegate.createSocket(e,r)}catch(n){if(n instanceof Gy&&n.code===`ProxyStatusCode${G$e}`){this.logService.public.debug("Proxy authorization required, trying to authorize first time");let o=await this.authorizeAndCreateSocket(e,r);if(o)return this.logService.public.debug("Proxy authorization successful, caching result"),this.successfullyAuthorized.set(this.getProxyCacheKey(r),!0),o}throw n}}async reauthorize(e,r){let n=await this.authorize(r);n&&(this.logService.public.debug("Proxy re-authorization successful, received token"),e.headers["Proxy-Authorization"]="Negotiate "+n)}async authorizeAndCreateSocket(e,r){let n=await this.authorize(r);if(this.logService.public.debug("Proxy authorization successful, received token"),n)return this.logService.public.debug("Trying to create socket with proxy authorization"),e.headers["Proxy-Authorization"]="Negotiate "+n,await this.delegate.createSocket(e,r)}async authorize(e){this.logService.public.debug("Loading kerberos module");let r=await z$e(this.accessor);if(!r){this.logService.public.debug("Could not load kerberos module");return}let n=this.computeSpn(e);this.logService.public.debug("Initializing kerberos client using spn "+n);let o=await r.initializeClient(n);this.logService.public.debug("Perform client side kerberos step");let s=await o.step("");return this.logService.public.debug("Received kerberos server response"),s}computeSpn(e){let o=this.accessor.get(be).getConfig(de.KerberosServicePrincipal)??e.kerberosServicePrincipal;if(o)return this.logService.public.debug("Using configured kerberos spn "+o),o;let s=this.platform==="win32"?`HTTP/${e.host}`:`HTTP@${e.host}`;return this.logService.public.debug("Using default kerberos spn "+s),s}getProxyCacheKey(e){return e.host+":"+e.port}},yK=class{constructor(e){this.logService=e.get(oe)}async createSocket(e,r){let n=this.createConnectRequestOptions(e,r);return new Promise((o,s)=>{this.logService.public.debug("Attempting to establish connection to proxy");let a=Bve.request(n);a.useChunkedEncodingByDefault=!1,a.once("connect",(c,u,l)=>{this.logService.public.debug("Socket Connect returned status code "+c.statusCode),a.removeAllListeners(),u.removeAllListeners(),c.statusCode!==200?(u.destroy(),s(new Gy(`tunneling socket could not be established, statusCode=${c.statusCode}`,void 0,`ProxyStatusCode${c.statusCode}`))):l.length>0?(u.destroy(),s(new Gy(`got non-empty response body from proxy, length=${l.length}`,void 0,"ProxyNonEmptyResponseBody"))):(this.logService.public.debug("Successfully established tunneling connection to proxy"),o(u))}),a.once("error",c=>{if(!c.message&&c instanceof AggregateError){let u=c.stack;c=new AggregateError(c.errors,`Aggregate error:${c.errors.map(l=>`
- ${l.message}`).join("")}`),c.stack=u}this.logService.public.debug("Proxy socket connection error "+c.message),a.removeAllListeners(),s(new Gy(`tunneling socket could not be established, cause=${c.message}`,c))}),a.on("timeout",()=>{this.logService.public.debug("Proxy socket connection timeout"),s(new Gy(`tunneling socket could not be established, proxy socket connection timeout while connecting to ${n.host}:${n.port}`,void 0,"ProxyTimeout"))}),a.end()})}createConnectRequestOptions(e,r){let n=`${e.hostname}:${e.port}`,o={...r,method:"CONNECT",path:n,agent:!1,headers:{host:n,"Proxy-Connection":"keep-alive"},timeout:e.timeout};return e.localAddress&&(o.localAddress=e.localAddress),this.configureProxyAuthorization(o,e),o}configureProxyAuthorization(e,r){e.headers["Proxy-Authorization"]=[],e.proxyAuth&&e.headers["Proxy-Authorization"].push("Basic "+Buffer.from(e.proxyAuth).toString("base64")),r.headers&&r.headers["Proxy-Authorization"]&&e.headers["Proxy-Authorization"].push(r.headers["Proxy-Authorization"])}};async function z$e(t){try{return t.get(KM).loadKerberos()}catch{return}}var QM=class extends Og{constructor(r){super();this.accessor=r;this.createSocketFactory=(r,n)=>async o=>{o.rejectUnauthorized=n,o.timeout=r.connectionTimeoutInMs,await this.certificateConfigurator.applyToRequestOptions(o);let s=await this.certificateConfigurator.enhanceProxySettings(r);return await this.proxySocketFactory.createSocket(o,s)};this.fetchApi=this.createFetchApi(r),this.certificateConfigurator=new WM(r),this.proxySocketFactory=r.get(YM)}set proxySettings(r){this._proxySettings=r,this.fetchApi=this.createFetchApi(this.accessor)}get proxySettings(){return this._proxySettings}set rejectUnauthorized(r){this._rejectUnauthorized=r,this.fetchApi=this.createFetchApi(this.accessor)}get rejectUnauthorized(){return this._rejectUnauthorized}createFetchApi(r){let n=r.get(St);return dhe({userAgent:`GitHubCopilotChat/${n.getVersion()}`,socketFactory:this._proxySettings?this.createSocketFactory(this._proxySettings,this.rejectUnauthorized):void 0,rejectUnauthorized:this.rejectUnauthorized})}async fetch(r,n){let o=n.signal,s=!1,a={...n,body:n.body?n.body:n.json,signal:o};await this.certificateConfigurator.applyToRequestOptions(a);let c=await this.certificateConfigurator.getCertificates();this.fetchApi.setCA(c);let u=await this.fetchApi.fetch(r,a).catch(l=>{throw s?new oW(`Request to <${r}> timed out after ${n.timeout}ms`):l});return new cg(u.status,u.statusText,u.headers,()=>u.text(),()=>u.json(),async()=>u.body)}disconnectAll(){return this.fetchApi.reset()}makeAbortController(){return new phe}isAbortError(r){return r instanceof oW}isDNSLookupFailedError(r){return r instanceof sW&&r.code==="ENOTFOUND"}isFetcherError(r){return r instanceof sW}getUserMessageForFetcherError(r){return`Please check your firewall rules and network connection then try again. Error Code: ${r.code}.`}};var Hve=require("net"),Vve=require("url"),FC=require("vscode");function $$e(t){return t.HTTPS_PROXY||t.https_proxy||t.HTTP_PROXY||t.http_proxy||null}function Gve(t,e){let r=FC.workspace.onDidChangeConfiguration(n=>{let o=n.affectsConfiguration("http.proxy");(n.affectsConfiguration("http.proxyStrictSSL")||n.affectsConfiguration("http.proxyAuthorization")||n.affectsConfiguration("http.proxyKerberosServicePrincipal")||o)&&jve(t,e,o)});return jve(t,e),r}var jve=(t,e,r)=>{let o=FC.workspace.getConfiguration("http").get("proxy")||$$e(e);if(o){let s={},a=FC.workspace.getConfiguration("http").get("proxyAuthorization"),c=FC.workspace.getConfiguration("http").get("proxyStrictSSL",!0);a&&(s["Proxy-Authorization"]=a);let u=o,l=o.split(":");if(l.length>2){if(o.includes("[")){let y=o.indexOf("["),_=o.indexOf("]");u=o.substring(y+1,_)}}else u=l[0];let d=(0,Hve.isIP)(u);d===4?o=`https://${o}`:d===6&&(o.includes("[")?o.startsWith("https://")||(o=`https://${o}`):o=`https://[${o}]`);let{hostname:p,port:f,username:m,password:h}=W$e(o),g=m&&h&&`${decodeURIComponent(m)}:${decodeURIComponent(h)}`;t.proxySettings={host:p,port:parseInt(f),proxyAuth:g,headers:s};let v=FC.workspace.getConfiguration("http").get("proxyKerberosServicePrincipal");v&&(t.proxySettings.kerberosServicePrincipal=v),t.rejectUnauthorized=c}else r&&!o&&(t.proxySettings=void 0)};function W$e(t){try{return new Vve.URL(t)}catch{throw new Error(`Invalid proxy URL: '${t}'`)}}var UC=class extends QM{constructor(r){super(r);this._store=new ht;this._store.add(Gve(this,process.env))}dispose(){this._store.dispose()}};var BC=class{constructor(e,r,n,o,s){this._context=e;this.envService=r;this.configurationService=n;this.domainService=o;this.accessor=s;this._context.subscriptions.push(Cm.commands.registerCommand("github.copilot.debug.collectDiagnostics",async()=>{let a=await Cm.workspace.openTextDocument({language:"markdown"}),c=await Cm.window.showTextDocument(a);await Jl(c,`## GitHub Copilot Chat

- Extension Version: ${this.envService.getVersion()} (${this.envService.getBuildType()})
- VS Code: ${this.envService.getEditorInfo().format()}
- OS: ${this.envService.OS}${Cm.env.remoteName?`
- Remote Name: ${Cm.env.remoteName}`:""}

## Network

User Settings:
\`\`\`json
  "github.copilot.advanced": {
    "debug.useElectronFetcher": ${this.configurationService.getConfig(de.DebugUseElectronFetcher)},
    "debug.useNodeFetcher": ${this.configurationService.getConfig(de.DebugUseNodeFetcher)}
  }
\`\`\`
`);let u=this.domainService.capiBaseURL,l=[this.domainService.dotComAPIURL,`${u.endsWith("/")?u:`${u}/`}_ping`],d=10,p=dC.create(this.envService),f=!!p&&this.configurationService.getConfig(de.DebugUseElectronFetcher),m=!f&&this.configurationService.getConfig(de.DebugUseNodeFetcher),h={Electron:{fetcher:p,current:f},Node:{fetcher:new lC(this.envService),current:m},Helix:{fetcher:new UC(this.accessor),current:!f&&!m}};for(let g of l){let v=new URL(g).host;await Jl(c,`
Connecting to ${g}:
- DNS Lookup: `);try{let y=$ve.promisify(zve.lookup),_=await Promise.race([y(v),iS(d*1e3)]);_?await Jl(c,`${_.address}
`):await Jl(c,`timed out after ${d} seconds
`)}catch(y){await Jl(c,`Error: ${y?.message}
`)}for(let[y,_]of Object.entries(h))if(await Jl(c,`- ${y} Fetcher${_.current?" (configured)":""}: `),_.fetcher)try{let x=await Promise.race([_.fetcher.fetch(g,{}),iS(d*1e3)]);x?await Jl(c,`HTTP ${x.status}
`):await Jl(c,`timed out after ${d} seconds
`)}catch(x){await Jl(c,`Error: ${x?.message}
`)}else await Jl(c,`Unavailable
`)}await Jl(c,`
## Documentation

In corporate networks: [Troubleshooting firewall settings for GitHub Copilot](https://docs.github.com/en/copilot/troubleshooting-github-copilot/troubleshooting-firewall-settings-for-github-copilot).`)}))}};BC=w([b(0,jt),b(1,St),b(2,be),b(3,Xr),b(4,st)],BC);async function Jl(t,e){await t.edit(r=>{r.insert(t.document.lineAt(t.document.lineCount-1).range.end,e)})}var xp=H(require("vscode"));var C2="ccreq",qC=ie("IRequestLogger");var XM=class extends dt{logChatRequest(e,r,n){return new _K(this,e,r,n)}},_K=class{constructor(e,r,n,o){this._logbook=e;this._debugName=r;this._chatEndpoint=n;this._chatParams=o;this._timeToFirstToken=void 0;this._time=new Date}markTimeToFirstToken(e){this._timeToFirstToken=e}resolve(e){e.type==="success"?this._logbook.addEntry({type:"ChatMLSuccess",debugName:this._debugName,chatEndpoint:this._chatEndpoint,chatParams:this._chatParams,startTime:this._time,endTime:new Date,timeToFirstToken:this._timeToFirstToken,result:e}):this._logbook.addEntry({type:"ChatMLFailure",debugName:this._debugName,chatEndpoint:this._chatEndpoint,chatParams:this._chatParams,startTime:this._time,endTime:new Date,timeToFirstToken:this._timeToFirstToken,result:e})}resolveWithCancelation(){this._logbook.addEntry({type:"ChatMLCancelation",debugName:this._debugName,chatEndpoint:this._chatEndpoint,chatParams:this._chatParams,startTime:this._time,endTime:new Date})}};var jC=class extends dt{constructor(r){super();this.id="requestLogTree";this._register(xp.window.registerTreeDataProvider("copilot-chat-requests",r.createInstance(T2)))}};jC=w([b(0,K)],jC);var T2=class{constructor(e){this.requestLogger=e;this.onDidChangeTreeData=this.requestLogger.onDidChangeRequests.bind(this.requestLogger)}getTreeItem(e){return e}getChildren(e){return e?[]:this.requestLogger.getRequests().map(r=>new xK(r))}};T2=w([b(0,qC)],T2);var xK=class extends xp.TreeItem{constructor(e){let r=`${e.entry.endTime.getTime()-e.entry.startTime.getTime()}ms`;super(e.entry.debugName,xp.TreeItemCollapsibleState.None);let n=e.entry.startTime.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});this.description=`[${r}] [${n}]`;let o=xp.Uri.parse(`${C2}:${e.id}.copilotmd`);this.command={command:"vscode.open",title:"",arguments:[o]},this.iconPath=e.entry.type==="ChatMLSuccess"?void 0:new xp.ThemeIcon("error"),this.tooltip=`${e.entry.type==="ChatMLCancelation"?"cancelled":e.entry.result.type}
${e.entry.chatEndpoint.model}
${r}
${n}`}};var zy=require("fs"),e0e=require("net"),Sp=H(require("path")),Ca=H(require("vscode"));var HC=ie("ILaunchConfigService");var GC=require("path");var JM=ie("IDebugCommandToConfigConverter"),VC=class{constructor(e,r,n,o,s,a,c){this.endpointProvider=e;this.instantiationService=r;this.conversationOptions=n;this.chatMLFetcher=o;this.workspace=s;this.telemetry=a;this.extensionsService=c}async convert(e,r,n){let o=Y$e(e,this.workspace),s=await this.endpointProvider.getChatEndpoint("gpt-4"),c=await Be.create(this.instantiationService,s,gv,{input:{type:1,relativeCwd:o?.path,absoluteCwd:e,args:r},history:[]}).render(void 0,n),u=await this.chatMLFetcher.fetchOne("debugCommandToConfig",c.messages,void 0,n,3,s,void 0,{temperature:this.conversationOptions.temperature,top_p:this.conversationOptions.topP},{messageSource:"debugCommandToConfig"});if(u.type!=="success")return{ok:!1,config:void 0,text:u.reason,workspaceFolder:o?.folder};let l=C5(u.value,this.extensionsService);return this.telemetry.sendMSFTTelemetryEvent("onboardDebug.configGenerated",{configType:l?.configurations[0].type},{ok:l?1:0}),{ok:!0,config:l,text:u.value,workspaceFolder:o?.folder}}};VC=w([b(0,Se),b(1,K),b(2,Rr),b(3,Ct),b(4,Ve),b(5,he),b(6,up)],VC);function Y$e(t,e){let r;for(let n of e.getWorkspaceFolders()){let o=(0,GC.relative)(n.fsPath,t),s=(0,GC.isAbsolute)(o)?1/0:eS(o,"..");(!r||s<r.distance||s===r.distance&&o.length<r.rel.length)&&(r={rel:(0,GC.join)("${workspaceFolder}",o).replaceAll("\\","/"),distance:s,folder:n})}return r&&{folder:r.folder,path:r.rel}}var Wve="copilot-chat.terminalToDebugging.configs",X$e=30,zC=class{constructor(e,r,n,o,s,a,c){this.interactor=e;this.telemetry=r;this.context=n;this.commandToConfig=o;this.extensionsService=s;this.workspaceService=a;this.launchConfigService=c}async start({args:e,cwd:r,forceNew:n,printOnly:o,save:s},a){this.telemetry.sendMSFTTelemetryEvent("onboardDebug.commandExecuted",{binary:e[0]});let c=this.tryMatchExistingConfig(r,e);if(!c||n){this.interactor.isGenerating();let p=await this.commandToConfig.convert(r,e,a);if(!p.ok)return{kind:0,text:p.text};this.interactor.didGenerate(),c={args:e,cwd:r,folder:p.workspaceFolder,inputs:[],config:p.config},this.telemetry.sendMSFTTelemetryEvent("onboardDebug.configGenerated",{binary:e[0],debugType:c.config.configurations[0].type})}let u=c.config.configurations[0],l=c.folder&&this.workspaceService.getWorkspaceFolder(Ye.revive(c.folder));if(o||s)return this.saveConfigInLRU(c),s&&await this.save(c.config,l),{kind:1,folder:l,config:u};if(!this.hasMatchingExtension(u))return{kind:2,debugType:u.type};let d=await this.resolveConfigurationInputs(c.config,new Map(c.inputs));return d?(c.inputs=[...d.inputs],this.saveConfigInLRU(c),{kind:1,folder:l,config:d.config}):{kind:3}}async save(e,r){await this.launchConfigService.add(r,e),r&&await this.launchConfigService.show(r,e.configurations[0].name)}async resolveConfigurationInputs(e,r){let n=new Map;for(let s of e.inputs||[]){let a=await this.interactor.prompt(s.description,r.get(s.id));if(a===void 0)return;n.set("${input:"+s.id+"}",a)}return{config:pse(e.configurations[0],s=>{if(typeof s=="string"){for(let[a,c]of n)s=s.replaceAll(a,c);return s}}),inputs:n}}hasMatchingExtension(e){for(let r of this.extensionsService.allAcrossExtensionHosts){let n=r.packageJSON?.contributes?.debuggers;if(Array.isArray(n)&&n.some(o=>o&&o.type===e.type))return!0}return!1}tryMatchExistingConfig(e,r){let n=this.readStoredConfigs(),o=n.findIndex(s=>s.cwd===e&&xR(s.args,r));if(o!==-1)return n[o]}readStoredConfigs(){return this.context.workspaceState.get(Wve,[])}saveConfigInLRU(e){let r=this.readStoredConfigs().slice(),n=r.indexOf(e);for(n>=1&&r.splice(n,1),r.unshift(e);r.length>X$e;)r.pop();this.context.workspaceState.update(Wve,r)}};zC=w([b(1,he),b(2,jt),b(3,JM),b(4,up),b(5,Ve),b(6,HC)],zC);var Kve=require("stream"),ZM=class extends Kve.Transform{constructor(r){super();this.prefix=[];this.splitSuffix=Buffer.alloc(0);if(typeof r=="string"&&r.length===1)this.splitter=r.charCodeAt(0);else if(typeof r=="number")this.splitter=r;else throw new Error("not implemented here")}_transform(r,n,o){let s=0;for(;s<r.length;){let a=r.indexOf(this.splitter,s);if(a===-1)break;let c=r.subarray(s,a),u=this.prefix.length||this.splitSuffix.length?Buffer.concat([...this.prefix,c,this.splitSuffix]):c;this.push(u),this.prefix.length=0,s=a+1}s<r.length&&this.prefix.push(r.subarray(s)),o()}_flush(r){this.prefix.length&&this.push(Buffer.concat([...this.prefix,this.splitSuffix])),r()}};var eF=class{constructor(e){this.stream=e;this.methods=new Map;this.pendingRequests=new Map;this.idCounter=0,this.stream.pipe(new ZM(0)).on("data",r=>this.handleData(r))}registerMethod(e,r){this.methods.set(e,r)}async callMethod(e,r){let n=this.idCounter++,o={id:n,method:e,params:r},s=new Promise((a,c)=>{this.pendingRequests.set(n,{resolve:a,reject:c})});return this.stream.write(JSON.stringify(o)+"\0"),s}async handleData(e){let r=JSON.parse(e.toString());if("method"in r){let{id:n,method:o,params:s}=r,a={id:n};try{if(this.methods.has(o)){let c=await this.methods.get(o)(s);a.result=c}else throw new Error(`Method not found: ${o}`)}catch(c){a.error={code:-1,message:String(c)}}this.stream.write(JSON.stringify(a)+"\0")}else{let{id:n,result:o,error:s}=r,a=this.pendingRequests.get(n);this.pendingRequests.delete(n),o!==void 0?a?.resolve(o):s!==void 0&&a?.reject(new Error(s.message))}}};var tF=H(require("vscode"));var Yve="__copilotTrackedSession",Qve=(t,e,r)=>{let n=_r(),o=new ht,s=!1,a=new Set;function c(u,l){r.callMethod("exit",{code:u,error:l}),o.dispose()}r.registerMethod("stop",()=>(a.forEach(u=>tF.debug.stopDebugging(u)),Promise.resolve())),o.add(tF.debug.registerDebugAdapterTrackerFactory("*",{createDebugAdapterTracker(u){if(u.configuration[Yve]!==n&&(!u.parentSession||!a.has(u.parentSession)))return;let l=!s;return s=!0,a.add(u),{onWillStartSession(){l&&r.callMethod("started",{})},onDidSendMessage(d){d.type==="event"&&d.event==="output"&&d.body.output&&r.callMethod("output",d.body)},onError(d){l&&c(1,String(d))},onExit(d,p){l&&c(d??0,p)},onWillStopSession(){l&&c(0)}}}})),tF.debug.startDebugging(t,{...e,[Yve]:n}).then(u=>{u||c(1)})};var Xve="copilot-chat.terminalToDebugging.registered",Jve="PATH",rF="copilot-debug",Zve="github.copilot.chat.debugTerminalCommands",nF="copilotDebugCommand.js",$C=class extends dt{constructor(r,n,o){super();this.context=r;this.logService=n;this.instantiationService=o;this._register(Ca.window.registerUriHandler(this)),this._register(Ca.workspace.onDidChangeConfiguration(s=>{s.affectsConfiguration(Zve)&&(this.registerSerializer=this.registerSerializer.then(()=>this.registerEnvironment()))})),this.registerSerializer=this.registerEnvironment()}handleUri(r){let n=process.platform==="win32"?"\\\\.\\pipe\\"+r.path.slice(1):r.path.substring(1),o=new la,s=(0,e0e.connect)(n,()=>{this.logService.public.info(`Got a debug connection on ${n}`);let a=new eF(s),c=this.instantiationService.createInstance(zC,{didGenerate:()=>a.callMethod("didGenerate"),isGenerating:()=>a.callMethod("isGenerating"),prompt:async(u,l)=>await Ca.window.showInputBox({prompt:u,value:l,ignoreFocusOut:!0})});a.registerMethod("start",async u=>{let l=await c.start(u,o.token);return l.kind===1&&!(u.printOnly||u.save)&&Qve(l.folder&&Ca.workspace.getWorkspaceFolder(l.folder),{...l.config,internalConsoleOptions:"neverOpen"},a),l})});s.on("error",a=>{this.logService.public.error(`Error connecting to debug client on ${n}: ${a}`),o.dispose(!0)}),s.on("end",()=>{o.dispose(!0)})}getVersionNonce(){return this.context.extensionMode!==Ca.ExtensionMode.Production?String(Date.now()):Ca.extensions.getExtension(Ud)?.packageJSON.version??String(Date.now())}async registerEnvironment(){let r=Ca.workspace.getConfiguration().get(Zve,!1),n=Sp.join(this.context.globalStorageUri.fsPath,"debugCommand"),o=this.context.globalState.get(Xve),s=this.getVersionNonce();if(!r)o&&(this.context.environmentVariableCollection.delete(Jve),await zy.promises.rm(o.location,{recursive:!0,force:!0}));else if(!o)await this.fillStoragePath(n),this.context.environmentVariableCollection.append(Jve,Sp.delimiter+n);else if(o.version!==s)await this.fillStoragePath(n);else return;this.context.globalState.update(Xve,r?{location:n,version:s}:void 0)}async fillStoragePath(r){let n=Ca.Uri.from({scheme:Ca.env.uriScheme,authority:Ud});if(await zy.promises.mkdir(r,{recursive:!0}),process.platform==="win32")await zy.promises.writeFile(Sp.join(r,`${rF}.bat`),Z$e(r,n));else{let o=Sp.join(r,rF);await zy.promises.writeFile(o,J$e(r,n)),await zy.promises.chmod(o,488)}await zy.promises.copyFile(Sp.join(__dirname,nF),Sp.join(r,nF))}};$C=w([b(0,jt),b(1,oe),b(2,K)],$C);var J$e=(t,e)=>`#!/bin/sh
ELECTRON_RUN_AS_NODE=1 NODE_OPTIONS="" "${process.execPath}" "${Sp.join(t,nF)}" "${e}" "$@"`,Z$e=(t,e)=>`@echo off
SET ELECTRON_RUN_AS_NODE=1
SET NODE_OPTIONS=""
"${process.execPath}" "${Sp.join(t,nF)}" "${e}" %*
`;var E2=H(require("vscode"));var r0e=H(require("path"));var Tm=H(nt());var eWe=/\s*(?:. )?([a-z0-9_-]+)\s*/,iF=ie("ILanguageToolsProvider"),WC=class{constructor(e,r,n,o){this.endpointProvider=e;this.instantiationService=r;this.conversationOptions=n;this.chatMLFetcher=o}async getToolsForLanguages(e,r){let n=await this.endpointProvider.getChatEndpoint("gpt-4"),s=await Be.create(this.instantiationService,n,SK,{languages:e}).render(void 0,r),a=await this.chatMLFetcher.fetchOne("debugCommandIdentifier",s.messages,void 0,r,3,n,void 0,{temperature:this.conversationOptions.temperature,top_p:this.conversationOptions.topP},{messageSource:"debugCommandIdentifier"});return a.type!=="success"?{ok:!1,commands:[]}:{ok:!0,commands:a.value.split(`
`).map(c=>eWe.exec(c)?.[1]).filter(c=>!!c)}}};WC=w([b(0,Se),b(1,K),b(2,Rr),b(3,Ct)],WC);var SK=class extends Tm.PromptElement{render(e,r){return vscpp(vscppf,null,vscpp(Tm.SystemMessage,{priority:10},"You are an AI programming assistant that is specialized for usage of command-line tools developers use to build software.",vscpp("br",null),"I'm working on software in the given following languages. Please list the names of common command-line tools I might use to build and test my software.",vscpp("br",null),"Do NOT list tools that don't run my code, such as those used only for linting. For example, if I ask for JavaScript, the list should include tools like node, npx, and mocha, but not eslint.",vscpp("br",null),"Be thorough! Try to give a list of *at least* 10 such tools.",vscpp("br",null),"Print these tools out as a list, separated by commas. Do NOT print any additional explanation or context.",vscpp("br",null),vscpp(Tm.TextChunk,{priority:8},"# Example",vscpp("br",null),"## User: ",vscpp("br",null),"- python",vscpp("br",null),"- rust",vscpp("br",null),"## Response:",vscpp("br",null),"- python",vscpp("br",null),"- pip",vscpp("br",null),"- cargo",vscpp("br",null),"- rustc",vscpp("br",null))),vscpp(Tm.UserMessage,{priority:9},vscpp(Tm.TextChunk,{breakOnWhitespace:!0,flexGrow:1},"The languages I'm working in are:",vscpp("br",null),this.props.languages.join(`
 -`))))}};var oF=ie("IDebuggableCommandIdentifier"),KC=class extends dt{constructor(r,n,o,s,a){super();this.configurationService=r;this.context=n;this.languageToolsProvider=s;this.fileSystemService=a;this.recentlySeenLanguages=new Set;this._register(o.onDidOpenTextDocument(c=>{nWe.includes(c.languageId)||this.recentlySeenLanguages.add(c.languageId)}))}async isDebuggable(r,n,o){if(!this.isGloballyEnabled())return!1;let s=tWe(n).toLowerCase();return this.getSpecificTreatment(s)??this.isWellKnownCommand(s)??await this.isWorkspaceLocal(r,s)??await this.isModelSuggestedCommand(s,o)??!1}isGloballyEnabled(){return this.configurationService.getConfig(de.TerminalToDebuggerEnabled)}async isWorkspaceLocal(r,n){let o=r0e.default.isAbsolute(n)?Ye.file(n):r&&Ye.joinPath(r,n);if(o)try{return await this.fileSystemService.stat(o),!0}catch{}}async isModelSuggestedCommand(r,n){let o=this.loadModelKnownCommands();for(let u of o.languages)this.recentlySeenLanguages.delete(u);if(o.commands.some(u=>r.includes(u)))return!0;if(!this.recentlySeenLanguages.size)return!1;let s=[...this.recentlySeenLanguages];this.recentlySeenLanguages.clear();let{commands:a,ok:c}=await this.languageToolsProvider.getToolsForLanguages(s,n);return c&&this.storeModelKnownCommands({languages:o.languages.concat(s),commands:voe(o.commands.concat(a))}),a.some(u=>r.includes(u))}isWellKnownCommand(r){return rWe.some(n=>r.includes(n))||void 0}getSpecificTreatment(r){let n=this.configurationService.getConfig(de.TerminalToDebuggerPatterns);for(let o of n){if(o.startsWith("!")&&r.includes(o))return!1;if(r.includes(o))return!0}}loadModelKnownCommands(){return this.context.globalState.get(t0e,{languages:[],commands:[]})}storeModelKnownCommands(r){return this.context.globalState.update(t0e,r)}};KC=w([b(0,be),b(1,jt),b(2,Ve),b(3,iF),b(4,hr)],KC);var t0e="chat.debuggableCommands";function tWe(t){let r=/\s*([^\s]+)/.exec(t);return r?r[1]:t}var rWe=["abap","ant","automake","autotools","ava","babel","bcp","behat","behave","biber","bibtex","bmake","boot","broccoli-sass","browserify","build_runner","bundler","busted","cabal","cargo","cargo-bench","cargo-fuzz","cargo-make","cargo-run","cargo-test","cargo-watch","carthage","carton","clang","clippy-driver","clj","clojure","cmake","cocoapods","codeception","common_test","composer","conan","coverage","cpan","cpanm","csc","ct_run","ctest","cucumber","cuda-gdb","cuda-memcheck","cypress","dart","dart-sass","dart2js","dartanalyzer","dartdevc","db2cli","ddemangle","devenv","devtools","dfix","dialyzer","dmd","doctest","dotnet","dotnet-script","dotnet-test-nunit","dotnet-test-xunit","dpp","dscanner","dsymutil","dub","dune","dustmite","dvilualatex","dvipdf","dvipdfmx","dvips","erl","erlang","erlc","esbuild","escript","eunit","eyeglass","fastlane","fennel","flutter","forever","fpc","fsharpc","fsi","g","gaiden","gcc","gcov","gdb","gdc","ghc","ghcid","gmake","gmaven","go","gpars","gradle","grape","griffon","grinder","grip","groovy","groovyc","grunt","grunt-sass","gulp","gulp-sass","hdevtools","hlint","hspec","irb","isql","jasmine","java","javac","jazzy","jdeps","jest","jlink","julia","junit","kaocha","karma","kobalt","kotest","kotlin-dsl","kotlinc","kscript","latexmk","lazbuild","lcov","ld","ldc2","ldoc","leiningen","lldb","lua","luacheck","luajit","lualatex","luarocks","luaunit","make","markdown","markdown-it","markdown-pdf","marked","matlab","maven","mbuild","mcc","md2pdf","mdbook","merlin","mex","midje","minitest","mlint","mmake","mocha","mockk","mono","moonscript","msbuild","mssql-cli","mstest","multimarkdown","mysql","ncu","ninja","nmake","node","node-sass","nose","npm","npx","nrepl","nsight","nsys","nunit-console","nvcc","ocamlbuild","ocamlc","ocamldebug","ocamlfind","ocamlopt","ocamlrun","opam","otest","otool","paket","panda","pandoc","parcel","pdflatex","perl","perl6","perlbrew","pgbench","phing","php","php-cs-fixer","phpcs","phpdbg","phpstan","phpunit","pip","pipenv","plackup","playwright","pm2","pmake","powershell","ppc386","ppcrossarm","ppcrossavr","ppcrossmips","ppcrossppc","ppcrosssparc","ppcrosswin32","ppcrossx64","protractor","prove","pry","psql","psysh","pub","pwsh","pytest","python","qmake","quickcheck","rails","rake","rakudo","rdmd","react-scripts","rebar3","relx","remake","rollup","rspec","rubocop","ruby","runghc","rustc","rustup","sass","sassc","scons","showdown","sinatra","speclj","spek","spock","spring-boot","sqlcmd","sqlite3","sqsh","stack","svelte-kit","swift","swiftc","test","test-runner","testng","testthat","tools","torch","tox","ts-node","tsc","unittest","utop","valgrind","vbc","virtualenv","vite","vstest","vue-cli-service","vue-test-utils","webdev","webpack","x","xcodebuild","xctest","xelatex","xunit","yarn","zef","zig"],nWe=["abap","bat","bibtex","c","clojure","code-refactoring","coffeescript","cpp","csharp","css","cuda-cpp","d","dart","diff","dockercompose","dockerfile","erlang","fsharp","git-commit","git-rebase","github-issues","go","graphql","groovy","haml","handlebars","haskell","html","ini","jade","java","javascript","javascriptreact","json","jsonc","julia","kotlin","latex","less","log","lua","makefile","markdown","matlab","objective-c","objective-cpp","ocaml","pascal","perl","perl6","php","pip-requirements","plaintext","powershell","pug","python","r","razor","ruby","rust","sass","scss","shaderlab","shellscript","slim","snippets","sql","stylus","svelte","swift","tex","text","toml","typescript","typescriptreact","vb","vue","vue-html","xml","xsl","yaml","zig"];var iWe="copilot-chat.terminalToDebugging",YC=class extends dt{constructor(r){super();this.debuggableCommandIdentifier=r;this.lastExtensionFor=new Map;this._register(E2.window.registerTerminalQuickFixProvider(iWe,this)),this._register(E2.window.onDidCloseTerminal(n=>{this.lastExtensionFor.delete(n)})),this._register(E2.window.onDidEndTerminalShellExecution(n=>{this.lastExtensionFor.set(n.terminal,n)}))}async provideTerminalQuickFixes(r,n){let s=E2.window.activeTerminal?.shellIntegration?.cwd;if(await this.debuggableCommandIdentifier.isDebuggable(s,r.commandLine,n))return{terminalCommand:`${rF} ${r.commandLine}`,shouldExecute:!1}}};YC=w([b(0,oF)],YC);var $s=H(require("vscode"));function w2(t){if(!t()){debugger;t(),Mh(new Qr("Assertion Failed"))}}var Zl=class{constructor(e,r,n){this.owner=e;this.debugNameSource=r;this.referenceFn=n}getDebugName(e){return s0e(e,this)}},n0e=new Map,IK=new WeakMap;function s0e(t,e){let r=IK.get(t);if(r)return r;let n=oWe(t,e);if(n){let o=n0e.get(n)??0;o++,n0e.set(n,o);let s=o===1?n:`${n}#${o}`;return IK.set(t,s),s}}function oWe(t,e){let r=IK.get(t);if(r)return r;let n=e.owner?aWe(e.owner)+".":"",o,s=e.debugNameSource;if(s!==void 0)if(typeof s=="function"){if(o=s(),o!==void 0)return n+o}else return n+s;let a=e.referenceFn;if(a!==void 0&&(o=sF(a),o!==void 0))return n+o;if(e.owner!==void 0){let c=sWe(e.owner,t);if(c!==void 0)return n+c}}function sWe(t,e){for(let r in t)if(t[r]===e)return r}var i0e=new Map,o0e=new WeakMap;function aWe(t){let e=o0e.get(t);if(e)return e;let r=cWe(t),n=i0e.get(r)??0;n++,i0e.set(r,n);let o=n===1?r:`${r}#${n}`;return o0e.set(t,o),o}function cWe(t){let e=t.constructor;return e?e.name:"Object"}function sF(t){let e=t.toString(),n=/\/\*\*\s*@description\s*([^*]*)\*\//.exec(e);return(n?n[1]:void 0)?.trim()}var uWe;function tc(){return uWe}function $y(t){return new aF(new Zl(void 0,void 0,t),t,void 0,void 0)}var aF=class{constructor(e,r,n,o){this._debugNameData=e;this._runFn=r;this.createChangeSummary=n;this._handleChange=o;this.state=2;this.updateCount=0;this.disposed=!1;this.dependencies=new Set;this.dependenciesToBeRemoved=new Set;this.changeSummary=this.createChangeSummary?.(),tc()?.handleAutorunCreated(this),this._runIfNeeded(),Fb(this)}get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}dispose(){this.disposed=!0;for(let e of this.dependencies)e.removeObserver(this);this.dependencies.clear(),Ub(this)}_runIfNeeded(){if(this.state===3)return;let e=this.dependenciesToBeRemoved;this.dependenciesToBeRemoved=this.dependencies,this.dependencies=e,this.state=3;let r=this.disposed;try{if(!r){tc()?.handleAutorunTriggered(this);let n=this.changeSummary;this.changeSummary=this.createChangeSummary?.(),this._runFn(this,n)}}finally{r||tc()?.handleAutorunFinished(this);for(let n of this.dependenciesToBeRemoved)n.removeObserver(this);this.dependenciesToBeRemoved.clear()}}toString(){return`Autorun<${this.debugName}>`}beginUpdate(){this.state===3&&(this.state=1),this.updateCount++}endUpdate(){if(this.updateCount===1)do{if(this.state===1){this.state=3;for(let e of this.dependencies)if(e.reportChanges(),this.state===2)break}this._runIfNeeded()}while(this.state!==3);this.updateCount--,w2(()=>this.updateCount>=0)}handlePossibleChange(e){this.state===3&&this.dependencies.has(e)&&!this.dependenciesToBeRemoved.has(e)&&(this.state=1)}handleChange(e,r){this.dependencies.has(e)&&!this.dependenciesToBeRemoved.has(e)&&(!this._handleChange||this._handleChange({changedObservable:e,change:r,didChange:o=>o===e},this.changeSummary))&&(this.state=2)}readObservable(e){if(this.disposed)return e.get();e.addObserver(this);let r=e.get();return this.dependencies.add(e),this.dependenciesToBeRemoved.delete(e),r}};(e=>e.Observer=aF)($y||={});var h0e=require("path"),pF=H(require("vscode"));var QC=(t,e)=>t===e;var a0e;function c0e(t){a0e=t}var u0e;function l0e(t){u0e=t}var CK;function d0e(t){CK=t}var cF=class{get TChange(){return null}reportChanges(){this.get()}read(e){return e?e.readObservable(this):this.get()}map(e,r){let n=r===void 0?void 0:e,o=r===void 0?e:r;return CK({owner:n,debugName:()=>{let s=sF(o);if(s!==void 0)return s;let c=/^\s*\(?\s*([a-zA-Z_$][a-zA-Z_$0-9]*)\s*\)?\s*=>\s*\1(?:\??)\.([a-zA-Z_$][a-zA-Z_$0-9]*)\s*$/.exec(o.toString());if(c)return`${this.debugName}.${c[2]}`;if(!n)return`${this.debugName} (mapped)`},debugReferenceFn:o},s=>o(this.read(s),s))}flatten(){return CK({owner:void 0,debugName:()=>`${this.debugName} (flattened)`},e=>this.read(e).read(e))}recomputeInitiallyAndOnChange(e,r){return e.add(a0e(this,r)),this}keepObserved(e){return e.add(u0e(this)),this}get debugValue(){return this.get()}},Wy=class extends cF{constructor(){super(...arguments);this.observers=new Set}addObserver(r){let n=this.observers.size;this.observers.add(r),n===0&&this.onFirstObserverAdded()}removeObserver(r){this.observers.delete(r)&&this.observers.size===0&&this.onLastObserverRemoved()}onFirstObserverAdded(){}onLastObserverRemoved(){}};function p0e(t,e){let r=new uF(t,e);try{t(r)}finally{r.finish()}}function f0e(t,e,r){t?e(t):p0e(e,r)}var uF=class{constructor(e,r){this._fn=e;this._getDebugName=r;this.updatingObservers=[];tc()?.handleBeginTransaction(this)}getDebugName(){return this._getDebugName?this._getDebugName():sF(this._fn)}updateObserver(e,r){this.updatingObservers.push({observer:e,observable:r}),e.beginUpdate(r)}finish(){let e=this.updatingObservers;for(let r=0;r<e.length;r++){let{observer:n,observable:o}=e[r];n.endUpdate(o)}this.updatingObservers=null,tc()?.handleEndTransaction()}};function EK(t,e){let r;return typeof t=="string"?r=new Zl(void 0,t,void 0):r=new Zl(t,void 0,void 0),new TK(r,e,QC)}var TK=class extends Wy{constructor(r,n,o){super();this._debugNameData=r;this._equalityComparator=o;this._value=n}get debugName(){return this._debugNameData.getDebugName(this)??"ObservableValue"}get(){return this._value}set(r,n,o){if(o===void 0&&this._equalityComparator(this._value,r))return;let s;n||(n=s=new uF(()=>{},()=>`Setting ${this.debugName}`));try{let a=this._value;this._setValue(r),tc()?.handleObservableChanged(this,{oldValue:a,newValue:r,change:o,didChange:!0,hadValue:!0});for(let c of this.observers)n.updateObserver(c,this),c.handleChange(this,o)}finally{s&&s.finish()}}toString(){return`${this.debugName}: ${this._value}`}_setValue(r){this._value=r}};function m0e(t,e){return new wK(new Zl(t.owner,t.debugName,t.debugReferenceFn),e,void 0,void 0,t.onLastObserverRemoved,t.equalsFn??QC)}d0e(m0e);var wK=class extends Wy{constructor(r,n,o,s,a=void 0,c){super();this._debugNameData=r;this._computeFn=n;this.createChangeSummary=o;this._handleChange=s;this._handleLastObserverRemoved=a;this._equalityComparator=c;this.state=0;this.value=void 0;this.updateCount=0;this.dependencies=new Set;this.dependenciesToBeRemoved=new Set;this.changeSummary=void 0;this.changeSummary=this.createChangeSummary?.(),tc()?.handleDerivedCreated(this)}get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}onLastObserverRemoved(){this.state=0,this.value=void 0;for(let r of this.dependencies)r.removeObserver(this);this.dependencies.clear(),this._handleLastObserverRemoved?.()}get(){if(this.observers.size===0){let r=this._computeFn(this,this.createChangeSummary?.());return this.onLastObserverRemoved(),r}else{do{if(this.state===1){for(let r of this.dependencies)if(r.reportChanges(),this.state===2)break}this.state===1&&(this.state=3),this._recomputeIfNeeded()}while(this.state!==3);return this.value}}_recomputeIfNeeded(){if(this.state===3)return;let r=this.dependenciesToBeRemoved;this.dependenciesToBeRemoved=this.dependencies,this.dependencies=r;let n=this.state!==0,o=this.value;this.state=3;let s=this.changeSummary;this.changeSummary=this.createChangeSummary?.();try{this.value=this._computeFn(this,s)}finally{for(let c of this.dependenciesToBeRemoved)c.removeObserver(this);this.dependenciesToBeRemoved.clear()}let a=n&&!this._equalityComparator(o,this.value);if(tc()?.handleDerivedRecomputed(this,{oldValue:o,newValue:this.value,change:void 0,didChange:a,hadValue:n}),a)for(let c of this.observers)c.handleChange(this,void 0)}toString(){return`LazyDerived<${this.debugName}>`}beginUpdate(r){this.updateCount++;let n=this.updateCount===1;if(this.state===3&&(this.state=1,!n))for(let o of this.observers)o.handlePossibleChange(this);if(n)for(let o of this.observers)o.beginUpdate(this)}endUpdate(r){if(this.updateCount--,this.updateCount===0){let n=[...this.observers];for(let o of n)o.endUpdate(this)}w2(()=>this.updateCount>=0)}handlePossibleChange(r){if(this.state===3&&this.dependencies.has(r)&&!this.dependenciesToBeRemoved.has(r)){this.state=1;for(let n of this.observers)n.handlePossibleChange(this)}}handleChange(r,n){if(this.dependencies.has(r)&&!this.dependenciesToBeRemoved.has(r)){let o=this._handleChange?this._handleChange({changedObservable:r,change:n,didChange:a=>a===r},this.changeSummary):!0,s=this.state===3;if(o&&(this.state===1||s)&&(this.state=2,s))for(let a of this.observers)a.handlePossibleChange(this)}}readObservable(r){r.addObserver(this);let n=r.get();return this.dependencies.add(r),this.dependenciesToBeRemoved.delete(r),n}addObserver(r){let n=!this.observers.has(r)&&this.updateCount>0;super.addObserver(r),n&&r.beginUpdate(this)}removeObserver(r){let n=this.observers.has(r)&&this.updateCount>0;super.removeObserver(r),n&&r.endUpdate(this)}};function dF(...t){let e,r,n;return t.length===3?[e,r,n]=t:[r,n]=t,new Hv(new Zl(e,void 0,n),r,n,()=>Hv.globalTransaction,QC)}var Hv=class extends Wy{constructor(r,n,o,s,a){super();this._debugNameData=r;this.event=n;this._getValue=o;this._getTransaction=s;this._equalityComparator=a;this.hasValue=!1;this.handleEvent=r=>{let n=this._getValue(r),o=this.value,s=!this.hasValue||!this._equalityComparator(o,n),a=!1;s&&(this.value=n,this.hasValue&&(a=!0,f0e(this._getTransaction(),c=>{tc()?.handleFromEventObservableTriggered(this,{oldValue:o,newValue:n,change:void 0,didChange:s,hadValue:this.hasValue});for(let u of this.observers)c.updateObserver(u,this),u.handleChange(this,void 0)},()=>{let c=this.getDebugName();return"Event fired"+(c?`: ${c}`:"")})),this.hasValue=!0),a||tc()?.handleFromEventObservableTriggered(this,{oldValue:o,newValue:n,change:void 0,didChange:s,hadValue:this.hasValue})}}getDebugName(){return this._debugNameData.getDebugName(this)}get debugName(){let r=this.getDebugName();return"From Event"+(r?`: ${r}`:"")}onFirstObserverAdded(){this.subscription=this.event(this.handleEvent)}onLastObserverRemoved(){this.subscription.dispose(),this.subscription=void 0,this.hasValue=!1,this.value=void 0}get(){return this.subscription?(this.hasValue||this.handleEvent(void 0),this.value):this._getValue(void 0)}};(r=>{r.Observer=Hv;function e(n,o){let s=!1;Hv.globalTransaction===void 0&&(Hv.globalTransaction=n,s=!0);try{o()}finally{s&&(Hv.globalTransaction=void 0)}}r.batchEventsGlobally=e})(dF||={});function lWe(t){let e=new lF(!1,void 0);return t.addObserver(e),qa(()=>{t.removeObserver(e)})}l0e(lWe);function dWe(t,e){let r=new lF(!0,e);return t.addObserver(r),e?e(t.get()):t.reportChanges(),qa(()=>{t.removeObserver(r)})}c0e(dWe);var lF=class{constructor(e,r){this._forceRecompute=e;this._handleValue=r;this._counter=0}beginUpdate(e){this._counter++}endUpdate(e){this._counter--,this._counter===0&&this._forceRecompute&&(this._handleValue?this._handleValue(e.get()):e.reportChanges())}handlePossibleChange(e){}handleChange(e,r){}};var RK="---------------------------------",XC=class{constructor(e,r){this._accessor=e;this._instantiationService=r}async reportInline(e,r,n){if(!await this._instantiationService.createInstance(Vv).canReport())return;let s=e.getLatestTurn();if(!s)return;let a=r.intent?this._embedCodeblock("INTENT",r.intent.id):"",c=this._embedCodeblock("CONTEXT",JSON.stringify({document:r.document.uri.toString(),fileIndentInfo:r.fileIndentInfo,language:r.language,wholeRange:r.wholeRange,selection:r.selection},null,"	")),u="",l=s.chatMessages;if(l&&l.length>0){let h=l.map(g=>this._embedCodeblock(g.role.toUpperCase(),g.content)).join(`
`);u=`	${RK}
${this._headerSeparator()}PROMPT MESSAGES:
${h}`}else u=this._embedCodeblock(s.request.type.toUpperCase(),s.request.message);let d=this._embedCodeblock("ASSISTANT",s.response?.message||""),p=this._embedCodeblock("Parsed response",JSON.stringify(n,null,"	")),m=`
<details><summary>Prompt Details</summary>
<p>

${`${a}
${c}
${u}
${d}
${p}
`}

</p>
</details>
`;if(s.requestDebugInformation){let h=`
<details><summary>STest</summary>
<p>
STest code:

\`\`\`ts
${kK(s)}
\`\`\`
</p>
</details>
		`;m=m+`
${h}`}await this._reportIssue("Feedback for inline chat",m)}async reportChat(e){if(!await this._instantiationService.createInstance(Vv).canReport())return;let n="",o=e.chatMessages;if(o&&o.length>0){let p=o.map(f=>this._embedCodeblock(f.role.toUpperCase(),f.content)).join(`
`);n=`	${RK}
${this._headerSeparator()}PROMPT MESSAGES:
${p}`}else n=this._embedCodeblock(e.request.type.toUpperCase(),e.request.message);let s=e.intentInvocation?.intent?this._embedCodeblock("INTENT",`[${e.intentInvocation.intent.id}] ${e.intentInvocation.intent.description}`):"",a=this._embedCodeblock("ASSISTANT",e.response?.message||""),c=await c5(this._accessor,[]),u=this._embedCodeblock("WORKSPACE STATE",JSON.stringify(c,null,2)),d=`
<details><summary>Prompt Details</summary>
<p>

${`${s}
${n}
${a}
${u}
`}

</p>
</details>`;await this._reportIssue("Feedback for sidebar chat",d)}_embedCodeblock(e,r){let n=this._bodySeparator()+r.split(`
`).join(`
${this._bodySeparator()}`);return`	${RK}
${this._headerSeparator()}${e}:
${n}`}_headerSeparator(){return"	"}_bodySeparator(){return"		"}async _reportIssue(e,r){await pF.commands.executeCommand("workbench.action.openIssueReporter",{extensionId:Ud,issueTitle:e,data:r,issueBody:"",uri:pF.Uri.parse("https://github.com/microsoft/vscode-copilot")})}};XC=w([b(0,st),b(1,K)],XC);function kK(t){if(!t.requestDebugInformation)return"";let e=(0,h0e.basename)(t.requestDebugInformation.uri.path),r=t.requestDebugInformation.userSelection;return pWe(t.requestDebugInformation.languageId,t.requestDebugInformation.intentId,t.requestDebugInformation.userPrompt,e,t.requestDebugInformation.initialDocumentText,r)}function pWe(t,e,r,n,o,s){let a=[s.start.line,s.start.character,s.end.line,s.end.character];function c(u){return JSON.stringify(u)}return`
stest({ description: 'Issue #XXXXX', language: ${c(t)}, model }, (accessor) => {
	return simulateInlineChat(accessor, {
		files: [toFile({
			fileName: ${c(`${e}/issue-XXXXX/${n}`)},
			fileContent: ${c(o)}
		})],
		queries: [
			{
				file: ${c(n)},
				selection: ${JSON.stringify(a)},
				query: ${c(r)},
				diagnostics: 'tsc',
				expectedIntent: ${c(e)},
				validate: async (outcome, workspace) => {
					assertInlineEdit(outcome);
					await assertNoDiagnostics(accessor, outcome, workspace, KnownDiagnosticProviders.tscIgnoreImportErrors);
				}
			}
		]
	});
});`}var Vv=class{constructor(e,r){this._configurationService=e;this._authenticationService=r;this.debugReportFeedback=dF(this,this._configurationService.onDidChangeConfiguration,()=>this._configurationService.getConfig(de.DebugReportFeedback))}async canReport(){return!(!this._configurationService.getConfig(de.DebugReportFeedback)||!(await this._authenticationService.getCopilotToken())?.isInternal)}};Vv=w([b(0,be),b(1,Nt)],Vv);var JC=class extends dt{constructor(r,n,o){super();this._chatAgentService=r;this._instantiationService=n;let s=this._instantiationService.createInstance(Vv);this._register($y(a=>{let c=s.debugReportFeedback.read(a);$s.commands.executeCommand("setContext","github.copilot.debugReportFeedback",c)})),this._register($s.commands.registerCommand("github.copilot.debug.generateSTest",async()=>{if(!await s.canReport())return;let u=this._chatAgentService.debugGetCurrentChatAgents()?.debugGetLastSession()?.conversation?.getLatestTurn();if(!u)return;let l=kK(u);$s.env.clipboard.writeText(l),$s.window.showInformationMessage("STest copied to clipboard")})),this._register($s.commands.registerCommand("github.copilot.createLaunchJsonFileWithContents",async a=>{let c=$s.workspace.workspaceFolders;if(!c){$s.window.showErrorMessage("No workspace folder is open.");return}await o.add(c[0].uri,a),await o.show(c[0].uri,a.configurations[0].name)})),this._register($s.commands.registerCommand("github.copilot.debug.generateConfiguration",async()=>{let a=await $s.window.showInputBox({prompt:"What type of app are you debugging?"});a&&await $s.commands.executeCommand("workbench.action.chat.open","@vscode /startDebugging "+a,{location:$s.ChatLocation.Panel})}))}};JC=w([b(0,SS),b(1,K),b(2,HC)],JC);var PK=H(require("vscode"));var ZC=class{constructor(e,r,n){this.variable=e;this.endpointProvider=r;this.accessor=n}async invoke(e,r){let n=e.parameters,o=await this.endpointProvider.getEndpointForLocation(2),s=await this.variable.resolve(this.accessor,{endpoint:o,message:n.query},r,{report:()=>{}}),a;return s?a=s.userMessages.join(`

`):a="",{toString(){return a}}}};ZC=w([b(1,Se),b(2,st)],ZC);var eT=class{constructor(e,r){this.endpointProvider=e;this.accessor=r}async invoke(e,r){let n=e.parameters,o=await this.endpointProvider.getEndpointForLocation(2),{messages:s}=await ki(this.accessor.get(K),o,b1,{promptContext:{chatVariables:new Vs([]),query:n.query,history:[],customInstructions:[]},include:{workspaceChunks:!0}},void 0,r);return{toString(){return s.map(a=>a.content).join(`

`)}}}};eT=w([b(0,Se),b(1,st)],eT);function g0e(t){return`copilot_${t}`}var tT=class{constructor(e,r,n){r.subscriptions.push(PK.lm.registerTool("copilot_codebase",e.createInstance(eT))),n.getVariables().forEach(o=>{o.registerTool&&r.subscriptions.push(PK.lm.registerTool(g0e(o.name),e.createInstance(ZC,o)))})}};tT=w([b(0,K),b(1,jt),b(2,xv)],tT);var fWe=[...kfe,g$,b$,y$,Au(iC),Au(uC),Au(BC),Au(YC),Au($C),Au(nC),Au(tT),Au(JC),Au(jC),Au(wv)],v0e=fWe;var vR=require("vscode");var fF=H(require("fs"));var AK=`${process.env.HOME||process.env.USERPROFILE}/.copilot-testing-gh-token`,mWe=`Tests: either GITHUB_PAT must be set, or there must be a GitHub token from an app with access to Copilot in ${AK}. Run "npm run get_token" to get one.`,rT;function b0e(t){if(!rT&&(process.env.GITHUB_PAT&&(rT=t.createInstance(yS,process.env.GITHUB_PAT)),process.env.GITHUB_OAUTH_TOKEN&&(rT=t.createInstance(Yb,process.env.GITHUB_OAUTH_TOKEN)),fF.existsSync(AK))){let e=fF.readFileSync(AK).toString();rT=t.createInstance(Yb,e.trim())}if(!rT)throw new Error(mWe);return rT}var mF=require("vscode");var nT=class extends xS{constructor(r,n,o,s,a){super(o,s,a);this._configurationService=r;this._domainService=n;this._taskSingler=new Sv;this._register(mF.authentication.onDidChangeSessions(c=>{c.provider.id===M5(this._configurationService)&&(this._logService.internal.debug("Handling onDidChangeSession."),this._handleAuthChangeEvent())})),this._register(this._domainService.onDidChangeDomains(c=>{c.dotcomUrlChanged&&(this._logService.internal.debug("Handling onDidChangeDomains."),this.resetCopilotToken())})),this._register(mF.workspace.onDidChangeConfiguration(c=>{c.affectsConfiguration("github.copilot.preferredAccount")&&(this._logService.internal.debug("Handling preferredAccount change."),this._handleAuthChangeEvent())})),this._handleAuthChangeEvent()}async getAnyGitHubSession(r){let n=()=>F5(this._configurationService,r),o=r?.createIfNone||r?.forceNewSession?await n():await this._taskSingler.getOrCreate("any",n);return this._anyGitHubSession=o,o}async getPermissiveGitHubSession(r){let n=()=>qfe(this._configurationService,r),o=r?.createIfNone||r?.forceNewSession?await n():await this._taskSingler.getOrCreate("permissive",n);return this._permissiveGitHubSession=o,o}};nT=w([b(0,be),b(1,Xr),b(2,oe),b(3,Ga),b(4,Qb)],nT);var y0e=H(require("vscode"));var hF=class extends dt{constructor(){super()}async executeCommand(e,r,...n){try{y0e.commands.executeCommand(e,...n),r.sendMSFTTelemetryEvent("automaticCommandExecutedSucceeded",{command:e,args:n?.join(",")})}catch(o){r.sendMSFTTelemetryEvent("automaticCommandExecutedFailed",{command:e,args:n?.join(","),e:o})}}};var Ip=H(require("vscode"));function _0e(t){return typeof t=="string"?t:JSON.stringify(t)}var gF=class extends IL{constructor(){super();this._onDidChangeConfiguration=new Yt;this.onDidChangeConfiguration=this._onDidChangeConfiguration.event;this.config=Ip.workspace.getConfiguration(Pd),Ip.workspace.onDidChangeConfiguration(r=>{r.affectsConfiguration(Pd)&&(this.config=Ip.workspace.getConfiguration(Pd)),this._onDidChangeConfiguration.fire(r)})}getConfig(r){let n=this._getConfiguredValue(r);return n!==void 0?n:r.defaultValue}inspectConfig(r){return this.config.inspect(r.id)}getNonExtensionConfig(r){return Ip.workspace.getConfiguration().get(r)}_getTargetFromInspect(r){let n;return r?r.workspaceFolderValue!==void 0?n=Ip.ConfigurationTarget.WorkspaceFolder:r.workspaceValue!==void 0?n=Ip.ConfigurationTarget.Workspace:n=Ip.ConfigurationTarget.Global:n=Ip.ConfigurationTarget.Global,n}_setAdvancedConfig(r,n){let o=this.config.get(r.firstPart);return o?o[r.secondPart]=n:o={[r.secondPart]:n},this.config.update(r.firstPart,o,this._getTargetFromInspect(this.config.inspect(r.firstPart)))}_setRegularConfig(r,n){return this.config.update(r.id,n,this._getTargetFromInspect(this.config.inspect(r.id)))}setConfig(r,n){return r.firstPart==="advanced"?this._setAdvancedConfig(r,n):this._setRegularConfig(r,n)}getExperimentBasedConfig(r,n){let o=this._getConfiguredValue(r);if(o!==void 0)return o;let s=n.getTreatmentVariable("vscode",`copilotchat.config.${r.id}`);return s!==void 0?s:r.defaultValue}_getConfiguredValue(r){if(this.config[r.firstPart]&&this.config[r.firstPart][r.secondPart]!==void 0)return this.config[r.firstPart][r.secondPart];let n=this.config.get(r.id);if(n!==void 0)return n}dumpConfig(){let r={};try{let n=Va.contributes.configuration?.properties??{};for(let o in n){let a=o.replace(`${Pd}.`,"").split(".").reduce((c,u)=>c[u],this.config);typeof a=="object"&&a!==null?Object.keys(a).filter(c=>c!=="secret_key").forEach(c=>r[`${o}.${c}`]=_0e(a[c])):r[o]=_0e(a)}}catch(n){console.error(`Failed to retrieve configuration properties ${n}`)}return r}};var LK=require("vscode"),x0e=[];function S0e(){return x0e.join(`
`)}function hWe(t,e){t.push(gWe(e)),t.length>40&&t.shift()}var DK=class{constructor(e){this.session=e}onWillStartSession(){}onWillReceiveMessage(e){}onDidSendMessage(e){if(LK.debug.activeDebugSession!==this.session)return;let r=this.extractOutput(e);r&&hWe(x0e,r)}extractOutput(e){if(e.event==="output"&&(e.body.category==="stdout"||e.body.category==="stderr"))return e.body.output}onWillStopSession(){}onError(e){}onExit(e,r){}};function gWe(t){let e=/(:?\x1b\[|\x9B)[=?>!]?[\d;:]*["$#'* ]?[a-zA-Z@^`{}|~]/g;return t&&(t=t.replace(e,"")),t}function I0e(){return[LK.debug.registerDebugAdapterTrackerFactory("*",new NK)]}var NK=class{createDebugAdapterTracker(e){return new DK(e)}};var vF=class extends dt{constructor(){super();for(let e of I0e())this._register(e)}get consoleOutput(){return S0e()}};var bF=ie("IDialogService");var C0e=H(require("vscode")),yF=class{showQuickPick(e,r,n){return C0e.window.showQuickPick(e,r,n)}};var E0e=H(require("path"));var wo=class t{static fromRange(e){return new t(e.startLineNumber,e.endLineNumber)}static fromRangeInclusive(e){return new t(e.startLineNumber,e.endLineNumber+1)}static subtract(e,r){return r?e.startLineNumber<r.startLineNumber&&r.endLineNumberExclusive<e.endLineNumberExclusive?[new t(e.startLineNumber,r.startLineNumber),new t(r.endLineNumberExclusive,e.endLineNumberExclusive)]:r.startLineNumber<=e.startLineNumber&&e.endLineNumberExclusive<=r.endLineNumberExclusive?[]:r.endLineNumberExclusive<e.endLineNumberExclusive?[new t(Math.max(r.endLineNumberExclusive,e.startLineNumber),e.endLineNumberExclusive)]:[new t(e.startLineNumber,Math.min(r.startLineNumber,e.endLineNumberExclusive))]:[e]}static joinMany(e){if(e.length===0)return[];let r=new _F(e[0].slice());for(let n=1;n<e.length;n++)r=r.getUnion(new _F(e[n].slice()));return r.ranges}static join(e){if(e.length===0)throw new Qr("lineRanges cannot be empty");let r=e[0].startLineNumber,n=e[0].endLineNumberExclusive;for(let o=1;o<e.length;o++)r=Math.min(r,e[o].startLineNumber),n=Math.max(n,e[o].endLineNumberExclusive);return new t(r,n)}static ofLength(e,r){return new t(e,e+r)}static deserialize(e){return new t(e[0],e[1])}constructor(e,r){if(e>r)throw new Qr(`startLineNumber ${e} cannot be after endLineNumberExclusive ${r}`);this.startLineNumber=e,this.endLineNumberExclusive=r}contains(e){return this.startLineNumber<=e&&e<this.endLineNumberExclusive}get isEmpty(){return this.startLineNumber===this.endLineNumberExclusive}delta(e){return new t(this.startLineNumber+e,this.endLineNumberExclusive+e)}deltaLength(e){return new t(this.startLineNumber,this.endLineNumberExclusive+e)}get length(){return this.endLineNumberExclusive-this.startLineNumber}join(e){return new t(Math.min(this.startLineNumber,e.startLineNumber),Math.max(this.endLineNumberExclusive,e.endLineNumberExclusive))}toString(){return`[${this.startLineNumber},${this.endLineNumberExclusive})`}intersect(e){let r=Math.max(this.startLineNumber,e.startLineNumber),n=Math.min(this.endLineNumberExclusive,e.endLineNumberExclusive);if(r<=n)return new t(r,n)}intersectsStrict(e){return this.startLineNumber<e.endLineNumberExclusive&&e.startLineNumber<this.endLineNumberExclusive}overlapOrTouch(e){return this.startLineNumber<=e.endLineNumberExclusive&&e.startLineNumber<=this.endLineNumberExclusive}equals(e){return this.startLineNumber===e.startLineNumber&&this.endLineNumberExclusive===e.endLineNumberExclusive}toInclusiveRange(){return this.isEmpty?null:new Xe(this.startLineNumber,1,this.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER)}toExclusiveRange(){return new Xe(this.startLineNumber,1,this.endLineNumberExclusive,1)}mapToLineArray(e){let r=[];for(let n=this.startLineNumber;n<this.endLineNumberExclusive;n++)r.push(e(n));return r}forEach(e){for(let r=this.startLineNumber;r<this.endLineNumberExclusive;r++)e(r)}serialize(){return[this.startLineNumber,this.endLineNumberExclusive]}includes(e){return this.startLineNumber<=e&&e<this.endLineNumberExclusive}toOffsetRange(){return new Qt(this.startLineNumber-1,this.endLineNumberExclusive-1)}},_F=class t{constructor(e=[]){this._normalizedRanges=e}get ranges(){return this._normalizedRanges}addRange(e){if(e.length===0)return;let r=zx(this._normalizedRanges,o=>o.endLineNumberExclusive>=e.startLineNumber),n=Fh(this._normalizedRanges,o=>o.startLineNumber<=e.endLineNumberExclusive)+1;if(r===n)this._normalizedRanges.splice(r,0,e);else if(r===n-1){let o=this._normalizedRanges[r];this._normalizedRanges[r]=o.join(e)}else{let o=this._normalizedRanges[r].join(this._normalizedRanges[n-1]).join(e);this._normalizedRanges.splice(r,n-r,o)}}contains(e){let r=Kq(this._normalizedRanges,n=>n.startLineNumber<=e);return!!r&&r.endLineNumberExclusive>e}intersects(e){let r=Kq(this._normalizedRanges,n=>n.startLineNumber<e.endLineNumberExclusive);return!!r&&r.endLineNumberExclusive>e.startLineNumber}getUnion(e){if(this._normalizedRanges.length===0)return e;if(e._normalizedRanges.length===0)return this;let r=[],n=0,o=0,s=null;for(;n<this._normalizedRanges.length||o<e._normalizedRanges.length;){let a=null;if(n<this._normalizedRanges.length&&o<e._normalizedRanges.length){let c=this._normalizedRanges[n],u=e._normalizedRanges[o];c.startLineNumber<u.startLineNumber?(a=c,n++):(a=u,o++)}else n<this._normalizedRanges.length?(a=this._normalizedRanges[n],n++):(a=e._normalizedRanges[o],o++);s===null?s=a:s.endLineNumberExclusive>=a.startLineNumber?s=new wo(s.startLineNumber,Math.max(s.endLineNumberExclusive,a.endLineNumberExclusive)):(r.push(s),s=a)}return s!==null&&r.push(s),new t(r)}subtractFrom(e){let r=zx(this._normalizedRanges,a=>a.endLineNumberExclusive>=e.startLineNumber),n=Fh(this._normalizedRanges,a=>a.startLineNumber<=e.endLineNumberExclusive)+1;if(r===n)return new t([e]);let o=[],s=e.startLineNumber;for(let a=r;a<n;a++){let c=this._normalizedRanges[a];c.startLineNumber>s&&o.push(new wo(s,c.startLineNumber)),s=c.endLineNumberExclusive}return s<e.endLineNumberExclusive&&o.push(new wo(s,e.endLineNumberExclusive)),new t(o)}toString(){return this._normalizedRanges.map(e=>e.toString()).join(", ")}getIntersection(e){let r=[],n=0,o=0;for(;n<this._normalizedRanges.length&&o<e._normalizedRanges.length;){let s=this._normalizedRanges[n],a=e._normalizedRanges[o],c=s.intersect(a);c&&!c.isEmpty&&r.push(c),s.endLineNumberExclusive<a.endLineNumberExclusive?n++:o++}return new t(r)}getWithDelta(e){return new t(this._normalizedRanges.map(r=>r.delta(e)))}};var xF=class t{constructor(e,r){this.lineRangeMapping=e,this.changes=r}flip(){return new t(this.lineRangeMapping.flip(),this.changes.map(e=>e.flip()))}};var SF=class t{constructor(e,r){this.lineCount=e;this.columnCount=r}static{this.zero=new t(0,0)}static lengthDiffNonNegative(e,r){return r.isLessThan(e)?t.zero:e.lineCount===r.lineCount?new t(0,r.columnCount-e.columnCount):new t(r.lineCount-e.lineCount,r.columnCount)}static betweenPositions(e,r){return e.lineNumber===r.lineNumber?new t(0,r.column-e.column):new t(r.lineNumber-e.lineNumber,r.column-1)}static ofRange(e){return t.betweenPositions(e.getStartPosition(),e.getEndPosition())}static ofText(e){let r=0,n=0;for(let o of e)o===`
`?(r++,n=0):n++;return new t(r,n)}isZero(){return this.lineCount===0&&this.columnCount===0}isLessThan(e){return this.lineCount!==e.lineCount?this.lineCount<e.lineCount:this.columnCount<e.columnCount}isGreaterThan(e){return this.lineCount!==e.lineCount?this.lineCount>e.lineCount:this.columnCount>e.columnCount}isGreaterThanOrEqualTo(e){return this.lineCount!==e.lineCount?this.lineCount>e.lineCount:this.columnCount>=e.columnCount}equals(e){return this.lineCount===e.lineCount&&this.columnCount===e.columnCount}compare(e){return this.lineCount!==e.lineCount?this.lineCount-e.lineCount:this.columnCount-e.columnCount}add(e){return e.lineCount===0?new t(this.lineCount,this.columnCount+e.columnCount):new t(this.lineCount+e.lineCount,e.columnCount)}createRange(e){return this.lineCount===0?new Xe(e.lineNumber,e.column,e.lineNumber,e.column+this.columnCount):new Xe(e.lineNumber,e.column,e.lineNumber+this.lineCount,this.columnCount+1)}toRange(){return new Xe(1,1,this.lineCount+1,this.columnCount+1)}addToPosition(e){return this.lineCount===0?new tr(e.lineNumber,e.column+this.columnCount):new tr(e.lineNumber+this.lineCount,this.columnCount+1)}toString(){return`${this.lineCount},${this.columnCount}`}};var IF=class{constructor(e,r){this.range=e;this.text=r}get isEmpty(){return this.range.isEmpty()&&this.text.length===0}static equals(e,r){return e.range.equalsRange(r.range)&&e.text===r.text}toSingleEditOperation(){return{range:this.range,text:this.text}}};var R2=class t{static inverse(e,r,n){let o=[],s=1,a=1;for(let u of e){let l=new t(new wo(s,u.original.startLineNumber),new wo(a,u.modified.startLineNumber));l.modified.isEmpty||o.push(l),s=u.original.endLineNumberExclusive,a=u.modified.endLineNumberExclusive}let c=new t(new wo(s,r+1),new wo(a,n+1));return c.modified.isEmpty||o.push(c),o}static clip(e,r,n){let o=[];for(let s of e){let a=s.original.intersect(r),c=s.modified.intersect(n);a&&!a.isEmpty&&c&&!c.isEmpty&&o.push(new t(a,c))}return o}constructor(e,r){this.original=e,this.modified=r}toString(){return`{${this.original.toString()}->${this.modified.toString()}}`}flip(){return new t(this.modified,this.original)}join(e){return new t(this.original.join(e.original),this.modified.join(e.modified))}get changedLineCount(){return Math.max(this.original.length,this.modified.length)}toRangeMapping(){let e=this.original.toInclusiveRange(),r=this.modified.toInclusiveRange();if(e&&r)return new Cp(e,r);if(this.original.startLineNumber===1||this.modified.startLineNumber===1){if(!(this.modified.startLineNumber===1&&this.original.startLineNumber===1))throw new Qr("not a valid diff");return new Cp(new Xe(this.original.startLineNumber,1,this.original.endLineNumberExclusive,1),new Xe(this.modified.startLineNumber,1,this.modified.endLineNumberExclusive,1))}else return new Cp(new Xe(this.original.startLineNumber-1,Number.MAX_SAFE_INTEGER,this.original.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),new Xe(this.modified.startLineNumber-1,Number.MAX_SAFE_INTEGER,this.modified.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER))}toRangeMapping2(e,r){if(T0e(this.original.endLineNumberExclusive,e)&&T0e(this.modified.endLineNumberExclusive,r))return new Cp(new Xe(this.original.startLineNumber,1,this.original.endLineNumberExclusive,1),new Xe(this.modified.startLineNumber,1,this.modified.endLineNumberExclusive,1));if(!this.original.isEmpty&&!this.modified.isEmpty)return new Cp(Xe.fromPositions(new tr(this.original.startLineNumber,1),iT(new tr(this.original.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),e)),Xe.fromPositions(new tr(this.modified.startLineNumber,1),iT(new tr(this.modified.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),r)));if(this.original.startLineNumber>1&&this.modified.startLineNumber>1)return new Cp(Xe.fromPositions(iT(new tr(this.original.startLineNumber-1,Number.MAX_SAFE_INTEGER),e),iT(new tr(this.original.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),e)),Xe.fromPositions(iT(new tr(this.modified.startLineNumber-1,Number.MAX_SAFE_INTEGER),r),iT(new tr(this.modified.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),r)));throw new Qr}};function iT(t,e){if(t.lineNumber<1)return new tr(1,1);if(t.lineNumber>e.length)return new tr(e.length,e[e.length-1].length+1);let r=e[t.lineNumber-1];return t.column>r.length+1?new tr(t.lineNumber,r.length+1):t}function T0e(t,e){return t>=1&&t<=e.length}var CF=class t extends R2{static fromRangeMappings(e){let r=wo.join(e.map(o=>wo.fromRangeInclusive(o.originalRange))),n=wo.join(e.map(o=>wo.fromRangeInclusive(o.modifiedRange)));return new t(r,n,e)}constructor(e,r,n){super(e,r),this.innerChanges=n}flip(){return new t(this.modified,this.original,this.innerChanges?.map(e=>e.flip()))}withInnerChangesFromLineRanges(){return new t(this.original,this.modified,[this.toRangeMapping()])}},Cp=class t{static assertSorted(e){for(let r=1;r<e.length;r++){let n=e[r-1],o=e[r];if(!(n.originalRange.getEndPosition().isBeforeOrEqual(o.originalRange.getStartPosition())&&n.modifiedRange.getEndPosition().isBeforeOrEqual(o.modifiedRange.getStartPosition())))throw new Qr("Range mappings must be sorted")}}constructor(e,r){this.originalRange=e,this.modifiedRange=r}toString(){return`{${this.originalRange.toString()}->${this.modifiedRange.toString()}}`}flip(){return new t(this.modifiedRange,this.originalRange)}toTextEdit(e){let r=e.getValueOfRange(this.modifiedRange);return new IF(this.originalRange,r)}};var vWe=E0e.join(__dirname,"diffWorker.js"),TF=class{constructor(e=vWe){this._worker=new Ti(()=>new Bg(e,{name:"Diff worker"}))}dispose(){this._worker.rawValue?.terminate()}async computeDiff(e,r,n){let o=await this._worker.value.proxy.computeDiff(e,r,n);return{identical:o.identical,quitEarly:o.quitEarly,changes:a(o.changes),moves:o.moves.map(c=>new xF(new R2(new wo(c[0],c[1]),new wo(c[2],c[3])),a(c[4])))};function a(c){return c.map(u=>new CF(new wo(u[0],u[1]),new wo(u[2],u[3]),u[4]?.map(l=>new Cp(new Xe(l[0],l[1],l[2],l[3]),new Xe(l[4],l[5],l[6],l[7])))))}}};var oT=class{constructor(e,r,n,o,s,a){this._authService=e;this._tokenizerProvider=r;this._telemetryService=n;this._domainService=o;this._envService=s;this._fetcherService=a}async computeEmbeddings(e,r,n,o){let s=e.maxBatchSize,a=e.modelMaxPromptTokens-1;return this.fetchResponseWithBatches(e,r,o,a,s,n?.dimensions,n?.parallelism)}async fetchResponseWithBatches(e,r,n,o,s,a,c=1){for(let p of r)if(this._tokenizerProvider.acquireTokenizer(e).tokenLength(p)>o)return;let u=[],l=[],d=new kd(c);try{for(let p=0;p<r.length;p+=s){let f=r.slice(p,p+s);l.push(d.queue(async()=>{if(n?.isCancellationRequested)return;let m=await this.rawEmbeddingsFetchWithTelemetry(e,_r(),f,a,n);if(m.type==="failed")throw new Error("Embeddings request failed "+m.reason);return m}))}u=(await Promise.all(l)).flatMap(p=>p?.embeddings??[])}catch{return}finally{d.dispose()}if(!n?.isCancellationRequested)return u.length===0?void 0:{model:e.model,embeddings:u}}async rawEmbeddingsFetchWithTelemetry(e,r,n,o,s){let a=Date.now(),c=await this.rawEmbeddingsFetch(e,r,n,o,s);return c.type==="failed"?(this._telemetryService.sendMSFTTelemetryErrorEvent("embedding.error",{type:c.type,reason:c.reason}),c):(this._telemetryService.sendMSFTTelemetryEvent("embedding.success",{},{batchSize:n.length,inputTokenCount:n.reduce((u,l)=>u+this._tokenizerProvider.acquireTokenizer(e).tokenLength(l),0),timeToComplete:Date.now()-a}),c)}async rawEmbeddingsFetch(e,r,n,o,s){try{let a=await this._authService.getCopilotToken();if(o&&e.model!=="text-embedding-3-small")throw new Error("Dimensions are only supported for text-embeddings-3-small and later models.");let c={input:n,model:e.model,dimensions:o};e.interceptBody?.(c);let u=await Mg(this._fetcherService,this._envService,this._telemetryService,this._domainService,e,a.token,await Pl(process.env.HMAC_SECRET),"copilot-panel",r,c,s),l=u.status===200?await u.json():await u.text();return u.status===200&&l.data?{type:"success",embeddings:l.data.map(d=>d.embedding)}:{type:"failed",reason:l.error}}catch(a){let c=a?.message??"Unknown error";return c.match(/Unexpected.*JSON/i)&&(c="timeout"),{type:"failed",reason:c}}}};oT=w([b(0,Nt),b(1,yr),b(2,he),b(3,Xr),b(4,St),b(5,nn)],oT);var w0e="github-enterprise.uri",sT=class extends dt{constructor(r,n){super();this._configurationService=r;this._tokenStore=n;this._onDidChangeDomains=this._register(new Yt);this.onDidChangeDomains=this._onDidChangeDomains.event;this._telemetryBaseUrl="https://copilot-telemetry.githubusercontent.com";this._register(this._configurationService.onDidChangeConfiguration(s=>this._onDidConfigChangeHandler(s))),this._dotcomAPIUrl=this._getDotComAPIUrl();let o=this._configurationService.getConfig(de.DebugOverrideCAPIUrl);o.endsWith("/")&&(o=o.slice(0,-1)),this._capiBaseUrl=o,this._capiBaseUrl==="https://api.githubcopilot.com"&&(this._processCopilotToken(this._tokenStore.copilotToken),this._register(this._tokenStore.onDidStoreUpdate(()=>this._processCopilotToken(this._tokenStore.copilotToken))))}_onDidConfigChangeHandler(r){if(r.affectsConfiguration(`${Pd}.advanced`)||r.affectsConfiguration(w0e)){let n=this._getDotComAPIUrl();this._dotcomAPIUrl!==n&&(this._dotcomAPIUrl=n,this._onDidChangeDomains.fire({capiUrlChanged:!1,telemeryUrlChanged:!1,dotcomUrlChanged:!0}))}}_getDotComAPIUrl(){let r=this._configurationService.getNonExtensionConfig(w0e),n=this._configurationService.getConfig(de.AuthProvider)==="github-enterprise";if(r&&n){let o=Ye.parse(r);return`${o.scheme}://api.${o.authority}`}return"https://api.github.com"}_processCopilotToken(r){let n=this._capiBaseUrl,o=this._telemetryBaseUrl;r?(this._capiBaseUrl=r.endpoints.api,this._telemetryBaseUrl=r.endpoints.telemetry):(this._capiBaseUrl="https://api.githubcopilot.com",this._telemetryBaseUrl="https://copilot-telemetry.githubusercontent.com"),(n!==this._capiBaseUrl||o!==this._telemetryBaseUrl)&&this._onDidChangeDomains.fire({capiUrlChanged:n!==this._capiBaseUrl,telemeryUrlChanged:o!==this._telemetryBaseUrl,dotcomUrlChanged:!1})}get capiBaseURL(){return this._capiBaseUrl}get capiChatURL(){return`${this._capiBaseUrl}/chat/completions`}get capiEmbeddingsURL(){return`${this._capiBaseUrl}/embeddings`}get capiModelsURL(){return`${this._capiBaseUrl}/models`}get chunksURL(){return`${this.dotComAPIURL}/chunks`}get telemetryURL(){return`${this._telemetryBaseUrl}/telemetry`}get remoteAgentsURL(){return`${this._capiBaseUrl}/agents`}get listSkillsURL(){return`${this._capiBaseUrl}/skills`}get searchSkillURL(){return`${this._capiBaseUrl}/search`}get contentExclusionURL(){return`${this._dotcomAPIUrl}/copilot_internal/content_exclusion`}get tokenURL(){return this._dotcomAPIUrl+"/copilot_internal/v2/token"}get dotComAPIURL(){return this._dotcomAPIUrl}};sT=w([b(0,be),b(1,Ga)],sT);var Ky=H(require("vscode"));var EF=class{get sessionId(){return Ky.env.sessionId}get machineId(){return Ky.env.machineId}get OS(){switch(Foe){case 3:return"Windows";case 1:return"Mac";case 2:return"Linux";default:return"Linux"}}get language(){return Ky.env.language}get uriScheme(){return Ky.env.uriScheme}isProduction(){return bL}isPreRelease(){return da}getBuildType(){return Va.buildType}getVersion(){return Va.version}getBuild(){return Va.build}getName(){return Va.name}getEditorInfo(){return new MR("vscode",Ky.version)}getEditorPluginInfo(){return new MR("copilot-chat",Va.version)}getEditorVersionHeaders(){return{"Editor-Version":this.getEditorInfo().format(),"Editor-Plugin-Version":this.getEditorPluginInfo().format()}}};var k2=H(require("vscode")),wF=class{get all(){return k2.extensions.all}get allAcrossExtensionHosts(){return k2.extensions.allAcrossExtensionHosts}get onDidChange(){return k2.extensions.onDidChange}get getExtension(){return k2.extensions.getExtension}};var RF=class extends TS{constructor(){super()}async readFile(e){return super.readFile(e)}};var Gv=H(require("vscode"));var aT=class{constructor(e){this._logService=e;this._onDidChange=new Gv.EventEmitter;this.onDidChange=this._onDidChange.event;this._extensionEnablement=void 0;this._disposables=[];this._logService.public.info("Initializing Git extension service."),this._disposables.push(...this._initializeExtensionApi())}getExtensionApi(){return this._api}get extensionAvaiable(){return this._extensionEnablement===void 0?!!Gv.extensions.getExtension("vscode.git"):this._extensionEnablement}_initializeExtensionApi(){let e=[],r=Gv.extensions.getExtension("vscode.git"),n=async()=>{let o;try{o=await r.activate(),this._logService.public.info("Successfully activated the vscode.git extension.")}catch(a){this._logService.public.error(a,"Failed to activate the vscode.git extension.");return}let s=a=>{this._logService.public.info(`Enablement state of the vscode.git extension: ${a}.`),this._extensionEnablement=a,a?(this._api=o.getAPI(1),this._onDidChange.fire({enabled:!0}),this._logService.public.info("Successfully registered Git commit message provider.")):(this._api=void 0,this._onDidChange.fire({enabled:!1}))};e.push(o.onDidChangeEnablement(s)),s(o.enabled)};if(r)n();else{this._logService.public.info("vscode.git extension is not yet activated.");let o=Gv.extensions.onDidChange(()=>{!r&&Gv.extensions.getExtension("vscode.git")&&(r=Gv.extensions.getExtension("vscode.git"),n(),o.dispose())})}return e}};aT=w([b(0,oe)],aT);var OK=H(require("vscode"));var ju=class extends dt{constructor(r){super();this.gitExtensionService=r;this._onDidOpenRepository=new Yt;this.onDidOpenRepository=this._onDidOpenRepository.event;this._onDidCloseRepository=new Yt;this.onDidCloseRepository=this._onDidCloseRepository.event;this._onDidFinishInitialRepositoryDiscovery=new Yt;this.onDidFinishInitialization=this._onDidFinishInitialRepositoryDiscovery.event;this._isInitialized=!1;this._register(this._onDidOpenRepository),this._register(this._onDidCloseRepository),this._register(this._onDidFinishInitialRepositoryDiscovery);let n=this.gitExtensionService.getExtensionApi();n?this.registerGitAPIListeners(n):this._register(this.gitExtensionService.onDidChange(o=>{if(o.enabled){let s=this.gitExtensionService.getExtensionApi();s&&this.registerGitAPIListeners(s)}else this._onDidFinishInitialRepositoryDiscovery.fire()}))}registerGitAPIListeners(r){this._register(r.onDidOpenRepository(n=>{let o=ju.repoToRepoContext(n);o&&this._onDidOpenRepository.fire(o)})),this._register(r.onDidCloseRepository(n=>{let o=ju.repoToRepoContext(n);o&&this._onDidCloseRepository.fire(o)})),r.state==="initialized"&&(this._onDidFinishInitialRepositoryDiscovery.fire(),this._isInitialized=!0),this._register(r.onDidChangeState(n=>{n==="initialized"&&(this._onDidFinishInitialRepositoryDiscovery.fire(),this._isInitialized=!0)}))}get isInitialized(){return this._isInitialized}async openRepository(r){let n=this.gitExtensionService.getExtensionApi();if(!n)return;let o=await n.openRepository(r);return ju.repoToRepoContext(o)}getRepository(r){let n=this.gitExtensionService.getExtensionApi();if(n)return ju.repoToRepoContext(n.getRepository(r))}async initialize(){if(this._isInitialized)return;let r=OK.workspace.workspaceFolders;if(!r)return;let n=this.gitExtensionService.getExtensionApi();if(n)for(let o of r)await n.openRepository(o.uri).catch(()=>{})}static repoToRepoContext(r){if(r)return{rootUri:r.rootUri,headBranchName:r.state.HEAD?.name,headCommitHash:r.state.HEAD?.commit,upstreamBranchName:r.state.HEAD?.upstream?.name,upstreamRemote:r.state.HEAD?.upstream?.remote,isRebasing:r.state.rebaseCommit!==null,remotes:r.state.remotes.map(n=>n.name),remoteFetchUrls:r.state.remotes.map(n=>n.fetchUrl)}}get repositories(){if(!OK.workspace.workspaceFolders)return[];let n=this.gitExtensionService.getExtensionApi();return n?Nr(n.repositories.map(o=>ju.repoToRepoContext(o))):[]}};ju=w([b(0,_o)],ju);var cT=class extends ag{constructor(r,n,o){super(n,o);this._authService=r}async getCurrentAuthedUser(){let r=(await this._authService.getAnyGitHubSession())?.accessToken;if(r)return await this.getCurrentAuthedUserWithToken(r)}async getTeamMembership(r){let n=await this._authService.getAnyGitHubSession(),o=n?.accessToken,s=n?.account.label;if(!(!o||!s))return await this.getTeamMembershipWithToken(r,o,s)}};cT=w([b(0,Nt),b(1,Xr),b(2,nn)],cT);var uT=class{constructor(e){this.accessor=e;this.githubRepositoryInfoCache=new Map;this.fetcherService=e.get(nn)}async _doGetRepositoryInfo(e,r){let n=this.accessor.get(Nt).anyGitHubSession?.accessToken,o={Accept:"application/vnd.github+json","X-GitHub-Api-Version":"2022-11-28"};return n&&(o.Authorization=`Bearer ${n}`),this.fetcherService.fetch(`https://api.github.com/repos/${e}/${r}`,{method:"GET",headers:o})}async getRepositoryInfo(e,r){let n=this.githubRepositoryInfoCache.get(`${e}/${r}`);if(n)return n;let o=await this._doGetRepositoryInfo(e,r);if(o.ok){let s=await o.json();return this.githubRepositoryInfoCache.set(`${e}/${r}`,s),s}throw new Error(`Failed to fetch repository info for ${e}/${r}`)}async isAvailable(e,r){try{return(await this._doGetRepositoryInfo(e,r)).ok}catch{return!1}}async getRepositoryItems(e,r,n){let o=[];try{let s=this.accessor.get(Nt).permissiveGitHubSession?.accessToken,a=n.split("/").map(u=>encodeURIComponent(u)).join("/"),c=await this.fetcherService.fetch(`https://api.github.com/repos/${e}/${r}/contents/${a}`,{method:"GET",headers:{Accept:"application/vnd.github+json","X-GitHub-Api-Version":"2022-11-28",Authorization:`Bearer ${s}`}});if(c.ok){let u=await c.json();if(Array.isArray(u))for(let l of u)"name"in l&&"path"in l&&"type"in l&&"html_url"in l&&(o.push({name:l.name,path:l.path,type:l.type,html_url:l.html_url}),l.type==="dir"&&o.push(...await this.getRepositoryItems(e,r,l.path)))}else return console.error(`Failed to fetch contents from ${e}:${r}:${n}`),[]}catch{return console.error(`Failed to fetch contents from ${e}:${r}:${n}`),[]}return o}async getRepositoryItemContent(e,r,n){try{let o=this.accessor.get(Nt).permissiveGitHubSession?.accessToken,s=n.split("/").map(c=>encodeURIComponent(c)).join("/"),a=await this.fetcherService.fetch(`https://api.github.com/repos/${e}/${r}/contents/${s}`,{method:"GET",headers:{Accept:"application/vnd.github+json","X-GitHub-Api-Version":"2022-11-28",Authorization:`Bearer ${o}`}});if(a.ok){let c=await a.json();if("content"in c){let u=Buffer.from(c.content,"base64");return new Uint8Array(u)}throw new Error("Unexpected data from GitHub")}}catch{console.error(`Failed to contents from ${e}:${r}:${n}`)}}};uT=w([b(0,st)],uT);var Yy=H(require("vscode"));var lT=class{constructor(e,r){this._ignoreService=e;this._store=new ht;this._entries=new Uh(10);this._store.add(Yy.workspace.onDidOpenTextDocument(o=>{for(let[s,a]of Array.from(this._entries))s.isClosed&&s.uri.toString()===o.uri.toString()&&(this._entries.delete(s),this._entries.set(o,a))})),this._store.add(Yy.workspace.onDidChangeTextDocument(o=>{this._entries.delete(o.document)}));let n=async(o,s)=>{if(o.document.uri.scheme==="output")return;let a=o.document,c=this._entries.get(a);c||(c=[],this._entries.set(a,c));for(let u of s){let l=a.offsetAt(u);c.push(l)}c.length>100&&c.splice(0,33),r.internal.trace(`[HEATMAP] for ${a.uri} has ${c.length} entries`)};this._store.add(Yy.window.onDidChangeTextEditorVisibleRanges(o=>{n(o.textEditor,o.visibleRanges.map(s=>s.start))})),this._store.add(Yy.window.onDidChangeTextEditorSelection(o=>{n(o.textEditor,o.selections.map(s=>s.active))})),this._store.add(Yy.window.onDidChangeActiveTextEditor(o=>{o&&n(o,o.selections.map(s=>s.active))}))}dispose(){this._store.dispose(),this._entries.clear()}async getEntries(){let e=[];for(let[r,n]of this._entries.entries()){if(await this._ignoreService.isCopilotIgnored(r.uri))continue;let o=Array.from(new Set(n)).sort();e.push(new yL(r,o))}return e}};lT=w([b(0,ke),b(1,oe)],lT);var MK=H(require("vscode"));var kF=class extends k1{constructor(){super(...arguments);this.onDidChangeDiagnostics=MK.languages.onDidChangeDiagnostics}getDiagnostics(r){return MK.languages.getDiagnostics(r)}};var zv=H(require("vscode")),PF=class{constructor(){}async getDefinitions(e,r){return await zv.commands.executeCommand("vscode.executeDefinitionProvider",e,r)}async getImplementations(e,r){return await zv.commands.executeCommand("vscode.executeImplementationProvider",e,r)}async getReferences(e,r){return await zv.commands.executeCommand("vscode.executeReferenceProvider",e,r)}async getWorkspaceSymbols(e){return await zv.commands.executeCommand("vscode.executeWorkspaceSymbolProvider",e)}async getDocumentSymbols(e){return await zv.commands.executeCommand("vscode.executeDocumentSymbolProvider",e)}getDiagnostics(e){return zv.languages.getDiagnostics(e)}};var dT=class{constructor(e,r,n,o){this._logService=e;this._fetcher=this._getFetcher(o,n,r)}_getFetcher(e,r,n){if(r.getConfig(de.DebugUseElectronFetcher)){let a=dC.create(n);if(a)return this._logService.public.info("Using the Electron fetcher."),a;this._logService.public.info("Can't use the Electron fetcher in this environment.")}return r.getConfig(de.DebugUseNodeFetcher)?(this._logService.public.info("Using the Node fetcher."),new lC(n)):(this._logService.public.info("Using the Helix fetcher."),new UC(e))}fetch(e,r){return this._fetcher.fetch(e,r)}disconnectAll(){return this._fetcher.disconnectAll()}makeAbortController(){return this._fetcher.makeAbortController()}isAbortError(e){return this._fetcher.isAbortError(e)}isDNSLookupFailedError(e){return this._fetcher.isDNSLookupFailedError(e)}isFetcherError(e){return this._fetcher.isFetcherError(e)}getUserMessageForFetcherError(e){return this._fetcher.getUserMessageForFetcherError(e)}};dT=w([b(0,oe),b(1,St),b(2,be),b(3,st)],dT);var FK=H(require("vscode")),AF=class{async loadKerberos(){try{return require(`${FK.env.appRoot}/node_modules.asar/kerberos`)}catch{}try{return require(`${FK.env.appRoot}/node_modules/kerberos`)}catch{}}};var R0e=H(require("os")),UK=H(require("vscode")),DF=class{async loadCaCerts(){let e=await this.loadBuiltInWinCAModule(),r=new Set,n=new e.Crypt32;try{let o;for(;o=n.next();)r.add(bWe(o))}finally{n.done()}return Array.from(r)}async loadBuiltInWinCAModule(){try{return require(`${UK.env.appRoot}/node_modules.asar/@vscode/windows-ca-certs`)}catch{}try{return require(`${UK.env.appRoot}/node_modules/@vscode/windows-ca-certs`)}catch{}}};function bWe(t){let e=["-----BEGIN CERTIFICATE-----"],r=t.toString("base64");for(let n=0;n<r.length;n+=64)e.push(r.substr(n,64));return e.push("-----END CERTIFICATE-----",""),e.join(R0e.EOL)}var Tp=require("vscode");var k0e=require("vscode");var NF=class{constructor(){this._onDidChangeNotebookCellExecutionStateEmitter=new Yt;this.onDidChangeNotebookCellExecutionState=this._onDidChangeNotebookCellExecutionStateEmitter.event;this._disposables=[];this._cellExecution=new WeakMap;this._disposables.push(k0e.workspace.onDidChangeNotebookDocument(e=>{for(let r of e.cellChanges)r.executionSummary&&(r.executionSummary.success===void 0?this._cellExecution.has(r.cell)||(this._cellExecution.set(r.cell,!0),this._onDidChangeNotebookCellExecutionStateEmitter.fire({cell:r.cell,state:2})):(this._cellExecution.delete(r.cell),this._onDidChangeNotebookCellExecutionStateEmitter.fire({cell:r.cell,state:1})))}))}dispose(){this._disposables.forEach(e=>e.dispose())}};var pT=class{constructor(e,r){this._configurationService=e;this._experimentationService=r;this._cellExecution=new Map;this._cellSymbols=new WeakMap;this._executionService=new NF;this._disposables=[];this._isVariableFilteringEnabled=!1;this._isVariableFilteringEnabled=this._experimentationService.getTreatmentVariable("vscode","copilotchat.notebookVariableFiltering")||this._configurationService.getConfig(de.NotebookVariableFilteringEnabled),this._registerExecutionListener()}get isVariableFilteringEnabled(){return this._isVariableFilteringEnabled}_hasJupyterExtension(){return Tp.extensions.getExtension("ms-toolsai.jupyter")?.isActive}async getVariables(e){if(!this._hasJupyterExtension())try{let r=await Tp.commands.executeCommand("vscode.executeNotebookVariableProvider",e);if(r&&Array.isArray(r)){let n=r.map(this._convertResult);return this._filterVariables(e,n)}return[]}catch{return[]}try{let r=await Tp.commands.executeCommand("jupyter.listVariables",e);if(r&&Array.isArray(r)){let n=r.map(this._convertResult);return this._filterVariables(e,n)}return[]}catch{return[]}}_convertResult(e){return"variable"in e?e:{variable:e,hasNamedChildren:!1,indexedChildrenCount:0}}_filterVariables(e,r){if(!this.isVariableFilteringEnabled)return r;let n=new Set;return Tp.workspace.notebookDocuments.find(o=>o.uri.toString()===e.toString())?.getCells().forEach(o=>{let s=this._cellSymbols.get(o);s&&s.forEach(a=>n.add(a.name))}),r.filter(o=>n.has(o.variable.name))}async getPipPackages(e){if(!this._hasJupyterExtension())return[];try{return await Tp.commands.executeCommand("jupyter.listPipPackages",e)}catch{return[]}}setVariables(e,r){}_registerExecutionListener(){this._disposables.push(this._executionService.onDidChangeNotebookCellExecutionState(e=>{let r=e.cell,o=r.notebook.uri.toString(),s=this._cellExecution.get(o);s||(s=[],this._cellExecution.set(o,s));let a=s.findIndex(c=>c.cell===r);a!==-1&&s.splice(a,1),s.push({cell:r,executionCount:r.executionSummary?.executionOrder})})),this._disposables.push(Tp.workspace.onDidChangeNotebookDocument(e=>{if(this.isVariableFilteringEnabled){for(let r of e.cellChanges)r.executionSummary&&r.executionSummary.success&&Tp.commands.executeCommand("vscode.executeDocumentSymbolProvider",r.cell.document.uri).then(o=>{this._cellSymbols.set(r.cell,o||[])}),r.document&&this._cellSymbols.delete(r.cell);for(let r of e.contentChanges)r.removedCells.forEach(n=>{this._cellSymbols.delete(n)})}}))}getCellExecutions(e){return this._cellExecution.get(e.toString())?.map(r=>r.cell)||[]}dispose(){this._disposables.forEach(e=>e.dispose())}};pT=w([b(0,be),b(1,wt)],pT);var P0e=ie("IUrlOpener"),LF=class{constructor(){this.openedUrls=[]}open(e){this.openedUrls.push(e)}};var MF=H(require("vscode")),OF=class{async open(e){await MF.commands.executeCommand("vscode.open",MF.Uri.parse(e))}};var sbe=H(require("path"));var WK={};_n(WK,{_dispose:()=>D0e,_findLastTest:()=>J0e,_getCallExpressions:()=>PWe,_getClassDeclarations:()=>DWe,_getClassReferences:()=>OWe,_getCoarseParentScope:()=>BWe,_getDocumentableNodeIfOnIdentifier:()=>Y0e,_getFineScopes:()=>jWe,_getFixSelectionOfInterest:()=>qWe,_getFunctionBodies:()=>UWe,_getFunctionDefinitions:()=>AWe,_getNodeMatchingSelection:()=>Qy,_getNodeToDocument:()=>K0e,_getNodeToExplain:()=>HWe,_getSemanticChunkTree:()=>FWe,_getStructure:()=>ZWe,_getSymbols:()=>MWe,_getTestableNode:()=>Q0e,_getTestableNodes:()=>X0e,_getTypeDeclarations:()=>NWe,_getTypeReferences:()=>LWe});var FF=class{constructor(e,r){this.syntaxTreeRoot=r;this.roots=[];this.formTree(e)}formTree(e){e.sort((s,a)=>s.mainBlock.startIndex-a.mainBlock.startIndex||s.mainBlock.endIndex-a.mainBlock.endIndex);let r=[],n=()=>r[r.length-1],o=(s,a)=>s.mainBlock.startIndex===a.mainBlock.startIndex&&s.mainBlock.endIndex===a.mainBlock.endIndex;for(let s of e){let a={info:s,children:[]},c=n();if(!c){this.roots.push(a),r.push(a);continue}if(!o(c.info,s)){for(;c&&!Sn.doesContain(c.info.mainBlock,s.mainBlock);)r.pop(),c=n();c?c.children.push(a):this.roots.push(a),r.push(a)}}}};var P2=H(require("path")),yWe=$v(),UF=class{constructor(){this.loadedLanguagesCache=new Map}loadLanguage(e){return this.loadedLanguagesCache.has(e)||this.loadedLanguagesCache.set(e,this._doLoadLanguage(e)),this.loadedLanguagesCache.get(e)}_doLoadLanguage(e){let n=`tree-sitter-${e==="csharp"?"c-sharp":e}.wasm`,o=P2.basename(__dirname)==="dist"?P2.resolve(__dirname,n):P2.resolve(__dirname,"../../../../dist",n);return yWe.Language.load(o)}};var A0e=$v(),BF=class t{static{this.INSTANCE=new t}static{this.CACHE_SIZE_PER_LANGUAGE=5}constructor(){this.caches=new Map,this.languageLoader=new UF,this._parser=null}get parser(){return this._parser||(this._parser=new A0e),this._parser}async parse(e,r){await A0e.init();let n=this.getParseTreeCache(e),o=n.get(r);if(o)return o.createReference();let s=await this.languageLoader.loadLanguage(e);if(this.parser.setLanguage(s),o=n.get(r),o)return o.createReference();let a=this.parser.parse(r);return o=new BK(a),n.put(r,o),o.createReference()}dispose(){this._parser&&(this.parser.delete(),this._parser=null);for(let e of this.caches.values())e.dispose()}getParseTreeCache(e){let r=this.caches.get(e);return r||(r=new JL(t.CACHE_SIZE_PER_LANGUAGE),this.caches.set(e,r)),r}},BK=class{constructor(e){this._tree=new jK(e)}dispose(){this._tree.deref()}createReference(){return new qK(this._tree)}},qK=class{constructor(e){this._parseTree=e;this._parseTree.ref()}get tree(){return this._parseTree.tree}dispose(){this._parseTree.deref()}},jK=class{constructor(e){this._tree=e;this._refCount=1}get tree(){if(this._refCount===0)throw new Error("Cannot access disposed RefCountedParseTree");return this._tree}ref(){if(this._refCount===0)throw new Error("Cannot ref disposed RefCountedParseTree");this._refCount++}deref(){if(this._refCount===0)throw new Error("Cannot deref disposed RefCountedParseTree");this._refCount--,this._refCount===0&&this._tree.delete()}};function D0e(){BF.INSTANCE.dispose()}function pi(t,e){return BF.INSTANCE.parse(t,e)}var hSr=$v(),HK=class{constructor(e){this.language=e;this.map=new Map}getQuery(e){return this.map.has(e)||this.map.set(e,this.language.query(e)),this.map.get(e)}},VK=class t{constructor(){this.map=new Map}static{this.INSTANCE=new t}getQuery(e,r){return this.map.has(e)||this.map.set(e,new HK(e)),this.map.get(e).getQuery(r)}};function Ws(t,e){let r=[];for(let n of t){let s=VK.INSTANCE.getQuery(e.tree.getLanguage(),n).matches(e);r.push(...s)}return r}var vSr=$v();function A2(t,e){switch(e){case"python":case"csharp":return t.children.find(r=>r.type.match(/identifier/))?.text;case"go":{let r=t.children.find(o=>o.type.match(/identifier/));return r?r.text:t.children.find(o=>o.type.match(/spec/))?.children.find(o=>o.type.match(/identifier/))?.text}case"javascript":case"javascriptreact":case"typescript":case"typescriptreact":case"cpp":{let r=t.children.find(o=>o.type.match(/declarator/));return r?r.children.find(o=>o.type.match(/identifier/))?.text:t.children.find(o=>o.type.match(/identifier/))?.text}case"java":return t.children.find(n=>n.type==="identifier")?.text;case"ruby":return t.children.find(r=>r.type.match(/constant|identifier/))?.text;default:return t.children.find(r=>r.type.match(/identifier/))?.text}}function D2(t,e){switch(e){case"typescript":case"tsx":case"javascript":return t.type.match(/definition|declaration|declarator|export_statement/);case"go":return t.type.match(/definition|declaration|declarator|var_spec/);case"cpp":return t.type.match(/definition|declaration|class_specifier/);case"ruby":return t.type.match(/module|class|method|assignment/);default:return t.type.match(/definition|declaration|declarator/)}}var _Sr=$v();function Qy(t,e,r,n=D2){let o=[t.rootNode],s=[];for(;;){let a=o.map(c=>[c,Sn.intersectionSize(c,e)]).filter(([c,u])=>u>0).sort(([c,u],[l,d])=>d-u);if(a.length===0)return s.length===0?void 0:_P(s,([c,u],[l,d])=>u-d)[0];{let c=a.map(([u,l])=>{let d=Sn.len(u),p=Math.abs(Sn.len(e)-l),m=(l-p)/d;return[u,m]});s.push(...c.filter(([u,l])=>n(u,r))),o=[],o.push(...c.flatMap(([u,l])=>u.children))}}}var ur=(()=>{function t(e,...r){return e.length===1?e[0]:e.reduce((n,o,s)=>`${n}${o}${r[s]||""}`,"")}return{typescript:t,javascript:t,python:t,go:t,ruby:t,csharp:t,cpp:t,java:t,rust:t}})();function Hu(t,e){return Object.fromEntries(t.map(r=>[r,e]))}var _We={javascript:[],typescript:[],tsx:[],python:[],csharp:[],go:[],java:[],ruby:[],cpp:[],rust:[]};function Vu(t){for(let e in t){let r=t[e];_We[e].push(...r)}return t}var N0e=Vu({...Hu(["javascript","typescript","tsx"],[`[
			(call_expression
				function: (identifier) @identifier)
			(call_expression
				function: (member_expression
					(property_identifier) @identifier))
		] @call_expression`]),python:[`[
			(call
				function: (identifier) @identifier)
			(call
				function: (attribute
					attribute: (identifier) @identifier))
		] @call_expression`],csharp:[`[
			(invocation_expression
				function: (identifier) @identifier)
			(invocation_expression
				function: (member_access_expression
					name: (identifier) @identifier))
		] @call_expression`],go:[`[
			(call_expression
				((selector_expression
					(field_identifier) @identifier)))
			(call_expression
				(identifier) @identifier)
		] @call_expression`],java:[`[
			(method_invocation
				name: (identifier) @identifier)
		] @call_expression`],ruby:[`[
			(call (identifier) @identifier
				(#not-match? @identifier "new|send|public_send|method"))
			(call
				receiver: (identifier)
				method: (identifier) @method
				(#match? @method "^(send|public_send|method)")
				arguments: (argument_list
					(simple_symbol) @symbol))
		] @call_expression`],cpp:[`[
			(function_declarator
				(identifier) @identifier)
			(function_declarator
				(field_identifier) @identifier)
			(call_expression (identifier) @identifier)
			(call_expression
				(field_expression
					field: (field_identifier) @identifier))
			(call_expression
				(call_expression
					(primitive_type)
					(argument_list
						(pointer_expression
						(identifier) @identifier))))
		] @call_expression`],rust:[`[
			(call_expression (identifier) @identifier)
			(call_expression (field_expression (identifier) (field_identifier) @identifier))
			(call_expression (scoped_identifier (identifier) (identifier) @identifier (#not-match? @identifier "new")))
		] @call_expression`]}),L0e=Vu({...Hu(["javascript","typescript","tsx"],["(class_declaration) @class_declaration"]),java:["(class_declaration) @class_declaration"],csharp:["(class_declaration) @class_declaration"],python:["(class_definition) @class_declaration"],cpp:["(class_specifier) @class_declaration"],ruby:["(class) @class_declaration"],go:[`(type_declaration
			(type_spec
				(type_identifier) @type_identifier)) @class_declaration`],rust:["(impl_item (type_identifier) @type_identifier) @class_declaration"]}),O0e=Vu({typescript:[`[
			(interface_declaration)
			(type_alias_declaration)
		] @type_declaration`],csharp:[`(interface_declaration
			(identifier) @type_identifier) @type_declaration`],cpp:[`[
			(struct_specifier
				(type_identifier) @type_identifier)
			(union_specifier
				(type_identifier) @type_identifier)
			(enum_specifier
				(type_identifier) @type_identifier)
		] @type_declaration`],java:[`(interface_declaration
			(identifier) @type_identifier) @type_declaration`],go:[`(type_declaration
			(type_spec
				(type_identifier) @type_identifier)) @type_declaration`],ruby:["((constant) @type_identifier) @type_declaration"],python:[`(class_definition
			(identifier) @type_identifier) @type_declaration`]}),M0e=Vu({typescript:["(type_identifier) @type_identifier"],go:["(type_identifier) @type_identifier"],ruby:["(constant) @type_identifier"],csharp:[`[
			(base_list
				(identifier) @type_identifier)
			(variable_declaration
				(identifier) @type_identifier)
		]`],cpp:["(type_identifier) @type_identifier"],java:["(type_identifier) @type_identifier"],python:[`[
			(type (identifier) @type_identifier)
			(argument_list
				(identifier) @type_identifier)
		]`]}),F0e=Vu({...Hu(["javascript","typescript","tsx"],[`(new_expression
			constructor: (identifier) @new_expression)`]),python:[`(call
			function: (identifier) @new_expression)`],csharp:[`(object_creation_expression
			(identifier) @new_expression)`],java:[`(object_creation_expression
			(type_identifier) @new_expression)`],cpp:[`[
			(declaration
				(type_identifier) @new_expression)
			(class_specifier
				(type_identifier) @new_expression)
		]`],go:["(composite_literal (type_identifier) @new_expression)"],ruby:[`((call
			receiver: ((constant) @new_expression)
			method: (identifier) @method)
				(#eq? @method "new"))`],rust:[`(call_expression
			(scoped_identifier
				(identifier) @new_expression
				(identifier) @identifier
				(#eq? @identifier "new")))`]}),U0e=Vu({python:[`[
			(function_definition
				name: (identifier) @identifier
				body: (block
						(expression_statement (string))? @docstring) @body)
			(assignment
				left: (identifier) @identifier
				right: (lambda) @body)
		] @function`,'(ERROR ("def" (identifier) (parameters))) @function'],...Hu(["javascript","typescript","tsx"],[`[
			(function_expression
				name: (identifier)? @identifier
				body: (statement_block) @body)
			(function_declaration
				name: (identifier)? @identifier
				body: (statement_block) @body)
			(generator_function
				name: (identifier)? @identifier
				body: (statement_block) @body)
			(generator_function_declaration
				name: (identifier)? @identifier
				body: (statement_block) @body)
			(method_definition
				name: (property_identifier)? @identifier
				body: (statement_block) @body)
			(arrow_function
				body: (statement_block) @body)
		] @function`]),go:[`[
			(function_declaration
				name: (identifier) @identifier
				body: (block) @body)
			(method_declaration
				name: (field_identifier) @identifier
				body: (block) @body)
		] @function`],ruby:[`[
			(method
				name: (_) @identifier
				parameters: (method_parameters)? @params
				[(_)+ "end"] @body)
			(singleton_method
				name: (_) @identifier
				parameters: (method_parameters)? @params
				[(_)+ "end"] @body)
		] @function`],csharp:[`[
			(constructor_declaration
				(identifier) @identifier
				(block) @body)
			(destructor_declaration
				(identifier) @identifier
				(block) @body)
			(operator_declaration
				(block) @body)
			(method_declaration
				(identifier) @identifier
				(block) @body)
			(local_function_statement
				(identifier) @identifier
				(block) @body)
		] @function`],cpp:[`[
			(function_definition
				(_
					(identifier) @identifier)
					(compound_statement) @body)
			(function_definition
				(function_declarator
					(qualified_identifier
						(identifier) @identifier))
					(compound_statement) @body)
		] @function`],java:[`[
			(constructor_declaration
				name: (identifier) @identifier
				body: (constructor_body) @body)
			(method_declaration
				name: (_) @identifier
				body: (block) @body)
			(lambda_expression
				body: (block) @body)
		] @function`],rust:[`[
			(function_item (identifier) @identifier)
			(let_declaration (identifier) @identifier)
		] @function`]}),ESr=Vu({javascript:[ur.javascript`((comment) @comment
			(#match? @comment "^\\\\/\\\\*\\\\*")) @docComment`],...Hu(["typescript","tsx"],[ur.typescript`((comment) @comment
			(#match? @comment "^\\\\/\\\\*\\\\*")) @docComment`]),java:[ur.java`((block_comment) @block_comment
			(#match? @block_comment "^\\\\/\\\\*\\\\*")) @docComment`],cpp:[ur.cpp`((comment) @comment
			(#match? @comment "^\\\\/\\\\*\\\\*")) @docComment`],csharp:[ur.csharp`(
			((comment) @c
				(#match? @c "^\\\\/\\\\/\\\\/"))+
		) @docComment`],rust:[ur.rust`((line_comment) @comment
			(#match? @comment "^\/\/\/|^\/\/!"))+ @docComment`],go:[ur.go`((comment)+) @docComment`],ruby:[ur.ruby`((comment)+) @docComment`],python:[`(expression_statement
			(string) @docComment)`]}),GK=Vu({javascript:[ur.javascript`[
			(function_declaration
				(identifier) @function.identifier
			) @function

			(generator_function_declaration
				name: (identifier) @generator_function.identifier
			) @generator_function

			(class_declaration
				name: (identifier) @class.identifier ;; note: (type_identifier) in typescript
				body: (class_body
							(method_definition
								name: (property_identifier) @method.identifier
							) @method
						)
			) @class
		]`],...Hu(["typescript","tsx"],[ur.typescript`[
				(function_declaration
					(identifier) @function.identifier
				) @function

				(generator_function_declaration
					name: (identifier) @generator_function.identifier
				) @generator_function

				(class_declaration
					name: (type_identifier) @class.identifier
					body: (class_body
								(method_definition
									(accessibility_modifier)? @method.accessibility_modifier
									name: (property_identifier) @method.identifier
									(#not-eq? @method.accessibility_modifier "private")
								) @method
							)
				) @class
			]`]),python:[ur.python`[
				(function_definition
					name: (identifier) @function.identifier
				) @function
			]`],go:[ur.go`[
				(function_declaration
					name: (identifier) @function.identifier
				) @function

				(method_declaration
					name: (field_identifier) @method.identifier
				) @method
			]`],ruby:[ur.ruby`[
				(method
					name: (identifier) @method.identifier
				) @method

				(singleton_method
					name: (_) @singleton_method.identifier
				) @singleton_method
			]`],csharp:[ur.csharp`[
				(constructor_declaration
					(identifier) @constructor.identifier
				) @constructor

				(destructor_declaration
					(identifier) @destructor.identifier
				) @destructor

				(method_declaration
					(identifier) @method.identifier
				) @method

				(local_function_statement
					(identifier) @local_function.identifier
				) @local_function
			]`],cpp:[ur.cpp`[
				(function_definition
					(_
						(identifier) @identifier)
				) @function
			]`],java:[ur.java`(class_declaration
			name: (_) @class.identifier
			body: (_
						[
							(constructor_declaration
								(modifiers)? @constructor.modifiers
								(#not-eq? @constructor.modifiers "private")
								name: (identifier) @constructor.identifier
							) @constructor

							(method_declaration
								(modifiers)? @method.modifiers
								(#not-eq? @method.modifiers "private")
								name: (identifier) @method.identifier
							) @method
						]
					)
		) @class`],rust:[ur.rust`[
				(function_item
					(identifier) @function.identifier
				) @function
			]`]}),B0e=Vu({javascript:[ur.javascript`[
			(identifier) @symbol
			(property_identifier) @symbol
			(private_property_identifier) @symbol
		]`],...Hu(["typescript","tsx"],[ur.typescript`[
			(identifier) @symbol
			(type_identifier) @symbol
			(property_identifier) @symbol
			(private_property_identifier) @symbol
		]`]),cpp:[ur.cpp`[
			(identifier) @symbol
			(type_identifier) @symbol
		]`],csharp:[ur.csharp`[
			(identifier) @symbol
		]`],go:[ur.go`[
			(identifier) @symbol
		]`],java:[ur.java`[
			(identifier) @symbol
		]`],python:[ur.python`[
			(identifier) @symbol
		]`],ruby:[ur.ruby`[
			(identifier) @symbol
		]`],rust:[ur.rust`[
			(identifier) @symbol
		]`]}),q0e=Vu({typescript:[ur.typescript`
			[
				(comment) @comment ;; split into multiple comment kinds?

				(declaration) @declaration

				;; class declaration related
				(public_field_definition) @public_field_definition
				(method_definition) @method_definition
				(class_declaration (_ (method_signature) @method_signature))
				(abstract_method_signature) @abstract_method_signature

				;; enum declaration related
				(enum_assignment) @enum_assignment

				;; interface declaration related
				(interface_declaration (_ (method_signature) @method_signature))
				(interface_declaration (_ (property_signature) @property_signature))

				;; statements

				(import_statement) @import_statement
				(export_statement) @export_statement

				(expression_statement) @expression_statement

				(for_in_statement) @for_in_statement
				;; exclude any children found in the for loop condition
				(for_statement condition: (_) @for_statement.exclude_captures ) @for_statement
				(break_statement) @break_statement
				(continue_statement) @continue_statement
				(do_statement) @do_statement
				(if_statement) @if_statement
				(if_statement
					consequence: [
						(expression_statement)
						(if_statement)
					] @if_statement.exclude_captures)
				(else_clause
					[
						(expression_statement)
						(if_statement) ; for if-else chains
					] @else_clause.exclude_captures)
				(switch_statement) @switch_statement
				(switch_case) @switch_case
				(try_statement) @try_statement
				(throw_statement) @throw_statement
				(debugger_statement) @debugger_statement
				(return_statement) @return_statement
			]
		`],tsx:[ur.typescript`
			[
				(comment) @comment ;; split into multiple comment kinds?

				(declaration) @declaration

				;; class declaration related
				(public_field_definition) @public_field_definition
				(method_definition) @method_definition
				(class_declaration (_ (method_signature) @method_signature))
				(abstract_method_signature) @abstract_method_signature

				;; enum declaration related
				(enum_assignment) @enum_assignment

				;; interface declaration related
				(interface_declaration (_ (method_signature) @method_signature))
				(interface_declaration (_ (property_signature) @property_signature))

				;; statements

				(import_statement) @import_statement
				(export_statement) @export_statement

				(expression_statement) @expression_statement

				(for_in_statement) @for_in_statement
				;; exclude any children found in the for loop condition
				(for_statement condition: (_) @for_statement.exclude_captures ) @for_statement
				(break_statement) @break_statement
				(continue_statement) @continue_statement
				(do_statement) @do_statement
				(if_statement) @if_statement
				(if_statement
					consequence: [
						(expression_statement)
						(if_statement)
					] @if_statement.exclude_captures)
				(else_clause
					[
						(expression_statement)
						(if_statement) ; for if-else chains
					] @else_clause.exclude_captures)
				(switch_statement) @switch_statement
				(switch_case) @switch_case
				(try_statement) @try_statement
				(throw_statement) @throw_statement
				(debugger_statement) @debugger_statement
				(return_statement) @return_statement

				;; jsx
				(jsx_element) @jsx_element
				(jsx_element (_ (jsx_expression) @jsx_expression))
			]
		`],python:[ur.python`
			[
				(comment) @comment

				;; simple statements
				(assert_statement) @assert_statement
				(break_statement) @break_statement
				(continue_statement) @continue_statement
				(delete_statement) @delete_statement
				(exec_statement) @exec_statement
				(expression_statement) @expression_statement
				(future_import_statement) @future_import_statement
				(global_statement) @global_statement
				(import_from_statement) @import_from_statement
				(import_statement) @import_statement
				(nonlocal_statement) @nonlocal_statement
				(pass_statement) @pass_statement
				(print_statement) @print_statement
				(raise_statement) @raise_statement
				(return_statement) @return_statement
				(type_alias_statement) @type_alias_statement


				;; compound statements

				(class_definition) @class_definition
				(decorated_definition) @decorated_definition
				(for_statement) @for_statement
				(function_definition) @function_definition
				(if_statement) @if_statement
				(try_statement) @try_statement
				(while_statement) @while_statement
				(with_statement) @with_statement


				;; expressions

				(expression_list) @expression_list
				(expression_statement) @expression_statement
			]
		`],javascript:[ur.javascript`
			[
				(comment) @comment ;; split into multiple comment kinds?

				(declaration) @declaration

				;; class declaration related

				(field_definition) @field_definition
				(method_definition) @method_definition

				;; statements

				(import_statement) @import_statement
				(export_statement) @export_statement

				(expression_statement) @expression_statement

				(for_in_statement) @for_in_statement
				;; exclude any children found in the for loop condition
				(for_statement condition: (_) @for_statement.exclude_captures ) @for_statement
				(break_statement) @break_statement
				(continue_statement) @continue_statement
				(do_statement) @do_statement
				(if_statement) @if_statement
				(switch_statement) @switch_statement
				(switch_case) @switch_case
				(try_statement) @try_statement
				(throw_statement) @throw_statement
				(debugger_statement) @debugger_statement
				(return_statement) @return_statement
			]`],go:[ur.go`
		[
			(_statement) @statement
			(function_declaration) @function_declaration
			(import_declaration) @import_declaration
			(method_declaration) @method_declaration
			(package_clause) @package_clause

			(if_statement
				initializer: (_) @for_statement.exclude_captures) @for_statement

			(expression_case) @expression_case ;; e.g., case 0:
		]
		`],ruby:[ur.ruby`
			[
				(comment) @comment

				(assignment) @assignment

				(if) @if

				(call) @call

				(case) @case

				(when) @when

				(while) @while

				(for) @for

				(method) @method

				(class) @class

				(module) @module

				(begin) @begin
			]
		`],csharp:[ur.csharp`
			[
				(comment) @comment

				(class_declaration) @class_declaration
				(constructor_declaration) @constructor_declaration
				(method_declaration) @method_declaration
				(delegate_declaration) @delegate_declaration
				(enum_declaration) @enum_declaration
				(extern_alias_directive) @extern_alias_directive
				(file_scoped_namespace_declaration) @file_scoped_namespace_declaration
				(global_attribute) @global_attribute
				(global_statement) @global_statement
				(interface_declaration) @interface_declaration
				(namespace_declaration) @namespace_declaration
				(record_declaration) @record_declaration
				(struct_declaration) @struct_declaration
				(using_directive) @using_directive

				(local_declaration_statement) @local_declaration_statement
				(expression_statement) @expression_statement
				(for_statement) @for_statement
				(foreach_statement) @foreach_statement
				(continue_statement) @continue_statement
				(break_statement) @break_statement
				(throw_statement) @throw_statement
				(return_statement) @return_statement
				(try_statement) @try_statement
			]
		`],cpp:[ur.cpp`
			[
				(declaration) @declaration

				(expression_statement) @expression_statement

				(comment) @comment

				(preproc_include) @preproc_include

				(namespace_definition) @namespace_definition

				(enum_specifier) @enum_specifier

				(struct_specifier) @struct_specifier

				(template_declaration) @template_declaration

				(function_definition) @function_definition

				(return_statement) @return_statement

				(class_specifier) @class_specifier

				(try_statement) @try_statement

				(throw_statement) @throw_statement

				(for_statement) @for_statement
				(for_statement
					initializer:(_) @for_statement.exclude_captures) @for_statement

				(for_range_loop) @for_range_loop
			]
		`],java:[ur.java`
		[
			(statement) @statement ;; @ulugbekna: this includes (declaration); but somehow it can't capture inner classes

			(line_comment) @line_comment
			(block_comment) @block_comment

			(for_statement
				init: (_) @for_statement.exclude_captures)

			(block) @block.exclude_captures

			(field_declaration) @field_declaration
		]
		`],rust:[]}),j0e={...Hu(["typescript","tsx"],["program","interface_declaration","class_declaration","function_declaration","function_expression","type_alias_declaration","method_definition"]),javascript:["program","class_declaration","function_declaration","function_expression","method_definition"],java:["program","class_declaration","interface_declaration","method_declaration"],cpp:["translation_unit","class_specifier","function_definition"],csharp:["compilation_unit","class_declaration","interface_declaration","method_declaration"],python:["module","class_definition","function_definition"],go:["source_file","type_declaration","function_declaration","method_declaration"],ruby:["program","method","class","method"],rust:["source_file","function_item","impl_item","let_declaration"]},H0e=Vu({typescript:[Ep("typescript")],tsx:[Ep("tsx")],javascript:[Ep("javascript")],java:[Ep("java")],cpp:[Ep("cpp")],csharp:[Ep("csharp")],python:[Ep("python")],go:[Ep("go")],ruby:[Ep("ruby")],rust:[Ep("rust")]}),V0e={...Hu(["typescript","tsx","javascript"],["for_in_statement","for_statement","if_statement","while_statement","do_statement","try_statement","switch_statement"]),java:["for_statement","enhanced_for_statement","if_statement","while_statement","do_statement","try_statement","switch_expression"],cpp:["for_statement","for_range_loop","if_statement","while_statement","do_statement","try_statement","switch_statement"],csharp:["for_statement","for_each_statement","if_statement","while_statement","do_statement","try_statement","switch_expression"],python:["for_statement","if_statement","while_statement","try_statement"],go:["for_statement","if_statement","type_switch_statement"],ruby:["while","for","if","case"],rust:["for_statement","if_statement","while_statement","loop_statement","match_expression"]},xWe={...Hu(["typescript","tsx"],["lexical_declaration","expression_statement","public_field_definition"]),javascript:["call_expression","expression_statement","variable_declaration","public_field_definition"],java:["expression_statement","local_variable_declaration","field_declaration"],cpp:["field_declaration","expression_statement","declaration"],csharp:["field_declaration","expression_statement"],python:["expression_statement"],go:["short_var_declaration","call_expression"],ruby:["call","assignment"],rust:["expression_statement","let_declaration","use_declaration","assignment_expression","macro_definition","extern_crate_declaration"]},SWe={...Hu(["typescript","tsx"],["class_declaration","function_declaration","generator_function_declaration","interface_declaration","internal_module","method_definition","abstract_class_declaration"]),javascript:["class_declaration","function_declaration","generator_function_declaration","method_definition"],java:["class_declaration","constructor_declaration","enum_declaration","interface_declaration","method_declaration","module_declaration"],cpp:["class_specifier","function_definition","namespace_definition","struct_specifier"],csharp:["class_declaration","constructor_declaration","destructor_declaration","enum_declaration","interface_declaration","method_declaration","namespace_declaration","struct_declaration"],python:["function_definition","class_definition"],go:["function_declaration","method_declaration"],ruby:["class","method","module"],rust:["function_item","impl_item","mod_item","struct_item","trait_item","union_item"]},G0e=Vu({typescript:[wp("typescript")],tsx:[wp("tsx")],javascript:[wp("javascript")],java:[wp("java")],cpp:[wp("cpp")],csharp:[wp("csharp")],python:[wp("python")],go:[wp("go")],rust:[wp("rust")],ruby:[wp("ruby")]});function Ep(t){return j0e[t].map(e=>`(${e}) @scope`).join(`
`)}function wp(t){return`[
		${SWe[t].map(r=>`(${r})`).join(`
`)}
	] @definition`}function N2(t,e){return j0e[t].includes(e.type)||V0e[t].includes(e.type)}function z0e(t,e){return V0e[t].includes(e.type)}function zK(t,e){return xWe[t].includes(e.type)}var $0e={...Hu(["typescript","tsx"],[ur.typescript`[
			(expression_statement
				(call_expression
					function: (identifier) @fn
					(#any-of? @fn "test" "it")
				)
			) @test
		]`]),javascript:[ur.javascript`[
			(call_expression
				function: (identifier) @fn
				(#any-of? @fn "test" "it")
			) @test
		]`],python:[ur.python`[
			(function_definition
				name: (identifier) @fn
				(#match? @fn "^test_")
			) @test
		]`],java:[ur.java`[
			(method_declaration
				name: (identifier) @fn
				(#match? @fn "^test")
			) @test
		]`],go:[ur.go`[
			(function_declaration
				name: (identifier) @fn
				(#match? @fn "^Test")
			) @test
		]`],ruby:[],csharp:[],cpp:[],rust:[]};var $K=class{constructor(){this._cache=new Od(5)}setCacheSize(e){this._cache=new Od(e)}async getStructure(e,r){let n=`${e}:${r}`,o=this._cache.get(n);return o||(o=await this._getStructure(e,r),this._cache.put(n,o)),o}async _getStructure(e,r){let n=q0e[e];if(n.length===0)return;let o=await pi(e,r);try{let s=Ws(n,o.tree.rootNode).flatMap(l=>l.captures).sort((l,d)=>Sn.compare(l.node,d.node)),a=[];for(let l of s)l.name.endsWith(".exclude_captures")&&a.push(Sn.ofSyntaxNode(l.node));let c=new Gd(0,r.length,"root",[]),u=[c];for(let l=0;l<s.length;++l){let p=s[l].node;if(a.some(h=>Sn.isEqual(h,p)))continue;let f;do f=u.pop();while(f&&!Sn.doesContain(f,p));if(new Set(["export_statement","ambient_declaration"]).has(f.kind))f.kind=p.type,u.push(f);else{let h=p.type;(e==="typescript"||e==="tsx"||e==="javascript")&&h==="method_definition"&&p.namedChildren.some(S=>S.type==="property_identifier"&&S.text==="constructor")&&(h="constructor");let g=p.startIndex,v=p.previousSibling;if(v!==null){let I=r.substring(v.endIndex,p.startIndex).indexOf(`
`);I===-1?g=v.endIndex:g=v.endIndex+I+1}let y=p.endIndex,_=p.nextSibling;if(e==="typescript"&&_!==null&&(_.type===";"||_.type===",")&&(_=_.nextSibling),_!==null){let I=r.substring(p.endIndex,_.startIndex).indexOf(`
`);I!==-1&&(y=p.endIndex+I+1)}let x=new Gd(g,y,h,[]);f.children.push(x),u.push(f,x)}}return c}catch(s){console.error(s instanceof Error?s:new Error(s))}finally{o.dispose()}}},W0e=new $K;var OSr=$v();async function K0e(t,e,r){let n=await pi(t,e);try{let s=r.startIndex===r.endIndex?void 0:Qy(n.tree,r,t);if(s)return{nodeIdentifier:A2(s,t),nodeToDocument:yg.ofSyntaxNode(s),nodeSelectionBy:"matchingSelection"};let c=n.tree.rootNode.descendantForIndex(r.startIndex,r.endIndex),u=0;for(;!D2(c,t)&&c.parent!==null;)c=c.parent,++u;return{nodeIdentifier:A2(c,t),nodeToDocument:yg.ofSyntaxNode(c),nodeSelectionBy:"expanding"}}finally{n.dispose()}}async function Y0e(t,e,r){let n=await pi(t,e);try{let o=n.tree.rootNode.descendantForIndex(r.startIndex,r.endIndex);if(o.type.match(/identifier/)&&(o.parent===null||D2(o.parent,t))){let s=o.parent,a=s===null?void 0:{startIndex:s.startIndex,endIndex:s.endIndex};return{identifier:o.text,nodeRange:a}}}finally{n.dispose()}}async function Q0e(t,e,r){let n=await pi(t,e);try{let o=Ws(GK[t],n.tree.rootNode).flatMap(({captures:c})=>c),s=new Map;for(let c of o){let[u,l]=c.name.split(".");if(l!=="identifier")continue;let d=s.get(u)||[];d.push(c),s.set(u,d)}let a=null;for(let c of o){let[u,l]=c.name.split(".");if(l!==void 0||!Sn.doesContain(c.node,r)||a!==null&&Sn.len(a.node)<Sn.len(c.node))continue;let d=s.get(u);iu(d!==void 0,`must have seen identifier for symbol kind '${u}' (lang: ${t})`);let p=d.find(f=>Sn.doesContain(c.node,f.node));iu(p!==void 0,`must have seen identifier for symbol '${u}' (lang: ${t})`),a={identifier:{name:p.node.text,range:Sn.ofSyntaxNode(p.node)},node:yg.ofSyntaxNode(c.node)}}return a}catch(o){return console.error("getTestableNode: Unexpected error",o),null}finally{n.dispose()}}async function X0e(t,e){let r=await pi(t,e);try{let n=Ws(GK[t],r.tree.rootNode).flatMap(({captures:a})=>a).filter(boe(a=>[a.node.startIndex,a.node.endIndex].toString())),o=new Map;for(let a of n){let[c,u]=a.name.split(".");if(u!=="identifier")continue;let l=o.get(c)||[];l.push(a),o.set(c,l)}let s=[];for(let a of n){if(a.name.includes("."))continue;let c=a.name,u=o.get(c);iu(u!==void 0,`must have seen identifier for symbol kind '${c}' (lang: ${t})`);let l=u.find(d=>Sn.doesContain(a.node,d.node));iu(l!==void 0,`must have seen identifier for symbol '${c}' (lang: ${t})`),s.push({identifier:{name:l.node.text,range:Sn.ofSyntaxNode(l.node)},node:yg.ofSyntaxNode(a.node)})}return s}catch(n){return console.error("getTestableNodes: Unexpected error",n),null}finally{r.dispose()}}async function J0e(t,e){let r=await pi(t,e);try{let o=Ws($0e[t],r.tree.rootNode).flatMap(a=>a.captures).sort((a,c)=>a.node.endIndex-c.node.endIndex).filter(a=>a.name==="test");if(o.length===0)return null;let s=o[o.length-1].node;return{startIndex:s.startIndex,endIndex:s.endIndex}}finally{r.dispose()}}var d1r=$v();function IWe(t,e){let r=H0e[t];return Ws(r,e)}function tbe(t,e){let r=U0e[t];return Ws(r,e)}function CWe(t,e){let r=N0e[t];return r?Ws(r,e):[]}function TWe(t,e){let r=L0e[t];return r?Ws(r,e):[]}function EWe(t,e){let r=O0e[t];return r?Ws(r,e):[]}function wWe(t,e){let r=M0e[t];return r?Ws(r,e):[]}function RWe(t,e){let r=F0e[t];return r?Ws(r,e):[]}function kWe(t,e){let r=G0e[t];return Ws(r,e)}async function PWe(t,e,r){let n=await pi(t,e);try{return CWe(t,n.tree.rootNode).reduce((a,c)=>{let u=c.captures.find(l=>l.name==="call_expression").node;if(Sn.doIntersect(r,u)){let l,d;t==="ruby"&&(d=c.captures.find(p=>p.name==="symbol")?.node,l=d?.text?.slice(1)),d??=c.captures.find(p=>p.name==="identifier")?.node,l??=d?.text,a.push({identifier:l??"",text:u.text,startIndex:(d??u).startIndex,endIndex:(d??u).endIndex})}return a},[])}finally{n.dispose()}}async function AWe(t,e){let r=await pi(t,e);try{return tbe(t,r.tree.rootNode).map(s=>{let a=s.captures.find(u=>u.name==="function").node;return{identifier:s.captures.find(u=>u.name==="identifier")?.node.text??"",text:a.text,startIndex:a.startIndex,endIndex:a.endIndex}})}finally{r.dispose()}}async function DWe(t,e){let r=await pi(t,e);try{return TWe(t,r.tree.rootNode).map(s=>{let a=s.captures.find(u=>u.name==="class_declaration").node;return{identifier:a?.children.find(u=>u.type==="type_identifier"||u.type==="identifier"||u.type==="constant")?.text??"",text:a.text,startIndex:a.startIndex,endIndex:a.endIndex}})}finally{r.dispose()}}async function NWe(t,e){let r=await pi(t,e);try{return EWe(t,r.tree.rootNode).map(s=>{let a=s.captures.find(u=>u.name==="type_declaration").node,c=s.captures.find(u=>u.name==="type_identifier")?.node.text;return c||(c=a?.children.find(u=>u.type==="type_identifier")?.text),{identifier:c??"",text:a.text,startIndex:a.startIndex,endIndex:a.endIndex}})}finally{r.dispose()}}async function LWe(t,e,r){let n=await pi(t,e);try{return wWe(t,n.tree.rootNode).reduce((a,c)=>{let u=c.captures.find(l=>l.name==="type_identifier").node;return Sn.doIntersect(r,u)&&a.push({identifier:u.text,text:u.text,startIndex:u.startIndex,endIndex:u.endIndex}),a},[])}finally{n.dispose()}}async function OWe(t,e,r){let n=await pi(t,e);try{return RWe(t,n.tree.rootNode).reduce((a,c)=>{let u=c.captures.find(l=>l.name==="new_expression").node;return Sn.doIntersect(r,u)&&a.push({identifier:u.text,text:u.text,startIndex:u.startIndex,endIndex:u.endIndex}),a},[])}finally{n.dispose()}}async function MWe(t,e,r){let n=await pi(t,e);try{let o=B0e[t];return Ws(o,n.tree.rootNode).reduce((c,u)=>{let l=u.captures.find(d=>d.name==="symbol").node;return Sn.doIntersect(r,l)&&c.push({identifier:l.text,text:l.text,startIndex:l.startIndex,endIndex:l.endIndex}),c},[])}finally{n.dispose()}}async function FWe(t,e){let r=await pi(t,e);try{let n=kWe(t,r.tree.rootNode);return GWe(t,n,r.tree.rootNode)}finally{r.dispose()}}async function UWe(t,e){let r=await pi(t,e);try{return tbe(t,r.tree.rootNode).map(s=>{let a=s.captures.find(c=>c.name==="body").node;return{startIndex:a.startIndex,endIndex:a.endIndex}})}finally{r.dispose()}}async function BWe(t,e,r){let n=await pi(t,e);try{let o=IWe(t,n.tree.rootNode),s;for(let a of o){let c=a.captures[0].node,u=bg.ofSyntaxNode(c);if(bg.doesContain(u,r)&&(s=c),Nl.isBefore(r.endPosition,u.startPosition))break}if(s)return bg.ofSyntaxNode(s);throw new Error("No parent node found")}finally{n.dispose()}}async function qWe(t,e,r,n){let o=await pi(t,e);try{let s=o.tree.rootNode.descendantForPosition(r.startPosition,r.endPosition),a={startPosition:s.startPosition,endPosition:s.endPosition},c=nbe(t,s,n,r,!0);return bg.equals(a,c)?rbe(t,s):c}finally{o.dispose()}}function rbe(t,e){let r=e.parent,n={startPosition:e.startPosition,endPosition:e.endPosition};if(N2(t,e)||!r)return n;let{filteredRanges:o,indexOfInterest:s}=ibe(t,r.children,n,!1);if(s-1>=0&&s+1<=o.length-1){let a=o[s-1],c=o[s+1];return{startPosition:a.startPosition,endPosition:c.endPosition}}return rbe(t,r)}function nbe(t,e,r,n,o){let s=e.children;if(e.endPosition.row-e.startPosition.row+1<=r){let c=N2(t,e)?{startPosition:e.startPosition,endPosition:e.endPosition}:ebe(t,s,r,n,o),u=e.parent;return u?nbe(t,u,r,c,!1):c}return ebe(t,s,r,n,o)}function Z0e(t,e){return e.endPosition.row-t.startPosition.row+1}function ebe(t,e,r,n,o){if(e.length===0)return n;let{filteredRanges:s,indexOfInterest:a}=ibe(t,e,n,o),c=0,u=s.length-1,l=s[c],d=s[u];for(;Z0e(l,d)>r&&c!==u;)a-c<u-a?(u--,d=s[u]):(c++,l=s[c]);return Z0e(l,d)<=r?{startPosition:l.startPosition,endPosition:d.endPosition}:n}function ibe(t,e,r,n){let o,s;if(n?(o=e.filter(a=>N2(t,a)||zK(t,a)),s=Jpe(o,r,(a,c)=>Nl.isBefore(a.startPosition,c.startPosition)),o.splice(s,0,r)):(o=e.filter(a=>bg.doesContain(a,r)||N2(t,a)||zK(t,a)),s=o.findIndex(a=>bg.doesContain(a,r))),s===-1)throw new Error("Valid index not found");return{filteredRanges:o,indexOfInterest:s}}async function jWe(t,e,r){let n=[],a=(await pi(t,e)).tree.rootNode.descendantForIndex(r.startIndex,r.endIndex);for(;a!==null;)z0e(t,a)&&n.push({startIndex:a.startIndex,endIndex:a.endIndex}),a=a.parent;return n}async function HWe(t,e,r){let n=await pi(t,e);try{let o=r.startIndex===r.endIndex;if(o)return;let s=o?void 0:Qy(n.tree,r,t),a=o?void 0:Qy(n.tree,r,t,VWe);if(a&&s)return{nodeIdentifier:A2(s,t),nodeToExplain:yg.ofSyntaxNode(a)}}finally{n.dispose()}}function VWe(t,e){return t.type.match(/definition/)}function GWe(t,e,r){let n;switch(t){case"python":n=KWe(e);break;case"ruby":n=WWe(e);break;default:{n=zWe(e,t);break}}return new FF(n,Ll.ofSyntaxNode(r))}function zWe(t,e){let r=new Map;return t.forEach(n=>{let s=n.captures.find(c=>c.name==="definition")?.node,a=s?.childForFieldName("body");if(s&&a){let c;switch(e){case"typescript":case"javascript":{let{definition:l,comments:d}=YWe(s);s=l,c=d;break}case"java":case"rust":c=QWe(s);break;default:{c=L2(s);break}}r.get(s.id)||r.set(s.id,{mainBlock:Ll.ofSyntaxNode(s),detailBlocks:{comments:c.map(l=>Ll.ofSyntaxNode(l)),body:Ll.ofSyntaxNode(a)}})}}),Array.from(r.values())}function $We(t){if(!(t.length<2))for(let e=1;e<t.length;e++){let r=t[e];if(!r.type.includes("parameters"))return r}}function WWe(t){let e=new Map;return t.forEach(r=>{let o=r.captures.find(s=>s.name==="definition")?.node;if(o){let s=o.namedChildren,a=$We(s);if(a){let c=s[s.length-1],u=o.text.substring(a.startIndex-o.startIndex,c.endIndex-o.startIndex),l=L2(o);e.get(o.id)||e.set(o.id,{mainBlock:Ll.ofSyntaxNode(o),detailBlocks:{comments:l.map(p=>Ll.ofSyntaxNode(p)),body:{range:{startPosition:{row:a.startPosition.row,column:a.startPosition.column},endPosition:{row:c.endPosition.row,column:c.endPosition.column}},startIndex:a.startIndex,text:u,endIndex:c.endIndex}}})}}}),Array.from(e.values())}function KWe(t){let e=new Map;return t.forEach(r=>{let o=r.captures.find(a=>a.name==="definition")?.node,s=o?.childForFieldName("body");if(o&&s){let a=JWe(s),c=XWe(o);e.set(o.id,{mainBlock:Ll.ofSyntaxNode(o),detailBlocks:{docstring:a?Ll.ofSyntaxNode(a):void 0,decorator:c?Ll.ofSyntaxNode(c):void 0,body:Ll.ofSyntaxNode(s)}});return}}),Array.from(e.values())}function L2(t,e=["comment"]){let r=[],n=t.previousNamedSibling;for(;n&&e.some(o=>o===n?.type);)r.push(n),n=n.previousNamedSibling;return r.reverse()}function YWe(t){let e=t.parent;return e?.type==="export_statement"?{definition:e,comments:L2(e)}:{definition:t,comments:L2(t)}}function QWe(t){return L2(t,["block_comment","line_comment"])}function XWe(t){let e=t.previousNamedSibling;return e?.type==="decorator"?e:void 0}function JWe(t){let e=t.firstChild;if(!e||e.type!=="expression_statement")return;let r=e.firstChild;return r?.type==="string"?r:void 0}function ZWe(t,e){return W0e.getStructure(t,e)}var eKe=sbe.join(__dirname,"worker2.js"),qF=class{constructor(e){this._parser=new KK(WK,eKe,e)}dispose(){this._parser.dispose()}getTreeSitterAST(e){let r=Ol(e.languageId);if(r)return this.getTreeSitterASTForWASMLanguage(r,e.getText())}getTreeSitterASTForWASMLanguage(e,r){let n=this._parser.proxy;return{getFunctionBodies:()=>n._getFunctionBodies(e,r),getCoarseParentScope:o=>n._getCoarseParentScope(e,r,o),getFixSelectionOfInterest:(o,s)=>n._getFixSelectionOfInterest(e,r,o,s),getCallExpressions:o=>n._getCallExpressions(e,r,o),getFunctionDefinitions:()=>n._getFunctionDefinitions(e,r),getClassReferences:o=>n._getClassReferences(e,r,o),getClassDeclarations:()=>n._getClassDeclarations(e,r),getTypeDeclarations:()=>n._getTypeDeclarations(e,r),getTypeReferences:o=>n._getTypeReferences(e,r,o),getSymbols:o=>n._getSymbols(e,r,o),getDocumentableNodeIfOnIdentifier:o=>n._getDocumentableNodeIfOnIdentifier(e,r,o),getTestableNode:o=>n._getTestableNode(e,r,o),getTestableNodes:()=>n._getTestableNodes(e,r),getNodeToExplain:o=>n._getNodeToExplain(e,r,o),getNodeToDocument:o=>n._getNodeToDocument(e,r,o),getFineScopes:o=>n._getFineScopes(e,r,o),getStructure:()=>n._getStructure(e,r),findLastTest:()=>n._findLastTest(e,r)}}getSemanticChunkTree(e,r){return this._parser.proxy._getSemanticChunkTree(e,r)}},KK=class{constructor(e,r,n){this._workerPath=r;this._useWorker=n;this._local=new Proxy(e,{get:(o,s,a)=>{let c=o[s];return typeof c!="function"?c:async(...u)=>{let l=await c.apply(o,obe(u));return obe(l)}}}),this._worker=new Ti(()=>new Bg(this._workerPath,{name:"Parser worker"}))}get proxy(){return this._useWorker?this._worker.value.proxy:this._local}dispose(){this._worker.hasValue&&this._worker.value.terminate()}};function obe(t){return typeof t>"u"?t:JSON.parse(JSON.stringify(t))}var jF=require("vscode");var VF=ie("IRemoteRepositoriesService"),HF=class{async loadWorkspaceContents(e){return await(await this.getApi()).loadWorkspaceContents?.(e)??!1}getApi(){return this.getRemoteExtension().activate()}getRemoteExtension(){if(this._remoteHub!==void 0)return this._remoteHub;if(this._remoteHub=jF.extensions.getExtension("ms-vscode.remote-repositories")??jF.extensions.getExtension("GitHub.remoteHub")??jF.extensions.getExtension("GitHub.remoteHub-insiders"),this._remoteHub===void 0)throw new Error("No Remote repository extension found.");return this._remoteHub}};function abe(t){let r=[`(repo:${(Array.isArray(t.repo)?t.repo:[t.repo]).join(" OR repo:")})`];return t.lang&&r.push(`(lang:${t.lang.join(" OR lang:")})`),t.notLang&&r.push(`NOT (lang:${t.notLang.join(" OR lang:")})`),t.path&&r.push(`(path:${t.path.join(" OR path:")})`),t.notPath&&r.push(`NOT (path:${t.notPath.join(" OR path:")})`),r.join(" ")}var GF=class extends Error{constructor(r,n){super(n);this.status=r}},tKe=6,rKe=.766,Xy=class{constructor(e,r,n,o,s,a){this._domainService=e;this._telemetryService=r;this._authenticationService=n;this._fetcherService=o;this._envService=s;this._logService=a}async search(e,r,n={},o){let s;if(Array.isArray(r.repo)&&!r.repo.length)throw new Error("No repos specified");try{s=await this.postCodeOrDocsSearchRequestWithRetry(e,r,n,o)}catch(c){throw this._telemetryService.sendGHTelemetryException(c,`${this.slug} search failed`),c}let a=s.errors?.map(Ole)??[];if(!Array.isArray(r.repo)){if(a.length)throw a.length>1?new AggregateError(a):a[0];return s.results}return{results:s.results,errors:a}}async postCodeOrDocsSearchRequestWithRetry(e,r,n,o){let s=(await this._authenticationService.getPermissiveGitHubSession({silent:!0}))?.accessToken??(await this._authenticationService.getAnyGitHubSession({silent:!0}))?.accessToken;if(o?.isCancellationRequested)return{results:[]};let a=`${this._domainService.searchSkillURL}/${this.slug}`,c=5,u=0,l=new Set,d;for(;u<c;){if(o?.isCancellationRequested)return{results:[]};try{try{return await this.postCodeOrDocsSearchRequest(a,s,e,r,n,o)}catch(p){if(p instanceof GF)throw p;d=p;break}}catch(p){u++;let f=u*1e3;l.add(`Error fetching ${this.slug} search. ${p.message??p}`),this._logService.public.warn(`[repo:${r.repo}] Error fetching ${this.slug} search. Error: ${p.message??p}. Retrying in ${u} seconds. Query: ${e}`),await new Promise(m=>setTimeout(m,f))}}if(o?.isCancellationRequested)return{results:[]};throw u>=c&&(this._logService.public.warn(`[repo:${r.repo}] Max Retry Error thrown while querying '${e}'`),d=aG({error:"ERROR_TYPE_MAX_RETRIES_EXCEEDED",message:`${this.slug} search timed out after ${c} retries. ${Array.from(l).join(`
`)}`})),d}async postCodeOrDocsSearchRequest(e,r,n,o,s,a){let c=s.limit??tKe,u=s.similarity??rKe,l=s.rawChunks??!1,d={url:e,family:"Code Or Doc Search",name:"Code Or Doc Search",version:"2023-12-12-preview",modelMaxPromptTokens:0,getExtraHeaders(){let h={Accept:"application/json","X-GitHub-Api-Version":"2023-12-12-preview"};return l&&(h["X-Experiment-blackbird_snippet_mode"]="raw"),h}},p=await Mg(this._fetcherService,this._envService,this._telemetryService,this._domainService,d,r??"",await Pl(process.env.HMAC_SECRET),void 0,_r(),{query:n,scopingQuery:abe(o),similarity:u,limit:c},a),f=await p.text();if(p.status===404||p.status===400&&f.includes("unknown integration"))throw this._logService.public.debug(`${this.slug} search endpoint not available for this user.`),aG({error:"ERROR_TYPE_NO_ACCESS_TO_ENDPOINT",message:`${this.slug}: ${f}`});let m;try{m=JSON.parse(f)}catch{throw new GF(p.status,f)}return m}};w([oo(e=>e._logService)],Xy.prototype,"search",1),Xy=w([b(0,Xr),b(1,he),b(2,Nt),b(3,nn),b(4,St),b(5,oe)],Xy);var zF=class extends Xy{constructor(){super(...arguments);this.slug="code"}},$F=class extends Xy{constructor(){super(...arguments);this.slug="docs"}};var zi=H(require("vscode")),fT=require("vscode");var mT=class{constructor(e,r){this._configurationService=e;this._contextService=r;this._disposables=new ht;this._commentController=zi.comments.createCommentController("github-copilot-review","GitHub Copilot Review");this._comments=[];this._disposables.add(zi.workspace.onDidChangeConfiguration(n=>{n.affectsConfiguration("github.copilot.advanced")&&(zi.commands.executeCommand("setContext","github.copilot.advanced.review.contextmenu.enabled",this._configurationService.getConfig(de.ReviewContextMenu)),zi.commands.executeCommand("setContext","github.copilot.advanced.review.scmviewlet.enabled",this._configurationService.getConfig(de.ReviewSCMViewlet))),(n.affectsConfiguration("github.copilot.advanced")||n.affectsConfiguration("github.copilot.advanced.review.intent"))&&zi.commands.executeCommand("setContext","github.copilot.advanced.review.intent.enabled",this.isIntentEnabled())})),this.updateContextValues()}updateContextValues(){zi.commands.executeCommand("setContext","github.copilot.advanced.review.contextmenu.enabled",this._configurationService.getConfig(de.ReviewContextMenu)),zi.commands.executeCommand("setContext","github.copilot.advanced.review.scmviewlet.enabled",this._configurationService.getConfig(de.ReviewSCMViewlet)),zi.commands.executeCommand("setContext","github.copilot.advanced.review.intent.enabled",this.isIntentEnabled())}isIntentEnabled(){return this._configurationService.getConfig(de.ReviewIntent)}getDiagnosticCollection(){return this._diagnosticCollection||this._disposables.add(this._diagnosticCollection=zi.languages.createDiagnosticCollection("github.copilot.review"))}getReviewComments(){return this._comments.map(({comment:e})=>e)}addReviewComments(e){for(let r of e){let n=this._commentController.createCommentThread(r.uri,r.range,this.createUIComments(r));n.contextValue="hasNoSuggestion",n.canReply=!1,this._comments.find(o=>o.comment.uri.toString()===r.uri.toString())||(n.collapsibleState=zi.CommentThreadCollapsibleState.Expanded),this._comments.push({comment:r,thread:n}),this.updateThreadLabels(),this._comments.length===1&&(zi.commands.executeCommand("github.copilot.interactiveEditor.review.next"),this._monitorActiveThread=setInterval(()=>{let o=this._commentController.activeCommentThread,s=o&&this._comments.find(a=>a.thread.label===o.label)?.thread;s!==this._activeThread&&(this._activeThread=s,s&&zi.commands.executeCommand("github.copilot.interactiveEditor.review.current",s))},500))}}updateReviewComment(e){let r=this.findCommentThread(e);r&&(r.comments=this.createUIComments(e))}createUIComments(e){let r="",n=e.suggestion?"edits"in e.suggestion?e.suggestion.edits.length?`

***
${fT.l10n.t("Suggested change:")}${e.suggestion.edits.map(s=>`
\`\`\`diff
${nKe(s)}
\`\`\``).join("")}
***`:`

${fT.l10n.t("No change found to suggest.")}`:`

${fT.l10n.t("Looking up change to suggest...")}`:"";return[{body:typeof e.body=="string"?`${e.body}${n}${r}`:new zi.MarkdownString(`${e.body.value}${n}${r}`),mode:zi.CommentMode.Preview,author:{name:fT.l10n.t("GitHub Copilot"),iconPath:Ye.joinPath(this._contextService.extensionUri,"assets","Copilot-chat-avatar.png")}}]}collapseReviewComment(e){let r=this._comments.find(s=>s.comment===e);if(!r)return;let n=r.thread;n.dispose();let o=this._commentController.createCommentThread(e.uri,e.range,n.comments);o.contextValue=n.contextValue,o.canReply=!1,o.label=n.label,r.thread=o}removeReviewComments(e){for(let r of e){let n=this._comments.findIndex(o=>o.comment===r);n!==-1&&(this._comments[n].thread.dispose(),this._comments.splice(n,1))}this.updateThreadLabels(),this._comments.length===0&&this._monitorActiveThread&&(clearInterval(this._monitorActiveThread),this._monitorActiveThread=void 0)}updateThreadLabels(){this._comments.forEach((e,r)=>{e.thread.label=fT.l10n.t("Code Review Comment ({0} of {1})",r+1,this._comments.length)})}findReviewComment(e){return this._comments.find(n=>n.thread===e||n.thread.comments[0]===e)?.comment}findCommentThread(e){return this._comments.find(n=>n.comment===e)?.thread}dispose(){this._disposables.dispose()}};mT=w([b(0,be),b(1,jt)],mT);function nKe(t){let e=t.oldText.split(/\r?\n/),r=t.newText.split(/\r?\n/);for(;e.length&&r.length&&e[0]===r[0];)e.shift(),r.shift();for(;e.length&&r.length&&e[e.length-1]===r[r.length-1];)e.pop(),r.pop();return`${e.map(n=>`- ${n}`).join(`
`)}
${r.map(n=>`+ ${n}`).join(`
`)}`}var O2=require("vscode");var cbe=Object.create(null);function T(t,e){if(wR(e)){let r=cbe[e];if(r===void 0)throw new Error(`${t} references an unknown codicon: ${e}`);e=r}return cbe[t]=e,{id:t}}var ube={add:T("add",6e4),plus:T("plus",6e4),gistNew:T("gist-new",6e4),repoCreate:T("repo-create",6e4),lightbulb:T("lightbulb",60001),lightBulb:T("light-bulb",60001),repo:T("repo",60002),repoDelete:T("repo-delete",60002),gistFork:T("gist-fork",60003),repoForked:T("repo-forked",60003),gitPullRequest:T("git-pull-request",60004),gitPullRequestAbandoned:T("git-pull-request-abandoned",60004),recordKeys:T("record-keys",60005),keyboard:T("keyboard",60005),tag:T("tag",60006),gitPullRequestLabel:T("git-pull-request-label",60006),tagAdd:T("tag-add",60006),tagRemove:T("tag-remove",60006),person:T("person",60007),personFollow:T("person-follow",60007),personOutline:T("person-outline",60007),personFilled:T("person-filled",60007),gitBranch:T("git-branch",60008),gitBranchCreate:T("git-branch-create",60008),gitBranchDelete:T("git-branch-delete",60008),sourceControl:T("source-control",60008),mirror:T("mirror",60009),mirrorPublic:T("mirror-public",60009),star:T("star",60010),starAdd:T("star-add",60010),starDelete:T("star-delete",60010),starEmpty:T("star-empty",60010),comment:T("comment",60011),commentAdd:T("comment-add",60011),alert:T("alert",60012),warning:T("warning",60012),search:T("search",60013),searchSave:T("search-save",60013),logOut:T("log-out",60014),signOut:T("sign-out",60014),logIn:T("log-in",60015),signIn:T("sign-in",60015),eye:T("eye",60016),eyeUnwatch:T("eye-unwatch",60016),eyeWatch:T("eye-watch",60016),circleFilled:T("circle-filled",60017),primitiveDot:T("primitive-dot",60017),closeDirty:T("close-dirty",60017),debugBreakpoint:T("debug-breakpoint",60017),debugBreakpointDisabled:T("debug-breakpoint-disabled",60017),debugHint:T("debug-hint",60017),terminalDecorationSuccess:T("terminal-decoration-success",60017),primitiveSquare:T("primitive-square",60018),edit:T("edit",60019),pencil:T("pencil",60019),info:T("info",60020),issueOpened:T("issue-opened",60020),gistPrivate:T("gist-private",60021),gitForkPrivate:T("git-fork-private",60021),lock:T("lock",60021),mirrorPrivate:T("mirror-private",60021),close:T("close",60022),removeClose:T("remove-close",60022),x:T("x",60022),repoSync:T("repo-sync",60023),sync:T("sync",60023),clone:T("clone",60024),desktopDownload:T("desktop-download",60024),beaker:T("beaker",60025),microscope:T("microscope",60025),vm:T("vm",60026),deviceDesktop:T("device-desktop",60026),file:T("file",60027),fileText:T("file-text",60027),more:T("more",60028),ellipsis:T("ellipsis",60028),kebabHorizontal:T("kebab-horizontal",60028),mailReply:T("mail-reply",60029),reply:T("reply",60029),organization:T("organization",60030),organizationFilled:T("organization-filled",60030),organizationOutline:T("organization-outline",60030),newFile:T("new-file",60031),fileAdd:T("file-add",60031),newFolder:T("new-folder",60032),fileDirectoryCreate:T("file-directory-create",60032),trash:T("trash",60033),trashcan:T("trashcan",60033),history:T("history",60034),clock:T("clock",60034),folder:T("folder",60035),fileDirectory:T("file-directory",60035),symbolFolder:T("symbol-folder",60035),logoGithub:T("logo-github",60036),markGithub:T("mark-github",60036),github:T("github",60036),terminal:T("terminal",60037),console:T("console",60037),repl:T("repl",60037),zap:T("zap",60038),symbolEvent:T("symbol-event",60038),error:T("error",60039),stop:T("stop",60039),variable:T("variable",60040),symbolVariable:T("symbol-variable",60040),array:T("array",60042),symbolArray:T("symbol-array",60042),symbolModule:T("symbol-module",60043),symbolPackage:T("symbol-package",60043),symbolNamespace:T("symbol-namespace",60043),symbolObject:T("symbol-object",60043),symbolMethod:T("symbol-method",60044),symbolFunction:T("symbol-function",60044),symbolConstructor:T("symbol-constructor",60044),symbolBoolean:T("symbol-boolean",60047),symbolNull:T("symbol-null",60047),symbolNumeric:T("symbol-numeric",60048),symbolNumber:T("symbol-number",60048),symbolStructure:T("symbol-structure",60049),symbolStruct:T("symbol-struct",60049),symbolParameter:T("symbol-parameter",60050),symbolTypeParameter:T("symbol-type-parameter",60050),symbolKey:T("symbol-key",60051),symbolText:T("symbol-text",60051),symbolReference:T("symbol-reference",60052),goToFile:T("go-to-file",60052),symbolEnum:T("symbol-enum",60053),symbolValue:T("symbol-value",60053),symbolRuler:T("symbol-ruler",60054),symbolUnit:T("symbol-unit",60054),activateBreakpoints:T("activate-breakpoints",60055),archive:T("archive",60056),arrowBoth:T("arrow-both",60057),arrowDown:T("arrow-down",60058),arrowLeft:T("arrow-left",60059),arrowRight:T("arrow-right",60060),arrowSmallDown:T("arrow-small-down",60061),arrowSmallLeft:T("arrow-small-left",60062),arrowSmallRight:T("arrow-small-right",60063),arrowSmallUp:T("arrow-small-up",60064),arrowUp:T("arrow-up",60065),bell:T("bell",60066),bold:T("bold",60067),book:T("book",60068),bookmark:T("bookmark",60069),debugBreakpointConditionalUnverified:T("debug-breakpoint-conditional-unverified",60070),debugBreakpointConditional:T("debug-breakpoint-conditional",60071),debugBreakpointConditionalDisabled:T("debug-breakpoint-conditional-disabled",60071),debugBreakpointDataUnverified:T("debug-breakpoint-data-unverified",60072),debugBreakpointData:T("debug-breakpoint-data",60073),debugBreakpointDataDisabled:T("debug-breakpoint-data-disabled",60073),debugBreakpointLogUnverified:T("debug-breakpoint-log-unverified",60074),debugBreakpointLog:T("debug-breakpoint-log",60075),debugBreakpointLogDisabled:T("debug-breakpoint-log-disabled",60075),briefcase:T("briefcase",60076),broadcast:T("broadcast",60077),browser:T("browser",60078),bug:T("bug",60079),calendar:T("calendar",60080),caseSensitive:T("case-sensitive",60081),check:T("check",60082),checklist:T("checklist",60083),chevronDown:T("chevron-down",60084),chevronLeft:T("chevron-left",60085),chevronRight:T("chevron-right",60086),chevronUp:T("chevron-up",60087),chromeClose:T("chrome-close",60088),chromeMaximize:T("chrome-maximize",60089),chromeMinimize:T("chrome-minimize",60090),chromeRestore:T("chrome-restore",60091),circleOutline:T("circle-outline",60092),circle:T("circle",60092),debugBreakpointUnverified:T("debug-breakpoint-unverified",60092),terminalDecorationIncomplete:T("terminal-decoration-incomplete",60092),circleSlash:T("circle-slash",60093),circuitBoard:T("circuit-board",60094),clearAll:T("clear-all",60095),clippy:T("clippy",60096),closeAll:T("close-all",60097),cloudDownload:T("cloud-download",60098),cloudUpload:T("cloud-upload",60099),code:T("code",60100),collapseAll:T("collapse-all",60101),colorMode:T("color-mode",60102),commentDiscussion:T("comment-discussion",60103),creditCard:T("credit-card",60105),dash:T("dash",60108),dashboard:T("dashboard",60109),database:T("database",60110),debugContinue:T("debug-continue",60111),debugDisconnect:T("debug-disconnect",60112),debugPause:T("debug-pause",60113),debugRestart:T("debug-restart",60114),debugStart:T("debug-start",60115),debugStepInto:T("debug-step-into",60116),debugStepOut:T("debug-step-out",60117),debugStepOver:T("debug-step-over",60118),debugStop:T("debug-stop",60119),debug:T("debug",60120),deviceCameraVideo:T("device-camera-video",60121),deviceCamera:T("device-camera",60122),deviceMobile:T("device-mobile",60123),diffAdded:T("diff-added",60124),diffIgnored:T("diff-ignored",60125),diffModified:T("diff-modified",60126),diffRemoved:T("diff-removed",60127),diffRenamed:T("diff-renamed",60128),diff:T("diff",60129),diffSidebyside:T("diff-sidebyside",60129),discard:T("discard",60130),editorLayout:T("editor-layout",60131),emptyWindow:T("empty-window",60132),exclude:T("exclude",60133),extensions:T("extensions",60134),eyeClosed:T("eye-closed",60135),fileBinary:T("file-binary",60136),fileCode:T("file-code",60137),fileMedia:T("file-media",60138),filePdf:T("file-pdf",60139),fileSubmodule:T("file-submodule",60140),fileSymlinkDirectory:T("file-symlink-directory",60141),fileSymlinkFile:T("file-symlink-file",60142),fileZip:T("file-zip",60143),files:T("files",60144),filter:T("filter",60145),flame:T("flame",60146),foldDown:T("fold-down",60147),foldUp:T("fold-up",60148),fold:T("fold",60149),folderActive:T("folder-active",60150),folderOpened:T("folder-opened",60151),gear:T("gear",60152),gift:T("gift",60153),gistSecret:T("gist-secret",60154),gist:T("gist",60155),gitCommit:T("git-commit",60156),gitCompare:T("git-compare",60157),compareChanges:T("compare-changes",60157),gitMerge:T("git-merge",60158),githubAction:T("github-action",60159),githubAlt:T("github-alt",60160),globe:T("globe",60161),grabber:T("grabber",60162),graph:T("graph",60163),gripper:T("gripper",60164),heart:T("heart",60165),home:T("home",60166),horizontalRule:T("horizontal-rule",60167),hubot:T("hubot",60168),inbox:T("inbox",60169),issueReopened:T("issue-reopened",60171),issues:T("issues",60172),italic:T("italic",60173),jersey:T("jersey",60174),json:T("json",60175),kebabVertical:T("kebab-vertical",60176),key:T("key",60177),law:T("law",60178),lightbulbAutofix:T("lightbulb-autofix",60179),linkExternal:T("link-external",60180),link:T("link",60181),listOrdered:T("list-ordered",60182),listUnordered:T("list-unordered",60183),liveShare:T("live-share",60184),loading:T("loading",60185),location:T("location",60186),mailRead:T("mail-read",60187),mail:T("mail",60188),markdown:T("markdown",60189),megaphone:T("megaphone",60190),mention:T("mention",60191),milestone:T("milestone",60192),gitPullRequestMilestone:T("git-pull-request-milestone",60192),mortarBoard:T("mortar-board",60193),move:T("move",60194),multipleWindows:T("multiple-windows",60195),mute:T("mute",60196),noNewline:T("no-newline",60197),note:T("note",60198),octoface:T("octoface",60199),openPreview:T("open-preview",60200),package:T("package",60201),paintcan:T("paintcan",60202),pin:T("pin",60203),play:T("play",60204),run:T("run",60204),plug:T("plug",60205),preserveCase:T("preserve-case",60206),preview:T("preview",60207),project:T("project",60208),pulse:T("pulse",60209),question:T("question",60210),quote:T("quote",60211),radioTower:T("radio-tower",60212),reactions:T("reactions",60213),references:T("references",60214),refresh:T("refresh",60215),regex:T("regex",60216),remoteExplorer:T("remote-explorer",60217),remote:T("remote",60218),remove:T("remove",60219),replaceAll:T("replace-all",60220),replace:T("replace",60221),repoClone:T("repo-clone",60222),repoForcePush:T("repo-force-push",60223),repoPull:T("repo-pull",60224),repoPush:T("repo-push",60225),report:T("report",60226),requestChanges:T("request-changes",60227),rocket:T("rocket",60228),rootFolderOpened:T("root-folder-opened",60229),rootFolder:T("root-folder",60230),rss:T("rss",60231),ruby:T("ruby",60232),saveAll:T("save-all",60233),saveAs:T("save-as",60234),save:T("save",60235),screenFull:T("screen-full",60236),screenNormal:T("screen-normal",60237),searchStop:T("search-stop",60238),server:T("server",60240),settingsGear:T("settings-gear",60241),settings:T("settings",60242),shield:T("shield",60243),smiley:T("smiley",60244),sortPrecedence:T("sort-precedence",60245),splitHorizontal:T("split-horizontal",60246),splitVertical:T("split-vertical",60247),squirrel:T("squirrel",60248),starFull:T("star-full",60249),starHalf:T("star-half",60250),symbolClass:T("symbol-class",60251),symbolColor:T("symbol-color",60252),symbolConstant:T("symbol-constant",60253),symbolEnumMember:T("symbol-enum-member",60254),symbolField:T("symbol-field",60255),symbolFile:T("symbol-file",60256),symbolInterface:T("symbol-interface",60257),symbolKeyword:T("symbol-keyword",60258),symbolMisc:T("symbol-misc",60259),symbolOperator:T("symbol-operator",60260),symbolProperty:T("symbol-property",60261),wrench:T("wrench",60261),wrenchSubaction:T("wrench-subaction",60261),symbolSnippet:T("symbol-snippet",60262),tasklist:T("tasklist",60263),telescope:T("telescope",60264),textSize:T("text-size",60265),threeBars:T("three-bars",60266),thumbsdown:T("thumbsdown",60267),thumbsup:T("thumbsup",60268),tools:T("tools",60269),triangleDown:T("triangle-down",60270),triangleLeft:T("triangle-left",60271),triangleRight:T("triangle-right",60272),triangleUp:T("triangle-up",60273),twitter:T("twitter",60274),unfold:T("unfold",60275),unlock:T("unlock",60276),unmute:T("unmute",60277),unverified:T("unverified",60278),verified:T("verified",60279),versions:T("versions",60280),vmActive:T("vm-active",60281),vmOutline:T("vm-outline",60282),vmRunning:T("vm-running",60283),watch:T("watch",60284),whitespace:T("whitespace",60285),wholeWord:T("whole-word",60286),window:T("window",60287),wordWrap:T("word-wrap",60288),zoomIn:T("zoom-in",60289),zoomOut:T("zoom-out",60290),listFilter:T("list-filter",60291),listFlat:T("list-flat",60292),listSelection:T("list-selection",60293),selection:T("selection",60293),listTree:T("list-tree",60294),debugBreakpointFunctionUnverified:T("debug-breakpoint-function-unverified",60295),debugBreakpointFunction:T("debug-breakpoint-function",60296),debugBreakpointFunctionDisabled:T("debug-breakpoint-function-disabled",60296),debugStackframeActive:T("debug-stackframe-active",60297),circleSmallFilled:T("circle-small-filled",60298),debugStackframeDot:T("debug-stackframe-dot",60298),terminalDecorationMark:T("terminal-decoration-mark",60298),debugStackframe:T("debug-stackframe",60299),debugStackframeFocused:T("debug-stackframe-focused",60299),debugBreakpointUnsupported:T("debug-breakpoint-unsupported",60300),symbolString:T("symbol-string",60301),debugReverseContinue:T("debug-reverse-continue",60302),debugStepBack:T("debug-step-back",60303),debugRestartFrame:T("debug-restart-frame",60304),debugAlt:T("debug-alt",60305),callIncoming:T("call-incoming",60306),callOutgoing:T("call-outgoing",60307),menu:T("menu",60308),expandAll:T("expand-all",60309),feedback:T("feedback",60310),gitPullRequestReviewer:T("git-pull-request-reviewer",60310),groupByRefType:T("group-by-ref-type",60311),ungroupByRefType:T("ungroup-by-ref-type",60312),account:T("account",60313),gitPullRequestAssignee:T("git-pull-request-assignee",60313),bellDot:T("bell-dot",60314),debugConsole:T("debug-console",60315),library:T("library",60316),output:T("output",60317),runAll:T("run-all",60318),syncIgnored:T("sync-ignored",60319),pinned:T("pinned",60320),githubInverted:T("github-inverted",60321),serverProcess:T("server-process",60322),serverEnvironment:T("server-environment",60323),pass:T("pass",60324),issueClosed:T("issue-closed",60324),stopCircle:T("stop-circle",60325),playCircle:T("play-circle",60326),record:T("record",60327),debugAltSmall:T("debug-alt-small",60328),vmConnect:T("vm-connect",60329),cloud:T("cloud",60330),merge:T("merge",60331),export:T("export",60332),graphLeft:T("graph-left",60333),magnet:T("magnet",60334),notebook:T("notebook",60335),redo:T("redo",60336),checkAll:T("check-all",60337),pinnedDirty:T("pinned-dirty",60338),passFilled:T("pass-filled",60339),circleLargeFilled:T("circle-large-filled",60340),circleLarge:T("circle-large",60341),circleLargeOutline:T("circle-large-outline",60341),combine:T("combine",60342),gather:T("gather",60342),table:T("table",60343),variableGroup:T("variable-group",60344),typeHierarchy:T("type-hierarchy",60345),typeHierarchySub:T("type-hierarchy-sub",60346),typeHierarchySuper:T("type-hierarchy-super",60347),gitPullRequestCreate:T("git-pull-request-create",60348),runAbove:T("run-above",60349),runBelow:T("run-below",60350),notebookTemplate:T("notebook-template",60351),debugRerun:T("debug-rerun",60352),workspaceTrusted:T("workspace-trusted",60353),workspaceUntrusted:T("workspace-untrusted",60354),workspaceUnknown:T("workspace-unknown",60355),terminalCmd:T("terminal-cmd",60356),terminalDebian:T("terminal-debian",60357),terminalLinux:T("terminal-linux",60358),terminalPowershell:T("terminal-powershell",60359),terminalTmux:T("terminal-tmux",60360),terminalUbuntu:T("terminal-ubuntu",60361),terminalBash:T("terminal-bash",60362),arrowSwap:T("arrow-swap",60363),copy:T("copy",60364),personAdd:T("person-add",60365),filterFilled:T("filter-filled",60366),wand:T("wand",60367),debugLineByLine:T("debug-line-by-line",60368),inspect:T("inspect",60369),layers:T("layers",60370),layersDot:T("layers-dot",60371),layersActive:T("layers-active",60372),compass:T("compass",60373),compassDot:T("compass-dot",60374),compassActive:T("compass-active",60375),azure:T("azure",60376),issueDraft:T("issue-draft",60377),gitPullRequestClosed:T("git-pull-request-closed",60378),gitPullRequestDraft:T("git-pull-request-draft",60379),debugAll:T("debug-all",60380),debugCoverage:T("debug-coverage",60381),runErrors:T("run-errors",60382),folderLibrary:T("folder-library",60383),debugContinueSmall:T("debug-continue-small",60384),beakerStop:T("beaker-stop",60385),graphLine:T("graph-line",60386),graphScatter:T("graph-scatter",60387),pieChart:T("pie-chart",60388),bracket:T("bracket",60175),bracketDot:T("bracket-dot",60389),bracketError:T("bracket-error",60390),lockSmall:T("lock-small",60391),azureDevops:T("azure-devops",60392),verifiedFilled:T("verified-filled",60393),newline:T("newline",60394),layout:T("layout",60395),layoutActivitybarLeft:T("layout-activitybar-left",60396),layoutActivitybarRight:T("layout-activitybar-right",60397),layoutPanelLeft:T("layout-panel-left",60398),layoutPanelCenter:T("layout-panel-center",60399),layoutPanelJustify:T("layout-panel-justify",60400),layoutPanelRight:T("layout-panel-right",60401),layoutPanel:T("layout-panel",60402),layoutSidebarLeft:T("layout-sidebar-left",60403),layoutSidebarRight:T("layout-sidebar-right",60404),layoutStatusbar:T("layout-statusbar",60405),layoutMenubar:T("layout-menubar",60406),layoutCentered:T("layout-centered",60407),target:T("target",60408),indent:T("indent",60409),recordSmall:T("record-small",60410),errorSmall:T("error-small",60411),terminalDecorationError:T("terminal-decoration-error",60411),arrowCircleDown:T("arrow-circle-down",60412),arrowCircleLeft:T("arrow-circle-left",60413),arrowCircleRight:T("arrow-circle-right",60414),arrowCircleUp:T("arrow-circle-up",60415),layoutSidebarRightOff:T("layout-sidebar-right-off",60416),layoutPanelOff:T("layout-panel-off",60417),layoutSidebarLeftOff:T("layout-sidebar-left-off",60418),blank:T("blank",60419),heartFilled:T("heart-filled",60420),map:T("map",60421),mapHorizontal:T("map-horizontal",60421),foldHorizontal:T("fold-horizontal",60421),mapFilled:T("map-filled",60422),mapHorizontalFilled:T("map-horizontal-filled",60422),foldHorizontalFilled:T("fold-horizontal-filled",60422),circleSmall:T("circle-small",60423),bellSlash:T("bell-slash",60424),bellSlashDot:T("bell-slash-dot",60425),commentUnresolved:T("comment-unresolved",60426),gitPullRequestGoToChanges:T("git-pull-request-go-to-changes",60427),gitPullRequestNewChanges:T("git-pull-request-new-changes",60428),searchFuzzy:T("search-fuzzy",60429),commentDraft:T("comment-draft",60430),send:T("send",60431),sparkle:T("sparkle",60432),insert:T("insert",60433),mic:T("mic",60434),thumbsdownFilled:T("thumbsdown-filled",60435),thumbsupFilled:T("thumbsup-filled",60436),coffee:T("coffee",60437),snake:T("snake",60438),game:T("game",60439),vr:T("vr",60440),chip:T("chip",60441),piano:T("piano",60442),music:T("music",60443),micFilled:T("mic-filled",60444),repoFetch:T("repo-fetch",60445),copilot:T("copilot",60446),lightbulbSparkle:T("lightbulb-sparkle",60447),robot:T("robot",60448),sparkleFilled:T("sparkle-filled",60449),diffSingle:T("diff-single",60450),diffMultiple:T("diff-multiple",60451),surroundWith:T("surround-with",60452),share:T("share",60453),gitStash:T("git-stash",60454),gitStashApply:T("git-stash-apply",60455),gitStashPop:T("git-stash-pop",60456),vscode:T("vscode",60457),vscodeInsiders:T("vscode-insiders",60458),codeOss:T("code-oss",60459),runCoverage:T("run-coverage",60460),runAllCoverage:T("run-all-coverage",60461),coverage:T("coverage",60462),githubProject:T("github-project",60463),mapVertical:T("map-vertical",60464),foldVertical:T("fold-vertical",60464),mapVerticalFilled:T("map-vertical-filled",60465),foldVerticalFilled:T("fold-vertical-filled",60465),goToSearch:T("go-to-search",60466),percentage:T("percentage",60467),sortPercentage:T("sort-percentage",60467),attach:T("attach",60468)};var iKe={dialogError:T("dialog-error","error"),dialogWarning:T("dialog-warning","warning"),dialogInfo:T("dialog-info","info"),dialogClose:T("dialog-close","close"),treeItemExpanded:T("tree-item-expanded","chevron-down"),treeFilterOnTypeOn:T("tree-filter-on-type-on","list-filter"),treeFilterOnTypeOff:T("tree-filter-on-type-off","list-selection"),treeFilterClear:T("tree-filter-clear","close"),treeItemLoading:T("tree-item-loading","loading"),menuSelection:T("menu-selection","check"),menuSubmenu:T("menu-submenu","chevron-right"),menuBarMore:T("menubar-more","more"),scrollbarButtonLeft:T("scrollbar-button-left","triangle-left"),scrollbarButtonRight:T("scrollbar-button-right","triangle-right"),scrollbarButtonUp:T("scrollbar-button-up","triangle-up"),scrollbarButtonDown:T("scrollbar-button-down","triangle-down"),toolBarMore:T("toolbar-more","more"),quickInputBack:T("quick-input-back","arrow-left"),dropDownButton:T("drop-down-button",60084),symbolCustomColor:T("symbol-customcolor",60252),exportIcon:T("export",60332),workspaceUnspecified:T("workspace-unspecified",60355),newLine:T("newline",60394),thumbsDownFilled:T("thumbsdown-filled",60435),thumbsUpFilled:T("thumbsup-filled",60436),gitFetch:T("git-fetch",60445),lightbulbSparkleAutofix:T("lightbulb-sparkle-autofix",60447),debugBreakpointPending:T("debug-breakpoint-pending",60377)},In={...ube,...iKe};var hT=class{constructor(e){this.accessor=e}async findEnclosingBlocks(e,r){let n=this.accessor.get(_t).getTreeSitterAST(e);if(n===void 0)return;let o=io(r,e);return(await n.getFineScopes(o))?.map(a=>{let c=ms(e,a);return{kind:"code",name:e.lineAt(c.start).text.trim(),range:c}})}findEnclosingSymbols(e,r){for(let n of e)if(n.range.contains(r)){let o=this.findEnclosingSymbols(n.children,r);return o?[n,...o]:[n]}}async selectEnclosingScope(e,r){let n=await this.accessor.get(Co).getDocumentSymbols(e.document.uri);if(!n||n.length>0&&!n[0].hasOwnProperty("children"))return;let o=e.selection;if(!o.isEmpty)return;let s=this.findEnclosingSymbols(n,e.selection.active);if(r?.includeBlocks&&s?.push(...await this.findEnclosingBlocks(e.document,e.selection)??[]),s||(s=n),s?.length===1){let a=s[0];e.selection=new O2.Selection(a.range.start,a.range.end)}else if(s&&s.length>1||!s&&n.length>1){let a=s.sort((u,l)=>l.range.start.line-u.range.start.line).map(u=>({label:`$(${u.kind==="code"?"code":lbe.toIcon(u.kind).id}) ${u.name}`,description:`:${u.range.start.line+1}-${u.range.end.line+1}`,symbol:u}));if(!await this.accessor.get(bF).showQuickPick(a,{placeHolder:r?.reason??O2.l10n.t("Select an enclosing range"),onDidSelectItem(u){let l=u.symbol;l&&(e.selection=new O2.Selection(l.range.start,l.range.end),e.revealRange(l.range))}}))throw e.selection=o,new Hi}return e.selection}};hT=w([b(0,st)],hT);var lbe;(r=>{let t=new Map;t.set(0,In.symbolFile),t.set(1,In.symbolModule),t.set(2,In.symbolNamespace),t.set(3,In.symbolPackage),t.set(4,In.symbolClass),t.set(5,In.symbolMethod),t.set(6,In.symbolProperty),t.set(7,In.symbolField),t.set(8,In.symbolConstructor),t.set(9,In.symbolEnum),t.set(10,In.symbolInterface),t.set(11,In.symbolFunction),t.set(12,In.symbolVariable),t.set(13,In.symbolConstant),t.set(14,In.symbolString),t.set(15,In.symbolNumber),t.set(16,In.symbolBoolean),t.set(17,In.symbolArray),t.set(18,In.symbolObject),t.set(19,In.symbolKey),t.set(20,In.symbolNull),t.set(21,In.symbolEnumMember),t.set(22,In.symbolStruct),t.set(23,In.symbolEvent),t.set(24,In.symbolOperator),t.set(25,In.symbolTypeParameter);function e(n){let o=t.get(n);return o||(console.info("No codicon found for SymbolKind "+n),o=In.symbolProperty),o}r.toIcon=e})(lbe||={});var Jy=class extends wS{constructor(r,n){super();this._ignoreService=r;this._logService=n}async findFilesWithDefaultExcludes(r,n,o){let s=await this._ignoreService.asMinimatchPattern(),a=await this._findFilesWithDefaultExcludesAndExcludes(r,s,n,o);return!this._ignoreService.isRegexExclusionsEnabled||!a?a:Array.isArray(a)?await Sj(this._ignoreService,a):await this._ignoreService.isCopilotIgnored(a)?void 0:a}async findFiles(r,n,o){let s=await this._ignoreService.asMinimatchPattern();n?.exclude?n={...n,exclude:s?nde(n.exclude,s):n.exclude}:n={...n,exclude:s};let a=await super.findFiles(r,n,o);return this._ignoreService.isRegexExclusionsEnabled?await Sj(this._ignoreService,a):a}async findTextInFiles(r,n,o,s){let a={report:async c=>{await this._ignoreService.isCopilotIgnored(c.uri)||o.report(c)}};return super.findTextInFiles(r,n,a,s)}};w([oo(r=>r._logService)],Jy.prototype,"findFiles",1),Jy=w([b(0,ke),b(1,oe)],Jy);var WF=H(require("vscode")),M2=require("vscode");var oKe="https://aka.ms/vscode-gh-copilot",dbe="survey.usage",pbe="survey.nextSurveyDate",YK=14*24*60*60*1e3,sKe=7,aKe=90,cKe=3*60*1e3,uKe=5*60*1e3,lKe=2,gT=class{constructor(e,r,n,o,s){this.telemetryService=e;this.vscodeExtensionContext=r;this.envService=n;this.experimentationService=o;this.authenticationService=s;this.debounceTimeout=null;this.lastSource=null;this.lastLanguageId=null;this.surveyUri=Gr.parse(oKe),this.sessionSeed=Math.random(),setTimeout(async()=>{await this.checkInactiveUserHeuristic()&&this.promptSurvey()},uKe)}async signalUsage(e,r){await this.updateUsageData(),this.lastSource=e,r&&(this.lastLanguageId=r),this.debounceTimeout||(this.debounceTimeout=setTimeout(async()=>{await this.checkEligibility()&&this.promptSurvey(),this.debounceTimeout=null},cKe))}async checkInactiveUserHeuristic(){let e=await this.getUsageData(),r=await this.getNextSurveyDate(),n=Date.now(),o=e.activeDays.length,s=e.firstActive<n-YK,a=!r||r<n;if(o===0&&s&&a){let l=await this.experimentationService.getTreatmentVariableAsync("vscode","copilotchat.feedback.sessionProbability.inactive")??0;if(this.sessionSeed<l){let d=await this.experimentationService.getTreatmentVariableAsync("vscode","copilotchat.notificationProbability.inactive")??0;return Math.random()<d}}return!1}async checkEligibility(){let e=await this.getUsageData(),r=await this.getNextSurveyDate(),n=Date.now(),o=e.activeDays.length,s=e.firstActive<n-YK,a=!r||r<n;if(o>=lKe&&s&&a){let l=await this.experimentationService.getTreatmentVariableAsync("vscode","copilotchat.feedback.sessionProbability")??0;if(this.sessionSeed<l){let d=await this.experimentationService.getTreatmentVariableAsync("vscode","copilotchat.notificationProbability")??0;return Math.random()<d}}return!1}async getUsageData(){let e=this.vscodeExtensionContext.globalState.get(dbe);return e||{firstActive:0,activeDays:[]}}async getNextSurveyDate(){return this.vscodeExtensionContext.globalState.get(pbe)??null}async updateUsageData(){let e=await this.getUsageData(),r=Date.now(),n=new Date().setHours(0,0,0,0);e.firstActive||(e.firstActive=r),e.activeDays.includes(n)||e.activeDays.push(n),e.activeDays=e.activeDays.filter(o=>o>=r-YK),await this.vscodeExtensionContext.globalState.update(dbe,e)}async updateNextSurveyDate(e){await this.vscodeExtensionContext.globalState.update(pbe,Date.now()+e*24*60*60*1e3)}async promptSurvey(){let e=await this.getUsageData(),r=this.lastSource||"",n=this.lastLanguageId||"",o=Math.floor((Date.now()-e.firstActive)/(1e3*60*60*24));this.telemetryService.sendMSFTTelemetryEvent("survey.show",{source:r,language:n},{activeDays:e.activeDays.length,firstActive:o}),await this.updateNextSurveyDate(aKe);let s=M2.l10n.t("Give Feedback"),a=M2.l10n.t("Later"),c=M2.l10n.t("Skip");WF.window.showInformationMessage(M2.l10n.t("Got a minute? Help us make GitHub Copilot better."),s,a,c).then(async u=>{let l=u===s,d=u===a;if(this.telemetryService.sendMSFTTelemetryEvent("survey.action",{source:r,language:n,selection:l?"accepted":d?"postponed":"skipped"}),l){let p=await this.authenticationService.getCopilotToken(),f={m:this.envService.machineId,s:this.envService.sessionId,k:p.sku??"",d:e.activeDays.length.toString(),f:o.toString(),v:this.envService.getVersion(),l:n,src:r},m=this.surveyUri.with({query:new URLSearchParams(f).toString()});WF.env.openExternal(m)}else d&&await this.updateNextSurveyDate(sKe)})}};gT=w([b(0,he),b(1,jt),b(2,St),b(3,wt),b(4,Nt)],gT);var Ss=H(require("vscode"));var KF=class{constructor(){this._store=new ht;this._tabGroupsUseInfo=new Map;this._tabClock=0;this.onDidChangeActiveTextEditor=Ss.window.onDidChangeActiveTextEditor;this.onDidChangeTabs=Ss.window.tabGroups.onDidChangeTabs;let e=()=>this._tabGroupsUseInfo.set(Ss.window.tabGroups.activeTabGroup,this._tabClock++);e(),this._store.add(Ss.window.tabGroups.onDidChangeTabGroups(r=>{r.closed.forEach(n=>this._tabGroupsUseInfo.delete(n)),e()}))}dispose(){this._store.dispose()}get activeTextEditor(){let e=Ss.window.activeTextEditor;if(e&&e.document.uri.scheme!=="output")return e;let r=new tn;Ss.window.visibleTextEditors.forEach(o=>r.set(o.document.uri,o));let n=[...this._tabGroupsUseInfo];n.sort((o,s)=>s[1]-o[1]);for(let[o]of n)if(o.activeTab){let s=this._asTabInfo(o.activeTab);if(s.uri&&r.has(s.uri))return r.get(s.uri)}}get activeNotebookEditor(){return Ss.window.activeNotebookEditor}get tabs(){return Ss.window.tabGroups.all.flatMap(e=>e.tabs).map(this._asTabInfo,this)}_asTabInfo(e){let r;return e.input instanceof Ss.TabInputText||e.input instanceof Ss.TabInputNotebook?r=e.input.uri:(e.input instanceof Ss.TabInputTextDiff||e.input instanceof Ss.TabInputNotebookDiff)&&(r=e.input.modified),{tab:e,uri:r}}};var YF=class{dispose(){}sendInternalMSFTTelemetryEvent(e,r,n){}sendMSFTTelemetryEvent(e,r,n){}sendMSFTTelemetryErrorEvent(e,r,n){}sendGHTelemetryEvent(e,r,n){}sendGHTelemetryErrorEvent(e,r,n){}sendGHTelemetryException(e,r){}sendTelemetryEvent(e,r,n,o){}sendTelemetryErrorEvent(e,r,n,o){}setSharedProperty(e,r){}postEvent(e,r){}sendRestrictedGHTelemetryEvent(e,r,n){}sendRestrictedGHTelemetryErrorEvent(e,r,n){}};var r2e=H(t2e()),e7=H(require("os")),LE=class{constructor(e,r,n,o){this.namespace=n;this.client=Elt(e,r,o),n2e(e,r,this.client)}separateData(e){if(e.properties!==void 0||e.measurements!==void 0)return e.properties=e.properties||{},e.measurements=e.measurements||{},e;let r={},n={};for(let[o,s]of Object.entries(e))typeof s=="number"?n[o]=s:r[o]=s;return{properties:r,measurements:n}}sendEventData(e,r){let{properties:n,measurements:o}=this.separateData(r||{});this.client.trackEvent({name:this.qualifyEventName(e),properties:n,measurements:o})}sendErrorData(e,r){let{properties:n,measurements:o}=this.separateData(r||{});this.client.trackException({exception:e,properties:n,measurements:o})}flush(){return new Promise(e=>{this.client.flush({callback:()=>{e(void 0)}})})}qualifyEventName(e){return e.includes(this.namespace)?e:`${this.namespace}/${e}`}};function Elt(t,e,r){let n=new r2e.TelemetryClient(r);return n.config.enableAutoCollectRequests=!1,n.config.enableAutoCollectPerformance=!1,n.config.enableAutoCollectExceptions=!1,n.config.enableAutoCollectConsole=!1,n.config.enableAutoCollectDependencies=!1,n.config.noDiagnosticChannel=!0,n2e(t,e,n),n}function n2e(t,e,r){r.commonProperties=wlt(r.commonProperties,e),r.context.tags[r.context.keys.cloudRoleInstance]="REDACTED",r.config.endpointUrl=t.telemetryURL}function wlt(t,e){return t=t||{},t.common_os=e7.platform(),t.common_platformversion=e7.release(),t.common_vscodemachineid=e.machineId,t.common_vscodesessionid=e.sessionId,t.common_uikind="desktop",t.common_remotename="none",t.common_isnewappinstall="",t}var i2e="7d7048df-6dd0-4048-bb23-b716c1461f8f",o2e="3fdd7f28-937a-48c8-9a21-ba337db23bd1";var lD=H(S2e());function Klt(t){return t?lD.TargetPopulation.Insiders:lD.TargetPopulation.Public}function I2e(t,e,r){let n=t.extension.id,o=t.extension.packageJSON.version,s=Klt(r);return(0,lD.getExperimentationService)(n,o,s,e,t.globalState)}var p7=class{constructor(e,r,n){this._tokenStore=e;this._microsoftTelemetrySender=r;this._ghTelemetrySender=n;this._sharedProperties={};this._disposables=[];this._disposables.push(this._microsoftTelemetrySender,this._ghTelemetrySender),this._disposables.push(e.onDidStoreUpdate(()=>{let o=e.copilotToken;o&&this.sendMSFTTelemetryEvent("token",void 0,{chatEnabled:o.isChatEnabled()?1:0,snippyEnabled:o.isPublicSuggestionsEnabled()?1:0,telemetryEnabled:o.isTelemetryEnabled()?1:0})}))}dispose(){this._disposables.forEach(e=>e.dispose())}sendMSFTTelemetryEvent(e,r,n){this.sendTelemetryEvent(e,{github:!1,microsoft:!0},r,n)}sendMSFTTelemetryErrorEvent(e,r,n){this.sendTelemetryErrorEvent(e,{github:!1,microsoft:!0},r,n)}sendGHTelemetryEvent(e,r,n){this.sendTelemetryEvent(e,{github:!0,microsoft:!1},r,n)}sendGHTelemetryErrorEvent(e,r,n){this.sendTelemetryErrorEvent(e,{github:!0,microsoft:!1},r,n)}sendGHTelemetryException(e,r){this._ghTelemetrySender.sendExceptionTelemetry(e,r)}sendRestrictedGHTelemetryEvent(e,r,n){r={...r,...this._sharedProperties},this._ghTelemetrySender.sendRestrictedTelemetryEvent(e,r,n)}sendRestrictedGHTelemetryErrorEvent(e,r,n){r={...r,...this._sharedProperties},this._ghTelemetrySender.sendRestrictedTelemetryErrorEvent(e,r,n)}sendInternalMSFTTelemetryEvent(e,r,n){r={...r,...this._sharedProperties},this._microsoftTelemetrySender.sendInternalTelemetryEvent(e,r,n)}sendTelemetryEvent(e,r,n,o){n={...n,...this._sharedProperties},r.github&&this._ghTelemetrySender.sendTelemetryEvent(e,n,o),r.microsoft&&this._microsoftTelemetrySender.sendTelemetryEvent(e,n,o)}sendTelemetryErrorEvent(e,r,n,o){n={...n,...this._sharedProperties},r.github&&this._ghTelemetrySender.sendTelemetryErrorEvent(e,n,o),r.microsoft&&this._microsoftTelemetrySender.sendTelemetryErrorEvent(e,n,o)}setSharedProperty(e,r){this._sharedProperties[e]=r}postEvent(e,r){for(let[n,o]of Object.entries(this._sharedProperties))r.set(n,o);this._microsoftTelemetrySender.postEvent(e,r)}};var rte=require("vscode");function C2e(t){return t.replace(/([\s|(]|file:\/\/)(\/[^\s]+)/g,"$1[redacted]").replace(/([\s|(]|file:\/\/)([a-zA-Z]:[(\\|/){1,2}][^\s]+)/gi,"$1[redacted]").replace(/([\s|(]|file:\/\/)(\\[^\s]+)/gi,"$1[redacted]")}var f7=class{constructor(e,r,n,o,s,a){this._createTelemetryLogger=r;this._configService=n;this._telemetryConfig=o;this._envService=s;this._domainService=a;this._disposables=new ht;this._processToken(e.copilotToken),this._nonRestrictedTelemetryLogger=this._createTelemetryLogger(!1),this._disposables.add(e.onDidStoreUpdate(()=>{let c=e.copilotToken;this._processToken(c)})),this._disposables.add(this._domainService.onDidChangeDomains(()=>{this._nonRestrictedTelemetryLogger.dispose(),this._nonRestrictedTelemetryLogger=this._createTelemetryLogger(!1),this._restrictedTelemetryLogger&&(this._restrictedTelemetryLogger.dispose(),this._restrictedTelemetryLogger=this._createTelemetryLogger(!0))}))}_processToken(e){e||this._restrictedTelemetryLogger&&(this._restrictedTelemetryLogger.dispose(),this._restrictedTelemetryLogger=void 0),e?.getTokenValue("rt")==="1"?this._restrictedTelemetryLogger=this._createTelemetryLogger(!0):(this._restrictedTelemetryLogger&&this._restrictedTelemetryLogger.dispose(),this._restrictedTelemetryLogger=void 0)}sendTelemetryEvent(e,r,n){this._nonRestrictedTelemetryLogger.logUsage(e,this.markAsIssuedAndMakeReadyForSending(r,n))}sendTelemetryErrorEvent(e,r,n){this._nonRestrictedTelemetryLogger.logError(e,this.markAsIssuedAndMakeReadyForSending(r,n))}sendRestrictedTelemetryEvent(e,r,n){this._restrictedTelemetryLogger&&this._restrictedTelemetryLogger?.logUsage(e,this.markAsIssuedAndMakeReadyForSending(r,n))}sendRestrictedTelemetryErrorEvent(e,r,n){this._restrictedTelemetryLogger&&this._restrictedTelemetryLogger?.logError(e,this.markAsIssuedAndMakeReadyForSending(r,n))}sendExceptionTelemetry(e,r){let n=e instanceof Error?e:new Error("Non-error thrown: "+e),o=Jn.createAndMarkAsIssued({origin:C2e(r),reason:this._restrictedTelemetryLogger?"Exception logged to restricted telemetry":"Exception, not logged due to opt-out"});if(o.makeReadyForSending(this._configService,this._envService,this._telemetryConfig),this.sendTelemetryEvent("exception",o.properties,o.measurements),!this._restrictedTelemetryLogger)return;let s=Jn.createAndMarkAsIssued({origin:r});s.makeReadyForSending(this._configService,this._envService,this._telemetryConfig),this._restrictedTelemetryLogger.logError(n,s)}markAsIssuedAndMakeReadyForSending(e,r){let n=Jn.createAndMarkAsIssued(Vae(e),r);n.makeReadyForSending(this._configService,this._envService,this._telemetryConfig);let o={};for(let s in n.properties)o[s]=new s4(n.properties[s]);return{properties:o,measurements:n.measurements}}dispose(){this._nonRestrictedTelemetryLogger.dispose(),this._disposables.dispose(),this._restrictedTelemetryLogger&&this._restrictedTelemetryLogger.dispose()}};var m7=class extends f7{constructor(e,r,n,o,s,a,c,u){let l=d=>d?rte.env.createTelemetryLogger(new LE(o,r,s,c),{ignoreBuiltInCommonProperties:!0,ignoreUnhandledErrors:!0}):rte.env.createTelemetryLogger(new LE(o,r,s,a),{ignoreBuiltInCommonProperties:!0,ignoreUnhandledErrors:!0});super(u,l,e,n,r,o)}};var Jie=H(lOe());var Iq=class{constructor(e,r){this._createTelemetryReporter=r;this._disposables=new ht;this._vscodeTeamMember=!1;this._isInternal=!1;this._externalTelemetryReporter=this._createTelemetryReporter(!1),this.processToken(e.copilotToken),this._disposables.add(e.onDidStoreUpdate(()=>this.processToken(e.copilotToken)))}postEvent(e,r){let n={};for(let[o,s]of r)n[o]=s;this._isInternal&&this.sendInternalTelemetryEvent(e,n),this.sendTelemetryEvent(e,n)}sendInternalTelemetryEvent(e,r,n){this._internalTelemetryReporter&&(r={...r,"common.tid":this._tid,"common.userName":this._username??"undefined"},n={...n,"common.isVscodeTeamMember":this._vscodeTeamMember?1:0},this._internalTelemetryReporter.sendRawTelemetryEvent(e,r,n))}sendTelemetryEvent(e,r,n){r={...r,"common.tid":this._tid??"","common.sku":this._sku??"undefined"},this._isInternal&&(n={...n,"common.internal":1}),this._externalTelemetryReporter.sendTelemetryEvent(e,r,n)}sendTelemetryErrorEvent(e,r,n){r={...r,"common.tid":this._tid??"","common.sku":this._sku??"undefined"},this._isInternal&&(n={...n,"common.internal":1}),this._externalTelemetryReporter.sendTelemetryErrorEvent(e,r,n)}dispose(){this._externalTelemetryReporter.dispose(),this._internalTelemetryReporter?.dispose()}processToken(e){if(this._username=e?.username,this._vscodeTeamMember=!!e?.isVscodeTeamMember,this._tid=e?.getTokenValue("tid"),this._sku=e?.sku,this._isInternal=!!e?.isInternal,this._isInternal&&!this._internalTelemetryReporter&&(this._internalTelemetryReporter=this._createTelemetryReporter(!0)),!e||!this._isInternal||!e.isChatEnabled()){this._internalTelemetryReporter?.dispose(),this._internalTelemetryReporter=void 0;return}}};var Cq=class extends Iq{constructor(e,r,n){let o=s=>s?new Jie.default(e):new Jie.default(r);super(n,o)}};var sR=class extends p7{constructor(e,r,n,o,s,a,c,u,l,d){let p=new Cq(r,n,c),f=new m7(a,u,l,d,e,o,s,c);super(c,p,f)}};sR=w([b(5,be),b(6,Ga),b(7,St),b(8,a4),b(9,Xr)],sR);var pOe=require("path"),fOe=require("process"),Pb=require("vscode"),Tq=new Map,eoe=new Map;function mOe(){let t=Pb.window.activeTerminal;return t===void 0?"":Tq.get(t)?.join(`
`)||""}function hOe(){let t=Pb.window.activeTerminal;if(t!==void 0)return eoe.get(t)?.at(-1)}function gOe(){try{return Pb.window.activeTerminal?.selection??""}catch{return""}}var Zie;function vOe(){let t=Pb.window.activeTerminal;if(t&&"shellPath"in t.creationOptions){let e=t.creationOptions.shellPath;if(e){let r,n=(0,pOe.basename)(e);if(n==="bash.exe")r="Git Bash";else{let o=n.replace(/\..+/,"");switch(o){case"pwsh":case"powershell":r="powershell";break;case"":break;default:r=o}}if(r)return Zie=r,r}}return Zie||(fOe.platform==="win32"?"powershell":"bash")}function dOe(t,e){t.push(e),t.length>40&&t.shift()}function Qft(t){let e=/(:?\x1b\[|\x9B)[=?>!]?[\d;:]*["$#'* ]?[a-zA-Z@^`{}|~]/g;return t&&(t=t.replace(e,"")),t}function bOe(){return[Pb.window.onDidWriteTerminalData(t=>{let e=Tq.get(t.terminal);e||(e=[],Tq.set(t.terminal,e)),dOe(e,Qft(t.data))}),Pb.window.onDidExecuteTerminalCommand(t=>{let e=eoe.get(t.terminal);e||(e=[],eoe.set(t.terminal,e)),dOe(e,t)}),Pb.window.onDidCloseTerminal(t=>{Tq.delete(t)})]}var Eq=class extends dt{constructor(){super();for(let e of bOe())this._register(e)}get terminalBuffer(){return mOe()}get terminalLastCommand(){return hOe()}get terminalSelection(){return gOe()}get terminalShellType(){return vOe()}};var as=H(require("vscode"));var wq=class extends dt{constructor(){super();this.resultsDocs=new tn;this.isEnabled=EK("TestProvider.isEnabled",!1);this._register($y(r=>{as.commands.executeCommand("setContext","github.copilot.chat.fixTestFailures.enabled",this.isEnabled.read(r))})),this._register(as.tests.onDidChangeTestResults(()=>this.setHasFailureContextKey())),this.setHasFailureContextKey()}setHasFailureContextKey(){as.commands.executeCommand("setContext","github.copilot.chat.fixTestFailures.hasFailure",!!Os.first(this.getAllFailures()))}get lastResultsFrom(){return as.tests.testResults[0]?.completedAt}async setEnablement(r){let n=r.getTreatmentVariable("vscode","copilotchat.fixTestFailures"),o=as.env.appName.includes("Insiders")||as.env.appName.includes("OSS"),s=n||o;this.isEnabled.set(s,void 0)}getAllFailures(){let r=as.tests.testResults[0];return r?this.dfsFailures(r.results):Os.empty()}getFailureAtPosition(r,n){let o=as.tests.testResults[0];if(this.resultsDocsAreForTestRun!==o&&this.makeResultsDocs(o),!o)return;let s=this.resultsDocs.get(r)||[],a=moe(s,c=>!c.range?.start.isAfter(n));if(a){for(let c of a.taskStates)if(c.state===as.TestResultState.Failed||c.state===as.TestResultState.Errored)return{snapshot:a,task:c}}}*dfsFailures(r){for(let n of r){yield*this.dfsFailures(n.children);for(let o of n.taskStates)(o.state===as.TestResultState.Failed||o.state===as.TestResultState.Errored)&&(yield{snapshot:n,task:o})}}makeResultsDocs(r){if(this.resultsDocs.clear(),this.resultsDocsAreForTestRun=r,!r)return;let n=[r.results];for(;n.length;)for(let s of n.pop()){if(n.push(s.children),!s.uri)continue;let a=this.resultsDocs.get(s.uri);a?a.push(s):this.resultsDocs.set(s.uri,[s])}let o=new as.Range(0,0,0,0);for(let s of this.resultsDocs.values())s.sort((a,c)=>(a.range||o).start.compareTo((c.range||o).start)||Xft(a.taskStates,c.taskStates))}},Xft=(t,e)=>{let r=0,n=0;for(let o of t)r=Math.max(r,o.state);for(let o of e)n=Math.max(n,o.state);return r-n};var jN=H(require("vscode")),Rq=class{getAllExtensions(){return jN.extensions.all}async getAllCommands(){return jN.commands.executeCommand("_getAllCommands")}async getAllSettings(){return jN.commands.executeCommand("_getAllSettings")}};var Rf=require("vscode");function yOe(t){return t.scheme==="vscode-vfs"&&t.authority.startsWith("github")}var aR=class extends c4{constructor(r){super();this._accessor=r;this.onDidOpenTextDocument=Rf.workspace.onDidOpenTextDocument;this.onDidChangeTextDocument=Rf.workspace.onDidChangeTextDocument;this.onDidCloseTextDocument=Rf.workspace.onDidCloseTextDocument;this._logService=this._accessor.get(oe)}get textDocuments(){return Rf.workspace.textDocuments}async openTextDocument(r){return await Rf.workspace.openTextDocument(r)}get notebookDocuments(){return Rf.workspace.notebookDocuments}getWorkspaceFolders(){return Rf.workspace.workspaceFolders?.map(r=>r.uri)??[]}ensureWorkspaceIsFullyLoaded(){return this._fullyLoadedPromise??=(async()=>{let r=this._accessor.get(VF);for(let n of this.getWorkspaceFolders())if(yOe(n)){this._logService.public.debug(`Preloading virtual workspace contents for ${n}`);try{let o=await r.loadWorkspaceContents(n);this._logService.public.info(`loading virtual workspace contents resulted in ${o} for: ${n}`)}catch(o){this._logService.public.error(`Error loading virtual workspace contents for ${n}: ${o}`)}}})(),this._fullyLoadedPromise}async showWorkspaceFolderPicker(){if(this.getWorkspaceFolders())return Rf.window.showWorkspaceFolderPick()}};aR=w([b(0,st)],aR);var er=H(require("vscode"));var Pq=H(nt());var kq=class extends X{render(){return vscpp(vscppf,null,vscpp(Pq.SystemMessage,{priority:1e3},vscpp("br",null),"You are an AI programming assistant.",vscpp("br",null),'When asked for your name, you must respond with \\"GitHub Copilot\\".',vscpp("br",null),"Follow the user's requirements carefully & to the letter.",vscpp("br",null),"Your expertise is strictly limited to software development topics.",vscpp("br",null),"Follow Microsoft content policies.",vscpp("br",null),"Avoid content that violates copyrights.",vscpp("br",null),"For questions not related to software development, simply give a reminder that you are an AI programming assistant.",vscpp("br",null),"Keep your answers short and impersonal.",vscpp("br",null),vscpp("br",null),vscpp("br",null),vscpp(bu,{location:this.props.location,endpoint:this.props.endpoint}),vscpp("br",null),"First think step-by-step - describe your plan for what to build in pseudocode, written out in great detail.",vscpp("br",null),"Then output the code in a single code block.",vscpp("br",null),"Minimize any other prose.",vscpp("br",null),"Use Markdown formatting in your answers.",vscpp("br",null),"Make sure to include the programming language name at the start of the Markdown code blocks.",vscpp("br",null),"Avoid wrapping the whole response in triple backticks.",vscpp("br",null),"The user works in an IDE called Visual Studio Code which has a concept for editors with open files, integrated unit test support, an output pane that shows the output of running the code as well as an integrated terminal.",vscpp("br",null),"The active document is the source code the user is looking at right now.",vscpp("br",null),"You can only give one reply for each conversation turn."),vscpp(Ot,{priority:800,history:this.props.history}),vscpp(Pq.UserMessage,{priority:900},"Write a short one-sentence question that the user can ask that naturally follows from the previous few questions and answers. It should not ask a question which is already answered in the conversation. It should be a question that you are capable of answering. Reply with only the text of the question and nothing else.",vscpp("br",null),vscpp(Xt,null)))}};var cR=class{constructor(e,r,n,o,s,a,c,u,l){this.options=e;this.logService=r;this.endpointProvider=n;this.experimentationService=o;this.configurationService=s;this.chatMLFetcher=a;this.telemetryService=c;this.tabsAndEditorsService=u;this.instantiationService=l}async computeFollowups(e,r){let n=e.getLatestTurn();if(!n)return[];let o={messageId:n.requestId},c=this.configurationService.getExperimentBasedConfig(de.FollowUpsEnabled,this.experimentationService)&&n.status==="success"?await this.followUp(e,2,r,o):[];if(r.isCancellationRequested)return[];let u=c.map(p=>this.conversationToReplyFollowup(p,o)),l=n,d=l?.intentInvocation;if(d?.followUps){let p=await d.followUps(l);u.push(...p)}return r.isCancellationRequested?[]:(this.telemetryService.sendMSFTTelemetryEvent("followUps.suggested",{requestId:l.requestId,messageId:o.messageId},{turn:e.turns.length,suggestionCount:u.length,characterCount:u.reduce((p,f)=>p+f.prompt.length,0)}),u)}async followUp(e,r,n,o){let s=o?{...o}:{};s.requestId=_r(),s.messageSource="chat.followup";let a=await this.endpointProvider.getChatEndpoint("gpt-3.5-turbo"),{messages:c}=await ki(this.instantiationService,a,kq,{history:e.turns,endpoint:a,location:r}),u=await this.chatMLFetcher.fetchOne("followUp",c,void 0,n,r,a,void 0,{temperature:this.options.temperature,top_p:this.options.topP},s);if(u.type==="success"){let l=[];return u.value&&l.push(u.value.trim()),l}else return this.logService.public.error(`Failed to fetch followups because of response type (${u.type}) and reason (${u.reason})`),[]}conversationToReplyFollowup(e,r){let n=r??{};return n.suggestionId=_r(),n.suggestionType="Follow-up from model",u3(this.telemetryService,n.suggestionType,n.messageId,n.suggestionId,this.tabsAndEditorsService.activeTextEditor?.document),{prompt:e}}};cR=w([b(0,Rr),b(1,oe),b(2,Se),b(3,wt),b(4,be),b(5,Ct),b(6,he),b(7,zt),b(8,K)],cR);var Dq=H(nt());var Aq=class extends X{render(){return vscpp(vscppf,null,vscpp(Dq.SystemMessage,{priority:1e3},"You are an expert in crafting pithy titles for chatbot conversations. You are presented with a chat conversation, and you reply with a brief title that captures the main topic of discussion in that conversation.",vscpp("br",null),vscpp(Rt,null),vscpp(Xt,null),"The title should not be wrapped in quotes. It should about 8 words or fewer.",vscpp("br",null),"Here are some examples of good titles:",vscpp("br",null),"- Git rebase question",vscpp("br",null),"- Installing Python packages",vscpp("br",null),"- Location of LinkedList implentation in codebase",vscpp("br",null),"- Adding a tree view to a VS Code extension",vscpp("br",null),"- React useState hook usage"),vscpp(Ot,{priority:800,history:this.props.history}),vscpp(Dq.UserMessage,{priority:900},"Please write a brief title for the chat conversation above. If the conversation covers multiple topics, you can just focus on the last one."))}};var uR=class{constructor(e,r,n,o,s,a){this.options=e;this.logService=r;this.endpointProvider=n;this.chatMLFetcher=o;this.commandService=s;this.instantiationService=a}async provideChatTitle(e,r){let n=new Md;if(rP(n,e.history,this.commandService),n.turns.filter(c=>c.status==="success").length===0)return"";let o=await this.endpointProvider.getChatEndpoint("gpt-3.5-turbo"),{messages:s}=await ki(this.instantiationService,o,Aq,{history:n.turns}),a=await this.chatMLFetcher.fetchOne("title",s,void 0,r,2,o,void 0,{temperature:this.options.temperature,top_p:this.options.topP},{messageSource:"chatTitleProvider"});if(r.isCancellationRequested)return"";if(a.type==="success"){let c=a.value.trim();return c.match(/^".*"$/)&&(c=c.slice(1,-1)),c}else return this.logService.public.error(`Failed to fetch conversation title because of response type (${a.type}) and reason (${a.reason})`),""}};uR=w([b(0,Rr),b(1,oe),b(2,Se),b(3,Ct),b(4,vu),b(5,K)],uR);var Uo=H(require("vscode"));var lR=class{constructor(e,r,n){this.configurationService=e;this.telemetryService=r;this.authenticationService=n;this.hasShownWelcomeMessage=!1}async provideWelcomeMessage(e,r){let n=(await this.authenticationService.getCopilotToken()).isInternal,o=this.authenticationService.anyGitHubSession?.account?.label,s=this.configurationService.getConfig(de.WelcomeMessage),a="workbench.action.openSettings",c=new Uo.MarkdownString(Uo.l10n.t("{0} has identified you as an internal user. Internal users have additional telemetry collected for product improvement purposes. If you work on a project that contains customer content, it is required you disable this telemetry as it does contain PII. [Disable Telemetry]({1}).",["Copilot",`command:${a}?%5B%22telemetry.telemetryLevel%22%5D`]));c.isTrusted={enabledCommands:[a]};let u=Uo.l10n.t({message:"I'm powered by AI, so surprises and mistakes are possible. Make sure to verify any generated code or suggestions, and [share feedback]({0}) so that we can learn and improve. Check out the [{1} documentation]({2}) to learn more.",args:[l4,"Copilot","https://code.visualstudio.com/docs/copilot/getting-started-chat"],comment:["{Locked=']({'}","the [text](url) is a markdown link syntax. Do not add any additional spaces between ] and ("]}),l=o?" **@"+o+"**":"";if(s==="never"||this.hasShownWelcomeMessage&&s==="first")return[Uo.l10n.t("Hi{0}, how can I help you?",l)];this.hasShownWelcomeMessage=!0;let d="workbench.action.quickchat.launchInlineChat",p=Uo.window.activeNotebookEditor||Uo.window.activeTextEditor?Uo.l10n.t("You can also [start an inline chat session]({0}).",`command:${d}`):"",f=new Uo.MarkdownString(Uo.l10n.t("Welcome,{0}, I'm your {1} and I'm here to help you get things done faster. {2}",l,"Copilot",p));f.isTrusted={enabledCommands:[d]};let m=[f,u];return n&&m.push(c),m}provideSampleQuestions(e,r){let n=Uo.window.activeNotebookEditor||Uo.window.activeTextEditor?Jft():_Oe([["","help",Uo.l10n.t("What can you do?")]]);return this.suggestionsToTelemetry([...n],"welcome"),n}suggestionsToTelemetry(e,r){e.map(n=>{u3(this.telemetryService,`@${n.participant} /${n.command} ${n.prompt}`,r,"",Uo.window.activeTextEditor?.document)})}};lR=w([b(0,be),b(1,he),b(2,Nt)],lR);function Jft(){let t=lg("workspace");return _Oe([[t,"fix",Uo.l10n.t("the problems in my code")],[t,"tests",Uo.l10n.t("add unit tests for my code")],[t,"explain",Uo.l10n.t("how the selected code works")]])}function _Oe(t){return t.map(([e,r,n])=>({prompt:"",participant:e,command:r,label:`/${r} ${n}`}))}var dR=class{constructor(e){this.instantiationService=e}debugGetCurrentChatAgents(){return this._lastChatAgents}register(){let e=this.instantiationService.createInstance(Il);return e.register(),this._lastChatAgents=e,{dispose:()=>{e.dispose(),this._lastChatAgents=void 0}}}};dR=w([b(0,K)],dR);var Il=class{constructor(e,r,n,o,s,a,c,u,l,d){this.options=e;this.extensionContext=r;this.octoKitService=n;this.authenticationService=o;this.logService=s;this.languageDiagnosticsService=a;this.instantiationService=c;this.userFeedbackService=u;this.configurationService=l;this.conversationStore=d;this._disposables=new ht;this._inlineChatSessions=new Uh(10,1)}dispose(){this._disposables.dispose()}register(){this._disposables.add(this.registerDefaultAgent()),this._disposables.add(this.registerEditorDefaultAgent()),this._disposables.add(this.registerNotebookDefaultAgent()),this._disposables.add(this.registerWorkspaceAgent()),this._disposables.add(this.registerVSCodeAgent()),this._disposables.add(this.registerTerminalAgent()),this._disposables.add(this.registerTerminalPanelAgent())}createAgent(e,r,n){n=n||lg(e);let o=er.chat.createChatParticipant(n,this.getChatParticipantHandler(n,e,r));return o.onDidReceiveFeedback(s=>{if(Il.isInlineChatResult(s.result))return this.handleInlineChatUserAction(s.result,void 0,s);this.userFeedbackService.handleFeedback(s,n)}),o.onDidPerformAction(s=>{if(Il.isInlineChatResult(s.result))return this.handleInlineChatUserAction(s.result,s,void 0);this.userFeedbackService.handleUserAction(s,n)}),o.supportIssueReporting=this.configurationService.getConfig(de.DebugReportFeedback),o.followupProvider={provideFollowups:async(s,a,c)=>{let u=s.metadata?.responseId&&this.conversationStore.getConversation(s.metadata.responseId);return u?await this.instantiationService.createInstance(cR).computeFollowups(u,c):[]}},o}registerWorkspaceAgent(){let e=this.createAgent(qf,"workspace");return e.iconPath=new er.ThemeIcon("code"),e.isSecondary=!0,e}registerVSCodeAgent(){let e=this.createAgent(ak,"vscode"),r=er.env.appName.includes("Insiders")||er.env.appName.includes("OSS");return e.iconPath=Ye.joinPath(this.extensionContext.extensionUri,"assets",r?"vscode-chat-avatar-insiders.svg":"vscode-chat-avatar-stable.svg"),e.supportsSlowReferences=!0,e}registerTerminalAgent(){let e=this.createAgent(Xb,"terminal");return e.iconPath=new er.ThemeIcon("terminal"),e.supportsSlowReferences=!0,e.followupProvider=void 0,e}registerTerminalPanelAgent(){let e=this.createAgent(Xb,"terminal","github.copilot.terminalPanel");return e.iconPath=new er.ThemeIcon("terminal"),e.supportsSlowReferences=!0,e}async initDefaultAgentRequestorProps(e){let r=async()=>{let n=await this.octoKitService.getCurrentAuthedUser();return n?(e.requester={name:n.login,icon:Ye.parse(n?.avatar_url??`https://avatars.githubusercontent.com/${n.login}`)},!0):!1};if(!await r()){let n=this.authenticationService.onDidAuthenticationChange(async()=>{await r()&&n.dispose()})}}registerDefaultAgent(){let e=this.createAgent(fH,"unknown");e.iconPath=new er.ThemeIcon("copilot"),e.supportsSlowReferences=!0,this.initDefaultAgentRequestorProps(e),e.helpTextPrefix=er.l10n.t("You can ask me general programming questions, or chat with the following participants which have specialized expertise and can perform actions:");let r=er.l10n.t({message:`To have a great conversation, ask me questions as if I was a real programmer:

* **Show me the code** you want to talk about by having the files open and selecting the most important lines.
* **Make refinements** by asking me follow-up questions, adding clarifications, providing errors, etc.
* **Review my suggested code** and tell me about issues or improvements, so I can iterate on it.

You can also ask me questions about your editor selection by [starting an inline chat session](command:inlineChat.start).

Learn more about [GitHub Copilot](https://docs.github.com/copilot/using-github-copilot/getting-started-with-github-copilot?tool=vscode&utm_source=editor&utm_medium=chat-panel&utm_campaign=2024q3-em-MSFT-getstarted) in [Visual Studio Code](https://code.visualstudio.com/docs/copilot/overview).`,comment:"{Locked='](command:inlineChat.start)'}"}),n=new er.MarkdownString(r);return n.isTrusted={enabledCommands:["inlineChat.start"]},e.helpTextPostfix=n,e.helpTextVariablesPrefix=er.l10n.t("You can also help me understand your question by using the following variables to give me extra context:"),e.welcomeMessageProvider=this.instantiationService.createInstance(lR),e.titleProvider=this.instantiationService.createInstance(uR),e}registerEditorDefaultAgent(){let e=this.createAgent(sk,"unknown");return e.iconPath=new er.ThemeIcon("copilot"),e.welcomeMessageProvider={provideWelcomeMessage:()=>[],provideSampleQuestions:(r,n)=>{if(er.window.activeTextEditor){let{document:o,selection:s}=er.window.activeTextEditor,a=FG(this.languageDiagnosticsService.getDiagnostics(o.uri),s);if(a)return[{prompt:`/fix ${a.message}`}]}}},e}registerNotebookDefaultAgent(){let e=this.createAgent("notebook","unknown");return e.iconPath=new er.ThemeIcon("copilot"),e.welcomeMessageProvider={provideWelcomeMessage:()=>[],provideSampleQuestions:(r,n)=>{if(er.window.activeTextEditor){let{document:o,selection:s}=er.window.activeTextEditor,a=FG(this.languageDiagnosticsService.getDiagnostics(o.uri),s);if(a)return[{prompt:`/fix ${a.message}`}]}}},e}getChatParticipantHandler(e,r,n){return async(o,s,a,c)=>{if(o.location2 instanceof er.ChatRequestEditorData)return this.handleInlineChatRequest(e,o,s,a,c);if(o.location2 instanceof er.ChatRequestNotebookData)return this.handleNotebookChatRequest(e,o,s,a,c);let u=DS[n],l=o.command&&u?u[o.command]:n;return await this.instantiationService.createInstance(rI,s.history,o,a,c,{agentName:r,agentId:e,intentId:l}).getResult()}}static{this.metadataKey="inlineChatSession"}static isInlineChatResult(e){return!!this.retrieveSessionId(e)}static retrieveSessionId(e){return e?.metadata?.[Il.metadataKey]}async handleInlineChatRequest(e,r,n,o,s){iu(r.location2 instanceof er.ChatRequestEditorData),this.logService.public.trace("Inline chat request received from extension host"),this._inlineChatProvider??=this.instantiationService.createInstance(Cu,e,this.options.rejectionMessage);let{document:a,selection:c,wholeRange:u}=r.location2;return this.handleCommonInlineChatRequest(e,n,o,a,c,u,r,s)}async handleCommonInlineChatRequest(e,r,n,o,s,a,c,u){this._inlineChatProvider??=this.instantiationService.createInstance(Cu,e,this.options.rejectionMessage);let l;for(let v=r.history.length-1;v>=0;v--){let y=r.history[v];if(y instanceof er.ChatResponseTurn){l=y.result;break}}let d=Il.retrieveSessionId(l)??_r(),p=this._inlineChatSessions.get(d);p||(this.logService.public.trace("Creating new inline chat session"),p={session:await this._inlineChatProvider.prepareInteractiveEditorSession({document:o,selection:s}),responses:[]},this._inlineChatSessions.set(d,p),this.logService.public.trace("Inline chat session created"));let f={...c,selection:s,wholeRange:a},m=new tn,h=new Al(v=>{if(v instanceof er.ChatResponseTextEditPart){let y=m.get(v.uri);if(!y){let _=er.workspace.textDocuments.find(x=>x.uri.toString()===v.uri.toString());_&&(y=new Dk(_.getText()),m.set(v.uri,y))}if(y){let _=v.edits.filter(x=>{let S=y.transformer.toOffsetRange(x.range);return y.text.substring(S.start,S.endExclusive)!==x.newText});v=new er.ChatResponseTextEditPart(v.uri,_),y.applyOffsetEdits(y.transformer.toOffsetEdit(v.edits))}}n.push(v)}),g;try{let v=await this._inlineChatProvider.provideInteractiveEditorResponse(p.session,f,h,u);v&&v.kind==="ok"&&p.responses.push(v),v&&v.kind==="error"&&(g=v.errorDetails)}catch(v){this.logService.public.error(v)}return{metadata:{[Il.metadataKey]:d},errorDetails:g}}async handleInlineChatUserAction(e,r,n){let o=Il.retrieveSessionId(e);if(!o)return;let s=this._inlineChatSessions.get(o);if(!s||s.responses.length===0)return;let a;r?.action.kind==="editor"?a=r.action.accepted?3:2:r?.action.kind==="bug"?a=4:n?.kind===er.ChatResultFeedbackKind.Helpful?a=1:n?.kind===er.ChatResultFeedbackKind.Unhelpful&&(a=0),a!==void 0&&this._inlineChatProvider?.handleInteractiveEditorResponseFeedback(s.session,s.responses.at(-1),a)}async handleNotebookChatRequest(e,r,n,o,s){iu(r.location2 instanceof er.ChatRequestNotebookData),this._inlineChatProvider??=this.instantiationService.createInstance(Cu,e,this.options.rejectionMessage);let a=r.location2.cell,c=new er.Selection(0,0,0,0),u=new er.Range(0,0,0,0);return this.handleCommonInlineChatRequest(e,n,o,a,c,u,r,s)}debugGetLastSession(){let e=Zft(this._inlineChatSessions.keys());return e?this._inlineChatSessions.get(e)?.session:void 0}};Il=w([b(0,Rr),b(1,jt),b(2,d4),b(3,Nt),b(4,oe),b(5,To),b(6,K),b(7,aC),b(8,be),b(9,tv)],Il);function Zft(t){let e;for(let r of t)e=r;return e}var kf=H(require("vscode"));var Nq=class{async add(e,r){let n=kf.workspace.getConfiguration("launch",e),o=n.get("configurations");r.configurations.length&&await n.update("configurations",[...r.configurations,...o||[]],kf.ConfigurationTarget.WorkspaceFolder);let s=n.get("inputs");r.inputs?.length&&await n.update("inputs",[...r.inputs,...s||[]],kf.ConfigurationTarget.WorkspaceFolder)}async show(e,r){let n=Ye.joinPath(e,".vscode","launch.json"),o;try{o=await kf.workspace.openTextDocument(n)}catch{return}let s;if(r)try{let a=o.getText(),c=[],u=!1;fpe(a,{onObjectBegin(l){c.push(l)},onObjectEnd(l,d){let p=c.pop();if(u){u=!1;let f=new Wa(a),m=f.offsetToPosition(p),h=f.offsetToPosition(l+d);s=new kf.Range(m.lineNumber-1,m.column-1,h.lineNumber-1,h.column-1)}},onLiteralValue(l,d,p,f,m,h){if(l===r){let g=h();g[g.length-1]==="name"&&(u=!0)}}})}catch{}await kf.window.showTextDocument(o,{selection:s})}};var emt=[{max_token_sequence_length:1,last_tokens_to_consider:10},{max_token_sequence_length:10,last_tokens_to_consider:30},{max_token_sequence_length:20,last_tokens_to_consider:45},{max_token_sequence_length:30,last_tokens_to_consider:60}];function SOe(t,e="client"){if(e==="proxy")return!1;let r=t.slice();return r.reverse(),xOe(r)||xOe(r.filter(n=>n.trim().length>0))}function xOe(t){let e=tmt(t);for(let r of emt){if(t.length<r.last_tokens_to_consider)continue;if(r.last_tokens_to_consider-1-e[r.last_tokens_to_consider-1]<=r.max_token_sequence_length)return!0}return!1}function tmt(t){let e=Array(t.length).fill(0);e[0]=-1;let r=-1;for(let n=1;n<t.length;n++){for(;r>=0&&t[r+1]!==t[n];)r=e[r];t[r+1]===t[n]&&r++,e[n]=r}return e}function IOe(t){if(t!==void 0&&t!==0&&t.hostname==="github.com")return t.owner+"/"+t.repo}async function COe(t,e,r,n,o,s,a,c,u,l,d,p){let f=nmt(c);if(d?.isCancellationRequested)return{type:"canceled",reason:"before fetch request"};t.internal.debug(`url ${a.url}`),t.internal.debug(`modelMaxPromptTokens ${a.modelMaxPromptTokens}`),t.internal.debug(`modelMaxResponseTokens ${f.max_tokens??2048}`),t.internal.debug(`chat model ${c.model}`);let m=c.secretKey??(await s.getCopilotToken()).token;if(!m)return t.public.error(`Failed to send request to ${a.url} due to missing key`),hm(e,`Failed to send request to ${a.url} due to missing key`),{type:"failed",modelRequestId:void 0,failKind:"tokenExpiredOrInvalid",reason:"key is missing"};let h=await omt(t,e,r,n,o,a,c.ourRequestId,f,m,c.location,d,p);if(d?.isCancellationRequested){let y=await h.body();try{y.destroy()}catch(_){t.public.error(_,"Error destroying stream"),e.sendGHTelemetryException(_,"Error destroying stream")}return{type:"canceled",reason:"after fetch request"}}if(h.status!==200){let y=rmt(a,c.location,c.ourRequestId);return t.public.info("Request ID for failed request: "+c.ourRequestId),imt(t,e,s,y,h,c.ourRequestId)}let g=c.postOptions?.n??1;return{type:"success",chatCompletions:await a.processResponseFromChatEndpoint(e,t,h,g,l,u,d),getProcessingTime:()=>Rde(h)}}function rmt(t,e,r){return Jn.createAndMarkAsIssued({endpoint:"completions",engineName:"chat",uiKind:gt.toString(e),headerRequestId:r})}function nmt(t){let e={messages:t.messages,model:t.model};t.postOptions&&Object.assign(e,t.postOptions);let r=IOe(t.repoInfo);return r!==void 0&&(e.nwo=r),t.intent&&(e.intent=t.intent,t.intent_model&&(e.intent_model=t.intent_model),t.intent_tokenizer&&(e.intent_tokenizer=t.intent_tokenizer),t.intent_threshold&&(e.intent_threshold=t.intent_threshold)),e}async function imt(t,e,r,n,o,s){let a=C1(o,void 0);s=a.headerRequestId||s,n.properties.error=`Response status was ${o.status}`,n.properties.status=String(o.status),e.sendGHTelemetryEvent("request.shownWarning",n.properties,n.measurements);let c=await o.text();if(o.status===401&&c.includes("authorize_url"))try{let u=JSON.parse(c);return{type:"failed",modelRequestId:a,failKind:"unauthorized",reason:o.statusText||o.statusText,data:u}}catch{}if(o.status===401||o.status===403)return r.resetCopilotToken(o.status),{type:"failed",modelRequestId:a,failKind:"tokenExpiredOrInvalid",reason:`token expired or invalid: ${o.status}`};if(o.status===499)return t.public.info("Cancelled by server"),{type:"failed",modelRequestId:a,failKind:"serverCanceled",reason:"canceled by server"};if(o.status===466)return t.public.info(c),{type:"failed",modelRequestId:a,failKind:"clientNotSupported",reason:`client not supported: ${c}`};if(o.status===400&&c.includes("off_topic"))return{type:"failed",modelRequestId:a,failKind:"offTopic",reason:"filtered as off_topic by intent classifier: message was not programming related"};if(o.status===424)return{type:"failed",modelRequestId:a,failKind:"failedDependency",reason:c};if(o.status===429){if(c.includes("extension_blocked"))try{let u=JSON.parse(c);if(u.error&&(u=u.error),u.code==="extension_blocked"&&u.type==="rate_limit_error")return{type:"failed",modelRequestId:a,failKind:"extensionBlocked",reason:u.reason??u.code,data:{...u.message,retryAfter:o.headers.get("retry-after")}}}catch{}return{type:"failed",modelRequestId:a,failKind:"rateLimited",reason:c}}return o.status>=500&&o.status<600?(t.public.error(`Server error: ${o.status} ${c}`),{type:"failed",modelRequestId:a,failKind:"serverError",reason:`Server error, please report the following request id: ${s}`}):o.status===422?{type:"failed",modelRequestId:a,failKind:"contentFilter",reason:"Filtered by Responsible AI Service"}:(t.public.error(`Unhandled status from server: ${o.status} ${c}`),hm(e,"Unhandled status from server: "+o.status,c),{type:"failed",modelRequestId:a,failKind:"unknown",reason:`unhandled status from server, please report the following request id: ${s}`})}async function omt(t,e,r,n,o,s,a,c,u,l,d,p){let f=Jn.createAndMarkAsIssued({endpoint:"completions",engineName:"chat",uiKind:gt.toString(l),...p},{maxTokenWindow:s.modelMaxPromptTokens});for(let[g,v]of Object.entries(c))g!=="messages"&&(f.properties[`request.option.${g}`]=JSON.stringify(v)??"undefined");f.properties.headerRequestId=a,e.sendGHTelemetryEvent("request.sent",f.properties,f.measurements);let m=Date.now(),h=smt(l);return Mg(r,n,e,o,s,u,await Pl(process.env.HMAC_SECRET),h,a,c,d).then(g=>{let v=C1(g,void 0);f.extendWithRequestId(v);let y=Date.now()-m;return f.measurements.totalTimeMs=y,t.internal.debug(`request.response: [${s.url}], took ${y} ms`),t.internal.debug(`messages: ${JSON.stringify(c.messages)}`),e.sendGHTelemetryEvent("request.response",f.properties,f.measurements),g}).catch(g=>{if(r.isAbortError(g))throw g;let v=f.extendedBy({error:"Network exception"});e.sendGHTelemetryEvent("request.shownWarning",v.properties,v.measurements),f.properties.code=String(g.code??""),f.properties.errno=String(g.errno??""),f.properties.message=String(g.message??""),f.properties.type=String(g.type??"");let y=Date.now()-m;throw f.measurements.totalTimeMs=y,t.internal.debug(`request.response: [${s.url}] took ${y} ms`),e.sendGHTelemetryEvent("request.error",f.properties,f.measurements),g}).finally(()=>{S$(e,c.messages,f)})}function smt(t){switch(t){case 2:return"conversation-panel";case 1:return"conversation-inline"}}var toe=class{constructor(){this._onDidMakeChatMLRequest=new Yt;this.onDidMakeChatMLRequest=this._onDidMakeChatMLRequest.event}async fetchOne(e,r,n,o,s,a,c,u,l,d){let p=await this.fetchMany(e,r,n,o,s,a,c,{...u,n:1},l,d);return p.type==="success"?{...p,value:p.value[0]}:p}},Ab=class extends toe{constructor(r,n,o,s,a,c,u,l,d){super();this._configurationService=r;this._fetcherService=n;this._telemetryService=o;this._tokenizerProvider=s;this._requestLogger=a;this._logService=c;this._envService=u;this._domainService=l;this._authenticationService=d}async fetchMany(r,n,o,s,a,c,u,l,d,p){let f=d?.requestId??d?.messageId??_r(),m=J1(this._tokenizerProvider.acquireTokenizer(c),n.map(S=>({role:S.role,content:S.content,..."name"in S&&S.name?{name:S.name}:void 0}))),h=Math.min(c.modelMaxPromptTokens-m+2048,4096);l={max_tokens:h,...l};let g=Ab.preparePostOptions(l),v=c.model;p&&(p.intent_model=await this.getOffTopicModelName(),p.intent_tokenizer=await this.getOffTopicModelTokenizer(),p.intent_threshold=await this.getOffTopicModelThreshold());let y={messages:n,model:v,repoInfo:void 0,ourRequestId:f,location:a,postOptions:g,secretKey:l.secretKey,...p},_=Jn.createAndMarkAsIssued({...d,uiKind:gt.toString(a)}),x=this._requestLogger.logChatRequest(r,c,y);try{let S,I=amt(y);if(!I.isValid)S={type:"failed",modelRequestId:void 0,failKind:"validationFailed",reason:`Prompt failed validation with the reason: ${I.reason}. Please file an issue.`};else{S=await COe(this._logService,this._telemetryService,this._fetcherService,this._envService,this._domainService,this._authenticationService,c,y,_,o||(async()=>{}),s,d);let B=u?.extensionId??Ud,V=u?.agent&&B===Ud&&zae.includes(u.agent)?lg(u.agent):u?.agent;this._onDidMakeChatMLRequest.fire({messages:n,model:c.model,source:{extensionId:B,agent:V},tokenCount:m})}let E=Date.now()-_.issuedTime;x?.markTimeToFirstToken(E);let R;switch(S.type){case"success":{let B=await this.processSuccessfulResponse(S,y.ourRequestId,h,m,E,_,c);return x?.resolve(B),B}case"canceled":return this._telemetryService.sendMSFTTelemetryEvent("response.cancelled",{source:d?.messageSource??"unknown",requestId:y.ourRequestId,model:c.model},{totalTokenMax:c.modelMaxPromptTokens??-1,promptTokenCount:m,tokenCountMax:h,timeToFirstToken:E,timeToCancelled:_?Date.now()-_.issuedTime:-1}),x?.resolveWithCancelation(),this.processCanceledResponse(S,y.ourRequestId);case"failed":return R=this.processFailedResponse(S,y.ourRequestId),this._sendResponseErrorTelemetry(R,d,y,c,m,h,E),x?.resolve(R),R}}catch(S){let I=Date.now()-_.issuedTime,E=this.processError(S,y.ourRequestId);return this._sendResponseErrorTelemetry(E,d,y,c,m,h,I),x?.resolve(E),E}}_sendResponseErrorTelemetry(r,n,o,s,a,c,u){this._telemetryService.sendMSFTTelemetryEvent("response.error",{type:r.type,reason:r.reason,source:n?.messageSource??"unknown",requestId:o.ourRequestId,model:s.model},{totalTokenMax:s.modelMaxPromptTokens??-1,promptTokenCount:a,tokenCountMax:c,timeToFirstToken:u})}static preparePostOptions(r){return{...r,stream:!0}}async processSuccessfulResponse(r,n,o,s,a,c,u){let l=[];for await(let m of r.chatCompletions)this._telemetryService.sendMSFTTelemetryEvent("response.success",{reason:m.finishReason,filterReason:m.filterReason,source:c?.properties.messageSource??"unknown",model:u?.model,requestId:n},{totalTokenMax:u?.modelMaxPromptTokens??-1,tokenCountMax:o,promptTokenCount:s,tokenCount:m.numTokens,timeToFirstToken:a,timeToComplete:c?Date.now()-c.issuedTime:-1}),this.isRepetitive(m,c?.properties)||l.push(m);let d=new Set(["stop","client-trimmed","function_call"]),p=l.filter(m=>d.has(m.finishReason));if(p.length>=1)return{type:"success",value:p.map(m=>m.message.content),requestId:n,serverRequestId:p[0].requestId.headerRequestId};let f=l.at(0);switch(f?.finishReason){case"content_filter":return{type:"filtered",category:f.filterReason??"snippy",reason:"Response got filtered.",requestId:n,serverRequestId:f.requestId.headerRequestId};case"length":return{type:"length",reason:"Response too long.",requestId:n,serverRequestId:f.requestId.headerRequestId,truncatedValue:f.message.content}}return{type:"unknown",reason:"Response contained no choices.",requestId:n,serverRequestId:f?.requestId.headerRequestId}}async getOffTopicModelName(){let r=this._configurationService.getConfig(de.DebugOverrideChatOffTopicModel);return r||""}async getOffTopicModelTokenizer(){let r=this._configurationService.getConfig(de.DebugOverrideChatOffTopicModelTokenizer);return r||""}async getOffTopicModelThreshold(){let r=this._configurationService.getConfig(de.DebugOverrideChatOffTopicModelThreshold);return r!==0?r:0}isRepetitive(r,n){let o=SOe(r.tokens);if(o){let s=Jn.createAndMarkAsIssued();s.extendWithRequestId(r.requestId);let a=s.extendedBy(n);this._telemetryService.sendRestrictedGHTelemetryEvent("conversation.repetition.detected",a.properties,a.measurements)}return o}processCanceledResponse(r,n){return{type:"canceled",reason:r.reason,requestId:n,serverRequestId:void 0}}processFailedResponse(r,n){let o=r.modelRequestId?.headerRequestId,s=r.reason;if(r.failKind==="rateLimited")return{type:"rateLimited",reason:s,requestId:n,serverRequestId:o};if(r.failKind==="offTopic")return{type:"offTopic",reason:s,requestId:n,serverRequestId:o};if(r.failKind==="tokenExpiredOrInvalid"||r.failKind==="clientNotSupported"||s.includes("Bad request: "))return{type:"badRequest",reason:s,requestId:n,serverRequestId:o};if(r.failKind==="serverError")return{type:"failed",reason:s,requestId:n,serverRequestId:o};if(r.failKind==="contentFilter")return{type:"filtered",reason:s,category:"prompt",requestId:n,serverRequestId:o};if(r.failKind==="unauthorized")return{type:"agent_unauthorized",reason:s,authorizationUrl:r.data.authorize_url,requestId:n,serverRequestId:o};if(r.failKind==="failedDependency")return{type:"agent_failed_dependency",reason:s,requestId:n,serverRequestId:o};if(r.failKind==="extensionBlocked"){let a=typeof r.data?.retryAfter=="number"?r.data.retryAfter:300;return{type:"extensionBlocked",reason:s,requestId:n,retryAfter:a,learnMoreLink:r.data?.learnMoreLink??"",serverRequestId:o}}return{type:"failed",reason:s,requestId:n,serverRequestId:o}}processError(r,n){let o=this._fetcherService;return o.isAbortError(r)?{type:"canceled",reason:"network request aborted",requestId:n,serverRequestId:void 0}:Af(r)?{type:"canceled",reason:"Got a cancellation error",requestId:n,serverRequestId:void 0}:(this._logService.public.error(r,"Error on conversation request"),this._telemetryService.sendGHTelemetryException(r,"Error on conversation request"),o.isDNSLookupFailedError(r)?{type:"failed",reason:"It appears you're not connected to the internet, please check your network connection and try again.",requestId:n,serverRequestId:void 0}:o.isFetcherError(r)?{type:"failed",reason:o.getUserMessageForFetcherError(r),requestId:n,serverRequestId:void 0}:{type:"failed",reason:"Error on conversation request. Check the log for more details.",requestId:n,serverRequestId:void 0})}};Ab=w([b(0,be),b(1,nn),b(2,he),b(3,yr),b(4,qC),b(5,oe),b(6,St),b(7,Xr),b(8,Nt)],Ab);function amt(t){if(t.messages.length===0)return{isValid:!1,reason:"No messages provided"};if(t?.postOptions?.max_tokens&&t?.postOptions?.max_tokens<1)return{isValid:!1,reason:"Invalid response token parameter"};let e=/^[a-zA-Z0-9_-]+$/;return t.messages.some(r=>r.role==="function"&&r.name&&!r.name.match(e))||t.postOptions?.functions?.some(r=>!r.name.match(e))||t.postOptions?.function_call?.name&&!t.postOptions.function_call.name.match(e)?{isValid:!1,reason:"Function names must match ^[a-zA-Z0-9_-]+$"}:{isValid:!0,reason:""}}var Lq=class{constructor(e,r){this._modelInfo=e;this._domainService=r;this.name=this._modelInfo.name;this.version=this._modelInfo.version;this.model=this._modelInfo.id;this.family=this._modelInfo.capabilities.family;this.maxBatchSize=this._modelInfo.capabilities.limits?.max_inputs??256,this.modelMaxPromptTokens=8192}get url(){return this._domainService.capiEmbeddingsURL}};var Ah=class{constructor(e,r,n,o,s,a,c){this._fetcher=e;this._domainService=r;this._expService=n;this._envService=o;this._authService=s;this._telemetryService=a;this._logService=c;this._familyMap=new Map;this._lastFetchTime=0;this._taskSingler=new Sv}static{this.ALL_MODEL_KEY="allModels"}async getAllChatModels(){await this._taskSingler.getOrCreate(Ah.ALL_MODEL_KEY,this._fetchModels.bind(this));let e=[];for(let[,r]of this._familyMap)for(let n of r)hH(n)&&e.push(n);return e}async getChatModel(e){await this._taskSingler.getOrCreate(Ah.ALL_MODEL_KEY,this._fetchModels.bind(this));let r;if(e==="gpt-4"?r=this._familyMap.get("gpt-4o")?.[0]:e==="gpt-4o-mini"?r=this._familyMap.get("gpt-4o-mini")?.[0]??this._familyMap.get("gpt-4o")?.[0]:e==="gpt-3.5-turbo"?r=this._familyMap.get("gpt-3.5-turbo")?.[0]:r=this._familyMap.get(e)?.[0],r=r?await this._findExpOverride(r):void 0,!r||!hH(r))throw this._lastFetchError||new Error(`Unable to resolve chat model with family selection: ${e}`);return r}async getEmbeddingsModel(e){await this._taskSingler.getOrCreate(Ah.ALL_MODEL_KEY,this._fetchModels.bind(this));let r=this._familyMap.get(e)?.[0];if(r=r?await this._findExpOverride(r):void 0,!r||!Wae(r))throw this._lastFetchError||new Error(`Unable to resolve embeddings model with family selection: ${e}`);return r}_shouldRefreshModels(){if(this._familyMap.size===0)return!0;let e=10*60*1e3,r=Date.now();return this._lastFetchTime?r-this._lastFetchTime>e:!0}async _fetchModels(e){if(!e&&!this._shouldRefreshModels())return;let r=Date.now(),n=(await this._authService.getCopilotToken()).token,o=_r();try{let s=await IG(this._fetcher,this._envService,this._telemetryService,this._domainService,this._domainService.capiModelsURL,n,await Pl(process.env.HMAC_SECRET),"model-access",o);if(this._lastFetchTime=Date.now(),this._logService.public.info(`Fetched model metadata in ${Date.now()-r}ms ${o}`),s.status<200||s.status>=300){if(s.status===429&&this._familyMap.size>0){this._logService.public.warn(`Rate limited while fetching models ${o}`);return}throw new Error(`Failed to fetch models (${o}): ${await s.text()||s.statusText||`HTTP ${s.status}`}`)}this._familyMap.clear();let a=(await s.json()).data;for(let c of a){let u=c.capabilities.family;this._familyMap.has(u)||this._familyMap.set(u,[]),this._familyMap.get(u)?.push(c)}this._lastFetchError=void 0}catch(s){this._logService.public.error(s,`Failed to fetch models (${o})`),this._lastFetchError=s,this._lastFetchTime=0}}async _fetchModel(e){let r=(await this._authService.getCopilotToken()).token;try{let o=await(await IG(this._fetcher,this._envService,this._telemetryService,this._domainService,`${this._domainService.capiModelsURL}/${e}`,r,await Pl(process.env.HMAC_SECRET),"model-access",_r())).json();return this._familyMap.has(o.capabilities.family)?this._familyMap.get(o.capabilities.family)?.push(o):this._familyMap.set(o.capabilities.family,[o]),o}catch{return}}async _findExpOverride(e){let r={},n=this._expService.getTreatmentVariable("vscode","copilotchat.modelOverrides");try{r=JSON.parse(n||"{}")}catch{}if(r[e.id]){for(let[,s]of this._familyMap){let a=s.find(c=>c.id===r[e.id]);if(a)return a}e=await this._taskSingler.getOrCreate(r[e.id],()=>this._fetchModel(r[e.id]))??e}return e}};Ah=w([b(0,nn),b(1,Xr),b(2,wt),b(3,St),b(4,Nt),b(5,he),b(6,oe)],Ah);var pR=class{constructor(e){this.accessor=e;this._chatEndpoints=new Map;this._embeddingEndpoints=new Map;this.accessor.get(Nt).onDidAuthenticationChange(()=>{let r=this.accessor.get(be).getConfig(de.DebugOverrideChatEngine),n=this.accessor.get(be).getConfig(de.DebugOverrideEmbeddingsModel),o=this.accessor.get(Nt).copilotToken?.isInternal??!1;o&&r&&(this._overridenChatModel=r),o&&n&&(this._overridenEmbeddingsModel=n)}),this._modelFetcher=new Ah(e.get(nn),e.get(Xr),e.get(wt),e.get(St),e.get(Nt),e.get(he),e.get(oe))}async shouldDisableSnippy(){let e=await this.accessor.get(Nt).getCopilotToken(),r=this.accessor.get(jt).extensionMode===au.Development;return e.isInternal&&r}async getOrCreateChatEndpointInstance(e){let r=e.id,n=this._chatEndpoints.get(r);if(!n){let o=await $fe(this.accessor,e),s=await this.shouldDisableSnippy();n=new oC(this.accessor.get(Xr),e,o,s),this._chatEndpoints.set(r,n)}return n}async getOrCreateEmbeddingEndpointInstance(e){let r=e.id,n=this._embeddingEndpoints.get(r);return n||(n=new Lq(e,this.accessor.get(Xr)),this._embeddingEndpoints.set(r,n)),n}async getEndpointForLocation(e){let r=await this.getEndpointFamilyForLocation(e);return this.getChatEndpoint(r)}async getEndpointFamilyForLocation(e){if(e===2)return"gpt-4";let r=this.accessor.get(be),n=this.accessor.get(wt);return r.getExperimentBasedConfig(de.InlineChatEndpoint,n)??"gpt-3.5-turbo"}async getChatEndpoint(e){if(this.accessor.get(oe).public.trace("Resolving chat model"),this._overridenChatModel)return this.accessor.get(oe).public.trace("Using overriden chat model"),this.getOrCreateChatEndpointInstance({id:this._overridenChatModel,name:"Custom Overriden Chat Model",version:"1.0.0",capabilities:{family:"custom",type:"chat"}});let r=await this._modelFetcher.getChatModel(e),n=await this.getOrCreateChatEndpointInstance(r);return this.accessor.get(oe).public.trace("Resolved chat model"),n}async getEmbeddingsEndpoint(e){if(this.accessor.get(oe).public.trace("Resolving embedding model"),this._overridenEmbeddingsModel)return this.accessor.get(oe).public.trace("Using overriden embeddings model"),this.getOrCreateEmbeddingEndpointInstance({id:this._overridenEmbeddingsModel,name:"Custom Overriden Embeddings Model",version:"1.0.0",capabilities:{family:"custom",type:"embeddings"}});let r=await this._modelFetcher.getEmbeddingsModel(e==="ada"?"text-embedding-ada-002":"text-embedding-3-small"),n=await this.getOrCreateEmbeddingEndpointInstance(r);return this.accessor.get(oe).public.trace("Resolved embedding model"),n}async getAllChatEndpoints(){let e=await this._modelFetcher.getAllChatModels(),r=[];for(let n of e){let o=await this.getOrCreateChatEndpointInstance(n);r.push(o)}return r}};pR=w([b(0,st)],pR);var TOe=H(require("path")),EOe=H(require("vscode"));var Mq=H(nt());var Oq=class extends X{render(){return vscpp(vscppf,null,vscpp(Mq.SystemMessage,null,vscpp(roe,null),vscpp(Gs,null)),vscpp(Mq.UserMessage,null,vscpp(noe,{templates:this.props.templates,features:this.props.features,filenames:this.props.filenames})))}},roe=class extends X{render(){return vscpp(vscppf,null,"You are an AI programming assistant.",vscpp("br",null),"You are helping a software developer to configure a Dev Container by picking a configuration template and features.")}},noe=class extends X{render(){return vscpp(vscppf,null,"This is a partial list of workspace files:",vscpp("br",null),this.props.filenames.map(e=>`- ${e}
`).join(""),vscpp("br",null),"Based on the workspace files, please suggest the best template from the list of templates below.",vscpp("br",null),"First identify the relevant files ignoring common files, then pick the best template and reply with the best template's id.",vscpp("br",null),"This is the list of available templates:",vscpp("br",null),this.props.templates.map(e=>`- ${e.id}: ${e.name||e.id}: ${e.description||e.name||e.id}
`).join(""),vscpp("br",null),"Also based on the workspace files, please suggest all relevant features from the list of features below.",vscpp("br",null),"First identify the relevant files ignoring common files, then pick all relevant features and reply with the relevant features' ids.",vscpp("br",null),"This is the list of available features:",vscpp("br",null),this.props.features.map(e=>`- ${e.id}: ${e.name||e.id}: ${e.description||e.name||e.id}
`).join(""),vscpp("br",null))}};var cmt=["alpine","debian","docker-existing-docker-compose","docker-existing-dockerfile","docker-in-docker","docker-outside-of-docker","docker-outside-of-docker-compose","ubuntu","universal"].map(t=>`ghcr.io/devcontainers/templates/${t}`),umt=["common-utils","git"].map(t=>`ghcr.io/devcontainers/features/${t}`),Fq=class{constructor(e){this.accessor=e;this.telemetryService=e.get(he),this.options=e.get(Rr)}async generate(e,r,n){if(!r.length)return{type:"success",template:void 0,features:[]};let o=Date.now(),s=await this.accessor.get(Se).getChatEndpoint("gpt-3.5-turbo"),a=Math.floor(s.modelMaxPromptTokens*4/3),c=this.processFilenames(r,a),u=e.templates.filter(g=>!cmt.includes(g.id)),l=(e.features||[]).filter(g=>!umt.includes(g.id)),p=await Be.create(this.accessor.get(K),s,Oq,{filenames:c,templates:u,features:l}).render(),f=Date.now(),m=await this.accessor.get(Ct).fetchOne("devContainerConfigGenerator",p.messages,void 0,n,3,s,void 0,{temperature:this.options.temperature,top_p:this.options.topP},{messageSource:"command.generateDevContainerConfigPrompt"}),h=m.type==="success"?this.processGeneratedConfig(m.value,u,l):void 0;return this.telemetryService.sendMSFTTelemetryEvent("devcontainer.generateConfig",{model:s.model,requestId:m.requestId,responseType:m.type,templateId:h?.template,featureIds:h?.features.join(",")},{originalFilenameCount:r.length,originalFilenameLength:r.join("").length,processedFilenameCount:c.length,processedFilenameLength:c.join("").length,timeToRequest:f-o,timeToComplete:Date.now()-o}),{type:"success",template:h?.template,features:h?.features||[]}}processFilenames(e,r){let n=[...e],o=Math.floor(r*.9),s=n.join(`
`).length;if(s>o)for(;s>o&&n.length>0;){let a=n.pop();s-=a.length}return n}processGeneratedConfig(e,r,n){let o=r.find(s=>new RegExp(`\\b${Vb(s.id)}\\b`).test(e))?.id;return o==="ghcr.io/devcontainers/templates/javascript-node"&&(o="ghcr.io/devcontainers/templates/typescript-node"),{template:o,features:n.filter(s=>new RegExp(`\\b${Vb(s.id)}\\b`).test(e)).map(s=>s.id)}}};var fR=class{constructor(e){this.accessor=e}async generateConfiguration(e,r){if(r.isCancellationRequested)return{type:"cancelled"};let n=this.accessor.get(Fd),o=(await Promise.all(["*","*/*","*/*/*"].map(a=>n.findFilesWithDefaultExcludes(new EOe.RelativePattern(e.rootUri,a),1e3,r)))).flat().map(a=>TOe.posix.relative(e.rootUri.path,a.path));return new Fq(this.accessor).generate(e.index,o,r)}};fR=w([b(0,st)],fR);var HN=H(require("path")),Ba=require("vscode");var Vx=H(nt());var Uq=class extends X{render(){return vscpp(vscppf,null,vscpp(Vx.SystemMessage,{priority:1e3},vscpp(ioe,null),vscpp(Rt,null),vscpp(Xt,null)),this.props.recentCommitMessages.user.length>0&&vscpp(Vx.UserMessage,{priority:700,name:"user-commits"},"# RECENT USER COMMITS (For reference only, do not copy!):",vscpp("br",null),this.props.recentCommitMessages.user.map(e=>`- ${e}
`).join("")),this.props.recentCommitMessages.repository.length>0&&vscpp(Vx.UserMessage,{priority:600,name:"recent-commits"},"# RECENT REPOSITORY COMMITS (For reference only, do not copy!):",vscpp("br",null),this.props.recentCommitMessages.repository.map(e=>`- ${e}
`).join("")),vscpp(Vx.UserMessage,{priority:800,name:"changes"},"# CODE CHANGES:",vscpp("br",null),this.props.diff.map(e=>vscpp(vscppf,null,vscpp(Fe,{uri:null,code:e}),vscpp("br",null)))),vscpp(Vx.UserMessage,{priority:900,name:"reminder"},"Now generate a commit messages that describe the CODE CHANGES.",vscpp("br",null),"DO NOT COPY commits from RECENT COMMITS, but it as reference for the commit style.",vscpp("br",null),"ONLY return a single markdown code block, NO OTHER PROSE!",vscpp("br",null),vscpp(Fe,{uri:null,languageId:"text",code:"commit message goes here"})))}},ioe=class extends X{render(){return vscpp(vscppf,null,"You are an AI programming assistant, helping a software developer to come with the best git commit message for their code changes.",vscpp("br",null),"You excel in interpreting the purpose behind code changes to craft succinct, clear commit messages that adhere to the repository's guidelines.",vscpp("br",null),vscpp("br",null),"# First, think step-by-step:",vscpp("br",null),"1. Analyze the CODE CHANGES thoroughly to understand what's been modified.",vscpp("br",null),"2. Identify the purpose of the changes to answer the *why* for the commit messages, also considering the optionally provided RECENT USER COMMITS.",vscpp("br",null),"3. Review the provided RECENT REPOSITORY COMMITS to identify established commit message conventions. Focus on the format and style, ignoring commit-specific details like refs, tags, and authors.",vscpp("br",null),"4. Generate a thoughtful and succinct commit message for the given CODE CHANGES. It MUST follow the the established writing conventions. 5. Remove any meta information like issue references, tags, or author names from the commit message. The developer will add them.",vscpp("br",null),"6. Now only show your message, wrapped with a single markdown ```text codeblock! Do not provide any explanations or details",vscpp("br",null))}};var Bq=class{constructor(e){this.accessor=e;this.telemetryService=e.get(he),this.options=e.get(Rr)}async generateGitCommitMessage(e,r,n,o){let s=Date.now(),a=await this.accessor.get(Se).getChatEndpoint("gpt-3.5-turbo"),c=Math.floor(a.modelMaxPromptTokens*4/3),u=this.processDiff(e,c),d=await Be.create(this.accessor.get(K),a,Uq,{diff:u,recentCommitMessages:r}).render(void 0,void 0),p=Math.min(this.options.temperature*(1+n),2),f=Date.now(),m=await this.accessor.get(Ct).fetchOne("gitCommitMessageGenerator",d.messages,void 0,o,3,a,{agent:"git-commit"},{temperature:p,top_p:this.options.topP},{messageSource:"command.generateGitCommitMessagePrompt"});if(this.telemetryService.sendMSFTTelemetryEvent("git.generateCommitMessage",{model:a.model,requestId:m.requestId,responseType:m.type},{attemptCount:n+1,originalDiffFileCount:e.length,originalDiffLength:e.join("").length,processedDiffFileCount:u.length,processedDiffLength:u.join("").length,timeToRequest:f-s,timeToComplete:Date.now()-s}),m.type!=="success")return;let[h,g]=this.processGeneratedCommitMessage(m.value);return h!=="oneTextCodeBlock"&&this.telemetryService.sendMSFTTelemetryEvent("git.generateCommitMessageIncorrectResponseFormat",{requestId:m.requestId,responseFormat:h}),g}processDiff(e,r){let n=[...e],o=r-Math.floor(r*.2),s=n.join(`

`).length;if(s>o)for(n.sort((a,c)=>a.length-c.length);s>o&&n.length>0;){let a=n.pop();s-=a.length}return n}processGeneratedCommitMessage(e){let n=/^```text\s*([\s\S]+?)\s*```$/m.exec(e);return n===null?["noTextCodeBlock",e]:n.length!==2?["multipleTextCodeBlocks",e]:["oneTextCodeBlock",n[1]]}};var mR=class{constructor(e){this.accessor=e;this._commitMessages=new Map;this._disposables=new ht;this._repositoryDisposables=new Wx;this._logService=this.accessor.get(oe);let r=()=>{this._disposables.add(this._gitExtensionApi.onDidOpenRepository(this._onDidOpenRepository,this)),this._disposables.add(this._gitExtensionApi.onDidCloseRepository(this._onDidCloseRepository,this));for(let o of this._gitExtensionApi.repositories)this._onDidOpenRepository(o)},n=this.accessor.get(_o);this._gitExtensionApi=n.getExtensionApi(),this._gitExtensionApi?r():this._disposables.add(n.onDidChange(o=>{o.enabled&&(this._gitExtensionApi=n.getExtensionApi(),r())}))}async generateCommitMessage(e,r=Lr.None){if(!r.isCancellationRequested)return Ba.window.withProgress({location:Ba.ProgressLocation.SourceControl},async()=>{let n=await this._getChanges(e);if(this._logService.public.debug(`[GitCommitMessageService] Changes (before context exclusion): ${n.length} file(s)`),n.length===0){Ba.window.showInformationMessage(Ba.l10n.t("Cannot generate a commit message because there are no changes."));return}let o=await this._applyContentExclusion(n);if(this._logService.public.debug(`[GitCommitMessageService] Changes (after context exclusion): ${o.length} file(s)`),o.length===0){Ba.window.showInformationMessage(Ba.l10n.t("Cannot generate a commit message because the changes were excluded from the context due to content exclusion rules."));return}let s=this._getAttemptCount(e,o),a=await this._getRecentCommitMessages(e),u=await new Bq(this.accessor).generateGitCommitMessage(o,a,s,r);if(u&&e.state.HEAD&&e.state.HEAD.commit){let l=this._commitMessages.get(e.rootUri.toString())??new Map;l.set(e.state.HEAD.commit,{attemptCount:s,changes:o,message:u}),this._commitMessages.set(e.rootUri.toString(),l)}return u})}getRepository(e){return this._gitExtensionApi?this._gitExtensionApi.repositories.length===1?this._gitExtensionApi.repositories[0]:(e=e??Ba.window.activeTextEditor?.document.uri,e?this._gitExtensionApi.getRepository(e):null):null}async _applyContentExclusion(e){let r=[],n=this.accessor.get(ke);for(let o of e){if(o.originalUri===void 0&&o.modifiedUri===void 0){this._logService.public.debug("[GitCommitMessageService] Ignoring change due to missing originalUri and modifiedUri.");continue}if(o.originalUri&&await n.isCopilotIgnored(o.originalUri)){this._logService.public.debug(`[GitCommitMessageService] Ignoring change due to content exclusion rule based on originalUri: ${o.originalUri.toString()}`);continue}if(o.modifiedUri&&o.modifiedUri!==o.originalUri&&await n.isCopilotIgnored(o.modifiedUri)){this._logService.public.debug(`[GitCommitMessageService] Ignoring change due to content exclusion rule based on modifiedUri: ${o.modifiedUri.toString()}`);continue}r.push(o.diff)}return r}_getAttemptCount(e,r){let o=this._commitMessages.get(e.rootUri.toString())?.get(e.state.HEAD?.commit??"");if(!o||o.changes.length!==r.length)return 0;for(let s=0;s<r.length;s++)if(o.changes[s]!==r[s])return 0;return o.attemptCount+1}async _getChanges(e){let r=await e.diff(!0);if(r!=="")return this._parseGitDiff(e,r);let n=await e.diff(),o=this._parseGitDiff(e,n);return o.push(...await this._getUntrackedChanges(e)),o}async _getRecentCommitMessages(e){let r=[],n=[];try{let o=await e.log({maxEntries:5});r.push(...o.map(c=>c.message.split(`
`)[0]));let s=await e.getConfig("user.name")??await e.getGlobalConfig("user.name"),a=await e.log({maxEntries:5,author:s});n.push(...a.map(c=>c.message.split(`
`)[0]))}catch{}return{repository:r,user:n}}async _getUntrackedChanges(e){let r=[];for(let n of e.state.workingTreeChanges.filter(o=>o.status===7))r.push({modifiedUri:n.uri,diff:await this._getUntrackedChangePatch(e,n.uri)});for(let n of e.state.untrackedChanges??[])r.push({modifiedUri:n.uri,diff:await this._getUntrackedChangePatch(e,n.uri)});return r}async _getUntrackedChangePatch(e,r){this._logService.public.info(`[GitCommitMessageService] Generating patch file for untracked file: ${r.toString()}`);let n=[];try{let o=await Ba.workspace.fs.readFile(r),s=HN.relative(e.rootUri.fsPath,r.fsPath);n.push(`diff --git a/${s} b/${s}`),n.push("--- /dev/null",`+++ b/${s}`),n.push(`@@ -0,0 +1,${o.length} @@`),n.push(...o.toString().split(`
`).map(a=>`+${a}`))}catch(o){this._logService.public.error(o,`Failed to generate patch file for untracked file: ${r.toString()}`)}return n.join(`
`)}_parseGitDiff(e,r){let n=[],o=u=>{let l=/^---\s(.*)\n\+\+\+\s(.*)$/m.exec(u);if(!l||l.length!==3)return{originalUri:void 0,modifiedUri:void 0};let d=l[1]==="/dev/null"?void 0:Ba.Uri.file(HN.join(e.rootUri.fsPath,l[1].substring(2))),p=l[2]==="/dev/null"?void 0:Ba.Uri.file(HN.join(e.rootUri.fsPath,l[2].substring(2)));return{originalUri:d,modifiedUri:p}},s=0,a,c=/^diff --git a\/(.+?) b\/(.+?)$/gm;do{if(a=c.exec(r),a===null)break;if(s<a.index){let u=r.substring(s,a.index),{originalUri:l,modifiedUri:d}=o(u);n.push({diff:u,originalUri:l,modifiedUri:d})}s=a.index}while(!0);if(s<r.length){let u=r.substring(s),{originalUri:l,modifiedUri:d}=o(u);n.push({diff:u,originalUri:l,modifiedUri:d})}return n}_onDidOpenRepository(e){typeof e.onDidCommit!==void 0&&this._repositoryDisposables.set(e,e.onDidCommit(()=>this._onDidCommit(e),this))}_onDidCloseRepository(e){this._repositoryDisposables.deleteAndDispose(e),this._commitMessages.delete(e.rootUri.toString())}async _onDidCommit(e){let r=e.state.HEAD;if(!r?.commit)return;let n=this._commitMessages.get(e.rootUri.toString());if(!n)return;let o=await e.getCommit(r.commit),s=o.parents.length>0?o.parents[0]:"",a=n.get(s);if(!a)return;let c=Kk(o.message,a.message);this.accessor.get(he).sendMSFTTelemetryEvent("git.generateCommitMessageSurvival",void 0,{attemptCount:a.attemptCount,survivalRateFourGram:c}),n.delete(s),this._commitMessages.set(e.rootUri.toString(),n)}dispose(){this._repositoryDisposables.dispose(),this._disposables.dispose()}};mR=w([b(0,st)],mR);var wOe=require("vscode");var hR=class{constructor(e,r){this._chatVariableService=e,this._fsService=r}async resolveVariablesInPrompt(e,r){let n=[];for(let o of r){let s=o.value;if(s instanceof wOe.Uri){let c=(await this._fsService.readFile(s)).toString().replace(/\r/g,"");s=Pi("",c)}let a=this._chatVariableService.getVariable(o.name);n.push({kind:a?.kind??"variable",userMessages:[lmt(o.name)+s]}),o.range&&(e=e.slice(0,o.range[0])+`[#${o.name}](#${o.name}-context)`+e.slice(o.range[1]))}return{parts:n,message:e}}};hR=w([b(0,xv),b(1,hr)],hR);function lmt(t){return`# ${t.toUpperCase()} CONTEXT
`}var Pf=require("vscode");var dmt=/(ccreq:[^\s]+\.copilotmd)/g,gR=class extends XM{constructor(r,n){super();this._logService=r;this._authenticationService=n;this._didRegisterLinkProvider=!1;this._entries=[];this._onDidChangeRequests=new Yt;this.onDidChangeRequests=this._onDidChangeRequests.event;this._register(Pf.workspace.registerTextDocumentContentProvider(C2,{provideTextDocumentContent:o=>{let s=o.path.replace(/\.copilotmd$/,""),a=this._entries.find(c=>c.id===s);return a?this._renderEntryToMarkdown(s,a.entry):"Request Not Found"}}))}getRequests(){return[...this._entries]}addEntry(r){this._addEntryIfInternal(r).catch(n=>this._logService.internal.error(n))}async _addEntryIfInternal(r){if(!(await this._authenticationService.getCopilotToken())?.isInternal)return;let o=_r().substring(0,8);this._entries.push({id:o,entry:r}),this._entries.length>100&&this._entries.shift(),this._ensureLinkProvider(),this._logService.internal.info(`${C2}:${o}.copilotmd | ${r.type==="ChatMLCancelation"?"cancelled":r.result.type} | ${r.chatEndpoint.model} | ${r.endTime.getTime()-r.startTime.getTime()}ms | [${r.debugName}]`),this._onDidChangeRequests.fire()}_ensureLinkProvider(){if(this._didRegisterLinkProvider)return;this._didRegisterLinkProvider=!0;let r=new class{provideDocumentLinks(n,o){return[...n.getText().matchAll(dmt)].map(s=>{let a=s[1];return new Pf.DocumentLink(new Pf.Range(n.positionAt(s.index),n.positionAt(s.index+a.length)),Pf.Uri.parse(`${a}`))})}};this._register(Pf.languages.registerDocumentLinkProvider({scheme:"output"},r))}_renderMarkdownStyles(){return`
<style>
[id^="system"], [id^="user"], [id^="assistant"] {
		margin: 4px 0 4px 0;
}

.markdown-body > pre {
		padding: 4px 16px;
}
</style>
`}_renderEntryToMarkdown(r,n){let o=[];o.push(`# ${n.debugName} - ${r}`),o.push(""),o.push("## Metadata"),o.push("~~~"),o.push(`url              : ${n.chatEndpoint.url}`),o.push(`model            : ${n.chatParams.model}`),o.push(`maxPromptTokens  : ${n.chatEndpoint.modelMaxPromptTokens}`),o.push(`maxResponseTokens: ${n.chatParams.postOptions?.max_tokens}`),o.push(`location         : ${n.chatParams.location}`),o.push(`postOptions      : ${JSON.stringify(n.chatParams.postOptions)}`),o.push(`intent           : ${n.chatParams.intent}`),o.push(`startTime        : ${n.startTime.toJSON()}`),o.push(`endTime          : ${n.endTime.toJSON()}`),o.push(`duration         : ${n.endTime.getTime()-n.startTime.getTime()}ms`),o.push(`ourRequestId     : ${n.chatParams.ourRequestId}`),n.type==="ChatMLSuccess"?(o.push(`requestId        : ${n.result.requestId}`),o.push(`serverRequestId  : ${n.result.serverRequestId}`),o.push(`timeToFirstToken : ${n.timeToFirstToken}ms`)):n.type==="ChatMLFailure"&&(o.push(`requestId        : ${n.result.requestId}`),o.push(`serverRequestId  : ${n.result.serverRequestId}`)),o.push("~~~"),o.push("## Request Messages");for(let s of n.chatParams.messages)o.push(this._renderMessageToMarkdown(s.role,s.content));if(o.push(""),n.type==="ChatMLSuccess"){o.push(""),o.push("## Response");let s=n.result.value,a="";Array.isArray(s)&&(s.length===1?a=s[0]:a=`${s.map(c=>`<<${c}>>`).join(", ")}`),o.push(this._renderMessageToMarkdown("assistant",a))}else n.type==="ChatMLFailure"?(o.push(""),o.push(`## FAILED: ${n.result.reason}`)):n.type==="ChatMLCancelation"&&(o.push(""),o.push("## CANCELED"));return o.push(this._renderMarkdownStyles()),o.join(`
`)}_renderMessageToMarkdown(r,n){return`### ${r.charAt(0).toUpperCase()+r.slice(1)}
\`\`\`\`md
${n}
\`\`\`\`
`}};gR=w([b(0,oe),b(1,Nt)],gR);var ooe=H(require("vscode")),qq=class{constructor(){this.tools=ooe.lm.tools}invokeTool(e,r,n){return ooe.lm.invokeTool(e,r,n)}getTool(e){return this.tools.find(r=>r.id===e)}};function kOe(t,e){let r=e.extensionMode===vR.ExtensionMode.Test;t.define(be,new gF),t.define(tv,new y3),t.define(Ga,new xL),t.define(RI,new vF),t.define(bF,new yF),t.define(R1,new TF),t.define(St,new EF),t.define(hr,new RF),t.define(fde,new WO),t.define(KM,new AF),t.define(O1,new Me(pT)),t.define(VF,new HF),t.define(zt,new KF),t.define(Zn,new Eq),t.define(Iu,new wq),t.define(yr,new ZL),t.define(P0e,r?new LF:new OF),t.define(jt,e),t.define(dM,new DF),t.define(jf,new Rq),t.define(Rr,{_serviceBrand:void 0,maxResponseTokens:void 0,temperature:.1,topP:1,additionalPromptContext:t.get(be).getConfig(de.ConversationAdditionalPromptContext),rejectionMessage:vR.l10n.t("Sorry, but I can only assist with programming related questions.")}),t.define(_O,new qq),t.define(oe,new Me(sS,[[new d3(e)]])),t.define(qC,new Me(gR)),t.define($M,new Me(MC,[process.platform])),t.define(YM,qve(t)),t.define(nn,new Me(dT)),t.define(Xr,new Me(sT)),t.define(a4,new Me(hS));let n=e.extension.packageJSON.internalAIKey??"",o=e.extension.packageJSON.ariaKey??"";r?(ROe(t,e,n,o),t.define(Qb,b0e(t.get(K)))):(ROe(t,e,n,o),t.define(Qb,new Me(rC))),t.define(Nt,new Me(nT)),t.define(x1,new Me(r3)),t.define(Se,new Me(pR)),t.define(_t,new Me(qF,[!0])),t.define(Qa,new Me(JS)),t.define(ke,new Me(Zb)),t.define(Go,new Me(oT)),t.define(py,new Me(a1)),t.define(Oc,new Me(p1)),t.define(vu,new Me(ZS)),t.define(xv,new Me(tC)),t.define(jO,new Me(zF)),t.define(d1,new Me($F)),t.define(Ug,new Me(Zf)),t.define(Fd,new Me(Jy)),t.define(w5,new Me($I)),t.define(Kh,new Me(hT)),t.define(_o,new Me(aT)),t.define(g4,new Me(mR)),t.define(xo,new Me(ju)),t.define(uu,new Me(uT)),t.define(d4,new Me(cT)),t.define(f4,new Me(fR)),t.define(So,new Me(mT)),t.define(To,new Me(kF)),t.define(Co,new Me(PF)),t.define(dI,new Me(hF)),t.define(SS,new Me(dR)),t.define(X1,new Me(Q1)),t.define(Qf,new Me(OO)),t.define(Ct,new Me(Ab)),t.define(Z1,new Me(XC)),t.define(Ve,new Me(aR)),t.define(up,new Me(wF)),t.define(Rl,new Me(CS)),t.define(UP,new Me(eC)),t.define(jg,new Me(nm,[void 0])),t.define(F3,new Me(gI)),t.define(ku,new Me(TI)),t.define(l5,new Me(NI)),t.define(H5,new Me(hR)),t.define(u4,new Me(vS)),t.define(Y3,new Me(II)),t.define(B5,new Me(U5)),t.define(aC,new Me(sC)),t.define(r1,new Me(t1)),t.define(JM,new Me(VC)),t.define(HC,new Me(Nq)),t.define(oF,new Me(KC)),t.define(iF,new Me(WC)),t.define(oS,new Me(lT)),t.define(P1,new Me(gT))}function pmt(t,e){if(vR.ExtensionMode.Production===e.extensionMode){let r=t.get(he),n=I2e(e,r,t.get(St).isPreRelease());t.define(wt,n)}else t.define(wt,new EL)}function ROe(t,e,r,n){vR.ExtensionMode.Production===e.extensionMode?t.define(he,new Me(sR,[e.extension.packageJSON.name,r,n,i2e,o2e])):t.define(he,new YF),pmt(t,e)}async function fmt(t,e){if(t.extensionMode===bR.ExtensionMode.Test&&!e)return t;bR.l10n.bundle&&POe.config({contents:bR.l10n.bundle});let r=DOe(t);return r.get(St).isProduction()||mmt(),await r.get(wt).initializePromise,await r.get(wt).initialFetch,await hmt(r,t),bR.ExtensionMode.Test===t.extensionMode?r:{getAPI(n){if(n>UR.version)throw new Error("Invalid Copilot Chat extension API version. Please upgrade Copilot Chat.");return new UR(r)}}}function mmt(){try{require("source-map-support").install(),require("dotenv").config({path:[AOe.resolve(__dirname,"../.env")]})}catch(t){console.error(t)}}function DOe(t){let e=new vL;return t.subscriptions.push(e),kOe(e,t),e.get(ke).init(),e.get(l5),e.get(oS),e.seal(),e}async function hmt(t,e){let r=t.get(oe),n=t.get(K),o=[];for(let s of v0e){let a;try{if(a=n.invokeFunction(s.create),Kx(a)&&e.subscriptions.push(a),a?.activationBlocker){let c=yo.create(),u=a.id||"UNKNOWN";o.push(a.activationBlocker.finally(()=>{r.public.info(`activationBlocker from '${u}' took for ${Math.round(c.elapsed())}ms`)}))}}catch(c){r.public.error(c,`Error while loading contribution: ${c}`)}}await Promise.allSettled(o)}0&&(module.exports={activate,createExtensionContext});
//!!! DO NOT modify, this file was COPIED from 'microsoft/vscode'
/*! Bundled license information:

@vscode/prompt-tsx/dist/base/util/vs/nls.js:
  (*!!! DO NOT modify, this file was COPIED from 'microsoft/vscode' *)

@vscode/prompt-tsx/dist/base/util/vs/common/platform.js:
  (*!!! DO NOT modify, this file was COPIED from 'microsoft/vscode' *)

@vscode/prompt-tsx/dist/base/util/vs/common/process.js:
  (*!!! DO NOT modify, this file was COPIED from 'microsoft/vscode' *)

@vscode/prompt-tsx/dist/base/util/vs/common/path.js:
  (*!!! DO NOT modify, this file was COPIED from 'microsoft/vscode' *)

@vscode/prompt-tsx/dist/base/util/vs/common/uri.js:
  (*!!! DO NOT modify, this file was COPIED from 'microsoft/vscode' *)

@vscode/prompt-tsx/dist/base/util/arrays.js:
  (*!!! DO NOT modify, this file was COPIED from 'microsoft/vscode' *)

@microsoft/applicationinsights-web-snippet/dist/esm/applicationinsights-web-snippet.js:
  (*!
   * Application Insights JavaScript SDK - Web Snippet, 1.0.1
   * Copyright (c) Microsoft and contributors. All rights reserved.
   *)

mime-db/index.js:
  (*!
   * mime-db
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015-2022 Douglas Christopher Wilson
   * MIT Licensed
   *)

mime-types/index.js:
  (*!
   * mime-types
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)
*/
