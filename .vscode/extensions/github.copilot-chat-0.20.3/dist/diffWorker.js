"use strict";var Ze=Object.defineProperty;var Qe=(i,e)=>{for(var n in e)Ze(i,n,{get:e[n],enumerable:!0})};var Je=require("worker_threads");var Le={};Qe(Le,{computeDiff:()=>dn});var ge=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?te.isErrorNoTelemetry(e)?new te(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(n=>{n(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},Ce=new ge;function Te(i){en(i)||Ce.onUnexpectedError(i)}var be="Canceled";function en(i){return i instanceof ne?!0:i instanceof Error&&i.name===be&&i.message===be}var ne=class extends Error{constructor(){super(be),this.name=this.message}};var te=class i extends Error{constructor(e){super(e),this.name="CodeExpectedError"}static fromError(e){if(e instanceof i)return e;let n=new i;return n.message=e.message,n.stack=e.stack,n}static isErrorNoTelemetry(e){return e.name==="CodeExpectedError"}},S=class i extends Error{constructor(e){super(e||"An unexpected bug occurred."),Object.setPrototypeOf(this,i.prototype)}};function q(i,e){let n=P(i,e);return n===-1?void 0:i[n]}function P(i,e,n=0,t=i.length){let r=n,s=t;for(;r<s;){let o=Math.floor((r+s)/2);e(i[o])?r=o+1:s=o}return r-1}function Ne(i,e){let n=$(i,e);return n===i.length?void 0:i[n]}function $(i,e,n=0,t=i.length){let r=n,s=t;for(;r<s;){let o=Math.floor((r+s)/2);e(i[o])?s=o:r=o+1}return r}var j=class i{constructor(e){this._array=e;this._findLastMonotonousLastIdx=0}static{this.assertInvariants=!1}findLastMonotonous(e){if(i.assertInvariants){if(this._prevFindLastPredicate){for(let t of this._array)if(this._prevFindLastPredicate(t)&&!e(t))throw new Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=e}let n=P(this._array,e,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=n+1,n===-1?void 0:this._array[n]}};function Ie(i,e,n=(t,r)=>t===r){if(i===e)return!0;if(!i||!e||i.length!==e.length)return!1;for(let t=0,r=i.length;t<r;t++)if(!n(i[t],e[t]))return!1;return!0}function*ye(i,e){let n,t;for(let r of i)t!==void 0&&e(t,r)?n.push(r):(n&&(yield n),n=[r]),t=r;n&&(yield n)}function we(i,e){for(let n=0;n<=i.length;n++)e(n===0?void 0:i[n-1],n===i.length?void 0:i[n])}function Se(i,e){for(let n=0;n<i.length;n++)e(n===0?void 0:i[n-1],i[n],n+1===i.length?void 0:i[n+1])}function Ae(i,e){for(let n of e)i.push(n)}var Me;(u=>{function i(l){return l<0}u.isLessThan=i;function e(l){return l<=0}u.isLessThanOrEqual=e;function n(l){return l>0}u.isGreaterThan=n;function t(l){return l===0}u.isNeitherLessOrGreaterThan=t,u.greaterThan=1,u.lessThan=-1,u.neitherLessOrGreaterThan=0})(Me||={});function X(i,e){return(n,t)=>e(i(n),i(t))}var J=(i,e)=>i-e;function De(i){return(e,n)=>-i(e,n)}var ve=class i{constructor(e){this.iterate=e}static{this.empty=new i(e=>{})}forEach(e){this.iterate(n=>(e(n),!0))}toArray(){let e=[];return this.iterate(n=>(e.push(n),!0)),e}filter(e){return new i(n=>this.iterate(t=>e(t)?n(t):!0))}map(e){return new i(n=>this.iterate(t=>n(e(t))))}some(e){let n=!1;return this.iterate(t=>(n=e(t),!n)),n}findFirst(e){let n;return this.iterate(t=>e(t)?(n=t,!1):!0),n}findLast(e){let n;return this.iterate(t=>(e(t)&&(n=t),!0)),n}findLastMaxBy(e){let n,t=!0;return this.iterate(r=>((t||Me.isGreaterThan(e(r,n)))&&(t=!1,n=r),!0)),n}};function Y(i){if(!i()){debugger;i(),Te(new S("Assertion Failed"))}}function pe(i,e){let n=0;for(;n<i.length-1;){let t=i[n],r=i[n+1];if(!e(t,r))return!1;n++}return!0}var _=class i{constructor(e,n){this.start=e;this.endExclusive=n;if(e>n)throw new S(`Invalid range: ${this.toString()}`)}static addRange(e,n){let t=0;for(;t<n.length&&n[t].endExclusive<e.start;)t++;let r=t;for(;r<n.length&&n[r].start<=e.endExclusive;)r++;if(t===r)n.splice(t,0,e);else{let s=Math.min(e.start,n[t].start),o=Math.max(e.endExclusive,n[r-1].endExclusive);n.splice(t,r-t,new i(s,o))}}static tryCreate(e,n){if(!(e>n))return new i(e,n)}static ofLength(e){return new i(0,e)}static ofStartAndLength(e,n){return new i(e,e+n)}get isEmpty(){return this.start===this.endExclusive}delta(e){return new i(this.start+e,this.endExclusive+e)}deltaStart(e){return new i(this.start+e,this.endExclusive)}deltaEnd(e){return new i(this.start,this.endExclusive+e)}get length(){return this.endExclusive-this.start}toString(){return`[${this.start}, ${this.endExclusive})`}equals(e){return this.start===e.start&&this.endExclusive===e.endExclusive}containsRange(e){return this.start<=e.start&&e.endExclusive<=this.endExclusive}contains(e){return this.start<=e&&e<this.endExclusive}join(e){return new i(Math.min(this.start,e.start),Math.max(this.endExclusive,e.endExclusive))}intersect(e){let n=Math.max(this.start,e.start),t=Math.min(this.endExclusive,e.endExclusive);if(n<=t)return new i(n,t)}intersects(e){let n=Math.max(this.start,e.start),t=Math.min(this.endExclusive,e.endExclusive);return n<t}intersectsOrTouches(e){let n=Math.max(this.start,e.start),t=Math.min(this.endExclusive,e.endExclusive);return n<=t}isBefore(e){return this.endExclusive<=e.start}isAfter(e){return this.start>=e.endExclusive}slice(e){return e.slice(this.start,this.endExclusive)}substring(e){return e.substring(this.start,this.endExclusive)}clip(e){if(this.isEmpty)throw new S(`Invalid clipping range: ${this.toString()}`);return Math.max(this.start,Math.min(this.endExclusive-1,e))}clipCyclic(e){if(this.isEmpty)throw new S(`Invalid clipping range: ${this.toString()}`);return e<this.start?this.endExclusive-(this.start-e)%this.length:e>=this.endExclusive?this.start+(e-this.start)%this.length:e}map(e){let n=[];for(let t=this.start;t<this.endExclusive;t++)n.push(e(t));return n}forEach(e){for(let n=this.start;n<this.endExclusive;n++)e(n)}};var y=class i{constructor(e,n){this.lineNumber=e,this.column=n}with(e=this.lineNumber,n=this.column){return e===this.lineNumber&&n===this.column?this:new i(e,n)}delta(e=0,n=0){return this.with(this.lineNumber+e,this.column+n)}equals(e){return i.equals(this,e)}static equals(e,n){return!e&&!n?!0:!!e&&!!n&&e.lineNumber===n.lineNumber&&e.column===n.column}isBefore(e){return i.isBefore(this,e)}static isBefore(e,n){return e.lineNumber<n.lineNumber?!0:n.lineNumber<e.lineNumber?!1:e.column<n.column}isBeforeOrEqual(e){return i.isBeforeOrEqual(this,e)}static isBeforeOrEqual(e,n){return e.lineNumber<n.lineNumber?!0:n.lineNumber<e.lineNumber?!1:e.column<=n.column}static compare(e,n){let t=e.lineNumber|0,r=n.lineNumber|0;if(t===r){let s=e.column|0,o=n.column|0;return s-o}return t-r}clone(){return new i(this.lineNumber,this.column)}toString(){return"("+this.lineNumber+","+this.column+")"}static lift(e){return new i(e.lineNumber,e.column)}static isIPosition(e){return e&&typeof e.lineNumber=="number"&&typeof e.column=="number"}toJSON(){return{lineNumber:this.lineNumber,column:this.column}}};var N=class i{constructor(e,n,t,r){e>t||e===t&&n>r?(this.startLineNumber=t,this.startColumn=r,this.endLineNumber=e,this.endColumn=n):(this.startLineNumber=e,this.startColumn=n,this.endLineNumber=t,this.endColumn=r)}isEmpty(){return i.isEmpty(this)}static isEmpty(e){return e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn}containsPosition(e){return i.containsPosition(this,e)}static containsPosition(e,n){return!(n.lineNumber<e.startLineNumber||n.lineNumber>e.endLineNumber||n.lineNumber===e.startLineNumber&&n.column<e.startColumn||n.lineNumber===e.endLineNumber&&n.column>e.endColumn)}static strictContainsPosition(e,n){return!(n.lineNumber<e.startLineNumber||n.lineNumber>e.endLineNumber||n.lineNumber===e.startLineNumber&&n.column<=e.startColumn||n.lineNumber===e.endLineNumber&&n.column>=e.endColumn)}containsRange(e){return i.containsRange(this,e)}static containsRange(e,n){return!(n.startLineNumber<e.startLineNumber||n.endLineNumber<e.startLineNumber||n.startLineNumber>e.endLineNumber||n.endLineNumber>e.endLineNumber||n.startLineNumber===e.startLineNumber&&n.startColumn<e.startColumn||n.endLineNumber===e.endLineNumber&&n.endColumn>e.endColumn)}strictContainsRange(e){return i.strictContainsRange(this,e)}static strictContainsRange(e,n){return!(n.startLineNumber<e.startLineNumber||n.endLineNumber<e.startLineNumber||n.startLineNumber>e.endLineNumber||n.endLineNumber>e.endLineNumber||n.startLineNumber===e.startLineNumber&&n.startColumn<=e.startColumn||n.endLineNumber===e.endLineNumber&&n.endColumn>=e.endColumn)}plusRange(e){return i.plusRange(this,e)}static plusRange(e,n){let t,r,s,o;return n.startLineNumber<e.startLineNumber?(t=n.startLineNumber,r=n.startColumn):n.startLineNumber===e.startLineNumber?(t=n.startLineNumber,r=Math.min(n.startColumn,e.startColumn)):(t=e.startLineNumber,r=e.startColumn),n.endLineNumber>e.endLineNumber?(s=n.endLineNumber,o=n.endColumn):n.endLineNumber===e.endLineNumber?(s=n.endLineNumber,o=Math.max(n.endColumn,e.endColumn)):(s=e.endLineNumber,o=e.endColumn),new i(t,r,s,o)}intersectRanges(e){return i.intersectRanges(this,e)}static intersectRanges(e,n){let t=e.startLineNumber,r=e.startColumn,s=e.endLineNumber,o=e.endColumn,u=n.startLineNumber,l=n.startColumn,a=n.endLineNumber,m=n.endColumn;return t<u?(t=u,r=l):t===u&&(r=Math.max(r,l)),s>a?(s=a,o=m):s===a&&(o=Math.min(o,m)),t>s||t===s&&r>o?null:new i(t,r,s,o)}equalsRange(e){return i.equalsRange(this,e)}static equalsRange(e,n){return!e&&!n?!0:!!e&&!!n&&e.startLineNumber===n.startLineNumber&&e.startColumn===n.startColumn&&e.endLineNumber===n.endLineNumber&&e.endColumn===n.endColumn}getEndPosition(){return i.getEndPosition(this)}static getEndPosition(e){return new y(e.endLineNumber,e.endColumn)}getStartPosition(){return i.getStartPosition(this)}static getStartPosition(e){return new y(e.startLineNumber,e.startColumn)}toString(){return"["+this.startLineNumber+","+this.startColumn+" -> "+this.endLineNumber+","+this.endColumn+"]"}setEndPosition(e,n){return new i(this.startLineNumber,this.startColumn,e,n)}setStartPosition(e,n){return new i(e,n,this.endLineNumber,this.endColumn)}collapseToStart(){return i.collapseToStart(this)}static collapseToStart(e){return new i(e.startLineNumber,e.startColumn,e.startLineNumber,e.startColumn)}collapseToEnd(){return i.collapseToEnd(this)}static collapseToEnd(e){return new i(e.endLineNumber,e.endColumn,e.endLineNumber,e.endColumn)}delta(e){return new i(this.startLineNumber+e,this.startColumn,this.endLineNumber+e,this.endColumn)}static fromPositions(e,n=e){return new i(e.lineNumber,e.column,n.lineNumber,n.column)}static lift(e){return e?new i(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn):null}static isIRange(e){return e&&typeof e.startLineNumber=="number"&&typeof e.startColumn=="number"&&typeof e.endLineNumber=="number"&&typeof e.endColumn=="number"}static areIntersectingOrTouching(e,n){return!(e.endLineNumber<n.startLineNumber||e.endLineNumber===n.startLineNumber&&e.endColumn<n.startColumn||n.endLineNumber<e.startLineNumber||n.endLineNumber===e.startLineNumber&&n.endColumn<e.startColumn)}static areIntersecting(e,n){return!(e.endLineNumber<n.startLineNumber||e.endLineNumber===n.startLineNumber&&e.endColumn<=n.startColumn||n.endLineNumber<e.startLineNumber||n.endLineNumber===e.startLineNumber&&n.endColumn<=e.startColumn)}static compareRangesUsingStarts(e,n){if(e&&n){let s=e.startLineNumber|0,o=n.startLineNumber|0;if(s===o){let u=e.startColumn|0,l=n.startColumn|0;if(u===l){let a=e.endLineNumber|0,m=n.endLineNumber|0;if(a===m){let g=e.endColumn|0,c=n.endColumn|0;return g-c}return a-m}return u-l}return s-o}return(e?1:0)-(n?1:0)}static compareRangesUsingEnds(e,n){return e.endLineNumber===n.endLineNumber?e.endColumn===n.endColumn?e.startLineNumber===n.startLineNumber?e.startColumn-n.startColumn:e.startLineNumber-n.startLineNumber:e.endColumn-n.endColumn:e.endLineNumber-n.endLineNumber}static spansMultipleLines(e){return e.endLineNumber>e.startLineNumber}toJSON(){return this}};var E=class i{static fromRange(e){return new i(e.startLineNumber,e.endLineNumber)}static fromRangeInclusive(e){return new i(e.startLineNumber,e.endLineNumber+1)}static subtract(e,n){return n?e.startLineNumber<n.startLineNumber&&n.endLineNumberExclusive<e.endLineNumberExclusive?[new i(e.startLineNumber,n.startLineNumber),new i(n.endLineNumberExclusive,e.endLineNumberExclusive)]:n.startLineNumber<=e.startLineNumber&&e.endLineNumberExclusive<=n.endLineNumberExclusive?[]:n.endLineNumberExclusive<e.endLineNumberExclusive?[new i(Math.max(n.endLineNumberExclusive,e.startLineNumber),e.endLineNumberExclusive)]:[new i(e.startLineNumber,Math.min(n.startLineNumber,e.endLineNumberExclusive))]:[e]}static joinMany(e){if(e.length===0)return[];let n=new K(e[0].slice());for(let t=1;t<e.length;t++)n=n.getUnion(new K(e[t].slice()));return n.ranges}static join(e){if(e.length===0)throw new S("lineRanges cannot be empty");let n=e[0].startLineNumber,t=e[0].endLineNumberExclusive;for(let r=1;r<e.length;r++)n=Math.min(n,e[r].startLineNumber),t=Math.max(t,e[r].endLineNumberExclusive);return new i(n,t)}static ofLength(e,n){return new i(e,e+n)}static deserialize(e){return new i(e[0],e[1])}constructor(e,n){if(e>n)throw new S(`startLineNumber ${e} cannot be after endLineNumberExclusive ${n}`);this.startLineNumber=e,this.endLineNumberExclusive=n}contains(e){return this.startLineNumber<=e&&e<this.endLineNumberExclusive}get isEmpty(){return this.startLineNumber===this.endLineNumberExclusive}delta(e){return new i(this.startLineNumber+e,this.endLineNumberExclusive+e)}deltaLength(e){return new i(this.startLineNumber,this.endLineNumberExclusive+e)}get length(){return this.endLineNumberExclusive-this.startLineNumber}join(e){return new i(Math.min(this.startLineNumber,e.startLineNumber),Math.max(this.endLineNumberExclusive,e.endLineNumberExclusive))}toString(){return`[${this.startLineNumber},${this.endLineNumberExclusive})`}intersect(e){let n=Math.max(this.startLineNumber,e.startLineNumber),t=Math.min(this.endLineNumberExclusive,e.endLineNumberExclusive);if(n<=t)return new i(n,t)}intersectsStrict(e){return this.startLineNumber<e.endLineNumberExclusive&&e.startLineNumber<this.endLineNumberExclusive}overlapOrTouch(e){return this.startLineNumber<=e.endLineNumberExclusive&&e.startLineNumber<=this.endLineNumberExclusive}equals(e){return this.startLineNumber===e.startLineNumber&&this.endLineNumberExclusive===e.endLineNumberExclusive}toInclusiveRange(){return this.isEmpty?null:new N(this.startLineNumber,1,this.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER)}toExclusiveRange(){return new N(this.startLineNumber,1,this.endLineNumberExclusive,1)}mapToLineArray(e){let n=[];for(let t=this.startLineNumber;t<this.endLineNumberExclusive;t++)n.push(e(t));return n}forEach(e){for(let n=this.startLineNumber;n<this.endLineNumberExclusive;n++)e(n)}serialize(){return[this.startLineNumber,this.endLineNumberExclusive]}includes(e){return this.startLineNumber<=e&&e<this.endLineNumberExclusive}toOffsetRange(){return new _(this.startLineNumber-1,this.endLineNumberExclusive-1)}},K=class i{constructor(e=[]){this._normalizedRanges=e}get ranges(){return this._normalizedRanges}addRange(e){if(e.length===0)return;let n=$(this._normalizedRanges,r=>r.endLineNumberExclusive>=e.startLineNumber),t=P(this._normalizedRanges,r=>r.startLineNumber<=e.endLineNumberExclusive)+1;if(n===t)this._normalizedRanges.splice(n,0,e);else if(n===t-1){let r=this._normalizedRanges[n];this._normalizedRanges[n]=r.join(e)}else{let r=this._normalizedRanges[n].join(this._normalizedRanges[t-1]).join(e);this._normalizedRanges.splice(n,t-n,r)}}contains(e){let n=q(this._normalizedRanges,t=>t.startLineNumber<=e);return!!n&&n.endLineNumberExclusive>e}intersects(e){let n=q(this._normalizedRanges,t=>t.startLineNumber<e.endLineNumberExclusive);return!!n&&n.endLineNumberExclusive>e.startLineNumber}getUnion(e){if(this._normalizedRanges.length===0)return e;if(e._normalizedRanges.length===0)return this;let n=[],t=0,r=0,s=null;for(;t<this._normalizedRanges.length||r<e._normalizedRanges.length;){let o=null;if(t<this._normalizedRanges.length&&r<e._normalizedRanges.length){let u=this._normalizedRanges[t],l=e._normalizedRanges[r];u.startLineNumber<l.startLineNumber?(o=u,t++):(o=l,r++)}else t<this._normalizedRanges.length?(o=this._normalizedRanges[t],t++):(o=e._normalizedRanges[r],r++);s===null?s=o:s.endLineNumberExclusive>=o.startLineNumber?s=new E(s.startLineNumber,Math.max(s.endLineNumberExclusive,o.endLineNumberExclusive)):(n.push(s),s=o)}return s!==null&&n.push(s),new i(n)}subtractFrom(e){let n=$(this._normalizedRanges,o=>o.endLineNumberExclusive>=e.startLineNumber),t=P(this._normalizedRanges,o=>o.startLineNumber<=e.endLineNumberExclusive)+1;if(n===t)return new i([e]);let r=[],s=e.startLineNumber;for(let o=n;o<t;o++){let u=this._normalizedRanges[o];u.startLineNumber>s&&r.push(new E(s,u.startLineNumber)),s=u.endLineNumberExclusive}return s<e.endLineNumberExclusive&&r.push(new E(s,e.endLineNumberExclusive)),new i(r)}toString(){return this._normalizedRanges.map(e=>e.toString()).join(", ")}getIntersection(e){let n=[],t=0,r=0;for(;t<this._normalizedRanges.length&&r<e._normalizedRanges.length;){let s=this._normalizedRanges[t],o=e._normalizedRanges[r],u=s.intersect(o);u&&!u.isEmpty&&n.push(u),s.endLineNumberExclusive<o.endLineNumberExclusive?t++:r++}return new i(n)}getWithDelta(e){return new i(this._normalizedRanges.map(n=>n.delta(e)))}};var O=class i{constructor(e,n){this.diffs=e;this.hitTimeout=n}static trivial(e,n){return new i([new I(_.ofLength(e.length),_.ofLength(n.length))],!1)}static trivialTimedOut(e,n){return new i([new I(_.ofLength(e.length),_.ofLength(n.length))],!0)}},I=class i{constructor(e,n){this.seq1Range=e;this.seq2Range=n}static invert(e,n){let t=[];return we(e,(r,s)=>{t.push(i.fromOffsetPairs(r?r.getEndExclusives():D.zero,s?s.getStarts():new D(n,(r?r.seq2Range.endExclusive-r.seq1Range.endExclusive:0)+n)))}),t}static fromOffsetPairs(e,n){return new i(new _(e.offset1,n.offset1),new _(e.offset2,n.offset2))}static assertSorted(e){let n;for(let t of e){if(n&&!(n.seq1Range.endExclusive<=t.seq1Range.start&&n.seq2Range.endExclusive<=t.seq2Range.start))throw new S("Sequence diffs must be sorted");n=t}}swap(){return new i(this.seq2Range,this.seq1Range)}toString(){return`${this.seq1Range} <-> ${this.seq2Range}`}join(e){return new i(this.seq1Range.join(e.seq1Range),this.seq2Range.join(e.seq2Range))}delta(e){return e===0?this:new i(this.seq1Range.delta(e),this.seq2Range.delta(e))}deltaStart(e){return e===0?this:new i(this.seq1Range.deltaStart(e),this.seq2Range.deltaStart(e))}deltaEnd(e){return e===0?this:new i(this.seq1Range.deltaEnd(e),this.seq2Range.deltaEnd(e))}intersectsOrTouches(e){return this.seq1Range.intersectsOrTouches(e.seq1Range)||this.seq2Range.intersectsOrTouches(e.seq2Range)}intersect(e){let n=this.seq1Range.intersect(e.seq1Range),t=this.seq2Range.intersect(e.seq2Range);if(!(!n||!t))return new i(n,t)}getStarts(){return new D(this.seq1Range.start,this.seq2Range.start)}getEndExclusives(){return new D(this.seq1Range.endExclusive,this.seq2Range.endExclusive)}},D=class i{constructor(e,n){this.offset1=e;this.offset2=n}static{this.zero=new i(0,0)}static{this.max=new i(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)}toString(){return`${this.offset1} <-> ${this.offset2}`}delta(e){return e===0?this:new i(this.offset1+e,this.offset2+e)}equals(e){return this.offset1===e.offset1&&this.offset2===e.offset2}},F=class i{static{this.instance=new i}isValid(){return!0}},ie=class{constructor(e){this.timeout=e;this.startTime=Date.now();this.valid=!0;if(e<=0)throw new S("timeout must be positive")}isValid(){if(!(Date.now()-this.startTime<this.timeout)&&this.valid){this.valid=!1;debugger}return this.valid}disable(){this.timeout=Number.MAX_SAFE_INTEGER,this.isValid=()=>!0,this.valid=!0}};var V=class{constructor(e,n){this.width=e;this.height=n;this.array=[];this.array=new Array(e*n)}get(e,n){return this.array[e+n*this.width]}set(e,n,t){this.array[e+n*this.width]=t}};function Q(i){return i===32||i===9}var Z=class i{constructor(e,n,t){this.range=e;this.lines=n;this.source=t;this.histogram=[];let r=0;for(let s=e.startLineNumber-1;s<e.endLineNumberExclusive-1;s++){let o=n[s];for(let l=0;l<o.length;l++){r++;let a=o[l],m=i.getKey(a);this.histogram[m]=(this.histogram[m]||0)+1}r++;let u=i.getKey(`
`);this.histogram[u]=(this.histogram[u]||0)+1}this.totalCount=r}static{this.chrKeys=new Map}static getKey(e){let n=this.chrKeys.get(e);return n===void 0&&(n=this.chrKeys.size,this.chrKeys.set(e,n)),n}computeSimilarity(e){let n=0,t=Math.max(this.histogram.length,e.histogram.length);for(let r=0;r<t;r++)n+=Math.abs((this.histogram[r]??0)-(e.histogram[r]??0));return 1-n/(this.totalCount+e.totalCount)}};var re=class{compute(e,n,t=F.instance,r){if(e.length===0||n.length===0)return O.trivial(e,n);let s=new V(e.length,n.length),o=new V(e.length,n.length),u=new V(e.length,n.length);for(let b=0;b<e.length;b++)for(let p=0;p<n.length;p++){if(!t.isValid())return O.trivialTimedOut(e,n);let R=b===0?0:s.get(b-1,p),v=p===0?0:s.get(b,p-1),T;e.getElement(b)===n.getElement(p)?(b===0||p===0?T=0:T=s.get(b-1,p-1),b>0&&p>0&&o.get(b-1,p-1)===3&&(T+=u.get(b-1,p-1)),T+=r?r(b,p):1):T=-1;let w=Math.max(R,v,T);if(w===T){let x=b>0&&p>0?u.get(b-1,p-1):0;u.set(b,p,x+1),o.set(b,p,3)}else w===R?(u.set(b,p,0),o.set(b,p,1)):w===v&&(u.set(b,p,0),o.set(b,p,2));s.set(b,p,w)}let l=[],a=e.length,m=n.length;function g(b,p){(b+1!==a||p+1!==m)&&l.push(new I(new _(b+1,a),new _(p+1,m))),a=b,m=p}let c=e.length-1,f=n.length-1;for(;c>=0&&f>=0;)o.get(c,f)===3?(g(c,f),c--,f--):o.get(c,f)===1?c--:f--;return g(-1,-1),l.reverse(),new O(l,!1)}};var z=class{compute(e,n,t=F.instance){if(e.length===0||n.length===0)return O.trivial(e,n);let r=e,s=n;function o(p,R){for(;p<r.length&&R<s.length&&r.getElement(p)===s.getElement(R);)p++,R++;return p}let u=0,l=new de;l.set(0,o(0,0));let a=new he;a.set(0,l.get(0)===0?null:new se(null,0,0,l.get(0)));let m=0;e:for(;;){if(u++,!t.isValid())return O.trivialTimedOut(r,s);let p=-Math.min(u,s.length+u%2),R=Math.min(u,r.length+u%2);for(m=p;m<=R;m+=2){let v=0,T=m===R?-1:l.get(m+1),w=m===p?-1:l.get(m-1)+1;v++;let x=Math.min(Math.max(T,w),r.length),d=x-m;if(v++,x>r.length||d>s.length)continue;let h=o(x,d);l.set(m,h);let L=x===T?a.get(m+1):a.get(m-1);if(a.set(m,h!==x?new se(L,x,d,h-x):L),l.get(m)===r.length&&l.get(m)-m===s.length)break e}}let g=a.get(m),c=[],f=r.length,b=s.length;for(;;){let p=g?g.x+g.length:0,R=g?g.y+g.length:0;if((p!==f||R!==b)&&c.push(new I(new _(p,f),new _(R,b))),!g)break;f=g.x,b=g.y,g=g.prev}return c.reverse(),new O(c,!1)}},se=class{constructor(e,n,t,r){this.prev=e;this.x=n;this.y=t;this.length=r}},de=class{constructor(){this.positiveArr=new Int32Array(10);this.negativeArr=new Int32Array(10)}get(e){return e<0?(e=-e-1,this.negativeArr[e]):this.positiveArr[e]}set(e,n){if(e<0){if(e=-e-1,e>=this.negativeArr.length){let t=this.negativeArr;this.negativeArr=new Int32Array(t.length*2),this.negativeArr.set(t)}this.negativeArr[e]=n}else{if(e>=this.positiveArr.length){let t=this.positiveArr;this.positiveArr=new Int32Array(t.length*2),this.positiveArr.set(t)}this.positiveArr[e]=n}}},he=class{constructor(){this.positiveArr=[];this.negativeArr=[]}get(e){return e<0?(e=-e-1,this.negativeArr[e]):this.positiveArr[e]}set(e,n){e<0?(e=-e-1,this.negativeArr[e]=n):this.positiveArr[e]=n}};var oe=class i{constructor(e,n){this.lineCount=e;this.columnCount=n}static{this.zero=new i(0,0)}static lengthDiffNonNegative(e,n){return n.isLessThan(e)?i.zero:e.lineCount===n.lineCount?new i(0,n.columnCount-e.columnCount):new i(n.lineCount-e.lineCount,n.columnCount)}static betweenPositions(e,n){return e.lineNumber===n.lineNumber?new i(0,n.column-e.column):new i(n.lineNumber-e.lineNumber,n.column-1)}static ofRange(e){return i.betweenPositions(e.getStartPosition(),e.getEndPosition())}static ofText(e){let n=0,t=0;for(let r of e)r===`
`?(n++,t=0):t++;return new i(n,t)}isZero(){return this.lineCount===0&&this.columnCount===0}isLessThan(e){return this.lineCount!==e.lineCount?this.lineCount<e.lineCount:this.columnCount<e.columnCount}isGreaterThan(e){return this.lineCount!==e.lineCount?this.lineCount>e.lineCount:this.columnCount>e.columnCount}isGreaterThanOrEqualTo(e){return this.lineCount!==e.lineCount?this.lineCount>e.lineCount:this.columnCount>=e.columnCount}equals(e){return this.lineCount===e.lineCount&&this.columnCount===e.columnCount}compare(e){return this.lineCount!==e.lineCount?this.lineCount-e.lineCount:this.columnCount-e.columnCount}add(e){return e.lineCount===0?new i(this.lineCount,this.columnCount+e.columnCount):new i(this.lineCount+e.lineCount,e.columnCount)}createRange(e){return this.lineCount===0?new N(e.lineNumber,e.column,e.lineNumber,e.column+this.columnCount):new N(e.lineNumber,e.column,e.lineNumber+this.lineCount,this.columnCount+1)}toRange(){return new N(1,1,this.lineCount+1,this.columnCount+1)}addToPosition(e){return this.lineCount===0?new y(e.lineNumber,e.column+this.columnCount):new y(e.lineNumber+this.lineCount,this.columnCount+1)}toString(){return`${this.lineCount},${this.columnCount}`}};var ue=class{constructor(e,n){this.range=e;this.text=n}get isEmpty(){return this.range.isEmpty()&&this.text.length===0}static equals(e,n){return e.range.equalsRange(n.range)&&e.text===n.text}toSingleEditOperation(){return{range:this.range,text:this.text}}};var U=class i{static inverse(e,n,t){let r=[],s=1,o=1;for(let l of e){let a=new i(new E(s,l.original.startLineNumber),new E(o,l.modified.startLineNumber));a.modified.isEmpty||r.push(a),s=l.original.endLineNumberExclusive,o=l.modified.endLineNumberExclusive}let u=new i(new E(s,n+1),new E(o,t+1));return u.modified.isEmpty||r.push(u),r}static clip(e,n,t){let r=[];for(let s of e){let o=s.original.intersect(n),u=s.modified.intersect(t);o&&!o.isEmpty&&u&&!u.isEmpty&&r.push(new i(o,u))}return r}constructor(e,n){this.original=e,this.modified=n}toString(){return`{${this.original.toString()}->${this.modified.toString()}}`}flip(){return new i(this.modified,this.original)}join(e){return new i(this.original.join(e.original),this.modified.join(e.modified))}get changedLineCount(){return Math.max(this.original.length,this.modified.length)}toRangeMapping(){let e=this.original.toInclusiveRange(),n=this.modified.toInclusiveRange();if(e&&n)return new M(e,n);if(this.original.startLineNumber===1||this.modified.startLineNumber===1){if(!(this.modified.startLineNumber===1&&this.original.startLineNumber===1))throw new S("not a valid diff");return new M(new N(this.original.startLineNumber,1,this.original.endLineNumberExclusive,1),new N(this.modified.startLineNumber,1,this.modified.endLineNumberExclusive,1))}else return new M(new N(this.original.startLineNumber-1,Number.MAX_SAFE_INTEGER,this.original.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),new N(this.modified.startLineNumber-1,Number.MAX_SAFE_INTEGER,this.modified.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER))}toRangeMapping2(e,n){if(Ue(this.original.endLineNumberExclusive,e)&&Ue(this.modified.endLineNumberExclusive,n))return new M(new N(this.original.startLineNumber,1,this.original.endLineNumberExclusive,1),new N(this.modified.startLineNumber,1,this.modified.endLineNumberExclusive,1));if(!this.original.isEmpty&&!this.modified.isEmpty)return new M(N.fromPositions(new y(this.original.startLineNumber,1),G(new y(this.original.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),e)),N.fromPositions(new y(this.modified.startLineNumber,1),G(new y(this.modified.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),n)));if(this.original.startLineNumber>1&&this.modified.startLineNumber>1)return new M(N.fromPositions(G(new y(this.original.startLineNumber-1,Number.MAX_SAFE_INTEGER),e),G(new y(this.original.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),e)),N.fromPositions(G(new y(this.modified.startLineNumber-1,Number.MAX_SAFE_INTEGER),n),G(new y(this.modified.endLineNumberExclusive-1,Number.MAX_SAFE_INTEGER),n)));throw new S}};function G(i,e){if(i.lineNumber<1)return new y(1,1);if(i.lineNumber>e.length)return new y(e.length,e[e.length-1].length+1);let n=e[i.lineNumber-1];return i.column>n.length+1?new y(i.lineNumber,n.length+1):i}function Ue(i,e){return i>=1&&i<=e.length}var W=class i extends U{static fromRangeMappings(e){let n=E.join(e.map(r=>E.fromRangeInclusive(r.originalRange))),t=E.join(e.map(r=>E.fromRangeInclusive(r.modifiedRange)));return new i(n,t,e)}constructor(e,n,t){super(e,n),this.innerChanges=t}flip(){return new i(this.modified,this.original,this.innerChanges?.map(e=>e.flip()))}withInnerChangesFromLineRanges(){return new i(this.original,this.modified,[this.toRangeMapping()])}},M=class i{static assertSorted(e){for(let n=1;n<e.length;n++){let t=e[n-1],r=e[n];if(!(t.originalRange.getEndPosition().isBeforeOrEqual(r.originalRange.getStartPosition())&&t.modifiedRange.getEndPosition().isBeforeOrEqual(r.modifiedRange.getStartPosition())))throw new S("Range mappings must be sorted")}}constructor(e,n){this.originalRange=e,this.modifiedRange=n}toString(){return`{${this.originalRange.toString()}->${this.modifiedRange.toString()}}`}flip(){return new i(this.modifiedRange,this.originalRange)}toTextEdit(e){let n=e.getValueOfRange(this.modifiedRange);return new ue(this.originalRange,n)}};var Re=class{constructor(e,n){this.uri=e;this.value=n}};function nn(i){return Array.isArray(i)}var tn,le=class i{constructor(e,n){this[tn]="ResourceMap";if(e instanceof i)this.map=new Map(e.map),this.toKey=n??i.defaultToKey;else if(nn(e)){this.map=new Map,this.toKey=n??i.defaultToKey;for(let[t,r]of e)this.set(t,r)}else this.map=new Map,this.toKey=e??i.defaultToKey}static{this.defaultToKey=e=>e.toString()}set(e,n){return this.map.set(this.toKey(e),new Re(e,n)),this}get(e){return this.map.get(this.toKey(e))?.value}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,n){typeof n<"u"&&(e=e.bind(n));for(let[t,r]of this.map)e(r.value,r.uri,this)}*values(){for(let e of this.map.values())yield e.value}*keys(){for(let e of this.map.values())yield e.uri}*entries(){for(let e of this.map.values())yield[e.uri,e.value]}*[(tn=Symbol.toStringTag,Symbol.iterator)](){for(let[,e]of this.map)yield[e.uri,e.value]}},rn,qe=class{constructor(e,n){this[rn]="ResourceSet";!e||typeof e=="function"?this._map=new le(e):(this._map=new le(n),e.forEach(this.add,this))}get size(){return this._map.size}add(e){return this._map.set(e,e),this}clear(){this._map.clear()}delete(e){return this._map.delete(e)}forEach(e,n){this._map.forEach((t,r)=>e.call(n,r,r,this))}has(e){return this._map.has(e)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[(rn=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}};var sn,Pe=class{constructor(){this[sn]="LinkedMap";this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,n=0){let t=this._map.get(e);if(t)return n!==0&&this.touch(t,n),t.value}set(e,n,t=0){let r=this._map.get(e);if(r)r.value=n,t!==0&&this.touch(r,t);else{switch(r={key:e,value:n,next:void 0,previous:void 0},t){case 0:this.addItemLast(r);break;case 1:this.addItemFirst(r);break;case 2:this.addItemLast(r);break;default:this.addItemLast(r);break}this._map.set(e,r),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let n=this._map.get(e);if(n)return this._map.delete(e),this.removeItem(n),this._size--,n.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,n){let t=this._state,r=this._head;for(;r;){if(n?e.bind(n)(r.value,r.key,this):e(r.value,r.key,this),this._state!==t)throw new Error("LinkedMap got modified during iteration.");r=r.next}}keys(){let e=this,n=this._state,t=this._head,r={[Symbol.iterator](){return r},next(){if(e._state!==n)throw new Error("LinkedMap got modified during iteration.");if(t){let s={value:t.key,done:!1};return t=t.next,s}else return{value:void 0,done:!0}}};return r}values(){let e=this,n=this._state,t=this._head,r={[Symbol.iterator](){return r},next(){if(e._state!==n)throw new Error("LinkedMap got modified during iteration.");if(t){let s={value:t.value,done:!1};return t=t.next,s}else return{value:void 0,done:!0}}};return r}entries(){let e=this,n=this._state,t=this._head,r={[Symbol.iterator](){return r},next(){if(e._state!==n)throw new Error("LinkedMap got modified during iteration.");if(t){let s={value:[t.key,t.value],done:!1};return t=t.next,s}else return{value:void 0,done:!0}}};return r}[(sn=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let n=this._head,t=this.size;for(;n&&t>e;)this._map.delete(n.key),n=n.next,t--;this._head=n,this._size=t,n&&(n.previous=void 0),this._state++}trimNew(e){if(e>=this.size)return;if(e===0){this.clear();return}let n=this._tail,t=this.size;for(;n&&t>e;)this._map.delete(n.key),n=n.previous,t--;this._tail=n,this._size=t,n&&(n.next=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let n=e.next,t=e.previous;if(!n||!t)throw new Error("Invalid list");n.previous=t,t.next=n}e.next=void 0,e.previous=void 0,this._state++}touch(e,n){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(n!==1&&n!==2)){if(n===1){if(e===this._head)return;let t=e.next,r=e.previous;e===this._tail?(r.next=void 0,this._tail=r):(t.previous=r,r.next=t),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(n===2){if(e===this._tail)return;let t=e.next,r=e.previous;e===this._head?(t.previous=void 0,this._head=t):(t.previous=r,r.next=t),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((n,t)=>{e.push([t,n])}),e}fromJSON(e){this.clear();for(let[n,t]of e)this.set(n,t)}};var ae=class{constructor(){this.map=new Map}add(e,n){let t=this.map.get(e);t||(t=new Set,this.map.set(e,t)),t.add(n)}delete(e,n){let t=this.map.get(e);t&&(t.delete(n),t.size===0&&this.map.delete(e))}forEach(e,n){let t=this.map.get(e);t&&t.forEach(n)}get(e){let n=this.map.get(e);return n||new Set}};var B=class{constructor(e,n,t){this.lines=e;this.range=n;this.considerWhitespaceChanges=t;this.elements=[];this.firstElementOffsetByLineIdx=[];this.lineStartOffsets=[];this.trimmedWsLengthsByLineIdx=[];this.firstElementOffsetByLineIdx.push(0);for(let r=this.range.startLineNumber;r<=this.range.endLineNumber;r++){let s=e[r-1],o=0;r===this.range.startLineNumber&&this.range.startColumn>1&&(o=this.range.startColumn-1,s=s.substring(o)),this.lineStartOffsets.push(o);let u=0;if(!t){let a=s.trimStart();u=s.length-a.length,s=a.trimEnd()}this.trimmedWsLengthsByLineIdx.push(u);let l=r===this.range.endLineNumber?Math.min(this.range.endColumn-1-o-u,s.length):s.length;for(let a=0;a<l;a++)this.elements.push(s.charCodeAt(a));r<this.range.endLineNumber&&(this.elements.push(10),this.firstElementOffsetByLineIdx.push(this.elements.length))}}toString(){return`Slice: "${this.text}"`}get text(){return this.getText(new _(0,this.length))}getText(e){return this.elements.slice(e.start,e.endExclusive).map(n=>String.fromCharCode(n)).join("")}getElement(e){return this.elements[e]}get length(){return this.elements.length}getBoundaryScore(e){let n=Be(e>0?this.elements[e-1]:-1),t=Be(e<this.elements.length?this.elements[e]:-1);if(n===7&&t===8)return 0;if(n===8)return 150;let r=0;return n!==t&&(r+=10,n===0&&t===1&&(r+=1)),r+=Fe(n),r+=Fe(t),r}translateOffset(e,n="right"){let t=P(this.firstElementOffsetByLineIdx,s=>s<=e),r=e-this.firstElementOffsetByLineIdx[t];return new y(this.range.startLineNumber+t,1+this.lineStartOffsets[t]+r+(r===0&&n==="left"?0:this.trimmedWsLengthsByLineIdx[t]))}translateRange(e){let n=this.translateOffset(e.start,"right"),t=this.translateOffset(e.endExclusive,"left");return t.isBefore(n)?N.fromPositions(t,t):N.fromPositions(n,t)}findWordContaining(e){if(e<0||e>=this.elements.length||!xe(this.elements[e]))return;let n=e;for(;n>0&&xe(this.elements[n-1]);)n--;let t=e;for(;t<this.elements.length&&xe(this.elements[t]);)t++;return new _(n,t)}countLinesIn(e){return this.translateOffset(e.endExclusive).lineNumber-this.translateOffset(e.start).lineNumber}isStronglyEqual(e,n){return this.elements[e]===this.elements[n]}extendToFullLines(e){let n=q(this.firstElementOffsetByLineIdx,r=>r<=e.start)??0,t=Ne(this.firstElementOffsetByLineIdx,r=>e.endExclusive<=r)??this.elements.length;return new _(n,t)}};function xe(i){return i>=97&&i<=122||i>=65&&i<=90||i>=48&&i<=57}var on={0:0,1:0,2:0,3:10,4:2,5:30,6:3,7:10,8:10};function Fe(i){return on[i]}function Be(i){return i===10?8:i===13?7:Q(i)?6:i>=97&&i<=122?0:i>=65&&i<=90?1:i>=48&&i<=57?2:i===-1?3:i===44||i===59?5:4}function Ke(i,e,n,t,r,s){let{moves:o,excludedChanges:u}=ln(i,e,n,s);if(!s.isValid())return[];let l=i.filter(m=>!u.has(m)),a=an(l,t,r,e,n,s);return Ae(o,a),o=mn(o),o=o.filter(m=>{let g=m.original.toOffsetRange().slice(e).map(f=>f.trim());return g.join(`
`).length>=15&&un(g,f=>f.length>=2)>=2}),o=cn(i,o),o}function un(i,e){let n=0;for(let t of i)e(t)&&n++;return n}function ln(i,e,n,t){let r=[],s=i.filter(l=>l.modified.isEmpty&&l.original.length>=3).map(l=>new Z(l.original,e,l)),o=new Set(i.filter(l=>l.original.isEmpty&&l.modified.length>=3).map(l=>new Z(l.modified,n,l))),u=new Set;for(let l of s){let a=-1,m;for(let g of o){let c=l.computeSimilarity(g);c>a&&(a=c,m=g)}if(a>.9&&m&&(o.delete(m),r.push(new U(l.range,m.range)),u.add(l.source),u.add(m.source)),!t.isValid())return{moves:r,excludedChanges:u}}return{moves:r,excludedChanges:u}}function an(i,e,n,t,r,s){let o=[],u=new ae;for(let c of i)for(let f=c.original.startLineNumber;f<c.original.endLineNumberExclusive-2;f++){let b=`${e[f-1]}:${e[f+1-1]}:${e[f+2-1]}`;u.add(b,{range:new E(f,f+3)})}let l=[];i.sort(X(c=>c.modified.startLineNumber,J));for(let c of i){let f=[];for(let b=c.modified.startLineNumber;b<c.modified.endLineNumberExclusive-2;b++){let p=`${n[b-1]}:${n[b+1-1]}:${n[b+2-1]}`,R=new E(b,b+3),v=[];u.forEach(p,({range:T})=>{for(let x of f)if(x.originalLineRange.endLineNumberExclusive+1===T.endLineNumberExclusive&&x.modifiedLineRange.endLineNumberExclusive+1===R.endLineNumberExclusive){x.originalLineRange=new E(x.originalLineRange.startLineNumber,T.endLineNumberExclusive),x.modifiedLineRange=new E(x.modifiedLineRange.startLineNumber,R.endLineNumberExclusive),v.push(x);return}let w={modifiedLineRange:R,originalLineRange:T};l.push(w),v.push(w)}),f=v}if(!s.isValid())return[]}l.sort(De(X(c=>c.modifiedLineRange.length,J)));let a=new K,m=new K;for(let c of l){let f=c.modifiedLineRange.startLineNumber-c.originalLineRange.startLineNumber,b=a.subtractFrom(c.modifiedLineRange),p=m.subtractFrom(c.originalLineRange).getWithDelta(f),R=b.getIntersection(p);for(let v of R.ranges){if(v.length<3)continue;let T=v,w=v.delta(-f);o.push(new U(w,T)),a.addRange(T),m.addRange(w)}}o.sort(X(c=>c.original.startLineNumber,J));let g=new j(i);for(let c=0;c<o.length;c++){let f=o[c],b=g.findLastMonotonous(h=>h.original.startLineNumber<=f.original.startLineNumber),p=q(i,h=>h.modified.startLineNumber<=f.modified.startLineNumber),R=Math.max(f.original.startLineNumber-b.original.startLineNumber,f.modified.startLineNumber-p.modified.startLineNumber),v=g.findLastMonotonous(h=>h.original.startLineNumber<f.original.endLineNumberExclusive),T=q(i,h=>h.modified.startLineNumber<f.modified.endLineNumberExclusive),w=Math.max(v.original.endLineNumberExclusive-f.original.endLineNumberExclusive,T.modified.endLineNumberExclusive-f.modified.endLineNumberExclusive),x;for(x=0;x<R;x++){let h=f.original.startLineNumber-x-1,L=f.modified.startLineNumber-x-1;if(h>t.length||L>r.length||a.contains(L)||m.contains(h)||!ke(t[h-1],r[L-1],s))break}x>0&&(m.addRange(new E(f.original.startLineNumber-x,f.original.startLineNumber)),a.addRange(new E(f.modified.startLineNumber-x,f.modified.startLineNumber)));let d;for(d=0;d<w;d++){let h=f.original.endLineNumberExclusive+d,L=f.modified.endLineNumberExclusive+d;if(h>t.length||L>r.length||a.contains(L)||m.contains(h)||!ke(t[h-1],r[L-1],s))break}d>0&&(m.addRange(new E(f.original.endLineNumberExclusive,f.original.endLineNumberExclusive+d)),a.addRange(new E(f.modified.endLineNumberExclusive,f.modified.endLineNumberExclusive+d))),(x>0||d>0)&&(o[c]=new U(new E(f.original.startLineNumber-x,f.original.endLineNumberExclusive+d),new E(f.modified.startLineNumber-x,f.modified.endLineNumberExclusive+d)))}return o}function ke(i,e,n){if(i.trim()===e.trim())return!0;if(i.length>300&&e.length>300)return!1;let r=new z().compute(new B([i],new N(1,1,1,i.length),!1),new B([e],new N(1,1,1,e.length),!1),n),s=0,o=I.invert(r.diffs,i.length);for(let m of o)m.seq1Range.forEach(g=>{Q(i.charCodeAt(g))||s++});function u(m){let g=0;for(let c=0;c<i.length;c++)Q(m.charCodeAt(c))||g++;return g}let l=u(i.length>e.length?i:e);return s/l>.6&&l>10}function mn(i){if(i.length===0)return i;i.sort(X(n=>n.original.startLineNumber,J));let e=[i[0]];for(let n=1;n<i.length;n++){let t=e[e.length-1],r=i[n],s=r.original.startLineNumber-t.original.endLineNumberExclusive,o=r.modified.startLineNumber-t.modified.endLineNumberExclusive;if(s>=0&&o>=0&&s+o<=2){e[e.length-1]=t.join(r);continue}e.push(r)}return e}function cn(i,e){let n=new j(i);return e=e.filter(t=>{let r=n.findLastMonotonous(u=>u.original.startLineNumber<t.original.endLineNumberExclusive)||new U(new E(1,1),new E(1,1)),s=q(i,u=>u.modified.startLineNumber<t.modified.endLineNumberExclusive);return r!==s}),e}function _e(i,e,n){let t=n;return t=Ve(i,e,t),t=Ve(i,e,t),t=fn(i,e,t),t}function Ve(i,e,n){if(n.length===0)return n;let t=[];t.push(n[0]);for(let s=1;s<n.length;s++){let o=t[t.length-1],u=n[s];if(u.seq1Range.isEmpty||u.seq2Range.isEmpty){let l=u.seq1Range.start-o.seq1Range.endExclusive,a;for(a=1;a<=l&&!(i.getElement(u.seq1Range.start-a)!==i.getElement(u.seq1Range.endExclusive-a)||e.getElement(u.seq2Range.start-a)!==e.getElement(u.seq2Range.endExclusive-a));a++);if(a--,a===l){t[t.length-1]=new I(new _(o.seq1Range.start,u.seq1Range.endExclusive-l),new _(o.seq2Range.start,u.seq2Range.endExclusive-l));continue}u=u.delta(-a)}t.push(u)}let r=[];for(let s=0;s<t.length-1;s++){let o=t[s+1],u=t[s];if(u.seq1Range.isEmpty||u.seq2Range.isEmpty){let l=o.seq1Range.start-u.seq1Range.endExclusive,a;for(a=0;a<l&&!(!i.isStronglyEqual(u.seq1Range.start+a,u.seq1Range.endExclusive+a)||!e.isStronglyEqual(u.seq2Range.start+a,u.seq2Range.endExclusive+a));a++);if(a===l){t[s+1]=new I(new _(u.seq1Range.start+l,o.seq1Range.endExclusive),new _(u.seq2Range.start+l,o.seq2Range.endExclusive));continue}a>0&&(u=u.delta(a))}r.push(u)}return t.length>0&&r.push(t[t.length-1]),r}function fn(i,e,n){if(!i.getBoundaryScore||!e.getBoundaryScore)return n;for(let t=0;t<n.length;t++){let r=t>0?n[t-1]:void 0,s=n[t],o=t+1<n.length?n[t+1]:void 0,u=new _(r?r.seq1Range.endExclusive+1:0,o?o.seq1Range.start-1:i.length),l=new _(r?r.seq2Range.endExclusive+1:0,o?o.seq2Range.start-1:e.length);s.seq1Range.isEmpty?n[t]=ze(s,i,e,u,l):s.seq2Range.isEmpty&&(n[t]=ze(s.swap(),e,i,l,u).swap())}return n}function ze(i,e,n,t,r){let o=1;for(;i.seq1Range.start-o>=t.start&&i.seq2Range.start-o>=r.start&&n.isStronglyEqual(i.seq2Range.start-o,i.seq2Range.endExclusive-o)&&o<100;)o++;o--;let u=0;for(;i.seq1Range.start+u<t.endExclusive&&i.seq2Range.endExclusive+u<r.endExclusive&&n.isStronglyEqual(i.seq2Range.start+u,i.seq2Range.endExclusive+u)&&u<100;)u++;if(o===0&&u===0)return i;let l=0,a=-1;for(let m=-o;m<=u;m++){let g=i.seq2Range.start+m,c=i.seq2Range.endExclusive+m,f=i.seq1Range.start+m,b=e.getBoundaryScore(f)+n.getBoundaryScore(g)+n.getBoundaryScore(c);b>a&&(a=b,l=m)}return i.delta(l)}function Ge(i,e,n){let t=[];for(let r of n){let s=t[t.length-1];if(!s){t.push(r);continue}r.seq1Range.start-s.seq1Range.endExclusive<=2||r.seq2Range.start-s.seq2Range.endExclusive<=2?t[t.length-1]=new I(s.seq1Range.join(r.seq1Range),s.seq2Range.join(r.seq2Range)):t.push(r)}return t}function We(i,e,n){let t=I.invert(n,i.length),r=[],s=new D(0,0);function o(l,a){if(l.offset1<s.offset1||l.offset2<s.offset2)return;let m=i.findWordContaining(l.offset1),g=e.findWordContaining(l.offset2);if(!m||!g)return;let c=new I(m,g),f=c.intersect(a),b=f.seq1Range.length,p=f.seq2Range.length;for(;t.length>0;){let R=t[0];if(!(R.seq1Range.intersects(c.seq1Range)||R.seq2Range.intersects(c.seq2Range)))break;let T=i.findWordContaining(R.seq1Range.start),w=e.findWordContaining(R.seq2Range.start),x=new I(T,w),d=x.intersect(R);if(b+=d.seq1Range.length,p+=d.seq2Range.length,c=c.join(x),c.seq1Range.endExclusive>=R.seq1Range.endExclusive)t.shift();else break}b+p<(c.seq1Range.length+c.seq2Range.length)*2/3&&r.push(c),s=c.getEndExclusives()}for(;t.length>0;){let l=t.shift();l.seq1Range.isEmpty||(o(l.getStarts(),l),o(l.getEndExclusives().delta(-1),l))}return gn(n,r)}function gn(i,e){let n=[];for(;i.length>0||e.length>0;){let t=i[0],r=e[0],s;t&&(!r||t.seq1Range.start<r.seq1Range.start)?s=i.shift():s=e.shift(),n.length>0&&n[n.length-1].seq1Range.endExclusive>=s.seq1Range.start?n[n.length-1]=n[n.length-1].join(s):n.push(s)}return n}function He(i,e,n){let t=n;if(t.length===0)return t;let r=0,s;do{s=!1;let u=[t[0]];for(let l=1;l<t.length;l++){let g=function(f,b){let p=new _(m.seq1Range.endExclusive,a.seq1Range.start);return i.getText(p).replace(/\s/g,"").length<=4&&(f.seq1Range.length+f.seq2Range.length>5||b.seq1Range.length+b.seq2Range.length>5)};var o=g;let a=t[l],m=u[u.length-1];g(m,a)?(s=!0,u[u.length-1]=u[u.length-1].join(a)):u.push(a)}t=u}while(r++<10&&s);return t}function je(i,e,n){let t=n;if(t.length===0)return t;let r=0,s;do{s=!1;let l=[t[0]];for(let a=1;a<t.length;a++){let c=function(b,p){let R=new _(g.seq1Range.endExclusive,m.seq1Range.start);if(i.countLinesIn(R)>5||R.length>500)return!1;let T=i.getText(R).trim();if(T.length>20||T.split(/\r\n|\r|\n/).length>1)return!1;let w=i.countLinesIn(b.seq1Range),x=b.seq1Range.length,d=e.countLinesIn(b.seq2Range),h=b.seq2Range.length,L=i.countLinesIn(p.seq1Range),A=p.seq1Range.length,k=e.countLinesIn(p.seq2Range),fe=p.seq2Range.length,Ee=2*40+50;function ee(Ye){return Math.min(Ye,Ee)}return Math.pow(Math.pow(ee(w*40+x),1.5)+Math.pow(ee(d*40+h),1.5),1.5)+Math.pow(Math.pow(ee(L*40+A),1.5)+Math.pow(ee(k*40+fe),1.5),1.5)>(Ee**1.5)**1.5*1.3};var u=c;let m=t[a],g=l[l.length-1];c(g,m)?(s=!0,l[l.length-1]=l[l.length-1].join(m)):l.push(m)}t=l}while(r++<10&&s);let o=[];return Se(t,(l,a,m)=>{let g=a;function c(T){return T.length>0&&T.trim().length<=3&&a.seq1Range.length+a.seq2Range.length>100}let f=i.extendToFullLines(a.seq1Range),b=i.getText(new _(f.start,a.seq1Range.start));c(b)&&(g=g.deltaStart(-b.length));let p=i.getText(new _(a.seq1Range.endExclusive,f.endExclusive));c(p)&&(g=g.deltaEnd(p.length));let R=I.fromOffsetPairs(l?l.getEndExclusives():D.zero,m?m.getStarts():D.max),v=g.intersect(R);o.length>0&&v.getStarts().equals(o[o.length-1].getEndExclusives())?o[o.length-1]=o[o.length-1].join(v):o.push(v)}),o}var C=class{constructor(e,n){this.trimmedHash=e;this.lines=n}getElement(e){return this.trimmedHash[e]}get length(){return this.trimmedHash.length}getBoundaryScore(e){let n=e===0?0:$e(this.lines[e-1]),t=e===this.lines.length?0:$e(this.lines[e]);return 1e3-(n+t)}getText(e){return this.lines.slice(e.start,e.endExclusive).join(`
`)}isStronglyEqual(e,n){return this.lines[e]===this.lines[n]}};function $e(i){let e=0;for(;e<i.length&&(i.charCodeAt(e)===32||i.charCodeAt(e)===9);)e++;return e}var H=class{constructor(e,n,t){this.changes=e;this.moves=n;this.hitTimeout=t}},me=class i{constructor(e,n){this.lineRangeMapping=e,this.changes=n}flip(){return new i(this.lineRangeMapping.flip(),this.changes.map(e=>e.flip()))}};var ce=class{constructor(){this.dynamicProgrammingDiffing=new re;this.myersDiffingAlgorithm=new z}computeDiff(e,n,t){if(e.length<=1&&Ie(e,n,(d,h)=>d===h))return new H([],[],!1);if(e.length===1&&e[0].length===0||n.length===1&&n[0].length===0)return new H([new W(new E(1,e.length+1),new E(1,n.length+1),[new M(new N(1,1,e.length,e[e.length-1].length+1),new N(1,1,n.length,n[n.length-1].length+1))])],[],!1);let r=t.maxComputationTimeMs===0?F.instance:new ie(t.maxComputationTimeMs),s=!t.ignoreTrimWhitespace,o=new Map;function u(d){let h=o.get(d);return h===void 0&&(h=o.size,o.set(d,h)),h}let l=e.map(d=>u(d.trim())),a=n.map(d=>u(d.trim())),m=new C(l,e),g=new C(a,n),c=m.length+g.length<1700?this.dynamicProgrammingDiffing.compute(m,g,r,(d,h)=>e[d]===n[h]?n[h].length===0?.1:1+Math.log(1+n[h].length):.99):this.myersDiffingAlgorithm.compute(m,g,r),f=c.diffs,b=c.hitTimeout;f=_e(m,g,f),f=He(m,g,f);let p=[],R=d=>{if(s)for(let h=0;h<d;h++){let L=v+h,A=T+h;if(e[L]!==n[A]){let k=this.refineDiff(e,n,new I(new _(L,L+1),new _(A,A+1)),r,s);for(let fe of k.mappings)p.push(fe);k.hitTimeout&&(b=!0)}}},v=0,T=0;for(let d of f){Y(()=>d.seq1Range.start-v===d.seq2Range.start-T);let h=d.seq1Range.start-v;R(h),v=d.seq1Range.endExclusive,T=d.seq2Range.endExclusive;let L=this.refineDiff(e,n,d,r,s);L.hitTimeout&&(b=!0);for(let A of L.mappings)p.push(A)}R(e.length-v);let w=Xe(p,e,n),x=[];return t.computeMoves&&(x=this.computeMoves(w,e,n,l,a,r,s)),Y(()=>{function d(L,A){if(L.lineNumber<1||L.lineNumber>A.length)return!1;let k=A[L.lineNumber-1];return!(L.column<1||L.column>k.length+1)}function h(L,A){return!(L.startLineNumber<1||L.startLineNumber>A.length+1||L.endLineNumberExclusive<1||L.endLineNumberExclusive>A.length+1)}for(let L of w){if(!L.innerChanges)return!1;for(let A of L.innerChanges)if(!(d(A.modifiedRange.getStartPosition(),n)&&d(A.modifiedRange.getEndPosition(),n)&&d(A.originalRange.getStartPosition(),e)&&d(A.originalRange.getEndPosition(),e)))return!1;if(!h(L.modified,n)||!h(L.original,e))return!1}return!0}),new H(w,x,b)}computeMoves(e,n,t,r,s,o,u){return Ke(e,n,t,r,s,o).map(m=>{let g=this.refineDiff(n,t,new I(m.original.toOffsetRange(),m.modified.toOffsetRange()),o,u),c=Xe(g.mappings,n,t,!0);return new me(m,c)})}refineDiff(e,n,t,r,s){let u=pn(t).toRangeMapping2(e,n),l=new B(e,u.originalRange,s),a=new B(n,u.modifiedRange,s),m=l.length+a.length<500?this.dynamicProgrammingDiffing.compute(l,a,r):this.myersDiffingAlgorithm.compute(l,a,r),g=!1,c=m.diffs;g&&I.assertSorted(c),c=_e(l,a,c),g&&I.assertSorted(c),c=We(l,a,c),g&&I.assertSorted(c),c=Ge(l,a,c),g&&I.assertSorted(c),c=je(l,a,c),g&&I.assertSorted(c);let f=c.map(b=>new M(l.translateRange(b.seq1Range),a.translateRange(b.seq2Range)));return g&&M.assertSorted(f),{mappings:f,hitTimeout:m.hitTimeout}}};function Xe(i,e,n,t=!1){let r=[];for(let s of ye(i.map(o=>bn(o,e,n)),(o,u)=>o.original.overlapOrTouch(u.original)||o.modified.overlapOrTouch(u.modified))){let o=s[0],u=s[s.length-1];r.push(new W(o.original.join(u.original),o.modified.join(u.modified),s.map(l=>l.innerChanges[0])))}return Y(()=>!t&&r.length>0&&(r[0].modified.startLineNumber!==r[0].original.startLineNumber||n.length-r[r.length-1].modified.endLineNumberExclusive!==e.length-r[r.length-1].original.endLineNumberExclusive)?!1:pe(r,(s,o)=>o.original.startLineNumber-s.original.endLineNumberExclusive===o.modified.startLineNumber-s.modified.endLineNumberExclusive&&s.original.endLineNumberExclusive<o.original.startLineNumber&&s.modified.endLineNumberExclusive<o.modified.startLineNumber)),r}function bn(i,e,n){let t=0,r=0;i.modifiedRange.endColumn===1&&i.originalRange.endColumn===1&&i.originalRange.startLineNumber+t<=i.originalRange.endLineNumber&&i.modifiedRange.startLineNumber+t<=i.modifiedRange.endLineNumber&&(r=-1),i.modifiedRange.startColumn-1>=n[i.modifiedRange.startLineNumber-1].length&&i.originalRange.startColumn-1>=e[i.originalRange.startLineNumber-1].length&&i.originalRange.startLineNumber<=i.originalRange.endLineNumber+r&&i.modifiedRange.startLineNumber<=i.modifiedRange.endLineNumber+r&&(t=1);let s=new E(i.originalRange.startLineNumber+t,i.originalRange.endLineNumber+1+r),o=new E(i.modifiedRange.startLineNumber+t,i.modifiedRange.endLineNumber+1+r);return new W(s,o,[i])}function pn(i){return new U(new E(i.seq1Range.start+1,i.seq1Range.endExclusive+1),new E(i.seq2Range.start+1,i.seq2Range.endExclusive+1))}async function dn(i,e,n){let t=i.split(/\r\n|\r|\n/),r=e.split(/\r\n|\r|\n/),o=new ce().computeDiff(t,r,n),u=o.changes.length>0?!1:i===e;function l(a){return a.map(m=>[m.original.startLineNumber,m.original.endLineNumberExclusive,m.modified.startLineNumber,m.modified.endLineNumberExclusive,m.innerChanges?.map(g=>[g.originalRange.startLineNumber,g.originalRange.startColumn,g.originalRange.endLineNumber,g.originalRange.endColumn,g.modifiedRange.startLineNumber,g.modifiedRange.startColumn,g.modifiedRange.endLineNumber,g.modifiedRange.endColumn])])}return{identical:u,quitEarly:o.hitTimeout,changes:l(o.changes),moves:o.moves.map(a=>[a.lineRangeMapping.original.startLineNumber,a.lineRangeMapping.original.endLineNumberExclusive,a.lineRangeMapping.modified.startLineNumber,a.lineRangeMapping.modified.endLineNumberExclusive,l(a.changes)])}}function hn(){let i=Je.parentPort;if(!i)throw new Error("This module should only be used in a worker thread.");i.on("message",async({id:e,fn:n,args:t})=>{try{let r=await Le[n](...t);i.postMessage({id:e,res:r})}catch(r){i.postMessage({id:e,err:r})}})}hn();
//!!! DO NOT modify, this file was COPIED from 'microsoft/vscode'
